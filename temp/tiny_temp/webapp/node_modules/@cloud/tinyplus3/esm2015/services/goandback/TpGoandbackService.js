import { Injectable, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { TpGoandbackModule } from './TpGoandbackModule';
import { TpGoandbackComponent } from './TpGoandbackComponent';
import { TiMessageService, Util } from '@cloud/tiny3';
import { TpUtil } from '../../utils/TpUtil';
import * as i0 from "@angular/core";
import * as i1 from "@cloud/tiny3";
import * as i2 from "@angular/platform-browser";
import * as i3 from "./TpGoandbackModule";
/**
 * 组件内部封装基类服务，只供内部使用
 */
/**
 * @internal
 */
export class TpGoandbackService {
    constructor(tiMessage, domSanitizer) {
        this.tiMessage = tiMessage;
        this.domSanitizer = domSanitizer;
        /**
         * 弹窗类型
         */
        this.firstMessageType = 'warn';
    }
    open(config) {
        // 受限组件需通过调用方法传入词条
        this.words = config.words ? config.words : this.words;
        this.firstMessage(config);
    }
    /**
     * 触发去绑定|认证|充值按钮事件
     * @param configObj 用户配置对象
     */
    firstMessage(configObj) {
        const configId = Util.isString(configObj.id) && configObj.id !== '' ? configObj.id : 'tp_message_modal'; // 用户未设置id时，设置默认id用于拼接
        const contentHref = this.words.firstMessageContentLabel ?
            `<a tiNavigation target="_blank" rel="noopener noreferrer" href="${this.words.firstMessageContentHref}">${this.words.firstMessageContentLabel}</a>` : '';
        const instances = this.tiMessage.open({
            id: configId,
            type: this.firstMessageType,
            title: this.words.firstMessageTitle,
            content: Util.formatEntry(this.words.firstMessageContent, [contentHref]),
            okButton: {
                text: this.words.firstMessageOkButtonText,
                autofocus: true,
                click: () => {
                    const handleUrl = this.goToUrl(configObj);
                    instances.close();
                    // 受限组件存在无第二个弹窗的情况；此处添加判断，是否需要触发该弹窗出现
                    if (this.words.secondMessageTitle) {
                        this.secondMessage(configObj, handleUrl, configId);
                    }
                }
            },
            cancelButton: {
                show: false
            },
            close: (messageRef) => {
                // 如果不需要二级弹窗，关闭回调在一级弹窗关闭时执行
                if (!this.words.secondMessageTitle && configObj.closeFn && Util.isFunction(configObj.closeFn)) {
                    configObj.closeFn(messageRef);
                }
            }
        });
    }
    /**
     * 触发已绑定|认证|充值按钮事件
     * @param configObj 用户配置对象
     * @param handleUrl 跳转链接
     */
    secondMessage(configObj, handleUrl, promptId) {
        const instances = this.tiMessage.open({
            id: promptId + '_prompt',
            type: 'prompt',
            title: this.words.secondMessageTitle,
            modalClass: 'tp-goandback-body',
            content: TpGoandbackComponent,
            // context定义上下文对象，对应组件@Input属性，可设置/获取这些接口属性
            context: {
                words: this.words,
                href: handleUrl,
                label: this.words.secondMessageFail,
                warn: {
                    type: 'warn',
                    open: false,
                    id: promptId + '_prompt_warn'
                },
                error: {
                    type: 'error',
                    open: false,
                    id: promptId + '_prompt_error'
                }
            },
            okButton: {
                text: this.words.secondMessageOkButtonText,
                autofocus: true,
                click: () => {
                    if (configObj.confirmFn && Util.isFunction(configObj.confirmFn)) {
                        // tslint:disable-next-line: no-use-before-declare
                        configObj.confirmFn(instances, openAlertFn);
                    }
                }
            },
            close: (messageRef) => {
                // 关闭回调在二级弹窗关闭时执行
                if (configObj.closeFn && Util.isFunction(configObj.closeFn)) {
                    configObj.closeFn(messageRef);
                }
            }
        });
        /**
         * 用户调用该函数，打开对应弹框
         * @param alertType (error: 系统繁忙) || (warn: 未完成绑定|认证|充值)
         */
        const openAlertFn = (alertType) => {
            const context = instances.content.instance.context;
            context.warn.open = alertType === 'warn' ? true : false;
            context.error.open = alertType === 'error' ? true : false;
        };
    }
    /**
     * @param definedUrl 跳转链接
     * @param params 链接参数
     */
    goToUrl(configObj) {
        // 未配置addUrlParams属性时，默认赋值true
        configObj.addUrlParams = Util.isUndefined(configObj.addUrlParams)
            ? true : configObj.addUrlParams;
        const [definedUrl, params] = [configObj.url, configObj.params];
        let url = Util.isString(definedUrl) ? definedUrl : this.words.path;
        // 判断是否需要url添加params处理（restrict受限组件需略过 issues-#1830）
        if (configObj.addUrlParams) {
            url = TpUtil.addDefaultParam(url, params);
        }
        const win = window.open(this.domSanitizer.sanitize(SecurityContext.URL, url), '_blank');
        // IE浏览器下，有些场景下window.open()无返回值时不用处理
        if (win) {
            // 处理打开一个新的标签，新标签中的页面如果存在恶意代码，就可以将原网站直接导航到一个虚假网站的安全漏洞
            win.opener = null;
        }
        return url;
    }
}
TpGoandbackService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TpGoandbackService_Factory() { return new TpGoandbackService(i0.ɵɵinject(i1.TiMessageService), i0.ɵɵinject(i2.DomSanitizer)); }, token: TpGoandbackService, providedIn: i3.TpGoandbackModule });
TpGoandbackService.decorators = [
    { type: Injectable, args: [{
                providedIn: TpGoandbackModule
            },] }
];
TpGoandbackService.ctorParameters = () => [
    { type: TiMessageService },
    { type: DomSanitizer }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBHb2FuZGJhY2tTZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnlwbHVzMy9zZXJ2aWNlcy9nb2FuZGJhY2svVHBHb2FuZGJhY2tTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQTZCLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNqRixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7Ozs7O0FBNkM1Qzs7R0FFRztBQUlIOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGtCQUFrQjtJQVMzQixZQUFzQixTQUEyQixFQUFVLFlBQTBCO1FBQS9ELGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQWM7UUFKckY7O1dBRUc7UUFDTyxxQkFBZ0IsR0FBa0IsTUFBTSxDQUFDO0lBRW5ELENBQUM7SUFFTSxJQUFJLENBQUMsTUFBMEI7UUFDbEMsa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0RCxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRDs7O09BR0c7SUFDSyxZQUFZLENBQUMsU0FBNEI7UUFDN0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FB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QyxVQUFVLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvRCxJQUFJLEdBQUcsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQzNFLG9EQUFvRDtRQUNwRCxJQUFJLFNBQVMsQ0FBQyxZQUFZLEVBQUU7WUFDeEIsR0FBRyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzdDO1FBQ0QsTUFBTSxHQUFHLEdBQVEsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTdGLHFDQUFxQztRQUNyQyxJQUFJLEdBQUcsRUFBRTtZQUNMLHFEQUFxRDtZQUNyRCxHQUFHLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztTQUNyQjtRQUVELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQzs7OztZQTVJSixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLGlCQUFpQjthQUNoQzs7O1lBbkRRLGdCQUFnQjtZQUhoQixZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgU2VjdXJpdHlDb250ZXh0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBUcEdvYW5kYmFja01vZHVsZSB9IGZyb20gJy4vVHBHb2FuZGJhY2tNb2R1bGUnO1xyXG5pbXBvcnQgeyBUcEdvYW5kYmFja0NvbXBvbmVudCB9IGZyb20gJy4vVHBHb2FuZGJhY2tDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBUaU1lc3NhZ2VTZXJ2aWNlLCBUaU1lc3NhZ2VUeXBlLCBUaU1vZGFsUmVmLCBVdGlsIH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuaW1wb3J0IHsgVHBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVHBVdGlsJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBHb0FuZEJhY2tDb25maWcge1xyXG4gICAgLyoqXHJcbiAgICAgKiDljrvnu5Hlrpp86K6k6K+BfOWFheWAvOi3s+i9rOmTvuaOpVxyXG4gICAgICpcclxuICAgICAqIHYxMC4xLjPlj4rkuYvliY3niYjmnKzlrZjlnKhYU1PmlLvlh7sodXJs57G75Z6LKemjjumZqe+8jHYxMC4xLjQg54mI5pys5YGa5LqG5a6J5YWo5aSE55CG77yM5bey5LiN5a2Y5Zyo5a6J5YWo6Zeu6aKY77yM5bu66K6u5Lia5Yqh5bC95b+r5Y2H57qn54mI5pys44CCXHJcbiAgICAgKi9cclxuICAgIHVybD86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5qCH5YeGa2V5OnZhbHVl55qE5Y+C5pWw77yM5oC75L2T5a+56LGh5b2i5byPXHJcbiAgICAgKi9cclxuICAgIHBhcmFtcz86IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBzdHJpbmcgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Y+X6ZmQ57uE5Lu26K+N5p2hXHJcbiAgICAgKi9cclxuICAgIHdvcmRzPzogYW55O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiB1cmzmmK/lkKbmt7vliqBwYXJhbXPvvIhyZXN0cmljdOWPl+mZkOe7hOS7tumcgOeVpei/h2dvVG9Vcmzmlrnms5XkuK3lr7l1cmznmoTlpITnkIbvvIlcclxuICAgICAqIDEwLjEuMiDniYjmnKzmt7vliqBcclxuICAgICAqL1xyXG4gICAgYWRkVXJsUGFyYW1zPzogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICog54K55Ye75bey57uR5a6afOWFheWAvHzorqTor4HmjInpkq7nmoTlh73mlbDlm57osIPmjqXlj6PvvIzor6Xlh73mlbDlrZjlnKjkuKTkuKrlj4LmlbDvvIhpbnN0YW5jZXMsb3BlbkFsZXJ077yJ77yaXHJcbiAgICAgKlxyXG4gICAgICogMS5pbnN0YW5jZXM65by556qX55qE56S65L6L77yM5Y+v6LCD55SoaW5zdGFuY2VzLmRpc21pc3MoKeaWueazleWFs+mXreW8ueeqlzxicj5cclxuICAgICAqIDIub3BlbkFsZXJ0KGFsZXJ0VHlwZSk65o6n5Yi25o+Q56S65L+h5oGv55qE56eN57G75ZKM5pi+56S66ZqQ6JeP55qE5pa55rOV77ybYWxlcnRUeXBl5pyJ5Lik5Liq5Y+v6YCJ5YC877yaXHJcbiAgICAgKlxyXG4gICAgICogYS5cImVycm9yXCLvvJrns7vnu5/nuYHlv5nnirbmgIHvvJtiLlwid2Fyblwi77ya5pyq57uR5a6afOiupOivgXzlhYXlgLznirbmgIFcclxuICAgICAqL1xyXG4gICAgY29uZmlybUZuPyhpbnN0YW5jZXM/OiBUaU1vZGFsUmVmLCBvcGVuQWxlcnRGbj86IEZ1bmN0aW9uKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5by556qX5YWz6Zet5pe255qE5Ye95pWw5Zue6LCD5o6l5Y+j77yM6K+l5Ye95pWw5a2Y5Zyo5LiA5Liq5Y+C5pWw77yIaW5zdGFuY2Vz77yJXHJcbiAgICAgKiDlj6rmnInkuIDnuqflvLnnqpfml7bvvIzlhbPpl63lm57osIPlnKjkuIDnuqflvLnnqpflhbPpl63ml7bmiafooYzvvJvlrZjlnKjkuoznuqflvLnnqpfml7bvvIzlhbPpl63lm57osIPlnKjkuoznuqflvLnnqpflhbPpl63ml7bmiafooYxcclxuICAgICAqIDEwLjEuNCDniYjmnKzmt7vliqBcclxuICAgICAqL1xyXG4gICAgY2xvc2VGbj8oaW5zdGFuY2VzPzogVGlNb2RhbFJlZik6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOe7hOS7tuWGhemDqOWwgeijheWfuuexu+acjeWKoe+8jOWPquS+m+WGhemDqOS9v+eUqFxyXG4gKi9cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogVHBHb2FuZGJhY2tNb2R1bGVcclxufSlcclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFRwR29hbmRiYWNrU2VydmljZSB7XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluivjeadoVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgd29yZHM6IGFueTtcclxuICAgIC8qKlxyXG4gICAgICog5by556qX57G75Z6LXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBmaXJzdE1lc3NhZ2VUeXBlOiBUaU1lc3NhZ2VUeXBlID0gJ3dhcm4nO1xyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIHRpTWVzc2FnZTogVGlNZXNzYWdlU2VydmljZSwgcHJpdmF0ZSBkb21TYW5pdGl6ZXI6IERvbVNhbml0aXplcikge1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvcGVuKGNvbmZpZz86IFRwR29BbmRCYWNrQ29uZmlnKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5Y+X6ZmQ57uE5Lu26ZyA6YCa6L+H6LCD55So5pa55rOV5Lyg5YWl6K+N5p2hXHJcbiAgICAgICAgdGhpcy53b3JkcyA9IGNvbmZpZy53b3JkcyA/IGNvbmZpZy53b3JkcyA6IHRoaXMud29yZHM7XHJcbiAgICAgICAgdGhpcy5maXJzdE1lc3NhZ2UoY29uZmlnKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6Kem5Y+R5Y6757uR5a6afOiupOivgXzlhYXlgLzmjInpkq7kuovku7ZcclxuICAgICAqIEBwYXJhbSBjb25maWdPYmog55So5oi36YWN572u5a+56LGhXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZmlyc3RNZXNzYWdlKGNvbmZpZ09iajogVHBHb0FuZEJhY2tDb25maWcpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjb25maWdJZCA9IFV0aWwuaXNTdHJpbmcoY29uZmlnT2JqLmlkKSAmJiBjb25maWdPYmouaWQgIT09ICcnID8gY29uZmlnT2JqLmlkIDogJ3RwX21lc3NhZ2VfbW9kYWwnOyAvLyDnlKjmiLfmnKrorr7nva5pZOaXtu+8jOiuvue9rum7mOiupGlk55So5LqO5ou85o6lXHJcbiAgICAgICAgY29uc3QgY29udGVudEhyZWY6IHN0cmluZyA9IHRoaXMud29yZHMuZmlyc3RNZXNzYWdlQ29udGVudExhYmVsID9cclxuICAgIGA8YSB0aU5hdmlnYXRpb24gdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9vcGVuZXIgbm9yZWZlcnJlclwiIGhyZWY9XCIke3RoaXMud29yZHMuZmlyc3RNZXNzYWdlQ29udGVudEhyZWZ9XCI+JHt0aGlzLndvcmRzLmZpcnN0TWVzc2FnZUNvbnRlbnRMYWJlbH08L2E+YCA6ICcnO1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlczogVGlNb2RhbFJlZiA9IHRoaXMudGlNZXNzYWdlLm9wZW4oe1xyXG4gICAgICAgICAgICBpZDogY29uZmlnSWQsXHJcbiAgICAgICAgICAgIHR5cGU6IHRoaXMuZmlyc3RNZXNzYWdlVHlwZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRoaXMud29yZHMuZmlyc3RNZXNzYWdlVGl0bGUsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IFV0aWwuZm9ybWF0RW50cnkodGhpcy53b3Jkcy5maXJzdE1lc3NhZ2VDb250ZW50LCBbY29udGVudEhyZWZdKSxcclxuICAgICAgICAgICAgb2tCdXR0b246IHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMud29yZHMuZmlyc3RNZXNzYWdlT2tCdXR0b25UZXh0LFxyXG4gICAgICAgICAgICAgICAgYXV0b2ZvY3VzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY2xpY2s6ICgpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGVVcmw6IHN0cmluZyA9IHRoaXMuZ29Ub1VybChjb25maWdPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWPl+mZkOe7hOS7tuWtmOWcqOaXoOesrOS6jOS4quW8ueeql+eahOaDheWGte+8m+atpOWkhOa3u+WKoOWIpOaWre+8jOaYr+WQpumcgOimgeinpuWPkeivpeW8ueeql+WHuueOsFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLndvcmRzLnNlY29uZE1lc3NhZ2VUaXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlY29uZE1lc3NhZ2UoY29uZmlnT2JqLCBoYW5kbGVVcmwsIGNvbmZpZ0lkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbjoge1xyXG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2VcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2xvc2U6IChtZXNzYWdlUmVmOiBUaU1vZGFsUmVmKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzkuI3pnIDopoHkuoznuqflvLnnqpfvvIzlhbPpl63lm57osIPlnKjkuIDnuqflvLnnqpflhbPpl63ml7bmiafooYxcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy53b3Jkcy5zZWNvbmRNZXNzYWdlVGl0bGUgJiYgY29uZmlnT2JqLmNsb3NlRm4gJiYgVXRpbC5pc0Z1bmN0aW9uKGNvbmZpZ09iai5jbG9zZUZuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ09iai5jbG9zZUZuKG1lc3NhZ2VSZWYpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDop6blj5Hlt7Lnu5Hlrpp86K6k6K+BfOWFheWAvOaMiemSruS6i+S7tlxyXG4gICAgICogQHBhcmFtIGNvbmZpZ09iaiDnlKjmiLfphY3nva7lr7nosaFcclxuICAgICAqIEBwYXJhbSBoYW5kbGVVcmwg6Lez6L2s6ZO+5o6lXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc2Vjb25kTWVzc2FnZShjb25maWdPYmo6IFRwR29BbmRCYWNrQ29uZmlnLCBoYW5kbGVVcmw6IHN0cmluZywgcHJvbXB0SWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGluc3RhbmNlczogVGlNb2RhbFJlZiA9IHRoaXMudGlNZXNzYWdlLm9wZW4oe1xyXG4gICAgICAgICAgICBpZDogcHJvbXB0SWQgKyAnX3Byb21wdCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICdwcm9tcHQnLFxyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy53b3Jkcy5zZWNvbmRNZXNzYWdlVGl0bGUsXHJcbiAgICAgICAgICAgIG1vZGFsQ2xhc3M6ICd0cC1nb2FuZGJhY2stYm9keScsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IFRwR29hbmRiYWNrQ29tcG9uZW50LFxyXG4gICAgICAgICAgICAvLyBjb250ZXh05a6a5LmJ5LiK5LiL5paH5a+56LGh77yM5a+55bqU57uE5Lu2QElucHV05bGe5oCn77yM5Y+v6K6+572uL+iOt+WPlui/meS6m+aOpeWPo+WxnuaAp1xyXG4gICAgICAgICAgICBjb250ZXh0OiB7XHJcbiAgICAgICAgICAgICAgICB3b3JkczogdGhpcy53b3JkcyxcclxuICAgICAgICAgICAgICAgIGhyZWY6IGhhbmRsZVVybCxcclxuICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLndvcmRzLnNlY29uZE1lc3NhZ2VGYWlsLFxyXG4gICAgICAgICAgICAgICAgd2Fybjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuJyxcclxuICAgICAgICAgICAgICAgICAgICBvcGVuOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogcHJvbXB0SWQgKyAnX3Byb21wdF93YXJuJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICBvcGVuOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogcHJvbXB0SWQgKyAnX3Byb21wdF9lcnJvcidcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb2tCdXR0b246IHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMud29yZHMuc2Vjb25kTWVzc2FnZU9rQnV0dG9uVGV4dCxcclxuICAgICAgICAgICAgICAgIGF1dG9mb2N1czogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNsaWNrOiAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ09iai5jb25maXJtRm4gJiYgVXRpbC5pc0Z1bmN0aW9uKGNvbmZpZ09iai5jb25maXJtRm4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tdXNlLWJlZm9yZS1kZWNsYXJlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ09iai5jb25maXJtRm4oaW5zdGFuY2VzLCBvcGVuQWxlcnRGbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjbG9zZTogKG1lc3NhZ2VSZWY6IFRpTW9kYWxSZWYpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOWFs+mXreWbnuiwg+WcqOS6jOe6p+W8ueeql+WFs+mXreaXtuaJp+ihjFxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ09iai5jbG9zZUZuICYmIFV0aWwuaXNGdW5jdGlvbihjb25maWdPYmouY2xvc2VGbikpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWdPYmouY2xvc2VGbihtZXNzYWdlUmVmKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDnlKjmiLfosIPnlKjor6Xlh73mlbDvvIzmiZPlvIDlr7nlupTlvLnmoYZcclxuICAgICAgICAgKiBAcGFyYW0gYWxlcnRUeXBlIChlcnJvcjog57O757uf57mB5b+ZKSB8fCAod2Fybjog5pyq5a6M5oiQ57uR5a6afOiupOivgXzlhYXlgLwpXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3Qgb3BlbkFsZXJ0Rm46IChhbGVydFR5cGU6IHN0cmluZykgPT4gdm9pZCA9IChhbGVydFR5cGU6IHN0cmluZyk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZXh0OiBhbnkgPSBpbnN0YW5jZXMuY29udGVudC5pbnN0YW5jZS5jb250ZXh0O1xyXG4gICAgICAgICAgICBjb250ZXh0Lndhcm4ub3BlbiA9IGFsZXJ0VHlwZSA9PT0gJ3dhcm4nID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICBjb250ZXh0LmVycm9yLm9wZW4gPSBhbGVydFR5cGUgPT09ICdlcnJvcicgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBkZWZpbmVkVXJsIOi3s+i9rOmTvuaOpVxyXG4gICAgICogQHBhcmFtIHBhcmFtcyDpk77mjqXlj4LmlbBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnb1RvVXJsKGNvbmZpZ09iajogVHBHb0FuZEJhY2tDb25maWcpOiBzdHJpbmcge1xyXG4gICAgICAgIC8vIOacqumFjee9rmFkZFVybFBhcmFtc+WxnuaAp+aXtu+8jOm7mOiupOi1i+WAvHRydWVcclxuICAgICAgICBjb25maWdPYmouYWRkVXJsUGFyYW1zID0gVXRpbC5pc1VuZGVmaW5lZChjb25maWdPYmouYWRkVXJsUGFyYW1zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRydWUgOiBjb25maWdPYmouYWRkVXJsUGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IFtkZWZpbmVkVXJsLCBwYXJhbXNdID0gW2NvbmZpZ09iai51cmwsIGNvbmZpZ09iai5wYXJhbXNdO1xyXG4gICAgICAgIGxldCB1cmw6IHN0cmluZyA9IFV0aWwuaXNTdHJpbmcoZGVmaW5lZFVybCkgPyBkZWZpbmVkVXJsIDogdGhpcy53b3Jkcy5wYXRoO1xyXG4gICAgICAgIC8vIOWIpOaWreaYr+WQpumcgOimgXVybOa3u+WKoHBhcmFtc+WkhOeQhu+8iHJlc3RyaWN05Y+X6ZmQ57uE5Lu26ZyA55Wl6L+HIGlzc3Vlcy0jMTgzMO+8iVxyXG4gICAgICAgIGlmIChjb25maWdPYmouYWRkVXJsUGFyYW1zKSB7XHJcbiAgICAgICAgICAgIHVybCA9IFRwVXRpbC5hZGREZWZhdWx0UGFyYW0odXJsLCBwYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB3aW46IGFueSA9IHdpbmRvdy5vcGVuKHRoaXMuZG9tU2FuaXRpemVyLnNhbml0aXplKFNlY3VyaXR5Q29udGV4dC5VUkwsIHVybCksICdfYmxhbmsnKTtcclxuXHJcbiAgICAgICAgLy8gSUXmtY/op4jlmajkuIvvvIzmnInkupvlnLrmma/kuIt3aW5kb3cub3Blbigp5peg6L+U5Zue5YC85pe25LiN55So5aSE55CGXHJcbiAgICAgICAgaWYgKHdpbikge1xyXG4gICAgICAgICAgICAvLyDlpITnkIbmiZPlvIDkuIDkuKrmlrDnmoTmoIfnrb7vvIzmlrDmoIfnrb7kuK3nmoTpobXpnaLlpoLmnpzlrZjlnKjmgbbmhI/ku6PnoIHvvIzlsLHlj6/ku6XlsIbljp/nvZHnq5nnm7TmjqXlr7zoiKrliLDkuIDkuKromZrlgYfnvZHnq5nnmoTlronlhajmvI/mtJ5cclxuICAgICAgICAgICAgd2luLm9wZW5lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==