import { __awaiter } from "tslib";
import { EndpointsData, HttpService, LinksData, Mask, Message, StorageService, UserData } from '@cloud/cfdata';
import { TpDatePipe } from '../pipes/locale/TpLocaleModule';
//
/**
 * @ignore
 * 获取console相关的工具类
 * 兼容angular.js版本的console
 */
export class CfUtil {
    static getUser() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.isAngularJSConsole()) {
                return this.getFromAngularJSConsole('$rootScope');
            }
            const cfUserData = yield UserData.getCfUser();
            return cfUserData;
        });
    }
    static getLinks() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.isAngularJSConsole()) {
                return this.getFromAngularJSConsole('$rootScope');
            }
            const cfLinksData = yield LinksData.getLinks();
            return cfLinksData;
        });
    }
    static getEndpoints() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.isAngularJSConsole()) {
                return this.getFromAngularJSConsole('$rootScope');
            }
            const cfEndpointsData = yield EndpointsData.getCfEndpoints();
            return cfEndpointsData;
        });
    }
    static getHttpService() {
        if (this.isAngularJSConsole()) {
            return this.getFromAngularJSConsole('camel');
        }
        return HttpService;
    }
    static getMessage() {
        if (this.isAngularJSConsole()) {
            return this.getFromAngularJSConsole('msgService');
        }
        return Message;
    }
    static getMask() {
        if (this.isAngularJSConsole()) {
            return this.getFromAngularJSConsole('mask');
        }
        return Mask;
    }
    static getStorageService() {
        if (this.isAngularJSConsole()) {
            return this.getFromAngularJSConsole('storage');
        }
        return StorageService;
    }
    static formatLocaleDateTime(datetime) {
        if (this.isAngularJSConsole()) {
            const localeService = this.getFromAngularJSConsole('localeService');
            if (localeService && typeof localeService.formatLocaleDateTime === 'function') {
                return localeService.formatLocaleDateTime(datetime);
            }
            else {
                return datetime;
            }
        }
        return new TpDatePipe().transform(datetime, 'dateTimeZone');
    }
    static isNonsupportRegion() {
        if (this.isAngularJSConsole()) {
            const rootScope = this.getFromAngularJSConsole('$rootScope');
            return rootScope && rootScope.isNonsupportRegion;
        }
        return UserData.isNonsupportRegion;
    }
    static getAppWebPath() {
        // 兼容appWebPath(旧版)、AppWebPath(新版)
        let appWebPath = window.AppWebPath || window.appWebPath;
        // 去掉首尾的/符号
        appWebPath = appWebPath && appWebPath.replace(/^\//, '')
            .replace(/\/$/, '');
        return `/${appWebPath}`;
    }
    static isAngularJSConsole() {
        return !!window.angular;
    }
    static getFromAngularJSConsole(inject) {
        const html = window.angular.element('html');
        // 使用ng1+ng2 新融合方案时，Angular应用默认所在的根DOM元素为body
        const body = window.angular.element('body');
        if (html && html.injector()) {
            return html.injector().get(inject);
        }
        else if (body && body.injector()) {
            return body.injector().get(inject);
        }
        else {
            return;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2ZVdGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnlwbHVzMy9jZnV0aWxzL0NmVXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFnQyxhQUFhLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUN2RixjQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM1RCxFQUFFO0FBQ0Y7Ozs7R0FJRztBQUNILE1BQU0sT0FBTyxNQUFNO0lBQ1IsTUFBTSxDQUFPLE9BQU87O1lBQ3ZCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7Z0JBQzNCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3JEO1lBRUQsTUFBTSxVQUFVLEdBQVcsTUFBTSxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7WUFFdEQsT0FBTyxVQUFVLENBQUM7UUFDdEIsQ0FBQztLQUFBO0lBRU0sTUFBTSxDQUFPLFFBQVE7O1lBQ3hCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7Z0JBQzNCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3JEO1lBRUQsTUFBTSxXQUFXLEdBQVksTUFBTSxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFeEQsT0FBTyxXQUFXLENBQUM7UUFDdkIsQ0FBQztLQUFBO0lBRU0sTUFBTSxDQUFPLFlBQVk7O1lBQzVCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7Z0JBQzNCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3JEO1lBRUQsTUFBTSxlQUFlLEdBQWdCLE1BQU0sYUFBYSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBRTFFLE9BQU8sZUFBZSxDQUFDO1FBQzNCLENBQUM7S0FBQTtJQUVNLE1BQU0sQ0FBQyxjQUFjO1FBQ3hCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDaEQ7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDO0lBRU0sTUFBTSxDQUFDLFVBQVU7UUFDcEIsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtZQUMzQixPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUNyRDtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7SUFFTSxNQUFNLENBQUMsT0FBTztRQUNqQixJQUFJLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxFQUFFO1lBQzNCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQy9DO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxpQkFBaUI7UUFDM0IsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtZQUMzQixPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNsRDtRQUVELE9BQU8sY0FBYyxDQUFDO0lBQzFCLENBQUM7SUFFTSxNQUFNLENBQUMsb0JBQW9CLENBQUMsUUFBZ0M7UUFDL0QsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtZQUMzQixNQUFNLGFBQWEsR0FBUSxJQUFJLENBQUMsdUJBQXVCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDekUsSUFBSSxhQUFhLElBQUssT0FBTyxhQUFhLENBQUMsb0JBQW9CLEtBQUssVUFBVSxFQUFFO2dCQUM1RSxPQUFPLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN2RDtpQkFBTTtnQkFDSCxPQUFPLFFBQVEsQ0FBQzthQUNuQjtTQUNKO1FBRUQsT0FBTyxJQUFJLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVNLE1BQU0sQ0FBQyxrQkFBa0I7UUFDNUIsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtZQUMzQixNQUFNLFNBQVMsR0FBUSxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFbEUsT0FBTyxTQUFTLElBQUksU0FBUyxDQUFDLGtCQUFrQixDQUFDO1NBQ3BEO1FBRUQsT0FBTyxRQUFRLENBQUMsa0JBQWtCLENBQUM7SUFDdkMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxhQUFhO1FBQ3ZCLGtDQUFrQztRQUNsQyxJQUFJLFVBQVUsR0FBWSxNQUFjLENBQUMsVUFBVSxJQUFLLE1BQWMsQ0FBQyxVQUFVLENBQUM7UUFDbEYsV0FBVztRQUNYLFVBQVUsR0FBRyxVQUFVLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO2FBQ25ELE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFeEIsT0FBTyxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTyxNQUFNLENBQUMsa0JBQWtCO1FBQzdCLE9BQU8sQ0FBQyxDQUFFLE1BQWMsQ0FBQyxPQUFPLENBQUM7SUFDckMsQ0FBQztJQUVPLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxNQUFjO1FBQ2pELE1BQU0sSUFBSSxHQUFTLE1BQWMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFELDZDQUE2QztRQUM3QyxNQUFNLElBQUksR0FBUyxNQUFjLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUxRCxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDO2FBQU0sSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ2hDLE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN0QzthQUFNO1lBQ0gsT0FBTztTQUNWO0lBQ0wsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2ZFbmRwb2ludHMsIENmTGlua3MsIENmVXNlciwgRW5kcG9pbnRzRGF0YSwgSHR0cFNlcnZpY2UsIExpbmtzRGF0YSwgTWFzaywgTWVzc2FnZSxcclxuICAgIFN0b3JhZ2VTZXJ2aWNlLCBVc2VyRGF0YSB9IGZyb20gJ0BjbG91ZC9jZmRhdGEnO1xyXG5pbXBvcnQgeyBUcERhdGVQaXBlIH0gZnJvbSAnLi4vcGlwZXMvbG9jYWxlL1RwTG9jYWxlTW9kdWxlJztcclxuLy9cclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICog6I635Y+WY29uc29sZeebuOWFs+eahOW3peWFt+exu1xyXG4gKiDlhbzlrrlhbmd1bGFyLmpz54mI5pys55qEY29uc29sZVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENmVXRpbCB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGdldFVzZXIoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy5pc0FuZ3VsYXJKU0NvbnNvbGUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRGcm9tQW5ndWxhckpTQ29uc29sZSgnJHJvb3RTY29wZScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2ZVc2VyRGF0YTogQ2ZVc2VyID0gYXdhaXQgVXNlckRhdGEuZ2V0Q2ZVc2VyKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBjZlVzZXJEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0TGlua3MoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy5pc0FuZ3VsYXJKU0NvbnNvbGUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRGcm9tQW5ndWxhckpTQ29uc29sZSgnJHJvb3RTY29wZScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2ZMaW5rc0RhdGE6IENmTGlua3MgPSBhd2FpdCBMaW5rc0RhdGEuZ2V0TGlua3MoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNmTGlua3NEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0RW5kcG9pbnRzKCk6IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBbmd1bGFySlNDb25zb2xlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnJvbUFuZ3VsYXJKU0NvbnNvbGUoJyRyb290U2NvcGUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNmRW5kcG9pbnRzRGF0YTogQ2ZFbmRwb2ludHMgPSBhd2FpdCBFbmRwb2ludHNEYXRhLmdldENmRW5kcG9pbnRzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBjZkVuZHBvaW50c0RhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBnZXRIdHRwU2VydmljZSgpOiBhbnkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQW5ndWxhckpTQ29uc29sZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZyb21Bbmd1bGFySlNDb25zb2xlKCdjYW1lbCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIEh0dHBTZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TWVzc2FnZSgpOiBhbnkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQW5ndWxhckpTQ29uc29sZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZyb21Bbmd1bGFySlNDb25zb2xlKCdtc2dTZXJ2aWNlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gTWVzc2FnZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldE1hc2soKTogYW55IHtcclxuICAgICAgICBpZiAodGhpcy5pc0FuZ3VsYXJKU0NvbnNvbGUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRGcm9tQW5ndWxhckpTQ29uc29sZSgnbWFzaycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIE1hc2s7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBnZXRTdG9yYWdlU2VydmljZSgpOiBhbnkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQW5ndWxhckpTQ29uc29sZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZyb21Bbmd1bGFySlNDb25zb2xlKCdzdG9yYWdlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gU3RvcmFnZVNlcnZpY2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBmb3JtYXRMb2NhbGVEYXRlVGltZShkYXRldGltZTogc3RyaW5nIHwgbnVtYmVyIHwgRGF0ZSk6IGFueSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBbmd1bGFySlNDb25zb2xlKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxlU2VydmljZTogYW55ID0gdGhpcy5nZXRGcm9tQW5ndWxhckpTQ29uc29sZSgnbG9jYWxlU2VydmljZScpO1xyXG4gICAgICAgICAgICBpZiAobG9jYWxlU2VydmljZSAmJiAgdHlwZW9mIGxvY2FsZVNlcnZpY2UuZm9ybWF0TG9jYWxlRGF0ZVRpbWUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbGVTZXJ2aWNlLmZvcm1hdExvY2FsZURhdGVUaW1lKGRhdGV0aW1lKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBUcERhdGVQaXBlKCkudHJhbnNmb3JtKGRhdGV0aW1lLCAnZGF0ZVRpbWVab25lJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpc05vbnN1cHBvcnRSZWdpb24oKTogKG5vbnN1cHBvcnRSZWdpb25zOiBhbnksIHJlZ2lvbklkOiBhbnksIHN1cHBvcnRSZWdpb25zOiBhbnkpID0+IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQW5ndWxhckpTQ29uc29sZSgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3RTY29wZTogYW55ID0gdGhpcy5nZXRGcm9tQW5ndWxhckpTQ29uc29sZSgnJHJvb3RTY29wZScpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJvb3RTY29wZSAmJiByb290U2NvcGUuaXNOb25zdXBwb3J0UmVnaW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFVzZXJEYXRhLmlzTm9uc3VwcG9ydFJlZ2lvbjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldEFwcFdlYlBhdGgoKTogc3RyaW5nIHtcclxuICAgICAgICAvLyDlhbzlrrlhcHBXZWJQYXRoKOaXp+eJiCnjgIFBcHBXZWJQYXRoKOaWsOeJiClcclxuICAgICAgICBsZXQgYXBwV2ViUGF0aDogc3RyaW5nID0gKHdpbmRvdyBhcyBhbnkpLkFwcFdlYlBhdGggfHwgKHdpbmRvdyBhcyBhbnkpLmFwcFdlYlBhdGg7XHJcbiAgICAgICAgLy8g5Y675o6J6aaW5bC+55qEL+espuWPt1xyXG4gICAgICAgIGFwcFdlYlBhdGggPSBhcHBXZWJQYXRoICYmIGFwcFdlYlBhdGgucmVwbGFjZSgvXlxcLy8sICcnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwvJC8sICcnKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGAvJHthcHBXZWJQYXRofWA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgaXNBbmd1bGFySlNDb25zb2xlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhISh3aW5kb3cgYXMgYW55KS5hbmd1bGFyO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGdldEZyb21Bbmd1bGFySlNDb25zb2xlKGluamVjdDogc3RyaW5nKTogYW55IHtcclxuICAgICAgICBjb25zdCBodG1sOiBhbnkgPSAod2luZG93IGFzIGFueSkuYW5ndWxhci5lbGVtZW50KCdodG1sJyk7XHJcbiAgICAgICAgLy8g5L2/55SobmcxK25nMiDmlrDono3lkIjmlrnmoYjml7bvvIxBbmd1bGFy5bqU55So6buY6K6k5omA5Zyo55qE5qC5RE9N5YWD57Sg5Li6Ym9keVxyXG4gICAgICAgIGNvbnN0IGJvZHk6IGFueSA9ICh3aW5kb3cgYXMgYW55KS5hbmd1bGFyLmVsZW1lbnQoJ2JvZHknKTtcclxuXHJcbiAgICAgICAgaWYgKGh0bWwgJiYgaHRtbC5pbmplY3RvcigpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBodG1sLmluamVjdG9yKCkuZ2V0KGluamVjdCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChib2R5ICYmIGJvZHkuaW5qZWN0b3IoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYm9keS5pbmplY3RvcigpLmdldChpbmplY3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19