import { FormControl } from '@angular/forms';
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, Renderer2, ViewChild, NgZone } from '@angular/core';
import { TiFormComponent, TiTextareaComponent, TiTextComponent, Util } from '@cloud/tiny3';
/**
 * 可编辑文本组件，主要实现了编辑文本的功能。组件有两种状态：编辑状态和非编辑状态。
 * 在非编辑状态:点击右侧笔图标时，切换到编辑状态。
 * 在编辑状态:点击右侧对号图标时，切换到非编辑状态，
 * 并且将输入框中内容显示在非编辑状态的文本中;
 * 点击右侧叉图标时，切换到非编辑状态，非编辑状态的文本保持之前的不变，用户输入不生效。
 *
 * <example-url>../tinyplus3demo/#/labeleditor/labeleditor-all</example-url>
 */
// extends TiFormComponent
export class TpLabeleditorComponent extends TiFormComponent {
    constructor(elementRef, changeDetectorRef, renderer2, zone) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.changeDetectorRef = changeDetectorRef;
        this.renderer2 = renderer2;
        this.zone = zone;
        /**
         * 是否超出显示TIP
         */
        this.autoTip = true;
        /**
         * 用来调整文本框大小，该属性提供了四个属性值:
         *
         * none(不可调整组件大小):
         *
         * vertical(仅可调整垂直方向的大小，即调整组件的高度)
         *
         * horizontal(仅可调节水平方向的大小，即调整组件的宽度)
         *
         * both(水平和垂直方向均可调节，宽高都可调节)
         */
        this.resize = 'both';
        /**
         * 编辑事件接口
         */
        this.editor = new EventEmitter();
        /**
         * 确认事件接口
         */
        this.confirm = new EventEmitter();
        /**
         * 取消事件接口
         */
        this.cancel = new EventEmitter();
        /**
         * @ignore
         */
        this.isEditing = false; // 是否处于编辑状态
        /**
         * @ignore
         */
        this.emptyValue = '--'; // 内容为空时显示‘--’
        /**
         * @ignore
         */
        this.valueInvalid = false;
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        this.control = new FormControl(this.model, this.validationRules);
        // 校验提示tip默认top方向展开
        if (this.validation) {
            this.validation.tipPosition = Util.isUndefined(this.validation.tipPosition) ? 'top' :
                this.validation.tipPosition;
        }
        this.subscription = this.control.statusChanges.subscribe((status) => {
            this.valueInvalid = status === 'INVALID';
            this.changeDetectorRef.detectChanges();
        });
    }
    /**
     * @ignore
     */
    // tslint:disable-next-line:typedef
    ngOnModelChange() {
        if (this.model) {
            this.control.setValue(this.model.slice(0, this.maxlength));
        }
        else {
            this.control.setValue('');
        }
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    /**
     * @ignore
     * 点击编辑图标事件
     */
    onClickEdit() {
        if (this.disabled) {
            return;
        }
        this.isEditing = true;
        this.oldValue = this.model;
        this.editor.emit(this.model);
        if (this.model) {
            this.control.setValue(this.model.slice(0, this.maxlength));
        }
        setTimeout(() => {
            if (this.multiline) {
                this.textareaComp.nativeElement.focus();
                if (Util.isUndefined(this.maxlength)) {
                    this.renderer2.removeAttribute(this.textareaComp.nativeElement, 'maxlength');
                }
                else {
                    this.renderer2.setAttribute(this.textareaComp.nativeElement, 'maxlength', String(this.maxlength));
                }
            }
            else {
                this.textComp.nativeElement.focus();
            }
        }, 0);
    }
    /**
     * @ignore
     * 点击确认图标事件
     */
    onClickConfirm() {
        if (this.valueInvalid) {
            return;
        }
        this.isEditing = false;
        this.model = this.control.value;
        this.confirm.emit(this.model);
    }
    /**
     * @ignore
     * 点击取消图标事件
     */
    onClickCancel() {
        this.isEditing = false;
        this.cancel.emit(this.model);
        this.control.setValue(this.oldValue);
    }
}
TpLabeleditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-labeleditor',
                template: "<ng-container *ngIf=\"!isEditing\">\r\n  <ng-container *ngIf=\"autoTip\">\r\n      <span #edit (iconClick)='onClickEdit()'\r\n          [iconFocusable]=\"'true'\"\r\n          [iconDisabled] = \"disabled\"\r\n          [textContent]=\"model ? model : emptyValue\"\r\n          [iconTip]='iconTip'\r\n          [maxLine]='3'\r\n          [iconName]=\"'edit'\"\r\n          tiOverflow\r\n          (keydown.enter)=\"onClickEdit()\"\r\n          [id]=\"appendId('edit')\"></span>\r\n          <span style=\"display: none;\" class=\"ti3-icon\"></span>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"!autoTip\">\r\n    <span>{{ model ? model : emptyValue}}</span>\r\n    <tp-icon local tiOutline  (click)='onClickEdit()' [attr.tabindex]=\"disabled? -1 : 0\" (keydown.enter)=\"onClickEdit()\"\r\n    class='tp-editor-icon' name=\"cloud-action-edit\" [tiTip]='iconTip' tiTipPosition=\"auto\" [id]=\"appendId('edit')\"></tp-icon>\r\n  </ng-container>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"isEditing\">\r\n  <span *ngIf=\"multiline\" class='tp-textarea-container'>\r\n    <ng-container *ngIf='maxlength else noMaxlengthTemplate'>\r\n      <textarea\r\n              #textarea\r\n              tiTextarea\r\n              [ngStyle]=\"{'width': width, 'height': height}\"\r\n              [tiValidation]='validation'\r\n              [formControl]=\"control\"\r\n              [errorMessageWrapper]='wrapper'\r\n              [resize]='resize'\r\n              [id]=\"appendId('textarea')\"\r\n              maxlength='maxlength'>\r\n    </textarea>\r\n    </ng-container>\r\n    <ng-template #noMaxlengthTemplate>\r\n      <textarea\r\n              #textarea\r\n              tiTextarea\r\n              [ngStyle]=\"{'width': width,'height': height}\"\r\n              [tiValidation]='validation'\r\n              [formControl]=\"control\"\r\n              [errorMessageWrapper]='wrapper'\r\n              [id]=\"appendId('textarea')\"\r\n              [resize]='resize'>\r\n    </textarea>\r\n    </ng-template>\r\n  </span>\r\n  <span *ngIf=\"!multiline\">\r\n    <input type=\"text\"\r\n           #text\r\n           [tiValidation]='validation'\r\n           [formControl]=\"control\"\r\n           [errorMessageWrapper]='wrapper'\r\n           [id]=\"appendId('input')\"\r\n           tiText/>\r\n  </span>\r\n  <span [ngClass]=\"{'tp-labeleditor-icon-container': !multiline}\">\r\n    <span #confirmIcon>\r\n      <tp-icon local tiOutline name=\"cloud-action-confirm\" class=\"tp-labeleditor-icon tp-icon-confirm\"\r\n      [ngClass]=\"{'tp-confirm-disabled': valueInvalid}\" (click)='onClickConfirm()'\r\n      [id]=\"appendId('confirm')\" [attr.tabindex]=\"valueInvalid ? -1 : 0\"\r\n      (keydown.enter)=\"onClickConfirm()\"></tp-icon>\r\n    </span>\r\n      <tp-icon local tiOutline name=\"cloud-action-cancel\" class=\"tp-labeleditor-icon tp-icon-cancel\"\r\n      (click)='onClickCancel()' [attr.tabindex]=\"0\" (keydown.enter)=\"onClickCancel()\"\r\n      [id]=\"appendId('cancel')\"></tp-icon>\r\n  </span>\r\n  <span #wrapper class='tp-editor-errorMessageWrapper'></span>\r\n</ng-container>",
                providers: [TiFormComponent.getValueAccessor(TpLabeleditorComponent)],
                styles: [".tp-labeleditor-icon{cursor:pointer;line-height:28px;margin-left:var(--ti-common-space-2x);vertical-align:top}.tp-icon-confirm{color:var(--ti-common-color-success)}.tp-icon-cancel{color:var(--ti-common-color-error)}.tp-confirm-disabled.tp-icon-confirm{color:var(--ti-common-color-icon-disabled);cursor:not-allowed}.tp-labeleditor-container{display:inline-block;position:relative}.tp-textarea-container{display:inline-block}.tp-icon-container{bottom:0;position:absolute;right:var(--ti-common-space-base)}.tp-labeleditor-icon-container .tp-labeleditor-icon{vertical-align:middle}.tp-editor-icon,::ng-deep span[tiOverflowEndicon]{color:var(--ti-common-color-icon-normal);cursor:pointer;font-size:var(--ti-common-font-size-2);padding-left:var(--ti-common-space-2x)}.tp-editor-icon:hover,::ng-deep span[tiOverflowEndicon]:hover{color:var(--ti-common-color-icon-hover)}.tp-editor-errorMessageWrapper{display:inline-block;line-height:16px}:host[disabled] .tp-editor-icon,:host[disabled] ::ng-deep span[tiOverflowEndicon]{color:var(--ti-common-color-icon-disabled);cursor:not-allowed}:host{word-break:break-all;word-wrap:break-word}"]
            },] }
];
TpLabeleditorComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Renderer2 },
    { type: NgZone }
];
TpLabeleditorComponent.propDecorators = {
    autoTip: [{ type: Input }],
    multiline: [{ type: Input }],
    resize: [{ type: Input }],
    maxlength: [{ type: Input }],
    iconTip: [{ type: Input }],
    validation: [{ type: Input }],
    validationRules: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    editor: [{ type: Output }],
    confirm: [{ type: Output }],
    cancel: [{ type: Output }],
    textareaComp: [{ type: ViewChild, args: ['textarea', { static: false },] }],
    textComp: [{ type: ViewChild, args: ['text', { static: false },] }],
    confirmIconEle: [{ type: ViewChild, args: ['confirmIcon',] }],
    editEle: [{ type: ViewChild, args: ['edit', { static: false },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBMYWJlbGVkaXRvckNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy9sYWJlbGVkaXRvci9UcExhYmVsZWRpdG9yQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQWUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxRCxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFDVCxNQUFNLEVBRVQsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQXNCLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUUvRzs7Ozs7Ozs7R0FRRztBQU9ILDBCQUEwQjtBQUMxQixNQUFNLE9BQU8sc0JBQXVCLFNBQVEsZUFBZTtJQUN2RCxZQUNjLFVBQXNCLEVBQ3hCLGlCQUFvQyxFQUNsQyxTQUFvQixFQUN0QixJQUFZO1FBQ3BCLEtBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFKbkIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN4QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ2xDLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDdEIsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUd4Qjs7V0FFRztRQUNNLFlBQU8sR0FBWSxJQUFJLENBQUM7UUFLakM7Ozs7Ozs7Ozs7V0FVRztRQUNNLFdBQU0sR0FBZ0QsTUFBTSxDQUFDO1FBK0J0RTs7V0FFRztRQUNnQixXQUFNLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEU7O1dBRUc7UUFDZ0IsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ25FOztXQUVHO1FBQ2dCLFdBQU0sR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQWlCbEU7O1dBRUc7UUFDSSxjQUFTLEdBQVksS0FBSyxDQUFDLENBQUMsV0FBVztRQVM5Qzs7V0FFRztRQUNJLGVBQVUsR0FBVyxJQUFJLENBQUMsQ0FBQyxjQUFjO1FBS2hEOztXQUVHO1FBQ0ksaUJBQVksR0FBWSxLQUFLLENBQUM7SUF0R3JDLENBQUM7SUF3R0Qsb0RBQW9EO0lBQ3BELFFBQVE7UUFDSixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNqRSxtQkFBbUI7UUFDbkIsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JGLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1NBQy9CO1FBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFjLEVBQUUsRUFBRTtZQUN4RSxJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sS0FBSyxTQUFTLENBQUM7WUFDekMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNEOztPQUVHO0lBQ0gsbUNBQW1DO0lBQ25DLGVBQWU7UUFDWCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDWixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7U0FDOUQ7YUFBTTtZQUNILElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzdCO0lBQ0wsQ0FBQztJQUVELG9EQUFvRDtJQUNwRCxXQUFXO1FBQ1AsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25CLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDakM7SUFDUCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksV0FBVztRQUNkLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLE9BQU87U0FDVjtRQUVELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1osSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsVUFBVSxDQUFDLEdBQVMsRUFBRTtZQUNsQixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUN4QyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFO29CQUNsQyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztpQkFDaEY7cUJBQU07b0JBQ0gsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztpQkFDckc7YUFDSjtpQkFBTTtnQkFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUN2QztRQUNMLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNWLENBQUM7SUFDRDs7O09BR0c7SUFDSSxjQUFjO1FBQ2pCLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNuQixPQUFPO1NBQ1Y7UUFDRCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksYUFBYTtRQUNoQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7OztZQXZNSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsaWpHQUErQjtnQkFFL0IsU0FBUyxFQUFFLENBQUMsZUFBZSxDQUFDLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDLENBQUM7O2FBQ3hFOzs7WUExQkcsVUFBVTtZQUZWLGlCQUFpQjtZQU1qQixTQUFTO1lBRVQsTUFBTTs7O3NCQWlDTCxLQUFLO3dCQUlMLEtBQUs7cUJBWUwsS0FBSzt3QkFJTCxLQUFLO3NCQUlMLEtBQUs7eUJBSUwsS0FBSzs4QkFRTCxLQUFLO29CQUtMLEtBQUs7cUJBS0wsS0FBSztxQkFJTCxNQUFNO3NCQUlOLE1BQU07cUJBSU4sTUFBTTsyQkFJTixTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQzt1QkFJckMsU0FBUyxTQUFDLE1BQU0sRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7NkJBSWpDLFNBQVMsU0FBQyxhQUFhO3NCQUl2QixTQUFTLFNBQUMsTUFBTSxFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHtcclxuICAgIENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIElucHV0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgTmdab25lLFxyXG4gICAgQWZ0ZXJWaWV3Q2hlY2tlZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVGlGb3JtQ29tcG9uZW50LCBUaVRleHRhcmVhQ29tcG9uZW50LCBUaVRleHRDb21wb25lbnQsIFRpVmFsaWRhdGlvbkNvbmZpZywgVXRpbCB9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcblxyXG4vKipcclxuICog5Y+v57yW6L6R5paH5pys57uE5Lu277yM5Li76KaB5a6e546w5LqG57yW6L6R5paH5pys55qE5Yqf6IO944CC57uE5Lu25pyJ5Lik56eN54q25oCB77ya57yW6L6R54q25oCB5ZKM6Z2e57yW6L6R54q25oCB44CCXHJcbiAqIOWcqOmdnue8lui+keeKtuaAgTrngrnlh7vlj7PkvqfnrJTlm77moIfml7bvvIzliIfmjaLliLDnvJbovpHnirbmgIHjgIJcclxuICog5Zyo57yW6L6R54q25oCBOueCueWHu+WPs+S+p+WvueWPt+Wbvuagh+aXtu+8jOWIh+aNouWIsOmdnue8lui+keeKtuaAge+8jFxyXG4gKiDlubbkuJTlsIbovpPlhaXmoYbkuK3lhoXlrrnmmL7npLrlnKjpnZ7nvJbovpHnirbmgIHnmoTmlofmnKzkuK07XHJcbiAqIOeCueWHu+WPs+S+p+WPieWbvuagh+aXtu+8jOWIh+aNouWIsOmdnue8lui+keeKtuaAge+8jOmdnue8lui+keeKtuaAgeeahOaWh+acrOS/neaMgeS5i+WJjeeahOS4jeWPmO+8jOeUqOaIt+i+k+WFpeS4jeeUn+aViOOAglxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueXBsdXMzZGVtby8jL2xhYmVsZWRpdG9yL2xhYmVsZWRpdG9yLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndHAtbGFiZWxlZGl0b3InLFxyXG4gICAgdGVtcGxhdGVVcmw6ICdsYWJlbGVkaXRvci5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2xhYmVsZWRpdG9yLmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRwTGFiZWxlZGl0b3JDb21wb25lbnQpXVxyXG59KVxyXG4vLyBleHRlbmRzIFRpRm9ybUNvbXBvbmVudFxyXG5leHBvcnQgY2xhc3MgVHBMYWJlbGVkaXRvckNvbXBvbmVudCBleHRlbmRzIFRpRm9ybUNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBwcm90ZWN0ZWQgcmVuZGVyZXIyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUpIHtcclxuICAgICAgICBzdXBlcihlbGVtZW50UmVmLCByZW5kZXJlcjIpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbotoXlh7rmmL7npLpUSVBcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgYXV0b1RpcDogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuS4uuWkmuihjOaWh+acrOe8lui+kVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBtdWx0aWxpbmU6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIOeUqOadpeiwg+aVtOaWh+acrOahhuWkp+Wwj++8jOivpeWxnuaAp+aPkOS+m+S6huWbm+S4quWxnuaAp+WAvDpcclxuICAgICAqXHJcbiAgICAgKiBub25lKOS4jeWPr+iwg+aVtOe7hOS7tuWkp+Wwjyk6XHJcbiAgICAgKlxyXG4gICAgICogdmVydGljYWwo5LuF5Y+v6LCD5pW05Z6C55u05pa55ZCR55qE5aSn5bCP77yM5Y2z6LCD5pW057uE5Lu255qE6auY5bqmKVxyXG4gICAgICpcclxuICAgICAqIGhvcml6b250YWwo5LuF5Y+v6LCD6IqC5rC05bmz5pa55ZCR55qE5aSn5bCP77yM5Y2z6LCD5pW057uE5Lu255qE5a695bqmKVxyXG4gICAgICpcclxuICAgICAqIGJvdGgo5rC05bmz5ZKM5Z6C55u05pa55ZCR5Z2H5Y+v6LCD6IqC77yM5a696auY6YO95Y+v6LCD6IqCKVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSByZXNpemU6ICdub25lJyB8ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCcgfCAnYm90aCcgPSAnYm90aCc7XHJcbiAgICAvKipcclxuICAgICAqIOaYvuekuuaWh+acrGxlbmd0aFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBtYXhsZW5ndGg6IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog57yW6L6R5Zu+5qCHVGlw5YaF5a65XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGljb25UaXA6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6YWN572u5qCh6aqM55u45YWz5L+h5oGv77yM6K+m6KeB5o6l5Y+jVGlWYWxpZGF0aW9uQ29uZmlnXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHZhbGlkYXRpb246IFRpVmFsaWRhdGlvbkNvbmZpZztcclxuICAgIC8qKlxyXG4gICAgICog55So5oi36Ieq5a6a5LmJ5qCh6aqM6KeE5YiZXHJcbiAgICAgKlxyXG4gICAgICog5o6l5Y+j5YC86KKr5b2T5L2cbmV3IEZvcm1Db250cm9sKCnnmoTnrKzkuozkuKrlj4LmlbBcclxuICAgICAqXHJcbiAgICAgKiDmjqXlj6PnsbvlnovkuI5uZXcgRm9ybUNvbnRyb2woKeeahOesrOS6jOS4quWPguaVsOagvOW8j+S4gOiHtO+8jOivpuaDheWPguiAg2FuZ3VsYXLooajljZXpg6jliIZcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdmFsaWRhdGlvblJ1bGVzOiBBcnJheTxWYWxpZGF0b3JGbj47XHJcbiAgICAvKipcclxuICAgICAqIOaWsOWinjEwLjEuMlxyXG4gICAgICog55So5p2l6YWN572u5paH5pys5qGG55qE5a69XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHdpZHRoOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOaWsOWinjEwLjEuMlxyXG4gICAgICog55So5p2l6YWN572u5paH5pys5qGG55qE6auYXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGhlaWdodDogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnvJbovpHkuovku7bmjqXlj6NcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IGVkaXRvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKipcclxuICAgICAqIOehruiupOS6i+S7tuaOpeWPo1xyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgY29uZmlybTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKipcclxuICAgICAqIOWPlua2iOS6i+S7tuaOpeWPo1xyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgY2FuY2VsOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCd0ZXh0YXJlYScsIHtzdGF0aWM6IGZhbHNlfSkgdGV4dGFyZWFDb21wOiBUaVRleHRhcmVhQ29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ3RleHQnLCB7c3RhdGljOiBmYWxzZX0pIHRleHRDb21wOiBUaVRleHRDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnY29uZmlybUljb24nKSBjb25maXJtSWNvbkVsZTogRWxlbWVudFJlZjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCdlZGl0Jywge3N0YXRpYzogZmFsc2V9KSBlZGl0RWxlOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0VkaXRpbmc6IGJvb2xlYW4gPSBmYWxzZTsgLy8g5piv5ZCm5aSE5LqO57yW6L6R54q25oCBXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHZhbHVlOiBzdHJpbmc7IC8vIHZhbHVl5YaF5a65XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9sZFZhbHVlOiBzdHJpbmc7IC8vIHZhbHVl5YaF5a65XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGVtcHR5VmFsdWU6IHN0cmluZyA9ICctLSc7IC8vIOWGheWuueS4uuepuuaXtuaYvuekuuKAmC0t4oCZXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGNvbnRyb2w6IEZvcm1Db250cm9sO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB2YWx1ZUludmFsaWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbCA9IG5ldyBGb3JtQ29udHJvbCh0aGlzLm1vZGVsLCB0aGlzLnZhbGlkYXRpb25SdWxlcyk7XHJcbiAgICAgICAgLy8g5qCh6aqM5o+Q56S6dGlw6buY6K6kdG9w5pa55ZCR5bGV5byAXHJcbiAgICAgICAgaWYgKHRoaXMudmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRpb24udGlwUG9zaXRpb24gPSBVdGlsLmlzVW5kZWZpbmVkKHRoaXMudmFsaWRhdGlvbi50aXBQb3NpdGlvbikgPyAndG9wJyA6XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGlvbi50aXBQb3NpdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLmNvbnRyb2wuc3RhdHVzQ2hhbmdlcy5zdWJzY3JpYmUoKHN0YXR1czogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWVJbnZhbGlkID0gc3RhdHVzID09PSAnSU5WQUxJRCc7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0eXBlZGVmXHJcbiAgICBuZ09uTW9kZWxDaGFuZ2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHRoaXMubW9kZWwuc2xpY2UoMCwgdGhpcy5tYXhsZW5ndGgpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoJycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeCueWHu+e8lui+keWbvuagh+S6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja0VkaXQoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pc0VkaXRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLm1vZGVsO1xyXG4gICAgICAgIHRoaXMuZWRpdG9yLmVtaXQodGhpcy5tb2RlbCk7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHRoaXMubW9kZWwuc2xpY2UoMCwgdGhpcy5tYXhsZW5ndGgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0VGltZW91dCgoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm11bHRpbGluZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0YXJlYUNvbXAubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFV0aWwuaXNVbmRlZmluZWQodGhpcy5tYXhsZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlcjIucmVtb3ZlQXR0cmlidXRlKHRoaXMudGV4dGFyZWFDb21wLm5hdGl2ZUVsZW1lbnQsICdtYXhsZW5ndGgnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlcjIuc2V0QXR0cmlidXRlKHRoaXMudGV4dGFyZWFDb21wLm5hdGl2ZUVsZW1lbnQsICdtYXhsZW5ndGgnLCBTdHJpbmcodGhpcy5tYXhsZW5ndGgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dENvbXAubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeCueWHu+ehruiupOWbvuagh+S6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja0NvbmZpcm0oKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMudmFsdWVJbnZhbGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm1vZGVsID0gdGhpcy5jb250cm9sLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuY29uZmlybS5lbWl0KHRoaXMubW9kZWwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDngrnlh7vlj5bmtojlm77moIfkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2tDYW5jZWwoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNhbmNlbC5lbWl0KHRoaXMubW9kZWwpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZSh0aGlzLm9sZFZhbHVlKTtcclxuICAgIH1cclxufVxyXG4iXX0=