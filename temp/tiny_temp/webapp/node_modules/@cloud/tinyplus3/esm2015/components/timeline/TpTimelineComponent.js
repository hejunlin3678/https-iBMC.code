// tslint:disable-next-line:no-implicit-dependencies
import { Component, ContentChild, Input, TemplateRef } from '@angular/core';
import { TiBaseComponent, Util } from '@cloud/tiny3';
/**
 * 时间线timeline组件
 * <example-url>../tinyplus3demo/#/timeline/timeline-all</example-url>
 */
export class TpTimelineComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 当前激活项（正在进行时）
         * 10.1.4新增
         */
        this.activeIndex = -1;
        /**
         * @ignore
         * 时间轴一级信息集合
         */
        this.titleOptions = [];
    }
    ngOnInit() {
        super.ngOnInit();
        this.titleOptions = this.getTitleOptions();
        this.changeToSuccess();
    }
    ngOnChanges(changes) {
        if (changes['activeIndex'] && !changes['activeIndex'].firstChange) {
            this.changeToSuccess();
        }
        if (changes['options'] && !changes['options'].firstChange) {
            this.titleOptions = this.getTitleOptions();
        }
    }
    /**
     * @ignore
     */
    findItemIndex(item) {
        return this.titleOptions.findIndex((ele) => ele === item);
    }
    /**
     * @ignore
     * 获取时间轴一级（标题）信息集合
     */
    getTitleOptions() {
        return this.options.filter((option) => option.isTitle);
    }
    /**
     * @ignore
     * activeIndex之前的项全部变更为success状态
     */
    changeToSuccess() {
        if (this.activeIndex === -1 || Util.isUndefined(this.activeIndex) || !Util.isNumber(this.activeIndex)) {
            return;
        }
        this.options.forEach((option, index) => {
            option.type = index < this.activeIndex ? 'success' : 'primary';
        });
    }
    /**
     * @ignore
     * 判断当前一级时间轴状态
     */
    isSuccess(option) {
        if (!option.isTitle) {
            return;
        }
        let level2Options = [];
        const index = this.options.findIndex((item) => item === option);
        let isSucess = true;
        for (let i = index + 1; i <= this.activeIndex; i++) {
            if (this.options[i] && this.options[i].isTitle) {
                break;
            }
            level2Options.push(this.options[i]);
        }
        if (level2Options.length > 0) {
            level2Options.forEach((option) => {
                if (option.type && option.type !== 'success') {
                    isSucess = false;
                }
            });
        }
        return isSucess;
    }
}
TpTimelineComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-timeline',
                template: "<ul [id]=\"appendId('list')\" [ngClass]=\"{'tp-timeline-multistage': titleOptions.length > 0}\">\r\n    <li *ngFor='let item of options; index as i' class=\"tp-timeline-container\" [ngClass]=\"{'tp-timeline-completed': item.type === 'success'}\">\r\n        <span class='tp-timeline-label' [id]=\"appendId('label_' + i)\"\r\n            [ngClass]= \"{'tp-timeline-info': item.type === 'info',\r\n            'tp-timeline-success': item.type === 'success',\r\n            'tp-timeline-warning': item.type === 'warning',\r\n            'tp-timeline-danger': item.type === 'danger',\r\n            'tp-timeline-currentStep': i === activeIndex}\">\r\n                <span *ngIf=\"item.isTitle\" class=\"tp-timeline-level1\"\r\n                    [ngClass]=\"{'tp-timeline-level1-success': item.type === 'success',\r\n                    'tp-timeline-processing': !isSuccess(item)}\">\r\n                        <span *ngIf=\"item.type !== 'success' || !isSuccess(item)\">{{findItemIndex(item) + 1}}</span>\r\n                        <tp-icon *ngIf=\"item.type === 'success' && isSuccess(item)\" name=\"cloud-action-checkmark-1\"></tp-icon>\r\n                </span>\r\n                <ng-container *ngTemplateOutlet=\"itemTemplate?itemTemplate:defaultItemTemplate;context: {$implicit: item, index: i}\"></ng-container>\r\n        </span>\r\n    </li>\r\n</ul>\r\n\r\n<ng-template #defaultItemTemplate let-item let-i=index>\r\n    <div class=\"tp-timeline-label-container\">\r\n        <span [ngClass]=\"{'tp-timeline-active': i === activeIndex,\r\n                      'tp-timeline-active-danger': i === activeIndex && item.type === 'danger',\r\n                      'tp-timeline-label-level1': item.isTitle}\">{{item.label}}</span>\r\n        <tp-icon local name=\"cloud-action-tip\" *ngIf=\"item.iconTip\" [tiTip]=\"item.iconTip\"\r\n        [tiTipPosition]=\"item.iconTipPosition\"\r\n        [tiTipMaxWidth]=\"item.iconTipMaxWidth\" class=\"tp-timeline-icontip\"></tp-icon>\r\n        <span *ngIf=\"titleOptions.length > 0\">\r\n            <span class='tp-timeline-time' *ngIf=\"item.time && item.type === 'success'\" [ngClass]=\"{'tp-timeline-time-level2': !item.isTitle}\">{{item.time}}</span>\r\n        </span>\r\n    </div>\r\n    <span *ngIf=\"titleOptions.length <= 0\" class='tp-timeline-time'>{{item.time}}</span>\r\n    <div *ngIf=\"item.type === 'danger'\">\r\n        <ng-container *ngTemplateOutlet=\"errorMessageTemplate; context: {$implicit: item}\"></ng-container>\r\n    </div>\r\n</ng-template>\r\n<!-- \u05B4\uFFFD\uFFFD\u02A7\uFFFD\u0723\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u03E2 -->\r\n<ng-template #errorMessageTemplate  let-item>\r\n    <span class=\"tp-timeline-errorMessagg\" [innerHTML]=\"item.errorMessage\"></span>\r\n</ng-template>",
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}::ng-deep :root{--tp-timeline-badge-width:8px;--tp-timeline-color-success:var(--ti-common-color-success);--tp-timeline-errorMsg-color:var(--ti-common-color-error-text);--tp-timeline-errorMsg-color-dark:var(--ti-common-color-error);--tp-timeline-label-lineHeight:calc(var(--ti-common-font-size-base)*var(--ti-common-line-height-number));--tp-timeline-line-color:var(--ti-common-color-line-dividing);--tp-timeline-line-color-dark:var(--ti-common-color-line-normal);--tp-timeline-line-width:1px;--tp-timeline-text-color-success:var(--ti-common-color-text-success)}.tp-timeline-container{padding-bottom:calc(var(--ti-common-space-5x));position:relative}.tp-timeline-container:after{background-color:var(--ti-common-color-line-disabled);content:\"\";height:calc(100% - var(--tp-timeline-badge-width));left:calc(-1*var(--tp-timeline-line-width)/2);position:absolute;top:calc((var(--tp-timeline-label-lineHeight) + var(--tp-timeline-badge-width))/2);width:var(--tp-timeline-line-width)}.tp-timeline-container:last-child{padding-bottom:0}.tp-timeline-container:last-child:after{display:none}.tp-timeline-multistage .tp-timeline-container.tp-timeline-completed:after{background-color:var(--tp-timeline-color-success)}.tp-timeline-label{color:var(--ti-common-color-text-primary);display:block;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);padding-left:var(--ti-common-space-5x);position:relative;word-wrap:break-word}.tp-timeline-label:before{background-color:var(--tp-timeline-line-color);border-radius:50%;content:\"\";height:var(--tp-timeline-badge-width);left:calc(-1*var(--tp-timeline-badge-width)/2);position:absolute;top:calc((var(--tp-timeline-label-lineHeight) - var(--tp-timeline-badge-width))/2);width:var(--tp-timeline-badge-width);z-index:1}.tp-timeline-multistage{padding-left:var(--ti-common-space-2x)}.tp-timeline-multistage .tp-timeline-label{color:var(--ti-common-color-text-weaken)}.tp-timeline-multistage .tp-timeline-success{color:var(--ti-common-color-text-primary)}.tp-timeline-multistage .tp-timeline-time-level2{display:inline-block;padding-left:var(--ti-common-space-3x)}.tp-timeline-currentStep:before{background-clip:content-box;background-color:var(--tp-timeline-color-success);border:2px solid rgba(80,212,171,.2);left:calc(-1*var(--tp-timeline-badge-width)/2 - 2px)}.tp-timeline-multistage .tp-timeline-danger:before{background-color:var(--tp-timeline-errorMsg-color);border:2px solid rgba(222,80,78,.2)}.tp-timeline-info:before{background-color:var(--ti-common-color-prompt);border-color:var(--ti-common-color-prompt)}.tp-timeline-success:before{background-color:var(--ti-common-color-success);border-color:var(--ti-common-color-success)}.tp-timeline-warning:before{background-color:var(--ti-common-color-warn);border-color:var(--ti-common-color-warn)}.tp-timeline-danger:before{background-color:var(--ti-common-color-error);border-color:var(--ti-common-color-error)}.tp-timeline-time{color:var(--ti-common-color-text-weaken);display:block;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);white-space:pre}.tp-timeline-active{color:var(--tp-timeline-text-color-success)}.tp-timeline-active-danger{color:var(--tp-timeline-errorMsg-color)}.tp-timeline-level1{background-color:var(--ti-common-color-bg-white-normal);border:1px solid var(--ti-common-color-text-weaken);border-radius:50%;color:var(--ti-common-color-text-weaken);display:inline-block;height:14px;left:-8px;line-height:1;position:absolute;text-align:center;top:4px;width:14px;z-index:1}.tp-timeline-level1-success{border-color:var(--tp-timeline-color-success);color:var(--tp-timeline-color-success)}.tp-timeline-processing{background:var(--tp-timeline-color-success);color:var(--ti-common-color-bg-white-normal)}.tp-timeline-errorMessagg{color:var(--tp-timeline-errorMsg-color);padding-top:var(--ti-common-space-base)}.tp-timeline-label-level1{font-size:var(--ti-common-font-size-1)}.tp-timeline-label-container{align-items:center;display:flex}.tp-timeline-icontip{color:var(--ti-common-color-icon-normal);font-size:var(--ti-common-font-size-2);padding-left:var(--ti-common-space-2x);vertical-align:bottom}:host[dark] .tp-timeline-container:after{background:var(--tp-timeline-line-color-dark)}:host[dark] .tp-timeline-label{color:var(--tp-timeline-line-color-dark)}:host[dark] .tp-timeline-label:before{background:var(--tp-timeline-line-color-dark)}:host[dark] .tp-timeline-level1{background-color:var(--ti-common-color-bg-dark-normal);border-color:var(--tp-timeline-line-color-dark);color:var(--tp-timeline-line-color-dark)}:host[dark] .tp-timeline-level1.tp-timeline-level1-success{border-color:var(--tp-timeline-color-success);color:var(--tp-timeline-color-success)}:host[dark] .tp-timeline-currentStep:before,:host[dark] .tp-timeline-success:before{background:var(--tp-timeline-color-success);background-clip:content-box}:host[dark] .tp-timeline-currentStep.tp-timeline-danger:before{background:var(--tp-timeline-errorMsg-color-dark);background-clip:content-box;border:2px solid rgba(246,111,106,.2)}:host[dark] .tp-timeline-active-danger,:host[dark] .tp-timeline-errorMessagg{color:var(--tp-timeline-errorMsg-color-dark)}:host[dark] .tp-timeline-time{color:var(--tp-timeline-line-color-dark)}:host[dark] .tp-timeline-success{color:var(--ti-common-color-bg-white-normal)}:host[dark] .tp-timeline-level1.tp-timeline-processing{background-color:var(--tp-timeline-color-success);color:var(--ti-common-color-bg-white-normal)}:host[dark] .tp-timeline-icontip{display:none}"]
            },] }
];
TpTimelineComponent.propDecorators = {
    options: [{ type: Input }],
    activeIndex: [{ type: Input }],
    itemTemplate: [{ type: ContentChild, args: ['item', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBUaW1lbGluZUNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy90aW1lbGluZS9UcFRpbWVsaW5lQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG9EQUFvRDtBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWlCLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQXlDckQ7OztHQUdHO0FBT0gsTUFBTSxPQUFPLG1CQUFvQixTQUFRLGVBQWU7SUFOeEQ7O1FBV0k7OztXQUdHO1FBQ00sZ0JBQVcsR0FBVyxDQUFDLENBQUMsQ0FBQztRQUtsQzs7O1dBR0c7UUFDSSxpQkFBWSxHQUFHLEVBQUUsQ0FBQztJQW1FN0IsQ0FBQztJQWpFRyxRQUFRO1FBQ0osS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBQ0QsV0FBVyxDQUFDLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLFdBQVcsRUFBRTtZQUMvRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUU7WUFDdkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDOUM7SUFDTCxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxhQUFhLENBQUMsSUFBc0I7UUFDdkMsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBRSxDQUFDLEdBQXFCLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsQ0FBQztJQUNqRixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksZUFBZTtRQUNsQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFFLENBQUMsTUFBd0IsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFDRDs7O09BR0c7SUFDSSxlQUFlO1FBQ2xCLElBQUksSUFBSSxDQUFDLFdBQVcsS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ25HLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFHLENBQUMsTUFBd0IsRUFBRSxLQUFhLEVBQUUsRUFBRTtZQUMvRCxNQUFNLENBQUMsSUFBSSxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFDRDs7O09BR0c7SUFDSSxTQUFTLENBQUMsTUFBd0I7UUFDckMsSUFBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDaEIsT0FBTztTQUNWO1FBQ0QsSUFBSSxhQUFhLEdBQTRCLEVBQUUsQ0FBQztRQUNoRCxNQUFNLEtBQUssR0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQXNCLEVBQUUsRUFBRSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQztRQUMxRixJQUFJLFFBQVEsR0FBWSxJQUFJLENBQUM7UUFDN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2hELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRTtnQkFDNUMsTUFBTTthQUNUO1lBQ0QsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdkM7UUFDRCxJQUFJLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzFCLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUF3QixFQUFFLEVBQUU7Z0JBQy9DLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtvQkFDMUMsUUFBUSxHQUFHLEtBQUssQ0FBQztpQkFDcEI7WUFDTCxDQUFDLENBQUMsQ0FBQTtTQUNMO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQzs7O1lBMUZKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsaXVGQUE4Qjs7YUFFakM7OztzQkFNSSxLQUFLOzBCQUtMLEtBQUs7MkJBSUwsWUFBWSxTQUFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW1wbGljaXQtZGVwZW5kZW5jaWVzXHJcbmltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBJbnB1dCwgU2ltcGxlQ2hhbmdlcywgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlCYXNlQ29tcG9uZW50LCBVdGlsIH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuZXhwb3J0IGludGVyZmFjZSBUcFRpbWVsaW5lT3B0aW9uIHtcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5pe26Ze06L205p2h55uu5a+55bqU55qE6L205b+D5qCH6K+G77yM5LiN5ZCM54q25oCB5a+55bqU55qE5qCH6K+G6aKc6Imy5LiN5LiA5qC3XHJcbiAgICAgKi9cclxuICAgIHR5cGU/OiAnaW5mbycgfCAnc3VjY2VzcycgfCAnZGFuZ2VyJyB8ICdwcmltYXJ5JyB8ICd3YXJuaW5nJztcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5pe26Ze06L205p2h55uu55qE5paH5pys44CCXHJcbiAgICAgKi9cclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruaXtumXtOi9tOeahOaXtumXtOOAglxyXG4gICAgICovXHJcbiAgICB0aW1lPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbkuLrml7bpl7TovbTmoIfpophcclxuICAgICAqIDEwLjEuNOaWsOWinlxyXG4gICAgICovXHJcbiAgICBpc1RpdGxlPzogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICog5omn6KGM5aSx6LSl6ZSZ6K+v5L+h5oGvXHJcbiAgICAgKiAxMC4xLjTmlrDlop5cclxuICAgICAqL1xyXG4gICAgZXJyb3JNZXNzYWdlPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDml7bpl7TovbTpl67lj7d0aXDmj5DnpLpcclxuICAgICAqIDEwLjEuNOaWsOWinlxyXG4gICAgICovXHJcbiAgICBpY29uVGlwPzogIHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT4gfCBhbnk7XHJcbiAgICAvKipcclxuICAgICAqIHRpcOaWueWQkVxyXG4gICAgICogMTAuMS405paw5aKeXHJcbiAgICAgKi9cclxuICAgIGljb25UaXBQb3NpdGlvbj86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICogdGlw5pyA5aSn5a695bqmXHJcbiAgICAgKiAxMC4xLjTmlrDlop5cclxuICAgICAqL1xyXG4gICAgaWNvblRpcE1heFdpZHRoPzogc3RyaW5nO1xyXG5cclxufVxyXG4vKipcclxuICog5pe26Ze057q/dGltZWxpbmXnu4Tku7ZcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy90aW1lbGluZS90aW1lbGluZS1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RwLXRpbWVsaW5lJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi90aW1lbGluZS5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3RpbWVsaW5lLmxlc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFRwVGltZWxpbmVDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiDml7bpl7TovbTphY3nva7pobnmgLvmjqXlj6NcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgb3B0aW9uczogQXJyYXk8VHBUaW1lbGluZU9wdGlvbj47XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjea/gOa0u+mhue+8iOato+WcqOi/m+ihjOaXtu+8iVxyXG4gICAgICogMTAuMS405paw5aKeXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGFjdGl2ZUluZGV4OiBudW1iZXIgPSAtMTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAQ29udGVudENoaWxkKCdpdGVtJywgeyBzdGF0aWM6IHRydWUgfSkgaXRlbVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDml7bpl7TovbTkuIDnuqfkv6Hmga/pm4blkIhcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRpdGxlT3B0aW9ucyA9IFtdO1xyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy50aXRsZU9wdGlvbnMgPSB0aGlzLmdldFRpdGxlT3B0aW9ucygpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlVG9TdWNjZXNzKCk7XHJcbiAgICB9XHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXNbJ2FjdGl2ZUluZGV4J10gJiYgIWNoYW5nZXNbJ2FjdGl2ZUluZGV4J10uZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VUb1N1Y2Nlc3MoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoYW5nZXNbJ29wdGlvbnMnXSAmJiAhY2hhbmdlc1snb3B0aW9ucyddLmZpcnN0Q2hhbmdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGVPcHRpb25zID0gdGhpcy5nZXRUaXRsZU9wdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGZpbmRJdGVtSW5kZXgoaXRlbTogVHBUaW1lbGluZU9wdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRpdGxlT3B0aW9ucy5maW5kSW5kZXgoIChlbGU6IFRwVGltZWxpbmVPcHRpb24pID0+IGVsZSA9PT0gaXRlbSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiOt+WPluaXtumXtOi9tOS4gOe6p++8iOagh+mimO+8ieS/oeaBr+mbhuWQiFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0VGl0bGVPcHRpb25zKCkgOiBBcnJheTxUcFRpbWVsaW5lT3B0aW9uPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5maWx0ZXIoIChvcHRpb246IFRwVGltZWxpbmVPcHRpb24pID0+IG9wdGlvbi5pc1RpdGxlKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogYWN0aXZlSW5kZXjkuYvliY3nmoTpobnlhajpg6jlj5jmm7TkuLpzdWNjZXNz54q25oCBXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjaGFuZ2VUb1N1Y2Nlc3MoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlSW5kZXggPT09IC0xIHx8IFV0aWwuaXNVbmRlZmluZWQodGhpcy5hY3RpdmVJbmRleCkgfHwgIVV0aWwuaXNOdW1iZXIodGhpcy5hY3RpdmVJbmRleCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCAoIChvcHRpb246IFRwVGltZWxpbmVPcHRpb24sIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgb3B0aW9uLnR5cGUgPSBpbmRleCA8IHRoaXMuYWN0aXZlSW5kZXggPyAnc3VjY2VzcycgOiAncHJpbWFyeSc7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Yik5pat5b2T5YmN5LiA57qn5pe26Ze06L2054q25oCBXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc1N1Y2Nlc3Mob3B0aW9uOiBUcFRpbWVsaW5lT3B0aW9uKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYoIW9wdGlvbi5pc1RpdGxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGxldmVsMk9wdGlvbnM6IEFycmF5PFRwVGltZWxpbmVPcHRpb24+ID0gW107XHJcbiAgICAgICAgY29uc3QgaW5kZXg6IG51bWJlciA9IHRoaXMub3B0aW9ucy5maW5kSW5kZXgoKGl0ZW06IFRwVGltZWxpbmVPcHRpb24pID0+IGl0ZW0gPT09IG9wdGlvbik7XHJcbiAgICAgICAgbGV0IGlzU3VjZXNzOiBib29sZWFuID0gdHJ1ZTtcclxuICAgICAgICBmb3IgKGxldCBpID0gaW5kZXggKyAxOyBpIDw9IHRoaXMuYWN0aXZlSW5kZXg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zW2ldICYmIHRoaXMub3B0aW9uc1tpXS5pc1RpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXZlbDJPcHRpb25zLnB1c2godGhpcy5vcHRpb25zW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxldmVsMk9wdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsZXZlbDJPcHRpb25zLmZvckVhY2goKG9wdGlvbjogVHBUaW1lbGluZU9wdGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbi50eXBlICYmIG9wdGlvbi50eXBlICE9PSAnc3VjY2VzcycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpc1N1Y2VzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGlzU3VjZXNzO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==