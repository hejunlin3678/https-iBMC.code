import { Component, ElementRef, Input, Renderer2 } from '@angular/core';
import { TiBaseComponent, TiLocale, Util } from '@cloud/tiny3';
import { CfUtil } from '../../cfutils/CfUtil';
import { TpUtil } from './../../utils/TpUtil';
/**
 * 满意度调查组件
 *
 * 10.0.3版本新增
 *
 * <example-url>../tinyplus3demo/#/contactsurvey/contactsurvey-all</example-url>
 */
export class TpContactsurveyComponent extends TiBaseComponent {
    constructor(elementRef, renderer2) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        /**
         * @ignore
         * 是否显示满意度调查组件，默认不显示。符合某些条件才会展示出来。
         */
        this.showContactsurvey = false;
        /**
         * @ignore
         * 控制提交按钮是否禁用，默认为禁用
         */
        this.submitDisabled = true;
        /**
         * @ignore
         * 国际化词条对象
         */
        this.tpContactsurvey = TiLocale.getLocaleWords().tpContactsurvey;
        /**
         * @ignore
         * 模板中展示的题目
         */
        this.displayData = [];
        /**
         * @ignore
         * 用户反馈的答案
         */
        this.submitAnswer = [];
        /**
         * 类生产环境的请求数据
         */
        this.devConfig = {
            backend: 'https://console.ulanqab.huawei.com/nps-api',
            surveyId: 'hwcloudbusurvey_key_fbd25bdbdb89'
        };
        /**
         * 现网环境的请求数据
         */
        this.prodConfig = {
            backend: 'https://voc.huaweicloud.com/survey-api',
            surveyId: 'hwcloudbusurvey_key_fbd25bdbdb89'
        };
        /**
         * 用户ID，作为用户的唯一标识
         */
        this.userId = '';
        /**
         * 默认为类生产环境配置
         */
        this.config = this.devConfig;
        if (location.hostname.indexOf('huaweicloud.com') > -1) {
            this.config = this.prodConfig;
        }
    }
    ngOnInit() {
        super.ngOnInit();
        CfUtil.getUser()
            .then((user) => {
            const root = user;
            const camel = CfUtil.getHttpService();
            const msgService = CfUtil.getMessage();
            if (!camel || !msgService || !root || !Util.isFunction(camel.get) || !Util.isFunction(msgService.showSuccess)) {
                return;
            }
            const userId = root.domainId;
            this.userId = userId;
            const url = `${this.config.backend}/api/get/commit/date?surveyId={survey_id}&userId={user_id}&serviceId={service_id}&contactId={contact_id}`;
            if (userId) {
                camel.get({
                    url: {
                        s: url,
                        o: {
                            survey_id: this.config.surveyId,
                            user_id: userId,
                            service_id: this.options.serviceId,
                            contact_id: this.options.contactId
                        }
                    }
                })
                    .then((response) => {
                    // 后台返回的日期格式yyyy-MM-dd，在IE下Date.parse为NaN，导致组件提交成功后还会出现。需要转成yyyy/mm/dd，目前这种格式在3个浏览器都OK
                    const submitDate = Date.parse(response.data.replace(/-/g, '/'));
                    // 如果是非法日期，或者没有提交为''，则重新赋值为0。否则会出现NaN，组件展示不出来。
                    const milliSeconds = isNaN(submitDate) ? 0 : submitDate;
                    // 查询上次提交的日期，如果小于90天则不显示。否则，看之前用户是否点击关闭按钮
                    if (new Date().getTime() - milliSeconds > TpContactsurveyComponent.MILLISECONDS_PER_MONTH) {
                        const tinyContactSurvey = Util.isUndefined(TpUtil.getCookie('tinyContactSurvey')) ? '' : TpUtil.getCookie('tinyContactSurvey');
                        if (tinyContactSurvey.indexOf(`${userId}${this.options.serviceId}${this.options.contactId}`) === -1) {
                            this.showContactsurvey = true;
                        }
                    }
                }, () => {
                    // 数据请求失败，不出现该组件。如果出现错误提示，会给用户带来困扰。
                });
            }
        });
        // 在模板中用于展示的问题数据
        this.displayData = [{
                questionId: 'question1',
                type: 'radio',
                show: true,
                require: true,
                title: Util.formatEntry(this.tpContactsurvey.contactSurvey_question1_title, [this.options.contactName])
            }, {
                questionId: 'question2',
                type: 'essay',
                show: false,
                require: false,
                title: this.tpContactsurvey.contactSurvey_question2_title
            }];
    }
    /**
     * @ignore
     *  叉号图标点击事件
     */
    onClickClose() {
        const closedList = Util.isUndefined(TpUtil.getCookie('tinyContactSurvey')) ? '' : TpUtil.getCookie('tinyContactSurvey');
        TpUtil.setCookie('tinyContactSurvey', `${closedList}${this.userId}${this.options.serviceId}${this.options.contactId},`);
        this.showContactsurvey = false;
    }
    /**
     * @ignore
     * 调查结果提交事件
     */
    onClickSubmit() {
        CfUtil.getUser().then((user) => {
            const root = user;
            const camel = CfUtil.getHttpService();
            const msgService = CfUtil.getMessage();
            if (!camel || !msgService || !root || !Util.isFunction(camel.post) || !Util.isFunction(msgService.showSuccess)) {
                return;
            }
            const url = `${this.config.backend}/api/save`;
            // 发送请求，向后台发送问卷结果
            const sendData = {
                data: {
                    surveyId: this.config.surveyId,
                    serviceId: this.options.serviceId,
                    contactId: this.options.contactId,
                    w3account: root.domainId,
                    answers: this.submitAnswer
                }
            };
            camel.post({
                url: {
                    s: url
                },
                params: sendData
            })
                .then(() => { }, () => { });
            this.showContactsurvey = false;
            msgService.showSuccess(this.tpContactsurvey.contactSurvey_submit_success);
        }, () => { });
    }
    /**
     * @ignore
     * 点击评分组件
     */
    changeScore(score) {
        if (!this.displayData[1].show) {
            this.displayData[1].show = true;
        }
        this.initAnswerArrray();
        // 对于单选来说，answer和subRemark的值一样
        this.submitAnswer[0].answer = score;
        this.submitAnswer[0].subRemark = score;
        this.submitDisabled = false;
    }
    /**
     * @ignore
     * 文本框失焦事件
     */
    onBlur(value) {
        this.submitAnswer[1].answer = value;
    }
    /**
     * @ignore
     * 初始化答案对象，用于给后台下发
     */
    initAnswerArrray() {
        for (let i = 0; i < this.displayData.length; i++) {
            this.submitAnswer[i] = {};
            this.submitAnswer[i].questionId = this.displayData[i].questionId;
            this.submitAnswer[i].subQuestionId = null;
            this.submitAnswer[i].subName = this.displayData[i].title;
            this.submitAnswer[i].answer = '';
            this.submitAnswer[i].subRemark = '';
            if (this.displayData[i].type === 'essay') {
                this.submitAnswer[i].subRemark = null;
            }
            this.submitAnswer[i].reason = '0';
        }
    }
}
/**
 * 常量配置(90天对应的毫秒数)
 */
TpContactsurveyComponent.MILLISECONDS_PER_MONTH = 90 * 24 * 60 * 60 * 1000;
TpContactsurveyComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-contactsurvey',
                template: "<div *ngIf=\"showContactsurvey\" class=\"tp-contactsurvey-wrapper\">\r\n    <tp-icon local name=\"cloud-close\" class=\"tp-contactsurvey-close\"\r\n    (click)='onClickClose()' [id]=\"appendId('contactsurvey_close')\"\r\n    tiOutline [tabindex]=\"0\" (keydown.enter)=\"onClickClose()\"></tp-icon>\r\n    <div *ngFor=\"let question of displayData; index as i\">\r\n        <div *ngIf=\"question.show === true\" class=\"tp-contactsurvey-question\">\r\n            <section class=\"tp-contactsurvey-question-title\">\r\n                <ti-icon *ngIf=\"question.require\" name=\"staricon\" class=\"tp-contactsurvey-required\"></ti-icon>\r\n                <span [id]=\"appendId('title' + i)\">{{question.title}}</span>\r\n            </section>\r\n            <tp-score *ngIf=\"question.type === 'radio'\" class=\"tp-contactsurvey-score\"\r\n                [minText]=\"'tpContactsurvey.contactSurvey_score_text.minText' | tiTranslate\"\r\n                [maxText]=\"'tpContactsurvey.contactSurvey_score_text.maxText' | tiTranslate \"\r\n                [ngModel]=\"scoreValue\" (ngModelChange)=\"changeScore($event)\"\r\n                [id]=\"appendId('score' + i)\">\r\n            </tp-score>\r\n            <textarea *ngIf=\"question.type === 'essay'\" class=\"tp-contactsurvey-textarea\"\r\n                [(ngModel)]=\"textareaValue\" resize=\"none\" maxlength=\"400\"\r\n                [placeholder]=\"'tpContactsurvey.contactSurvey_question2_placeholder' | tiTranslate\"\r\n                (blur)=\"onBlur(textareaValue)\" tiTextarea>\r\n            </textarea>\r\n        </div>\r\n    </div>\r\n    <button type=\"button\" color=\"danger\" [disabled]=\"submitDisabled\" (click)=\"onClickSubmit()\"\r\n    [id]=\"appendId('contactsurvey_submit')\" tiButton>{{tpContactsurvey.contactSurvey_submit}}</button>\r\n</div>",
                host: {
                    class: 'tp-contactsurvey-container' // 给最外层元素加样式类
                },
                styles: [":host.tp-contactsurvey-container{background:var(--ti-common-color-bg-white-normal);box-shadow:var(--ti-common-shadow-1-down);display:block;position:relative}.tp-contactsurvey-wrapper{padding:var(--ti-common-space-6x) 30px var(--ti-common-space-6x) var(--ti-common-space-8x)}.tp-contactsurvey-question{margin-bottom:var(--ti-common-space-4x)}.tp-contactsurvey-textarea{display:block;height:96px;width:100%}.tp-contactsurvey-question-title{font-size:var(--ti-common-font-size-1);font-weight:700;line-height:20px;padding-bottom:var(--ti-common-space-3x);position:relative}.tp-contactsurvey-submit{margin-top:var(--ti-common-space-2x)}.tp-contactsurvey-required{color:var(--ti-common-color-error);left:-15px;position:absolute}.tp-contactsurvey-close{cursor:pointer;position:absolute;right:20px;top:20px}"]
            },] }
];
TpContactsurveyComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TpContactsurveyComponent.propDecorators = {
    options: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBDb250YWN0c3VydmV5Q29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnlwbHVzMy9jb21wb25lbnRzL2NvbnRhY3RzdXJ2ZXkvVHBDb250YWN0c3VydmV5Q29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRS9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUE4QzlDOzs7Ozs7R0FNRztBQVVILE1BQU0sT0FBTyx3QkFBeUIsU0FBUSxlQUFlO0lBbUV6RCxZQUFvQixVQUFzQixFQUFVLFNBQW9CO1FBQ3BFLEtBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFEYixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBVztRQXpEeEU7OztXQUdHO1FBQ0ksc0JBQWlCLEdBQVksS0FBSyxDQUFDO1FBQzFDOzs7V0FHRztRQUNJLG1CQUFjLEdBQVksSUFBSSxDQUFDO1FBQ3RDOzs7V0FHRztRQUNJLG9CQUFlLEdBQVEsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLGVBQWUsQ0FBQztRQVd4RTs7O1dBR0c7UUFDSSxnQkFBVyxHQUEwQixFQUFFLENBQUM7UUFDL0M7OztXQUdHO1FBQ0ksaUJBQVksR0FBZSxFQUFFLENBQUM7UUFDckM7O1dBRUc7UUFDSyxjQUFTLEdBQVE7WUFDckIsT0FBTyxFQUFFLDRDQUE0QztZQUNyRCxRQUFRLEVBQUUsa0NBQWtDO1NBQy9DLENBQUM7UUFDRjs7V0FFRztRQUNL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QU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUN6RCxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7WUFDakMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ3BDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFO2dCQUN0QyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7YUFDekM7WUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7U0FDckM7SUFDTCxDQUFDOztBQTNORDs7R0FFRztBQUNxQiwrQ0FBc0IsR0FBWSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDOztZQWJ0RixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsK3lEQUFtQztnQkFFbkMsSUFBSSxFQUFFO29CQUNGLEtBQUssRUFBRSw0QkFBNEIsQ0FBQyxhQUFhO2lCQUNwRDs7YUFDSjs7O1lBakVtQixVQUFVO1lBQWlCLFNBQVM7OztzQkE0RW5ELEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUJhc2VDb21wb25lbnQsIFRpTG9jYWxlLCBVdGlsIH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuXHJcbmltcG9ydCB7IENmVXRpbCB9IGZyb20gJy4uLy4uL2NmdXRpbHMvQ2ZVdGlsJztcclxuXHJcbmltcG9ydCB7IFRwVXRpbCB9IGZyb20gJy4vLi4vLi4vdXRpbHMvVHBVdGlsJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBRdWVzdGlvbkluZm8ge1xyXG4gICAgLyoqXHJcbiAgICAgKiDpl67pophJZFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcXVlc3Rpb25JZDogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDpl67popjnmoTnsbvlnovvvIzmnIlyYWRpb+WSjGVzc2F544CB5Lik56eN57G75Z6LXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICB0eXBlOiAncmFkaW8nIHwgJ2Vzc2F5JztcclxuICAgIC8qKlxyXG4gICAgICog6Zeu6aKY5piv5ZCm5ZGI546wXHJcbiAgICAgKi9cclxuICAgIHNob3c6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIOmXrumimOaYr+WQpuaYr+W/hemAiVxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcmVxdWlyZTogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICog6Zeu6aKY55qE5ZCN56ewXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRwU3VydmV5T3B0aW9ucyB7XHJcbiAgICAvKipcclxuICAgICAqIOacjeWKoUlk77yM5ZCE5Liq5pyN5Yqh6ZyA6KaB5ZSv5LiAXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBzZXJ2aWNlSWQ6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6Kem54K5SWTvvIzkuIDkuKrmnI3liqHlhoXnmoTop6bngrlJZOmcgOimgeS/neivgeWUr+S4gFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgY29udGFjdElkOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOinpueCueWQjeensO+8jOeUqOS6juaLvOaOpemXrumimFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgY29udGFjdE5hbWU6IHN0cmluZztcclxufVxyXG4vKipcclxuICog5ruh5oSP5bqm6LCD5p+l57uE5Lu2XHJcbiAqXHJcbiAqIDEwLjAuM+eJiOacrOaWsOWinlxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueXBsdXMzZGVtby8jL2NvbnRhY3RzdXJ2ZXkvY29udGFjdHN1cnZleS1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RwLWNvbnRhY3RzdXJ2ZXknLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NvbnRhY3RzdXJ2ZXkuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9jb250YWN0c3VydmV5Lmxlc3MnXSxcclxuICAgIGhvc3Q6IHtcclxuICAgICAgICBjbGFzczogJ3RwLWNvbnRhY3RzdXJ2ZXktY29udGFpbmVyJyAvLyDnu5nmnIDlpJblsYLlhYPntKDliqDmoLflvI/nsbtcclxuICAgIH1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUcENvbnRhY3RzdXJ2ZXlDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLyoqXHJcbiAgICAgKiDluLjph4/phY3nva4oOTDlpKnlr7nlupTnmoTmr6vnp5LmlbApXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE1JTExJU0VDT05EU19QRVJfTU9OVEg6IG51bWJlciA9ICA5MCAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XHJcbiAgICAvKipcclxuICAgICAqIOe7hOS7tuS8oOWFpeaVsOaNrlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgb3B0aW9uczogVHBTdXJ2ZXlPcHRpb25zO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmmK/lkKbmmL7npLrmu6HmhI/luqbosIPmn6Xnu4Tku7bvvIzpu5jorqTkuI3mmL7npLrjgILnrKblkIjmn5DkupvmnaHku7bmiY3kvJrlsZXnpLrlh7rmnaXjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNob3dDb250YWN0c3VydmV5OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaOp+WItuaPkOS6pOaMiemSruaYr+WQpuemgeeUqO+8jOm7mOiupOS4uuemgeeUqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3VibWl0RGlzYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlm73pmYXljJbor43mnaHlr7nosaFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRwQ29udGFjdHN1cnZleTogYW55ID0gVGlMb2NhbGUuZ2V0TG9jYWxlV29yZHMoKS50cENvbnRhY3RzdXJ2ZXk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOivhOWIhuWAvFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2NvcmVWYWx1ZTogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmlofmnKzmoYbnu4Tku7bovpPlhaXlgLxcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRleHRhcmVhVmFsdWU6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5qih5p2/5Lit5bGV56S655qE6aKY55uuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkaXNwbGF5RGF0YTogQXJyYXk8VHBRdWVzdGlvbkluZm8+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeUqOaIt+WPjemmiOeahOetlOahiFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3VibWl0QW5zd2VyOiBBcnJheTxhbnk+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIOexu+eUn+S6p+eOr+Wig+eahOivt+axguaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGRldkNvbmZpZzogYW55ID0ge1xyXG4gICAgICAgIGJhY2tlbmQ6ICdodHRwczovL2NvbnNvbGUudWxhbnFhYi5odWF3ZWkuY29tL25wcy1hcGknLFxyXG4gICAgICAgIHN1cnZleUlkOiAnaHdjbG91ZGJ1c3VydmV5X2tleV9mYmQyNWJkYmRiODknXHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDnjrDnvZHnjq/looPnmoTor7fmsYLmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBwcm9kQ29uZmlnOiBhbnkgPSB7XHJcbiAgICAgICAgYmFja2VuZDogJ2h0dHBzOi8vdm9jLmh1YXdlaWNsb3VkLmNvbS9zdXJ2ZXktYXBpJyxcclxuICAgICAgICBzdXJ2ZXlJZDogJ2h3Y2xvdWRidXN1cnZleV9rZXlfZmJkMjViZGJkYjg5J1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICog55So5oi3SUTvvIzkvZzkuLrnlKjmiLfnmoTllK/kuIDmoIfor4ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB1c2VySWQ6IHN0cmluZyA9ICcnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDpu5jorqTkuLrnsbvnlJ/kuqfnjq/looPphY3nva5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNvbmZpZzogYW55ID0gdGhpcy5kZXZDb25maWc7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXIyOiBSZW5kZXJlcjIpIHtcclxuICAgICAgICBzdXBlcihlbGVtZW50UmVmLCByZW5kZXJlcjIpO1xyXG4gICAgICAgIGlmIChsb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCdodWF3ZWljbG91ZC5jb20nKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnID0gdGhpcy5wcm9kQ29uZmlnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIENmVXRpbC5nZXRVc2VyKClcclxuICAgICAgICAgICAgLnRoZW4oKHVzZXI6IGFueSk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdDogYW55ID0gdXNlcjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVsOiBhbnkgPSBDZlV0aWwuZ2V0SHR0cFNlcnZpY2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZ1NlcnZpY2U6IGFueSA9IENmVXRpbC5nZXRNZXNzYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNhbWVsIHx8ICFtc2dTZXJ2aWNlIHx8ICFyb290IHx8ICFVdGlsLmlzRnVuY3Rpb24oY2FtZWwuZ2V0KSB8fCAhVXRpbC5pc0Z1bmN0aW9uKG1zZ1NlcnZpY2Uuc2hvd1N1Y2Nlc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgdXNlcklkOiBzdHJpbmcgPSByb290LmRvbWFpbklkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VySWQgPSB1c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB1cmw6IHN0cmluZyA9IGAke3RoaXMuY29uZmlnLmJhY2tlbmR9L2FwaS9nZXQvY29tbWl0L2RhdGU/c3VydmV5SWQ9e3N1cnZleV9pZH0mdXNlcklkPXt1c2VyX2lkfSZzZXJ2aWNlSWQ9e3NlcnZpY2VfaWR9JmNvbnRhY3RJZD17Y29udGFjdF9pZH1gO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVsLmdldCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cnZleV9pZDogdGhpcy5jb25maWcuc3VydmV5SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VfaWQ6IHRoaXMub3B0aW9ucy5zZXJ2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdF9pZDogdGhpcy5vcHRpb25zLmNvbnRhY3RJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2U6IGFueSk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlkI7lj7Dov5Tlm57nmoTml6XmnJ/moLzlvI95eXl5LU1NLWRk77yM5ZyoSUXkuItEYXRlLnBhcnNl5Li6TmFO77yM5a+86Ie057uE5Lu25o+Q5Lqk5oiQ5Yqf5ZCO6L+Y5Lya5Ye6546w44CC6ZyA6KaB6L2s5oiQeXl5eS9tbS9kZO+8jOebruWJjei/meenjeagvOW8j+WcqDPkuKrmtY/op4jlmajpg71PS1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXREYXRlOiBhbnkgPSBEYXRlLnBhcnNlKHJlc3BvbnNlLmRhdGEucmVwbGFjZSgvLS9nLCAnLycpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv6Z2e5rOV5pel5pyf77yM5oiW6ICF5rKh5pyJ5o+Q5Lqk5Li6JyfvvIzliJnph43mlrDotYvlgLzkuLow44CC5ZCm5YiZ5Lya5Ye6546wTmFO77yM57uE5Lu25bGV56S65LiN5Ye65p2l44CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbGxpU2Vjb25kczogbnVtYmVyID0gaXNOYU4oc3VibWl0RGF0ZSkgPyAwIDogc3VibWl0RGF0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOafpeivouS4iuasoeaPkOS6pOeahOaXpeacn++8jOWmguaenOWwj+S6jjkw5aSp5YiZ5LiN5pi+56S644CC5ZCm5YiZ77yM55yL5LmL5YmN55So5oi35piv5ZCm54K55Ye75YWz6Zet5oyJ6ZKuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIG1pbGxpU2Vjb25kcyA+IFRwQ29udGFjdHN1cnZleUNvbXBvbmVudC5NSUxMSVNFQ09ORFNfUEVSX01PTlRIKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW55Q29udGFjdFN1cnZleTogc3RyaW5nID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWwuaXNVbmRlZmluZWQoVHBVdGlsLmdldENvb2tpZSgndGlueUNvbnRhY3RTdXJ2ZXknKSkgPyAnJyA6IFRwVXRpbC5nZXRDb29raWUoJ3RpbnlDb250YWN0U3VydmV5Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbnlDb250YWN0U3VydmV5LmluZGV4T2YoYCR7dXNlcklkfSR7dGhpcy5vcHRpb25zLnNlcnZpY2VJZH0ke3RoaXMub3B0aW9ucy5jb250YWN0SWR9YCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q29udGFjdHN1cnZleSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaVsOaNruivt+axguWksei0pe+8jOS4jeWHuueOsOivpee7hOS7tuOAguWmguaenOWHuueOsOmUmeivr+aPkOekuu+8jOS8mue7meeUqOaIt+W4puadpeWbsOaJsOOAglxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAvLyDlnKjmqKHmnb/kuK3nlKjkuo7lsZXnpLrnmoTpl67popjmlbDmja5cclxuICAgICAgICB0aGlzLmRpc3BsYXlEYXRhID0gW3tcclxuICAgICAgICAgICAgcXVlc3Rpb25JZDogJ3F1ZXN0aW9uMScsXHJcbiAgICAgICAgICAgIHR5cGU6ICdyYWRpbycsXHJcbiAgICAgICAgICAgIHNob3c6IHRydWUsIC8vIOWIneWni+aYr+WQpumcgOimgeaYvuekulxyXG4gICAgICAgICAgICByZXF1aXJlOiB0cnVlLCAvLyDmmK/lpJ/mmK/lv4XpgIlcclxuICAgICAgICAgICAgdGl0bGU6IFV0aWwuZm9ybWF0RW50cnkodGhpcy50cENvbnRhY3RzdXJ2ZXkuY29udGFjdFN1cnZleV9xdWVzdGlvbjFfdGl0bGUsIFt0aGlzLm9wdGlvbnMuY29udGFjdE5hbWVdKVxyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgICAgcXVlc3Rpb25JZDogJ3F1ZXN0aW9uMicsXHJcbiAgICAgICAgICAgIHR5cGU6ICdlc3NheScsXHJcbiAgICAgICAgICAgIHNob3c6IGZhbHNlLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBmYWxzZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRoaXMudHBDb250YWN0c3VydmV5LmNvbnRhY3RTdXJ2ZXlfcXVlc3Rpb24yX3RpdGxlXHJcbiAgICAgICAgfV07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqICDlj4nlj7flm77moIfngrnlh7vkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2tDbG9zZSgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjbG9zZWRMaXN0OiBzdHJpbmcgPSBVdGlsLmlzVW5kZWZpbmVkKFRwVXRpbC5nZXRDb29raWUoJ3RpbnlDb250YWN0U3VydmV5JykpID8gJycgOiBUcFV0aWwuZ2V0Q29va2llKCd0aW55Q29udGFjdFN1cnZleScpO1xyXG4gICAgICAgIFRwVXRpbC5zZXRDb29raWUoJ3RpbnlDb250YWN0U3VydmV5JywgYCR7Y2xvc2VkTGlzdH0ke3RoaXMudXNlcklkfSR7dGhpcy5vcHRpb25zLnNlcnZpY2VJZH0ke3RoaXMub3B0aW9ucy5jb250YWN0SWR9LGApO1xyXG4gICAgICAgIHRoaXMuc2hvd0NvbnRhY3RzdXJ2ZXkgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6LCD5p+l57uT5p6c5o+Q5Lqk5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkNsaWNrU3VibWl0KCk6IHZvaWQge1xyXG4gICAgICAgIENmVXRpbC5nZXRVc2VyKCkudGhlbigodXNlcjogYW55KTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3Q6IGFueSA9IHVzZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbWVsOiBhbnkgPSBDZlV0aWwuZ2V0SHR0cFNlcnZpY2UoKTtcclxuICAgICAgICAgICAgY29uc3QgbXNnU2VydmljZTogYW55ID0gQ2ZVdGlsLmdldE1lc3NhZ2UoKTtcclxuICAgICAgICAgICAgaWYgKCFjYW1lbCB8fCAhbXNnU2VydmljZSB8fCAhcm9vdCB8fCAhVXRpbC5pc0Z1bmN0aW9uKGNhbWVsLnBvc3QpIHx8ICFVdGlsLmlzRnVuY3Rpb24obXNnU2VydmljZS5zaG93U3VjY2VzcykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB1cmw6IHN0cmluZyA9IGAke3RoaXMuY29uZmlnLmJhY2tlbmR9L2FwaS9zYXZlYDtcclxuICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC77yM5ZCR5ZCO5Y+w5Y+R6YCB6Zeu5Y2357uT5p6cXHJcbiAgICAgICAgICAgIGNvbnN0IHNlbmREYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VydmV5SWQ6IHRoaXMuY29uZmlnLnN1cnZleUlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VJZDogdGhpcy5vcHRpb25zLnNlcnZpY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICBjb250YWN0SWQ6IHRoaXMub3B0aW9ucy5jb250YWN0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgdzNhY2NvdW50OiByb290LmRvbWFpbklkLCAvLyDnlKjmiLdJRFxyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IHRoaXMuc3VibWl0QW5zd2VyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjYW1lbC5wb3N0KHtcclxuICAgICAgICAgICAgICAgIHVybDoge1xyXG4gICAgICAgICAgICAgICAgICAgIHM6IHVybFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHBhcmFtczogc2VuZERhdGFcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKCk6IHZvaWQgPT4geyB9LCAoKTogdm9pZCA9PiB7IH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zaG93Q29udGFjdHN1cnZleSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtc2dTZXJ2aWNlLnNob3dTdWNjZXNzKHRoaXMudHBDb250YWN0c3VydmV5LmNvbnRhY3RTdXJ2ZXlfc3VibWl0X3N1Y2Nlc3MpO1xyXG4gICAgICAgIH0sICgpOiB2b2lkID0+IHsgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeCueWHu+ivhOWIhue7hOS7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY2hhbmdlU2NvcmUoc2NvcmU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5kaXNwbGF5RGF0YVsxXS5zaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheURhdGFbMV0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXRBbnN3ZXJBcnJyYXkoKTtcclxuXHJcbiAgICAgICAgLy8g5a+55LqO5Y2V6YCJ5p2l6K+077yMYW5zd2Vy5ZKMc3ViUmVtYXJr55qE5YC85LiA5qC3XHJcbiAgICAgICAgdGhpcy5zdWJtaXRBbnN3ZXJbMF0uYW5zd2VyID0gc2NvcmU7XHJcbiAgICAgICAgdGhpcy5zdWJtaXRBbnN3ZXJbMF0uc3ViUmVtYXJrID0gc2NvcmU7XHJcblxyXG4gICAgICAgIHRoaXMuc3VibWl0RGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5paH5pys5qGG5aSx54Sm5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkJsdXIodmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc3VibWl0QW5zd2VyWzFdLmFuc3dlciA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDliJ3lp4vljJbnrZTmoYjlr7nosaHvvIznlKjkuo7nu5nlkI7lj7DkuIvlj5FcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRBbnN3ZXJBcnJyYXkoKTogdm9pZCB7XHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMuZGlzcGxheURhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRBbnN3ZXJbaV0gPSB7IH07XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QW5zd2VyW2ldLnF1ZXN0aW9uSWQgPSB0aGlzLmRpc3BsYXlEYXRhW2ldLnF1ZXN0aW9uSWQ7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QW5zd2VyW2ldLnN1YlF1ZXN0aW9uSWQgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdEFuc3dlcltpXS5zdWJOYW1lID0gdGhpcy5kaXNwbGF5RGF0YVtpXS50aXRsZTtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRBbnN3ZXJbaV0uYW5zd2VyID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QW5zd2VyW2ldLnN1YlJlbWFyayA9ICcnO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5RGF0YVtpXS50eXBlID09PSAnZXNzYXknKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdEFuc3dlcltpXS5zdWJSZW1hcmsgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QW5zd2VyW2ldLnJlYXNvbiA9ICcwJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19