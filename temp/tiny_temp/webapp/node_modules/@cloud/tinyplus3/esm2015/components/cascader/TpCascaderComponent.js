import { Component, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { TiDominatorComponent, TiDropComponent, TiDroplistComponent, TiFormComponent } from '@cloud/tiny3';
/**
 * 级联选择器 目前只支持二级或三级级联
 *
 * <example-url>../tinyplus3demo/#/cascader/cascader-all</example-url>
 */
export class TpCascaderComponent extends TiFormComponent {
    constructor() {
        // TODO: add explicit constructor
        super(...arguments);
        /**
         * 是否开启清空输入框内容的功能
         */
        this.clearable = false;
        /**
         * 显示的字段
         */
        this.labelKey = 'label';
        /**
         * 10.0.4 新增
         *
         * 单级面板的宽度
         */
        this.panelWidth = '160px';
        /**
         * 10.0.4 新增
         *
         * 面板高度
         */
        this.panelHeight = '248px';
        /**
         * 10.0.4 新增
         *
         * 是否只能选中叶子节点
         */
        this.onlySelectLeaf = true;
        /**
         * 10.0.4 新增
         *
         * 在选择框上呈现的数据是否显示全部路径
         */
        this.showAllLevel = true;
        /**
         * @ignore
         * 选中事件，选中项没有变化
         */
        this.select = new EventEmitter();
        /**
         * @ignore
         * 选中事件，选中项变化
         */
        this.change = new EventEmitter();
        /**
         * 清除已选项
         */
        this.clear = new EventEmitter();
        /**
         * @ignore 分隔符 以后可能会对外开放
         */
        this.separator = '/';
        /**
         * @ignore 三个TiListComponent的model
         */
        this.listModel = [];
        /**
         * @ignore
         * itemsArr[0]存放根面板内容，itemArr[1]存放次级面板内容，itemArr[2]存放次次级面板内容
         */
        this.itemsArr = [];
        /**
         * @ignore 宽面板的数据
         */
        this.itemForWideDroplist = [];
        this.valueFn = (item) => {
            return item[this.valueKey];
        };
    }
    ngOnInit() {
        this.panelWidthNum = parseInt(this.panelWidth, 10);
    }
    ngOnChanges(change) {
        if (change['items']) {
            this.itemsArr[0] = this.items;
        }
    }
    /**
     * @ignore
     */
    ngOnModelChange() {
        if (this.modelWhole && this.modelWhole.length > 0) {
            this.joinDominatorModel();
        }
    }
    /**
     * @ignore
     */
    onClick() {
        if (this.disabled) {
            return;
        }
        if (this.dropCom.isShow || this.wideDroplist.isShow) {
            this.close();
            return;
        }
        this.dropshow = true;
        if (this.items.length === 0) {
            this.wideDroplist.show();
        }
        else {
            /**
             * 触发tiScroll关闭面板的场景下，drop不显示，但list是显示的，
             * 下次重新打开时，一个或者多个list会全部显示，除第一个外，其他的都定位错误，
             * 所以，需要打开前隐藏除第一个外的其他list。
             */
            this.listComsArr.forEach((list, index) => {
                if (index > 0) {
                    this.renderer.setStyle(list.nativeElement, 'display', 'none');
                }
            });
            this.dropCom.show();
            if (this.modelWhole && this.modelWhole.length > 0) {
                this.modelWhole.forEach((item, i) => {
                    this.listComsArr[i].model = item;
                    this.itemsArr[i + 1] = item.children;
                    this.showList(i);
                    // 如果是初始有值，不加setTimeout不能滚到正确的位置
                    setTimeout(() => {
                        this.listComsArr[i].scrollToSelected();
                    }, 0);
                });
            }
            else {
                this.listComsArr[0].model = undefined;
                this.showList(0);
            }
        }
        this.focus();
    }
    ngAfterViewInit() {
        this.listComsArr = this.listComs.toArray();
        this.setFocusableElems(this.dominatorCom.getFocusableElems());
        this.renderer.setStyle(this.dropCom.nativeElement, 'width', '');
    }
    /**
     * @ignore
     */
    close() {
        this.dropshow = false;
        this.dropCom.hide();
        this.wideDroplist.hide();
    }
    /**
     * @ignore
     */
    onBlur() {
        this.close();
    }
    /**
     * @ignore
     */
    onSelect($event, panelIndex) {
        var _a;
        // 处理面板
        if (((_a = $event.children) === null || _a === void 0 ? void 0 : _a.length) > 0) {
            // 关闭次次级面板
            for (let i = panelIndex + 1; i < this.listComsArr.length - 1; i++) {
                this.renderer.setStyle(this.listComsArr[i + 1].nativeElement, 'display', 'none');
            }
            // 打开次级面板
            this.itemsArr[panelIndex + 1] = $event.children;
            this.showList(panelIndex + 1);
        }
        else {
            // 关闭次级以后所有面板
            this.close();
        }
        this.listModel = this.listModel || [];
        this.listModel.splice(panelIndex);
        this.listModel.push($event);
        if (!this.onlySelectLeaf || !$event.children || $event.children.length === 0) {
            this.modelWhole = [...this.listModel];
            this.handleModel($event, panelIndex);
        }
    }
    /**
     * @ignore
     */
    onClear() {
        this.model = [];
        this.clear.emit();
    }
    /**
     * @ignore
     */
    onMouseleave(panelIndex) {
        this.listComsArr[panelIndex].hoverOption = undefined;
    }
    /**
     * @ignore
     */
    showList(panelIndex) {
        this.renderer.setStyle(this.listComsArr[panelIndex].nativeElement, 'display', 'inline-block');
        this.renderer.setStyle(this.dropCom.nativeElement, 'width', this.panelWidthNum * (panelIndex + 1) + 'px');
        if (!this.listComsArr[panelIndex].model) {
            this.listComsArr[panelIndex].hoverOption = undefined;
        }
    }
    handleModel($event, panelIndex) {
        // 处理数据
        this.listModel.splice(panelIndex);
        this.listModel[panelIndex] = $event;
        this.joinDominatorModel();
    }
    /**
     * 通过model拼接dominatorModel，显示在dominator上
     */
    joinDominatorModel() {
        this.dominatorModel = '';
        if (this.showAllLevel) {
            this.modelWhole.forEach((item, index) => {
                if (index === 0) {
                    this.dominatorModel += `${item[this.labelKey]}`;
                }
                else {
                    this.dominatorModel += `${this.separator}${item[this.labelKey]}`;
                }
            });
        }
        else {
            this.dominatorModel = this.modelWhole[this.model.length - 1][this.labelKey];
        }
    }
    writeValue(model) {
        // super.writeValue(model);
        if (model && this.valueKey) {
            this._modelWhole = this.items.filter((item) => model.includes(this.valueFn(item)));
            if (this._modelWhole[0].children) {
                const nextModelWhole = this._modelWhole[0].children.filter((item) => model.includes(this.valueFn(item)))[0];
                this._modelWhole.push(nextModelWhole);
                if (nextModelWhole.children) {
                    const nextModelWhole1 = nextModelWhole.children.filter((item) => model.includes(this.valueFn(item)))[0];
                    nextModelWhole1 && this._modelWhole.push(nextModelWhole1);
                }
            }
        }
        else {
            this._modelWhole = model;
        }
        super.writeValue(model);
    }
    get modelWhole() {
        return this._modelWhole;
    }
    /**
     * 点选时modelWhole改变，要同时更改model
     */
    set modelWhole(value) {
        this._modelWhole = value;
        if (this.valueKey && value !== undefined && value !== null) {
            // 存在valueKey，且value不为空
            this.model = value.map((item) => this.valueFn(item));
        }
        else {
            this.model = value;
        }
    }
}
TpCascaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-cascader',
                template: "<ti-dominator [id]=\"appendId('cascader_dominator')\"\r\n    [placeholder]=\"placeholder\" [disabled]=\"disabled\" (click)=\"onClick()\" [dropshow]=\"dropshow\"\r\n    [clearable]=\"clearable\" [(ngModel)]='dominatorModel' (clear)=\"onClear()\">\r\n    <ng-template #item>\r\n        <span>{{dominatorModel}}</span>\r\n    </ng-template>\r\n</ti-dominator>\r\n<ti-drop\r\n    [dominatorElem]=\"dominatorCom.nativeElement\"\r\n    [panelWidth]=\"panelWidth\"\r\n    [panelHeight]=\"panelHeight\">\r\n        <!-- \u6709\u9009\u9879\u6570\u636E -->\r\n        <ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[0], panelIndex: 0}\">\r\n        </ng-container>\r\n        <ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[1], panelIndex: 1}\">\r\n        </ng-container>\r\n        <ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[2], panelIndex: 2}\">\r\n        </ng-container>\r\n</ti-drop>\r\n\r\n<ng-template #pannelTemplate let-options let-panelIndex=panelIndex>\r\n    <ti-list #commonList\r\n        [ngStyle]=\"{width: panelWidth}\"\r\n        class=\"tp-cascader-list\"\r\n        [options]=\"options\"\r\n        [labelKey]=\"labelKey\"\r\n        [showChildren]=\"false\"\r\n        (select)=\"onSelect($event, panelIndex)\"\r\n        [(ngModel)]='listModel[panelIndex]'\r\n        (mouseleave)=\"onMouseleave(panelIndex)\"\r\n    ></ti-list>\r\n</ng-template>\r\n\r\n<ng-container>\r\n    <!-- \u65E0\u6570\u636E\u6216\u8005\u641C\u7D22 -->\r\n    <ti-droplist #wideDroplist\r\n        [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        [options]=\"itemForWideDroplist\"\r\n    ></ti-droplist>\r\n</ng-container>\r\n",
                providers: [TiFormComponent.getValueAccessor(TpCascaderComponent)],
                host: {
                    '(blur)': 'onBlur()',
                    '[class.tp-cascader-dominator]': 'true'
                },
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-component-container-border,:host.tp-cascader-dominator{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;display:inline-block}.tp-component-container-border:not([disabled]),:host.tp-cascader-dominator:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-common-color-line-normal)}.tp-component-container-border:not([disabled]):hover,:host.tp-cascader-dominator:not([disabled]):hover{border-color:var(--ti-common-color-line-hover)}.tp-component-container-border:not([disabled])[tiFocused],:host.tp-cascader-dominator:not([disabled])[tiFocused]{border-color:var(--ti-common-color-line-active)}.tp-component-container-border[disabled],:host.tp-cascader-dominator[disabled]{background-color:var(--ti-common-color-bg-disabled);border-color:var(--ti-common-color-line-disabled);cursor:not-allowed!important}:host.tp-cascader-dominator{width:200px}.tp-cascader-input{background-color:transparent;border:none;cursor:inherit;display:inline-block;height:100%;outline:none;vertical-align:top;width:100%}.tp-cascader-list{height:100%}.tp-cascader-list:not(:first-child){border-left:1px solid var(--ti-common-color-line-dividing);display:none}"]
            },] }
];
TpCascaderComponent.propDecorators = {
    items: [{ type: Input }],
    clearable: [{ type: Input }],
    placeholder: [{ type: Input }],
    labelKey: [{ type: Input }],
    panelWidth: [{ type: Input }],
    panelHeight: [{ type: Input }],
    onlySelectLeaf: [{ type: Input }],
    showAllLevel: [{ type: Input }],
    valueKey: [{ type: Input }],
    select: [{ type: Output }],
    change: [{ type: Output }],
    clear: [{ type: Output }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent,] }],
    listComs: [{ type: ViewChildren, args: ['commonList',] }],
    wideDroplist: [{ type: ViewChild, args: ['wideDroplist',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBDYXNjYWRlckNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy9jYXNjYWRlci9UcENhc2NhZGVyQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFpQixTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFILE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxFQUMvQyxNQUFNLGNBQWMsQ0FBQztBQXNCMUQ7Ozs7R0FJRztBQVlILE1BQU0sT0FBTyxtQkFBb0IsU0FBUSxlQUFlO0lBWHhEO1FBWUUsaUNBQWlDOztRQVEvQjs7V0FFRztRQUNNLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFVcEM7O1dBRUc7UUFDTSxhQUFRLEdBQVcsT0FBTyxDQUFDO1FBQ3BDOzs7O1dBSUc7UUFDTSxlQUFVLEdBQVcsT0FBTyxDQUFDO1FBQ3RDOzs7O1dBSUc7UUFDTSxnQkFBVyxHQUFXLE9BQU8sQ0FBQztRQUN2Qzs7OztXQUlHO1FBQ00sbUJBQWMsR0FBWSxJQUFJLENBQUM7UUFDeEM7Ozs7V0FJRztRQUNNLGlCQUFZLEdBQVksSUFBSSxDQUFDO1FBT3RDOzs7V0FHRztRQUNnQixXQUFNLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdkU7OztXQUdHO1FBQ2dCLFdBQU0sR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2RTs7V0FFRztRQUNnQixVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFrQnRFOztXQUVHO1FBQ0ksY0FBUyxHQUFXLEdBQUcsQ0FBQztRQUsvQjs7V0FFRztRQUNJLGNBQVMsR0FBZSxFQUFFLENBQUM7UUFLbEM7OztXQUdHO1FBQ0ksYUFBUSxH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LENBQUM7SUFFRDs7T0FFRztJQUNILElBQVksVUFBVSxDQUFDLEtBQVU7UUFDN0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtZQUN4RCx1QkFBdUI7WUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDeEQ7YUFBTTtZQUNILElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1NBQ3RCO0lBQ0wsQ0FBQzs7O1lBM1VKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsd3NEQUE4QjtnQkFFOUIsU0FBUyxFQUFFLENBQUMsZUFBZSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQ2xFLElBQUksRUFBRTtvQkFDRixRQUFRLEVBQUUsVUFBVTtvQkFDcEIsK0JBQStCLEVBQUUsTUFBTTtpQkFDMUM7O2FBQ0o7OztvQkFVSSxLQUFLO3dCQUlMLEtBQUs7MEJBU0wsS0FBSzt1QkFJTCxLQUFLO3lCQU1MLEtBQUs7MEJBTUwsS0FBSzs2QkFNTCxLQUFLOzJCQU1MLEtBQUs7dUJBS0wsS0FBSztxQkFNTCxNQUFNO3FCQUtOLE1BQU07b0JBSU4sTUFBTTsyQkFLTixTQUFTLFNBQUMsb0JBQW9CLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDO3NCQUk5QyxTQUFTLFNBQUMsZUFBZTt1QkFJekIsWUFBWSxTQUFDLFlBQVk7MkJBSXpCLFNBQVMsU0FBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFF1ZXJ5TGlzdCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3Q2hpbGRyZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlEb21pbmF0b3JDb21wb25lbnQsIFRpRHJvcENvbXBvbmVudCwgVGlEcm9wbGlzdENvbXBvbmVudCwgVGlGb3JtQ29tcG9uZW50LCBUaUxpc3RDb21wb25lbnQsXHJcbiAgICBUaVBvc2l0aW9uVHlwZSwgVGlXaG9sZUNvbXBvbmVudH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBDYXNjYWRlckl0ZW0ge1xyXG4gICAgbGFiZWw/OiBzdHJpbmc7XHJcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIOS6jOe6p+mdouadv+aVsOaNrlxyXG4gICAgICpcclxuICAgICAqIOWMheWQq++8mjEubGFiZWzvvJrmmL7npLrmlofmnKwgMi5kaXNhYmxlZO+8muemgeeUqCAzLnRpcO+8muaPkOekuuS/oeaBryA0LnRpcFBvc2l0aW9u77ya5pa55L2N77yM6buY6K6k5Li64oCYcmlnaHTigJlcclxuICAgICAqL1xyXG4gICAgY2hpbGRyZW4/OiBBcnJheTx7XHJcbiAgICAgICAgbGFiZWw/OiBzdHJpbmc7XHJcbiAgICAgICAgZGlzYWJsZWQ/OiBib29sZWFuO1xyXG4gICAgICAgIHRpcD86IGFueTtcclxuICAgICAgICB0aXBQb3NpdGlvbj86IFRpUG9zaXRpb25UeXBlO1xyXG4gICAgICAgIFtwcm9wTmFtZTogc3RyaW5nXTogYW55O1xyXG4gICAgfT47XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG4vKipcclxuICog57qn6IGU6YCJ5oup5ZmoIOebruWJjeWPquaUr+aMgeS6jOe6p+aIluS4iee6p+e6p+iBlFxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueXBsdXMzZGVtby8jL2Nhc2NhZGVyL2Nhc2NhZGVyLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndHAtY2FzY2FkZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2Nhc2NhZGVyLmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vY2FzY2FkZXIubGVzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbVGlGb3JtQ29tcG9uZW50LmdldFZhbHVlQWNjZXNzb3IoVHBDYXNjYWRlckNvbXBvbmVudCldLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICcoYmx1ciknOiAnb25CbHVyKCknLFxyXG4gICAgICAgICdbY2xhc3MudHAtY2FzY2FkZXItZG9taW5hdG9yXSc6ICd0cnVlJ1xyXG4gICAgfVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFRwQ2FzY2FkZXJDb21wb25lbnQgZXh0ZW5kcyBUaUZvcm1Db21wb25lbnQge1xyXG4gIC8vIFRPRE86IGFkZCBleHBsaWNpdCBjb25zdHJ1Y3RvclxyXG5cclxuICAvLyBUT0RPOiBhZGQgZXhwbGljaXQgY29uc3RydWN0b3JcclxuXHJcbiAgICAvKipcclxuICAgICAqIOaVsOaNruWIl+ihqFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtczogQXJyYXk8VHBDYXNjYWRlckl0ZW0+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKblvIDlkK/muIXnqbrovpPlhaXmoYblhoXlrrnnmoTlip/og71cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY2xlYXJhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIDEwLjEuMOaWsOWinlxyXG4gICAgICovXHJcbiAgICAvLyBASW5wdXQoKSBzZWFyY2hhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIOmihOeVmeaWh+acrFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmL7npLrnmoTlrZfmrrVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbGFiZWxLZXk6IHN0cmluZyA9ICdsYWJlbCc7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjAuNCDmlrDlop5cclxuICAgICAqXHJcbiAgICAgKiDljZXnuqfpnaLmnb/nmoTlrr3luqZcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgcGFuZWxXaWR0aDogc3RyaW5nID0gJzE2MHB4JztcclxuICAgIC8qKlxyXG4gICAgICogMTAuMC40IOaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOmdouadv+mrmOW6plxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBwYW5lbEhlaWdodDogc3RyaW5nID0gJzI0OHB4JztcclxuICAgIC8qKlxyXG4gICAgICogMTAuMC40IOaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOaYr+WQpuWPquiDvemAieS4reWPtuWtkOiKgueCuVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBvbmx5U2VsZWN0TGVhZjogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjAuNCDmlrDlop5cclxuICAgICAqXHJcbiAgICAgKiDlnKjpgInmi6nmoYbkuIrlkYjnjrDnmoTmlbDmja7mmK/lkKbmmL7npLrlhajpg6jot6/lvoRcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgc2hvd0FsbExldmVsOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICogMTAuMS4x5paw5aKeXHJcbiAgICAgKiDmjIflrprpgInkuK3lgLznmoTlrZfmrrVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdmFsdWVLZXk6IHN0cmluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOmAieS4reS6i+S7tu+8jOmAieS4remhueayoeacieWPmOWMllxyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgc2VsZWN0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDpgInkuK3kuovku7bvvIzpgInkuK3pobnlj5jljJZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IGNoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8qKlxyXG4gICAgICog5riF6Zmk5bey6YCJ6aG5XHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBjbGVhcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURvbWluYXRvckNvbXBvbmVudCwge3N0YXRpYzogdHJ1ZX0pIGRvbWluYXRvckNvbTogVGlEb21pbmF0b3JDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURyb3BDb21wb25lbnQpIGRyb3BDb206IFRpRHJvcENvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlkYjnjrDlkITnuqfmlbDmja7nmoRsaXN0XHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGRyZW4oJ2NvbW1vbkxpc3QnKSBsaXN0Q29tczogUXVlcnlMaXN0PFRpTGlzdENvbXBvbmVudD47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5a6955qE6Z2i5p2/77yM5piv5LiA5LiqZHJvcGxpc3TvvIznlKjkuo7ml6DmlbDmja7lkozmkJzntKLlnLrmma9cclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnd2lkZURyb3BsaXN0Jykgd2lkZURyb3BsaXN0OiBUaURyb3BsaXN0Q29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOWIhumalOespiDku6XlkI7lj6/og73kvJrlr7nlpJblvIDmlL5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlcGFyYXRvcjogc3RyaW5nID0gJy8nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOi9rOWMluS4uuaVsOWtl+eahHBhbmVsV2lkdGhcclxuICAgICAqL1xyXG4gICAgcHVibGljIHBhbmVsV2lkdGhOdW06IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDkuInkuKpUaUxpc3RDb21wb25lbnTnmoRtb2RlbFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbGlzdE1vZGVsOiBBcnJheTxhbnk+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg55So5LqOZG9taW5hdG9y5ZGI546w5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkb21pbmF0b3JNb2RlbDogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBpdGVtc0FyclswXeWtmOaUvuaguemdouadv+WGheWuue+8jGl0ZW1BcnJbMV3lrZjmlL7mrKHnuqfpnaLmnb/lhoXlrrnvvIxpdGVtQXJyWzJd5a2Y5pS+5qyh5qyh57qn6Z2i5p2/5YaF5a65XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpdGVtc0FycjogQXJyYXk8QXJyYXk8YW55Pj4gPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlrr3pnaLmnb/nmoTmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGl0ZW1Gb3JXaWRlRHJvcGxpc3Q6IEFycmF5PGFueT4gPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZHJvcHNob3c6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGxpc3RDb21zQXJyOiBBcnJheTxUaUxpc3RDb21wb25lbnQ+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogbW9kZWxXaG9sZeS4jm1vZGVs55qE5Lit6Ze05Y+Y6YePXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX21vZGVsV2hvbGU6IEFycmF5PFRwQ2FzY2FkZXJJdGVtPjtcclxuXHJcbiAgICBwcml2YXRlIHZhbHVlRm46IChpdGVtOiBhbnkpID0+IGFueSA9IChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gaXRlbVt0aGlzLnZhbHVlS2V5XTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBhbmVsV2lkdGhOdW0gPSBwYXJzZUludCh0aGlzLnBhbmVsV2lkdGgsIDEwKTtcclxuICAgIH1cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZTogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VbJ2l0ZW1zJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtc0FyclswXSA9IHRoaXMuaXRlbXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIG5nT25Nb2RlbENoYW5nZSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RlbFdob2xlICYmIHRoaXMubW9kZWxXaG9sZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuam9pbkRvbWluYXRvck1vZGVsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkNsaWNrKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZHJvcENvbS5pc1Nob3cgfHwgdGhpcy53aWRlRHJvcGxpc3QuaXNTaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kcm9wc2hvdyA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMud2lkZURyb3BsaXN0LnNob3coKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog6Kem5Y+RdGlTY3JvbGzlhbPpl63pnaLmnb/nmoTlnLrmma/kuIvvvIxkcm9w5LiN5pi+56S677yM5L2GbGlzdOaYr+aYvuekuueahO+8jFxyXG4gICAgICAgICAgICAgKiDkuIvmrKHph43mlrDmiZPlvIDml7bvvIzkuIDkuKrmiJbogIXlpJrkuKpsaXN05Lya5YWo6YOo5pi+56S677yM6Zmk56ys5LiA5Liq5aSW77yM5YW25LuW55qE6YO95a6a5L2N6ZSZ6K+v77yMXHJcbiAgICAgICAgICAgICAqIOaJgOS7pe+8jOmcgOimgeaJk+W8gOWJjemakOiXj+mZpOesrOS4gOS4quWklueahOWFtuS7lmxpc3TjgIJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHRoaXMubGlzdENvbXNBcnIuZm9yRWFjaCgobGlzdDogVGlMaXN0Q29tcG9uZW50LCBpbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShsaXN0Lm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ25vbmUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcENvbS5zaG93KCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsV2hvbGUgJiYgdGhpcy5tb2RlbFdob2xlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWxXaG9sZS5mb3JFYWNoKChpdGVtOiBUcENhc2NhZGVySXRlbSwgaTogbnVtYmVyKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0Q29tc0FycltpXS5tb2RlbCA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtc0FycltpICsgMV0gPSBpdGVtLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xpc3QoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5Yid5aeL5pyJ5YC877yM5LiN5Yqgc2V0VGltZW91dOS4jeiDvea7muWIsOato+ehrueahOS9jee9rlxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RDb21zQXJyW2ldLnNjcm9sbFRvU2VsZWN0ZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0Q29tc0FyclswXS5tb2RlbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xpc3QoMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZm9jdXMoKTtcclxuICAgIH1cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxpc3RDb21zQXJyID0gdGhpcy5saXN0Q29tcy50b0FycmF5KCk7XHJcbiAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyh0aGlzLmRvbWluYXRvckNvbS5nZXRGb2N1c2FibGVFbGVtcygpKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZHJvcENvbS5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCAnJyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGNsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHJvcHNob3cgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRyb3BDb20uaGlkZSgpO1xyXG4gICAgICAgIHRoaXMud2lkZURyb3BsaXN0LmhpZGUoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25CbHVyKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uU2VsZWN0KCRldmVudDogVHBDYXNjYWRlckl0ZW0sIHBhbmVsSW5kZXg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIC8vIOWkhOeQhumdouadv1xyXG4gICAgICAgIGlmICgkZXZlbnQuY2hpbGRyZW4/Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8g5YWz6Zet5qyh5qyh57qn6Z2i5p2/XHJcbiAgICAgICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IHBhbmVsSW5kZXggKyAxOyBpIDwgdGhpcy5saXN0Q29tc0Fyci5sZW5ndGggLSAxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5saXN0Q29tc0FycltpICsgMV0ubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOaJk+W8gOasoee6p+mdouadv1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zQXJyW3BhbmVsSW5kZXggKyAxXSA9ICRldmVudC5jaGlsZHJlbjtcclxuICAgICAgICAgICAgdGhpcy5zaG93TGlzdChwYW5lbEluZGV4ICsgMSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5YWz6Zet5qyh57qn5Lul5ZCO5omA5pyJ6Z2i5p2/XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5saXN0TW9kZWwgPSB0aGlzLmxpc3RNb2RlbCB8fCBbXTtcclxuICAgICAgICB0aGlzLmxpc3RNb2RlbC5zcGxpY2UocGFuZWxJbmRleCk7XHJcbiAgICAgICAgdGhpcy5saXN0TW9kZWwucHVzaCgkZXZlbnQpO1xyXG4gICAgICAgIGlmICghdGhpcy5vbmx5U2VsZWN0TGVhZiB8fCAhJGV2ZW50LmNoaWxkcmVuIHx8ICRldmVudC5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbFdob2xlID0gWy4uLnRoaXMubGlzdE1vZGVsXTtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVNb2RlbCgkZXZlbnQsIHBhbmVsSW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGVhcigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm1vZGVsID0gW107XHJcbiAgICAgICAgdGhpcy5jbGVhci5lbWl0KCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uTW91c2VsZWF2ZShwYW5lbEluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmxpc3RDb21zQXJyW3BhbmVsSW5kZXhdLmhvdmVyT3B0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2hvd0xpc3QocGFuZWxJbmRleDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxpc3RDb21zQXJyW3BhbmVsSW5kZXhdLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2lubGluZS1ibG9jaycpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5kcm9wQ29tLm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIHRoaXMucGFuZWxXaWR0aE51bSAqIChwYW5lbEluZGV4ICsgMSkgKyAncHgnKTtcclxuICAgICAgICBpZiAoIXRoaXMubGlzdENvbXNBcnJbcGFuZWxJbmRleF0ubW9kZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0Q29tc0FycltwYW5lbEluZGV4XS5ob3Zlck9wdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoYW5kbGVNb2RlbCgkZXZlbnQ6IFRwQ2FzY2FkZXJJdGVtLCBwYW5lbEluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICAvLyDlpITnkIbmlbDmja5cclxuICAgICAgICB0aGlzLmxpc3RNb2RlbC5zcGxpY2UocGFuZWxJbmRleCk7XHJcbiAgICAgICAgdGhpcy5saXN0TW9kZWxbcGFuZWxJbmRleF0gPSAkZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5qb2luRG9taW5hdG9yTW9kZWwoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h21vZGVs5ou85o6lZG9taW5hdG9yTW9kZWzvvIzmmL7npLrlnKhkb21pbmF0b3LkuIpcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBqb2luRG9taW5hdG9yTW9kZWwoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kb21pbmF0b3JNb2RlbCA9ICcnO1xyXG4gICAgICAgIGlmICh0aGlzLnNob3dBbGxMZXZlbCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGVsV2hvbGUuZm9yRWFjaCgoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbWluYXRvck1vZGVsICs9IGAke2l0ZW1bdGhpcy5sYWJlbEtleV19YDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb21pbmF0b3JNb2RlbCArPSBgJHt0aGlzLnNlcGFyYXRvcn0ke2l0ZW1bdGhpcy5sYWJlbEtleV19YDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kb21pbmF0b3JNb2RlbCA9IHRoaXMubW9kZWxXaG9sZVt0aGlzLm1vZGVsLmxlbmd0aCAtIDFdW3RoaXMubGFiZWxLZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKG1vZGVsKTogdm9pZCB7XHJcbiAgICAgICAgLy8gc3VwZXIud3JpdGVWYWx1ZShtb2RlbCk7XHJcbiAgICAgICAgaWYgKG1vZGVsICYmIHRoaXMudmFsdWVLZXkpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW9kZWxXaG9sZSA9IHRoaXMuaXRlbXMuZmlsdGVyKChpdGVtKSA9PiBtb2RlbC5pbmNsdWRlcyh0aGlzLnZhbHVlRm4oaXRlbSkpKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX21vZGVsV2hvbGVbMF0uY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRNb2RlbFdob2xlOiBUcENhc2NhZGVySXRlbSA9IHRoaXMuX21vZGVsV2hvbGVbMF0uY2hpbGRyZW4uZmlsdGVyKChpdGVtKSA9PiBtb2RlbC5pbmNsdWRlcyh0aGlzLnZhbHVlRm4oaXRlbSkpKVswXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vZGVsV2hvbGUucHVzaChuZXh0TW9kZWxXaG9sZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dE1vZGVsV2hvbGUuY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0TW9kZWxXaG9sZTE6IFRwQ2FzY2FkZXJJdGVtID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE1vZGVsV2hvbGUuY2hpbGRyZW4uZmlsdGVyKChpdGVtKSA9PiBtb2RlbC5pbmNsdWRlcyh0aGlzLnZhbHVlRm4oaXRlbSkpKVswXTtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0TW9kZWxXaG9sZTEgJiYgdGhpcy5fbW9kZWxXaG9sZS5wdXNoKG5leHRNb2RlbFdob2xlMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9tb2RlbFdob2xlID0gbW9kZWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1cGVyLndyaXRlVmFsdWUobW9kZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0IG1vZGVsV2hvbGUoKTogYW55IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbW9kZWxXaG9sZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeCuemAieaXtm1vZGVsV2hvbGXmlLnlj5jvvIzopoHlkIzml7bmm7TmlLltb2RlbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldCBtb2RlbFdob2xlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9tb2RlbFdob2xlID0gdmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMudmFsdWVLZXkgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyDlrZjlnKh2YWx1ZUtlee+8jOS4lHZhbHVl5LiN5Li656m6XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSB2YWx1ZS5tYXAoKGl0ZW0pID0+IHRoaXMudmFsdWVGbihpdGVtKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=