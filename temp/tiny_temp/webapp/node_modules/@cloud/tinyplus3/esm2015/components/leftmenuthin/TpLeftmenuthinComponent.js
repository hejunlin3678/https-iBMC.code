import { Component, EventEmitter, Input, Output, ElementRef, Renderer2 } from '@angular/core';
import { Util, TiBaseComponent } from '@cloud/tiny3';
import { ActivatedRoute, NavigationEnd, Router } from '@angular/router';
/**
 * 组件功能与leftMenu组件相似。
 *
 * <example-url>../tinyplus3demo/#/leftmenuthin/leftmenuthin-all</example-url>
 */
export class TpLeftmenuthinComponent extends TiBaseComponent {
    constructor(router, activeRoute, hostRef, renderer) {
        super(hostRef, renderer);
        this.router = router;
        this.activeRoute = activeRoute;
        this.hostRef = hostRef;
        this.renderer = renderer;
        /**
         * 激活菜单项改变时向外通知
         */
        this.activeChange = new EventEmitter();
        /**
         * 点击菜单项触发此事件
         */
        this.select = new EventEmitter();
        /**
         * 控制右侧内容区的刷新
         *
         * 注意：当重复点击当前激活菜单项时，需要刷新右侧内容区，为了实现此功能设置了该接口；
         * 该接口是双向绑定的，当重复点击当前激活菜单项时，reloadState的值会经历 true(上次的值) -> false -> true
         * 的变化过程，开发者给改接口与其右侧区域容器上ngIf接口绑定的是同一个变量，所以ngIf的值也会经历同样的变化，
         * 从而做到右侧内容区的刷新。
         */
        this.reloadState = true;
        /**
         * 右侧内容区是否需要刷新的状态值改变时向外通知
         */
        this.reloadStateChange = new EventEmitter();
        /**
         * @ignore
         */
        this.resolvedPromise = Promise.resolve(null);
        /**
         * 标志量，是否为url改变(需要去改变active)
         */
        this.isUrlChange = false;
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始时右侧内容区默认显示，需使外部用户的reloadState值为true。
        // 双向绑定数据时，对初始传入的值立即修改并传出时会报错，
        // 此处参考ngModel源码setValue的处理，使用promise延后执行时序
        this.resolvedPromise.then(() => {
            this.reloadStateChange.emit(true);
        });
    }
    ngAfterViewInit() {
        // 直接输入url(刷新页面)改变状态时，leftmenu能同步修改激活状态
        const urlActiveItem = this.getActiveItemByUrl(this.items);
        if (urlActiveItem) {
            // 双向绑定数据时，对初始传入的值立即修改并传出时会报错，
            // 此处参考ngModel源码setValue的处理，使用promise延后执行时序
            this.resolvedPromise.then(() => {
                if (urlActiveItem !== this.active) {
                    this.isUrlChange = true;
                    this.active = urlActiveItem;
                    this.activeChange.emit(this.active);
                }
            });
        }
        else {
            this.link();
        }
        // 从非leftMenu处跳转改变状态时，leftmenu能同步修改激活状态
        this.navigationSubscription = this.router.events.subscribe((evt) => {
            if (evt instanceof NavigationEnd) {
                const newActiveItem = this.getActiveItemByUrl(this.items);
                if (newActiveItem && newActiveItem !== this.active) {
                    this.active = newActiveItem;
                    this.activeChange.emit(this.active);
                    this.isUrlChange = true;
                }
            }
        });
    }
    ngOnChanges(changes) {
        const activeObj = changes['active'];
        if (activeObj && !activeObj.firstChange) {
            if (!this.isUrlChange) {
                this.link();
                this.isUrlChange = false;
            }
            else {
                this.navigate(activeObj.currentValue);
            }
        }
    }
    ngOnDestroy() {
        if (this.navigationSubscription) {
            this.navigationSubscription.unsubscribe();
        }
    }
    /**
     * @ignore
     * 模板中使用
     */
    selectFn(item) {
        const oldactive = this.active;
        const newactive = item;
        // 点击当前已经激活的item时，刷新对应路由
        if (newactive === oldactive) {
            this.triggerReload(item);
        }
        else if (newactive !== oldactive) {
            this.active = newactive;
            this.navigate(item);
            this.activeChange.emit(this.active);
        }
        this.select.emit(item);
    }
    /**
     * @ignore
     * 点击当前选中项时，触发内容区重载
     * @param item 当前点击项
     */
    triggerReload(item) {
        // 使reloadState由false变为true,配合内容区的ngIf做到内容区的重载
        this.reloadStateChange.emit(false);
        setTimeout(() => {
            this.reloadStateChange.emit(true);
            this.navigate(item);
        }, 0);
    }
    navigate(item) {
        this.router.navigate(item.router, this.getNavigationExtras(item.routerExtras));
    }
    getNavigationExtras(routerExtras) {
        return Object.assign({ relativeTo: this.activeRoute }, routerExtras);
    }
    getActiveItemByUrl(arr) {
        let resultItem;
        for (const item of arr) {
            if (this.isActived(item)) {
                resultItem = item;
                return resultItem;
            }
        }
        return resultItem;
    }
    isActived(item) {
        const relativeRoute = this.getRelativeRoute(item.routerExtras);
        if (this.isMatchCurrentUrl(item.router, relativeRoute)) {
            return true;
        }
        if (Util.isArray(item.routerList) && item.routerList.length > 0) {
            for (const router of item.routerList) {
                if (this.isMatchCurrentUrl(router, relativeRoute)) {
                    return true;
                }
            }
        }
        return false;
    }
    getRelativeRoute(routerExtras) {
        if (!routerExtras || !routerExtras['relativeTo']) {
            return { relativeTo: this.activeRoute };
        }
        return { relativeTo: routerExtras['relativeTo'] };
    }
    isMatchCurrentUrl(router, relativeRoute) {
        if (!Util.isArray(router)) {
            return false;
        }
        const itemUrlTree = this.router.createUrlTree(router, relativeRoute);
        return this.router.isActive(itemUrlTree, false);
    }
    link() {
        if (this.active) {
            this.navigate(this.active);
        }
    }
}
TpLeftmenuthinComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-leftmenuthin',
                template: "<div class=\"tp-leftmenuthin-content\">\r\n  <div tiOutline class=\"tp-leftmenuthin-level\" *ngFor=\"let item of items; index as i\" (click)=\"selectFn(item)\" [id]=\"appendId('select_' + i)\"\r\n    [ngClass]=\"{'tp-leftmenuthin-level-active': active === item}\" [tabindex]=\"0\" (keydown.enter)=\"selectFn(item)\">\r\n    <ng-container *ngIf='!item.iconName && item.customizeIcon'>\r\n      <ng-container  *ngTemplateOutlet='item.customizeIcon; context:  {$implicit: item}'></ng-container>\r\n    </ng-container>\r\n    <tp-icon *ngIf='item.iconName' class=\"tp-leftmenuthin-icon\" [name]='item.iconName'></tp-icon>\r\n    <div class=\"tp-leftmenuthin-level-text\" [id]=\"appendId('label_' + i)\">{{item.label}}</div>\r\n  </div>\r\n</div>\r\n",
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-leftmenuthin-content{background-color:var(--ti-common-color-bg-white-normal);bottom:0;position:fixed;top:0;width:var(--tp-leftmenuthin-level-width);z-index:1000}.tp-leftmenuthin-level{box-sizing:border-box;color:var(--ti-common-color-text-secondary);cursor:pointer;height:var(--tp-leftmenuthin-level-height);padding-top:var(--ti-common-space-3x);text-align:center;width:var(--tp-leftmenuthin-level-width)}.tp-leftmenuthin-level .tp-leftmenuthin-icon{font-size:var(--ti-common-font-size-6)}.tp-leftmenuthin-level .tp-leftmenuthin-level-text{font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-top:var(--ti-common-space-base);text-align:center}.tp-leftmenuthin-level:hover{background-color:var(--ti-common-color-bg-white-emphasize);color:var(--ti-common-color-icon-hover)}.tp-leftmenuthin-level.tp-leftmenuthin-level-active{background-color:var(--ti-common-color-bg-emphasize);color:var(--ti-common-color-text-white)}.tp-leftmenuthin-level.tp-leftmenuthin-level-active .tp-leftmenuthin-icon{color:var(--ti-common-color-icon-white)}"]
            },] }
];
TpLeftmenuthinComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute },
    { type: ElementRef },
    { type: Renderer2 }
];
TpLeftmenuthinComponent.propDecorators = {
    active: [{ type: Input }],
    activeChange: [{ type: Output }],
    select: [{ type: Output }],
    reloadState: [{ type: Input }],
    items: [{ type: Input }],
    reloadStateChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBMZWZ0bWVudXRoaW5Db21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueXBsdXMzL2NvbXBvbmVudHMvbGVmdG1lbnV0aGluL1RwTGVmdG1lbnV0aGluQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEVBR04sVUFBVSxFQUNWLFNBQVMsRUFFWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNyRCxPQUFPLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBb0IsTUFBTSxFQUFXLE1BQU0saUJBQWlCLENBQUM7QUF1Q25HOzs7O0dBSUc7QUFPSCxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsZUFBZTtJQXlDeEQsWUFDWSxNQUFjLEVBQ2QsV0FBMkIsRUFDekIsT0FBbUIsRUFBWSxRQUFtQjtRQUN4RCxLQUFLLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBSHBCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFDekIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFZLGFBQVEsR0FBUixRQUFRLENBQVc7UUFyQ2hFOztXQUVHO1FBQ2dCLGlCQUFZLEdBQXFDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDdkY7O1dBRUc7UUFDZ0IsV0FBTSxHQUFxQyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2pGOzs7Ozs7O1dBT0c7UUFDTSxnQkFBVyxHQUFZLElBQUksQ0FBQztRQUtyQzs7V0FFRztRQUNnQixzQkFBaUIsR0FBMEIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNqRjs7V0FFRztRQUNhLG9CQUFlLEdBQWlCLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEU7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QUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDOUI7SUFDTCxDQUFDOzs7WUE3TEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLHF2QkFBa0M7O2FBRXJDOzs7WUFoRHlELE1BQU07WUFBdkQsY0FBYztZQUxuQixVQUFVO1lBQ1YsU0FBUzs7O3FCQTREUixLQUFLOzJCQUlMLE1BQU07cUJBSU4sTUFBTTswQkFTTixLQUFLO29CQUlMLEtBQUs7Z0NBSUwsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgSW5wdXQsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBPbkRlc3Ryb3ksXHJcbiAgICBPbkluaXQsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBTaW1wbGVDaGFuZ2UsXHJcbiAgICBTaW1wbGVDaGFuZ2VzLFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIFJlbmRlcmVyMixcclxuICAgIFRlbXBsYXRlUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFV0aWwsIFRpQmFzZUNvbXBvbmVudCB9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBOYXZpZ2F0aW9uRW5kLCBOYXZpZ2F0aW9uRXh0cmFzLCBSb3V0ZXIsIFVybFRyZWUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBMZWZ0bWVudXRoaW5JdGVtIHtcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5b2T5YmN6I+c5Y2V6aG55a+55bqU55qE6Lev55Sx77yM5LiOIFJvdXRlci5uYXZpZ2F0ZeaWueazleeahOesrOS4gOS4quWPguaVsOS4gOagt1xyXG4gICAgICovXHJcbiAgICByb3V0ZXI6IEFycmF5PGFueT47XHJcbiAgICAvLyByb3V0ZXJFeHRyYXM/OiB7IHJlbGF0aXZlVG8/OiBzdHJpbmcsIHF1ZXJ5UGFyYW1zPzogT2JqZWN0LCBmcmFnbWVudD86IHN0cmluZyB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7lvZPliY3oj5zljZXpobnlr7nlupTot6/nlLHnmoTphY3nva7kv6Hmga/vvIzkuI4gUm91dGVyLm5hdmlnYXRl5pa55rOV55qE56ys5LqM5Liq5Y+C5pWw5LiA5qC3XHJcbiAgICAgKi9cclxuICAgIHJvdXRlckV4dHJhcz86IE5hdmlnYXRpb25FeHRyYXM7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruS4gOS4qnJvdXRlcui3r+eUseWIl+ihqO+8jOW9k+ivpeWIl+ihqOS4reeahOi3r+eUseiiq+a/gOa0u+aXtu+8jOWFtuWvueW6lOeahOiPnOWNlemhueiiq+a/gOa0u+WkhOS6jumrmOS6rueKtuaAgeOAglxyXG4gICAgICog5YW25L2/55So5Zy65pmv5Li65aSa5Liq6Lev55Sx5a+55bqU5ZCM5LiA5Liq5bem5L6n6I+c5Y2V6aG544CCXHJcbiAgICAgKlxyXG4gICAgICogcm91dGVyTGlzdCDmlbDnu4TkuK3mr4/kuIDkuKrlhYPntKDkuI4gUm91dGVyLm5hdmlnYXRl5pa55rOV55qE56ys5LiA5Liq5Y+C5pWw5LiA5qC3XHJcbiAgICAgKi9cclxuICAgIHJvdXRlckxpc3Q/OiBBcnJheTxBcnJheTxhbnk+PjsgLy8g5pWw57uE5Lit5YWD57Sg5Lmf5Li65pWw57uEXHJcbiAgICAvKipcclxuICAgICAqIOmAiemhuWxhYmVsXHJcbiAgICAgKi9cclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOmAiemhueWbvuagh+WQjeensFxyXG4gICAgICovXHJcbiAgICBpY29uTmFtZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6Z2e5LqR5pyN5Yqh5oiW6Z2e5YWl5bqT5Zu+5qCH5L2/55So5bGV56S6XHJcbiAgICAgKlxyXG4gICAgICogMTAuMS4wIOaWsOWinlxyXG4gICAgICovXHJcbiAgICBjdXN0b21pemVJY29uPzogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIC8qKlxyXG4gICAgICog5YWB6K645pyJ5aSa5L2Z55qE5bGe5oCn5a2X5q61XHJcbiAgICAgKi9cclxuICAgIFtwcm9wTmFtZTogc3RyaW5nXTogYW55O1xyXG59XHJcbi8qKlxyXG4gKiDnu4Tku7blip/og73kuI5sZWZ0TWVudee7hOS7tuebuOS8vOOAglxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueXBsdXMzZGVtby8jL2xlZnRtZW51dGhpbi9sZWZ0bWVudXRoaW4tYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0cC1sZWZ0bWVudXRoaW4nLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xlZnRtZW51dGhpbi5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2xlZnRtZW51dGhpbi5sZXNzJ11cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUcExlZnRtZW51dGhpbkNvbXBvbmVudCBleHRlbmRzIFRpQmFzZUNvbXBvbmVudCB7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rua/gOa0u+iPnOWNlemhueOAguaOpeWPo+S8oOWFpeeahOWAvOeahOmbhuWQiOS4reeahOS4gOS4qihpdGVtKVxyXG4gICAgICpcclxuICAgICAqIOatpOaOpeWPo+aYr+WPjOWQkee7keWumueahO+8jOiuvue9ruaXtuS4reaLrOWPt+KAnFtd4oCd5ZKM5ZyG5ous5Y+34oCcKCnigJ3opoHlkIzml7bkvb/nlKhcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgYWN0aXZlOiBUcExlZnRtZW51dGhpbkl0ZW07XHJcbiAgICAvKipcclxuICAgICAqIOa/gOa0u+iPnOWNlemhueaUueWPmOaXtuWQkeWklumAmuefpVxyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgYWN0aXZlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8VHBMZWZ0bWVudXRoaW5JdGVtPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKlxyXG4gICAgICog54K55Ye76I+c5Y2V6aG56Kem5Y+R5q2k5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBzZWxlY3Q6IEV2ZW50RW1pdHRlcjxUcExlZnRtZW51dGhpbkl0ZW0+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmjqfliLblj7PkvqflhoXlrrnljLrnmoTliLfmlrBcclxuICAgICAqXHJcbiAgICAgKiDms6jmhI/vvJrlvZPph43lpI3ngrnlh7vlvZPliY3mv4DmtLvoj5zljZXpobnml7bvvIzpnIDopoHliLfmlrDlj7PkvqflhoXlrrnljLrvvIzkuLrkuoblrp7njrDmraTlip/og73orr7nva7kuobor6XmjqXlj6PvvJtcclxuICAgICAqIOivpeaOpeWPo+aYr+WPjOWQkee7keWumueahO+8jOW9k+mHjeWkjeeCueWHu+W9k+WJjea/gOa0u+iPnOWNlemhueaXtu+8jHJlbG9hZFN0YXRl55qE5YC85Lya57uP5Y6GIHRydWUo5LiK5qyh55qE5YC8KSAtPiBmYWxzZSAtPiB0cnVlXHJcbiAgICAgKiDnmoTlj5jljJbov4fnqIvvvIzlvIDlj5HogIXnu5nmlLnmjqXlj6PkuI7lhbblj7PkvqfljLrln5/lrrnlmajkuIpuZ0lm5o6l5Y+j57uR5a6a55qE5piv5ZCM5LiA5Liq5Y+Y6YeP77yM5omA5LulbmdJZueahOWAvOS5n+S8mue7j+WOhuWQjOagt+eahOWPmOWMlu+8jFxyXG4gICAgICog5LuO6ICM5YGa5Yiw5Y+z5L6n5YaF5a655Yy655qE5Yi35paw44CCXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHJlbG9hZFN0YXRlOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICog6I+c5Y2V5pWw5o2u5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGl0ZW1zOiBBcnJheTxUcExlZnRtZW51dGhpbkl0ZW0+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlj7PkvqflhoXlrrnljLrmmK/lkKbpnIDopoHliLfmlrDnmoTnirbmgIHlgLzmlLnlj5jml7blkJHlpJbpgJrnn6VcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IHJlbG9hZFN0YXRlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHJlc29sdmVkUHJvbWlzZTogUHJvbWlzZTxhbnk+ID0gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmoIflv5fph4/vvIzmmK/lkKbkuLp1cmzmlLnlj5go6ZyA6KaB5Y675pS55Y+YYWN0aXZlKVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGlzVXJsQ2hhbmdlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIG5hdmlnYXRpb25TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBhY3RpdmVSb3V0ZTogQWN0aXZhdGVkUm91dGUsXHJcbiAgICAgICAgcHJvdGVjdGVkIGhvc3RSZWY6IEVsZW1lbnRSZWYsIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyICkge1xyXG4gICAgICAgICAgICBzdXBlcihob3N0UmVmLCByZW5kZXJlcilcclxuICAgIH1cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5Yid5aeL5pe25Y+z5L6n5YaF5a655Yy66buY6K6k5pi+56S677yM6ZyA5L2/5aSW6YOo55So5oi355qEcmVsb2FkU3RhdGXlgLzkuLp0cnVl44CCXHJcbiAgICAgICAgLy8g5Y+M5ZCR57uR5a6a5pWw5o2u5pe277yM5a+55Yid5aeL5Lyg5YWl55qE5YC856uL5Y2z5L+u5pS55bm25Lyg5Ye65pe25Lya5oql6ZSZ77yMXHJcbiAgICAgICAgLy8g5q2k5aSE5Y+C6ICDbmdNb2RlbOa6kOeggXNldFZhbHVl55qE5aSE55CG77yM5L2/55SocHJvbWlzZeW7tuWQjuaJp+ihjOaXtuW6j1xyXG4gICAgICAgIHRoaXMucmVzb2x2ZWRQcm9taXNlLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbG9hZFN0YXRlQ2hhbmdlLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g55u05o6l6L6T5YWldXJsKOWIt+aWsOmhtemdoinmlLnlj5jnirbmgIHml7bvvIxsZWZ0bWVudeiDveWQjOatpeS/ruaUuea/gOa0u+eKtuaAgVxyXG4gICAgICAgIGNvbnN0IHVybEFjdGl2ZUl0ZW06IFRwTGVmdG1lbnV0aGluSXRlbSA9IHRoaXMuZ2V0QWN0aXZlSXRlbUJ5VXJsKHRoaXMuaXRlbXMpO1xyXG4gICAgICAgIGlmICh1cmxBY3RpdmVJdGVtKSB7XHJcbiAgICAgICAgICAgIC8vIOWPjOWQkee7keWumuaVsOaNruaXtu+8jOWvueWIneWni+S8oOWFpeeahOWAvOeri+WNs+S/ruaUueW5tuS8oOWHuuaXtuS8muaKpemUme+8jFxyXG4gICAgICAgICAgICAvLyDmraTlpITlj4LogINuZ01vZGVs5rqQ56CBc2V0VmFsdWXnmoTlpITnkIbvvIzkvb/nlKhwcm9taXNl5bu25ZCO5omn6KGM5pe25bqPXHJcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZWRQcm9taXNlLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVybEFjdGl2ZUl0ZW0gIT09IHRoaXMuYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1VybENoYW5nZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSB1cmxBY3RpdmVJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ2hhbmdlLmVtaXQodGhpcy5hY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxpbmsoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5LuO6Z2ebGVmdE1lbnXlpITot7PovazmlLnlj5jnirbmgIHml7bvvIxsZWZ0bWVudeiDveWQjOatpeS/ruaUuea/gOa0u+eKtuaAgVxyXG4gICAgICAgIHRoaXMubmF2aWdhdGlvblN1YnNjcmlwdGlvbiA9IHRoaXMucm91dGVyLmV2ZW50cy5zdWJzY3JpYmUoKGV2dDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldnQgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRW5kKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBY3RpdmVJdGVtOiBUcExlZnRtZW51dGhpbkl0ZW0gPSB0aGlzLmdldEFjdGl2ZUl0ZW1CeVVybCh0aGlzLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdBY3RpdmVJdGVtICYmIG5ld0FjdGl2ZUl0ZW0gIT09IHRoaXMuYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBuZXdBY3RpdmVJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ2hhbmdlLmVtaXQodGhpcy5hY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNVcmxDaGFuZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlT2JqOiBTaW1wbGVDaGFuZ2UgPSBjaGFuZ2VzWydhY3RpdmUnXTtcclxuICAgICAgICBpZiAoYWN0aXZlT2JqICYmICFhY3RpdmVPYmouZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVXJsQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpbmsoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNVcmxDaGFuZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGUoYWN0aXZlT2JqLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5qih5p2/5Lit5L2/55SoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZWxlY3RGbihpdGVtOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBvbGRhY3RpdmU6IFRwTGVmdG1lbnV0aGluSXRlbSA9IHRoaXMuYWN0aXZlO1xyXG4gICAgICAgIGNvbnN0IG5ld2FjdGl2ZTogVHBMZWZ0bWVudXRoaW5JdGVtID0gaXRlbTtcclxuICAgICAgICAvLyDngrnlh7vlvZPliY3lt7Lnu4/mv4DmtLvnmoRpdGVt5pe277yM5Yi35paw5a+55bqU6Lev55SxXHJcbiAgICAgICAgaWYgKG5ld2FjdGl2ZSA9PT0gb2xkYWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlclJlbG9hZChpdGVtKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG5ld2FjdGl2ZSAhPT0gb2xkYWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gbmV3YWN0aXZlO1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRlKGl0ZW0pO1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUNoYW5nZS5lbWl0KHRoaXMuYWN0aXZlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWxlY3QuZW1pdChpdGVtKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog54K55Ye75b2T5YmN6YCJ5Lit6aG55pe277yM6Kem5Y+R5YaF5a655Yy66YeN6L29XHJcbiAgICAgKiBAcGFyYW0gaXRlbSDlvZPliY3ngrnlh7vpoblcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRyaWdnZXJSZWxvYWQoaXRlbTogVHBMZWZ0bWVudXRoaW5JdGVtKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5L2/cmVsb2FkU3RhdGXnlLFmYWxzZeWPmOS4unRydWUs6YWN5ZCI5YaF5a655Yy655qEbmdJZuWBmuWIsOWGheWuueWMuueahOmHjei9vVxyXG4gICAgICAgIHRoaXMucmVsb2FkU3RhdGVDaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVsb2FkU3RhdGVDaGFuZ2UuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZShpdGVtKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgbmF2aWdhdGUoaXRlbTogVHBMZWZ0bWVudXRoaW5JdGVtKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoaXRlbS5yb3V0ZXIsIHRoaXMuZ2V0TmF2aWdhdGlvbkV4dHJhcyhpdGVtLnJvdXRlckV4dHJhcykpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBnZXROYXZpZ2F0aW9uRXh0cmFzKHJvdXRlckV4dHJhczogT2JqZWN0KTogT2JqZWN0IHtcclxuICAgICAgICByZXR1cm4geyByZWxhdGl2ZVRvOiB0aGlzLmFjdGl2ZVJvdXRlLCAuLi5yb3V0ZXJFeHRyYXMgfTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgZ2V0QWN0aXZlSXRlbUJ5VXJsKGFycjogQXJyYXk8YW55Pik6IFRwTGVmdG1lbnV0aGluSXRlbSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdEl0ZW06IFRwTGVmdG1lbnV0aGluSXRlbTtcclxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aXZlZChpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0SXRlbSA9IGl0ZW07XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdEl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRJdGVtO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBpc0FjdGl2ZWQoaXRlbTogVHBMZWZ0bWVudXRoaW5JdGVtKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgcmVsYXRpdmVSb3V0ZTogTmF2aWdhdGlvbkV4dHJhcyA9IHRoaXMuZ2V0UmVsYXRpdmVSb3V0ZShpdGVtLnJvdXRlckV4dHJhcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNNYXRjaEN1cnJlbnRVcmwoaXRlbS5yb3V0ZXIsIHJlbGF0aXZlUm91dGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKFV0aWwuaXNBcnJheShpdGVtLnJvdXRlckxpc3QpICYmIGl0ZW0ucm91dGVyTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgcm91dGVyIG9mIGl0ZW0ucm91dGVyTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNNYXRjaEN1cnJlbnRVcmwocm91dGVyLCByZWxhdGl2ZVJvdXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGdldFJlbGF0aXZlUm91dGUocm91dGVyRXh0cmFzOiBPYmplY3QpOiBOYXZpZ2F0aW9uRXh0cmFzIHtcclxuICAgICAgICBpZiAoIXJvdXRlckV4dHJhcyB8fCAhcm91dGVyRXh0cmFzWydyZWxhdGl2ZVRvJ10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgcmVsYXRpdmVUbzogdGhpcy5hY3RpdmVSb3V0ZSB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHsgcmVsYXRpdmVUbzogcm91dGVyRXh0cmFzWydyZWxhdGl2ZVRvJ10gfTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgaXNNYXRjaEN1cnJlbnRVcmwocm91dGVyOiBBcnJheTxhbnk+LCByZWxhdGl2ZVJvdXRlOiBOYXZpZ2F0aW9uRXh0cmFzKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKCFVdGlsLmlzQXJyYXkocm91dGVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGl0ZW1VcmxUcmVlOiBVcmxUcmVlID0gdGhpcy5yb3V0ZXIuY3JlYXRlVXJsVHJlZShyb3V0ZXIsIHJlbGF0aXZlUm91dGUpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZXIuaXNBY3RpdmUoaXRlbVVybFRyZWUsIGZhbHNlKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgbGluaygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5hY3RpdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZSh0aGlzLmFjdGl2ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==