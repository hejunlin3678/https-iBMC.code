import { Component, Input } from '@angular/core';
import { TiBaseComponent, TiLocale } from '@cloud/tiny3';
/**
 * 倒计时提示组件
 *
 * <example-url>../tinyplus3demo/#/countdownalert/countdownalert-all</example-url>
 */
export class TpCountdownalertComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 告警类型， 默认为error
         */
        this.type = 'error';
        /**
         * 是否显示左侧提示类型图标
         */
        this.typeIcon = true;
        /**
         * 是否显示关闭按钮
         */
        this.closeIcon = true;
        /**
         * 是否显示countdownalert
         */
        this.open = false;
        /**
         * 是否触发下拉类组件消失的事件，适用于countdownalert的呈现状态影响页面下拉类组件位置的场景
         */
        this.triggerScroll = false;
        /**
         * @ignore
         */
        this.innerLabel = '';
    }
    ngOnInit() {
        super.ngOnInit();
        if (this.label) {
            return;
        }
        // 处理label
        const localeWords = TiLocale.getLocaleWords().tpCountdownalert;
        let timespan = '';
        if (this.infos) {
            timespan = this.getTimespan(this.infos, localeWords);
        }
        if (this.status) {
            const statusKey = this.status ? this.status.slice(14) : '';
            if (Object.keys(localeWords).indexOf(statusKey) >= 0) {
                this.innerLabel = localeWords[statusKey].replace(/{TS}/, String(timespan))
                    .replace(/{RN}/, this.resource || '');
            }
            else {
                // 状态正常，不需要显示alert
                this.open = false;
            }
        }
        // 处理充值续费链接：包周期为续费，服务需要传自定义链接；按需为充值，充值为固定链接
        if (this.status === 'hws_countdown_period_gracing' || this.status === 'hws_countdown_period_frozen') {
            this.showBuyLink = true;
            this.linkText = localeWords.renew;
        }
        else if (this.status === 'hws_countdown_ondemand_gracing' || this.status === 'hws_countdown_ondemand_frozen') {
            this.showBuyLink = true;
            this.linkText = localeWords.recharge;
            this.linkHref = 'https://account.huaweicloud.com/usercenter/#/userindex/balanceRecharge';
        }
        // 国际站 联系方式处理
        const intlContactPath = '/ticket/?#/ticketindex/createfeedback'; // 国际站联系客服路径
        const url = `${window.location.protocol}//${window.location.host}${intlContactPath}`;
        this.innerLabel = this.innerLabel.replace(/{contactLink}/, `<a class="tp-countdownalert-link" target="_blank" rel="noopener noreferrer"  href="${url}">${localeWords.contact_customer_service}</a>`);
        // 自定义客服联系电话号码处理
        this.innerLabel = this.innerLabel.replace(/{phoneNumber}/, this.phoneNumber || localeWords.phoneNumber);
    }
    getTimespan(infos, localeWords) {
        // tslint:disable-next-line: typedef
        const { day, hour, minute, second } = localeWords;
        if (infos.nextOperationRemainingDay) {
            return day.replace(/{d}/, infos.nextOperationRemainingDay);
        }
        else if (infos.nextOperationRemainingHour) {
            return hour.replace(/{h}/, infos.nextOperationRemainingHour)
                .replace(/{m}/, infos.nextOperationRemainingMinute);
        }
        else if (infos.nextOperationRemainingMinute) {
            return minute.replace(/{m}/, infos.nextOperationRemainingMinute);
        }
        else if (infos.nextOperationRemainingSecond) {
            return second;
        }
        return '';
    }
}
TpCountdownalertComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-countdownalert',
                template: "<ti-alert style=\"width: 100%\"\r\n    [type]=\"type\"\r\n    [closeIcon]=\"closeIcon\"\r\n    [typeIcon]=\"typeIcon\"\r\n    [open]=\"open\"\r\n    [dismissOnTimeout]=\"dismissOnTimeout\"\r\n    [triggerScroll]=\"triggerScroll\"\r\n    [id]=\"appendId('alert')\">\r\n        <span [innerHTML]=\"label || innerLabel\" [id]=\"appendId('label')\"></span>\r\n        <a class=\"tp-countdownalert-link\"\r\n            rel=\"noopener noreferrer\"\r\n            *ngIf=\"showBuyLink\"\r\n            target=\"_blank\"\r\n            [href]=\"linkHref\"\r\n            [id]=\"appendId('link_text')\">{{linkText}}</a>\r\n</ti-alert>",
                styles: ["a.tp-countdownalert-link{color:var(--ti-common-color-text-link)}a.tp-countdownalert-link:hover{cursor:pointer}a.tp-countdownalert-link:link,a.tp-countdownalert-link:visited{color:var(--ti-common-color-text-link);text-decoration:none}"]
            },] }
];
TpCountdownalertComponent.propDecorators = {
    type: [{ type: Input }],
    typeIcon: [{ type: Input }],
    closeIcon: [{ type: Input }],
    open: [{ type: Input }],
    dismissOnTimeout: [{ type: Input }],
    triggerScroll: [{ type: Input }],
    label: [{ type: Input }],
    infos: [{ type: Input }],
    status: [{ type: Input }],
    resource: [{ type: Input }],
    linkHref: [{ type: Input }],
    phoneNumber: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBDb3VudGRvd25hbGVydENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy9jb3VudGRvd25hbGVydC9UcENvdW50ZG93bmFsZXJ0Q29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBR3pEOzs7O0dBSUc7QUFPSCxNQUFNLE9BQU8seUJBQTBCLFNBQVEsZUFBZTtJQU45RDs7UUFPSTs7V0FFRztRQUNNLFNBQUksR0FBNEMsT0FBTyxDQUFDO1FBQ2pFOztXQUVHO1FBQ00sYUFBUSxHQUFZLElBQUksQ0FBQztRQUNsQzs7V0FFRztRQUNNLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFDbkM7O1dBRUc7UUFDTSxTQUFJLEdBQVksS0FBSyxDQUFDO1FBSy9COztXQUVHO1FBQ00sa0JBQWEsR0FBWSxLQUFLLENBQUM7UUE2QnhDOztXQUVHO1FBQ0ksZUFBVSxHQUFXLEVBQUUsQ0FBQztJQW9FbkMsQ0FBQztJQTFERyxRQUFRO1FBQ0osS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUFFLE9BQU87U0FBRTtRQUMzQixVQUFVO1FBQ1YsTUFBTSxXQUFXLEdBQVEsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLGdCQUFnQixDQUFDO1FBQ3BFLElBQUksUUFBUSxHQUFXLEVBQUUsQ0FBQztRQUMxQixJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDWixRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1NBQ3hEO1FBRUQsSUFBSSxJQUFJLENBQUMsTUFB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U0FBQztnQkFDUCxRQUFRLEVBQUUsbUJBQW1CO2dCQUM3Qiw2bkJBQW9DOzthQUV2Qzs7O21CQU1JLEtBQUs7dUJBSUwsS0FBSzt3QkFJTCxLQUFLO21CQUlMLEtBQUs7K0JBSUwsS0FBSzs0QkFJTCxLQUFLO29CQUlMLEtBQUs7b0JBSUwsS0FBSztxQkFJTCxLQUFLO3VCQUlMLEtBQUs7dUJBTUwsS0FBSzswQkFLTCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUJhc2VDb21wb25lbnQsIFRpTG9jYWxlIH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuaW1wb3J0IHsgVHBDb3VudERvd25Db2RlLCBUcENvdW50RG93bkluZm9zIH0gZnJvbSAnLi4vY291bnRkb3duL1RwQ291bnRkb3duTW9kdWxlJztcclxuXHJcbi8qKlxyXG4gKiDlgJLorqHml7bmj5DnpLrnu4Tku7ZcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy9jb3VudGRvd25hbGVydC9jb3VudGRvd25hbGVydC1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RwLWNvdW50ZG93bmFsZXJ0JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb3VudGRvd25hbGVydC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2NvdW50ZG93bmFsZXJ0Lmxlc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFRwQ291bnRkb3duYWxlcnRDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlkYrorabnsbvlnovvvIwg6buY6K6k5Li6ZXJyb3JcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdHlwZTogJ3N1Y2Nlc3MnIHwgJ2Vycm9yJyB8ICd3YXJuJyB8ICdwcm9tcHQnID0gJ2Vycm9yJztcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5pi+56S65bem5L6n5o+Q56S657G75Z6L5Zu+5qCHXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHR5cGVJY29uOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5pi+56S65YWz6Zet5oyJ6ZKuXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNsb3NlSWNvbjogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYvuekumNvdW50ZG93bmFsZXJ0XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIG9wZW46IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKlxyXG4gICAgICog5pi+56S65aSa6ZW/5pe26Ze05ZCO5raI5aSx77yM6buY6K6k5LiN5bu26L+f5raI5aSx77yM5Y+q5Zyo54K55Ye75YWz6Zet5oyJ6ZKu5pe25raI5aSxXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGRpc21pc3NPblRpbWVvdXQ6IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm6Kem5Y+R5LiL5ouJ57G757uE5Lu25raI5aSx55qE5LqL5Lu277yM6YCC55So5LqOY291bnRkb3duYWxlcnTnmoTlkYjnjrDnirbmgIHlvbHlk43pobXpnaLkuIvmi4nnsbvnu4Tku7bkvY3nva7nmoTlnLrmma9cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdHJpZ2dlclNjcm9sbDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoqXHJcbiAgICAgKiDoh6rlrprkuYnlkYrorablhoXlrrlcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbGFiZWw6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5YCS6K6h5pe25pe26Ze05L+h5oGv77yI5pyq6YWN572ubGFiZWzml7bpnIDopoHlrprkuYnvvIlcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaW5mb3M6IFRwQ291bnREb3duSW5mb3M7XHJcbiAgICAvKipcclxuICAgICAqIOi1hOa6kOeKtuaAge+8iOacqumFjee9rmxhYmVs5pe26ZyA6KaB5a6a5LmJ77yJXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHN0YXR1czogIFRwQ291bnREb3duQ29kZTtcclxuICAgIC8qKlxyXG4gICAgICog6LWE5rqQ5ZCN56ewXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHJlc291cmNlOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOmTvuaOpeWcsOWdgFxyXG4gICAgICpcclxuICAgICAqIOWMheWRqOacn+S4uue7rei0ueaXtu+8iHN0YXR1cyA9IGh3c19jb3VudGRvd25fcGVyaW9kX2dyYWNpbmcgfCBod3NfY291bnRkb3duX3BlcmlvZF9mcm96ZW7vvInvvIzmnI3liqHpnIDopoHkvKDoh6rlrprkuYnnu63otLnpk77mjqXvvJtcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbGlua0hyZWY6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6Ieq5a6a5LmJ5a6i5pyN6IGU57O755S16K+d5Y+356CBXHJcbiAgICAgKiAxMC4xLjIg54mI5pys5paw5aKeXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHBob25lTnVtYmVyOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbm5lckxhYmVsOiBzdHJpbmcgPSAnJztcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2hvd0J1eUxpbms6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGxpbmtUZXh0OiBzdHJpbmc7XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5sYWJlbCkgeyByZXR1cm47IH1cclxuICAgICAgICAvLyDlpITnkIZsYWJlbFxyXG4gICAgICAgIGNvbnN0IGxvY2FsZVdvcmRzOiBhbnkgPSBUaUxvY2FsZS5nZXRMb2NhbGVXb3JkcygpLnRwQ291bnRkb3duYWxlcnQ7XHJcbiAgICAgICAgbGV0IHRpbWVzcGFuOiBzdHJpbmcgPSAnJztcclxuICAgICAgICBpZiAodGhpcy5pbmZvcykge1xyXG4gICAgICAgICAgICB0aW1lc3BhbiA9IHRoaXMuZ2V0VGltZXNwYW4odGhpcy5pbmZvcywgbG9jYWxlV29yZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0tleTogc3RyaW5nID0gdGhpcy5zdGF0dXMgPyB0aGlzLnN0YXR1cy5zbGljZSgxNCkgOiAnJztcclxuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGxvY2FsZVdvcmRzKS5pbmRleE9mKHN0YXR1c0tleSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbm5lckxhYmVsID0gbG9jYWxlV29yZHNbc3RhdHVzS2V5XS5yZXBsYWNlKC97VFN9LywgU3RyaW5nKHRpbWVzcGFuKSlcclxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgve1JOfS8sIHRoaXMucmVzb3VyY2UgfHwgJycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g54q25oCB5q2j5bi477yM5LiN6ZyA6KaB5pi+56S6YWxlcnRcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlpITnkIblhYXlgLznu63otLnpk77mjqXvvJrljIXlkajmnJ/kuLrnu63otLnvvIzmnI3liqHpnIDopoHkvKDoh6rlrprkuYnpk77mjqXvvJvmjInpnIDkuLrlhYXlgLzvvIzlhYXlgLzkuLrlm7rlrprpk77mjqVcclxuICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09ICdod3NfY291bnRkb3duX3BlcmlvZF9ncmFjaW5nJyB8fCB0aGlzLnN0YXR1cyA9PT0gJ2h3c19jb3VudGRvd25fcGVyaW9kX2Zyb3plbicpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93QnV5TGluayA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMubGlua1RleHQgPSBsb2NhbGVXb3Jkcy5yZW5ldztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdHVzID09PSAnaHdzX2NvdW50ZG93bl9vbmRlbWFuZF9ncmFjaW5nJyB8fCB0aGlzLnN0YXR1cyA9PT0gJ2h3c19jb3VudGRvd25fb25kZW1hbmRfZnJvemVuJykge1xyXG4gICAgICAgICAgICB0aGlzLnNob3dCdXlMaW5rID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5saW5rVGV4dCA9IGxvY2FsZVdvcmRzLnJlY2hhcmdlO1xyXG4gICAgICAgICAgICB0aGlzLmxpbmtIcmVmID0gJ2h0dHBzOi8vYWNjb3VudC5odWF3ZWljbG91ZC5jb20vdXNlcmNlbnRlci8jL3VzZXJpbmRleC9iYWxhbmNlUmVjaGFyZ2UnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5Zu96ZmF56uZIOiBlOezu+aWueW8j+WkhOeQhlxyXG4gICAgICAgIGNvbnN0IGludGxDb250YWN0UGF0aDogc3RyaW5nID0gJy90aWNrZXQvPyMvdGlja2V0aW5kZXgvY3JlYXRlZmVlZGJhY2snOyAvLyDlm73pmYXnq5nogZTns7vlrqLmnI3ot6/lvoRcclxuICAgICAgICBjb25zdCB1cmw6IHN0cmluZyA9IGAke3dpbmRvdy5sb2NhdGlvbi5wcm90b2NvbH0vLyR7d2luZG93LmxvY2F0aW9uLmhvc3R9JHtpbnRsQ29udGFjdFBhdGh9YDtcclxuICAgICAgICB0aGlzLmlubmVyTGFiZWwgPSB0aGlzLmlubmVyTGFiZWwucmVwbGFjZShcclxuICAgICAgICAgICAgL3tjb250YWN0TGlua30vLFxyXG4gICAgICAgICAgICBgPGEgY2xhc3M9XCJ0cC1jb3VudGRvd25hbGVydC1saW5rXCIgdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9vcGVuZXIgbm9yZWZlcnJlclwiICBocmVmPVwiJHt1cmx9XCI+JHtsb2NhbGVXb3Jkcy5jb250YWN0X2N1c3RvbWVyX3NlcnZpY2V9PC9hPmApO1xyXG5cclxuICAgICAgICAvLyDoh6rlrprkuYnlrqLmnI3ogZTns7vnlLXor53lj7fnoIHlpITnkIZcclxuICAgICAgICB0aGlzLmlubmVyTGFiZWwgPSB0aGlzLmlubmVyTGFiZWwucmVwbGFjZSgve3Bob25lTnVtYmVyfS8sIHRoaXMucGhvbmVOdW1iZXIgfHwgbG9jYWxlV29yZHMucGhvbmVOdW1iZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VGltZXNwYW4oaW5mb3M6IFRwQ291bnREb3duSW5mb3MsIGxvY2FsZVdvcmRzOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdHlwZWRlZlxyXG4gICAgICAgIGNvbnN0IHsgZGF5LCBob3VyLCBtaW51dGUsIHNlY29uZCB9ID0gbG9jYWxlV29yZHM7XHJcbiAgICAgICAgaWYgKGluZm9zLm5leHRPcGVyYXRpb25SZW1haW5pbmdEYXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRheS5yZXBsYWNlKC97ZH0vLCBpbmZvcy5uZXh0T3BlcmF0aW9uUmVtYWluaW5nRGF5KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGluZm9zLm5leHRPcGVyYXRpb25SZW1haW5pbmdIb3VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBob3VyLnJlcGxhY2UoL3tofS8sIGluZm9zLm5leHRPcGVyYXRpb25SZW1haW5pbmdIb3VyKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL3ttfS8sIGluZm9zLm5leHRPcGVyYXRpb25SZW1haW5pbmdNaW51dGUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaW5mb3MubmV4dE9wZXJhdGlvblJlbWFpbmluZ01pbnV0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbWludXRlLnJlcGxhY2UoL3ttfS8sIGluZm9zLm5leHRPcGVyYXRpb25SZW1haW5pbmdNaW51dGUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaW5mb3MubmV4dE9wZXJhdGlvblJlbWFpbmluZ1NlY29uZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc2Vjb25kO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==