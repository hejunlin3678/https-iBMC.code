import { Component, ElementRef, EventEmitter, Input, Output, Renderer2, ViewChild } from '@angular/core';
import { TiBaseComponent, TiLocale, Util } from '@cloud/tiny3';
import { CfUtil } from '../../cfutils/CfUtil';
/**
 * @ignore
 * 优惠场景，主要有包周期场景和按需场景，服务可根据实际类型自行配置。
 *
 * <example-url>../tinyplus3demo/#/discounts/discounts-all</example-url>
 */
export class TpDiscountsComponent extends TiBaseComponent {
    constructor(elementRef, render) {
        super(elementRef, render);
        this.elementRef = elementRef;
        this.render = render;
        /**
         * 可选优惠项切换选择项时触发
         *
         * 9.0.3 新增接口
         */
        this.discountsChange = new EventEmitter();
        /**
         * @ignore
         * 用户获取当前语言集合
         */
        this.localeWords = TiLocale.getLocaleWords();
        /**
         * @ignore
         * 用于获取词条
         */
        this.tpDiscounts = this.localeWords.tpDiscounts;
        /**
         * @ignore
         * 模板使用,判断是否为中文场景
         */
        this.isChinese = this.localeWords.tiLocaleKey === 'zh-CN';
        /**
         * @ignore
         * 模板使用,弹窗是否展开标志量
         */
        this.isOpen = false;
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        if (this.discoutsConfig.type === 'ondemand') {
            this.handleDiscounts(this.discoutsConfig.discounts);
        }
        if (this.discoutsConfig.type === 'period') {
            this.setTotalSavings();
            this.setSelectableData(this.discoutsConfig.selectableDiscounts);
        }
        this.onlistenClick = this.render.listen(window, 'click', () => this.onDocumentClick());
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        if (this.discoutsConfig.type === 'ondemand') {
            this.handleDiscounts(this.discoutsConfig.discounts);
        }
        if (this.discoutsConfig.type === 'period') {
            const change = changes['discoutsConfig'];
            if (change && !change.isFirstChange()) {
                this.setTotalSavings();
            }
            this.setSelectableData(this.discoutsConfig.selectableDiscounts);
        }
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        if (this.isOpen) {
            // 定位元素宽度
            const tipModalIconWidth = this.fontEle.nativeElement.offsetWidth;
            // 定位元素左侧靠边距离
            // 服务实际业务中，使用offselLeft获取的值不准确（缺失左侧sideBar的47px），导致较小分辨率下，挤压出横向滚动条。
            // 此处修改为getBoundingClientRect().left，在服务环境上已测试ok.
            const tipModalIconLeft = this.fontEle.nativeElement.getBoundingClientRect().left;
            // 定位元素距离右侧窗口的位置
            const tipModalIconRight = window.innerWidth - tipModalIconLeft - tipModalIconWidth;
            // 提示弹窗宽度
            const tipContainerWidth = this.containerEle.nativeElement.offsetWidth;
            // 居中显示需要的偏移量
            const offset = (tipContainerWidth - tipModalIconWidth) / 2;
            // 弹窗正常居中对齐的偏移量 - 定位元素距离左侧窗口的位置；如果大于0，说明左溢出
            const isLeftOverflow = (offset - tipModalIconLeft) > 0;
            // 弹窗正常居中对齐的偏移量 - 定位元素距离右侧窗口的位置；如果大于0，则说明右溢出。
            const isRightOverflow = (offset - tipModalIconRight) > 0;
            const distance = 20; // 溢出时，距离左侧留20px余量
            let marginLeft;
            if (isLeftOverflow) {
                marginLeft = -tipModalIconLeft + distance;
            }
            else if (isRightOverflow) {
                marginLeft = -(tipContainerWidth - tipModalIconRight - tipModalIconWidth) - distance;
            }
            else {
                marginLeft = -offset;
            }
            this.render.setStyle(this.containerEle.nativeElement, 'margin-left', marginLeft + 'px');
            this.render.setStyle(this.beforeEle.nativeElement, 'left', tipModalIconWidth / 2 + 'px');
        }
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnDestroy() {
        super.ngOnDestroy();
        if (this.onlistenClick) {
            this.onlistenClick();
        }
    }
    /**
     * @ignore
     * 单选radio点击切换选择项触发
     */
    onRadioChange($event) {
        this.setTotalSavings();
        this.discountsChange.emit($event);
    }
    /**
     * 点击documnet优惠信息窗口关闭
     */
    onDocumentClick() {
        this.isOpen = false;
    }
    /**
     * @ignore
     * 点击右上角叉号图标，弹窗关闭
     */
    onClose($event) {
        this.isOpen = false;
        $event.stopPropagation();
    }
    /**
     * @ignore
     * 模板使用，tip面板点击需要组织冒泡
     */
    onContainerClick($event) {
        $event.stopPropagation();
    }
    /**
     * @ignore
     */
    onClick($event) {
        // 当在焦点在A标签，触发回车键的时候，不需要关闭面板。
        if (event.target['tagName'] === 'A') {
            return;
        }
        this.isOpen = !this.isOpen;
        $event.stopPropagation();
    }
    // 按需优惠项信息合并
    getOndemandDiscounts(data) {
        const out = [];
        for (let i = 0; i < data.length; i++) {
            const cur = data[i];
            const n = out.findIndex((ele) => ele.label === cur.label);
            if (n > -1) {
                const item = Object.assign(Object.assign(Object.assign({}, out[n]), cur), {
                    expireTime: Util.isString(out[n].expireTime) && Util.isString(cur.expireTime) &&
                        new Date(out[n].expireTime).getTime() > new Date(cur.expireTime).getTime() ? cur.expireTime : out[n].expireTime,
                    type: this.getData(out[n].type, cur.type),
                    href: this.getData(out[n].href, cur.href)
                });
                out[n] = item;
            }
            else {
                out.push(cur);
            }
        }
        return out;
    }
    // tslint:disable-next-line:prefer-function-over-method
    getData(val1, val2) {
        if (Util.isUndefined(val2) || val2 === '') {
            return val1;
        }
        return val2;
    }
    // 根据接口type来设定详情链接，也支持用户自定义详情链接
    // tslint:disable-next-line:prefer-function-over-method
    setDetailLink(item) {
        CfUtil.getLinks()
            .then((linksData) => {
            const user_center_common = linksData && linksData.links && linksData.links.user_center_common
                ? linksData.links.user_center_common : '';
            let detailLink = '';
            switch (item.type) {
                case 0:
                    detailLink = user_center_common + this.tpDiscounts.discounts_detailLink_type0;
                    break;
                case 1:
                    detailLink = user_center_common + this.tpDiscounts.discounts_detailLink_type1;
                    break;
                case 2:
                    detailLink = user_center_common + this.tpDiscounts.discounts_detailLink_type2
                        + (Util.isUndefined(item.beId) ? '' : '&beId=' + item.beId);
                    break;
                default:
                    detailLink = Util.isString(item.href) ? item.href : '';
                    break;
            }
            detailLink = this.addLinkParams(detailLink);
            item.href = detailLink;
        });
    }
    getLink(value) {
        value.forEach((item) => {
            this.setDetailLink(item);
        });
    }
    /**
     * @ignore
     * 到期时间一周之内才显示
     */
    showExpireTime(val) {
        const nowTime = new Date().getTime();
        const expireTime = new Date(val).getTime();
        const gap = expireTime - nowTime;
        return gap > 0 && gap < 86400000 * 7;
    }
    /**
     * @ignore
     * 到期时间格式化
     */
    getFormatExpireTime(val) {
        return CfUtil.formatLocaleDateTime(val);
    }
    // 按需场景数据拼接处理
    handleDiscounts(items) {
        const ondemandDiscounts = [];
        for (let i = 0; i < items.length; i++) {
            //  类似 8折与 20% off 转换
            items[i].discountRate = !Util.isNumber(items[i].rate) ? '' :
                this.isChinese ? ` ${parseFloat((items[i].rate * 10).toFixed(2))}${this.tpDiscounts.discounts}`
                    : `; ${parseFloat(((1 - items[i].rate) * 100).toFixed(2))}%${this.tpDiscounts.discounts}`;
            ondemandDiscounts[i] = {
                rate: Util.isNumber(items[i].rate) ? items[i].rate : undefined,
                expireTime: Util.isString(items[i].expireTime) ? items[i].expireTime : '',
                type: Util.isNumber(items[i].type) ? items[i].type : undefined,
                beId: Util.isString(items[i].beId) ? items[i].beId : '',
                href: Util.isString(items[i].href) ? items[i].href : ''
            };
            let name;
            let resourceName;
            let specification;
            if (this.isChinese) {
                name = Util.isString(items[i].name) ? items[i].name : '';
                resourceName = Util.isString(items[i].resourceName) ? items[i].resourceName : '';
                specification = Util.isString(items[i].specification) ? items[i].specification : '';
            }
            else {
                name = !Util.isEmptyString(items[i].name) ? items[i].name : '';
                resourceName = !Util.isEmptyString(items[i].resourceName) ? '; ' + items[i].resourceName : '';
                specification = !Util.isEmptyString(items[i].specification) ? ', ' + items[i].specification : '';
            }
            ondemandDiscounts[i].label = name + resourceName + specification + items[i].discountRate;
        }
        this.ondemandDiscountsConfig = this.getOndemandDiscounts(ondemandDiscounts);
        this.getLink(this.ondemandDiscountsConfig);
        return this.ondemandDiscountsConfig;
    }
    // 可选数据详情链接
    getSelectableDetail(vals) {
        for (const val of vals) {
            if (!Util.isUndefined(val.href)) {
                return;
            }
            this.setDetailLink(val);
        }
    }
    // 获取agencyID和locale
    addLinkParams(url) {
        if (url === '') {
            return url;
        }
        const storage = CfUtil.getStorageService();
        if (!(!Util.isUndefined(storage) && !Util.isUndefined(storage.cookieStorage) && Util.isFunction(storage.cookieStorage.getItem))) {
            return url;
        }
        const agencyID = storage.cookieStorage.getItem('agencyID');
        const locale = storage.cookieStorage.getItem('locale');
        let finalUrl = url;
        if (!Util.isEmptyString(agencyID)) {
            finalUrl = finalUrl + '&agencyId=' + agencyID;
        }
        if (!Util.isEmptyString(locale)) {
            finalUrl = finalUrl + '&locale=' + locale;
        }
        return finalUrl;
    }
    /**
     * 优惠总额
     */
    setTotalSavings() {
        this.sum = 0;
        if (Util.isArray(this.discoutsConfig.selectedDiscounts)) {
            for (const item of this.discoutsConfig.selectedDiscounts) {
                if (!Util.isNumber(item.priceNum)) {
                    continue;
                }
                else {
                    this.sum += item.priceNum;
                }
            }
        }
        // 获取选中优惠项的索引index
        if (!Util.isUndefined(this.discoutsConfig.selectableDiscounts)) {
            const index = this.discoutsConfig.selectableDiscounts.findIndex((ele) => ele.id === this.discoutsConfig.selectedId);
            const selectedDiscountsNum = this.discoutsConfig.selectableDiscounts[index]
                && this.discoutsConfig.selectableDiscounts[index].priceNum;
            if (index > -1 && Util.isNumber(selectedDiscountsNum)) {
                this.sum += selectedDiscountsNum;
            }
        }
    }
    /**
     * @ignore
     *
     * 判断优惠总价格是否为0，总结为0不显示共省部分
     */
    isSumEqualZero() {
        this.setTotalSavings();
        const reg = new RegExp('[\.-]');
        const precision = this.discoutsConfig.numFormat ?
            Number(this.discoutsConfig.numFormat.split(reg)[2]) : 2;
        return parseFloat(this.sum.toFixed(precision)) === 0;
    }
    /**
     * 可选优惠项数据根据实际场景判断是否添加默认尾项
     */
    setSelectableData(options) {
        if (!Util.isArray(options) || options.length === 0) {
            return;
        }
        this.getSelectableDetail(options);
        const length = options.length;
        if (options[length - 1].id !== 'no-discounts') {
            options[length] = {
                label: this.tpDiscounts.no_discounts,
                id: 'no-discounts',
                href: '',
                priceNum: 0
            };
        }
    }
}
TpDiscountsComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-discounts',
                template: "<div #font tiOutline class='tp-discounts-font' [tabindex]=\"0\" (keydown.enter)= 'onClick($event)'>\r\n  <span class='tp-discounts-symbol'>{{'tpDiscounts.discounts_selected' | tiTranslate}}</span>\r\n  <span #before *ngIf='isOpen' class=\"tp-discounts-container-before\"></span>\r\n  <div #container (click)='onContainerClick($event)' [id]=\"appendId('open')\" *ngIf='isOpen' class='tp-discounts-container' [ngStyle]=\"{'max-height':discoutsConfig.maxHeight + 'px'}\">\r\n    <div *ngIf=\"discoutsConfig.type === 'ondemand'\">\r\n      <ng-container *ngTemplateOutlet='ondemand'></ng-container>\r\n    </div>\r\n    <div *ngIf=\"discoutsConfig.type === 'period'\">\r\n      <ng-container *ngTemplateOutlet='period'></ng-container>\r\n    </div>\r\n    <tp-icon local tiOutline name='cloud-close' class='tp-discounts-close' [tabindex]=\"0\" (click)=\"onClose($event)\" [id]=\"appendId('close')\"></tp-icon>\r\n  </div>\r\n</div>\r\n<!-- \u6309\u9700\u4F18\u60E0\u6298\u6263\u6A21\u677F -->\r\n<ng-template #ondemand>\r\n  <div *ngIf='discoutsConfig.discounts && discoutsConfig.discounts.length > 0'>\r\n    <span class='tp-discounts-title'>{{'tpDiscounts.discounts_selected' | tiTranslate}}</span>\r\n    <ul class='tp-ondemand-discounts-container' [id]=\"appendId('list')\">\r\n      <li class='tp-discounts-list' *ngFor='let item of ondemandDiscountsConfig | rate; index as i'>\r\n        <tp-icon local name='cloud-selected' class='tp-discounts-listfont'></tp-icon>\r\n        <span class='tp-discounts-label' [id]=\"appendId('label_' + i)\">{{item.label}}</span>\r\n        <a tiNavigationDarkbg class='tp-discounts-link' target='_blank' [href]='item.href' rel=\"noopener noreferrer\"\r\n          *ngIf='item.href' [id]=\"appendId('details_' + i)\">{{'tpDiscounts.discounts_details' | tiTranslate}}</a>\r\n        <div class='tp-discounts-expireTime' *ngIf='item.expireTime && showExpireTime(item.expireTime)'>\r\n          <span>{{'tpDiscounts.discounts_expireTime' | tiTranslate}}</span>\r\n          <span>{{getFormatExpireTime(item.expireTime)}}</span>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</ng-template>\r\n<!-- \u5305\u5468\u671F\u4F18\u60E0\u6298\u6263\u6A21\u677F -->\r\n<ng-template #period>\r\n  <span class=\"tp-discounts-title\">{{'tpDiscounts.discounts_selected' | tiTranslate}}</span>\r\n  <span class=\"tp-discounts-title\" *ngIf=\"!isSumEqualZero()\">( <span style=\"white-space:pre\">{{'tpDiscounts.savings' | tiTranslate}}</span><!--\r\n    --><span [id]=\"appendId('sum')\">{{sum | tpCurrency: discoutsConfig.numFormat}}</span><span *ngIf='discoutsConfig.measureUnit'>/{{discoutsConfig.measureUnit}}</span> ) :</span>\r\n  <div class=\"tp-selectedDiscounts-container\"\r\n    *ngIf=\"discoutsConfig.selectedDiscounts && discoutsConfig.selectedDiscounts.length > 0\">\r\n    <table style=\"width:100%\">\r\n      <tbody>\r\n        <tr *ngFor=\"let discount of discoutsConfig.selectedDiscounts | notEqualTo0; index as i\">\r\n          <td class=\"tp-discounts-list\">\r\n            <tp-icon local name='cloud-selected' class='tp-discounts-listfont'></tp-icon><!--\r\n            --><span class=\"tp-discounts-label\" [id]=\"appendId('discount_label_' + i)\"><span>{{'tpDiscounts.discounts_type' | tiTranslate}}</span><span>{{discount.resourceName}}</span></span>\r\n          </td>\r\n          <td class='tp-selectable-discounts-priceNum'>\r\n            <span class=\"tp-disconuts-num\"><span>{{'tpDiscounts.discounts_label' | tiTranslate}}</span>\r\n              <span [id]=\"appendId('discount_price_' + i)\">{{discount.priceNum | tpCurrency: discoutsConfig.numFormat}}</span><span *ngIf='discoutsConfig.measureUnit'>/{{discoutsConfig.measureUnit}}</span></span>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class=\"tp-availableDiscounts-container\"\r\n    *ngIf=\"discoutsConfig.selectableDiscounts && discoutsConfig.selectableDiscounts.length > 0\">\r\n    <p class=\"tp-discounts-label \">\r\n      <tp-icon local name='cloud-selected' class='tp-discounts-listfont'></tp-icon><span\r\n        class='tp-availablediscounts-title'>{{'tpDiscounts.discounts_available' | tiTranslate}}</span>\r\n    </p>\r\n    <div style=\"margin-left:24px\">\r\n      <table class=\"tp-radio-container\">\r\n        <tbody>\r\n          <tr *ngFor=\"let item of discoutsConfig.selectableDiscounts | notEqualTo01\">\r\n            <td class='tp-selectable-discounts'>\r\n              <input type=\"radio\" tiRadio dark name=\"discountList\" [(ngModel)]=\"discoutsConfig.selectedId\" [id]=\"appendId('radio_' + item.id)\"\r\n                (ngModelChange)='onRadioChange(item)' value=\"{{item.id}}\" label=\"{{item.label}}\" />\r\n              <a tiNavigationDarkbg class='tp-discounts-link' target='_blank' *ngIf='item.href' rel=\"noopener noreferrer\"\r\n                [href]=\"item.href\" [id]=\"appendId('details_' + item.id)\">{{'tpDiscounts.discounts_details' | tiTranslate}}</a>\r\n              <tp-icon local *ngIf='item.isRecommend' class='tp-discounts-recommend' name='cloud-recommend'></tp-icon>\r\n            </td>\r\n            <td style=\"padding-left:10px;text-align:right\">\r\n              <span *ngIf=\"item.priceNum\"\r\n                class=\"tp-disconuts-num\"><span>{{'tpDiscounts.discounts_label' | tiTranslate}}</span>\r\n                <span [id]=\"appendId('discountlist_price' + item.id)\">{{item.priceNum | tpCurrency: discoutsConfig.numFormat}}</span><span *ngIf='discoutsConfig.measureUnit'>/{{discoutsConfig.measureUnit}}</span></span>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n",
                host: {
                    '(click)': 'onClick($event)'
                },
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-discounts-container{background-color:var(--ti-common-color-bg-dark-deep);border-radius:var(--ti-common-border-radius-1);bottom:25px;box-sizing:border-box;cursor:default;left:0;overflow-y:auto;padding:var(--ti-common-space-3x) var(--ti-common-space-2x);white-space:nowrap}.tp-discounts-container,.tp-discounts-container-before{box-shadow:var(--ti-common-shadow-3-down);position:absolute}.tp-discounts-container-before{background:var(--ti-common-color-bg-dark-deep);border-bottom:1px solid var(--ti-common-color-bg-dark-deep);border-right:1px solid var(--ti-common-color-bg-dark-deep);bottom:20px;content:\"\";display:block;height:10px;margin-left:-5px;overflow:hidden;transform:rotate(45deg);width:10px}.tp-discounts-close{color:var(--ti-common-color-icon-graybg-normal);cursor:pointer;font-size:12px;position:absolute;right:10px;top:10px}.tp-discounts-close:hover{color:var(--ti-common-color-icon-darkbg-hover)}.tp-discounts-title{font-size:var(--ti-common-font-size-1);line-height:var(--ti-common-line-height-number);padding-bottom:var(--ti-common-space-base);padding-left:var(--ti-common-space-2x)}.tp-discounts-font,.tp-discounts-title{color:var(--ti-common-color-warn);display:inline-block}.tp-discounts-font{cursor:pointer;font-size:var(--ti-common-font-size-2);padding-right:var(--ti-common-space-3x);position:relative;vertical-align:text-bottom}.tp-discounts-font:hover{color:var(--ti-common-color-warn-text)}.tp-discounts-listfont{color:var(--ti-common-color-warn);font-size:var(--ti-common-font-size-2);vertical-align:text-bottom}.tp-discounts-label{color:var(--ti-common-color-text-gray);padding-left:var(--ti-common-space-2x);padding-right:var(--ti-common-space-base)}.tp-discounts-label,.tp-discounts-link{font-size:var(--ti-common-font-size-base)}.tp-discounts-list{padding-top:var(--ti-common-space-2x)}.tp-discounts-expireTime{color:var(--ti-common-color-warn);font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-left:var(--ti-common-space-6x)}.tp-ondemand-discounts-container{padding:0 var(--ti-common-space-2x)}.tp-disconuts-num{color:var(--ti-common-color-warn);font-size:var(--ti-common-font-size-base)}.tp-selectable-discounts ::ng-deep .ti3-radio-label{color:var(--ti-common-color-text-gray)!important;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);padding-right:var(--ti-common-space-base)}.tp-discounts-recommend{background-color:var(--ti-common-color-text-white);border-radius:var(--ti-common-border-radius-1);color:var(--ti-common-color-warn);display:inline-block;height:15px;margin-left:var(--ti-common-space-3x);vertical-align:middle;width:15px}.tp-discounts-recommend.tp-icon-cloud-recommend:before{line-height:1;vertical-align:super}.tp-selectedDiscounts-container{padding:0 var(--ti-common-space-2x) var(--ti-common-space-3x)}.tp-availablediscounts-title{padding-left:var(--ti-common-space-2x)}.tp-availableDiscounts-container{background-color:rgba(40,43,51,.6);margin-bottom:2px;padding:var(--ti-common-space-3x) var(--ti-common-space-2x)}.tp-availableDiscounts-container .tp-discounts-label{padding-left:0}.tp-radio-container{width:100%}.tp-radio-container td{white-space:nowrap}.tp-discounts-symbol{font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);position:relative}.tp-discounts-symbol:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid;content:\"\";height:0;position:absolute;right:-12px;top:7px;width:0}.tp-selectable-discounts-priceNum{padding-left:10px;padding-top:var(--ti-common-space-2x);text-align:right}"]
            },] }
];
TpDiscountsComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TpDiscountsComponent.propDecorators = {
    discoutsConfig: [{ type: Input }],
    discountsChange: [{ type: Output }],
    fontEle: [{ type: ViewChild, args: ['font',] }],
    containerEle: [{ type: ViewChild, args: ['container',] }],
    beforeEle: [{ type: ViewChild, args: ['before',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBEaXNjb3VudHNDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueXBsdXMzL2NvbXBvbmVudHMvZGlzY291bnRzL1RwRGlzY291bnRzQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFFVCxTQUFTLEVBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRS9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQTJGOUM7Ozs7O0dBS0c7QUFVSCxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsZUFBZTtJQUNyRCxZQUFvQixVQUFzQixFQUFVLE1BQWlCO1FBQ2pFLEtBQUssQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFEVixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQU9yRTs7OztXQUlHO1FBQ2dCLG9CQUFlLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFhM0U7OztXQUdHO1FBQ0ksZ0JBQVcsR0FBUSxRQUFRLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDcEQ7OztXQUdHO1FBQ0ksZ0JBQVcsR0FBUSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQztRQUN2RDs7O1dBR0c7UUFDSSxjQUFTLEdBQVksSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEtBQUssT0FBTyxDQUFDO1FBQ3JFOzs7V0FHRztRQUNJLFdBQU0sR0FBWSxLQUFLLENBQUM7SUExQy9CLENBQUM7SUF3REQsb0RBQW9EO0lBQ3BELFFBQVE7UUFDSixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsSUFBSSxJ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QixTQUFTLFNBQUMsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgSW5wdXQsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBSZW5kZXJlcjIsXHJcbiAgICBTaW1wbGVDaGFuZ2VzLFxyXG4gICAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRpQmFzZUNvbXBvbmVudCwgVGlMb2NhbGUsIFV0aWwgfSBmcm9tICdAY2xvdWQvdGlueTMnO1xyXG5cclxuaW1wb3J0IHsgQ2ZVdGlsIH0gZnJvbSAnLi4vLi4vY2Z1dGlscy9DZlV0aWwnO1xyXG5leHBvcnQgaW50ZXJmYWNlIFRwRGlzY291bnREZXRhaWwge1xyXG4gICAgLyoqXHJcbiAgICAgKiDmipjmiaPnp43nsbvlkI3np7BcclxuICAgICAqL1xyXG4gICAgbmFtZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5LyY5oOg6LWE5rqQ5ZCN56ewXHJcbiAgICAgKi9cclxuICAgIHJlc291cmNlTmFtZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6KeE5qC8XHJcbiAgICAgKi9cclxuICAgIHNwZWNpZmljYXRpb24/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOWwuuWvuFxyXG4gICAgICovXHJcbiAgICBzaXplPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDor6bmg4Xpk77mjqXnsbvlnotcclxuICAgICAqL1xyXG4gICAgdHlwZT86IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog5oqY5omj546HXHJcbiAgICAgKi9cclxuICAgIHJhdGU/OiBudW1iZXI7XHJcbiAgICAvKipcclxuICAgICAqIOivpuaDhemTvuaOpeWGheWuuVxyXG4gICAgICovXHJcbiAgICBocmVmPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDkvJjmg6DliLDmnJ/ml7bpl7RcclxuICAgICAqL1xyXG4gICAgZXhwaXJlVGltZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5LyY5oOg6YeR6aKdXHJcbiAgICAgKi9cclxuICAgIHByaWNlTnVtPzogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiDljIXlkajmnJ/lj6/pgInkvJjmg6DpoblpZFxyXG4gICAgICpcclxuICAgICAqIOWMheWRqOacn+WPr+mAieaLqeS8mOaDoOmhuemFjee9ruWcuuaZr+W/hemAiVxyXG4gICAgICovXHJcbiAgICBpZD86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5Li65LyY6YCJ5LyY5oOg6aG5XHJcbiAgICAgKi9cclxuICAgIGlzUmVjb21tZW5kPzogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICog5YWB6K645pyJ5aSa5L2Z55qE5bGe5oCn5a2X5q61XHJcbiAgICAgKi9cclxuICAgIFtwcm9wTmFtZTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRwRGlzY291dHNDb25maWcge1xyXG4gICAgLyoqXHJcbiAgICAgKiDkvJjmg6DlnLrmma/nsbvlnovvvIwg5aaC5YyF5ZGo5pyf44CB5oyJ6ZyA562JXHJcbiAgICAgKi9cclxuICAgIHR5cGU6ICdwZXJpb2QnIHwgJ29uZGVtYW5kJztcclxuICAgIC8qKlxyXG4gICAgICog5LyY5oOg6YeR6aKd5pWw5a2X5L2N5pWw5o6n5Yi2XHJcbiAgICAgKiDoh6rlrprkuYnkv53nlZnkvY3mlbDvvIzkvovlpoLvvJoxLjItNO+8jOihqOekuuaVtOaVsOmDqOWIhuacgOWwkeS/neeVmTHkvY3vvIzlsI/mlbDpg6jliIbmnIDlsI/kv53nlZky5L2N77yM5bCP5pWw6YOo5YiG5pyA5aSn5L+d55WZNOS9jeOAglxyXG4gICAgICog6buY6K6k5YC85Y+W6Ieq5ZCE5bGA54K5XHJcbiAgICAgKi9cclxuICAgIG51bUZvcm1hdD86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5YyF5ZGo5pyf5bey6YCJ5oup5LyY5oOg6aG5XHJcbiAgICAgKi9cclxuICAgIHNlbGVjdGVkRGlzY291bnRzPzogQXJyYXk8VHBEaXNjb3VudERldGFpbD47XHJcbiAgICAvKipcclxuICAgICAqIOWMheWRqOacn+WPr+mAieS8mOaDoOmhue+8jOiiq+mAiemhuUlEXHJcbiAgICAgKi9cclxuICAgIHNlbGVjdGVkSWQ/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOWMheWRqOacn+WPr+mAieS8mOaDoOmhuVxyXG4gICAgICovXHJcbiAgICBzZWxlY3RhYmxlRGlzY291bnRzPzogQXJyYXk8VHBEaXNjb3VudERldGFpbD47XHJcbiAgICAvKipcclxuICAgICAqIOaMiemcgOWcuuaZr+S8mOaDoOmhuVxyXG4gICAgICovXHJcbiAgICBkaXNjb3VudHM/OiBBcnJheTxUcERpc2NvdW50RGV0YWlsPjtcclxuICAgIC8qKlxyXG4gICAgICog5LyY5oOg5by556qX5pyA5aSn6auY5bqmXHJcbiAgICAgKi9cclxuICAgIG1heEhlaWdodD86IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog5LyY5oOg5Lu35qC85Y2V5L2NXHJcbiAgICAgKiAgMTAuMS4wIOaWsOWinlxyXG4gICAgICovXHJcbiAgICBtZWFzdXJlVW5pdD86IHN0cmluZztcclxufVxyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKiDkvJjmg6DlnLrmma/vvIzkuLvopoHmnInljIXlkajmnJ/lnLrmma/lkozmjInpnIDlnLrmma/vvIzmnI3liqHlj6/moLnmja7lrp7pmYXnsbvlnovoh6rooYzphY3nva7jgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy9kaXNjb3VudHMvZGlzY291bnRzLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndHAtZGlzY291bnRzJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9kaXNjb3VudHMuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9kaXNjb3VudHMubGVzcyddLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICcoY2xpY2spJzogJ29uQ2xpY2soJGV2ZW50KSdcclxuICAgIH1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUcERpc2NvdW50c0NvbXBvbmVudCBleHRlbmRzIFRpQmFzZUNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIpIHtcclxuICAgICAgICBzdXBlcihlbGVtZW50UmVmLCByZW5kZXIpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDkvJjmg6DmlbDmja7mgLvphY3nva7mjqXlj6NcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgZGlzY291dHNDb25maWc6IFRwRGlzY291dHNDb25maWc7XHJcbiAgICAvKipcclxuICAgICAqIOWPr+mAieS8mOaDoOmhueWIh+aNoumAieaLqemhueaXtuinpuWPkVxyXG4gICAgICpcclxuICAgICAqIDkuMC4zIOaWsOWinuaOpeWPo1xyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgZGlzY291bnRzQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCdmb250JykgZm9udEVsZTogRWxlbWVudFJlZjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCdjb250YWluZXInKSBjb250YWluZXJFbGU6IEVsZW1lbnRSZWY7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnYmVmb3JlJykgYmVmb3JlRWxlOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDnlKjmiLfojrflj5blvZPliY3or63oqIDpm4blkIhcclxuICAgICAqL1xyXG4gICAgcHVibGljIGxvY2FsZVdvcmRzOiBhbnkgPSBUaUxvY2FsZS5nZXRMb2NhbGVXb3JkcygpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDnlKjkuo7ojrflj5bor43mnaFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRwRGlzY291bnRzOiBhbnkgPSB0aGlzLmxvY2FsZVdvcmRzLnRwRGlzY291bnRzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmqKHmnb/kvb/nlKgs5Yik5pat5piv5ZCm5Li65Lit5paH5Zy65pmvXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0NoaW5lc2U6IGJvb2xlYW4gPSB0aGlzLmxvY2FsZVdvcmRzLnRpTG9jYWxlS2V5ID09PSAnemgtQ04nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmqKHmnb/kvb/nlKgs5by556qX5piv5ZCm5bGV5byA5qCH5b+X6YePXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc09wZW46IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5qih5p2/5L2/55SoLOaAu+S8mOaDoOminVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3VtOiBudW1iZXI7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaMiemcgOWcuuaZr+acgOe7iOmFjee9rlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25kZW1hbmREaXNjb3VudHNDb25maWc6IEFycmF5PFRwRGlzY291bnREZXRhaWw+O1xyXG5cclxuICAgIHByaXZhdGUgb25saXN0ZW5DbGljazogKCkgPT4gdm9pZDtcclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2NvdXRzQ29uZmlnLnR5cGUgPT09ICdvbmRlbWFuZCcpIHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVEaXNjb3VudHModGhpcy5kaXNjb3V0c0NvbmZpZy5kaXNjb3VudHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kaXNjb3V0c0NvbmZpZy50eXBlID09PSAncGVyaW9kJykge1xyXG4gICAgICAgICAgICB0aGlzLnNldFRvdGFsU2F2aW5ncygpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFNlbGVjdGFibGVEYXRhKHRoaXMuZGlzY291dHNDb25maWcuc2VsZWN0YWJsZURpc2NvdW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25saXN0ZW5DbGljayA9IHRoaXMucmVuZGVyLmxpc3Rlbih3aW5kb3csICdjbGljaycsICgpID0+IHRoaXMub25Eb2N1bWVudENsaWNrKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uQ2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgICAgICBpZiAodGhpcy5kaXNjb3V0c0NvbmZpZy50eXBlID09PSAnb25kZW1hbmQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRGlzY291bnRzKHRoaXMuZGlzY291dHNDb25maWcuZGlzY291bnRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzY291dHNDb25maWcudHlwZSA9PT0gJ3BlcmlvZCcpIHtcclxuICAgICAgICAgICAgY29uc3QgY2hhbmdlOiBhbnkgPSBjaGFuZ2VzWydkaXNjb3V0c0NvbmZpZyddO1xyXG4gICAgICAgICAgICBpZiAoY2hhbmdlICYmICFjaGFuZ2UuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRvdGFsU2F2aW5ncygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0YWJsZURhdGEodGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RhYmxlRGlzY291bnRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ0FmdGVyVmlld0NoZWNrZWQoKTtcclxuICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgICAgLy8g5a6a5L2N5YWD57Sg5a695bqmXHJcbiAgICAgICAgICAgIGNvbnN0IHRpcE1vZGFsSWNvbldpZHRoOiBudW1iZXIgPSB0aGlzLmZvbnRFbGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgLy8g5a6a5L2N5YWD57Sg5bem5L6n6Z2g6L656Led56a7XHJcbiAgICAgICAgICAgIC8vIOacjeWKoeWunumZheS4muWKoeS4re+8jOS9v+eUqG9mZnNlbExlZnTojrflj5bnmoTlgLzkuI3lh4bnoa7vvIjnvLrlpLHlt6bkvqdzaWRlQmFy55qENDdweO+8ie+8jOWvvOiHtOi+g+Wwj+WIhui+qOeOh+S4i++8jOaMpOWOi+WHuuaoquWQkea7muWKqOadoeOAglxyXG4gICAgICAgICAgICAvLyDmraTlpITkv67mlLnkuLpnZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ077yM5Zyo5pyN5Yqh546v5aKD5LiK5bey5rWL6K+Vb2suXHJcbiAgICAgICAgICAgIGNvbnN0IHRpcE1vZGFsSWNvbkxlZnQ6IG51bWJlciA9IHRoaXMuZm9udEVsZS5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XHJcbiAgICAgICAgICAgIC8vIOWumuS9jeWFg+e0oOi3neemu+WPs+S+p+eql+WPo+eahOS9jee9rlxyXG4gICAgICAgICAgICBjb25zdCB0aXBNb2RhbEljb25SaWdodDogbnVtYmVyID0gd2luZG93LmlubmVyV2lkdGggLSB0aXBNb2RhbEljb25MZWZ0IC0gdGlwTW9kYWxJY29uV2lkdGg7XHJcbiAgICAgICAgICAgIC8vIOaPkOekuuW8ueeql+WuveW6plxyXG4gICAgICAgICAgICBjb25zdCB0aXBDb250YWluZXJXaWR0aDogbnVtYmVyID0gdGhpcy5jb250YWluZXJFbGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgLy8g5bGF5Lit5pi+56S66ZyA6KaB55qE5YGP56e76YePXHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldDogbnVtYmVyID0gKHRpcENvbnRhaW5lcldpZHRoIC0gdGlwTW9kYWxJY29uV2lkdGgpIC8gMjtcclxuICAgICAgICAgICAgLy8g5by556qX5q2j5bi45bGF5Lit5a+56b2Q55qE5YGP56e76YePIC0g5a6a5L2N5YWD57Sg6Led56a75bem5L6n56qX5Y+j55qE5L2N572u77yb5aaC5p6c5aSn5LqOMO+8jOivtOaYjuW3pua6ouWHulxyXG4gICAgICAgICAgICBjb25zdCBpc0xlZnRPdmVyZmxvdzogYm9vbGVhbiA9IChvZmZzZXQgLSB0aXBNb2RhbEljb25MZWZ0KSA+IDA7XHJcbiAgICAgICAgICAgIC8vIOW8ueeql+ato+W4uOWxheS4reWvuem9kOeahOWBj+enu+mHjyAtIOWumuS9jeWFg+e0oOi3neemu+WPs+S+p+eql+WPo+eahOS9jee9ru+8m+WmguaenOWkp+S6jjDvvIzliJnor7TmmI7lj7PmuqLlh7rjgIJcclxuICAgICAgICAgICAgY29uc3QgaXNSaWdodE92ZXJmbG93OiBib29sZWFuID0gKG9mZnNldCAtIHRpcE1vZGFsSWNvblJpZ2h0KSA+IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlOiBudW1iZXIgPSAyMDsgLy8g5rqi5Ye65pe277yM6Led56a75bem5L6n55WZMjBweOS9memHj1xyXG4gICAgICAgICAgICBsZXQgbWFyZ2luTGVmdDogbnVtYmVyO1xyXG4gICAgICAgICAgICBpZiAoaXNMZWZ0T3ZlcmZsb3cpIHtcclxuICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQgPSAtdGlwTW9kYWxJY29uTGVmdCArIGRpc3RhbmNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzUmlnaHRPdmVyZmxvdykge1xyXG4gICAgICAgICAgICAgICAgbWFyZ2luTGVmdCA9IC0odGlwQ29udGFpbmVyV2lkdGggLSB0aXBNb2RhbEljb25SaWdodCAtIHRpcE1vZGFsSWNvbldpZHRoKSAtIGRpc3RhbmNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWFyZ2luTGVmdCA9IC1vZmZzZXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5jb250YWluZXJFbGUubmF0aXZlRWxlbWVudCwgJ21hcmdpbi1sZWZ0JywgbWFyZ2luTGVmdCArICdweCcpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmJlZm9yZUVsZS5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIHRpcE1vZGFsSWNvbldpZHRoIC8gMiArICdweCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xyXG4gICAgICAgIGlmICh0aGlzLm9ubGlzdGVuQ2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5vbmxpc3RlbkNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Y2V6YCJcmFkaW/ngrnlh7vliIfmjaLpgInmi6npobnop6blj5FcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uUmFkaW9DaGFuZ2UoJGV2ZW50OiBFdmVudCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0VG90YWxTYXZpbmdzKCk7XHJcbiAgICAgICAgdGhpcy5kaXNjb3VudHNDaGFuZ2UuZW1pdCgkZXZlbnQpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDngrnlh7tkb2N1bW5ldOS8mOaDoOS/oeaBr+eql+WPo+WFs+mXrVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9uRG9jdW1lbnRDbGljaygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDngrnlh7vlj7PkuIrop5Llj4nlj7flm77moIfvvIzlvLnnqpflhbPpl61cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xvc2UoJGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5qih5p2/5L2/55So77yMdGlw6Z2i5p2/54K55Ye76ZyA6KaB57uE57uH5YaS5rOhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkNvbnRhaW5lckNsaWNrKCRldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkNsaWNrKCRldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgLy8g5b2T5Zyo54Sm54K55ZyoQeagh+etvu+8jOinpuWPkeWbnui9pumUrueahOaXtuWAme+8jOS4jemcgOimgeWFs+mXremdouadv+OAglxyXG4gICAgICAgIGlmIChldmVudC50YXJnZXRbJ3RhZ05hbWUnXSA9PT0gJ0EnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc09wZW4gPSAhdGhpcy5pc09wZW47XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLy8g5oyJ6ZyA5LyY5oOg6aG55L+h5oGv5ZCI5bm2XHJcbiAgICBwcml2YXRlIGdldE9uZGVtYW5kRGlzY291bnRzKGRhdGE6IEFycmF5PFRwRGlzY291bnREZXRhaWw+KTogQXJyYXk8VHBEaXNjb3VudERldGFpbD4ge1xyXG4gICAgICAgIGNvbnN0IG91dDogQXJyYXk8VHBEaXNjb3VudERldGFpbD4gPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjdXI6IFRwRGlzY291bnREZXRhaWwgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICBjb25zdCBuOiBudW1iZXIgPSBvdXQuZmluZEluZGV4KChlbGU6IGFueSkgPT4gZWxlLmxhYmVsID09PSBjdXIubGFiZWwpO1xyXG4gICAgICAgICAgICBpZiAobiA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtOiBUcERpc2NvdW50RGV0YWlsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLm91dFtuXSxcclxuICAgICAgICAgICAgICAgICAgICAuLi5jdXIsXHJcbiAgICAgICAgICAgICAgICAgICAgLi4ue1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBpcmVUaW1lOiBVdGlsLmlzU3RyaW5nKG91dFtuXS5leHBpcmVUaW1lKSAmJiBVdGlsLmlzU3RyaW5nKGN1ci5leHBpcmVUaW1lKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUob3V0W25dLmV4cGlyZVRpbWUpLmdldFRpbWUoKSA+IG5ldyBEYXRlKGN1ci5leHBpcmVUaW1lKS5nZXRUaW1lKCkgPyBjdXIuZXhwaXJlVGltZSA6IG91dFtuXS5leHBpcmVUaW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmdldERhdGEob3V0W25dLnR5cGUsIGN1ci50eXBlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjogdGhpcy5nZXREYXRhKG91dFtuXS5ocmVmLCBjdXIuaHJlZilcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgb3V0W25dID0gaXRlbTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG91dC5wdXNoKGN1cik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvdXQ7XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZ1bmN0aW9uLW92ZXItbWV0aG9kXHJcbiAgICBwcml2YXRlIGdldERhdGEodmFsMTogYW55LCB2YWwyOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIGlmIChVdGlsLmlzVW5kZWZpbmVkKHZhbDIpIHx8IHZhbDIgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWwxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbDI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5qC55o2u5o6l5Y+jdHlwZeadpeiuvuWumuivpuaDhemTvuaOpe+8jOS5n+aUr+aMgeeUqOaIt+iHquWumuS5ieivpuaDhemTvuaOpVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mdW5jdGlvbi1vdmVyLW1ldGhvZFxyXG4gICAgcHJpdmF0ZSBzZXREZXRhaWxMaW5rKGl0ZW06IFRwRGlzY291bnREZXRhaWwpOiB2b2lkIHtcclxuICAgICAgICBDZlV0aWwuZ2V0TGlua3MoKVxyXG4gICAgICAgIC50aGVuKChsaW5rc0RhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyX2NlbnRlcl9jb21tb246IHN0cmluZyA9IGxpbmtzRGF0YSAmJiBsaW5rc0RhdGEubGlua3MgJiYgbGlua3NEYXRhLmxpbmtzLnVzZXJfY2VudGVyX2NvbW1vblxyXG4gICAgICAgICAgICAgICAgPyBsaW5rc0RhdGEubGlua3MudXNlcl9jZW50ZXJfY29tbW9uIDogJyc7XHJcbiAgICAgICAgICAgIGxldCBkZXRhaWxMaW5rOiBzdHJpbmcgPSAnJztcclxuICAgICAgICAgICAgc3dpdGNoIChpdGVtLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICBkZXRhaWxMaW5rID0gdXNlcl9jZW50ZXJfY29tbW9uICsgdGhpcy50cERpc2NvdW50cy5kaXNjb3VudHNfZGV0YWlsTGlua190eXBlMDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICBkZXRhaWxMaW5rID0gdXNlcl9jZW50ZXJfY29tbW9uICsgdGhpcy50cERpc2NvdW50cy5kaXNjb3VudHNfZGV0YWlsTGlua190eXBlMTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICBkZXRhaWxMaW5rID0gdXNlcl9jZW50ZXJfY29tbW9uICsgdGhpcy50cERpc2NvdW50cy5kaXNjb3VudHNfZGV0YWlsTGlua190eXBlMlxyXG4gICAgICAgICAgICAgICAgICAgICsgKFV0aWwuaXNVbmRlZmluZWQoaXRlbS5iZUlkKSA/ICcnIDogJyZiZUlkPScgKyBpdGVtLmJlSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBkZXRhaWxMaW5rID0gVXRpbC5pc1N0cmluZyhpdGVtLmhyZWYpID8gaXRlbS5ocmVmIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGV0YWlsTGluayA9IHRoaXMuYWRkTGlua1BhcmFtcyhkZXRhaWxMaW5rKTtcclxuICAgICAgICAgICAgaXRlbS5ocmVmID0gZGV0YWlsTGluaztcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldExpbmsodmFsdWU6IEFycmF5PFRwRGlzY291bnREZXRhaWw+KTogdm9pZCB7XHJcbiAgICAgICAgdmFsdWUuZm9yRWFjaCgoaXRlbTogVHBEaXNjb3VudERldGFpbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldERldGFpbExpbmsoaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWIsOacn+aXtumXtOS4gOWRqOS5i+WGheaJjeaYvuekulxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2hvd0V4cGlyZVRpbWUodmFsOiBEYXRlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3Qgbm93VGltZTogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgY29uc3QgZXhwaXJlVGltZTogbnVtYmVyID0gbmV3IERhdGUodmFsKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgY29uc3QgZ2FwOiBudW1iZXIgPSBleHBpcmVUaW1lIC0gbm93VGltZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGdhcCA+IDAgJiYgZ2FwIDwgODY0MDAwMDAgKiA3O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDliLDmnJ/ml7bpl7TmoLzlvI/ljJZcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEZvcm1hdEV4cGlyZVRpbWUodmFsOiBEYXRlKTogYW55IHtcclxuICAgICAgICByZXR1cm4gQ2ZVdGlsLmZvcm1hdExvY2FsZURhdGVUaW1lKHZhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5oyJ6ZyA5Zy65pmv5pWw5o2u5ou85o6l5aSE55CGXHJcbiAgICBwcml2YXRlIGhhbmRsZURpc2NvdW50cyhpdGVtczogQXJyYXk8VHBEaXNjb3VudERldGFpbD4pOiBBcnJheTxhbnk+IHtcclxuICAgICAgICBjb25zdCBvbmRlbWFuZERpc2NvdW50czogQXJyYXk8YW55PiA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAvLyAg57G75Ly8IDjmipjkuI4gMjAlIG9mZiDovazmjaJcclxuICAgICAgICAgICAgaXRlbXNbaV0uZGlzY291bnRSYXRlID0gIVV0aWwuaXNOdW1iZXIoaXRlbXNbaV0ucmF0ZSkgPyAnJyA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2hpbmVzZSA/IGAgJHtwYXJzZUZsb2F0KChpdGVtc1tpXS5yYXRlICogMTApLnRvRml4ZWQoMikpfSR7dGhpcy50cERpc2NvdW50cy5kaXNjb3VudHN9YFxyXG4gICAgICAgICAgICAgICAgOiBgOyAke3BhcnNlRmxvYXQoKCgxIC0gaXRlbXNbaV0ucmF0ZSkgKiAxMDApLnRvRml4ZWQoMikpfSUke3RoaXMudHBEaXNjb3VudHMuZGlzY291bnRzfWA7XHJcbiAgICAgICAgICAgIG9uZGVtYW5kRGlzY291bnRzW2ldID0ge1xyXG4gICAgICAgICAgICAgICAgcmF0ZTogVXRpbC5pc051bWJlcihpdGVtc1tpXS5yYXRlKSA/IGl0ZW1zW2ldLnJhdGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBleHBpcmVUaW1lOiBVdGlsLmlzU3RyaW5nKGl0ZW1zW2ldLmV4cGlyZVRpbWUpID8gaXRlbXNbaV0uZXhwaXJlVGltZSA6ICcnLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogVXRpbC5pc051bWJlcihpdGVtc1tpXS50eXBlKSA/IGl0ZW1zW2ldLnR5cGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBiZUlkOiBVdGlsLmlzU3RyaW5nKGl0ZW1zW2ldLmJlSWQpID8gaXRlbXNbaV0uYmVJZCA6ICcnLFxyXG4gICAgICAgICAgICAgICAgaHJlZjogVXRpbC5pc1N0cmluZyhpdGVtc1tpXS5ocmVmKSA/IGl0ZW1zW2ldLmhyZWYgOiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbGV0IG5hbWU6IHN0cmluZztcclxuICAgICAgICAgICAgbGV0IHJlc291cmNlTmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICBsZXQgc3BlY2lmaWNhdGlvbjogc3RyaW5nO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0NoaW5lc2UpIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBVdGlsLmlzU3RyaW5nKGl0ZW1zW2ldLm5hbWUpID8gaXRlbXNbaV0ubmFtZSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lID0gVXRpbC5pc1N0cmluZyhpdGVtc1tpXS5yZXNvdXJjZU5hbWUpID8gaXRlbXNbaV0ucmVzb3VyY2VOYW1lIDogJyc7XHJcbiAgICAgICAgICAgICAgICBzcGVjaWZpY2F0aW9uID0gVXRpbC5pc1N0cmluZyhpdGVtc1tpXS5zcGVjaWZpY2F0aW9uKSA/IGl0ZW1zW2ldLnNwZWNpZmljYXRpb24gOiAnJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSAhVXRpbC5pc0VtcHR5U3RyaW5nKGl0ZW1zW2ldLm5hbWUpID8gaXRlbXNbaV0ubmFtZSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lID0gIVV0aWwuaXNFbXB0eVN0cmluZyhpdGVtc1tpXS5yZXNvdXJjZU5hbWUpID8gJzsgJyArIGl0ZW1zW2ldLnJlc291cmNlTmFtZSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgc3BlY2lmaWNhdGlvbiA9ICFVdGlsLmlzRW1wdHlTdHJpbmcoaXRlbXNbaV0uc3BlY2lmaWNhdGlvbikgPyAnLCAnICsgaXRlbXNbaV0uc3BlY2lmaWNhdGlvbiA6ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9uZGVtYW5kRGlzY291bnRzW2ldLmxhYmVsID0gbmFtZSArIHJlc291cmNlTmFtZSArIHNwZWNpZmljYXRpb24gKyBpdGVtc1tpXS5kaXNjb3VudFJhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25kZW1hbmREaXNjb3VudHNDb25maWcgPSB0aGlzLmdldE9uZGVtYW5kRGlzY291bnRzKG9uZGVtYW5kRGlzY291bnRzKTtcclxuICAgICAgICB0aGlzLmdldExpbmsodGhpcy5vbmRlbWFuZERpc2NvdW50c0NvbmZpZyk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm9uZGVtYW5kRGlzY291bnRzQ29uZmlnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWPr+mAieaVsOaNruivpuaDhemTvuaOpVxyXG4gICAgcHJpdmF0ZSBnZXRTZWxlY3RhYmxlRGV0YWlsKHZhbHM6IEFycmF5PFRwRGlzY291bnREZXRhaWw+KTogdm9pZCB7XHJcbiAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgdmFscykge1xyXG4gICAgICAgICAgICBpZiAoIVV0aWwuaXNVbmRlZmluZWQodmFsLmhyZWYpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXREZXRhaWxMaW5rKHZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g6I635Y+WYWdlbmN5SUTlkoxsb2NhbGVcclxuICAgIHByaXZhdGUgYWRkTGlua1BhcmFtcyh1cmw6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHVybCA9PT0gJycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc3RvcmFnZTogYW55ID0gQ2ZVdGlsLmdldFN0b3JhZ2VTZXJ2aWNlKCk7XHJcbiAgICAgICAgaWYgKCEoIVV0aWwuaXNVbmRlZmluZWQoc3RvcmFnZSkgJiYgIVV0aWwuaXNVbmRlZmluZWQoc3RvcmFnZS5jb29raWVTdG9yYWdlKSAmJiBVdGlsLmlzRnVuY3Rpb24oc3RvcmFnZS5jb29raWVTdG9yYWdlLmdldEl0ZW0pKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBhZ2VuY3lJRDogYW55ID0gc3RvcmFnZS5jb29raWVTdG9yYWdlLmdldEl0ZW0oJ2FnZW5jeUlEJyk7XHJcbiAgICAgICAgY29uc3QgbG9jYWxlOiBhbnkgPSBzdG9yYWdlLmNvb2tpZVN0b3JhZ2UuZ2V0SXRlbSgnbG9jYWxlJyk7XHJcbiAgICAgICAgbGV0IGZpbmFsVXJsOiBzdHJpbmcgPSB1cmw7XHJcbiAgICAgICAgaWYgKCFVdGlsLmlzRW1wdHlTdHJpbmcoYWdlbmN5SUQpKSB7XHJcbiAgICAgICAgICAgIGZpbmFsVXJsID0gZmluYWxVcmwgKyAnJmFnZW5jeUlkPScgKyBhZ2VuY3lJRDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFVdGlsLmlzRW1wdHlTdHJpbmcobG9jYWxlKSkge1xyXG4gICAgICAgICAgICBmaW5hbFVybCA9IGZpbmFsVXJsICsgJyZsb2NhbGU9JyArIGxvY2FsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmaW5hbFVybDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS8mOaDoOaAu+minVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldFRvdGFsU2F2aW5ncygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnN1bSA9IDA7XHJcbiAgICAgICAgaWYgKFV0aWwuaXNBcnJheSh0aGlzLmRpc2NvdXRzQ29uZmlnLnNlbGVjdGVkRGlzY291bnRzKSkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RlZERpc2NvdW50cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFVdGlsLmlzTnVtYmVyKGl0ZW0ucHJpY2VOdW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VtICs9IGl0ZW0ucHJpY2VOdW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6I635Y+W6YCJ5Lit5LyY5oOg6aG555qE57Si5byVaW5kZXhcclxuICAgICAgICBpZiAoIVV0aWwuaXNVbmRlZmluZWQodGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RhYmxlRGlzY291bnRzKSkge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleDogbnVtYmVyID0gdGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RhYmxlRGlzY291bnRzLmZpbmRJbmRleCgoZWxlOiBhbnkpID0+IGVsZS5pZCA9PT0gdGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RlZElkKVxyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZERpc2NvdW50c051bTogbnVtYmVyID0gdGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RhYmxlRGlzY291bnRzW2luZGV4XVxyXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5kaXNjb3V0c0NvbmZpZy5zZWxlY3RhYmxlRGlzY291bnRzW2luZGV4XS5wcmljZU51bTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEgJiYgVXRpbC5pc051bWJlcihzZWxlY3RlZERpc2NvdW50c051bSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3VtICs9IHNlbGVjdGVkRGlzY291bnRzTnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICog5Yik5pat5LyY5oOg5oC75Lu35qC85piv5ZCm5Li6MO+8jOaAu+e7k+S4ujDkuI3mmL7npLrlhbHnnIHpg6jliIZcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzU3VtRXF1YWxaZXJvKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHRoaXMuc2V0VG90YWxTYXZpbmdzKCk7XHJcbiAgICAgICAgY29uc3QgcmVnOiBSZWdFeHAgPSBuZXcgUmVnRXhwKCdbXFwuLV0nKTtcclxuICAgICAgICBjb25zdCBwcmVjaXNpb246IG51bWJlciA9IHRoaXMuZGlzY291dHNDb25maWcubnVtRm9ybWF0ID9cclxuICAgICAgICBOdW1iZXIodGhpcy5kaXNjb3V0c0NvbmZpZy5udW1Gb3JtYXQuc3BsaXQocmVnKVsyXSkgOiAyO1xyXG5cclxuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLnN1bS50b0ZpeGVkKHByZWNpc2lvbikpID09PSAwO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlj6/pgInkvJjmg6DpobnmlbDmja7moLnmja7lrp7pmYXlnLrmma/liKTmlq3mmK/lkKbmt7vliqDpu5jorqTlsL7poblcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRTZWxlY3RhYmxlRGF0YShvcHRpb25zOiBBcnJheTxUcERpc2NvdW50RGV0YWlsPik6IHZvaWQge1xyXG4gICAgICAgIGlmICghVXRpbC5pc0FycmF5KG9wdGlvbnMpIHx8IG9wdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRTZWxlY3RhYmxlRGV0YWlsKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBsZW5ndGg6IG51bWJlciA9IG9wdGlvbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAob3B0aW9uc1tsZW5ndGggLSAxXS5pZCAhPT0gJ25vLWRpc2NvdW50cycpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnNbbGVuZ3RoXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy50cERpc2NvdW50cy5ub19kaXNjb3VudHMsXHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICduby1kaXNjb3VudHMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhyZWY6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlTnVtOiAwXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19