import { Component, ContentChildren, ElementRef, EventEmitter, Input, NgZone, Output, QueryList, Renderer2, ViewChild
// tslint:disable-next-line: no-implicit-dependencies
 } from '@angular/core';
// tslint:disable-next-line: no-implicit-dependencies
import { TiBaseComponent } from '@cloud/tiny3';
// tslint:disable-next-line: no-implicit-dependencies
import { TpCardComponent } from '../card/TpCardModule';
/**
 * @ignore
 * 规范提出，云业务通用场景不会使用该组件，10.1.3起，在官网隐藏该组件。
 * 滚动卡片列表，功能与轮播图相似，可以显示多屏展示卡片的效果，并且还提供了增加、删除卡片功能。详情参考测试用例。
 *
 * <example-url>../tinyplus3demo/#/slidecards/slidecards-all</example-url>
 */
export class TpSlidecardsComponent extends TiBaseComponent {
    constructor(hostRef, renderer2, zone) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.zone = zone;
        /**
         * 当前选中卡片在数组中的下标
         */
        this.currentIndex = 0;
        /**
         * 当前页改变事件
         */
        this.pageChange = new EventEmitter();
        /**
         * @ignore
         * 当前页
         */
        this.currentPage = 1;
        /**
         * 卡片之间的距离，用于计算分页
         */
        this.cardSpan = 0;
        /**
         * @ignore
         * 卡片父元素的偏移距离，用于控制卡片左右滑动
         */
        this.left = '0px';
        /**
         * @ignore
         * 分页页码显示数据
         */
        this.pageList = [];
        /**
         * 每页卡片数
         */
        this.pageSize = 1;
        /**
         * @ignore
         * 分页总页数
         */
        this.totalPage = 1;
        /**
         * 总的卡片数量
         */
        this.totalCard = 0;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 一屏显示卡片的数目会随窗口大小而变化，所以监听窗口大小变化重新计算分页，
        this.zone.runOutsideAngular(() => {
            this.unlistenResize = this.renderer2.listen(window, 'resize', () => {
                if (this.canCalculatePaging()) {
                    this.calculatePaging();
                }
            });
        });
    }
    /**
     * 因为初始化要展示当前索引卡片，所以在初始化后先计算一次分页，然后显示currentIndex卡片
     * 分页的计算依赖视图可视区的宽度，视图加载完成后才能计算，
     * 分页计算后，会改变数据，所以用setTimeout。
     *  总卡片数及cardsComRef 长度， pageSize = 容器宽度/（卡片宽度 + 卡片间的距离）
     */
    ngAfterViewInit() {
        super.ngAfterViewInit();
        // 初始化时计算一次分页，然后把当前索引的卡片显示出来
        if (this.canCalculatePaging()) {
            setTimeout(() => {
                this.calculatePaging();
                this.showCurrentCard(this.currentIndex);
            }, 0);
        }
        this.listObserver = new MutationObserver((mutationRecords) => {
            this.calculatePaging();
        });
        // MutationObserver 对象的回调方法开始接收与给定选项匹配的DOM变化的通知
        // 只需关注卡片增删和lef偏移值，所以只设置childList、attributes
        this.listObserver.observe(this.listEleRef.nativeElement, {
            childList: true,
            attributes: true,
            attributeFilter: ['style'] // 要监视的特定属性名称的数组
        });
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // currentIndex 改变跳转到对应页显示当前索引卡片
        const currentIndexChange = changes['currentIndex'];
        if (!currentIndexChange.firstChange) {
            this.showCurrentCard(currentIndexChange.currentValue);
        }
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        // 组件销毁时，注销窗口resize事件监听
        if (this.unlistenResize) {
            this.unlistenResize();
        }
        if (this.listObserver) {
            this.listObserver.disconnect();
        }
    }
    /**
     * 是否能进行分页计算
     * @returns boolean
     */
    canCalculatePaging() {
        return this.listWrapperEleRef && this.cardComRefs && this.cardComRefs.length > 0;
    }
    /**
     * 先计算分页每页的卡片数pageSize，再计算总页数totalPage
     */
    calculatePaging() {
        this.calculatePageSize();
        this.calculateTotalPage();
    }
    /**
     * 计算分页总页数
     */
    calculateTotalPage() {
        this.totalCard = this.cardComRefs.length;
        // 计算共有多少页
        this.totalPage = Math.ceil(this.totalCard / this.pageSize);
        // 生成分页器显示数组
        this.generatePagesArray();
        // 重新计算总页面后，需要处理当前页大于总页数的场景
        if (this.currentPage > this.totalPage) {
            this.goPage(this.totalPage);
        }
    }
    /**
     * 计算一次显示的卡片数
     */
    calculatePageSize() {
        // getComputedStyle 获取的宽度，在ie11下不包含padding和border,所以使用getBoundingClientRect（）
        // 在初始化时，totalPage还没有计算出来，左右翻页按钮没有显示，但容器元素的可用宽度应该减去左右按钮的宽度之和30+30=60
        const containerWidth = this.listWrapperEleRef.nativeElement.getBoundingClientRect().width - 60;
        this.cardWidth = this.cardComRefs.first.nativeElement.getBoundingClientRect().width;
        const cardStyle = getComputedStyle(this.cardComRefs.first.nativeElement);
        this.cardSpan = parseFloat(cardStyle.marginRight);
        // 当容器宽度小于card宽度时,需处理，避免分页不能正常生成
        this.pageSize = containerWidth <= (this.cardWidth + this.cardSpan) ? 1 : Math.floor(containerWidth / (this.cardWidth + this.cardSpan));
    }
    /**
     * 生成分页器显示的数组
     */
    generatePagesArray() {
        this.pageList = [];
        // 判断总页数如果小于等于分页的长度，若小于则直接显示
        if (this.totalPage <= 8) {
            for (let i = 1; i <= this.totalPage; i++) {
                this.pageList.push(i);
            }
        }
        else if (this.currentPage <= 3) {
            // 右边...
            for (let i = 1; i <= 5; i++) {
                this.pageList.push(i);
            }
            this.pageList.push('...');
            this.pageList.push(this.totalPage);
        }
        else if (this.currentPage >= this.totalPage - 3) {
            // 左边 ...
            this.pageList.push(1);
            this.pageList.push('...');
            for (let i = 4; i >= 1; i--) {
                this.pageList.push(this.totalPage - i);
            }
            this.pageList.push(this.totalPage);
        }
        else {
            // 最后一种情况，两边都有...
            this.pageList.push(1);
            this.pageList.push('...');
            for (let i = 2; i >= 1; i--) {
                this.pageList.push(this.currentPage - i);
            }
            this.pageList.push(this.currentPage);
            for (let i = 1; i < 2; i++) {
                this.pageList.push(this.currentPage + i);
            }
            this.pageList.push('...');
            this.pageList.push(this.totalPage);
        }
    }
    /**
     * 指定页码翻页
     * @param pageNum 跳转到的页码
     * @ignore
     */
    goPage(pageNum) {
        // ... 时，不做处理
        if (typeof pageNum === 'string') {
            return;
        }
        this.currentPage = pageNum;
        // 偏移量=(当前页-1)*每页的卡片数量*（卡片宽度 + 卡片的Margin)
        this.left = -(pageNum - 1) * this.pageSize * (this.cardWidth + this.cardSpan) + 'px';
        // 触发pageChange事件
        const data = {
            currentPage: pageNum,
            pageSize: this.pageSize,
            totalPage: this.totalPage
        };
        this.pageChange.emit(data);
    }
    /**
     * 向前跳转一页
     * @ignore
     */
    goPrev() {
        if (this.currentPage > 1) {
            this.goPage(this.currentPage - 1);
        }
    }
    /**
     * 向后跳转一页
     * @ignore
     */
    goNext() {
        if (this.currentPage < this.totalPage) {
            this.goPage(this.currentPage + 1);
        }
    }
    /**
     * 展示指定索引的卡片，在初始化及currentIndex 改变时，如果指定索引不在当前页，跳转到能显示c索引对应卡片的页码
     */
    showCurrentCard(index) {
        // 如果索引和卡片的数目不匹配，不做处理。
        if (index < 0 && index > (this.totalCard - 1)) {
            return;
        }
        // 当前一屏卡片的最大最小索引
        const maxIndex = this.currentPage * this.pageSize - 1;
        const minIndex = this.currentPage > 0 ? ((this.currentPage - 1) * this.pageSize - 1) : 0;
        // 当前索卡片是否在当前页面
        if (index < minIndex || index > maxIndex) {
            const targetPage = Math.ceil((index + 1) / this.pageSize);
            this.goPage(targetPage);
        }
    }
}
TpSlidecardsComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-slidecards',
                template: "<!-- \u9875\u7801\u5BFC\u822A -->\r\n<ul class=\"tp-slidecards-pager\" [id]=\"appendId('list')\">\r\n  <ng-container  *ngIf=\"totalPage > 1\">\r\n    <li class=\"tp-slidecards-pager-item\"\r\n        *ngFor=\"let page of pageList; index as index\"\r\n        (click)=\"goPage(page)\"\r\n        [id]=\"appendId('page_' + index)\"\r\n        [ngClass]=\"{'tp-slidecards-pager-item-active': currentPage === page,\r\n                    'tp-slidecards-pager-ellipsis': page === '...'}\">\r\n        <span>{{page}}</span>\r\n     </li>\r\n  </ng-container>\r\n</ul>\r\n<!-- \u5185\u5BB9\u533A -->\r\n<div class=\"tp-slidecards-content\">\r\n  <!-- \u5DE6\u6309\u94AE -->\r\n  <div\r\n    class=\"tp-slidecards-button-prev\"\r\n    *ngIf=\"totalPage > 1\"\r\n    (click)=\"goPrev()\"\r\n    [id]=\"appendId('prev')\"\r\n    [ngClass]=\"{'tp-slidecards-button-disabled': currentPage <= 1}\"\r\n  >\r\n    <tp-icon local name=\"cloud-action-prev\"></tp-icon>\r\n  </div>\r\n  <!-- \u5217\u8868 -->\r\n<div #listWrapper class=\"tp-slidecards-wrapper\">\r\n    <div #list class=\"tp-slidecards-list \" [ngStyle]=\"{'left': left}\">\r\n      <ng-content></ng-content>\r\n    </div>\r\n  </div>\r\n  <!-- \u53F3\u6309\u94AE -->\r\n  <div\r\n    class=\"tp-slidecards-button-next\"\r\n    *ngIf=\"totalPage > 1\"\r\n    [ngClass]=\"{'tp-slidecards-button-disabled': currentPage >= totalPage}\"\r\n    (click)=\"goNext()\"\r\n    [id]=\"appendId('next')\"\r\n  >\r\n    <tp-icon local name=\"cloud-action-next\"></tp-icon>\r\n  </div>\r\n</div>\r\n",
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}::ng-deep :root{--tp-page-turning-icon-height:24px;--tp-page-turning-width:22px;--tp-slidecards-list-width:9999999px;--tp-slidecards-pager-item-width:20px;--tp-slidecars-pager-item-height:24px}:host{display:block}.tp-slidecards-pager{height:var(--tp-slidecars-pager-item-height);padding-bottom:var(--ti-common-space-10);text-align:center;width:100%}.tp-slidecards-pager-item{border-radius:var(--ti-common-border-radius-normal);color:var(--ti-common-color-text-secondary);cursor:pointer;display:inline-block;height:var(--tp-slidecars-pager-item-height);line-height:var(--tp-slidecars-pager-item-height);margin-left:var(--ti-common-space-base);width:var(--tp-slidecards-pager-item-width)}.tp-slidecards-pager-ellipsis{cursor:default}.tp-slidecards-pager-item:not(.tp-slidecards-pager-ellipsis):hover{background-color:var(--ti-common-color-bg-light-normal);color:var(--ti-common-color-text-highlight)}.tp-slidecards-pager-item.tp-slidecards-pager-item-active{background-color:var(--ti-common-color-bg-light-normal);color:var(--ti-common-color-text-primary)}.tp-slidecards-pager-item.tp-slidecards-pager-item-active:hover,.tp-slidecards-pager-item:not(.tp-slidecards-pager-ellipsis):active{background-color:var(--ti-common-color-bg-emphasize);color:var(--ti-common-color-text-white)}.tp-slidecards-content{-moz-align-items:stretch;-moz-flex-direction:row;-moz-justify-content:flex-start;-ms-align-items:stretch;-ms-justify-content:flex-start;align-items:stretch;display:flex;flex-direction:row;justify-content:flex-start}.tp-slidecards-button-next,.tp-slidecards-button-prev{-moz-align-items:center;-moz-flex-direction:row;-moz-justify-content:center;-ms-align-items:center;-ms-justify-content:center;align-items:center;cursor:pointer;display:flex;flex-direction:row;font-size:var(--ti-common-font-size-1);justify-content:center;width:var(--tp-page-turning-width)}.tp-slidecards-button-next tp-icon,.tp-slidecards-button-prev tp-icon{color:var(--ti-common-color-icon-normal);display:inline-block;height:var(--tp-page-turning-icon-height);line-height:var(--tp-page-turning-icon-height);width:var(--tp-page-turning-width)}.tp-slidecards-button-next:not(.tp-slidecards-button-disabled):hover,.tp-slidecards-button-prev:not(.tp-slidecards-button-disabled):hover{background-color:var(--ti-common-color-bg-light-normal)}.tp-slidecards-button-next:not(.tp-slidecards-button-disabled):hover tp-icon,.tp-slidecards-button-prev:not(.tp-slidecards-button-disabled):hover tp-icon{color:var(--ti-common-color-text-highlight)}.tp-slidecards-button-next.tp-slidecards-button-disabled,.tp-slidecards-button-prev.tp-slidecards-button-disabled{cursor:not-allowed}.tp-slidecards-button-next.tp-slidecards-button-disabled tp-icon,.tp-slidecards-button-prev.tp-slidecards-button-disabled tp-icon{color:var(--ti-common-color-icon-disabled)}.tp-slidecards-button-prev{margin-right:var(--ti-common-space-2x)}.tp-slidecards-button-next{margin-left:var(--ti-common-space-2x)}.tp-slidecards-wrapper{flex:1;height:100%;overflow:hidden;position:relative}.tp-slidecards-list{display:flex;flex-wrap:nowrap;overflow-y:hidden;position:relative;transition:left 1s;width:var(--tp-slidecards-list-width)}"]
            },] }
];
TpSlidecardsComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone }
];
TpSlidecardsComponent.propDecorators = {
    currentIndex: [{ type: Input }],
    pageChange: [{ type: Output }],
    listWrapperEleRef: [{ type: ViewChild, args: ['listWrapper',] }],
    listEleRef: [{ type: ViewChild, args: ['list',] }],
    cardComRefs: [{ type: ContentChildren, args: [TpCardComponent, { descendants: false },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBTbGlkZWNhcmRzQ29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnlwbHVzMy9jb21wb25lbnRzL3NsaWRlY2FyZHMvVHBTbGlkZWNhcmRzQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsZUFBZSxFQUNmLFVBQVUsRUFDVixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFDTixNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFHVCxTQUFTO0FBQ1QscURBQXFEO0VBQ3RELE1BQU0sZUFBZSxDQUFDO0FBRXZCLHFEQUFxRDtBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQy9DLHFEQUFxRDtBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFldkQ7Ozs7OztHQU1HO0FBTUgsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGVBQWU7SUFpRXhELFlBQ1ksT0FBbUIsRUFDckIsU0FBb0IsRUFDcEIsSUFBWTtRQUVwQixLQUFLLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBSmhCLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDckIsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBbkV0Qjs7V0FFRztRQUNNLGlCQUFZLEdBQVcsQ0FBQyxDQUFDO1FBQ2xDOztXQUVHO1FBQ2dCLGVBQVUsR0FBOEMsSUFBSSxZQUFZLEVBQStCLENBQUM7UUFnQjNIOzs7V0FHRztRQUNJLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBSy9COztXQUVHO1FBQ0ssYUFBUSxHQUFXLENBQUMsQ0FBQztRQUM3Qjs7O1dBR0c7UUFDSSxTQUFJLEdBQVcsS0FBSyxDQUFDO1FBQzVCOzs7V0FHRztRQUNJLGFBQVEsR0FBMkIsRUFBRSxDQUFDO1FBQzdDOztXQUVHO1FB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QUFDLElBQUksQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUN6QjtJQUNILENBQUM7OztZQTFSRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGVBQWU7Z0JBQ3pCLDJnREFBZ0M7O2FBRWpDOzs7WUExQ0MsVUFBVTtZQU1WLFNBQVM7WUFIVCxNQUFNOzs7MkJBNENMLEtBQUs7eUJBSUwsTUFBTTtnQ0FLTixTQUFTLFNBQUMsYUFBYTt5QkFLdkIsU0FBUyxTQUFDLE1BQU07MEJBS2hCLGVBQWUsU0FBQyxlQUFlLEVBQUUsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE5nWm9uZSxcclxuICBPdXRwdXQsXHJcbiAgUXVlcnlMaXN0LFxyXG4gIFJlbmRlcmVyMixcclxuICBTaW1wbGVDaGFuZ2UsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBWaWV3Q2hpbGRcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWltcGxpY2l0LWRlcGVuZGVuY2llc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1pbXBsaWNpdC1kZXBlbmRlbmNpZXNcclxuaW1wb3J0IHsgVGlCYXNlQ29tcG9uZW50IH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1pbXBsaWNpdC1kZXBlbmRlbmNpZXNcclxuaW1wb3J0IHsgVHBDYXJkQ29tcG9uZW50IH0gZnJvbSAnLi4vY2FyZC9UcENhcmRNb2R1bGUnO1xyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKiDop4TojIPmj5Dlh7rvvIzkupHkuJrliqHpgJrnlKjlnLrmma/kuI3kvJrkvb/nlKjor6Xnu4Tku7bvvIwxMC4xLjPotbfvvIzlnKjlrpjnvZHpmpDol4/or6Xnu4Tku7bjgIJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBTbGlkZWNhcmRzUGFnaW5hdGlvbkV2ZW50IHtcclxuICBjdXJyZW50UGFnZTogbnVtYmVyO1xyXG4gIHBhZ2VTaXplOiBudW1iZXI7XHJcbiAgdG90YWxQYWdlOiBudW1iZXI7XHJcbiAgLyoqXHJcbiAgICog5YWB6K645pyJ5aSa5L2Z55qE5bGe5oCn5a2X5q61XHJcbiAgICovXHJcbiAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaWdub3JlXHJcbiAqIOinhOiMg+aPkOWHuu+8jOS6keS4muWKoemAmueUqOWcuuaZr+S4jeS8muS9v+eUqOivpee7hOS7tu+8jDEwLjEuM+i1t++8jOWcqOWumOe9kemakOiXj+ivpee7hOS7tuOAglxyXG4gKiDmu5rliqjljaHniYfliJfooajvvIzlip/og73kuI7ova7mkq3lm77nm7jkvLzvvIzlj6/ku6XmmL7npLrlpJrlsY/lsZXnpLrljaHniYfnmoTmlYjmnpzvvIzlubbkuJTov5jmj5Dkvpvkuoblop7liqDjgIHliKDpmaTljaHniYflip/og73jgILor6bmg4Xlj4LogIPmtYvor5XnlKjkvovjgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy9zbGlkZWNhcmRzL3NsaWRlY2FyZHMtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndHAtc2xpZGVjYXJkcycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NsaWRlY2FyZHMuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2xpZGVjYXJkcy5sZXNzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRwU2xpZGVjYXJkc0NvbXBvbmVudCBleHRlbmRzIFRpQmFzZUNvbXBvbmVudCB7XHJcbiAgLyoqXHJcbiAgICog5b2T5YmN6YCJ5Lit5Y2h54mH5Zyo5pWw57uE5Lit55qE5LiL5qCHXHJcbiAgICovXHJcbiAgQElucHV0KCkgY3VycmVudEluZGV4OiBudW1iZXIgPSAwO1xyXG4gIC8qKlxyXG4gICAqIOW9k+WJjemhteaUueWPmOS6i+S7tlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSByZWFkb25seSBwYWdlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8VHBTbGlkZWNhcmRzUGFnaW5hdGlvbkV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VHBTbGlkZWNhcmRzUGFnaW5hdGlvbkV2ZW50PigpO1xyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKiDljaHniYfnmoTlj6/op4bljLpcclxuICAgKi9cclxuICBAVmlld0NoaWxkKCdsaXN0V3JhcHBlcicpIGxpc3RXcmFwcGVyRWxlUmVmOiBFbGVtZW50UmVmO1xyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKiDljaHniYfniLblhYPntKDvvIznlKjkuo7nm5HlkKzlhoXlrrnlj5jljJZcclxuICAgKi9cclxuICBAVmlld0NoaWxkKCdsaXN0JykgbGlzdEVsZVJlZjogRWxlbWVudFJlZjtcclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICog5omA5pyJ55qE5Y2h54mH6ZuG5ZCIXHJcbiAgICovXHJcbiAgQENvbnRlbnRDaGlsZHJlbihUcENhcmRDb21wb25lbnQsIHsgZGVzY2VuZGFudHM6IGZhbHNlIH0pIGNhcmRDb21SZWZzITogUXVlcnlMaXN0PFRwQ2FyZENvbXBvbmVudD47XHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqIOW9k+WJjemhtVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjdXJyZW50UGFnZTogbnVtYmVyID0gMTtcclxuICAvKipcclxuICAgKiDmr4/kuKrljaHniYfnmoTlrr3luqbvvIznlKjkuo7orqHnrpfliIbpobVcclxuICAgKi9cclxuICBwcml2YXRlIGNhcmRXaWR0aDogbnVtYmVyO1xyXG4gIC8qKlxyXG4gICAqIOWNoeeJh+S5i+mXtOeahOi3neemu++8jOeUqOS6juiuoeeul+WIhumhtVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FyZFNwYW46IG51bWJlciA9IDA7XHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqIOWNoeeJh+eItuWFg+e0oOeahOWBj+enu+i3neemu++8jOeUqOS6juaOp+WItuWNoeeJh+W3puWPs+a7keWKqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsZWZ0OiBzdHJpbmcgPSAnMHB4JztcclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICog5YiG6aG16aG156CB5pi+56S65pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHBhZ2VMaXN0OiBBcnJheTxzdHJpbmcgfCBudW1iZXI+ID0gW107XHJcbiAgLyoqXHJcbiAgICog5q+P6aG15Y2h54mH5pWwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwYWdlU2l6ZTogbnVtYmVyID0gMTtcclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICog5YiG6aG15oC76aG15pWwXHJcbiAgICovXHJcbiAgcHVibGljIHRvdGFsUGFnZTogbnVtYmVyID0gMTtcclxuICAvKipcclxuICAgKiDmgLvnmoTljaHniYfmlbDph49cclxuICAgKi9cclxuICBwcml2YXRlIHRvdGFsQ2FyZDogbnVtYmVyID0gMDtcclxuXHJcbiAgcHJpdmF0ZSB1bmxpc3RlblJlc2l6ZTogKCkgPT4gdm9pZDtcclxuICAvLyDljaHniYfniLblhYPntKAgTXV0YXRpb25PYnNlcnZlciDlr7nosaFcclxuICBwcml2YXRlIGxpc3RPYnNlcnZlcjogTXV0YXRpb25PYnNlcnZlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgaG9zdFJlZjogRWxlbWVudFJlZixcclxuICAgIHByaXZhdGUgcmVuZGVyZXIyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIHpvbmU6IE5nWm9uZVxyXG4gICkge1xyXG4gICAgc3VwZXIoaG9zdFJlZiwgcmVuZGVyZXIyKTtcclxuICB9XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgLy8g5LiA5bGP5pi+56S65Y2h54mH55qE5pWw55uu5Lya6ZqP56qX5Y+j5aSn5bCP6ICM5Y+Y5YyW77yM5omA5Lul55uR5ZCs56qX5Y+j5aSn5bCP5Y+Y5YyW6YeN5paw6K6h566X5YiG6aG177yMXHJcbiAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICB0aGlzLnVubGlzdGVuUmVzaXplID0gdGhpcy5yZW5kZXJlcjIubGlzdGVuKHdpbmRvdywgJ3Jlc2l6ZScsICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5jYW5DYWxjdWxhdGVQYWdpbmcoKSkge1xyXG4gICAgICAgICAgdGhpcy5jYWxjdWxhdGVQYWdpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlm6DkuLrliJ3lp4vljJbopoHlsZXnpLrlvZPliY3ntKLlvJXljaHniYfvvIzmiYDku6XlnKjliJ3lp4vljJblkI7lhYjorqHnrpfkuIDmrKHliIbpobXvvIznhLblkI7mmL7npLpjdXJyZW50SW5kZXjljaHniYdcclxuICAgKiDliIbpobXnmoTorqHnrpfkvp3otZbop4blm77lj6/op4bljLrnmoTlrr3luqbvvIzop4blm77liqDovb3lrozmiJDlkI7miY3og73orqHnrpfvvIxcclxuICAgKiDliIbpobXorqHnrpflkI7vvIzkvJrmlLnlj5jmlbDmja7vvIzmiYDku6XnlKhzZXRUaW1lb3V044CCXHJcbiAgICogIOaAu+WNoeeJh+aVsOWPimNhcmRzQ29tUmVmIOmVv+W6pu+8jCBwYWdlU2l6ZSA9IOWuueWZqOWuveW6pi/vvIjljaHniYflrr3luqYgKyDljaHniYfpl7TnmoTot53nprvvvIlcclxuICAgKi9cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgIC8vIOWIneWni+WMluaXtuiuoeeul+S4gOasoeWIhumhte+8jOeEtuWQjuaKiuW9k+WJjee0ouW8leeahOWNoeeJh+aYvuekuuWHuuadpVxyXG4gICAgaWYgKHRoaXMuY2FuQ2FsY3VsYXRlUGFnaW5nKCkpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVQYWdpbmcoKTtcclxuICAgICAgICAgICAgdGhpcy5zaG93Q3VycmVudENhcmQodGhpcy5jdXJyZW50SW5kZXgpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubGlzdE9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uUmVjb3JkcykgPT4ge1xyXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlUGFnaW5nKCk7XHJcbiAgICB9KTtcclxuICAgIC8vIE11dGF0aW9uT2JzZXJ2ZXIg5a+56LGh55qE5Zue6LCD5pa55rOV5byA5aeL5o6l5pS25LiO57uZ5a6a6YCJ6aG55Yy56YWN55qERE9N5Y+Y5YyW55qE6YCa55+lXHJcbiAgICAvLyDlj6rpnIDlhbPms6jljaHniYflop7liKDlkoxsZWblgY/np7vlgLzvvIzmiYDku6Xlj6rorr7nva5jaGlsZExpc3TjgIFhdHRyaWJ1dGVzXHJcbiAgICB0aGlzLmxpc3RPYnNlcnZlci5vYnNlcnZlKHRoaXMubGlzdEVsZVJlZi5uYXRpdmVFbGVtZW50LCB7XHJcbiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLCAvLyDnm5Hop4bnm67moIfoioLngrnmt7vliqDmiJbliKDpmaTmlrDnmoTlrZDoioLngrlcclxuICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLCAvLyDop4Llr5/lj5fnm5Hop4blhYPntKDnmoTlsZ7mgKflgLzlj5jmm7Qs5Li76KaB5piv5Li65LqG55uR5ZCsIHN0eWxl5bGe5oCnXHJcbiAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJ10gLy8g6KaB55uR6KeG55qE54m55a6a5bGe5oCn5ZCN56ew55qE5pWw57uEXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgLy8gY3VycmVudEluZGV4IOaUueWPmOi3s+i9rOWIsOWvueW6lOmhteaYvuekuuW9k+WJjee0ouW8leWNoeeJh1xyXG4gICAgY29uc3QgY3VycmVudEluZGV4Q2hhbmdlOiBTaW1wbGVDaGFuZ2UgPSBjaGFuZ2VzWydjdXJyZW50SW5kZXgnXTtcclxuICAgIGlmICghY3VycmVudEluZGV4Q2hhbmdlLmZpcnN0Q2hhbmdlKSB7XHJcbiAgICAgIHRoaXMuc2hvd0N1cnJlbnRDYXJkKGN1cnJlbnRJbmRleENoYW5nZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xyXG4gICAgLy8g57uE5Lu26ZSA5q+B5pe277yM5rOo6ZSA56qX5Y+jcmVzaXpl5LqL5Lu255uR5ZCsXHJcbiAgICBpZiAodGhpcy51bmxpc3RlblJlc2l6ZSkge1xyXG4gICAgICB0aGlzLnVubGlzdGVuUmVzaXplKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5saXN0T2JzZXJ2ZXIpIHtcclxuICAgICAgICB0aGlzLmxpc3RPYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuiDvei/m+ihjOWIhumhteiuoeeul1xyXG4gICAqIEByZXR1cm5zIGJvb2xlYW5cclxuICAgKi9cclxuICBwcml2YXRlIGNhbkNhbGN1bGF0ZVBhZ2luZygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmxpc3RXcmFwcGVyRWxlUmVmICYmIHRoaXMuY2FyZENvbVJlZnMgJiYgdGhpcy5jYXJkQ29tUmVmcy5sZW5ndGggPiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlhYjorqHnrpfliIbpobXmr4/pobXnmoTljaHniYfmlbBwYWdlU2l6Ze+8jOWGjeiuoeeul+aAu+mhteaVsHRvdGFsUGFnZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlUGFnaW5nKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jYWxjdWxhdGVQYWdlU2l6ZSgpO1xyXG4gICAgdGhpcy5jYWxjdWxhdGVUb3RhbFBhZ2UoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6h566X5YiG6aG15oC76aG15pWwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVUb3RhbFBhZ2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnRvdGFsQ2FyZCA9IHRoaXMuY2FyZENvbVJlZnMubGVuZ3RoO1xyXG4gICAgLy8g6K6h566X5YWx5pyJ5aSa5bCR6aG1XHJcbiAgICB0aGlzLnRvdGFsUGFnZSA9IE1hdGguY2VpbCh0aGlzLnRvdGFsQ2FyZCAvIHRoaXMucGFnZVNpemUpO1xyXG4gICAgLy8g55Sf5oiQ5YiG6aG15Zmo5pi+56S65pWw57uEXHJcbiAgICB0aGlzLmdlbmVyYXRlUGFnZXNBcnJheSgpO1xyXG4gICAgLy8g6YeN5paw6K6h566X5oC76aG16Z2i5ZCO77yM6ZyA6KaB5aSE55CG5b2T5YmN6aG15aSn5LqO5oC76aG15pWw55qE5Zy65pmvXHJcbiAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA+IHRoaXMudG90YWxQYWdlKSB7XHJcbiAgICAgIHRoaXMuZ29QYWdlKHRoaXMudG90YWxQYWdlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoeeul+S4gOasoeaYvuekuueahOWNoeeJh+aVsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlUGFnZVNpemUoKTogdm9pZCB7XHJcbiAgICAvLyBnZXRDb21wdXRlZFN0eWxlIOiOt+WPlueahOWuveW6pu+8jOWcqGllMTHkuIvkuI3ljIXlkKtwYWRkaW5n5ZKMYm9yZGVyLOaJgOS7peS9v+eUqGdldEJvdW5kaW5nQ2xpZW50UmVjdO+8iO+8iVxyXG4gICAgLy8g5Zyo5Yid5aeL5YyW5pe277yMdG90YWxQYWdl6L+Y5rKh5pyJ6K6h566X5Ye65p2l77yM5bem5Y+z57+76aG15oyJ6ZKu5rKh5pyJ5pi+56S677yM5L2G5a655Zmo5YWD57Sg55qE5Y+v55So5a695bqm5bqU6K+l5YeP5Y675bem5Y+z5oyJ6ZKu55qE5a695bqm5LmL5ZKMMzArMzA9NjBcclxuICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoOiBudW1iZXIgPSAodGhpcy5saXN0V3JhcHBlckVsZVJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAtIDYwO1xyXG4gICAgdGhpcy5jYXJkV2lkdGggPSAodGhpcy5jYXJkQ29tUmVmcy5maXJzdC5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcclxuICAgIGNvbnN0IGNhcmRTdHlsZTogQ1NTU3R5bGVEZWNsYXJhdGlvbiA9IGdldENvbXB1dGVkU3R5bGUodGhpcy5jYXJkQ29tUmVmcy5maXJzdC5uYXRpdmVFbGVtZW50KTtcclxuICAgIHRoaXMuY2FyZFNwYW4gPSBwYXJzZUZsb2F0KGNhcmRTdHlsZS5tYXJnaW5SaWdodCk7XHJcbiAgICAvLyDlvZPlrrnlmajlrr3luqblsI/kuo5jYXJk5a695bqm5pe2LOmcgOWkhOeQhu+8jOmBv+WFjeWIhumhteS4jeiDveato+W4uOeUn+aIkFxyXG4gICAgdGhpcy5wYWdlU2l6ZSA9IGNvbnRhaW5lcldpZHRoIDw9ICh0aGlzLmNhcmRXaWR0aCArIHRoaXMuY2FyZFNwYW4pID8gMSA6IE1hdGguZmxvb3IoY29udGFpbmVyV2lkdGggLyAodGhpcy5jYXJkV2lkdGggKyB0aGlzLmNhcmRTcGFuKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnlJ/miJDliIbpobXlmajmmL7npLrnmoTmlbDnu4RcclxuICAgKi9cclxuICBwcml2YXRlIGdlbmVyYXRlUGFnZXNBcnJheSgpOiB2b2lkIHtcclxuICAgIHRoaXMucGFnZUxpc3QgPSBbXTtcclxuICAgIC8vIOWIpOaWreaAu+mhteaVsOWmguaenOWwj+S6juetieS6juWIhumhteeahOmVv+W6pu+8jOiLpeWwj+S6juWImeebtOaOpeaYvuekulxyXG4gICAgaWYgKHRoaXMudG90YWxQYWdlIDw9IDgpIHtcclxuICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMTsgaSA8PSB0aGlzLnRvdGFsUGFnZTsgaSsrKSB7XHJcbiAgICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKGkpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudFBhZ2UgPD0gMykge1xyXG4gICAgICAvLyDlj7PovrkuLi5cclxuICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMTsgaSA8PSA1OyBpKyspIHtcclxuICAgICAgICB0aGlzLnBhZ2VMaXN0LnB1c2goaSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKCcuLi4nKTtcclxuICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKHRoaXMudG90YWxQYWdlKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50UGFnZSA+PSB0aGlzLnRvdGFsUGFnZSAtIDMpIHtcclxuICAgICAgLy8g5bem6L65IC4uLlxyXG4gICAgICB0aGlzLnBhZ2VMaXN0LnB1c2goMSk7XHJcbiAgICAgIHRoaXMucGFnZUxpc3QucHVzaCgnLi4uJyk7XHJcbiAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDQ7IGkgPj0gMTsgaS0tKSB7XHJcbiAgICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKHRoaXMudG90YWxQYWdlIC0gaSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKHRoaXMudG90YWxQYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOacgOWQjuS4gOenjeaDheWGte+8jOS4pOi+uemDveaciS4uLlxyXG4gICAgICB0aGlzLnBhZ2VMaXN0LnB1c2goMSk7XHJcbiAgICAgIHRoaXMucGFnZUxpc3QucHVzaCgnLi4uJyk7XHJcbiAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDI7IGkgPj0gMTsgaS0tKSB7XHJcbiAgICAgICAgdGhpcy5wYWdlTGlzdC5wdXNoKHRoaXMuY3VycmVudFBhZ2UgLSBpKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnBhZ2VMaXN0LnB1c2godGhpcy5jdXJyZW50UGFnZSk7XHJcbiAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDE7IGkgPCAyOyBpKyspIHtcclxuICAgICAgICB0aGlzLnBhZ2VMaXN0LnB1c2godGhpcy5jdXJyZW50UGFnZSArIGkpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucGFnZUxpc3QucHVzaCgnLi4uJyk7XHJcbiAgICAgIHRoaXMucGFnZUxpc3QucHVzaCh0aGlzLnRvdGFsUGFnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIflrprpobXnoIHnv7vpobVcclxuICAgKiBAcGFyYW0gcGFnZU51bSDot7PovazliLDnmoTpobXnoIFcclxuICAgKiBAaWdub3JlXHJcbiAgICovXHJcbiAgcHVibGljIGdvUGFnZShwYWdlTnVtOiBudW1iZXIgfCBzdHJpbmcpOiB2b2lkIHtcclxuICAgIC8vIC4uLiDml7bvvIzkuI3lgZrlpITnkIZcclxuICAgIGlmICh0eXBlb2YgcGFnZU51bSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYWdlTnVtO1xyXG4gICAgLy8g5YGP56e76YePPSjlvZPliY3pobUtMSkq5q+P6aG155qE5Y2h54mH5pWw6YePKu+8iOWNoeeJh+WuveW6piArIOWNoeeJh+eahE1hcmdpbilcclxuICAgIHRoaXMubGVmdCA9IC0ocGFnZU51bSAtIDEpICogdGhpcy5wYWdlU2l6ZSAqICh0aGlzLmNhcmRXaWR0aCArIHRoaXMuY2FyZFNwYW4pICsgJ3B4JztcclxuICAgIC8vIOinpuWPkXBhZ2VDaGFuZ2Xkuovku7ZcclxuICAgIGNvbnN0IGRhdGE6IFRwU2xpZGVjYXJkc1BhZ2luYXRpb25FdmVudCA9IHtcclxuICAgICAgY3VycmVudFBhZ2U6IHBhZ2VOdW0sXHJcbiAgICAgIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplLFxyXG4gICAgICB0b3RhbFBhZ2U6IHRoaXMudG90YWxQYWdlXHJcbiAgICB9O1xyXG4gICAgdGhpcy5wYWdlQ2hhbmdlLmVtaXQoZGF0YSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCR5YmN6Lez6L2s5LiA6aG1XHJcbiAgICogQGlnbm9yZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnb1ByZXYoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA+IDEpIHtcclxuICAgICAgdGhpcy5nb1BhZ2UodGhpcy5jdXJyZW50UGFnZSAtIDEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCR5ZCO6Lez6L2s5LiA6aG1XHJcbiAgICogQGlnbm9yZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnb05leHQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA8IHRoaXMudG90YWxQYWdlKSB7XHJcbiAgICAgIHRoaXMuZ29QYWdlKHRoaXMuY3VycmVudFBhZ2UgKyAxKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleekuuaMh+Wumue0ouW8leeahOWNoeeJh++8jOWcqOWIneWni+WMluWPimN1cnJlbnRJbmRleCDmlLnlj5jml7bvvIzlpoLmnpzmjIflrprntKLlvJXkuI3lnKjlvZPliY3pobXvvIzot7PovazliLDog73mmL7npLpj57Si5byV5a+55bqU5Y2h54mH55qE6aG156CBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG93Q3VycmVudENhcmQoaW5kZXg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgLy8g5aaC5p6c57Si5byV5ZKM5Y2h54mH55qE5pWw55uu5LiN5Yy56YWN77yM5LiN5YGa5aSE55CG44CCXHJcbiAgICBpZiAoaW5kZXggPCAwICYmIGluZGV4ID4gKHRoaXMudG90YWxDYXJkIC0gMSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5b2T5YmN5LiA5bGP5Y2h54mH55qE5pyA5aSn5pyA5bCP57Si5byVXHJcbiAgICBjb25zdCBtYXhJbmRleDogbnVtYmVyID0gdGhpcy5jdXJyZW50UGFnZSAqIHRoaXMucGFnZVNpemUgLSAxO1xyXG4gICAgY29uc3QgbWluSW5kZXg6IG51bWJlciA9IHRoaXMuY3VycmVudFBhZ2UgPiAwID8gKCh0aGlzLmN1cnJlbnRQYWdlIC0gMSkgKiB0aGlzLnBhZ2VTaXplIC0gMSkgOiAwO1xyXG4gICAgLy8g5b2T5YmN57Si5Y2h54mH5piv5ZCm5Zyo5b2T5YmN6aG16Z2iXHJcbiAgICBpZiAoaW5kZXggPCBtaW5JbmRleCB8fCBpbmRleCA+IG1heEluZGV4KSB7XHJcbiAgICAgIGNvbnN0IHRhcmdldFBhZ2U6IG51bWJlciA9IE1hdGguY2VpbCgoaW5kZXggKyAxKSAvIHRoaXMucGFnZVNpemUpO1xyXG4gICAgICB0aGlzLmdvUGFnZSh0YXJnZXRQYWdlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==