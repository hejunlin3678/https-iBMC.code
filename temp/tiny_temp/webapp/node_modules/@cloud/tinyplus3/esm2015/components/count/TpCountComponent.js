// tslint:disable-next-line: no-implicit-dependencies
import { Component, ElementRef, Input, Renderer2, TemplateRef, ViewChild } from '@angular/core';
// tslint:disable-next-line: no-implicit-dependencies
import { TiTipService } from '@cloud/tiny3';
import { TpCountTimeComponent } from './TpCountTimeComponent';
/**
 * 表格倒计时组件
 *
 * tp-countdown 组件升级版，countdown组件的接口和功能保留，添加计费模式和资源状态
 *
 * 10.0.1 新增
 *
 * <example-url>../tinyplus3demo/#/count/count-all</example-url>
 */
export class TpCountComponent extends TpCountTimeComponent {
    constructor(element, renderer2, tipService) {
        super(element, renderer2);
        this.element = element;
        this.renderer2 = renderer2;
        this.tipService = tipService;
        /**
         * 计费模式
         */
        this.type = 'period';
        /**
         * @ignore
         * tip 的内容
         */
        this.tipContext = [];
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewInit() {
        super.ngAfterViewInit();
        if (this.showTip()) {
            this.generateTipContent();
            this.addTip();
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 倒计时tip提示内容跟 countDownCode和countDownTips有关
        // 此处是资源状态和倒计时整体添加tip
        if ((changes['countDownCode'] && !changes['countDownCode'].firstChange) ||
            (changes['countDownTips'] && !changes['countDownTips'].firstChange)) {
            // 按需正在使用阶段没有tip实例，处理按需正在使用变化成按需宽限期场景报错
            if (this.tipInstance) {
                this.tipInstance.destroy();
            }
            if (this.showTip()) {
                // 按需正在使用阶段到按需宽限期，模板的ng-if 条件改变导致stateTimeRef是否存在也改变
                // stateTimeRef无法立刻获取到
                setTimeout(() => {
                    this.addTip();
                }, 0);
            }
        }
    }
    /**
     * @ignore
     *
     */
    showState() {
        return !(this.countDownCode === 'hws_countdown_period_using' ||
            this.countDownCode === 'hws_countdown_period_toondemand' ||
            this.countDownCode === 'hws_countdown_ondemand_using');
    }
    addTip() {
        //  按需正在使用时因为显示内容和tip内容相同，所有不需要tip
        if (Array.isArray(this.tipContext) && this.tipContext.length > 0
            && this.countDownCode !== 'hws_countdown_ondemand_using' && this.stateTimeRef) {
            this.tipInstance = this.tipService.create(this.stateTimeRef.nativeElement, {
                trigger: 'mouse',
                maxWidth: this.tipMaxWidth,
                showFn: () => {
                    return {
                        content: this.tipContentTemplate
                    };
                }
            });
        }
    }
}
TpCountComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-count',
                template: "<tp-count-pattern [type]=\"type\"></tp-count-pattern>\r\n<!-- \u65E0\u8BBA\u6587\u672C\u662F\u5426\u6EA2\u51FA\uFF0C\u90FD\u9700\u8981tips\uFF0Ctip\u5185\u5BB9\u4E0D\u662F\u5143\u7D20\u7684\u6587\u672C-->\r\n<ng-container *ngIf=\"showTip()\">\r\n    <section class=\"tp-count-state-time tp-count-state-time-underline\" #stateTime [ngClass]=\"{'tp-count-warn': stateLevel === 'warn',\r\n     'tp-count-alarm' : stateLevel === 'alarm'}\">\r\n        <ng-container *ngIf=\"showState()\">\r\n            <tp-count-state  [countDownCode]=\"countDownCode\" [countDownInfos]=\"countDownInfos\" pattern=\"combine\"></tp-count-state>\r\n        </ng-container>\r\n        <tp-count-time [countDownCode]=\"countDownCode\" [countDownInfos]=\"countDownInfos\" pattern=\"combine\"></tp-count-time>\r\n    </section>\r\n</ng-container>\r\n<!-- \u6587\u672C\u6EA2\u51FA\u624D\u9700\u8981tip, \u4E14tip\u5185\u5BB9\u5C31\u662F\u5143\u7D20\u6587\u672C\uFF0C\u6240\u4EE5\u4F7F\u7528tiOverflow\uFF0C\u4E14\u4E0D\u9700\u8981\u4E0B\u5212\u7EBF -->\r\n<ng-container *ngIf=\"!showTip()\">\r\n    <section class=\"tp-count-state-time\" tiOverflow >\r\n        <ng-container *ngIf=\"showState()\">\r\n            <tp-count-state [countDownCode]=\"countDownCode\" [countDownInfos]=\"countDownInfos\" pattern=\"combine\"></tp-count-state>\r\n        </ng-container>\r\n        <tp-count-time [countDownCode]=\"countDownCode\" [countDownInfos]=\"countDownInfos\" pattern=\"combine\"></tp-count-time>\r\n    </section>\r\n</ng-container>\r\n<ng-template #tipContent>\r\n    <ng-container *ngFor=\"let item of tipContext\">{{item.title}} {{item.time| tpDate: 'dateTimeZone'}}<br></ng-container>\r\n</ng-template>\r\n",
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-count-warn{color:var(--ti-common-color-warn-text)}.tp-count-alarm{color:var(--ti-common-color-error-text)}.tp-count-state-time{display:inline-block;max-width:100%}.tp-count-state-time.tp-count-state-time-underline{border-bottom:1px dashed var(--ti-common-color-dash-line-normal);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}tp-count-state{display:inline}tp-count-pattern{display:block}"]
            },] }
];
TpCountComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiTipService }
];
TpCountComponent.propDecorators = {
    type: [{ type: Input }],
    stateTimeRef: [{ type: ViewChild, args: ['stateTime', { static: false },] }],
    countTimeCom: [{ type: ViewChild, args: [TpCountTimeComponent,] }],
    tipContentTemplate: [{ type: ViewChild, args: ['tipContent',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBDb3VudENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy9jb3VudC9UcENvdW50Q29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHFEQUFxRDtBQUNyRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFpQixXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9HLHFEQUFxRDtBQUNyRCxPQUFPLEVBQXNCLFlBQVksRUFBaUIsTUFBTSxjQUFjLENBQUM7QUFFL0UsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUE0RzlEOzs7Ozs7OztHQVFHO0FBTUgsTUFBTSxPQUFPLGdCQUFpQixTQUFRLG9CQUFvQjtJQWdDdEQsWUFBb0IsT0FBbUIsRUFBVSxTQUFvQixFQUFVLFVBQXdCO1FBQ25HLEtBQUssQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFEVixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUFVLGVBQVUsR0FBVixVQUFVLENBQWM7UUEvQnZHOztXQUVHO1FBQ00sU0FBSSxHQUF3QixRQUFRLENBQUM7UUFzQjlDOzs7V0FHRztRQUNJLGVBQVUsR0FBMEIsRUFBRSxDQUFDO0lBSTlDLENBQUM7SUFFRCxxREFBcUQ7SUFDckQsZUFBZTtRQUNYLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN4QixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUNoQixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDakI7SUFDTCxDQUFDO0lBRUQscURBQXFEO0lBQ3JELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLDRDQUE0QztRQUM1QyxxQkFBcUI7UUFDckIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxXQUFXLENBQUM7WUFDbkUsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDckUsdUNBQXVDO1lBQ3ZDLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDbEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUM5QjtZQUNELElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUNoQixvREFBb0Q7Z0JBQ3BELHNCQUFzQjtnQkFDdEIsVUFBVSxDQUFDLEdBQVMsRUFBRTtvQkFDbEIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNsQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDVDtTQUNKO0lBQ0wsQ0FBQztJQUNEOzs7T0FHRztJQUNJLFNBQVM7UUFDWixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxLQUFLLDRCQUE0QjtZQUN4RCxJQUFJLENBQUMsYUFBYSxLQUFLLGlDQUFpQztZQUN4RCxJQUFJLENBQUMsYUFBYSxLQUFLLDhCQUE4QixDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVPLE1BQU07UUFDVixrQ0FBa0M7UUFDbEMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDO2VBQ3pELElBQUksQ0FBQyxhQUFhLEtBQUssOEJBQThCLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUMvRSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxFQUFFO2dCQUN2RSxPQUFPLEVBQUUsT0FBTztnQkFDaEIsUUFBUSxFQUFFLElBQUksQ0FBQyxXQUFXO2dCQUMxQixNQUFNLEVBQUUsR0FBa0IsRUFBRTtvQkFDeEIsT0FBTzt3QkFDSCxPQUFPLEVBQUUsSUFBSSxDQUFDLGtCQUFrQjtxQkFDbkMsQ0FBQztnQkFDTixDQUFDO2FBQ0osQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7WUE5RkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxVQUFVO2dCQUNwQixrcURBQTJCOzthQUU5Qjs7O1lBN0htQixVQUFVO1lBQVMsU0FBUztZQUVuQixZQUFZOzs7bUJBZ0lwQyxLQUFLOzJCQU1MLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOzJCQUt4QyxTQUFTLFNBQUMsb0JBQW9CO2lDQUs5QixTQUFTLFNBQUMsWUFBWSIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8taW1wbGljaXQtZGVwZW5kZW5jaWVzXHJcbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlcywgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWltcGxpY2l0LWRlcGVuZGVuY2llc1xyXG5pbXBvcnQgeyBUaUxvY2FsZSwgVGlUaXBSZWYsIFRpVGlwU2VydmljZSwgVGlUaXBTaG93SW5mbyB9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcblxyXG5pbXBvcnQgeyBUcENvdW50VGltZUNvbXBvbmVudCB9IGZyb20gJy4vVHBDb3VudFRpbWVDb21wb25lbnQnO1xyXG5cclxuLyoqXHJcbiAqIOWAkuiuoeaXtuexu+WIqywg6K+m5oOF5Y+C6ICD4oCc5LqR6L+Q6JCl5YWs5YWx5o6l5Y+j6K+05piO4oCd5paH5qGj77yMMi4yMeS6keacjeWKoeWAkuiuoeaXtuS/oeaBr+afpeivolxyXG4gKi9cclxuZXhwb3J0IHR5cGUgVHBDb3VudENvZGUgPSAnaHdzX2NvdW50ZG93bl9wZXJpb2RfdXNpbmcnXHJcbiAgICB8ICdod3NfY291bnRkb3duX3BlcmlvZF9ncmFjaW5nJ1xyXG4gICAgfCAnaHdzX2NvdW50ZG93bl9wZXJpb2RfZnJvemVuJ1xyXG4gICAgfCAnaHdzX2NvdW50ZG93bl9wZXJpb2RfaWxsZWdhbGZyb3plbidcclxuICAgIHwgJ2h3c19jb3VudGRvd25fcGVyaW9kX3BvbGljZWZyb3plbidcclxuICAgIHwgJ2h3c19jb3VudGRvd25fcGVyaW9kX3Rvb25kZW1hbmQnXHJcbiAgICB8ICdod3NfY291bnRkb3duX29uZGVtYW5kX3VzaW5nJ1xyXG4gICAgfCAnaHdzX2NvdW50ZG93bl9vbmRlbWFuZF9ncmFjaW5nJ1xyXG4gICAgfCAnaHdzX2NvdW50ZG93bl9vbmRlbWFuZF9mcm96ZW4nXHJcbiAgICB8ICdod3NfY291bnRkb3duX29uZGVtYW5kX2lsbGVnYWxmcm96ZW4nXHJcbiAgICB8ICdod3NfY291bnRkb3duX29uZGVtYW5kX2lsbGVnYWxmcm96ZW5fYXJyZWFyJ1xyXG4gICAgfCAnaHdzX2NvdW50ZG93bl9vbmRlbWFuZF9wb2xpY2Vmcm96ZW4nO1xyXG5cclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICog5YCS6K6h5pe25LiN5ZCM6Zi25q615a+55bqU55qE6aKc6Imy5o+Q56S657G75YirXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBUcENvdW50RG93blN0YXRlTGV2ZWwgPSAnbm9ybWFsJyB8ICd3YXJuJyB8ICdhbGFybSc7XHJcblxyXG4vKipcclxuICog5YCS6K6h5pe25L+h5oGv77yM5Y2zY291bnREb3duSW5mb3Plr7nosaHnsbvlnossXHJcbiAqIOaOpeWPo+aYr+agueaNrlwi5LqR6L+Q6JCl5YWs5YWx5o6l5Y+j6K+05piOXCLmlofmoaMgMi4yMeS6keacjeWKoeWAkuiuoeaXtuS/oeaBr+afpeivouaOpeWPo+i/lOWbnuaVsOaNruiuvue9ru+8jOivpuaDheWPguiAg+aOpeWPo1xyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBUcENvdW50SW5mb3Mge1xyXG4gICAgLyoqXHJcbiAgICAgKiDotYTmupDnmoTlvZPliY3nmoTnirbmgIEsMe+8muacqueUn+aViO+8iOW8gOmAmuS4re+8jOi1hOa6kOi/mOacquS9v+eUqO+8iTLvvJrnlJ/mlYjkuK3vvIjmnKrliLDmnJ/vvIzlj6/mraPluLjkvb/nlKjotYTmupDvvIlcclxuICAgICAqL1xyXG4gICAgc3RhdHVzOiBudW1iZXI7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjeeKtuaAgeWIsOS4i+S4gOatpeaTjeS9nOaJp+ihjO+8jOi/mOWJqeS4i+eahOWkqeaVsO+8iFhYPj0yNOWwj+aXtu+8iVxyXG4gICAgICovXHJcbiAgICBuZXh0T3BlcmF0aW9uUmVtYWluaW5nRGF5PzogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY3nirbmgIHliLDkuIvkuIDmraXmk43kvZzmiafooYzvvIzov5jliankuIvnmoTlsI/ml7bmlbDvvIgyNOWwj+aXtj5YWD49MeWwj+aXtu+8iVxyXG4gICAgICovXHJcbiAgICBuZXh0T3BlcmF0aW9uUmVtYWluaW5nSG91cj86IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN54q25oCB5Yiw5LiL5LiA5q2l5pON5L2c5omn6KGM77yM6L+Y5Ymp5LiL55qE5YiG6ZKf5pWw77yINjDliIbpkp8+WFg+PTHliIbpkp/vvIlcclxuICAgICAqL1xyXG4gICAgbmV4dE9wZXJhdGlvblJlbWFpbmluZ01pbnV0ZT86IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN54q25oCB5Yiw5LiL5LiA5q2l5pON5L2c5omn6KGM77yM6L+Y5Ymp5LiL55qE56eS5pWw77yINjDnp5I+WFjvvIlcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIG5leHRPcGVyYXRpb25SZW1haW5pbmdTZWNvbmQ/OiBudW1iZXI7XHJcbiAgICAvKipcclxuICAgICAqIOi1hOa6kOWIm+W7uuaXtumXtFxyXG4gICAgICovXHJcbiAgICBjcmVhdGVUaW1lPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhYHorrjmnInlpJrkvZnnmoTlsZ7mgKflrZfmrrVcclxuICAgICAqL1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlgJLorqHml7bkv6Hmga/mj5DnpLrkv6Hmga/vvIzmjqXlj6PmmK/moLnmja5cIuS6kei/kOiQpeWFrOWFseaOpeWPo+ivtOaYjlwi5paH5qGjIDIuMjHkupHmnI3liqHlgJLorqHml7bkv6Hmga/mn6Xor6LmjqXlj6Pov5Tlm57mlbDmja7orr7nva7vvIzor6bmg4Xlj4LogIPmjqXlj6NcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHBDb3VudFRpcHMge1xyXG4gICAgLyoqXHJcbiAgICAgKiDotYTmupDnlJ/mlYjml7bpl7TvvIjljbPotYTmupDliJvlu7rml7bpl7TvvIlcclxuICAgICAqL1xyXG4gICAgZWZmVGltZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6LWE5rqQ5Yiw5pyf5pe26Ze077yM5aaC5p6c5bey57uP5qyg6LS577yM5YiZ5Li66LWE5rqQ5qyg6LS55pe26Ze044CCXHJcbiAgICAgKi9cclxuICAgIGV4cFRpbWU/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOWuvemZkOacn+e7k+adn+aXtumXtFxyXG4gICAgICovXHJcbiAgICBncmFjZVRpbWU/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOi1hOa6kOmHiuaUvuaXtumXtFxyXG4gICAgICovXHJcbiAgICByZWxlYXNlVGltZT86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6LWE5rqQ5Ya757uT5pe26Ze0XHJcbiAgICAgKi9cclxuICAgIGZyb3plblRpbWU/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG5cclxuLyoqXHJcbiAqICDorqHotLnmqKHlvI9cclxuICogIHBlcmlvZC3ljIXlkajmnJ/vvIxvbmRlbWFuZC3mjInpnIBcclxuICovXHJcbmV4cG9ydCB0eXBlIFRwQ291bnRDaGFyZ2luZ01vZGUgPSAncGVyaW9kJyB8ICdvbmRlbWFuZCc7XHJcblxyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKiAx6KGMdGlw5YaF5a6577yM5YaF6YOo5L2/55SoXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFRwQ291bnRUaXBJdGVtIHtcclxuICAgIC8vIOagh+mimFxyXG4gICAgdGl0bGU6IHN0cmluZztcclxuICAgIC8vIOaXpeacn+aXtumXtOWtl+espuS4slxyXG4gICAgdGltZTogc3RyaW5nO1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDooajmoLzlgJLorqHml7bnu4Tku7ZcclxuICpcclxuICogdHAtY291bnRkb3duIOe7hOS7tuWNh+e6p+eJiO+8jGNvdW50ZG93bue7hOS7tueahOaOpeWPo+WSjOWKn+iDveS/neeVme+8jOa3u+WKoOiuoei0ueaooeW8j+WSjOi1hOa6kOeKtuaAgVxyXG4gKlxyXG4gKiAxMC4wLjEg5paw5aKeXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55cGx1czNkZW1vLyMvY291bnQvY291bnQtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0cC1jb3VudCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY291bnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9jb3VudC5sZXNzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRwQ291bnRDb21wb25lbnQgZXh0ZW5kcyBUcENvdW50VGltZUNvbXBvbmVudCB7XHJcbiAgICAvKipcclxuICAgICAqIOiuoei0ueaooeW8j1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0eXBlOiBUcENvdW50Q2hhcmdpbmdNb2RlID0gJ3BlcmlvZCc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDotYTmupDnirbmgIHlkozlgJLorqHml7bnmoTniLblrrnlmajvvIzkuLrmt7vliqB0aXBcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnc3RhdGVUaW1lJywgeyBzdGF0aWM6IGZhbHNlIH0pIHN0YXRlVGltZVJlZjogRWxlbWVudFJlZjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5YCS6K6h5pe257uE5Lu2XHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoVHBDb3VudFRpbWVDb21wb25lbnQpIGNvdW50VGltZUNvbTogVHBDb3VudFRpbWVDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIHRpcOWGheWuueaooeadv1xyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCd0aXBDb250ZW50JykgdGlwQ29udGVudFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiB0aXDlrp7kvotcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB0aXBJbnN0YW5jZTogVGlUaXBSZWY7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIHRpcCDnmoTlhoXlrrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRpcENvbnRleHQ6IEFycmF5PFRwQ291bnRUaXBJdGVtPiA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjI6IFJlbmRlcmVyMiwgcHJpdmF0ZSB0aXBTZXJ2aWNlOiBUaVRpcFNlcnZpY2UpIHtcclxuICAgICAgICBzdXBlcihlbGVtZW50LCByZW5kZXJlcjIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RpcCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVUaXBDb250ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkVGlwKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkNoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgLy8g5YCS6K6h5pe2dGlw5o+Q56S65YaF5a656LefIGNvdW50RG93bkNvZGXlkoxjb3VudERvd25UaXBz5pyJ5YWzXHJcbiAgICAgICAgLy8g5q2k5aSE5piv6LWE5rqQ54q25oCB5ZKM5YCS6K6h5pe25pW05L2T5re75YqgdGlwXHJcbiAgICAgICAgaWYgKChjaGFuZ2VzWydjb3VudERvd25Db2RlJ10gJiYgIWNoYW5nZXNbJ2NvdW50RG93bkNvZGUnXS5maXJzdENoYW5nZSkgfHxcclxuICAgICAgICAgICAgKGNoYW5nZXNbJ2NvdW50RG93blRpcHMnXSAmJiAhY2hhbmdlc1snY291bnREb3duVGlwcyddLmZpcnN0Q2hhbmdlKSkge1xyXG4gICAgICAgICAgICAvLyDmjInpnIDmraPlnKjkvb/nlKjpmLbmrrXmsqHmnIl0aXDlrp7kvovvvIzlpITnkIbmjInpnIDmraPlnKjkvb/nlKjlj5jljJbmiJDmjInpnIDlrr3pmZDmnJ/lnLrmma/miqXplJlcclxuICAgICAgICAgICAgaWYgKHRoaXMudGlwSW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGlwSW5zdGFuY2UuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dUaXAoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5oyJ6ZyA5q2j5Zyo5L2/55So6Zi25q615Yiw5oyJ6ZyA5a696ZmQ5pyf77yM5qih5p2/55qEbmctaWYg5p2h5Lu25pS55Y+Y5a+86Ie0c3RhdGVUaW1lUmVm5piv5ZCm5a2Y5Zyo5Lmf5pS55Y+YXHJcbiAgICAgICAgICAgICAgICAvLyBzdGF0ZVRpbWVSZWbml6Dms5Xnq4vliLvojrflj5bliLBcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVGlwKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNob3dTdGF0ZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gISh0aGlzLmNvdW50RG93bkNvZGUgPT09ICdod3NfY291bnRkb3duX3BlcmlvZF91c2luZycgfHxcclxuICAgICAgICAgICAgdGhpcy5jb3VudERvd25Db2RlID09PSAnaHdzX2NvdW50ZG93bl9wZXJpb2RfdG9vbmRlbWFuZCcgfHxcclxuICAgICAgICAgICAgdGhpcy5jb3VudERvd25Db2RlID09PSAnaHdzX2NvdW50ZG93bl9vbmRlbWFuZF91c2luZycpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYWRkVGlwKCk6IHZvaWQge1xyXG4gICAgICAgIC8vICDmjInpnIDmraPlnKjkvb/nlKjml7blm6DkuLrmmL7npLrlhoXlrrnlkox0aXDlhoXlrrnnm7jlkIzvvIzmiYDmnInkuI3pnIDopoF0aXBcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnRpcENvbnRleHQpICYmIHRoaXMudGlwQ29udGV4dC5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgICYmIHRoaXMuY291bnREb3duQ29kZSAhPT0gJ2h3c19jb3VudGRvd25fb25kZW1hbmRfdXNpbmcnICYmIHRoaXMuc3RhdGVUaW1lUmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlwSW5zdGFuY2UgPSB0aGlzLnRpcFNlcnZpY2UuY3JlYXRlKHRoaXMuc3RhdGVUaW1lUmVmLm5hdGl2ZUVsZW1lbnQsIHtcclxuICAgICAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXHJcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogdGhpcy50aXBNYXhXaWR0aCxcclxuICAgICAgICAgICAgICAgIHNob3dGbjogKCk6IFRpVGlwU2hvd0luZm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMudGlwQ29udGVudFRlbXBsYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==