import { Component, ElementRef, EventEmitter, Input, Output, Renderer2, ViewChild } from '@angular/core';
import { TiLocale, TiFormComponent, Util, TiDominatorComponent, TiDropsearchComponent, TiButtongroupComponent } from '@cloud/tiny3';
/**
 * @ignore
 * 规范提出，云业务通用场景不会使用该组件，10.1.3起，在官网隐藏该组件。
 *
 * regionselect组件提供省、市、县三级区域的选择
 *
 * <example-url>../tinyplus3demo/#/regionselect/regionselect-all</example-url>
 */
export class TpRegionselectComponent extends TiFormComponent {
    constructor(hostRef, renderer) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        /**
         * 无数据时组件下展显示，需服务自行配置
         */
        this.noDataText = '...';
        /**
         * 是否支持搜索
         */
        this.searchable = false;
        /**
         * 区域点击选择之后触发该事件
         */
        this.change = new EventEmitter();
        /**
         * @ignore
         */
        this.labelKey = 'label';
        /**
         * @ignore
         */
        this.options = []; // 下拉实际数据,默认空数组
        this.regionArr = [];
        this.isNotLastOne = true; // 标志量 是否为最后一级
        this.classificationLevel = 0; // 当前正在选择区域项的等级，省为0，市为1，区为2
        this.currentClassificationsLength = 0; // 当前已选择区域项的等级，省为0，市为1，区为2
        this.cfRegionSelectSeparativeSign = '-';
        this.oldSearchable = undefined;
    }
    /**
     * @ignore
     */
    writeValue(val) {
        if (!val) {
            return;
        }
        else {
            this.model = val;
        }
        this.initSelectedData();
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        this.classifications = [
            {
                id: 'province',
                text: TiLocale.getLocaleWords().tpRegionselect.regionSelect_province_label
            }, {
                id: 'city',
                text: TiLocale.getLocaleWords().tpRegionselect.regionSelect_city_label
            }, {
                id: 'country',
                text: TiLocale.getLocaleWords().tpRegionselect.regionSelect_county_label
            }
        ];
        this.model = Util.isUndefined(this.model) ? {} : this.model;
        this.hasadjustWidth = false;
        this.options = this.regionselectOption;
        this.getBtnItems();
        this.changePlaceholder();
        this.changeBtnRight();
        this.changeSelectedData();
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.setFocusableElems(this.TiDominatorCom.getFocusableElems());
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems(this.TiDominatorCom.getFocusableElems()
                    .concat(this.dropCom.getFocusableElems()));
            }
            else {
                this.setFocusableElems(this.TiDominatorCom.getFocusableElems());
            }
        }
    }
    /**
     * @ignore
     */
    onMousedownFn(event) {
        event.preventDefault(); // 防止按钮聚焦
        event.stopPropagation(); // 阻止事件冒泡到document
    }
    /**
     * @ignore
     */
    onBlur() {
        this.dropCom.hideWithoutFocus();
        this.dropshow = false;
    }
    /**
     * @ignore
     * 点击关闭或隐藏下拉面板
     */
    onClickFn(event) {
        if (this.dropCom.isShow) {
            this.dropCom.hide();
            this.dropshow = false;
        }
        else {
            this.dropCom.show();
            this.dropshow = true;
            if (!this.hasadjustWidth) {
                const btns = document.querySelectorAll('.ti3-btn-item');
                const extraWidth = this.getExtraWidth();
                const width = extraWidth / btns.length;
                btns.forEach((btn) => {
                    const oriWidth = btn.offsetWidth;
                    this.renderer.setStyle(btn, 'width', oriWidth + width + 'px');
                });
                this.hasadjustWidth = true;
            }
        }
    }
    /**
     * @ignore
     * 选择数据之后触发事件
     */
    onSelect(option) {
        this.onSelectFn(option);
        this.change.emit(option);
        const event = window.event;
    }
    onSelectFn(selectedRegion) {
        const currentBtn = this.btnItems[this.classificationLevel]; // 当前准备选择的按钮等级
        currentBtn.selectedText = selectedRegion.label; // 等级名称获取
        // 判断选择项是否是曾经已选择项
        const isChosenOption = this.btnItems.some((btnItem) => {
            return btnItem.selectedId === selectedRegion.id;
        });
        if (!isChosenOption) {
            this.currentClassificationsLength = this.btnItems.findIndex((btnItem) => btnItem.id === this.btnSelected.id); // 获取当前已选择的级别（0、1、2）
            this.btnItems.forEach((item, index) => {
                if (index > this.currentClassificationsLength) {
                    item.selectedText = item.text;
                    item.originId = '';
                    item.selectedId = '';
                }
            });
        }
        this.btnItems[this.classificationLevel].selectedId = selectedRegion.id;
        this.changeSelectedData();
        this.isNotLastOne = this.classificationLevel < this.btnItems.length - 1;
        if (this.isNotLastOne) {
            this.classificationLevel++;
            this.currentClassificationsLength++;
            this.btnItems[this.classificationLevel].originId = this.btnItems[this.classificationLevel].originId || selectedRegion.id;
            this.handleOriginSuggestions();
            this.changeDropdownSuggestions();
            /**
             * 1、当子选项只有一项，且子选项id与当前项id相同，证明为同一区域级别
             * 2、同一区域级别情况下，如果子选项不是最后一级，证明为直辖市，需要自动跳过子选项的选择
             * 3、同一区域级别情况下，如果子选项是最后一级，证明为直辖县，则正常显示
             */
            if (this.originSuggestions.length === 1 &&
                (this.originSuggestions[0].id === selectedRegion.id
                    && this.classificationLevel < this.btnItems.length - 1)) {
                this.btnItems[this.classificationLevel].noDataDisable = true;
                this.onSelectFn(this.originSuggestions[0]);
            }
            else {
                this.btnItems[this.classificationLevel].noDataDisable = false;
                this.btnSelected = this.btnItems[this.classificationLevel];
                this.btnChangeFn();
            }
        }
        else {
            // 点击最低级别地区之后，面板会收起
            this.dropshow = false;
        }
        this.changePlaceholder();
        this.changeBtnRight();
    }
    // 当选择区域后，会更改selectedData数据
    changeSelectedData() {
        const selectedTextArr = [];
        this.btnItems.forEach((item, index) => {
            const hasChosen = item.selectedText !== item.text;
            if (hasChosen) {
                if (index === this.classificationLevel) {
                    this.model[item.id] = {
                        id: item.selectedId,
                        label: item.selectedText
                    };
                }
                if (item.selectedText && !item.noDataDisable) {
                    selectedTextArr.push(item.selectedText);
                }
                this.model.id = item.selectedId;
                this.model.level = index;
            }
            else {
                this.model[item.id] = {};
            }
        });
        this.model.text = selectedTextArr.join(this.cfRegionSelectSeparativeSign);
        // 改变model地址触发modelchange事件发生
        this.model = Object.assign({}, this.model);
    }
    // 获取按钮配置项
    getBtnItems() {
        this.btnItems = this.classifications.map((classification) => {
            classification.selectedText = classification.text;
            return classification;
        });
        this.btnSelected = this.btnItems[0];
    }
    // 根据selected初始配置,逻辑处理
    initSelectedData() {
        if ((this.model && !this.model.id) || !this.regionselectOption || !this.regionselectOption.length) {
            return;
        }
        const regionIdArr = this.getRegionIdArr();
        if (regionIdArr.length) {
            this.getBtnItems();
            this.btnChangeFn();
            for (const item of regionIdArr) {
                this.onSelectFn(item);
            }
        }
    }
    // tslint:disable-next-line:typedef
    getRegionIdArr() {
        this.getSelectedOption(this.regionselectOption);
        return this.regionArr;
    }
    // 根据selectedId 获取已选择数据详情
    getSelectedOption(items) {
        this.hasFoundId = false;
        this.regionArr = [];
        // tslint:disable-next-line:prefer-for-of
        for (let i = 0; i < items.length; i++) {
            if (items[i].id === this.model.id) {
                this.hasFoundId = true;
                const nextLevel = items[i].nextLevel;
                if (nextLevel && nextLevel.length && nextLevel[0].id === items[i].id) {
                    this.isSpecialZone = true;
                }
                if (this.isSpecialZone && !items[i].nextLevel[0].nextLevel) { // 直辖县
                    this.regionArr.unshift({
                        id: items[i].id,
                        label: items[i].label
                    });
                }
                this.regionArr.unshift({
                    id: items[i].id,
                    label: items[i].label
                });
                break;
            }
            if (items[i].nextLevel && items[i].nextLevel.length) {
                this.getSelectedOption(items[i].nextLevel);
                if (this.hasFoundId) {
                    this.regionArr.unshift({
                        id: items[i].id,
                        label: items[i].label
                    });
                    break;
                }
            }
        }
    }
    /**
     * @ignore
     */
    btnChangeFn() {
        const selectedBtn = this.btnItems.find((item) => item.id === this.btnSelected.id);
        this.classificationLevel = this.btnItems.findIndex((item) => item === selectedBtn);
        this.isNotLastOne = this.classificationLevel < this.btnItems.length - 1;
        this.handleOriginSuggestions();
        this.changeDropdownSuggestions();
        if (this.model && this.model[selectedBtn.id]) {
            const index = this.options.findIndex((item) => item.id === this.model[selectedBtn.id].id);
            this.currentmodel = this.options[index];
        }
    }
    findIndex() {
        return this.options.findIndex((item) => item.id === this.model.id);
    }
    handleOriginSuggestions() {
        let dropdownSuggestions = this.regionselectOption;
        this.originSuggestions = [];
        this.btnItems.forEach((item, index) => {
            if (index > this.classificationLevel) {
                return;
            }
            const currentData = dropdownSuggestions.find((dropdown) => {
                return dropdown.id === item.originId;
            });
            if (currentData && currentData.nextLevel && currentData.nextLevel.length) {
                dropdownSuggestions = currentData.nextLevel;
            }
        });
        if (!dropdownSuggestions) {
            return;
        }
        // 根据id从小到大进行排序
        dropdownSuggestions = dropdownSuggestions.sort((a, b) => {
            return a.id - b.id;
        });
        dropdownSuggestions.forEach((item1) => {
            this.originSuggestions.push({
                id: item1.id,
                label: item1.label,
                nextLevel: item1.nextLevel
            });
        });
    }
    // 根据originId从原始数据中第一级往下寻找
    changeDropdownSuggestions() {
        this.options = this.originSuggestions;
    }
    // 更改选择区域显示文本
    changePlaceholder() {
        let showText = '';
        this.btnItems.forEach((item, index) => {
            if (item.noDataDisable) {
                return;
            }
            const text = item.selectedText + ' ';
            if (index === 0) {
                showText += text;
            }
            else {
                // tslint:disable-next-line:prefer-template
                showText += this.cfRegionSelectSeparativeSign + ' ' + text;
            }
        });
        this.showText = showText;
    }
    // 判断按钮组disable权限
    changeBtnRight() {
        this.btnItems.map((item, index) => {
            item.disabled = (index > this.currentClassificationsLength) || item.noDataDisable;
            return item;
        });
    }
    /**
     * @ignore
     * 判断是否溢出并获取超出宽度
     */
    getExtraWidth() {
        const wrapperWidth = this.wrapperEle.nativeElement.offsetWidth;
        const buttonsWidth = this.buttongroupEle.nativeElement.offsetWidth;
        const isOverflow = wrapperWidth > buttonsWidth;
        if (!isOverflow) {
            return 0;
        }
        else {
            const extraWidth = wrapperWidth - buttonsWidth;
            return extraWidth;
        }
    }
}
TpRegionselectComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-regionselect',
                template: "\r\n    <ti-dominator class='tp-regionselect-dominator' #wrapper (click)='onClickFn($event)'\r\n    [dropshow]='dropshow'\r\n    [id]=\"appendId('regionselect_dominator')\">\r\n        <ng-template #placeholder>\r\n            <span [id]=\"appendId('text')\">{{showText}}</span>\r\n        </ng-template>\r\n    </ti-dominator>\r\n    <ti-dropsearch [searchable]=\"searchable\"\r\n        [labelKey]='labelKey' [options]='options'\r\n        [noDataText]='noDataText'\r\n        panelWidth='auto'\r\n        [(ngModel)]=\"currentmodel\"\r\n        [dominatorElem]='TiDominatorCom.nativeElement'\r\n        (select)='onSelect($event)'\r\n        [id]=\"appendId('dropsearch')\">\r\n        <div #buttongroup custom style='display: inline-block;' (mousedown)=\"onMousedownFn($event)\">\r\n            <ti-button-group [items]='btnItems' [(ngModel)]='btnSelected' (ngModelChange)=\"btnChangeFn()\" [id]=\"appendId('button_group')\"></ti-button-group>\r\n        </div>\r\n        <ng-template #item let-item let-i=index>\r\n               <ng-container *ngTemplateOutlet='itemTemplate; context: {$implicit: item, index: i}'></ng-container>\r\n        </ng-template>\r\n</ti-dropsearch>\r\n\r\n<ng-template #itemTemplate let-item let-i=index>\r\n    {{item[labelKey]}}\r\n</ng-template>\r\n\r\n",
                providers: [TiFormComponent.getValueAccessor(TpRegionselectComponent)],
                host: {
                    '(blur)': 'onBlur()'
                },
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-component-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;display:inline-block}.tp-component-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-common-color-line-normal)}.tp-component-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-common-color-line-hover)}.tp-component-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-common-color-line-active)}.tp-component-container-border[disabled],:host[disabled]{background-color:var(--ti-common-color-bg-disabled);border-color:var(--ti-common-color-line-disabled);cursor:not-allowed!important}:host{width:300px}"]
            },] }
];
TpRegionselectComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TpRegionselectComponent.propDecorators = {
    regionselectOption: [{ type: Input }],
    noDataText: [{ type: Input }],
    searchable: [{ type: Input }],
    change: [{ type: Output }],
    TiDominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    dropCom: [{ type: ViewChild, args: [TiDropsearchComponent, { static: true },] }],
    btnGroupCom: [{ type: ViewChild, args: [TiButtongroupComponent, { static: true },] }],
    wrapperEle: [{ type: ViewChild, args: ['wrapper', { static: false },] }],
    buttongroupEle: [{ type: ViewChild, args: ['buttongroup', { static: false },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBSZWdpb25zZWxlY3RDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueXBsdXMzL2NvbXBvbmVudHMvcmVnaW9uc2VsZWN0L1RwUmVnaW9uc2VsZWN0Q29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekcsT0FBTyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLHFCQUFxQixFQUFFLHNCQUFzQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBdUJwSTs7Ozs7OztHQU9HO0FBV0gsTUFBTSxPQUFPLHVCQUF3QixTQUFRLGVBQWU7SUFDeEQsWUFBc0IsT0FBbUIsRUFBWSxRQUFtQjtRQUNwRSxLQUFLLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRFAsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFZLGFBQVEsR0FBUixRQUFRLENBQVc7UUFPeEU7O1dBRUc7UUFDTSxlQUFVLEdBQVcsS0FBSyxDQUFDO1FBQ3BDOztXQUVHO1FBQ00sZUFBVSxHQUFZLEtBQUssQ0FBQztRQUNyQzs7V0FFRztRQUNnQixXQUFNLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFxQnZFOztXQUVHO1FBQ0ksYUFBUSxHQUFXLE9BQU8sQ0FBQztRQWFsQzs7V0FFRztRQUNJLFlBQU8sR0FBZ0MsRUFBRSxDQUFDLENBQUMsZUFBZTtRQVN6RCxjQUFTLEdBQWUsRUFBRSxDQUFDO1FBRzNCLGlCQUFZLEdBQVksSUFBSSxDQUFDLENBQUMsY0FBYztRQUU1Qyx3QkFBbUIsR0FBVyxDQUFDLENBQUMsQ0FBQywyQkFBMkI7UUFDNUQsaUNBQTRCLEdBQVcsQ0FBQyxDQUFDLENBQUMs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QyxTQUFTLFNBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUxvY2FsZSwgVGlGb3JtQ29tcG9uZW50LCBVdGlsLCBUaURvbWluYXRvckNvbXBvbmVudCwgVGlEcm9wc2VhcmNoQ29tcG9uZW50LCBUaUJ1dHRvbmdyb3VwQ29tcG9uZW50IH0gZnJvbSAnQGNsb3VkL3RpbnkzJztcclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICog6KeE6IyD5o+Q5Ye677yM5LqR5Lia5Yqh6YCa55So5Zy65pmv5LiN5Lya5L2/55So6K+l57uE5Lu277yMMTAuMS4z6LW377yM5Zyo5a6Y572R6ZqQ6JeP6K+l57uE5Lu244CCXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFRwUmVnaW9uc2VsZWN0T3B0aW9uIHtcclxuICAgIC8qKlxyXG4gICAgICog5Zyw5Yy65ZCN56ewXHJcbiAgICAgKi9cclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOWcsOWMuuWvueW6lOW6j+WIl0lEXHJcbiAgICAgKi9cclxuICAgIGlkOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjeWcsOWMuueahOS4i+e6p+WcsOWMuuWIl+ihqFxyXG4gICAgICovXHJcbiAgICBuZXh0TGV2ZWw/OiBBcnJheTxUcFJlZ2lvbnNlbGVjdE9wdGlvbj47XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKiDop4TojIPmj5Dlh7rvvIzkupHkuJrliqHpgJrnlKjlnLrmma/kuI3kvJrkvb/nlKjor6Xnu4Tku7bvvIwxMC4xLjPotbfvvIzlnKjlrpjnvZHpmpDol4/or6Xnu4Tku7bjgIJcclxuICpcclxuICogcmVnaW9uc2VsZWN057uE5Lu25o+Q5L6b55yB44CB5biC44CB5Y6/5LiJ57qn5Yy65Z+f55qE6YCJ5oupXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55cGx1czNkZW1vLyMvcmVnaW9uc2VsZWN0L3JlZ2lvbnNlbGVjdC1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RwLXJlZ2lvbnNlbGVjdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcmVnaW9uc2VsZWN0Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vcmVnaW9uc2VsZWN0Lmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRwUmVnaW9uc2VsZWN0Q29tcG9uZW50KV0sXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJyhibHVyKSc6ICdvbkJsdXIoKSdcclxuICAgIH1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUcFJlZ2lvbnNlbGVjdENvbXBvbmVudCBleHRlbmRzIFRpRm9ybUNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaG9zdFJlZjogRWxlbWVudFJlZiwgcHJvdGVjdGVkIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcclxuICAgICAgICBzdXBlcihob3N0UmVmLCByZW5kZXJlcik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWMuuWfn+mAieaLqeaAu+aVsOaNrlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSByZWdpb25zZWxlY3RPcHRpb246IEFycmF5PFRwUmVnaW9uc2VsZWN0T3B0aW9uPjsgLy8g5LiL5ouJ5oC75pWw5o2uXHJcbiAgICAvKipcclxuICAgICAqIOaXoOaVsOaNruaXtue7hOS7tuS4i+WxleaYvuekuu+8jOmcgOacjeWKoeiHquihjOmFjee9rlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBub0RhdGFUZXh0OiBzdHJpbmcgPSAnLi4uJztcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5pSv5oyB5pCc57SiXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHNlYXJjaGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKlxyXG4gICAgICog5Yy65Z+f54K55Ye76YCJ5oup5LmL5ZCO6Kem5Y+R6K+l5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBjaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURvbWluYXRvckNvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgVGlEb21pbmF0b3JDb206IFRpRG9taW5hdG9yQ29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoVGlEcm9wc2VhcmNoQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBkcm9wQ29tOiBUaURyb3BzZWFyY2hDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaUJ1dHRvbmdyb3VwQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBidG5Hcm91cENvbTogVGlCdXR0b25ncm91cENvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCd3cmFwcGVyJywgeyBzdGF0aWM6IGZhbHNlIH0pIHdyYXBwZXJFbGU6IEVsZW1lbnRSZWY7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnYnV0dG9uZ3JvdXAnLCB7IHN0YXRpYzogZmFsc2UgfSkgYnV0dG9uZ3JvdXBFbGU6IEVsZW1lbnRSZWY7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGxhYmVsS2V5OiBzdHJpbmcgPSAnbGFiZWwnO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzaG93VGV4dDogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBidG5JdGVtczogQXJyYXk8YW55PjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYnRuU2VsZWN0ZWQ6IGFueTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3B0aW9uczogQXJyYXk8VHBSZWdpb25zZWxlY3RPcHRpb24+ID0gW107IC8vIOS4i+aLieWunumZheaVsOaNrizpu5jorqTnqbrmlbDnu4RcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY3VycmVudG1vZGVsOiBhbnk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGRyb3BzaG93OiBib29sZWFuOyAvLyDorrDlvZXkuIvmi4npnaLmnb/lsZXlvIDnirbmgIFcclxuICAgIHByaXZhdGUgcmVnaW9uQXJyOiBBcnJheTxhbnk+ID0gW107XHJcbiAgICBwcml2YXRlIGhhc0ZvdW5kSWQ6IGJvb2xlYW47IC8vIOagh+W/l+mHjyDmmK/lkKbmoLnmja5pZOaJvuWIsOWMuemFjemhuVxyXG4gICAgcHJpdmF0ZSBpc1NwZWNpYWxab25lOiBib29sZWFuOyAvLyDmoIflv5fph48g5piv5ZCm5Li655u06L6W5biCXHJcbiAgICBwcml2YXRlIGlzTm90TGFzdE9uZTogYm9vbGVhbiA9IHRydWU7IC8vIOagh+W/l+mHjyDmmK/lkKbkuLrmnIDlkI7kuIDnuqdcclxuICAgIHByaXZhdGUgY2xhc3NpZmljYXRpb25zOiBBcnJheTxhbnk+O1xyXG4gICAgcHJpdmF0ZSBjbGFzc2lmaWNhdGlvbkxldmVsOiBudW1iZXIgPSAwOyAvLyDlvZPliY3mraPlnKjpgInmi6nljLrln5/pobnnmoTnrYnnuqfvvIznnIHkuLow77yM5biC5Li6Me+8jOWMuuS4ujJcclxuICAgIHByaXZhdGUgY3VycmVudENsYXNzaWZpY2F0aW9uc0xlbmd0aDogbnVtYmVyID0gMDsgLy8g5b2T5YmN5bey6YCJ5oup5Yy65Z+f6aG555qE562J57qn77yM55yB5Li6MO+8jOW4guS4ujHvvIzljLrkuLoyXHJcbiAgICBwcml2YXRlIGNmUmVnaW9uU2VsZWN0U2VwYXJhdGl2ZVNpZ246IHN0cmluZyA9ICctJztcclxuICAgIHByaXZhdGUgb3JpZ2luU3VnZ2VzdGlvbnM6IEFycmF5PFRwUmVnaW9uc2VsZWN0T3B0aW9uPjtcclxuICAgIHByaXZhdGUgaGFzYWRqdXN0V2lkdGg6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIG9sZFNlYXJjaGFibGU6IGJvb2xlYW4gPSB1bmRlZmluZWQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgd3JpdGVWYWx1ZSh2YWw6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdmFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGVsID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmluaXRTZWxlY3RlZERhdGEoKTtcclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvbnMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAncHJvdmluY2UnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogVGlMb2NhbGUuZ2V0TG9jYWxlV29yZHMoKS50cFJlZ2lvbnNlbGVjdC5yZWdpb25TZWxlY3RfcHJvdmluY2VfbGFiZWxcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICdjaXR5JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudHBSZWdpb25zZWxlY3QucmVnaW9uU2VsZWN0X2NpdHlfbGFiZWxcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICdjb3VudHJ5JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudHBSZWdpb25zZWxlY3QucmVnaW9uU2VsZWN0X2NvdW50eV9sYWJlbFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLm1vZGVsID0gVXRpbC5pc1VuZGVmaW5lZCh0aGlzLm1vZGVsKSA/IHt9IDogdGhpcy5tb2RlbDtcclxuICAgICAgICB0aGlzLmhhc2FkanVzdFdpZHRoID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5yZWdpb25zZWxlY3RPcHRpb247XHJcbiAgICAgICAgdGhpcy5nZXRCdG5JdGVtcygpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlUGxhY2Vob2xkZXIoKTtcclxuICAgICAgICB0aGlzLmNoYW5nZUJ0blJpZ2h0KCk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGEoKTtcclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKHRoaXMuVGlEb21pbmF0b3JDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKSk7XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdDaGVja2VkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSAhPT0gdGhpcy5vbGRTZWFyY2hhYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub2xkU2VhcmNoYWJsZSA9IHRoaXMuc2VhcmNoYWJsZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyh0aGlzLlRpRG9taW5hdG9yQ29tLmdldEZvY3VzYWJsZUVsZW1zKClcclxuICAgICAgICAgICAgICAgICAgICAuY29uY2F0KHRoaXMuZHJvcENvbS5nZXRGb2N1c2FibGVFbGVtcygpKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKHRoaXMuVGlEb21pbmF0b3JDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uTW91c2Vkb3duRm4oZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAgLy8g6Ziy5q2i5oyJ6ZKu6IGa54SmXHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7ICAvLyDpmLvmraLkuovku7blhpLms6HliLBkb2N1bWVudFxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkJsdXIoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kcm9wQ29tLmhpZGVXaXRob3V0Rm9jdXMoKTtcclxuICAgICAgICB0aGlzLmRyb3BzaG93ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeCueWHu+WFs+mXreaIlumakOiXj+S4i+aLiemdouadv1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja0ZuKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZHJvcENvbS5pc1Nob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5kcm9wQ29tLmhpZGUoKTtcclxuICAgICAgICAgICAgdGhpcy5kcm9wc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcENvbS5zaG93KCk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcHNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzYWRqdXN0V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ0bnM6IE5vZGVMaXN0T2Y8RWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGkzLWJ0bi1pdGVtJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHRyYVdpZHRoOiBudW1iZXIgPSB0aGlzLmdldEV4dHJhV2lkdGgoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdpZHRoOiBudW1iZXIgPSBleHRyYVdpZHRoIC8gYnRucy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBidG5zLmZvckVhY2goKGJ0bjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpV2lkdGg6IG51bWJlciA9IGJ0bi5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGJ0biwgJ3dpZHRoJywgb3JpV2lkdGggKyB3aWR0aCArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhc2FkanVzdFdpZHRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6YCJ5oup5pWw5o2u5LmL5ZCO6Kem5Y+R5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvblNlbGVjdChvcHRpb246IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub25TZWxlY3RGbihvcHRpb24pO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlLmVtaXQob3B0aW9uKTtcclxuICAgICAgICBjb25zdCBldmVudDogYW55ID0gd2luZG93LmV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25TZWxlY3RGbihzZWxlY3RlZFJlZ2lvbjogVHBSZWdpb25zZWxlY3RPcHRpb24pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjdXJyZW50QnRuOiBhbnkgPSB0aGlzLmJ0bkl0ZW1zW3RoaXMuY2xhc3NpZmljYXRpb25MZXZlbF07IC8vIOW9k+WJjeWHhuWkh+mAieaLqeeahOaMiemSruetiee6p1xyXG4gICAgICAgIGN1cnJlbnRCdG4uc2VsZWN0ZWRUZXh0ID0gc2VsZWN0ZWRSZWdpb24ubGFiZWw7IC8vIOetiee6p+WQjeensOiOt+WPllxyXG4gICAgICAgIC8vIOWIpOaWremAieaLqemhueaYr+WQpuaYr+abvue7j+W3sumAieaLqemhuVxyXG4gICAgICAgIGNvbnN0IGlzQ2hvc2VuT3B0aW9uOiBib29sZWFuID0gdGhpcy5idG5JdGVtcy5zb21lKChidG5JdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGJ0bkl0ZW0uc2VsZWN0ZWRJZCA9PT0gc2VsZWN0ZWRSZWdpb24uaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKCFpc0Nob3Nlbk9wdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDbGFzc2lmaWNhdGlvbnNMZW5ndGggPSB0aGlzLmJ0bkl0ZW1zLmZpbmRJbmRleCgoYnRuSXRlbTogYW55KSA9PlxyXG4gICAgICAgICAgICAgICAgYnRuSXRlbS5pZCA9PT0gdGhpcy5idG5TZWxlY3RlZC5pZCk7IC8vIOiOt+WPluW9k+WJjeW3sumAieaLqeeahOe6p+WIq++8iDDjgIEx44CBMu+8iVxyXG4gICAgICAgICAgICB0aGlzLmJ0bkl0ZW1zLmZvckVhY2goKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gdGhpcy5jdXJyZW50Q2xhc3NpZmljYXRpb25zTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZFRleHQgPSBpdGVtLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5vcmlnaW5JZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWRJZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYnRuSXRlbXNbdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsXS5zZWxlY3RlZElkID0gc2VsZWN0ZWRSZWdpb24uaWQ7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGEoKTtcclxuICAgICAgICB0aGlzLmlzTm90TGFzdE9uZSA9IHRoaXMuY2xhc3NpZmljYXRpb25MZXZlbCA8IHRoaXMuYnRuSXRlbXMubGVuZ3RoIC0gMTtcclxuICAgICAgICBpZiAodGhpcy5pc05vdExhc3RPbmUpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsKys7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENsYXNzaWZpY2F0aW9uc0xlbmd0aCsrO1xyXG4gICAgICAgICAgICB0aGlzLmJ0bkl0ZW1zW3RoaXMuY2xhc3NpZmljYXRpb25MZXZlbF0ub3JpZ2luSWQgPSB0aGlzLmJ0bkl0ZW1zW3RoaXMuY2xhc3NpZmljYXRpb25MZXZlbF0ub3JpZ2luSWQgfHwgc2VsZWN0ZWRSZWdpb24uaWQ7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3JpZ2luU3VnZ2VzdGlvbnMoKTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VEcm9wZG93blN1Z2dlc3Rpb25zKCk7XHJcblxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogMeOAgeW9k+WtkOmAiemhueWPquacieS4gOmhue+8jOS4lOWtkOmAiemhuWlk5LiO5b2T5YmN6aG5aWTnm7jlkIzvvIzor4HmmI7kuLrlkIzkuIDljLrln5/nuqfliKtcclxuICAgICAgICAgICAgICogMuOAgeWQjOS4gOWMuuWfn+e6p+WIq+aDheWGteS4i++8jOWmguaenOWtkOmAiemhueS4jeaYr+acgOWQjuS4gOe6p++8jOivgeaYjuS4uuebtOi+luW4gu+8jOmcgOimgeiHquWKqOi3s+i/h+WtkOmAiemhueeahOmAieaLqVxyXG4gICAgICAgICAgICAgKiAz44CB5ZCM5LiA5Yy65Z+f57qn5Yir5oOF5Ya15LiL77yM5aaC5p6c5a2Q6YCJ6aG55piv5pyA5ZCO5LiA57qn77yM6K+B5piO5Li655u06L6W5Y6/77yM5YiZ5q2j5bi45pi+56S6XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vcmlnaW5TdWdnZXN0aW9ucy5sZW5ndGggPT09IDEgJiZcclxuICAgICAgICAgICAgICAgICh0aGlzLm9yaWdpblN1Z2dlc3Rpb25zWzBdLmlkID09PSBzZWxlY3RlZFJlZ2lvbi5pZFxyXG4gICAgICAgICAgICAgICAgICAgICYmIHRoaXMuY2xhc3NpZmljYXRpb25MZXZlbCA8IHRoaXMuYnRuSXRlbXMubGVuZ3RoIC0gMSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnRuSXRlbXNbdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsXS5ub0RhdGFEaXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3RGbih0aGlzLm9yaWdpblN1Z2dlc3Rpb25zWzBdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnRuSXRlbXNbdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsXS5ub0RhdGFEaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ0blNlbGVjdGVkID0gdGhpcy5idG5JdGVtc1t0aGlzLmNsYXNzaWZpY2F0aW9uTGV2ZWxdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5idG5DaGFuZ2VGbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g54K55Ye75pyA5L2O57qn5Yir5Zyw5Yy65LmL5ZCO77yM6Z2i5p2/5Lya5pS26LW3XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcHNob3cgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VQbGFjZWhvbGRlcigpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlQnRuUmlnaHQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlvZPpgInmi6nljLrln5/lkI7vvIzkvJrmm7TmlLlzZWxlY3RlZERhdGHmlbDmja5cclxuICAgIHByaXZhdGUgY2hhbmdlU2VsZWN0ZWREYXRhKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkVGV4dEFycjogQXJyYXk8YW55PiA9IFtdO1xyXG4gICAgICAgIHRoaXMuYnRuSXRlbXMuZm9yRWFjaCgoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhc0Nob3NlbjogYm9vbGVhbiA9IGl0ZW0uc2VsZWN0ZWRUZXh0ICE9PSBpdGVtLnRleHQ7XHJcbiAgICAgICAgICAgIGlmIChoYXNDaG9zZW4pIHtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbFtpdGVtLmlkXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uc2VsZWN0ZWRJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0uc2VsZWN0ZWRUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnNlbGVjdGVkVGV4dCAmJiAhaXRlbS5ub0RhdGFEaXNhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRUZXh0QXJyLnB1c2goaXRlbS5zZWxlY3RlZFRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5pZCA9IGl0ZW0uc2VsZWN0ZWRJZDtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubGV2ZWwgPSBpbmRleDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWxbaXRlbS5pZF0gPSB7fTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMubW9kZWwudGV4dCA9IHNlbGVjdGVkVGV4dEFyci5qb2luKHRoaXMuY2ZSZWdpb25TZWxlY3RTZXBhcmF0aXZlU2lnbik7XHJcbiAgICAgICAgLy8g5pS55Y+YbW9kZWzlnLDlnYDop6blj5Ftb2RlbGNoYW5nZeS6i+S7tuWPkeeUn1xyXG4gICAgICAgIHRoaXMubW9kZWwgPSB7Li4udGhpcy5tb2RlbH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6I635Y+W5oyJ6ZKu6YWN572u6aG5XHJcbiAgICBwcml2YXRlIGdldEJ0bkl0ZW1zKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYnRuSXRlbXMgPSB0aGlzLmNsYXNzaWZpY2F0aW9ucy5tYXAoKGNsYXNzaWZpY2F0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY2xhc3NpZmljYXRpb24uc2VsZWN0ZWRUZXh0ID0gY2xhc3NpZmljYXRpb24udGV4dDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjbGFzc2lmaWNhdGlvbjtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmJ0blNlbGVjdGVkID0gdGhpcy5idG5JdGVtc1swXTtcclxuICAgIH1cclxuICAgIC8vIOagueaNrnNlbGVjdGVk5Yid5aeL6YWN572uLOmAu+i+keWkhOeQhlxyXG4gICAgcHJpdmF0ZSBpbml0U2VsZWN0ZWREYXRhKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICgodGhpcy5tb2RlbCAmJiAhdGhpcy5tb2RlbC5pZCkgfHwgIXRoaXMucmVnaW9uc2VsZWN0T3B0aW9uIHx8ICF0aGlzLnJlZ2lvbnNlbGVjdE9wdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCByZWdpb25JZEFycjogQXJyYXk8YW55PiA9IHRoaXMuZ2V0UmVnaW9uSWRBcnIoKTtcclxuICAgICAgICBpZiAocmVnaW9uSWRBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0QnRuSXRlbXMoKTtcclxuICAgICAgICAgICAgdGhpcy5idG5DaGFuZ2VGbigpO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmVnaW9uSWRBcnIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3RGbihpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0eXBlZGVmXHJcbiAgICBwcml2YXRlIGdldFJlZ2lvbklkQXJyKCkge1xyXG4gICAgICAgIHRoaXMuZ2V0U2VsZWN0ZWRPcHRpb24odGhpcy5yZWdpb25zZWxlY3RPcHRpb24pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpb25BcnI7XHJcbiAgICB9XHJcbiAgICAvLyDmoLnmja5zZWxlY3RlZElkIOiOt+WPluW3sumAieaLqeaVsOaNruivpuaDhVxyXG4gICAgcHJpdmF0ZSBnZXRTZWxlY3RlZE9wdGlvbihpdGVtczogQXJyYXk8YW55Pik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuaGFzRm91bmRJZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVnaW9uQXJyID0gW107XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mb3Itb2ZcclxuICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmlkID09PSB0aGlzLm1vZGVsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhc0ZvdW5kSWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dExldmVsOiBBcnJheTxUcFJlZ2lvbnNlbGVjdE9wdGlvbj4gPSBpdGVtc1tpXS5uZXh0TGV2ZWw7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dExldmVsICYmIG5leHRMZXZlbC5sZW5ndGggJiYgbmV4dExldmVsWzBdLmlkID09PSBpdGVtc1tpXS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTcGVjaWFsWm9uZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NwZWNpYWxab25lICYmICFpdGVtc1tpXS5uZXh0TGV2ZWxbMF0ubmV4dExldmVsKSB7IC8vIOebtOi+luWOv1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW9uQXJyLnVuc2hpZnQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaXRlbXNbaV0uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtc1tpXS5sYWJlbFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpb25BcnIudW5zaGlmdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW1zW2ldLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtc1tpXS5sYWJlbFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXRlbXNbaV0ubmV4dExldmVsICYmIGl0ZW1zW2ldLm5leHRMZXZlbC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0U2VsZWN0ZWRPcHRpb24oaXRlbXNbaV0ubmV4dExldmVsKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0ZvdW5kSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvbkFyci51bnNoaWZ0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW1zW2ldLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogaXRlbXNbaV0ubGFiZWxcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYnRuQ2hhbmdlRm4oKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRCdG46IGFueSA9IHRoaXMuYnRuSXRlbXMuZmluZCgoaXRlbTogYW55KSA9PiBpdGVtLmlkID09PSB0aGlzLmJ0blNlbGVjdGVkLmlkKTtcclxuICAgICAgICB0aGlzLmNsYXNzaWZpY2F0aW9uTGV2ZWwgPSB0aGlzLmJ0bkl0ZW1zLmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtID09PSBzZWxlY3RlZEJ0bik7XHJcbiAgICAgICAgdGhpcy5pc05vdExhc3RPbmUgPSB0aGlzLmNsYXNzaWZpY2F0aW9uTGV2ZWwgPCB0aGlzLmJ0bkl0ZW1zLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVPcmlnaW5TdWdnZXN0aW9ucygpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlRHJvcGRvd25TdWdnZXN0aW9ucygpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsICYmIHRoaXMubW9kZWxbc2VsZWN0ZWRCdG4uaWRdKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSB0aGlzLm9wdGlvbnMuZmluZEluZGV4KChpdGVtOiBhbnkpID0+IGl0ZW0uaWQgPT09IHRoaXMubW9kZWxbc2VsZWN0ZWRCdG4uaWRdLmlkKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50bW9kZWwgPSB0aGlzLm9wdGlvbnNbaW5kZXhdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpbmRJbmRleCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZmluZEluZGV4KChpdGVtOiBhbnkpID0+IGl0ZW0uaWQgPT09IHRoaXMubW9kZWwuaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaGFuZGxlT3JpZ2luU3VnZ2VzdGlvbnMoKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGRyb3Bkb3duU3VnZ2VzdGlvbnM6IEFycmF5PGFueT4gPSB0aGlzLnJlZ2lvbnNlbGVjdE9wdGlvbjtcclxuICAgICAgICB0aGlzLm9yaWdpblN1Z2dlc3Rpb25zID0gW107XHJcbiAgICAgICAgdGhpcy5idG5JdGVtcy5mb3JFYWNoKChpdGVtOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID4gdGhpcy5jbGFzc2lmaWNhdGlvbkxldmVsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgY3VycmVudERhdGE6IGFueSA9IGRyb3Bkb3duU3VnZ2VzdGlvbnMuZmluZCgoZHJvcGRvd246IGFueSk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRyb3Bkb3duLmlkID09PSBpdGVtLm9yaWdpbklkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnREYXRhICYmIGN1cnJlbnREYXRhLm5leHRMZXZlbCAmJiBjdXJyZW50RGF0YS5uZXh0TGV2ZWwubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93blN1Z2dlc3Rpb25zID0gY3VycmVudERhdGEubmV4dExldmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKCFkcm9wZG93blN1Z2dlc3Rpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5qC55o2uaWTku47lsI/liLDlpKfov5vooYzmjpLluo9cclxuICAgICAgICBkcm9wZG93blN1Z2dlc3Rpb25zID0gZHJvcGRvd25TdWdnZXN0aW9ucy5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gYS5pZCAtIGIuaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZHJvcGRvd25TdWdnZXN0aW9ucy5mb3JFYWNoKChpdGVtMTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luU3VnZ2VzdGlvbnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBpZDogaXRlbTEuaWQsXHJcbiAgICAgICAgICAgICAgICBsYWJlbDogaXRlbTEubGFiZWwsXHJcbiAgICAgICAgICAgICAgICBuZXh0TGV2ZWw6IGl0ZW0xLm5leHRMZXZlbFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmoLnmja5vcmlnaW5JZOS7juWOn+Wni+aVsOaNruS4reesrOS4gOe6p+W+gOS4i+Wvu+aJvlxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VEcm9wZG93blN1Z2dlc3Rpb25zKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMub3JpZ2luU3VnZ2VzdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pu05pS56YCJ5oup5Yy65Z+f5pi+56S65paH5pysXHJcbiAgICBwcml2YXRlIGNoYW5nZVBsYWNlaG9sZGVyKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBzaG93VGV4dDogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgdGhpcy5idG5JdGVtcy5mb3JFYWNoKChpdGVtOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ubm9EYXRhRGlzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHQ6IHN0cmluZyA9IGl0ZW0uc2VsZWN0ZWRUZXh0ICsgJyAnO1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHNob3dUZXh0ICs9IHRleHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLXRlbXBsYXRlXHJcbiAgICAgICAgICAgICAgICBzaG93VGV4dCArPSB0aGlzLmNmUmVnaW9uU2VsZWN0U2VwYXJhdGl2ZVNpZ24gKyAnICcgKyB0ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zaG93VGV4dCA9IHNob3dUZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIpOaWreaMiemSrue7hGRpc2FibGXmnYPpmZBcclxuICAgIHByaXZhdGUgY2hhbmdlQnRuUmlnaHQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5idG5JdGVtcy5tYXAoKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBpdGVtLmRpc2FibGVkID0gKGluZGV4ID4gdGhpcy5jdXJyZW50Q2xhc3NpZmljYXRpb25zTGVuZ3RoKSB8fCBpdGVtLm5vRGF0YURpc2FibGU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Yik5pat5piv5ZCm5rqi5Ye65bm26I635Y+W6LaF5Ye65a695bqmXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRFeHRyYVdpZHRoKCk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3Qgd3JhcHBlcldpZHRoOiBudW1iZXIgPSB0aGlzLndyYXBwZXJFbGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICBjb25zdCBidXR0b25zV2lkdGg6IG51bWJlciA9IHRoaXMuYnV0dG9uZ3JvdXBFbGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICBjb25zdCBpc092ZXJmbG93OiBib29sZWFuID0gd3JhcHBlcldpZHRoID4gYnV0dG9uc1dpZHRoO1xyXG4gICAgICAgIGlmICghaXNPdmVyZmxvdykge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBleHRyYVdpZHRoOiBudW1iZXIgPSB3cmFwcGVyV2lkdGggLSBidXR0b25zV2lkdGg7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZXh0cmFXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19