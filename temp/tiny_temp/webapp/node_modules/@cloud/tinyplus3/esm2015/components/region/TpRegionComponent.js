import { Component, ContentChild, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { TiDominatorComponent, TiDropComponent, TiDroplistComponent, TiFormComponent, TiLocale } from '@cloud/tiny3';
/**
 * 区域选择组件
 *
 * 组件提供了[TpRegionUtil]{@link ../classes/TpRegionUtil.html}供某些业务处理数据。
 *
 * <example-url>../tinyplus3demo/#/region/region-all</example-url>
 */
// TODO：和Select有重复代码，未来设法消除。
export class TpRegionComponent extends TiFormComponent {
    constructor() {
        // TODO: add explicit constructor
        super(...arguments);
        /**
         * 选中事件，选中项没有变化
         */
        this.select = new EventEmitter();
        /**
         * @ignore
         * 灰化时默认提示文本
         */
        this.dafaultDisableReason = TiLocale.getLocaleWords().tpRegion.unSupport;
        /**
         * @ignore
         * 是否为ctc局点，面板结构类似于hws，选块较小
         */
        this.isSmallItem = TiLocale.getLocaleWords().tpRegionSmallItem;
        /**
         * @ignore
         * 是否为非hws非ctc局点，面板使用droplist，以select形式呈现
         */
        this.isUseDroplist = TiLocale.getLocaleWords().tpRegionSelectStyle;
    }
    // ngOnInit(): void {
    //     // TODO：兼容disable和disabled
    // }
    ngOnChanges(changes) {
        var _a, _b;
        if (((_b = (_a = changes['items']) === null || _a === void 0 ? void 0 : _a.currentValue) === null || _b === void 0 ? void 0 : _b.length) > 0 && this.model) {
            this.loopItemsFindSelectedItem();
        }
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        if (this.isUseDroplist) {
            this.setFocusableElems(this.TiDominatorCom.getFocusableElems());
        }
        else {
            this.setFocusableElems(this.TiDominatorCom.getFocusableElems()
                .concat(this.dropCom.nativeElement));
        }
    }
    /**
     * @ignore
     */
    ngOnModelChange() {
        var _a;
        if (this.model && ((_a = this.items) === null || _a === void 0 ? void 0 : _a.length) > 0) {
            this.loopItemsFindSelectedItem();
        }
        else {
            this.selectedItem = undefined;
        }
    }
    /**
     * @ignore
     */
    onMousedown(event) {
        if (this.disabled) {
            return;
        }
        this.togglePanel();
    }
    /**
     * @ignore
     */
    onClick(item, event) {
        if (item.disabled) {
            // 防止dominator 失焦blur
            event.preventDefault();
            return;
        }
        if (!this.model || this.model !== item) {
            this.model = item;
        }
        else {
            this.select.emit(item);
        }
        this.dropCom.hide();
    }
    /**
     * @ignore
     */
    onBlur() {
        this.dropCom && this.dropCom.hide();
        this.droplistCom && this.droplistCom.hide();
    }
    /**
     * @ignore
     * 记录下拉面板展开状态
     */
    get dropshow() {
        if (this.isUseDroplist) {
            return this.droplistCom ? this.droplistCom.isShow : false;
        }
        else {
            return this.dropCom ? this.dropCom.isShow : false;
        }
    }
    /**
     * 面板的打开或关闭，统一处理drop和droplist
     */
    togglePanel() {
        if (this.dropshow) {
            this.dropCom && this.dropCom.hide();
            this.droplistCom && this.droplistCom.hide();
        }
        else {
            this.dropCom && this.dropCom.show();
            this.droplistCom && this.droplistCom.show();
        }
    }
    loopItemsFindSelectedItem() {
        this.items.some((item) => {
            if (item.regions && this.findSelectedItem(item.regions, item)) {
                return true;
            }
            else if (item.special) {
                return this.findSelectedItem(item.special, item);
            }
            return false;
        });
    }
    findSelectedItem(data, item) {
        const flag = data.some((region) => {
            if (region === this.model) {
                this.selectedItem = item;
                return true;
            }
            return false;
        });
        return flag;
    }
}
TpRegionComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-region',
                template: "<ti-dominator [id]=\"appendId('region_dominator')\"\r\n    [placeholder]=\"placeholder\" [disabled]=\"disabled\" (mousedown)=\"onMousedown($event)\"\r\n    [dropshow]='dropshow'\r\n    [(ngModel)]='model'>\r\n\r\n    <ng-template #placeholder >\r\n        <ti-icon name=\"location\" class=\"tp-region-dominator-icon\"></ti-icon><span class=\"tp-region-placeholder\">{{placeholderText}}</span>\r\n    </ng-template>\r\n    <ng-template #item let-item>\r\n        <ti-icon name=\"location\" class=\"tp-region-dominator-icon\"></ti-icon><span [title]=\"isUseDroplist?item.name:item.displayName\">{{isUseDroplist?item.name:item.displayName}}</span>\r\n    </ng-template>\r\n</ti-dominator>\r\n\r\n<ti-drop\r\n    *ngIf=\"!isUseDroplist else droplist\"\r\n    class=\"tp-region-drop\"\r\n    [id]=\"appendId('drop')\"\r\n    panelWidth='auto'\r\n    [fixMaxHeight]=\"true\"\r\n    [dominatorElem]=\"TiDominatorCom.nativeElement\">\r\n    <ul class=\"tp-region-panel-container\" [id]=\"appendId('list')\" [attr.small-item]=\"isSmallItem\" >\r\n        <li *ngFor=\"let item of items;index as i\" class=\"tp-region-panel-list\">\r\n            <span class=\"tp-region-panel-title\" [title]=\"item.displayName\">{{item.displayName}}</span>\r\n            <ul class=\"tp-region-panel-ul\" [ngClass]=\"{'tp-region-panel-ul-border': selectedItem === item}\" [id]=\"appendId('child_list_' + i)\">\r\n                <li>\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate; context:{$implicit: item.regions, index: i, set: ''}\"></ng-container>\r\n                </li>\r\n                <li *ngIf=\"item.special\">\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate; context:{$implicit: item.special, index: i, set: 'special_'}\"></ng-container>\r\n                </li>\r\n            </ul>\r\n        </li>\r\n    </ul>\r\n</ti-drop>\r\n\r\n<ng-template #itemTemplate let-items let-index=index let-set=set>\r\n    <span *ngFor=\"let child of items; index as i\" class=\"tp-region-panel-item-wrapper\" >\r\n        <span class=\"tp-region-panel-item\"\r\n            [id]=\"appendId('region_item_' + index + '_' + set + i)\"\r\n            (mousedown)=\"onClick(child, $event)\"\r\n            [ngClass]=\"{'item-disabled': child.disabled,\r\n                        'item-selected': model === child }\"\r\n            [title]=\"child.displayName\"\r\n            [tiTip]=\"child.tipContent || (child.disabled?dafaultDisableReason:'')\"\r\n            [tiTipContext]=\"child\"\r\n            [tiTipPosition]=\"child.tipPosition ? child.tipPosition : ''\">{{child.displayName}}</span>\r\n        <section *ngIf=\"supTemplate else defaultTemplate\" class=\"item-sup\">\r\n            <ng-container *ngTemplateOutlet=\"supTemplate; context: {$implicit: child.sup, index: i}\"></ng-container>\r\n        </section>\r\n        <ng-template #defaultTemplate >\r\n            <span *ngIf=\"child.sup\" [ngClass]=\"[child.sup.class]\" class=\"item-sup\">{{child.sup.text}}</span>\r\n        </ng-template>\r\n    </span>\r\n</ng-template>\r\n\r\n<ng-template #droplist>\r\n    <ti-droplist\r\n        [(ngModel)]=\"model\"\r\n        [dominatorElem]=\"TiDominatorCom.nativeElement\"\r\n        [options]=\"items\" labelKey=\"name\"></ti-droplist>\r\n</ng-template>",
                providers: [TiFormComponent.getValueAccessor(TpRegionComponent)],
                host: {
                    '(blur)': 'onBlur()'
                },
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-component-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;display:inline-block}.tp-component-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-common-color-line-normal)}.tp-component-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-common-color-line-hover)}.tp-component-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-common-color-line-active)}.tp-component-container-border[disabled],:host[disabled]{background-color:var(--ti-common-color-bg-disabled);border-color:var(--ti-common-color-line-disabled);cursor:not-allowed!important}::ng-deep :root{--tp-region-dominator-width:200px;--tp-region-panel-item-height:28px;--tp-region-panel-item-sup-height:16px;--tp-region-panel-item-width:148px;--tp-region-panel-left-width:70px;--tp-region-panel-small-item-width:100px;--tp-region-panel-small-left-width:35px;--tp-region-panel-small-ul-width:642px;--tp-region-panel-small-width:699px;--tp-region-panel-ul-width:632px;--tp-region-panel-width:722px}:host{width:var(--tp-region-dominator-width)}:host .tp-region-dominator-icon{color:var(--ti-common-color-icon-normal);margin-right:var(--ti-common-space-base)}:host .tp-region-placeholder{color:var(--ti-input-placeholder-color)}:host[disabled] .tp-region-dominator-icon{color:var(--ti-common-color-icon-disabled)}.tp-region-drop:focus{outline:0}.tp-region-panel-container{-ms-box-sizing:border-box;box-sizing:border-box;padding:12px 10px;width:var(--tp-region-panel-width);z-index:1060}.tp-region-panel-container .tp-region-panel-list{*zoom:1}.tp-region-panel-container .tp-region-panel-list:after{clear:both;content:\"\";display:table}.tp-region-panel-container .tp-region-panel-list:before{content:\"\";display:table}.tp-region-panel-container .tp-region-panel-list:hover .tp-region-panel-ul{background-color:var(--ti-common-color-bg-gray)}.tp-region-panel-container .tp-region-panel-list:hover .tp-region-panel-title{color:var(--ti-common-color-text-highlight)}.tp-region-panel-container .tp-region-panel-ul{-ms-box-sizing:border-box;border-left:2px solid var(--ti-common-color-line-dividing);box-sizing:border-box;float:left;padding:0 calc(var(--ti-common-space-4x) - 4px) var(--ti-common-space-4x) var(--ti-common-space-4x);width:var(--tp-region-panel-ul-width)}.tp-region-panel-container .tp-region-panel-ul-border{border-color:var(--ti-common-color-line-active)}.tp-region-panel-container .tp-region-panel-title{-ms-box-sizing:border-box;box-sizing:border-box;float:left;line-height:var(--ti-common-line-height-number);margin-top:var(--ti-common-space-4x);overflow:hidden;padding-right:10px;text-overflow:ellipsis;white-space:nowrap;width:var(--tp-region-panel-left-width)}.tp-region-panel-container .tp-region-panel-item-wrapper{display:inline-block;margin:var(--ti-common-space-4x) 2px 0 0;position:relative}.tp-region-panel-container .tp-region-panel-item{background-color:var(--ti-common-color-bg-light-normal);border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;color:var(--ti-common-color-text-primary);cursor:pointer;display:inline-block;height:var(--tp-region-panel-item-height);line-height:var(--tp-region-panel-item-height);overflow:hidden;padding:0 var(--ti-common-space-5x);text-align:center;text-overflow:ellipsis;white-space:nowrap;width:var(--tp-region-panel-item-width)}.tp-region-panel-container .tp-region-panel-item:hover{background-color:var(--ti-common-color-bg-light-emphasize)}.tp-region-panel-container .tp-region-panel-item.item-selected{background-color:var(--ti-common-color-bg-emphasize);color:var(--ti-common-color-text-white)}.tp-region-panel-container .tp-region-panel-item.item-disabled{background-color:var(--ti-common-color-bg-disabled);color:var(--ti-common-color-text-disabled);cursor:not-allowed}.tp-region-panel-container[small-item=true]{width:var(--tp-region-panel-small-width)}.tp-region-panel-container[small-item=true] .tp-region-panel-ul{width:var(--tp-region-panel-small-ul-width)}.tp-region-panel-container[small-item=true] .tp-region-panel-title{width:var(--tp-region-panel-small-left-width)}.tp-region-panel-container[small-item=true] .tp-region-panel-item{width:var(--tp-region-panel-small-item-width)}.item-sup{font-size:16px;height:var(--tp-region-panel-item-sup-height);line-height:var(--tp-region-panel-item-sup-height);position:absolute;right:0;top:calc(var(--tp-region-panel-item-sup-height)*-1/2)}"]
            },] }
];
TpRegionComponent.propDecorators = {
    items: [{ type: Input }],
    placeholderText: [{ type: Input, args: ['placeholder',] }],
    select: [{ type: Output }],
    TiDominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, { static: false },] }],
    droplistCom: [{ type: ViewChild, args: [TiDroplistComponent, { static: false },] }],
    supTemplate: [{ type: ContentChild, args: ['sup', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBSZWdpb25Db21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueXBsdXMzL2NvbXBvbmVudHMvcmVnaW9uL1RwUmVnaW9uQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFpQixXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVILE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQW9Eckg7Ozs7OztHQU1HO0FBVUgsNEJBQTRCO0FBQzVCLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxlQUFlO0lBVnREO1FBV0UsaUNBQWlDOztRQWEvQjs7V0FFRztRQUNnQixXQUFNLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFzQnhFOzs7V0FHRztRQUNLLHlCQUFvQixHQUFXLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO1FBQ25GOzs7V0FHRztRQUNJLGdCQUFXLEdBQVksUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1FBQzFFOzs7V0FHRztRQUNJLGtCQUFhLEdBQVksUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLG1CQUFtQixDQUFDO0lBaUhsRixDQUFDO0lBNUdHLHFCQUFxQjtJQUNyQixpQ0FBaUM7SUFDakMsSUFBSTtJQUNKLFdBQVcsQ0FBQyxPQUFzQjs7UUFDOUIsSUFBSSxhQUFBLE9BQU8sQ0FBQyxPQUFPLENBQUMsMENBQUUsWUFBWSwwQ0FBRSxNQUFNLElBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDMUQsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7U0FDcEM7SUFD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QUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlEb21pbmF0b3JDb21wb25lbnQsIFRpRHJvcENvbXBvbmVudCwgVGlEcm9wbGlzdENvbXBvbmVudCwgVGlGb3JtQ29tcG9uZW50LCBUaUxvY2FsZSB9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRwUmVnaW9uSXRlbSB7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjeWkp+WMuueahOWQjeensOaWh+acrFxyXG4gICAgICovXHJcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlpKfljLrnmoTkuIDnu4TlnLDljLpcclxuICAgICAqL1xyXG4gICAgcmVnaW9ucz86IEFycmF5PFRwUmVnaW9uPjtcclxuICAgIC8qKlxyXG4gICAgICog5aSn5Yy655qE5Y+m5LiA57uE5Zyw5Yy677yM5Lqa5aSq5Yy65LiL5p+Q5Lqb6ZyA6KaB54m55q6K5aSE55CG55qE5Yy65Z+fXHJcbiAgICAgKi9cclxuICAgIHNwZWNpYWw/OiBBcnJheTxUcFJlZ2lvbj47XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUcFJlZ2lvbiB7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjeWMuuWfn+eahOWQjeensFxyXG4gICAgICovXHJcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nO1xyXG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xyXG4gICAgdGlwQ29udGVudD86IHN0cmluZztcclxuICAgIHRpcFBvc2l0aW9uPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDngbDljJbnmoTljp/lm6BcclxuICAgICAqL1xyXG4gICAgdGl0bGU/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rumAiemhueeahOagh+W/l+Wdl1xyXG4gICAgICpcclxuICAgICAqIOWvueixoeexu+Wei++8jOWMheWQq+S4pOS4quWxnuaApzoxLnRleHQ6IOaYvuekuueahOaWh+acrO+8mzIuY2xhc3M65qCH5b+X55qE5qC35byP77ybZWc6e3RleHQ6IHN0cmluZzsgY2xhc3M6IHN0cmluZ31cclxuICAgICAqL1xyXG4gICAgc3VwPzoge1xyXG4gICAgICAgIHRleHQ/OiBzdHJpbmc7XHJcbiAgICAgICAgY2xhc3M/OiBzdHJpbmc7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5YWB6K645pyJ5aSa5L2Z55qE5bGe5oCn5a2X5q61XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhYHorrjmnInlpJrkvZnnmoTlsZ7mgKflrZfmrrVcclxuICAgICAqL1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDljLrln5/pgInmi6nnu4Tku7ZcclxuICpcclxuICog57uE5Lu25o+Q5L6b5LqGW1RwUmVnaW9uVXRpbF17QGxpbmsgLi4vY2xhc3Nlcy9UcFJlZ2lvblV0aWwuaHRtbH3kvpvmn5DkupvkuJrliqHlpITnkIbmlbDmja7jgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy9yZWdpb24vcmVnaW9uLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndHAtcmVnaW9uJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9yZWdpb24uaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9yZWdpb24ubGVzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbVGlGb3JtQ29tcG9uZW50LmdldFZhbHVlQWNjZXNzb3IoVHBSZWdpb25Db21wb25lbnQpXSxcclxuICAgIGhvc3Q6IHtcclxuICAgICAgICAnKGJsdXIpJzogJ29uQmx1cigpJ1xyXG4gICAgfVxyXG59KVxyXG4vLyBUT0RP77ya5ZKMU2VsZWN05pyJ6YeN5aSN5Luj56CB77yM5pyq5p2l6K6+5rOV5raI6Zmk44CCXHJcbmV4cG9ydCBjbGFzcyBUcFJlZ2lvbkNvbXBvbmVudCBleHRlbmRzIFRpRm9ybUNvbXBvbmVudCB7XHJcbiAgLy8gVE9ETzogYWRkIGV4cGxpY2l0IGNvbnN0cnVjdG9yXHJcblxyXG4gIC8vIFRPRE86IGFkZCBleHBsaWNpdCBjb25zdHJ1Y3RvclxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5LiL5ouJ6Z2i5p2/5bGV56S655qE5pWw5o2u5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGl0ZW1zOiBBcnJheTxUcFJlZ2lvbkl0ZW0+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDpooTnlZnmlofmnKxcclxuICAgICAqL1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1pbnB1dC1yZW5hbWVcclxuICAgIEBJbnB1dCgncGxhY2Vob2xkZXInKSBwbGFjZWhvbGRlclRleHQ6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6YCJ5Lit5LqL5Lu277yM6YCJ5Lit6aG55rKh5pyJ5Y+Y5YyWXHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBzZWxlY3Q6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvKipcclxuICAgICAqIOmAieS4reS6i+S7tu+8jOmAieS4remhueWPmOWMllxyXG4gICAgICovXHJcbiAgICAvLyBAT3V0cHV0KCkgcmVhZG9ubHkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoVGlEb21pbmF0b3JDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIFRpRG9taW5hdG9yQ29tOiBUaURvbWluYXRvckNvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKFRpRHJvcENvbXBvbmVudCwge3N0YXRpYzogZmFsc2V9KSBkcm9wQ29tOiBUaURyb3BDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURyb3BsaXN0Q29tcG9uZW50LCB7c3RhdGljOiBmYWxzZX0pIGRyb3BsaXN0Q29tOiBUaURyb3BsaXN0Q29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDojrflj5bliLDnlKjmiLfoh6rlrprkuYnnmoTmjInpkq7moIflv5fmqKHmnb9cclxuICAgICAqL1xyXG4gICAgQENvbnRlbnRDaGlsZCgnc3VwJywgeyBzdGF0aWM6IHRydWUgfSkgcHVibGljIHN1cFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAvKipcclxuICAgICogQGlnbm9yZVxyXG4gICAgKiDngbDljJbml7bpu5jorqTmj5DnpLrmlofmnKxcclxuICAgICovXHJcbiAgICBwdWJsaWMgZGFmYXVsdERpc2FibGVSZWFzb246IHN0cmluZyA9IFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudHBSZWdpb24udW5TdXBwb3J0O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmmK/lkKbkuLpjdGPlsYDngrnvvIzpnaLmnb/nu5PmnoTnsbvkvLzkuo5od3PvvIzpgInlnZfovoPlsI9cclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzU21hbGxJdGVtOiBib29sZWFuID0gVGlMb2NhbGUuZ2V0TG9jYWxlV29yZHMoKS50cFJlZ2lvblNtYWxsSXRlbTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5piv5ZCm5Li66Z2eaHdz6Z2eY3Rj5bGA54K577yM6Z2i5p2/5L2/55SoZHJvcGxpc3TvvIzku6VzZWxlY3TlvaLlvI/lkYjnjrBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzVXNlRHJvcGxpc3Q6IGJvb2xlYW4gPSBUaUxvY2FsZS5nZXRMb2NhbGVXb3JkcygpLnRwUmVnaW9uU2VsZWN0U3R5bGU7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlbGVjdGVkSXRlbTogVHBSZWdpb25JdGVtO1xyXG4gICAgLy8gbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAvLyAgICAgLy8gVE9ET++8muWFvOWuuWRpc2FibGXlkoxkaXNhYmxlZFxyXG4gICAgLy8gfVxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzWydpdGVtcyddPy5jdXJyZW50VmFsdWU/Lmxlbmd0aCA+IDAgJiYgdGhpcy5tb2RlbCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb3BJdGVtc0ZpbmRTZWxlY3RlZEl0ZW0oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNVc2VEcm9wbGlzdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKHRoaXMuVGlEb21pbmF0b3JDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyh0aGlzLlRpRG9taW5hdG9yQ29tLmdldEZvY3VzYWJsZUVsZW1zKClcclxuICAgICAgICAgICAgLmNvbmNhdCh0aGlzLmRyb3BDb20ubmF0aXZlRWxlbWVudCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBuZ09uTW9kZWxDaGFuZ2UoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwgJiYgdGhpcy5pdGVtcz8ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb3BJdGVtc0ZpbmRTZWxlY3RlZEl0ZW0oKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uTW91c2Vkb3duKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRvZ2dsZVBhbmVsKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2soaXRlbTogYW55LCBldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xyXG4gICAgICAgIGlmIChpdGVtLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIC8vIOmYsuatomRvbWluYXRvciDlpLHnhKZibHVyXHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5tb2RlbCB8fCB0aGlzLm1vZGVsICE9PSBpdGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSBpdGVtO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LmVtaXQoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZHJvcENvbS5oaWRlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQmx1cigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRyb3BDb20gJiYgdGhpcy5kcm9wQ29tLmhpZGUoKTtcclxuICAgICAgICB0aGlzLmRyb3BsaXN0Q29tICYmIHRoaXMuZHJvcGxpc3RDb20uaGlkZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDorrDlvZXkuIvmi4npnaLmnb/lsZXlvIDnirbmgIFcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCBkcm9wc2hvdygpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5pc1VzZURyb3BsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyb3BsaXN0Q29tID8gdGhpcy5kcm9wbGlzdENvbS5pc1Nob3cgOiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gIHRoaXMuZHJvcENvbSA/IHRoaXMuZHJvcENvbS5pc1Nob3cgOiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmdouadv+eahOaJk+W8gOaIluWFs+mXre+8jOe7n+S4gOWkhOeQhmRyb3Dlkoxkcm9wbGlzdFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHRvZ2dsZVBhbmVsKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmRyb3BzaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcENvbSAmJiB0aGlzLmRyb3BDb20uaGlkZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmRyb3BsaXN0Q29tICYmIHRoaXMuZHJvcGxpc3RDb20uaGlkZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcENvbSAmJiB0aGlzLmRyb3BDb20uc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLmRyb3BsaXN0Q29tICYmIHRoaXMuZHJvcGxpc3RDb20uc2hvdygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgbG9vcEl0ZW1zRmluZFNlbGVjdGVkSXRlbSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLml0ZW1zLnNvbWUoKGl0ZW06IFRwUmVnaW9uSXRlbSk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5yZWdpb25zICYmIHRoaXMuZmluZFNlbGVjdGVkSXRlbShpdGVtLnJlZ2lvbnMsIGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnNwZWNpYWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmRTZWxlY3RlZEl0ZW0oaXRlbS5zcGVjaWFsLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZmluZFNlbGVjdGVkSXRlbShkYXRhOiBBcnJheTxUcFJlZ2lvbj4sIGl0ZW06IFRwUmVnaW9uSXRlbSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGZsYWc6IGJvb2xlYW4gPSAgZGF0YS5zb21lKChyZWdpb246IFRwUmVnaW9uKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZWdpb24gPT09IHRoaXMubW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gaXRlbTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxhZztcclxuICAgIH1cclxufVxyXG4iXX0=