import { Component, ContentChildren, ElementRef, EventEmitter, Input, NgZone, Output, QueryList, Renderer2, ViewChild } from '@angular/core';
import { TiBaseComponent } from '@cloud/tiny3';
import { TpSwipercardComponent } from './TpSwipercardComponent';
/**
 * swiper组件每个展示块为一个card，点击左右按钮可以实现card切换功能
 *
 * <example-url>../tinyplus3demo/#/swiper/swiper-all</example-url>
 */
export class TpSwiperComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, zone) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.zone = zone;
        /**
         * 指定当前激活项
         */
        this.activeIndex = 0;
        /**
         * 10.0.2新增
         *
         * 是否自动播放
         */
        this.autoplay = false;
        /**
         * 10.0.2新增
         *
         * 自动播放时，默认的播放（翻页）速度
         */
        this.autoplaySpeed = 3000;
        /**
         * 10.1.2新增
         *
         * 每页展示卡片数量
         */
        this.showCardNum = 1;
        /**
         * 10.1.2新增
         *
         * 多图轮播卡片间距，8-12px，默认为8px（规范建议使用偶数值，即8px，10px，12px）
         */
        this.cardGap = '8px';
        /**
         * 10.1.2新增
         *
         * 指示器位置，三个属性值，‘below’容器外部，‘bottom’容器内部底部，‘none’不显示
         */
        this.indicatorPosition = 'below';
        /**
         * 10.1.2新增
         *
         * 是否无限循环
         */
        this.loop = true;
        /**
         * 当前卡片切换触发的事件
         */
        this.activeIndexChange = new EventEmitter();
        /**
        /**
         * @ignore
         * 卡片总页数
         */
        this.totalPage = 0;
        /**
         * @ignore
         * 当前页， 按照索引值从0开始
         */
        this.currentPage = 0;
        /**
         * @ignore
         * 面板指示点的集合
         */
        this.swiperBullets = [];
        // 卡片切换动画间隔，单位ms
        this.transitionSpeed = 600;
        // 卡片总数量
        this.cardNum = 0;
    }
    ngOnInit() {
        super.ngOnInit();
        // 一屏显示卡片的数目会随窗口大小而变化，所以监听窗口大小变化重新计算分页，
        this.zone.runOutsideAngular(() => {
            this.unlistenResize = this.renderer2.listen(window, 'resize', () => {
                this.setCardsWidth();
                this.setLeftPosition(this.currentPage);
            });
        });
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentChecked() {
        super.ngAfterContentChecked();
        // 当卡片数量变化时，计算总数量
        if (this.cards.nativeElement.children.length !== this.cardNum) {
            this.setCardNum();
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewInit() {
        this.setCardsWidth();
        this.setLeftPosition(this.currentPage);
        this.renderer.setStyle(this.cards.nativeElement, 'transition', `left ${this.transitionSpeed}ms`);
        // 只有一页时，不自动轮播
        if (this.autoplay && this.autoplaySpeed && this.totalPage > 1) {
            this.autoplayId = setInterval(() => {
                this.onClickNext();
            }, this.autoplaySpeed);
        }
    }
    ngAfterViewChecked() {
        // 外层容器宽度有变化时，重新计算宽度及位置
        if (this.wrapperEle && this.wrapperEle.nativeElement.getBoundingClientRect().width !== this.pageWidth) {
            this.setCardsWidth();
            this.setLeftPosition(this.currentPage);
        }
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        const indexObj = changes['activeIndex'];
        if (indexObj && !indexObj.firstChange) {
            this.calculateCurrentPage(indexObj.currentValue);
            this.setLeftPosition(this.currentPage);
        }
    }
    ngOnDestroy() {
        if (this.autoplayId) {
            clearInterval(this.autoplayId);
            this.autoplayId = undefined;
        }
        if (this.unlistenResize) {
            this.unlistenResize();
        }
    }
    /**
     * @ignore
     * 点击左侧按钮触发事件
     */
    onClickPrev() {
        this.activeCard(this.currentPage - 1);
    }
    /**
     * @ignore
     * 点击右侧按钮触发事件
     */
    onClickNext() {
        this.activeCard(this.currentPage + 1);
    }
    /**
     * @ignore
     * 点击指示器触发事件
     */
    onClickDot(index) {
        this.activeCard(index);
    }
    /**
     * @ignore
     * 点击左右侧按钮、面板指示板触发事件
     */
    activeCard(index) {
        if (this.totalPage === 1) {
            return;
        }
        this.renderer.setStyle(this.cards.nativeElement, 'transition', `left ${this.transitionSpeed}ms`);
        if (index === this.totalPage && this.loop) {
            this.currentPage = 0;
            const first = this.swipercardComs.first.nativeElement;
            this.setPosition(first, true);
            this.setLeftPosition(this.totalPage);
            this.adjustPosition(first);
        }
        else if (index === -1 && this.loop) {
            this.currentPage = this.totalPage - 1;
            const last = this.swipercardComs.last.nativeElement;
            this.setPosition(last, false);
            this.setLeftPosition(-1);
            this.adjustPosition(last);
        }
        else {
            this.currentPage = index <= -1 ? 0 : index >= this.totalPage ? this.totalPage - 1 : index;
            this.setLeftPosition(this.currentPage);
            this.activeIndexChange.emit(this.currentPage);
        }
    }
    // 计算卡片总数及总页数
    setCardNum() {
        this.cardNum = this.cards && this.cards.nativeElement.children && this.cards.nativeElement.children.length;
        this.calculatpaging();
        this.swiperBullets.length = this.totalPage;
    }
    // 计算卡片容器总宽度
    setCardsWidth() {
        this.calculatecardWidth();
        this.renderer.setStyle(this.cards.nativeElement, 'width', `${this.totalWidth}px`);
    }
    // 当点击左右按钮时，设置激活卡片相对位置
    setLeftPosition(index) {
        if (this.totalPage === 1) {
            return;
        }
        // 最后一页未占完
        if (index === this.totalPage - 1 && this.cardNum % this.showCardNum !== 0) {
            const swiperCardNum = this.cardNum - this.showCardNum;
            this.renderer.setStyle(this.cards.nativeElement, 'left', `${-(swiperCardNum) * this.swiperCardWidth - (swiperCardNum - 1) * this.cardSpace}px`);
            this.renderer2.setStyle(this.swipercardComs.toArray()[swiperCardNum].nativeElement, 'margin-right', this.cardGap);
            return;
        }
        // 无限循环
        if (index === this.totalPage && this.loop) {
            this.renderer.setStyle(this.cards.nativeElement, 'left', `${-(this.totalWidth)}px`);
            return;
        }
        if (index === -1 && this.loop) {
            this.renderer.setStyle(this.cards.nativeElement, 'left', `${this.swiperCardWidth * this.showCardNum + (this.showCardNum - 1) * this.cardSpace}px`);
            return;
        }
        this.renderer.setStyle(this.cards.nativeElement, 'left', `${-index * 100}%`);
    }
    // 调整第一页或者最后一页的位置，为动画做准备
    setPosition(targetEle, lastToFirst) {
        this.renderer.setStyle(targetEle, 'transform', `translateX(${lastToFirst ? this.totalWidth : this.totalWidth * -1}px)`);
    }
    adjustPosition(targetEle) {
        setTimeout(() => {
            this.renderer.removeStyle(targetEle, 'transform');
            this.renderer.removeStyle(this.cards.nativeElement, 'transition');
            this.setLeftPosition(this.currentPage);
            this.activeIndexChange.emit(this.currentPage);
        }, this.transitionSpeed);
    }
    // 计算每页显示卡片数，总页数及当前页
    calculatpaging() {
        this.calculateTotalPage();
        this.calculateCurrentPage(this.activeIndex);
    }
    /**
     * 计算卡片宽度
     */
    calculatecardWidth() {
        // 初始化时，多图且左右翻页按钮还没有显示，容器元素的可用宽度需要减去左右按钮的宽度之和32+32=64
        if (this.totalPage === 0 && this.showCardNum > 1) {
            this.pageWidth = this.wrapperEle.nativeElement.getBoundingClientRect().width - 64;
        }
        else {
            this.pageWidth = this.wrapperEle.nativeElement.getBoundingClientRect().width;
        }
        // 每页卡片总间距
        this.cardSpace = this.showCardNum > 1 ? parseInt(this.cardGap, 10) : 0;
        const cardsSpace = (this.showCardNum - 1) * parseInt(this.cardGap, 10);
        this.swiperCardWidth = (this.pageWidth - cardsSpace) / this.showCardNum;
        this.totalWidth = this.swiperCardWidth * this.cardNum + cardsSpace * this.totalPage;
        this.swipercardComs.toArray().forEach((item, index) => {
            // 设置卡片宽度
            this.renderer2.setStyle(item.nativeElement, 'width', this.swiperCardWidth + 'px');
            // 设置卡片间距，每页最后一个卡片不设置
            if ((index + 1) % this.showCardNum !== 0 && index !== this.cardNum - 1) {
                this.renderer2.setStyle(item.nativeElement, 'margin-right', this.cardSpace + 'px');
            }
        });
    }
    /**
     * 计算总页数
     */
    calculateTotalPage() {
        this.totalPage = Math.ceil(this.cardNum / this.showCardNum);
        if (this.currentPage > this.totalPage) {
            this.activeCard(this.totalPage);
        }
    }
    /**
     *  计算当前页
     */
    calculateCurrentPage(index) {
        // 当前索引值不正确，不处理
        if (index < 0 || index > (this.cardNum - 1)) {
            return;
        }
        if (this.showCardNum === 1) {
            this.currentPage = index;
            return;
        }
        // 当前一页卡片的最大最小索引
        const maxIndex = (this.currentPage + 1) * this.showCardNum - 1;
        const minIndex = this.currentPage > 0 ? (this.currentPage * this.showCardNum - 1) : 0;
        // 当前索卡片是否在当前页面
        if (index < minIndex || index > maxIndex) {
            this.currentPage = Math.floor((index + 1) / this.showCardNum);
        }
    }
}
TpSwiperComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-swiper',
                template: "<div class=\"tp-swiper-container\">\r\n    <!-- \u5DE6\u4FA7\u6309\u94AE -->\r\n    <div *ngIf=\"totalPage > 1\"\r\n        tiOutline\r\n        class=\"tp-swiper-arrow tp-swiper-prev\"\r\n        [ngClass]=\"{'tp-swiper-finite-arrow': !loop && currentPage <= 0}\"\r\n        tabindex=\"0\"\r\n        (keydown.enter)=\"onClickPrev()\"\r\n        (click)=\"onClickPrev()\"\r\n        [id]=\"appendId('prev')\">\r\n        <ti-icon name=\"angle-left\"></ti-icon>\r\n    </div>\r\n\r\n    <!-- \u5361\u7247\u5BB9\u5668 -->\r\n    <div class=\"tp-swiper-wrapper\" #wrapper>\r\n        <div class=\"tp-swiper-cards-container\" #cards>\r\n            <ng-content></ng-content>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- \u53F3\u4FA7\u6309\u94AE -->\r\n    <div *ngIf=\"totalPage > 1\"\r\n        tiOutline\r\n        class=\"tp-swiper-next tp-swiper-arrow\"\r\n        [ngClass]=\"{'tp-swiper-finite-arrow': !loop && currentPage >= totalPage - 1}\"\r\n        tabindex=\"0\"\r\n        (keydown.enter)=\"onClickNext()\"\r\n        (click)=\"onClickNext()\"\r\n        [id]=\"appendId('next')\">\r\n        <ti-icon name=\"angle-right\"></ti-icon>\r\n    </div>\r\n</div>\r\n\r\n<!-- \u9762\u677F\u6307\u793A\u70B9 -->\r\n<ul *ngIf=\"totalPage > 1 && indicatorPosition!=='none'\"\r\n    class=\"tp-swiper-pagination-bullets\" [id]=\"appendId('list')\"\r\n    [ngClass]=\"{'tp-swiper-pagination-bullets-bottom': indicatorPosition==='bottom'}\">\r\n    <li *ngFor=\"let item of swiperBullets index as i\"\r\n        class=\"tp-swiper-pagination-bullet\"\r\n        [ngClass]=\"{'tp-swiper-pagination-bullet-active': i === currentPage}\"\r\n        (click)=\"onClickDot(i)\"></li>\r\n</ul>",
                host: {
                    '[class.tp-swiper-multiple]': 'showCardNum > 1'
                },
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}::ng-deep :root{--tp-swiper-bullet-border:2.5px;--tp-swiper-icon-height:calc(var(--tp-swiper-icon-width)*2);--tp-swiper-icon-width:24px;--tp-swiper-multiple-icon-width:16px;--tp-swiper-pagination-bullets-space:28px}:host{display:block;position:relative}.tp-swiper-container{-moz-align-items:center;-moz-flex-direction:row;-moz-justify-content:center;-ms-align-items:center;-ms-justify-content:center;flex-direction:row;position:relative}.tp-swiper-arrow,.tp-swiper-container{align-items:center;display:flex;justify-content:center}.tp-swiper-arrow{background:rgba(0,0,0,.2);border-radius:var(--ti-common-border-radius-normal);color:var(--ti-common-color-icon-white);cursor:pointer;flex-shrink:0;font-size:16px;height:var(--tp-swiper-icon-height);position:absolute;text-align:center;top:calc((100% - var(--tp-swiper-icon-height))/2);width:var(--tp-swiper-icon-width);z-index:1}.tp-swiper-arrow:not(.tp-swiper-finite-arrow):hover{background:rgba(0,0,0,.3)}.tp-swiper-finite-arrow{cursor:not-allowed}.tp-swiper-finite-arrow ti-icon{color:var(--ti-common-color-icon-disabled)}.tp-swiper-prev{left:0}.tp-swiper-next{right:0}:host.tp-swiper-multiple .tp-swiper-wrapper{margin:0 var(--ti-common-space-10)}:host.tp-swiper-multiple .tp-swiper-arrow{background:transparent;color:var(--ti-common-color-icon-normal);position:static}:host.tp-swiper-multiple .tp-swiper-arrow:not(.tp-swiper-finite-arrow):hover{color:var(--ti-common-color-icon-hover)}.tp-swiper-wrapper{overflow-x:hidden;position:relative;width:100%}.tp-swiper-wrapper .tp-swiper-cards-container{display:flex;position:relative}.tp-swiper-pagination-bullets{margin-top:var(--tp-swiper-pagination-bullets-space);text-align:center}.tp-swiper-pagination-bullets .tp-swiper-pagination-bullet{-ms-box-sizing:border-box;background-color:var(--ti-common-color-line-normal);border:var(--tp-swiper-bullet-border) solid var(--ti-common-color-line-normal);border-radius:var(--tp-swiper-bullet-border);box-sizing:border-box;cursor:pointer;display:inline-block;margin:0 0 0 var(--ti-common-space-6)}.tp-swiper-pagination-bullets .tp-swiper-pagination-bullet:first-child{margin:0}.tp-swiper-pagination-bullets .tp-swiper-pagination-bullet.tp-swiper-pagination-bullet-active{background-color:var(--ti-common-color-line-hover);border-color:var(--ti-common-color-line-hover);width:20px}.tp-swiper-pagination-bullets-bottom{bottom:var(--tp-swiper-pagination-bullets-space);margin-top:0;position:absolute;width:100%}.tp-swiper-pagination-bullets-right{margin-top:0;position:absolute;right:var(--tp-swiper-pagination-bullets-space);top:50%;transform:translateY(-50%);width:5px}.tp-swiper-pagination-bullets-right .tp-swiper-pagination-bullet{margin:0 0 var(--ti-common-space-6) 0}.tp-swiper-pagination-bullets-right .tp-swiper-pagination-bullet.tp-swiper-pagination-bullet-active{background-color:var(--ti-common-color-line-hover);border-color:var(--ti-common-color-line-hover);height:20px;width:5px}"]
            },] }
];
TpSwiperComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone }
];
TpSwiperComponent.propDecorators = {
    activeIndex: [{ type: Input }],
    autoplay: [{ type: Input }],
    autoplaySpeed: [{ type: Input }],
    showCardNum: [{ type: Input }],
    cardGap: [{ type: Input }],
    indicatorPosition: [{ type: Input }],
    loop: [{ type: Input }],
    activeIndexChange: [{ type: Output }],
    cards: [{ type: ViewChild, args: ['cards', { static: true },] }],
    swipercardComs: [{ type: ContentChildren, args: [TpSwipercardComponent,] }],
    wrapperEle: [{ type: ViewChild, args: ['wrapper', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBTd2lwZXJDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueXBsdXMzL2NvbXBvbmVudHMvc3dpcGVyL1RwU3dpcGVyQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBK0IsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFLLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFL0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFaEU7Ozs7R0FJRztBQVVILE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxlQUFlO0lBQ2xELFlBQW9CLFVBQXNCLEVBQVUsU0FBb0IsRUFBVSxJQUFZO1FBQzFGLEtBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFEYixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUFVLFNBQUksR0FBSixJQUFJLENBQVE7UUFHOUY7O1dBRUc7UUFDTSxnQkFBVyxHQUFXLENBQUMsQ0FBQztRQUNqQzs7OztXQUlHO1FBQ00sYUFBUSxHQUFZLEtBQUssQ0FBQztRQUNuQzs7OztXQUlHO1FBQ00sa0JBQWEsR0FBVyxJQUFJLENBQUM7UUFDdEM7Ozs7V0FJRztRQUNNLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBQ2pDOzs7O1dBSUc7UUFDTSxZQUFPLEdBQVcsS0FBSyxDQUFDO1FBQ2pDOzs7O1dBSUc7UUFDTSxzQkFBaUIsR0FBZ0MsT0FBTyxDQUFDO1FBQ2xFOzs7O1dBSUc7UUFDTSxTQUFJLEdBQVksSUFBSSxDQUFDO1FBQzlCOztXQUVHO1FBQ2dCLHNCQUFpQixHQUFzQixJQUFJ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QyxXQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLE9BQU87U0FDVjtRQUVELGdCQUFnQjtRQUNoQixNQUFNLFFBQVEsR0FBVyxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFDdkUsTUFBTSxRQUFRLEdBQVcsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUYsZUFBZTtRQUNmLElBQUksS0FBSyxHQUFHLFFBQVEsSUFBSSxLQUFLLEdBQUcsUUFBUSxFQUFFO1lBQ3RDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDakU7SUFDTCxDQUFDOzs7WUExVUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxXQUFXO2dCQUNyQixpcURBQTRCO2dCQUU1QixJQUFJLEVBQUU7b0JBQ0YsNEJBQTRCLEVBQUUsaUJBQWlCO2lCQUNsRDs7YUFDSjs7O1lBakJvQyxVQUFVO1lBQWtELFNBQVM7WUFBcEMsTUFBTTs7OzBCQTBCdkUsS0FBSzt1QkFNTCxLQUFLOzRCQU1MLEtBQUs7MEJBTUwsS0FBSztzQkFNTCxLQUFLO2dDQU1MLEtBQUs7bUJBTUwsS0FBSztnQ0FJTCxNQUFNO29CQUlOLFNBQVMsU0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzZCQUluQyxlQUFlLFNBQUMscUJBQXFCO3lCQUlyQyxTQUFTLFNBQUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBOZ1pvbmUsIE91dHB1dCwgUXVlcnlMaXN0LCBSZW5kZXJlcjIsIFNpbXBsZUNoYW5nZSwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRpQmFzZUNvbXBvbmVudCB9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcblxyXG5pbXBvcnQgeyBUcFN3aXBlcmNhcmRDb21wb25lbnQgfSBmcm9tICcuL1RwU3dpcGVyY2FyZENvbXBvbmVudCc7XHJcblxyXG4vKipcclxuICogc3dpcGVy57uE5Lu25q+P5Liq5bGV56S65Z2X5Li65LiA5LiqY2FyZO+8jOeCueWHu+W3puWPs+aMiemSruWPr+S7peWunueOsGNhcmTliIfmjaLlip/og71cclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnlwbHVzM2RlbW8vIy9zd2lwZXIvc3dpcGVyLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndHAtc3dpcGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zd2lwZXIuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zd2lwZXIubGVzcyddLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICdbY2xhc3MudHAtc3dpcGVyLW11bHRpcGxlXSc6ICdzaG93Q2FyZE51bSA+IDEnXHJcbiAgICB9XHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgVHBTd2lwZXJDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyMjogUmVuZGVyZXIyLCBwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xyXG4gICAgICAgIHN1cGVyKGVsZW1lbnRSZWYsIHJlbmRlcmVyMik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaMh+WumuW9k+WJjea/gOa0u+mhuVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBhY3RpdmVJbmRleDogbnVtYmVyID0gMDtcclxuICAgIC8qKlxyXG4gICAgICogMTAuMC4y5paw5aKeXHJcbiAgICAgKlxyXG4gICAgICog5piv5ZCm6Ieq5Yqo5pKt5pS+XHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGF1dG9wbGF5OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjAuMuaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOiHquWKqOaSreaUvuaXtu+8jOm7mOiupOeahOaSreaUvu+8iOe/u+mhte+8iemAn+W6plxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBhdXRvcGxheVNwZWVkOiBudW1iZXIgPSAzMDAwO1xyXG4gICAgLyoqXHJcbiAgICAgKiAxMC4xLjLmlrDlop5cclxuICAgICAqXHJcbiAgICAgKiDmr4/pobXlsZXnpLrljaHniYfmlbDph49cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgc2hvd0NhcmROdW06IG51bWJlciA9IDE7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjEuMuaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOWkmuWbvui9ruaSreWNoeeJh+mXtOi3ne+8jDgtMTJweO+8jOm7mOiupOS4ujhweO+8iOinhOiMg+W7uuiuruS9v+eUqOWBtuaVsOWAvO+8jOWNszhweO+8jDEwcHjvvIwxMnB477yJXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNhcmRHYXA6IHN0cmluZyA9ICc4cHgnO1xyXG4gICAgLyoqXHJcbiAgICAgKiAxMC4xLjLmlrDlop5cclxuICAgICAqXHJcbiAgICAgKiDmjIfnpLrlmajkvY3nva7vvIzkuInkuKrlsZ7mgKflgLzvvIzigJhiZWxvd+KAmeWuueWZqOWklumDqO+8jOKAmGJvdHRvbeKAmeWuueWZqOWGhemDqOW6lemDqO+8jOKAmG5vbmXigJnkuI3mmL7npLpcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaW5kaWNhdG9yUG9zaXRpb246ICdib3R0b20nIHwgJ2JlbG93JyB8ICdub25lJyA9ICdiZWxvdyc7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjEuMuaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOaYr+WQpuaXoOmZkOW+queOr1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBsb29wOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN5Y2h54mH5YiH5o2i6Kem5Y+R55qE5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBhY3RpdmVJbmRleENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCdjYXJkcycsIHsgc3RhdGljOiB0cnVlIH0pIGNhcmRzOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBDb250ZW50Q2hpbGRyZW4oVHBTd2lwZXJjYXJkQ29tcG9uZW50KSBzd2lwZXJjYXJkQ29tczogUXVlcnlMaXN0PFRwU3dpcGVyY2FyZENvbXBvbmVudD47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnd3JhcHBlcicsIHsgc3RhdGljOiB0cnVlIH0pIHdyYXBwZXJFbGU6IEVsZW1lbnRSZWY7XHJcbiAgICAvKipcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Y2h54mH5oC76aG15pWwXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0b3RhbFBhZ2U6IG51bWJlciA9IDA7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOW9k+WJjemhte+8jCDmjInnhafntKLlvJXlgLzku44w5byA5aeLXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjdXJyZW50UGFnZTogbnVtYmVyID0gMDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6Z2i5p2/5oyH56S654K555qE6ZuG5ZCIXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzd2lwZXJCdWxsZXRzOiBBcnJheTxhbnk+ID0gW107XHJcbiAgICAvLyDljaHniYfliIfmjaLliqjnlLvpl7TpmpTvvIzljZXkvY1tc1xyXG4gICAgcHJpdmF0ZSB0cmFuc2l0aW9uU3BlZWQ6IG51bWJlciA9IDYwMDtcclxuICAgIC8vIOWumuaXtuWZqOS7u+WKoVxyXG4gICAgcHJpdmF0ZSBhdXRvcGxheUlkOiBhbnk7XHJcbiAgICAvLyDljaHniYfmgLvmlbDph49cclxuICAgIHByaXZhdGUgY2FyZE51bTogbnVtYmVyID0gMDtcclxuICAgIHByaXZhdGUgcGFnZVdpZHRoOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHN3aXBlckNhcmRXaWR0aDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBjYXJkU3BhY2U6IG51bWJlcjtcclxuICAgIHByaXZhdGUgdG90YWxXaWR0aDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSB1bmxpc3RlblJlc2l6ZTogKCkgPT4gdm9pZDtcclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIC8vIOS4gOWxj+aYvuekuuWNoeeJh+eahOaVsOebruS8mumaj+eql+WPo+Wkp+Wwj+iAjOWPmOWMlu+8jOaJgOS7peebkeWQrOeql+WPo+Wkp+Wwj+WPmOWMlumHjeaWsOiuoeeul+WIhumhte+8jFxyXG4gICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudW5saXN0ZW5SZXNpemUgPSB0aGlzLnJlbmRlcmVyMi5saXN0ZW4od2luZG93LCAncmVzaXplJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDYXJkc1dpZHRoKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbih0aGlzLmN1cnJlbnRQYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ0FmdGVyQ29udGVudENoZWNrZWQoKTtcclxuICAgICAgICAvLyDlvZPljaHniYfmlbDph4/lj5jljJbml7bvvIzorqHnrpfmgLvmlbDph49cclxuICAgICAgICBpZiAodGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLmxlbmd0aCAhPT0gdGhpcy5jYXJkTnVtICkge1xyXG4gICAgICAgICAgICB0aGlzLnNldENhcmROdW0oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldENhcmRzV2lkdGgoKTtcclxuICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbih0aGlzLmN1cnJlbnRQYWdlKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuY2FyZHMubmF0aXZlRWxlbWVudCwgJ3RyYW5zaXRpb24nLCBgbGVmdCAke3RoaXMudHJhbnNpdGlvblNwZWVkfW1zYCk7XHJcblxyXG4gICAgICAgIC8vIOWPquacieS4gOmhteaXtu+8jOS4jeiHquWKqOi9ruaSrVxyXG4gICAgICAgIGlmICh0aGlzLmF1dG9wbGF5ICYmIHRoaXMuYXV0b3BsYXlTcGVlZCAmJiB0aGlzLnRvdGFsUGFnZSA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRvcGxheUlkID0gc2V0SW50ZXJ2YWwoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNsaWNrTmV4dCgpO1xyXG4gICAgICAgICAgICB9LCB0aGlzLmF1dG9wbGF5U3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOnZvaWQge1xyXG4gICAgICAgIC8vIOWkluWxguWuueWZqOWuveW6puacieWPmOWMluaXtu+8jOmHjeaWsOiuoeeul+WuveW6puWPiuS9jee9rlxyXG4gICAgICAgIGlmICh0aGlzLndyYXBwZXJFbGUgJiYgdGhpcy53cmFwcGVyRWxlLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggIT09IHRoaXMucGFnZVdpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FyZHNXaWR0aCgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbih0aGlzLmN1cnJlbnRQYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgIGNvbnN0IGluZGV4T2JqOiBTaW1wbGVDaGFuZ2UgPSBjaGFuZ2VzWydhY3RpdmVJbmRleCddO1xyXG4gICAgICAgIGlmIChpbmRleE9iaiAmJiAhaW5kZXhPYmouZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50UGFnZShpbmRleE9iai5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbih0aGlzLmN1cnJlbnRQYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXV0b3BsYXlJZCkge1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYXV0b3BsYXlJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuYXV0b3BsYXlJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnVubGlzdGVuUmVzaXplKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5saXN0ZW5SZXNpemUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDngrnlh7vlt6bkvqfmjInpkq7op6blj5Hkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2tQcmV2KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlQ2FyZCh0aGlzLmN1cnJlbnRQYWdlIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDngrnlh7vlj7PkvqfmjInpkq7op6blj5Hkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2tOZXh0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlQ2FyZCh0aGlzLmN1cnJlbnRQYWdlICsgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDngrnlh7vmjIfnpLrlmajop6blj5Hkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2tEb3QoaW5kZXg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlQ2FyZChpbmRleCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeCueWHu+W3puWPs+S+p+aMiemSruOAgemdouadv+aMh+ekuuadv+inpuWPkeS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGFjdGl2ZUNhcmQoaW5kZXg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmKHRoaXMudG90YWxQYWdlID09PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LCAndHJhbnNpdGlvbicsIGBsZWZ0ICR7dGhpcy50cmFuc2l0aW9uU3BlZWR9bXNgKTtcclxuICAgICAgICBpZiAoaW5kZXggPT09IHRoaXMudG90YWxQYWdlICYmIHRoaXMubG9vcCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMDtcclxuICAgICAgICAgICAgY29uc3QgZmlyc3Q6IEVsZW1lbnQgPSB0aGlzLnN3aXBlcmNhcmRDb21zLmZpcnN0Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oZmlyc3QsIHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbih0aGlzLnRvdGFsUGFnZSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRqdXN0UG9zaXRpb24oZmlyc3QpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IC0xICYmIHRoaXMubG9vcCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gdGhpcy50b3RhbFBhZ2UgLSAxO1xyXG4gICAgICAgICAgICBjb25zdCBsYXN0OiBFbGVtZW50ID0gdGhpcy5zd2lwZXJjYXJkQ29tcy5sYXN0Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24obGFzdCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNldExlZnRQb3NpdGlvbigtMSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRqdXN0UG9zaXRpb24obGFzdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IGluZGV4IDw9IC0xID8gMCA6IGluZGV4ID49IHRoaXMudG90YWxQYWdlID8gdGhpcy50b3RhbFBhZ2UgLSAxIDogaW5kZXg7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0TGVmdFBvc2l0aW9uKHRoaXMuY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4Q2hhbmdlLmVtaXQodGhpcy5jdXJyZW50UGFnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOiuoeeul+WNoeeJh+aAu+aVsOWPiuaAu+mhteaVsFxyXG4gICAgcHJpdmF0ZSBzZXRDYXJkTnVtKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2FyZE51bSA9IHRoaXMuY2FyZHMgJiYgdGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LmNoaWxkcmVuICYmIHRoaXMuY2FyZHMubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgdGhpcy5jYWxjdWxhdHBhZ2luZygpO1xyXG4gICAgICAgIHRoaXMuc3dpcGVyQnVsbGV0cy5sZW5ndGggPSB0aGlzLnRvdGFsUGFnZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDorqHnrpfljaHniYflrrnlmajmgLvlrr3luqZcclxuICAgIHByaXZhdGUgc2V0Q2FyZHNXaWR0aCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZWNhcmRXaWR0aCgpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCBgJHt0aGlzLnRvdGFsV2lkdGh9cHhgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlvZPngrnlh7vlt6blj7PmjInpkq7ml7bvvIzorr7nva7mv4DmtLvljaHniYfnm7jlr7nkvY3nva5cclxuICAgIHByaXZhdGUgc2V0TGVmdFBvc2l0aW9uKGluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBpZih0aGlzLnRvdGFsUGFnZSA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmnIDlkI7kuIDpobXmnKrljaDlroxcclxuICAgICAgICBpZiAoaW5kZXggPT09IHRoaXMudG90YWxQYWdlIC0gMSAmJiB0aGlzLmNhcmROdW0gJSB0aGlzLnNob3dDYXJkTnVtICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN3aXBlckNhcmROdW06IG51bWJlciA9IHRoaXMuY2FyZE51bSAtIHRoaXMuc2hvd0NhcmROdW07XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIGAkey0gKHN3aXBlckNhcmROdW0pICogdGhpcy5zd2lwZXJDYXJkV2lkdGggLSAoc3dpcGVyQ2FyZE51bSAtIDEpICogdGhpcy5jYXJkU3BhY2V9cHhgKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5zd2lwZXJjYXJkQ29tcy50b0FycmF5KClbc3dpcGVyQ2FyZE51bV0ubmF0aXZlRWxlbWVudCwgJ21hcmdpbi1yaWdodCcsIHRoaXMuY2FyZEdhcCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOaXoOmZkOW+queOr1xyXG4gICAgICAgIGlmIChpbmRleCA9PT0gdGhpcy50b3RhbFBhZ2UgJiYgdGhpcy5sb29wKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jYXJkcy5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIGAkey0odGhpcy50b3RhbFdpZHRoKX1weGApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5kZXggPT09IC0xICYmIHRoaXMubG9vcCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuY2FyZHMubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBgJHt0aGlzLnN3aXBlckNhcmRXaWR0aCAqIHRoaXMuc2hvd0NhcmROdW0gKyAodGhpcy5zaG93Q2FyZE51bSAtIDEpICogdGhpcy5jYXJkU3BhY2V9cHhgKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmNhcmRzLm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgYCR7LSBpbmRleCAqIDEwMH0lYCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6LCD5pW056ys5LiA6aG15oiW6ICF5pyA5ZCO5LiA6aG155qE5L2N572u77yM5Li65Yqo55S75YGa5YeG5aSHXHJcbiAgICBwcml2YXRlIHNldFBvc2l0aW9uKHRhcmdldEVsZTogRWxlbWVudCwgbGFzdFRvRmlyc3Q6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRhcmdldEVsZSwgJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGVYKCR7bGFzdFRvRmlyc3QgPyB0aGlzLnRvdGFsV2lkdGggOiB0aGlzLnRvdGFsV2lkdGggKiAtMX1weClgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkanVzdFBvc2l0aW9uKHRhcmdldEVsZT86IEVsZW1lbnQpOiB2b2lkIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0YXJnZXRFbGUsICd0cmFuc2Zvcm0nKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLmNhcmRzLm5hdGl2ZUVsZW1lbnQsICd0cmFuc2l0aW9uJyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0TGVmdFBvc2l0aW9uKHRoaXMuY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4Q2hhbmdlLmVtaXQodGhpcy5jdXJyZW50UGFnZSk7XHJcbiAgICAgICAgfSwgdGhpcy50cmFuc2l0aW9uU3BlZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOiuoeeul+avj+mhteaYvuekuuWNoeeJh+aVsO+8jOaAu+mhteaVsOWPiuW9k+WJjemhtVxyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdHBhZ2luZygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZVRvdGFsUGFnZSgpO1xyXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQ3VycmVudFBhZ2UodGhpcy5hY3RpdmVJbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDorqHnrpfljaHniYflrr3luqZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVjYXJkV2lkdGgoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5Yid5aeL5YyW5pe277yM5aSa5Zu+5LiU5bem5Y+z57+76aG15oyJ6ZKu6L+Y5rKh5pyJ5pi+56S677yM5a655Zmo5YWD57Sg55qE5Y+v55So5a695bqm6ZyA6KaB5YeP5Y675bem5Y+z5oyJ6ZKu55qE5a695bqm5LmL5ZKMMzIrMzI9NjRcclxuICAgICAgICBpZiAodGhpcy50b3RhbFBhZ2UgPT09IDAgICYmIHRoaXMuc2hvd0NhcmROdW0gPiAxKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZVdpZHRoID0gdGhpcy53cmFwcGVyRWxlLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggLSA2NDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VXaWR0aCA9IHRoaXMud3JhcHBlckVsZS5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5q+P6aG15Y2h54mH5oC76Ze06LedXHJcbiAgICAgICAgdGhpcy5jYXJkU3BhY2UgPSB0aGlzLnNob3dDYXJkTnVtID4gMSA/IHBhcnNlSW50KHRoaXMuY2FyZEdhcCwgMTApIDogMDtcclxuICAgICAgICBjb25zdCBjYXJkc1NwYWNlOiBudW1iZXIgPSAodGhpcy5zaG93Q2FyZE51bSAtIDEpICogcGFyc2VJbnQodGhpcy5jYXJkR2FwLCAxMCk7XHJcbiAgICAgICAgdGhpcy5zd2lwZXJDYXJkV2lkdGggPSAodGhpcy5wYWdlV2lkdGggLSBjYXJkc1NwYWNlKSAvIHRoaXMuc2hvd0NhcmROdW07XHJcbiAgICAgICAgdGhpcy50b3RhbFdpZHRoID0gdGhpcy5zd2lwZXJDYXJkV2lkdGggKiB0aGlzLmNhcmROdW0gKyBjYXJkc1NwYWNlICogdGhpcy50b3RhbFBhZ2U7XHJcblxyXG4gICAgICAgIHRoaXMuc3dpcGVyY2FyZENvbXMudG9BcnJheSgpLmZvckVhY2goKGl0ZW06IFRwU3dpcGVyQ29tcG9uZW50LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOiuvue9ruWNoeeJh+WuveW6plxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyMi5zZXRTdHlsZShpdGVtLm5hdGl2ZUVsZW1lbnQsICd3aWR0aCcsIHRoaXMuc3dpcGVyQ2FyZFdpZHRoICsgJ3B4Jyk7XHJcbiAgICAgICAgICAgIC8vIOiuvue9ruWNoeeJh+mXtOi3ne+8jOavj+mhteacgOWQjuS4gOS4quWNoeeJh+S4jeiuvue9rlxyXG4gICAgICAgICAgICBpZiAoKGluZGV4ICsgMSkgJSB0aGlzLnNob3dDYXJkTnVtICE9PSAwICYmIGluZGV4ICE9PSB0aGlzLmNhcmROdW0gLSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyMi5zZXRTdHlsZShpdGVtLm5hdGl2ZUVsZW1lbnQsICdtYXJnaW4tcmlnaHQnLCB0aGlzLmNhcmRTcGFjZSArICdweCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDorqHnrpfmgLvpobXmlbBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVUb3RhbFBhZ2UoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy50b3RhbFBhZ2UgPSBNYXRoLmNlaWwodGhpcy5jYXJkTnVtIC8gdGhpcy5zaG93Q2FyZE51bSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFBhZ2UgPiB0aGlzLnRvdGFsUGFnZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUNhcmQodGhpcy50b3RhbFBhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqICDorqHnrpflvZPliY3pobVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVDdXJyZW50UGFnZShpbmRleDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5b2T5YmN57Si5byV5YC85LiN5q2j56Gu77yM5LiN5aSE55CGXHJcbiAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+ICh0aGlzLmNhcmROdW0gLSAxKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaG93Q2FyZE51bSA9PT0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gaW5kZXg7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOW9k+WJjeS4gOmhteWNoeeJh+eahOacgOWkp+acgOWwj+e0ouW8lVxyXG4gICAgICAgIGNvbnN0IG1heEluZGV4OiBudW1iZXIgPSAodGhpcy5jdXJyZW50UGFnZSArIDEpICogdGhpcy5zaG93Q2FyZE51bSAtIDE7XHJcbiAgICAgICAgY29uc3QgbWluSW5kZXg6IG51bWJlciA9IHRoaXMuY3VycmVudFBhZ2UgPiAwID8gKHRoaXMuY3VycmVudFBhZ2UgKiB0aGlzLnNob3dDYXJkTnVtIC0gMSkgOiAwO1xyXG4gICAgICAgIC8vIOW9k+WJjee0ouWNoeeJh+aYr+WQpuWcqOW9k+WJjemhtemdolxyXG4gICAgICAgIGlmIChpbmRleCA8IG1pbkluZGV4IHx8IGluZGV4ID4gbWF4SW5kZXgpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IE1hdGguZmxvb3IoKGluZGV4ICsgMSkgLyB0aGlzLnNob3dDYXJkTnVtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19