import { Component, ElementRef, Input, Renderer2, ViewChild } from '@angular/core';
import { TiImagepreviewComponent, TiModalService, TiBaseComponent } from '@cloud/tiny3';
/**
 * 商品预览组件
 *
 * 该组件用来展示商品的预览内容，包括上方的主预览图和下方的缩略图
 *
 * 10.0.3 增加
 *
 * <example-url>../tinyplus3demo/#/productpreview/productpreview-all</example-url>
 */
export class TpProductpreviewComponent extends TiBaseComponent {
    constructor(tiModal, render, hostEleRef) {
        super(hostEleRef, render);
        this.tiModal = tiModal;
        this.render = render;
        this.hostEleRef = hostEleRef;
        /**
         * 预览文件列表
         */
        this.files = [];
        /**
         * @ignore
         * 缩略图列表，翻页时重新设置
         */
        this.thumbList = [];
        /**
         * @ignore 记录当前预览的商品索引
         */
        this.currentPreviewIndex = -1;
        /**
         * @ignore 缩略图当前页
         */
        this.currentThumbPage = 1;
        /**
         * @ignore 缩略图总页数
         *
         */
        this.totalThumbPage = 1;
    }
    ngAfterViewInit() {
        this.render.addClass(this.productThumbEle.nativeElement.children[0], 'tp-product-preview-thumb-item-active');
    }
    ngOnChanges(changes) {
        if (changes.files && changes.files.firstChange === false) {
            this.files = changes.files.currentValue;
            this.initThumb();
            if (this.productThumbEle) {
                this.setThumbList();
            }
            // 确保files接口变化时，第一个缩略图的选中样式生效
            setTimeout(() => {
                if (this.productThumbEle) {
                    this.render.addClass(this.productThumbEle.nativeElement.children[0], 'tp-product-preview-thumb-item-active');
                }
            }, 0);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        this.initThumb();
    }
    /**
     * 初始化缩略图相关变量
     */
    initThumb() {
        if (this.files && this.files.length > 0) {
            this.currentPreviewIndex = 0;
            // 计算总页数
            this.totalThumbPage = Math.ceil(this.files.length / TpProductpreviewComponent.ITEM_PER_PAGE);
            this.currentThumbPage = 1;
            this.files.length >= TpProductpreviewComponent.ITEM_PER_PAGE ?
                this.thumbList = this.files.slice(0, TpProductpreviewComponent.ITEM_PER_PAGE) : this.thumbList = this.files;
        }
    }
    /**
     * @ignore 主图查看
     * @param event: 事件
     * @param index: 当前选中项在this.thumbList中的索引,this.thumbList中始终只有4项
     */
    onMouseenterThumb(event, index) {
        this.currentPreviewIndex = (this.currentThumbPage - 1) * TpProductpreviewComponent.ITEM_PER_PAGE + index;
        // 计算最后一页的缩略图个数
        const thumbItemNumber = this.files.length % TpProductpreviewComponent.ITEM_PER_PAGE;
        // 如果是最后一页，且最后一页不满4个
        if (this.totalThumbPage > 1 && this.currentThumbPage === this.totalThumbPage && thumbItemNumber !== 0) {
            this.currentPreviewIndex -= (TpProductpreviewComponent.ITEM_PER_PAGE - thumbItemNumber);
        }
        // 设置选中样式
        const thumbItemEles = this.productThumbEle.nativeElement.children;
        for (const item of thumbItemEles) {
            this.render.removeClass(item, 'tp-product-preview-thumb-item-active');
        }
        this.render.addClass(event.target.parentElement, 'tp-product-preview-thumb-item-active');
    }
    /**
     * @ignore 弹框中预览大图
     */
    onClickMain(event) {
        this.tiModal.open(TiImagepreviewComponent, {
            id: this.id + '_productPreviewModal',
            modalClass: 'tp-product-preview-modal',
            context: {
                index: this.currentPreviewIndex,
                fileList: this.files,
                id: this.id // 传递id
            }
        });
    }
    /**
     * @ignore 缩略图上一页
     */
    prev() {
        if (this.currentThumbPage === 1) {
            return;
        }
        this.currentThumbPage--;
        this.setThumbList();
    }
    /**
     * @ignore 缩略图下一页
     */
    next() {
        if (this.currentThumbPage === this.totalThumbPage) {
            return;
        }
        this.currentThumbPage++;
        this.setThumbList();
    }
    /**
     * 设置缩略图列表
     */
    setThumbList() {
        // undefined、null、false、string情况下，不处理
        if (!this.files || typeof this.files === 'string' || (this.files && this.files.slice === undefined)) {
            return;
        }
        // tslint:disable-next-line: max-line-length
        this.thumbList = this.files.slice((this.currentThumbPage - 1) * TpProductpreviewComponent.ITEM_PER_PAGE, this.currentThumbPage * TpProductpreviewComponent.ITEM_PER_PAGE);
        // 计算最后一页的缩略图个数
        const thumbItemNumber = this.files.length % TpProductpreviewComponent.ITEM_PER_PAGE;
        if (this.totalThumbPage > 1 && this.currentThumbPage === this.totalThumbPage && thumbItemNumber !== 0) {
            this.thumbList = this.files.slice(this.files.length - TpProductpreviewComponent.ITEM_PER_PAGE, this.files.length);
        }
    }
}
/**
 * 每页显示的小图个数
 */
TpProductpreviewComponent.ITEM_PER_PAGE = 4;
TpProductpreviewComponent.decorators = [
    { type: Component, args: [{
                selector: 'tp-productpreview',
                template: "<div class=\"tp-product-preview-container\" *ngIf=\"files && files.length\">\r\n    <!-- \u5927\u56FE\u663E\u793A -->\r\n    <div tiOutline class=\"tp-product-preview-main\" (click)=\"onClickMain($event)\" [tabindex]=\"0\" (keydown.enter)=\"onClickMain($event)\" [id]=\"appendId('main')\">\r\n        <img [src]='files[currentPreviewIndex].previewUrl' tiZoom/>\r\n    </div>\r\n    <!-- \u7F29\u7565\u56FE\u663E\u793A\u53CA\u5DE6\u53F3\u5207\u6362 -->\r\n    <div class=\"tp-product-preview-thumb-container\">\r\n        <!-- \u5411\u524D\u7FFB\u9875 -->\r\n        <div tiOutline class=\"tp-product-preview-thumb-left tp-product-preview-thumb-page\"\r\n            [ngClass]=\"{'tp-product-preview-thumb-page-disabled': currentThumbPage === 1}\"\r\n            (click)=\"prev()\"\r\n            [tabindex]=\"currentThumbPage === 1 ? -1 : 0\"\r\n            (keydown.enter)=\"prev()\"\r\n            [id]=\"appendId('prev')\">\r\n            <ti-icon class=\"tp-product-preview-icon\" name='angle-left'></ti-icon>\r\n        </div>\r\n        <!-- \u7F29\u7565\u56FE\u5217\u8868 -->\r\n        <div class=\"tp-product-preview-thumb-wapper\">\r\n            <div class='tp-product-preview-thumb' #productThumb>\r\n                <div class=\"tp-product-preview-thumb-item\" *ngFor='let item of thumbList; index as i;'>\r\n                    <img [src]='item.previewUrl' (mouseenter)='onMouseenterThumb($event, i)' [id]=\"appendId('active_' + i)\"/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- \u5411\u540E\u7FFB\u9875 -->\r\n        <div tiOutline class=\"tp-product-preview-thumb-right tp-product-preview-thumb-page\"\r\n            [ngClass]=\"{'tp-product-preview-thumb-page-disabled': currentThumbPage === totalThumbPage}\"\r\n            (click)=\"next()\"\r\n            [tabindex]=\"currentThumbPage === totalThumbPage ? -1 : 0\"\r\n            (keydown.enter)=\"next()\"\r\n            [id]=\"appendId('next')\">\r\n            <ti-icon class='tp-product-preview-icon' name='angle-right'></ti-icon>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                styles: [".ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}::ng-deep :root{--tp-product-preview-main-large-size:450px;--tp-product-preview-main-middle-size:380px;--tp-product-preview-main-small-size:300px;--tp-product-preview-modal-width:640px;--tp-product-preview-thumb-large-size:86.5px;--tp-product-preview-thumb-middle-size:69px;--tp-product-preview-thumb-page-border-radius:2px;--tp-product-preview-thumb-page-button-size:calc(var(--tp-product-preview-thumb-page-size) + var(--tp-product-preview-thumb-page-margin));--tp-product-preview-thumb-page-font-size:24px;--tp-product-preview-thumb-page-margin:16px;--tp-product-preview-thumb-page-size:24px;--tp-product-preview-thumb-small-size:49px}:host{display:block}.tp-product-preview-container{width:100%}.tp-product-preview-container .tp-product-preview-main{align-items:center;border:1px solid var(--ti-common-color-line-dividing);box-sizing:border-box;display:flex;justify-content:center}.tp-product-preview-container .tp-product-preview-thumb-container{align-items:center;display:flex;justify-content:space-between;margin-top:var(--ti-common-space-3x)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper{flex:1;overflow:hidden}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb{display:flex;left:0;position:relative}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item{align-items:center;border:1px solid transparent;box-sizing:border-box;display:flex;flex-shrink:0;justify-content:center}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item img{height:auto;width:auto}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item:not(:last-child){margin-right:var(--ti-common-space-2x)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item-active{border:1px solid var(--ti-common-color-line-active);cursor:pointer}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-page{border-radius:var(--tp-product-preview-thumb-page-border-radius);height:var(--tp-product-preview-thumb-page-size);position:relative;width:var(--tp-product-preview-thumb-page-size)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-page:hover:not(.tp-product-preview-thumb-page-disabled){background-color:var(--ti-common-color-bg-light-normal);color:var(--ti-common-color-icon-hover);cursor:pointer}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-page:active:not(.tp-product-preview-thumb-page-disabled){background-color:var(--ti-common-color-icon-active);color:var(--ti-common-bg-minor-active)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-page .tp-product-preview-icon{font-size:var(--tp-product-preview-thumb-page-font-size);line-height:var(--tp-product-preview-thumb-page-size)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-page-disabled{color:var(--ti-common-color-icon-disabled);cursor:not-allowed;outline:none}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-left{margin-right:var(--tp-product-preview-thumb-page-margin)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-right{margin-left:var(--tp-product-preview-thumb-page-margin)}@media screen and (max-width:1440px){:host{width:var(--tp-product-preview-main-small-size)}::ng-deep .ti3-img-zoom-viewer{height:var(--tp-product-preview-main-small-size)!important;width:var(--tp-product-preview-main-small-size)!important}.tp-product-preview-container .tp-product-preview-main{height:var(--tp-product-preview-main-small-size)}.tp-product-preview-container .tp-product-preview-main img{max-height:calc(var(--tp-product-preview-main-small-size) - 2px);max-width:calc(var(--tp-product-preview-main-small-size) - 2px)}.tp-product-preview-container .tp-product-preview-main ::ng-deep .ti3-img-zoom-selector{height:calc(var(--tp-product-preview-main-small-size)/2)!important;width:calc(var(--tp-product-preview-main-small-size)/2)!important}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item{height:var(--tp-product-preview-thumb-small-size);width:var(--tp-product-preview-thumb-small-size)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item img{max-height:calc(var(--tp-product-preview-thumb-small-size) - 2px);max-width:calc(var(--tp-product-preview-thumb-small-size) - 2px)}}@media screen and (min-width:1440px) and (max-width:1600px){:host{width:var(--tp-product-preview-main-middle-size)}::ng-deep .ti3-img-zoom-viewer{height:var(--tp-product-preview-main-middle-size)!important;width:var(--tp-product-preview-main-middle-size)!important}.tp-product-preview-container .tp-product-preview-main{height:var(--tp-product-preview-main-middle-size)}.tp-product-preview-container .tp-product-preview-main img{max-height:calc(var(--tp-product-preview-main-middle-size) - 2px);max-width:calc(var(--tp-product-preview-main-middle-size) - 2px)}.tp-product-preview-container .tp-product-preview-main ::ng-deep .ti3-img-zoom-selector{height:calc(var(--tp-product-preview-main-middle-size)/2)!important;width:calc(var(--tp-product-preview-main-middle-size)/2)!important}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item{height:var(--tp-product-preview-thumb-middle-size);width:var(--tp-product-preview-thumb-middle-size)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item img{max-height:calc(var(--tp-product-preview-thumb-middle-size) - 2px);max-width:calc(var(--tp-product-preview-thumb-middle-size) - 2px)}}@media screen and (min-width:1600px){:host{width:var(--tp-product-preview-main-large-size)}::ng-deep .ti3-img-zoom-viewer{height:var(--tp-product-preview-main-large-size)!important;width:var(--tp-product-preview-main-large-size)!important}.tp-product-preview-container .tp-product-preview-main{height:var(--tp-product-preview-main-large-size)}.tp-product-preview-container .tp-product-preview-main img{max-height:calc(var(--tp-product-preview-main-large-size) - 2px);max-width:calc(var(--tp-product-preview-main-large-size) - 2px)}.tp-product-preview-container .tp-product-preview-main ::ng-deep .ti3-img-zoom-selector{height:calc(var(--tp-product-preview-main-large-size)/2)!important;width:calc(var(--tp-product-preview-main-large-size)/2)!important}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item{height:var(--tp-product-preview-thumb-large-size);width:var(--tp-product-preview-thumb-large-size)}.tp-product-preview-container .tp-product-preview-thumb-container .tp-product-preview-thumb-wapper .tp-product-preview-thumb .tp-product-preview-thumb-item img{max-height:calc(var(--tp-product-preview-thumb-large-size) - 2px);max-width:calc(var(--tp-product-preview-thumb-large-size) - 2px)}}::ng-deep .tp-product-preview-modal{width:var(--tp-product-preview-modal-width)!important}::ng-deep .tp-product-preview-modal .ti3-close{top:0}::ng-deep .tp-product-preview-modal .ti3-image-preview-container{margin-top:var(--ti-common-space-2x)}"]
            },] }
];
TpProductpreviewComponent.ctorParameters = () => [
    { type: TiModalService },
    { type: Renderer2 },
    { type: ElementRef }
];
TpProductpreviewComponent.propDecorators = {
    files: [{ type: Input }],
    productThumbEle: [{ type: ViewChild, args: ['productThumb',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHBQcm9kdWN0cHJldmlld0NvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55cGx1czMvY29tcG9uZW50cy9wcm9kdWN0cHJldmlldy9UcFByb2R1Y3RwcmV2aWV3Q29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQXFCLFNBQVMsRUFBaUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BJLE9BQU8sRUFBcUIsdUJBQXVCLEVBQUUsY0FBYyxFQUFHLGVBQWUsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUUzRzs7Ozs7Ozs7R0FRRztBQU1ILE1BQU0sT0FBTyx5QkFBMEIsU0FBUSxlQUFlO0lBc0MxRCxZQUFvQixPQUF1QixFQUFVLE1BQWlCLEVBQVUsVUFBc0I7UUFDbEcsS0FBSyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQURWLFlBQU8sR0FBUCxPQUFPLENBQWdCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7UUFoQ3RHOztXQUVHO1FBQ00sVUFBSyxHQUE2QixFQUFFLENBQUM7UUFFOUM7OztXQUdHO1FBQ0ksY0FBUyxHQUE2QixFQUFFLENBQUM7UUFFaEQ7O1dBRUc7UUFDSSx3QkFBbUIsR0FBVyxDQUFDLENBQUMsQ0FBQztRQUV4Qzs7V0FFRztRQUNJLHFCQUFnQixHQUFXLENBQUMsQ0FBQztRQUVwQzs7O1dBR0c7UUFDSSxtQkFBYyxHQUFXLENBQUMsQ0FBQztJQVNsQyxDQUFDO0lBRUQsZUFBZTtRQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO0lBQ2pILENBQUM7SUFFRCxXQUFXLENB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Ryx5QkFBeUIsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUUxSyxlQUFlO1FBQ2YsTUFBTSxlQUFlLEdBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcseUJBQXlCLENBQUMsYUFBYSxDQUFDO1FBQzVGLElBQUksSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFnQixLQUFLLElBQUksQ0FBQyxjQUFjLElBQUksZUFBZSxLQUFLLENBQUMsRUFBRTtZQUNuRyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLHlCQUF5QixDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3JIO0lBRUwsQ0FBQzs7QUE1SkQ7O0dBRUc7QUFDcUIsdUNBQWEsR0FBVyxDQUFDLENBQUM7O1lBVHJELFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsbUJBQW1CO2dCQUM3Qix1akVBQW9DOzthQUV2Qzs7O1lBZm9ELGNBQWM7WUFETSxTQUFTO1lBQS9DLFVBQVU7OztvQkEwQnhDLEtBQUs7OEJBMkJMLFNBQVMsU0FBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRpRmlsZVByZXZpZXdJbmZvLCBUaUltYWdlcHJldmlld0NvbXBvbmVudCwgVGlNb2RhbFNlcnZpY2UgLCBUaUJhc2VDb21wb25lbnR9IGZyb20gJ0BjbG91ZC90aW55Myc7XHJcblxyXG4vKipcclxuICog5ZWG5ZOB6aKE6KeI57uE5Lu2XHJcbiAqXHJcbiAqIOivpee7hOS7tueUqOadpeWxleekuuWVhuWTgeeahOmihOiniOWGheWuue+8jOWMheaLrOS4iuaWueeahOS4u+mihOiniOWbvuWSjOS4i+aWueeahOe8qeeVpeWbvlxyXG4gKlxyXG4gKiAxMC4wLjMg5aKe5YqgXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55cGx1czNkZW1vLyMvcHJvZHVjdHByZXZpZXcvcHJvZHVjdHByZXZpZXctYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0cC1wcm9kdWN0cHJldmlldycsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcHJvZHVjdHByZXZpZXcuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9wcm9kdWN0cHJldmlldy5sZXNzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRwUHJvZHVjdHByZXZpZXdDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICAvKipcclxuICAgICAqIOavj+mhteaYvuekuueahOWwj+WbvuS4quaVsFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBJVEVNX1BFUl9QQUdFOiBudW1iZXIgPSA0O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6aKE6KeI5paH5Lu25YiX6KGoXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGZpbGVzOiBBcnJheTxUaUZpbGVQcmV2aWV3SW5mbz4gPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOe8qeeVpeWbvuWIl+ihqO+8jOe/u+mhteaXtumHjeaWsOiuvue9rlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdGh1bWJMaXN0OiBBcnJheTxUaUZpbGVQcmV2aWV3SW5mbz4gPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg6K6w5b2V5b2T5YmN6aKE6KeI55qE5ZWG5ZOB57Si5byVXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjdXJyZW50UHJldmlld0luZGV4OiBudW1iZXIgPSAtMTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg57yp55Wl5Zu+5b2T5YmN6aG1XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjdXJyZW50VGh1bWJQYWdlOiBudW1iZXIgPSAxO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDnvKnnlaXlm77mgLvpobXmlbBcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0b3RhbFRodW1iUGFnZTogbnVtYmVyID0gMTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5YaF6YOo5Y+Y6YePXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ3Byb2R1Y3RUaHVtYicpIHByb2R1Y3RUaHVtYkVsZTogRWxlbWVudFJlZjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRpTW9kYWw6IFRpTW9kYWxTZXJ2aWNlLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGhvc3RFbGVSZWY6IEVsZW1lbnRSZWYpIHtcclxuICAgICAgICBzdXBlcihob3N0RWxlUmVmLCByZW5kZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLnByb2R1Y3RUaHVtYkVsZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLCAndHAtcHJvZHVjdC1wcmV2aWV3LXRodW1iLWl0ZW0tYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmZpbGVzICYmIGNoYW5nZXMuZmlsZXMuZmlyc3RDaGFuZ2UgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBjaGFuZ2VzLmZpbGVzLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5pbml0VGh1bWIoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHJvZHVjdFRodW1iRWxlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRodW1iTGlzdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOehruS/nWZpbGVz5o6l5Y+j5Y+Y5YyW5pe277yM56ys5LiA5Liq57yp55Wl5Zu+55qE6YCJ5Lit5qC35byP55Sf5pWIXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvZHVjdFRodW1iRWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5wcm9kdWN0VGh1bWJFbGUubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXSwgJ3RwLXByb2R1Y3QtcHJldmlldy10aHVtYi1pdGVtLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICB0aGlzLmluaXRUaHVtYigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yid5aeL5YyW57yp55Wl5Zu+55u45YWz5Y+Y6YePXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW5pdFRodW1iKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmZpbGVzICYmIHRoaXMuZmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQcmV2aWV3SW5kZXggPSAwO1xyXG4gICAgICAgICAgICAvLyDorqHnrpfmgLvpobXmlbBcclxuICAgICAgICAgICAgdGhpcy50b3RhbFRodW1iUGFnZSA9IE1hdGguY2VpbCh0aGlzLmZpbGVzLmxlbmd0aCAvIFRwUHJvZHVjdHByZXZpZXdDb21wb25lbnQuSVRFTV9QRVJfUEFHRSk7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFRodW1iUGFnZSA9IDE7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZXMubGVuZ3RoID49IFRwUHJvZHVjdHByZXZpZXdDb21wb25lbnQuSVRFTV9QRVJfUEFHRSA/XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1iTGlzdCA9IHRoaXMuZmlsZXMuc2xpY2UoMCwgVHBQcm9kdWN0cHJldmlld0NvbXBvbmVudC5JVEVNX1BFUl9QQUdFKSA6IHRoaXMudGh1bWJMaXN0ID0gdGhpcy5maWxlcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOS4u+Wbvuafpeeci1xyXG4gICAgICogQHBhcmFtIGV2ZW50OiDkuovku7ZcclxuICAgICAqIEBwYXJhbSBpbmRleDog5b2T5YmN6YCJ5Lit6aG55ZyodGhpcy50aHVtYkxpc3TkuK3nmoTntKLlvJUsdGhpcy50aHVtYkxpc3TkuK3lp4vnu4jlj6rmnIk06aG5XHJcbiAgICAgKi9cclxuICAgIG9uTW91c2VlbnRlclRodW1iKGV2ZW50OiBhbnksIGluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQcmV2aWV3SW5kZXggPSAodGhpcy5jdXJyZW50VGh1bWJQYWdlIC0gMSkgKiBUcFByb2R1Y3RwcmV2aWV3Q29tcG9uZW50LklURU1fUEVSX1BBR0UgKyBpbmRleCA7XHJcbiAgICAgICAgLy8g6K6h566X5pyA5ZCO5LiA6aG155qE57yp55Wl5Zu+5Liq5pWwXHJcbiAgICAgICAgY29uc3QgdGh1bWJJdGVtTnVtYmVyOiBudW1iZXIgPSB0aGlzLmZpbGVzLmxlbmd0aCAlIFRwUHJvZHVjdHByZXZpZXdDb21wb25lbnQuSVRFTV9QRVJfUEFHRTtcclxuICAgICAgICAvLyDlpoLmnpzmmK/mnIDlkI7kuIDpobXvvIzkuJTmnIDlkI7kuIDpobXkuI3mu6E05LiqXHJcbiAgICAgICAgaWYgKHRoaXMudG90YWxUaHVtYlBhZ2UgPiAxICYmIHRoaXMuY3VycmVudFRodW1iUGFnZSA9PT0gdGhpcy50b3RhbFRodW1iUGFnZSAmJiB0aHVtYkl0ZW1OdW1iZXIgIT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJldmlld0luZGV4IC09IChUcFByb2R1Y3RwcmV2aWV3Q29tcG9uZW50LklURU1fUEVSX1BBR0UgLSB0aHVtYkl0ZW1OdW1iZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6K6+572u6YCJ5Lit5qC35byPXHJcbiAgICAgICAgY29uc3QgdGh1bWJJdGVtRWxlczogYW55ID0gdGhpcy5wcm9kdWN0VGh1bWJFbGUubmF0aXZlRWxlbWVudC5jaGlsZHJlbjtcclxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGh1bWJJdGVtRWxlcykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyhpdGVtLCAndHAtcHJvZHVjdC1wcmV2aWV3LXRodW1iLWl0ZW0tYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LCAndHAtcHJvZHVjdC1wcmV2aWV3LXRodW1iLWl0ZW0tYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOW8ueahhuS4remihOiniOWkp+WbvlxyXG4gICAgICovXHJcbiAgICBvbkNsaWNrTWFpbihldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy50aU1vZGFsLm9wZW4oVGlJbWFnZXByZXZpZXdDb21wb25lbnQsIHtcclxuICAgICAgICAgICAgaWQ6IHRoaXMuaWQgKyAnX3Byb2R1Y3RQcmV2aWV3TW9kYWwnLFxyXG4gICAgICAgICAgICBtb2RhbENsYXNzOiAndHAtcHJvZHVjdC1wcmV2aWV3LW1vZGFsJyxcclxuICAgICAgICAgICAgY29udGV4dDoge1xyXG4gICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuY3VycmVudFByZXZpZXdJbmRleCwgLy8g5b2T5YmN5paH5Lu257Si5byVXHJcbiAgICAgICAgICAgICAgICBmaWxlTGlzdDogdGhpcy5maWxlcywgLy8g6aKE6KeI5YiX6KGoXHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5pZCAvLyDkvKDpgJJpZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOe8qeeVpeWbvuS4iuS4gOmhtVxyXG4gICAgICovXHJcbiAgICBwcmV2KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRUaHVtYlBhZ2UgPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmN1cnJlbnRUaHVtYlBhZ2UtLTtcclxuICAgICAgICB0aGlzLnNldFRodW1iTGlzdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDnvKnnlaXlm77kuIvkuIDpobVcclxuICAgICAqL1xyXG4gICAgbmV4dCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VGh1bWJQYWdlID09PSB0aGlzLnRvdGFsVGh1bWJQYWdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VGh1bWJQYWdlKys7XHJcbiAgICAgICAgdGhpcy5zZXRUaHVtYkxpc3QoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rue8qeeVpeWbvuWIl+ihqFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldFRodW1iTGlzdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyB1bmRlZmluZWTjgIFudWxs44CBZmFsc2XjgIFzdHJpbmfmg4XlhrXkuIvvvIzkuI3lpITnkIZcclxuICAgICAgICBpZiAoIXRoaXMuZmlsZXMgfHwgdHlwZW9mIHRoaXMuZmlsZXMgPT09ICdzdHJpbmcnIHx8ICh0aGlzLmZpbGVzICYmIHRoaXMuZmlsZXMuc2xpY2UgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgICAgIHRoaXMudGh1bWJMaXN0ID0gdGhpcy5maWxlcy5zbGljZSgodGhpcy5jdXJyZW50VGh1bWJQYWdlIC0gMSkgKiBUcFByb2R1Y3RwcmV2aWV3Q29tcG9uZW50LklURU1fUEVSX1BBR0UsIHRoaXMuY3VycmVudFRodW1iUGFnZSAqIFRwUHJvZHVjdHByZXZpZXdDb21wb25lbnQuSVRFTV9QRVJfUEFHRSk7XHJcblxyXG4gICAgICAgIC8vIOiuoeeul+acgOWQjuS4gOmhteeahOe8qeeVpeWbvuS4quaVsFxyXG4gICAgICAgIGNvbnN0IHRodW1iSXRlbU51bWJlcjogbnVtYmVyID0gdGhpcy5maWxlcy5sZW5ndGggJSBUcFByb2R1Y3RwcmV2aWV3Q29tcG9uZW50LklURU1fUEVSX1BBR0U7XHJcbiAgICAgICAgaWYgKHRoaXMudG90YWxUaHVtYlBhZ2UgPiAxICYmIHRoaXMuY3VycmVudFRodW1iUGFnZSA9PT0gdGhpcy50b3RhbFRodW1iUGFnZSAmJiB0aHVtYkl0ZW1OdW1iZXIgIT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy50aHVtYkxpc3QgPSB0aGlzLmZpbGVzLnNsaWNlKHRoaXMuZmlsZXMubGVuZ3RoIC0gVHBQcm9kdWN0cHJldmlld0NvbXBvbmVudC5JVEVNX1BFUl9QQUdFLCB0aGlzLmZpbGVzLmxlbmd0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG4iXX0=