import { EventEmitter, Directive, ElementRef, Renderer2, Input, Output, NgModule, NgZone, Component, ViewEncapsulation, forwardRef, ViewChild, HostListener, Inject, ApplicationRef, TemplateRef, SecurityContext, ɵɵdefineInjectable, ɵɵinject, INJECTOR, RendererFactory2, ComponentFactoryResolver, Injectable, Injector, Pipe, ContentChild, ViewChildren, IterableDiffers, KeyValueDiffers, ChangeDetectorRef, HostBinding, Optional, ViewContainerRef } from '@angular/core';
import { CommonModule, DOCUMENT, getLocaleId, formatDate } from '@angular/common';
import { style, animate, AnimationBuilder, trigger, state, transition } from '@angular/animations';
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
import { NG_VALUE_ACCESSOR, FormsModule, NgControl, FormControl, FormBuilder, DefaultValueAccessor, Validators, NG_VALIDATORS, ReactiveFormsModule } from '@angular/forms';
import { Subject, empty, timer } from 'rxjs';
import { DomSanitizer } from '@angular/platform-browser';
import { debounceTime, switchMap, debounce } from 'rxjs/operators';
import { NavigationEnd, Router, ActivatedRoute } from '@angular/router';
import { __rest } from 'tslib';

/* eslint-disable no-cond-assign */
// 另，angular也有brower-util.ts，但是没有对浏览器版本号的判断。
/*
 * 浏览器类型的枚举定义。字符串枚举，提供了运行时可读性。
 */
/* export enum Browser {  // export是为了不成为全局定义。此文件存在2个export
    EDGE = 'EDGE',
    IE = 'IE',
    FIREFOX = 'FIREFOX',
    CHROME = 'CHROME',
    OPERA = 'OPERA',
    SAFARI = 'SAFARI',
    OTHER = 'OTHER'
} */
/**
 * BrowserInfo浏览器工具类，提供浏览器类别和版本信息
 *
 * 浏览器的类型及版本信息
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/utils/browser-basic" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiBrowser {
    /**
     * 浏览器类型
     * @returns 返回枚举型浏览器类型字符串
     */
    static browser() {
        TiBrowser.init();
        return TiBrowser._browser;
    }
    /**
     * 浏览器版本
     */
    static version() {
        TiBrowser.init();
        return TiBrowser._version;
    }
    /**
     * 是否Edge
     */
    static isEdge() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.EDGE;
    }
    /**
     * 是否IE
     */
    static isIE() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.IE;
    }
    /**
     * 是否Firefox
     */
    static isFirefox() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.FIREFOX;
    }
    /**
     * 是否Chrome
     */
    static isChrome() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.CHROME;
    }
    /**
     * 是否Opera
     */
    static isOpera() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.OPERA;
    }
    /**
     * 是否Safari
     */
    static isSafari() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.SAFARI;
    }
    /**
     * 是否Other
     */
    static isOther() {
        TiBrowser.init();
        return TiBrowser.browser() === TiBrowser.OTHER;
    }
    static init() {
        if (TiBrowser.isInit) { // 如果已经初始化，那么返回
            return;
        }
        // 浏览器判断，已支持SSR
        const userAgent = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase() : '';
        let aAgentInfo;
        // tslint:disable-next-line:no-conditional-assignment
        (aAgentInfo = userAgent.match(/edge\/([\d.]+)/)) ? TiBrowser._browser = TiBrowser.EDGE :
            // tslint:disable-next-line:no-conditional-assignment
            (aAgentInfo = userAgent.match(/rv:([\d.]+)\) like gecko/)) ? TiBrowser._browser = TiBrowser.IE :
                // tslint:disable-next-line:no-conditional-assignment
                (aAgentInfo = userAgent.match(/msie ([\d.]+)/)) ? TiBrowser._browser = TiBrowser.IE :
                    // tslint:disable-next-line:no-conditional-assignment
                    (aAgentInfo = userAgent.match(/firefox\/([\d.]+)/)) ? TiBrowser._browser = TiBrowser.FIREFOX :
                        // tslint:disable-next-line:no-conditional-assignment
                        (aAgentInfo = userAgent.match(/chrome\/([\d.]+)/)) ? TiBrowser._browser = TiBrowser.CHROME :
                            // tslint:disable-next-line:no-conditional-assignment
                            (aAgentInfo = userAgent.match(/opera.([\d.]+)/)) ? TiBrowser._browser = TiBrowser.OPERA :
                                // tslint:disable-next-line:no-conditional-assignment
                                (aAgentInfo = userAgent.match(/version\/([\d.]+).*safari/)) ? TiBrowser._browser = TiBrowser.SAFARI :
                                    TiBrowser._browser = TiBrowser.OTHER;
        // 版本号取整
        TiBrowser._version = (aAgentInfo !== null) ? parseInt(aAgentInfo[1].split('.')[0], 10) : 0;
        // 改变初始化值
        TiBrowser.isInit = true;
    }
}
/**
 * EDGE浏览器字符串
 */
TiBrowser.EDGE = 'EDGE';
/**
 * IE浏览器字符串
 */
TiBrowser.IE = 'IE';
/**
 * FIREFOX浏览器字符串
 */
TiBrowser.FIREFOX = 'FIREFOX';
/**
 * CHROME浏览器字符串
 */
TiBrowser.CHROME = 'CHROME';
/**
 * OPERA浏览器字符串
 */
TiBrowser.OPERA = 'OPERA';
/**
 * SAFARI浏览器字符串
 */
TiBrowser.SAFARI = 'SAFARI';
/**
 * OTHER浏览器字符串
 */
TiBrowser.OTHER = 'OTHER';
TiBrowser._browser = TiBrowser.OTHER;
TiBrowser._version = 0; // 浏览器的大版本号，整数。取第一个小数点前
TiBrowser.isInit = false;

// 另，Angular官方键值调用方法：
// import {DOWN_ARROW, ENTER, ESCAPE, UP_ARROW, TAB} from '@angular/cdk/keycodes';
/* 使用键值请参考：
https://blog.csdn.net/q1054261752/article/details/50359617
http://www.runoob.com/try/try.php?filename=tryjsref_event_key_keycode2
https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent
事件顺序：onkeydown > onkeypress >onkeyup
早期标准：
keydown和keyup捕获具体物理按键，event.keyCode输出键值，可以区分主副键盘的具体按键；
keypress捕获按键经过处理后的字符，event.charCode输出ASCII字符编码，可以区分大小写字母，主副键盘相同符号取值相同。
event.which根据情况输出charCode（keypress时）或keyCode（keydown时）。
IE8只有keyCode属性，IE9起已支持which和charCode。
Chrome和IE等，在keypress时，keyCode也存放了charCode值。（是为了兼容只有keyCode属性的IE8）
FireFox，keypress只输出event.charCode，keydown只输出event.keycode；另一个值为0。
现今情况：
keyCode/charCode/which都已废弃，但keyCode依然是目前最好选择！（2018年4月，须兼容IE9）
未来情况：
keypress和keydown时，都可用event.key（"z"）和event.code("KeyZ")，是推荐标准，都是字符串可读性值。
IE9不支持event.code。
IE9的event.key是旧标准。小键盘符号支持很差：和大键盘取值不同，且keypress和keydown时取值不同。有时符号，有时符号名称。

综上：建议只使用keydow和keyup事件和event.keyCode键值，不使用keypress/which/charCode
很少有需求使用keypress，仅配合 event.charCode取出字符编码即可。
再配合'A'.charCodeAt(0)===event.charCode或者'A'===String.fromCharCode(event.charCode);
*/
/* HTML W3C标准键值查找类，已经屏蔽浏览器差异
 *
 * 参考文档：
 *
 * https://www.w3.org/TR/uievents/
 *
 * https://www.w3.org/TR/uievents-code/
 *
 * https://www.w3.org/TR/uievents-key
 *
 * https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code
 *
 * https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button
 *
 * https://github.com/kabirbaidhya/keycode-js  这份代码采用了Mac命名方式，比如回车键叫Return
 *
 * https://github.com/wesbos/keycodes/blob/gh-pages/scripts.js
 *
 * http://blog.csdn.net/joeblackzqq/article/details/46442121
 *
 * W3C规定了一些固定键值，其他键值可能随硬件（PC/Mac）、操作系统、浏览器而不同。
 *
 * 命名规范统一按照W3C名称，已涵盖标准101键盘，其他键盘暂未涵盖。
 *
 *  js中左右Ctrl、大小键盘Enter是同一键值，所以比windows编程环境的键值要少一些。
 *
 * 多余Mac键盘值已删除。
 *
 * 标点符号，因为Firefox与其他浏览器有三个不同，已做兼容性处理
 */
/**
 * KeyMap键值工具类，提高键值可读性，已经屏蔽浏览器差异
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/utils/keymap-basic" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiKeymap {
    /* Firefox符号键值有3个与其他浏览器不同
        Semicolon	";"	186 //Firefox 59
        Colon	":"	186 //Firefox 59
        Equals sign	"="	187 //Firefox 61
        Plus	"+"	187 //Firefox 61
        Minus	"-"	189  //Firefox 173
        Underscore	"_"	189 //Firefox 173
    */
    static initFirefox() {
        if (TiBrowser.isFirefox()) {
            TiKeymap.KEY_SEMICOLON = 59; // ";"
            TiKeymap.KEY_COLON = TiKeymap.KEY_SEMICOLON; // ":"
            TiKeymap.KEY_EQUALS_SIGN = 61; // "="
            TiKeymap.KEY_PLUS = TiKeymap.KEY_EQUALS_SIGN; // "+"
            TiKeymap.KEY_MINUS = 173; // "-"
            TiKeymap.KEY_UNDERSCORE = TiKeymap.KEY_MINUS; // "_"
        }
    }
}
/* 此部分为W3C规定的固定键值 start↓ */
/**
 * Mac称作Delete 【注意： Backspace 8/Delete 46（windows用后向删除）是两个不同键值。】
 */
TiKeymap.KEY_BACKSPACE = 8;
/**
 * Table键
 */
TiKeymap.KEY_TAB = 9;
/**
 * 回车键，数字小键盘回车也是13。 Mac称作Return。【注意：108是Mac数字小键盘Enter】
 */
TiKeymap.KEY_ENTER = 13;
/**
 * 左右Shift
 */
TiKeymap.KEY_SHIFT = 16;
/**
 * 左右Ctrl
 */
TiKeymap.KEY_CONTROL = 17;
/**
 * 左右Alt    Mac称作Option
 */
TiKeymap.KEY_ALT = 18;
/**
 * W3C未规定固定或者不固定，是PC（非Mac）独有
 */
TiKeymap.KEY_PAUSE_BREAK = 19;
/**
 * 大小写锁定
 */
TiKeymap.KEY_CAPS_LOCK = 20;
/**
 * 左上角Esc
 */
TiKeymap.KEY_ESCAPE = 27;
TiKeymap.KEY_SPACE = 32;
TiKeymap.KEY_PAGE_UP = 33;
TiKeymap.KEY_PAGE_DOWN = 34;
TiKeymap.KEY_END = 35;
TiKeymap.KEY_HOME = 36;
/**
 * 箭头方向键
 */
TiKeymap.KEY_ARROW_LEFT = 37;
TiKeymap.KEY_ARROW_UP = 38;
TiKeymap.KEY_ARROW_RIGHT = 39;
TiKeymap.KEY_ARROW_DOWN = 40;
/**
 * W3C未规定固定或非固定，是PC（非Mac）独有
 */
TiKeymap.KEY_PRINT_SCREEN = 44; // W3C未规定固定或非固定，是PC（非Mac）独有
/**
 * W3C未规定固定或非固定，是PC（非Mac）独有
 */
TiKeymap.KEY_INSERT = 45; // W3C未规定固定或非固定，是PC（非Mac）独有
/**
 * 后向删除
 */
TiKeymap.KEY_DELETE = 46;
TiKeymap.KEY_0 = 48;
TiKeymap.KEY_1 = 49;
TiKeymap.KEY_2 = 50;
TiKeymap.KEY_3 = 51;
TiKeymap.KEY_4 = 52;
TiKeymap.KEY_5 = 53;
TiKeymap.KEY_6 = 54;
TiKeymap.KEY_7 = 55;
TiKeymap.KEY_8 = 56;
TiKeymap.KEY_9 = 57;
TiKeymap.KEY_A = 65;
TiKeymap.KEY_B = 66;
TiKeymap.KEY_C = 67;
TiKeymap.KEY_D = 68;
TiKeymap.KEY_E = 69;
TiKeymap.KEY_F = 70;
TiKeymap.KEY_G = 71;
TiKeymap.KEY_H = 72;
TiKeymap.KEY_I = 73;
TiKeymap.KEY_J = 74;
TiKeymap.KEY_K = 75;
TiKeymap.KEY_L = 76;
TiKeymap.KEY_M = 77;
TiKeymap.KEY_N = 78;
TiKeymap.KEY_O = 79;
TiKeymap.KEY_P = 80;
TiKeymap.KEY_Q = 81;
TiKeymap.KEY_R = 82;
TiKeymap.KEY_S = 83;
TiKeymap.KEY_T = 84;
TiKeymap.KEY_U = 85;
TiKeymap.KEY_V = 86;
TiKeymap.KEY_W = 87;
TiKeymap.KEY_X = 88;
TiKeymap.KEY_Y = 89;
TiKeymap.KEY_Z = 90;
/* 此部分为W3C规定的固定键值 end↑ */
/**
 * "Windows Key Left/ Left Command⌘ (Mac)/ Chromebook Search key";
 */
TiKeymap.KEY_META_LEFT = 91;
/**
 * "Windows Key Right
 */
TiKeymap.KEY_META_RIGHT = 92;
/**
 *  "Windows Menu / Right Command⌘(Mac)";
 */
TiKeymap.KEY_CONTEXT_MENU = 93;
TiKeymap.KEY_NUMPAD_0 = 96;
TiKeymap.KEY_NUMPAD_1 = 97;
TiKeymap.KEY_NUMPAD_2 = 98;
TiKeymap.KEY_NUMPAD_3 = 99;
TiKeymap.KEY_NUMPAD_4 = 100;
TiKeymap.KEY_NUMPAD_5 = 101;
TiKeymap.KEY_NUMPAD_6 = 102;
TiKeymap.KEY_NUMPAD_7 = 103;
TiKeymap.KEY_NUMPAD_8 = 104;
TiKeymap.KEY_NUMPAD_9 = 105;
/**
 * 小键盘*
 */
TiKeymap.KEY_NUMPAD_MULTIPLY = 106;
/**
 * 小键盘+
 */
TiKeymap.KEY_NUMPAD_ADD = 107;
/**
 * Mac小键盘Enter。可能某些键盘除法符号。且这个键值可能在Firefox与其他浏览器不同。
 */
TiKeymap.KEY_NUMPAD_ENTER = 108;
/**
 * 小键盘-
 */
TiKeymap.KEY_NUMPAD_SUBTRACT = 109;
/**
 * 小键盘. (小数点)
 */
TiKeymap.KEY_NUMPAD_DECIMAL = 110;
/**
 * 小键盘/
 */
TiKeymap.KEY_NUMPAD_DIVIDE = 111;
TiKeymap.KEY_F1 = 112;
TiKeymap.KEY_F2 = 113;
TiKeymap.KEY_F3 = 114;
TiKeymap.KEY_F4 = 115;
TiKeymap.KEY_F5 = 116;
TiKeymap.KEY_F6 = 117;
TiKeymap.KEY_F7 = 118;
TiKeymap.KEY_F8 = 119;
TiKeymap.KEY_F9 = 120;
TiKeymap.KEY_F10 = 121;
TiKeymap.KEY_F11 = 122;
TiKeymap.KEY_F12 = 123;
TiKeymap.KEY_F13 = 124;
TiKeymap.KEY_F14 = 125;
TiKeymap.KEY_F15 = 126;
TiKeymap.KEY_F16 = 127;
TiKeymap.KEY_F17 = 128;
TiKeymap.KEY_F18 = 129;
TiKeymap.KEY_F19 = 130;
TiKeymap.KEY_F20 = 131;
TiKeymap.KEY_F21 = 132;
TiKeymap.KEY_F22 = 133;
TiKeymap.KEY_F23 = 134;
TiKeymap.KEY_F24 = 135;
/**
 * W3C未规定固定或不固定，是PC（非Mac）独有。  在Mac上这个键值给numpad_clear用了。
 */
TiKeymap.KEY_NUM_LOCK = 144;
/**
 * W3C未规定固定或不固定，是PC（非Mac）独有
 */
TiKeymap.KEY_SCROLL_LOCK = 145;
/* 下面是W3C符号美标键值，不固定。Firefox符号键值有3个与其他浏览器不同 */
/**
 * ";" Firefox键值是59，使用时已经屏蔽差异
 */
TiKeymap.KEY_SEMICOLON = 186;
/**
 * ":" Firefox键值是59，使用时已经屏蔽差异
 */
TiKeymap.KEY_COLON = TiKeymap.KEY_SEMICOLON;
/**
 * "=" Firefox键值是61，使用时已经屏蔽差异
 */
TiKeymap.KEY_EQUALS_SIGN = 187;
/**
 * "+" Firefox键值是61，使用时已经屏蔽差异
 */
TiKeymap.KEY_PLUS = TiKeymap.KEY_EQUALS_SIGN;
/**
 * "-" Firefox键值是173，使用时已经屏蔽差异
 */
TiKeymap.KEY_MINUS = 189;
/**
 * "_" Firefox键值是173，使用时已经屏蔽差异
 */
TiKeymap.KEY_UNDERSCORE = TiKeymap.KEY_MINUS;
// public static get KEY_SEMICOLON() { // ";"
//     if (BrowserInfo.isFirefox()) { return 59; }
//     return 186;
// }
// public static get KEY_COLON() { // ":"
//     return KeyMap.KEY_SEMICOLON;
// }
// public static get KEY_EQUALS_SIGN() { // "="
//     if (BrowserInfo.isFirefox()) { return 61; }
//     return 187;
// }
// public static get KEY_PLUS() { // "+"
//     return KeyMap.KEY_EQUALS_SIGN;
// }
// public static get KEY_MINUS() { // "-"
//     if (BrowserInfo.isFirefox()) { return 173; }
//     return 189;
// }
// public static get KEY_UNDERSCORE() { // "_"
//     return KeyMap.KEY_MINUS;
// }
/**
 * ","
 */
TiKeymap.KEY_COMMA = 188;
/**
 * "<"
 */
TiKeymap.KEY_LESS_THAN_SIGN = 188;
/**
 * "."
 */
TiKeymap.KEY_PERIOD = 190;
/**
 * ">"
 */
TiKeymap.KEY_GREATER_THAN_SIGN = 190;
/**
 * "/"
 */
TiKeymap.KEY_FORWARD_SLASH = 191;
/**
 * "?"
 */
TiKeymap.KEY_QUESTION_MARK = 191;
/**
 * "`"
 */
TiKeymap.KEY_BACKTICK = 192;
/**
 * "~"
 */
TiKeymap.KEY_TILDE = 192;
/**
 * "["
 */
TiKeymap.KEY_OPENING_SQUACE_BRACKET = 219;
/**
 * "{"
 */
TiKeymap.KEY_OPENING_CURLY_BRACE = 219;
/**
 * "\"
 */
TiKeymap.KEY_BACKSLASH = 220;
/**
 * "|"
 */
TiKeymap.KEY_PIPE = 220;
/**
 * "]"
 */
TiKeymap.KEY_CLOSING_SQUARE_BRACKET = 221;
/**
 * "}"
 */
TiKeymap.KEY_CLOSING_CURLY_BRACE = 221;
/**
 * "'"
 */
TiKeymap.KEY_SINGLE_QUOTE = 222;
/**
 * """
 */
TiKeymap.KEY_DOUBLE_QUOTE = 222;
/* 鼠标键值，前三个为W3C固定，命名暂时按照程序员习惯。 */
/**
 * 鼠标键值：primary button
 */
TiKeymap.MOUSE_LEFT_BUTTON = 0; // primary button
/**
 * 鼠标键值：auxiliary button  wheel button
 */
TiKeymap.MOUSE_MIDDLE_BUTTON = 1; // auxiliary button  wheel button
/**
 * 鼠标键值：secondary button
 */
TiKeymap.MOUSE_RIGHT_BUTTON = 2; // secondary button
/**
 * 鼠标键值：浏览器后退
 */
TiKeymap.MOUSE_BACK_BUTTON = 3; // 浏览器后退
/**
 * 鼠标键值：浏览器前进
 */
TiKeymap.MOUSE_FORWARD_BUTTON = 4; // 浏览器前进
/**
 * Typescript没有静态代码段，所以这样代替静态代码段
 */
TiKeymap.staticCode = TiKeymap.initFirefox();
// 因为Typescript没有类的静态代码段。所以对类的static变量初始化，写在这里。

/*
 * Logger工具类提供全局日志输出级别控制。
 *
 * 提供三个静态日志方法，log()/warn()/error()
 *
 * log()是调试期日志，产品时一定关闭。组件对打包对外提供时也关闭，不干扰用户开发。
 *
 * info()是产品期也可以输出的重要日志。暂不提供。
 *
 * warn()/error()产品期，可酌情打开。后期可以考虑，error日志回传给服务器。
 *
 */
/**
 * Logger工具类, 提供全局日志输出和级别控制。
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/utils/log-basic" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiLog {
    /**
     * 设置输出日志级别：LOG/WARN/ERROR/OFF. 默认是关闭
     */
    static setLevel(level) {
        TiLog.level = level;
    }
    /**
     *  一般的调试和运行信息
     * @param [message] 信息
     * @param optionalParams 参数
     */
    static log(message, ...optionalParams) {
        if (TiLog.LEVEL_LOG >= TiLog.level && console.log) {
            console.log(message, ...optionalParams);
        }
    }
    // public static info(message?: any, ...optionalParams: Array<any>): void {
    //     if (Logger.infoable && console.log) {
    //         // 在Chrome, console.info()只是log()的别名，tslint不建议使用。
    //         console.log(message, ...optionalParams);
    //     }
    // }
    /**
     *  会出现潜在错误的提示
     * @param [message] 信息
     * @param optionalParams 参数
     */
    static warn(message, ...optionalParams) {
        if (TiLog.LEVEL_WARN >= TiLog.level && console.warn) {
            console.warn(message, ...optionalParams);
        }
    }
    /**
     * 发生错误事件，已经影响系统的正常运行
     * @param [message] 信息
     * @param optionalParams 参数
     */
    static error(message, ...optionalParams) {
        if (TiLog.LEVEL_ERROR >= TiLog.level && console.error) {
            console.error(message, ...optionalParams);
        }
    }
}
/**
 * 可以输出Log以上日志，包含Log/Warn/Error，log表示一般的调试和运行信息。
 */
TiLog.LEVEL_LOG = 1;
/**
 * 可以输出Warn以上日志，包含Warn/Error日志，Warn表示会出现潜在错误的提示。
 */
TiLog.LEVEL_WARN = 2;
/**
 * 可以输出Error日志，Error表示发生错误事件，已经影响系统的正常运行。
 */
TiLog.LEVEL_ERROR = 3;
/**
 * 关闭输出所有日志
 */
TiLog.LEVEL_OFF = 10;
TiLog.level = TiLog.LEVEL_OFF;

/**
 * @ignore
 */
class TiDateUtil {
    /**
     * 日期类组件的默认最小值
     */
    static minDate() {
        return new Date(1970, 0, 1, 0, 0, 0);
    }
    /**
     * 日期类组件的默认最大值
     */
    static maxDate() {
        return new Date(2099, 11, 31, 23, 59, 59);
    }
    /**
     * 判断是不是合法的时间对象
     */
    static isDate(date) {
        // tslint:disable-next-line:triple-equals
        if (Object.prototype.toString.call(date) === '[object Date]' && String(date) !== 'Invalid Date') {
            return true;
        }
        return false;
    }
    /**
     * @description 最大值时分秒置为23:59:59。
     * 原因：date或者dateRange组件中，如果用户动态设置的value为最大年月日并带有时分秒，而设置的maxValue时分秒比较小时，
     * 校验该value是否小于或等于最大值时，会出错。
     * @param maxValue 最大值
     */
    static changeMaxTime(maxValue) {
        if (!TiDateUtil.isDate(maxValue)) {
            return TiDateUtil.maxDate();
        }
        return new Date(maxValue.getFullYear(), maxValue.getMonth(), maxValue.getDate(), 23, 59, 59);
    }
    /**
     * @description 最小值时分秒置为0:0:0。
     * 原因：date或者dateRange组件中，如果用户设置的minValue带有时分秒，这时动态更新value为最小值年月日并时分秒为很小时，会出错。
     * @param minValue 最小值
     * @returns Date
     */
    static changeMinTime(minValue) {
        if (!TiDateUtil.isDate(minValue)) {
            return TiDateUtil.minDate();
        }
        return new Date(minValue.getFullYear(), minValue.getMonth(), minValue.getDate(), 0, 0, 0);
    }
    /**
     * @description 判断两个日期是不是相等：只包括年月日
     * @param newValue 新值
     * @param oldValue 旧值
     */
    static isDateEqual(newValue, oldValue) {
        if (newValue === oldValue) {
            return true;
        }
        // 当两个value都是Date类型时，要判断两个值的年月日是否相等，直接用‘===’判断不准确
        if (TiDateUtil.isDate(newValue) && TiDateUtil.isDate(oldValue)) {
            // 转换成年月日，然后重新生成一个Date，再将其转换成毫秒数进行判断
            const newDate = new Date(newValue.getFullYear(), newValue.getMonth(), newValue.getDate());
            const oldDate = new Date(oldValue.getFullYear(), oldValue.getMonth(), oldValue.getDate());
            if (newDate.getTime() === oldDate.getTime()) {
                return true;
            }
        }
        return false;
    }
    /**
     * @description 判断两个时间日期是不是相等；
     * @param newValue 新值
     * @param oldValue 旧值
     */
    static isDatetimeEqual(newValue, oldValue) {
        if (newValue === oldValue) {
            return true;
        }
        if (TiDateUtil.isDate(newValue) && TiDateUtil.isDate(oldValue)) {
            if (newValue.getTime() === oldValue.getTime()) {
                return true;
            }
        }
        return false;
    }
    /**
     * @description 判断是不是合法的NowDateTime值
     * 存在nowDateTime值，并且是时间对象，且大于最小值小于最大值
     */
    static isValidNowDateTime(nowDateTime, min, max) {
        return nowDateTime && TiDateUtil.isDate(nowDateTime) &&
            (nowDateTime.getTime() >= min.getTime()) &&
            (nowDateTime.getTime() <= max.getTime());
    }
    /**
     * @description 判断value1是否大于value2
     */
    static isBigger(value1, value2) {
        return value1.getTime() > value2.getTime();
    }
    /**
     * @description 判断value1是否大于value2
     */
    static isBiggerOrEqual(value1, value2) {
        return value1.getTime() >= value2.getTime();
    }
    /**
     * @description 判断value1是否小于value2
     */
    static isSmaller(value1, value2) {
        return value1.getTime() < value2.getTime();
    }
    /**
     * @description 将Date类型的日期转换成年月日字符串
     * @param date 要进行转换的日期值
     */
    static getDateStr(date) {
        return `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
    }
    /**
     * @description 将Date类型的日期转换成时分秒字符串
     * @param date 要进行转换的日期值
     */
    static getTimeStr(date) {
        const hour = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();
        const minute = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();
        const second = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();
        return `${hour}:${minute}:${second}`;
    }
    /**
     * @description 判断是不是一个合法的最大值
     * @param min 最小值
     * @param max 最大值
     */
    static isValidMaxValue(min, max) {
        return TiDateUtil.isDate(max) && (max.getTime() >= min.getTime());
    }
    /**
     * @description 判断是不是一个合法的最小值
     * @param min 最小值
     * @param max 最大值
     */
    static isValidMinValue(min, max) {
        return TiDateUtil.isDate(min) && (max.getTime() >= min.getTime());
    }
    /**
     * @description 是否在最大值最小值区间
     * @param min 最小值
     * @param max 最大值
     */
    static isBetweenMaxAndmin(value, min, max) {
        return (value.getTime() >= min.getTime()) && (value.getTime() <= max.getTime());
    }
    /**
     * @description  12小时制添加AMPM
     */
    static addAmPm(timeFormat) {
        if (timeFormat.match(/h/) && !timeFormat.match(/a/)) { // 已设置ampm格式情况下，不做处理
            return timeFormat + ' a'; // Angular 的datePipe 设置时间时，"a"代表AMPM
        }
        return timeFormat;
    }
    /**
     * @description: 若时间字符串没有一个冒号时处理成合法的事件字符串（加冒号）
     * @param value 时间字符串
     */
    static addColon(value) {
        if (value.match(/:/)) {
            return value;
        }
        const ampm = value.match(/am|AM|pm|PM/) || '';
        return `${parseInt(value, 10)}: ${ampm}`;
    }
}

/**
 * 主题工具类
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/theme/theme-basic" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiTheme {
    /**
     * 加载CSS文件，挂在head link
     * @param cssPath css路径
     * @param id link id
     */
    static loadCss(cssPath, id) {
        let link = document.getElementById(id);
        // 原本没有link，那么创建link
        if (!link) {
            link = document.createElement('link');
            document.head.appendChild(link);
        }
        // 如果link href没变，那么就不处理了。
        if (link.href === cssPath) {
            return;
        }
        link.href = cssPath;
        link.id = id;
        link.rel = 'stylesheet';
        link.type = 'text/css';
        // 被CSSVar补丁处理后，补丁会给link打上disabled。去除disabled，才能再次补丁生效。
        if (link.hasAttribute('disabled')) {
            link.removeAttribute('disabled');
        }
        return link;
    }
    /**
     * 检测浏览器是否原生支持CSSVar
     * @returns 是否支持CSSVar
     */
    static isNativeSupportCssVar() {
        const isBrowser = typeof window !== 'undefined';
        const isNativeSupport = isBrowser && window.CSS && window.CSS.supports && window.CSS.supports('(--a: 0)');
        return isNativeSupport;
    }
    /**
     * 启动AppModule
     * @param app 传入的AppModule
     */
    static bootstrapModule(app) {
        platformBrowserDynamic()
            .bootstrapModule(app)
            .catch((err) => console.error(err));
    }
}

// TODO:未来看typescript如何继承Map
/**
 * @ignore
 */
class ObservableMap {
    constructor() {
        // 代理模式
        this.map = new Map();
        // 观察者模式
        this.handlerSet = new Set();
        this.map = new Map();
    }
    get size() {
        return this.map.size;
    }
    addObserver(handlerFn) {
        this.handlerSet.add(handlerFn);
    }
    removeObserver(handlerFn) {
        this.handlerSet.delete(handlerFn);
    }
    // 通知函数，不会通知到发起源
    notify(key, value, add, from) {
        this.handlerSet.forEach((handlerFn) => {
            handlerFn(key, value, add, from);
        });
    }
    //  设置，可以添加发起源，那么消息不会通知到发起源。
    set(key, value, from) {
        if (!this.map.has(key) || (this.map.has(key) && this.map.get(key) !== value)) {
            this.map.set(key, value);
            this.notify(key, value, true, from);
        }
        return this;
    }
    //  删除，可以添加发起源，那么消息不会通知到发起源。
    delete(key, from) {
        if (this.map.has(key)) {
            this.map.delete(key);
            this.notify(key, undefined, false, from);
            return true;
        }
        return false;
    }
    has(key) {
        return this.map.has(key);
    }
    get(key) {
        return this.map.get(key);
    }
    getMap() {
        return this.map;
    }
}

// TODO:未来看typescript如何继承Set
/**
 * @ignore
 */
class ObservableSet {
    constructor(items) {
        // 代理模式
        this.set = new Set();
        // 观察者模式
        this.handlerSet = new Set();
        this.set = new Set(items);
    }
    get size() {
        return this.set.size;
    }
    addObserver(handlerFn) {
        this.handlerSet.add(handlerFn);
    }
    removeObserver(handlerFn) {
        this.handlerSet.delete(handlerFn);
    }
    notify(item, isAdd) {
        this.handlerSet.forEach((handlerFn) => {
            handlerFn(item, isAdd);
        });
    }
    add(item) {
        if (!this.set.has(item)) {
            this.set.add(item);
            this.notify(item, true);
        }
        return this;
    }
    delete(item) {
        if (this.set.has(item)) {
            this.set.delete(item);
            this.notify(item, false);
            return true;
        }
        return false;
    }
    has(item) {
        return this.set.has(item);
    }
}

/**
 * @ignore
 * 工具类
 */
class Util {
    /**
     * 获得一个唯一标示
     * @param prefix 前缀
     * @returns 唯一标示字符串
     */
    static getUniqueId(prefix) {
        Util.idCounter++;
        const id = `${prefix}_${Util.idCounter}`;
        return id;
    }
    // TODO: 是否可以去除？
    /**
     * 是否未定义
     * @param value 值
     * @returns 是否
     */
    static isUndefined(value) {
        return value === undefined;
    }
    // TODO: 是否可以去除？
    /**
     * 是否空
     * @param value 值
     * @returns 是否
     */
    static isNull(value) {
        return value === null;
    }
    // TODO: 是否可以去除？
    /**
     * 是否String
     * @param value 值
     * @returns 是否
     */
    static isString(value) {
        return typeof value === 'string';
    }
    // TODO: 是否可以去除？
    /**
     * 是否Number
     * @param value 值
     * @returns 是否
     */
    static isNumber(value) {
        return typeof value === 'number' && !isNaN(value);
    }
    /**
     * 是否空字符串
     * @param value 值
     * @returns 是否
     */
    static isEmptyString(value) {
        return value === undefined || value === null || value === '';
    }
    // TODO: 是否可以去除
    /**
     * 是否Array
     * @param value 值
     * @returns 是否
     */
    static isArray(value) {
        return Array.isArray(value);
    }
    // TODO: 是否可以去除
    /**
     * 是否函数
     * @param value 值
     * @returns 是否
     */
    static isFunction(value) {
        return typeof value === 'function';
    }
    /**
     * 使用固定参数值格式化填充字串
     * @param source 源字串,其中使用{N}代表需要匹配的参数次序,N从0开始
     * @param params Array 参数数组
     */
    static formatEntry(source, params) {
        let formatSource = source;
        if (!this.isArray(params) || formatSource === '') {
            return formatSource;
        }
        params.forEach((param, i) => {
            formatSource = formatSource.replace(new RegExp(`\\{${i}\\}`, 'g'), () => {
                return param;
            });
        });
        return formatSource;
    }
    /**
     * 发出一个HTML事件
     * @param: ele 触发事件的DOM
     * @param: eventName 事件名称
     * @param: [canBubble] 是否冒泡，可选参数默认不冒泡 false
     */
    static trigger(ele, eventName, canBubble) {
        // 修复SSR错误：ERROR ReferenceError: document is not defined
        if (typeof document === 'undefined') {
            return;
        }
        const event = document.createEvent('HTMLEvents');
        event.initEvent(eventName, canBubble || false, true);
        // event.initEvent(eventType,canBubble,cancelable)
        ele.dispatchEvent(event);
    }
    /**
     * 判断是否为dom元素
     */
    static isElement(ele) {
        if (ele && ele.nodeType) {
            return ele.nodeType === 1;
        }
        else {
            return false;
        }
    }
    /**
     * 判断是否支持CSS Var
     */
    static supportsCssVars() {
        return typeof (window) !== 'undefined' && window.CSS && window.CSS.supports && window.CSS.supports('(--a: 0)');
    }
    /**
     * 通过tab键在弹窗内切换的时候，焦点需要一直在弹窗内部循环。
     */
    static focusInDialogOnTabchange(event, focusableElements) {
        if (!focusableElements || focusableElements.length === 0) {
            return;
        }
        const firstFocusableEle = focusableElements[0];
        const lastFocusableEle = focusableElements[focusableElements.length - 1];
        const target = event.target; // 获得触发事件的元素
        // 按下tab+shift键时，如果当前已获取焦点元素是弹出框中的第一个可获取焦点元素，则聚焦最后一个元素
        if (event.shiftKey) {
            if (target === firstFocusableEle) {
                lastFocusableEle.focus();
                event.preventDefault(); // 阻止默认事件，确保此处手动focus生效
            }
        }
        else if (target === lastFocusableEle) { // 按下tab键时，如当前已获取焦点元素是最后一个可获取焦点元素，则聚焦第一个元素
            firstFocusableEle.focus();
            event.preventDefault(); // 阻止默认事件，确保此处手动focus生效
        }
    }
}
// Generate a unique integer id (unique within the entire client session).
// Useful for temporary DOM ids.
Util.idCounter = 0;

/**
 * TiCollapseDirective指令主要功能为动态控制某一DOM节点的显示(展开)与隐藏(收起)
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)
 * 中引入BrowserAnimationsModule。</span>这是因为此组件中使用了Angular动画，需要引入BrowserAnimationsModule，
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/collapse/collapse-all</example-url>
 */
class TiCollapseDirective {
    constructor(elementRef, renderer, builder) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.builder = builder;
        /**
         * 控制折叠面板的收起/展开
         */
        this.isCollapse = true; // 是否收起
        /**
         * 折叠面板在收起/展开结束后(即收起/展开动画结束后)的回调；
         * 回调的参数为布尔值，true: 收起结束后, false: 展开结束后
         */
        this.toggleDone = new EventEmitter();
        this.element = this.elementRef.nativeElement;
    }
    ngOnInit() {
        if (!TiBrowser.isIE() || TiBrowser.version() > 9) {
            // 创建展开时动效的实例
            this.expandPlayer = this.builder.build([
                style({ 'max-height': '0px', overflow: 'hidden' }),
                animate(TiCollapseDirective.ANIMATE_IN, style({ 'max-height': '2999px', overflow: 'visible' }))
            ])
                .create(this.element);
            // 创建收起时动效的实例
            this.collapsePlayer = this.builder.build([
                style({ 'max-height': '2999px', overflow: 'visible' }),
                animate(TiCollapseDirective.ANIMATE_OUT, style({ 'max-height': '0px', overflow: 'hidden' }))
            ])
                .create(this.element);
            // 初始没有动画效果
            if (this.isCollapse) {
                this.collapsePlayer.finish();
            }
            else {
                this.expandPlayer.finish();
            }
        }
        if (this.isCollapse) {
            this.collapse();
        }
        else {
            this.expand();
        }
    }
    ngOnChanges(changes) {
        const isCollapseObj = changes['isCollapse'];
        if (!isCollapseObj || isCollapseObj.firstChange) {
            return;
        }
        if (TiBrowser.isIE() && (TiBrowser.version() === 9)) {
            if (isCollapseObj.currentValue) {
                this.collapse();
            }
            else {
                this.expand();
            }
            this.toggleDone.emit(isCollapseObj.currentValue);
            return;
        }
        if (isCollapseObj.currentValue) {
            // 执行收起动画前一定要重置展开动画，否则会影响收起动画
            this.expandPlayer.reset();
            // 执行收起动画
            this.collapsePlayer.play();
            // 收起动画结束后，设置元素display:none
            this.collapsePlayer.onDone(() => {
                // 设置元素display:none必须在收起动画结束后，否则没有动画效果
                this.collapse();
                this.toggleDone.emit(true);
            });
        }
        else {
            // 执行展开动画前一定要重置收起动画，否则会影响展开动画
            this.collapsePlayer.reset();
            // 设置元素display:block
            this.expand();
            // 执行展开动画
            this.expandPlayer.play();
            this.expandPlayer.onDone(() => {
                this.toggleDone.emit(false);
            });
        }
    }
    expand() {
        this.renderer.setStyle(this.element, 'display', 'block');
    }
    collapse() {
        this.renderer.setStyle(this.element, 'display', 'none');
    }
}
TiCollapseDirective.ANIMATE_IN = '600ms cubic-bezier(0.755, 0.05, 0.855, 0.06)'; // easeInQuint
TiCollapseDirective.ANIMATE_OUT = '600ms cubic-bezier(0.23, 1, 0.32, 1)'; // easeOutQuint
TiCollapseDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiCollapse]'
            },] }
];
TiCollapseDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: AnimationBuilder }
];
TiCollapseDirective.propDecorators = {
    isCollapse: [{ type: Input, args: ['tiCollapse',] }],
    toggleDone: [{ type: Output }]
};

class TiCollapseModule {
}
TiCollapseModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiCollapseDirective],
                declarations: [TiCollapseDirective]
            },] }
];

/**
 * @ignore
 * 点击需要和聚焦区分开。当点击的时候，不需要有outline。
 * 10.1.4新增
 */
class TiOutlineDirective {
    constructor(renderer, hostEle, zone) {
        this.renderer = renderer;
        this.hostEle = hostEle;
        this.zone = zone;
    }
    ngAfterViewInit() {
        this.zone.runOutsideAngular(() => {
            const outlineHostEle = this.hostEle.nativeElement;
            if (outlineHostEle) {
                this.renderer.listen(outlineHostEle, 'mousedown', () => {
                    this.renderer.setStyle(outlineHostEle, 'outline', 'none');
                });
                this.renderer.listen(outlineHostEle, 'blur', () => {
                    this.renderer.setStyle(outlineHostEle, 'outline', '');
                });
            }
        });
    }
}
TiOutlineDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiOutline]'
            },] }
];
TiOutlineDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];

class TiOutlineModule {
}
TiOutlineModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiOutlineDirective],
                declarations: [TiOutlineDirective]
            },] }
];

/**
 * @ignore
 * ti-icon组件，为了防止多个组件重复使用字体图标文件，导致最终用户打包文件成倍增大，因此封装该组件，确保最终打包只引用一份字体图标样式及文件
 * TODO：考虑逐步去除这个i封装组件，采用ti-icon封装
 */
class TiIconClassComponent {
    constructor(hostRef) {
        this.hostRef = hostRef;
        this.nativeElement = this.hostRef.nativeElement;
    }
}
TiIconClassComponent.decorators = [
    { type: Component, args: [{
                selector: ':not(ti-icon).ti3-icon',
                template: '<ng-content></ng-content>',
                encapsulation: ViewEncapsulation.None,
                styles: ["@font-face{font-family:ti3Font;font-style:normal;font-weight:400;src:url(\"data:font/woff;base64,d09GRgABAAAAACHgAAsAAAAAIZQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIGSWNtYXAAAAFoAAAAVAAAAFQXVtK7Z2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAHKAAABygirn4gGhlYWQAAB5kAAAANgAAADYcHVghaGhlYQAAHpwAAAAkAAAAJAfDA/pobXR4AAAewAAAAOQAAADk14EPnGxvY2EAAB+kAAAAdAAAAHS1mryIbWF4cAAAIBgAAAAgAAAAIABCALpuYW1lAAAgOAAAAYYAAAGGttZRwHBvc3QAACHAAAAAIAAAACAAAwAAAAMD6wGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA6TQDwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADgAAAAKAAgAAgACAAEAIOk0//3//wAAAAAAIOkA//3//wAB/+MXBAADAAEAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQBG//gDvgOIAEkAAAEHIgYVFBYzNzI2PwE2JicmBg8BLgEnJgcOAQcGBwYXHgEXFhcWNz4BNzY3NiYnJgYHBgcOAQcGJyYnLgEnJjc2Nz4BNzYXHgEXAwYqFR0fFZUUHAIPAhsWFSACBDB4RF5aWZIyMxARFRVmTU1eU09PiDU1HggSExQnCBcpKWo+PkBJPDxPERANDScnckVGSjVeJgLGAR8VFR0DGxOgFSECAhsWJi08DBEVFmZMTV9eWVqSMjMQDw8OTT08TRMnCAgSEzwvLzwLDAwNJydyRUZKSTw8TxEQDQkwJAAAAAAB//4AaAQCAxgABgAAAScJAQcBNwQCfP48/rd7AcR8Ap56/kMBQ3n+Q3kAAAEAAP/AA/gDtwAVAAAJARYGBw4BIyEiJjU0NjcBPgEXHgEXAj4Bug0QGggQCfyMHSkEBAG6DjcaCQ8FA5n8lBs7DgUEKx8JEggDbBsSDwUPCgAAAAMAAP/ABAADwAAcADgATQAAExQXHgEXFjMyNz4BNzY1NCcuAScmIyIHDgEHBhUjNDc+ATc2MzIXHgEXFhUUBw4BBwYjIicuAScmJTMyFCsBFRQiPQEjIjQ7ATU0Mh0BWiEhc01NV1dNTXMhISEhc01NV1dNTXMhIVooKYtdXWpqXV6LKCgoKYtdXWpqXV6LKCgCLZMtLZNaky0tk1oBwFdNTXMhISEhc01NV1dNTXMhISEhc01NV2pdXosoKCgpi11dampdXosoKCgpi11dl1qTLS2TWpMtLZMAAAACAZcAFQJpA2sAAwAHAAABIzUzAyMDMwJZq6sSjCTSAsCr/KoCAAAAAQBnACcDmQNZACAAAAkBFhQHBiInCQEGIicmNDcJASY0NzYyFwkBNjIXFhQHAQJYAUESEhMzEv6//r8SMxMSEgFB/r8SEhMzEgFBAUESMxMSEv6/AcD+vxIzExISAUH+vxISEzMSAUEBQRIzExIS/r8BQRISEzMS/r8AAAMAAP/ABAADwAAbAB8AIwAAASIHDgEHBhUUFx4BFxYzMjc+ATc2NTQnLgEnJgMzFSMTIwMzAgBqXV6LKCgoKIteXWpqXV6LKCgoKIteXZldXVZNCF0DwCgoi15dampdXosoKCgoi15dampdXosoKP7/XP5HAXwAAAMABQAcA/gDeAAXABsAHwAAJSYnJgInJicmIgcGBwYCBwYHBhYzIT4BJSM1MzUjAzMD+AdDRKBGRg0SQREKREWgRUULDx0jA40iJf4cTExMC2JzDXJzARF2dxUdHQ90df7udXYSGzoCNUFNPgFmAAADAAD/wAQAA8AAGwAfACMAAAEiBw4BBwYVFBceARcWMzI3PgE3NjU0Jy4BJyYDIzUzNSMDMwIAal1diykoKCmLXV1qal1diykoKCmLXV1JTU1NCmIDwCgpi11dampdXYspKCgpi11dampdXYspKP0ITDsBZwAAAAACAAD/wAQAA8AAGwAhAAABIgcOAQcGFRQXHgEXFjMyNz4BNzY1NCcuAScmAyc3FwEXAgBqXV2LKSgoKYtdXWpqXV2LKSgoKYtdXaT5RrMBJ0YDwCgpi11dampdXYspKCgpi11dampdXYspKP0N+UezASZGAAgAIv/dA+IDowAhADcAOwA/AEMARwBLAE8AAAEzMhYVERQGIyEiJjURNDY7ATU0NjMyFh0BITU0NjMyFhUdARQGIyImPQEhFRQGIyImPQEjESERBTMVIzczFSM3MxUjBTMVIzczFSM3MxUjAwGgHSMjHPzAHSMjHKAcGBgbAUAbGBgOGxgYG/7AGxgYD4ADAP2Bf3+/gH+/gH/+gH9/v4B/v4B/Az0jHf0gHSMjHQLgHSMzEyAbGDMzEyAgE5MNEyAbGA0NEyAZFBP9YAKgoICAgICAgICAgICAAAABATQAPwLMAzEAFgAACQE2MhcWFAcJARYUBw4BIyImJwEmNDcBNAFKEC4QEBD+3QEjEBAIFAsLFAj+thAQAecBShAQEC4Q/t3+3RAuEAgICAgBShAuEAAAAQE0AD8CzAMxABYAAAkBJiIHBhQXCQEGFBceATMyNjcBNjQnAsz+thAuEBAQASP+3RAQCBQLCxQIAUoQEAHnAUoQEBAuEP7d/t0QLhAICAgIAUoQLhAAAAQAB//ZA/kDpwApAI4AqwC3AAABNS4BJy4BNycOASMiJicHFgYHDgEHFR4BFx4BBxc+ATMyFhc3JjY3PgE3PgEzMhYVMBQxFAYHDgEjIgYHBhQXFgYPAQYmJy4BIyIGBw4BLwEuATc2NCcuASMiJj0BNDYzMjY3NjQnJjY/ATYWFx4BMzI2Nz4BHwEeAQcGFBceATMyFh0BFAYHDgEjIiY9AQUiJy4BJyY1NDc+ATc2MzIXHgEXFhUUBw4BBwYjNTI2NTQmIyIGFRQWA58rSBcWCQ1nHVItLVIdZw0JFhdIKytIFxYJDWcdUi0tUh1nDQkWF0grCxYMEhsHBgcQCSA5EBAQCQkQrRAkCRA4ISE4EAkkEK0QCQkQEBA5IBIbGxIgORAQEAkJEK0QJAkQOCEhOBAJJBCtEAkJEBAQOSASGwcGBxAJExr+YiomJTgQEBAQOCUmKiomJTgQEBAQOCUmKjBDQzAwQ0MBhHgJNCcnWSo7ICUlIDsqWScnNAl4CTQnJ1kqOyAlJSA7KlknJzQJAwIaEgEJEAYGByAdHEEcECQJZAkKEBshIRsQCglkCSQQHEEcHSAaEsgSGiAdHEEcECQJZAkKEBshIRsQCglkCSQQHEEcHSAaEsgJEAYGBxoSKJEQEDglJioqJiU4EBAQEDglJioqJiU4EBBaQzAwQ0MwMEMAAAADAAD/wAQAA8AADwAfACQAACURNCYjISIGFREUFjMhMjYDMhYVERQGIyEiJjURNDYzEzUhFSEEAF1D/UBDXV1DAsBDXaAdKSkd/UAdKSkdYAIA/gBgAsBDXV1D/UBDXV0DSSkd/UAdKSkdAsAdKf4nZmAAAAIAAP/ABAEDwAAFAAkAAAEnCQEHAQMzESMEAQj+B/4CAgIAJ09PAcBa/hUB61r+AAQA/X8AAAAAAgAA/8AD/wPAAAUACQAAAQcJARcBJSEVIQH/WgHr/hVaAgD8AQKB/X8DwAj+CP4CAgIAJ04AAAABABIA0APuArAAEwAAJRYyNzY0JwEmIgcBBhQXFjI3CQEDmBIyEhIS/j0SMhL+PRISEjISAZgBmNAQEBAtEAGTEBD+bRAtEBAQAW3+kwAAAAEAEgDQA+4CsAATAAABNjIXFhQHAQYiJwEmNDc2MhcJAQOYEjISEhL+PRIyEv49EhISMhIBmAGYArAQEBAtEP5tEBABkxAtEBAQ/pMBbQAAAgAA/9MD7QPAACMAPwAAJRcWFAcGIi8BDgEjIicuAScmNTQ3PgE3NjMyFx4BFxYVFAYHBTI3PgE3NjU0Jy4BJyYjIgcOAQcGFRQXHgEXFgM/rhMTFDYUrTqNTl9UVH0lJCQlfVRUX2BUVH0lJDEr/o5KQUFgHBwcHGBBQUpJQUFhHBwcHGFBQd6tFDYUExOuKzEkJX1UVGBfVFR9JSQkJX1UVF9OjTpPHBxgQUFKSUFBYRwcHBxhQUFJSkFBYBwcAAAAAAEAPgBnA8IDGQAFAAAlATcXARcBm/6jY/oB1FNnAYdh5QGvTAAAAAACAZ0AFQJjA2sAAwAHAAAlIzUzJyMDMwJatLQfeyPGFbSHAhsAAAAAAgCrABUDVQNrABwAKAAAASIHDgEHBhUUFx4BFxYxMDc+ATc2NTQnLgEnJiMRIiY1NDYzMhYVFAYCAEY/PlwbGzU1gDY1NTaANTUbG1w+P0Y6V1c6OldXA2sbG10+PkdGWVmcNjY2NpxZWUZHPj5dGxv+GVg5OldXOjlYAAQAMQBZA9gDMwAOAB0ALABAAAABIiY1NDYzITIWFRQGIyERIiY1NDYzITIWFRQGIyERIiY1NDYzITIWFRQGIyEnETQ2MzIWFREUBi8BLgE3PgEfAQHeExobGAHAFCAcGP46ExobGAHAFCAcGP46EyAbGAHAEyAbGP5A7RsYGA87GMAPAQkTLA5zAowgExQgHBgYG/8AIBMUIBwYEyD/ABsYGBwcGBgbYAITFCAgFP2AIRgTrQ4qDg8GDmcAAgB0ACADmgNgACQAPQAAASMiBh0BMzU0NjsBMhYVERQGKwEiJj0BIxUUFjsBMjY1ETQmIwEhNSE3NjQnJiIPAQYUHwEeATMyNjc2NCcDGsA0TGASDsAPEREPwA4SYEw0wDVLSzX97QHT/jotDg4PKQ+GDg6GChMKCRIFDg4DYEU1eXkKEBAK/a0JEBAJenMwSkU1Akw1Rf4tZi0OKg4PD4wPKQ+GBQgIBQ4qDgAAAAABAQAAWgMAAyYAAgAACQERAQACAAHAAWb9NAAAAgAA/8AEAAPAABsAOwAAASIHDgEHBhUUFx4BFxYzMjc+ATc2NTQnLgEnJhMWFAcGIi8BBwYiJyY0PwEnJjQ3NjIfATc2MhcWFA8BAgBqXV6LKCgoKIteXWpqXV6KKSgoKIteXYMJCQkZCMPDCRkICQnCwgkJCRkIw8MIGggJCcIDwCgoi15dampdXYspKCgpi11dampdXosoKP09CBkJCQnCwgkJCRkIw8MIGQkJCcLCCQkJGAnDAAEAFABkAswDHAAgAAA3CQEWMjc2NCcJATY0JyYiBwkBJiIHBhQXCQEGFBcWMjdTAR0BHQ0lDQ0N/uMBHQ0NDSUN/uP+4w0lDQ0NAR7+4g0NDSUNZAEd/uMNDQ0lDQEdAR4NJA0NDf7jAR0NDQ0lDf7j/uMNJQ0NDQAAAAAGAED/wAPAA8AADQARACAAJAAoACwAAAEhIgYVERQWMyEyNjURJRcjNRMhIiY1ETQ2MyERIREUBgEhFSERIRUhESEVIQKt/fMoODgoAsAoOP8Ak5Og/UANExMNAeABABP9kwIA/gACAP4AAQD/AAPAOCj8wCg4OCgCjaaTk/ytEw0DQA0T/wD9oA0TAUBAAQBAAQBAAAAAAAMAIAAQA+MDcAASAB0AKQAAASEnISIGFREUFjMhMjY1ES4BIxMUBiMhIiY1ESERESE1NDY7ARchMhYVA4P+XVb+8yc2NicDCSc2AjcnHREM/PoMEQNA/MARDPBTAcMMEQL2ejYn/VonNjYnAi0mNv13DBERDAGT/m0B09MMEXoQDAAAAAQAAP/ABAADwAAPAB8AJAApAAAlETQmIyEiBhURFBYzITI2AzIWFREUBiMhIiY1ETQ2MwEjETMRJTUhFSEEAF1D/UBDXV1DAsBDXaAdKSkd/UAdKSkdAZNmYP7TAgD+AGACwENdXUP9QENdXQNJKR39QB0pKR0CwB0p/VoCAP4AzWZgAAEAGv/aA+YDpgAgAAABETQ2MzIWFREhMhYVFAYjIREUBiMiJjURISImNTQ2MyEBxCMZGSMBbxgjIxj+kSMZGSP+kRgjIxgBbwH8AW8YIyMY/pEjGRkj/pEYIyMYAW8jGRkjAAABAAABgQQAAf8ADgAAEyImNTQ2MyEyFhUUBiMhPxolJRoDgholJRr8fgGBJRoaJSUaGiUABgAA/8AEAAPAAA0AFAAjACcARwBOAAABMTM3Jy4BIyIGFR4BMwc3IxEzEQc3MTI2NTQmIzEiBgcxBxcBESERAyMRIREjNTMuATU0NjMyFhc5Ahc3PgEzMhYVFAYHMw8BJxEzESMBijMLJAgQDBMWBBQbJB9Imlz7HhAaDwgTBCkK/cMEAM0p/ewpQgcDRTYfOA8VFBQ0HzZKBwNHmR9SmkgCWg8uCAcUDxQVcST+zQEubL4ZEA8aCAguFAFm/AAEAP5N/oABgE0HFgwuQhsTGRkXF0IuDBILcU1h/t0BMwABAPkAxAMHArwADwAAARcnBxcHFzcXNyc3Jwc3IwHYCc4a1I8/g4M/j9QazQhQArzgTkw/qjG2tjGqP0xO4AAAAQDSAI0DLgLzACAAAAEXFgYHBiYvAQcOAScuAT8BJyY2NzYWHwE3PgEXHgEPAQJC7A0BDg4mDurqDiYODgEN7OwNAQ4OJg7q6g4mDg4BDewBwPEOJg4OAQ3w8A0BDg4mDvHxDiYODgEN8PANAQ4OJg7xAAABAFUAWgOrAyYABwAAASURJRUJARUCVQFW/qr+AAIAAjfv/Tzn7wFmAWbvAAIAAP/ABAADwAAbACEAAAEiBw4BBwYVFBceARcWMzI3PgE3NjU0Jy4BJyYDEyMBAzMCAGpdXYspKCgpi11dampdXYspKCgpi11d1zqgAUA6oAPAKCmLXV1qal1diykoKCmLXV1qal1diyko/MABDQFz/vMABwAA/8AEAAPAAAIAIwAxADgARwBPAFIAAAE5AQU+ATUmJy4BJyYjIgYPAScuASMiBhUUFhcjFTMRIREzNSUyFhcxFwcjIiY1PgEzEyERMwcXNzcxPgEzMTIWFRQGIzEjJxMhERc3JzMRATkBAdUBvAYLAxITOycnLTNeGSMiGV4zWnMLBm9EA4A8/SsMIAdEEVUzIwckGpH/AG8rIprVDRkNICUYLVUi9/8AkSszb/7eA3OzDSQTJyIiMw8PLSAqKiAtb00THhOA/YACgICADQ1MGiQgGiL9AAIAPICz7w0NJCAgHBr9ZgHmooA8/gADMwAAAAMAA//nApkDmQANABwAKwAAATQ2MzIWFREUBiMiJjUBNDYzMhYVERQGIyImNREhNDYzMhYVERQGIyImNREBFyAXFyAgFxcg/uwgFxcgIBcXIAIoIBcXICAXFyADYxYgIBb8uhYgIBYC+hYfHxb9UhYfHxYCrhYfHxb9UhYfHxYCrgAAAAIARwASA6EDcgAYACUAACUUFjclPgE1ETc2NCcuASMhIgYVFBYfAQM3ETQmLwEhBw4BFREHAUcvGAEADgv6GBgKHRP9LSIrCgn0B2AIBeYCjecJCqA/HRoKgAUZDwEt+RhDGAoQMB0OHQ76/k1NAXMJEgXt7QUSCf7gUwABAQAAWgMAAyYAAgAAJREBAQACAFoCzP6aAAAAAQBVAFoDqwMmAAcAAAkCNQURBTUBqwIA/gD+qgFWAyb+mv6a7+8CzO/vAAADADv/0AO7A5oABQAdACwAAAkBBzcBJzcXFhQHAQ4BDwEGJicmND8BPgE3ATYyFwEhMhYVFAYjISImNTQ2MwLw/iEsogHfdjeHFxf+FgcRCrseOAgDAjQCCwcB6hc/F/1BAyYTGhoT/NoTGhoTA1H+IaMtAeB1SYgXPxf+FgcKAzQJHx8KFQq8ChEHAesWFvyQGxITGhoTEhsAAAAEAIAAQAOAA0AACwAlACkANQAAJSIGFRQWMzI2NTQmATcnByMVMwcjAzUjFTMTIxUzBxc3ITUjEzcDIzczAyIGFRQWMzI2NTQmAVoeKioeHioqAS4lWy/Rs05sWZA7WgWnGVsiAQMCUBS0kk1/LR4qKh4eKirQKh4eKioeHioB4HIekGDwAdULYP4hAUwdaQEBT2D+sPD+gCoeHioqHh4qAAAAAAIAAP/ABAADwAAbADsAAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYTNzY0JyYiDwEnJiIHBhQfAQcGFBcWMj8BFxYyNzY0JwIAal1eiygoKCiLXl1qal1eiygoKCiLXl2bxAoKCh0KxMQKHQoKCsTECgoKHQrExAodCgoKA8AoKIteXWpqXV6LKCgoKIteXWpqXV6LKCj+AMQKHQoKCsTECgoKHQrExAodCgoKxMQKCgodCgAEADQAWQPUAzMADgAcACoAPgAAASImNTQ2OwEyFhUUBisBESImNTQ2MyEyFhUUBiMBIiY1NDYzITIWFRQGIyURNDYzMhYVERQGLwEuATc+AR8BAeETGhwYjBQgHBiTExocGAEZEyAbGP7gEyAbGAHAEyAbGP1THBgYDjsYwA8BCRQrDnMCjCATFCAcGBgb/wAgExQgHBgTIP8AGxgYHBwYGBtgAhMUICAU/YAhGBOtDioODwYOZwAABAA4AFkD0QMzAA4AHQArAD8AAAEiJjU0NjMhMhYVFAYjIREiJjU0NjMhMhYVFAYjIREiJjU0NjsBMhYVFAYjJRE0NjMyFhURFAYvAS4BNz4BHwEB3hMgIBMBwBMgIBP+QBMgIBMBIBMgGxj+4BMgGxiNEyAbGP6AGxgYGzsYwA4CCg4qDm0CjCATFCAcGBgb/wAgExQgHBgYG/8AGxgYHBwYGBtgAhMUICAU/YAhGBOtEyUODwEJZwAAAAADAHoAOwOGAzkAKwBbAHMAAAEHFRYGDwEGJicuATU0Nj8BPgEXMzcnJgYPAQ4BFRQWFx4BMzI2PwE+AS8BASYnLgEHBg8BDgEfATc1JjY/ATYWFx4BFRQGDwEOAScjBxceATMyNj8BPgE1LgEnARQWFx4BMzI2PwE+ATU0JicmIg8BDgEVAiBABRITJiJjIhMTEQ8mEzcdBkATOnMmJx0cIx0cUCcmSBgnJhoUBgEmHCUlTSUkHScrFRQGQAUNGCYiYyITExEPJhM3HQZAExMgFCZKHCcdHAQfHf4gCAUFEAUFEATgBQgIBQknCdoFCAGCQAcdNhMnIQEnEy4YGC0PIBMRBEAGExUrIB1LKyZKHR0jHR0mJ3M5FAGGHQ8QAg0OHSYmdDkTQAYdNhMnIQEnEy4YGC0OIBQRBUAHBQgdHSYdSiYnSR3+TQoLBQUICAXgBRAFCQwECgrgBBAFAAAAAQB9ADEDhgNPAEkAAAEuAScmBw4BBwYHBhceARcWFxY3PgE3Njc+ARceAQcGBw4BBwYnJicuAScmNzY3PgE3NhceARc3PgEXHgEPAQ4BIwciJjUmNjczAuUhUi9APT1kIiIMCw4PRTU0QDg2Nl0kJBUGIhIRDwcaLi54RUVIU0NDWRMTDw8sLH9PTlM7aSoDAhwTEhgCDAIZEYMSGwEaEyQCpSAqCAsOD0U0NUBBPTxkIiMLCgoKNSkoNREPBgciEUQ0NUMNDQ0OLSx/Tk9SU0NDWhITDwo1KCITGAICHBOMERcDGRMTGgEAAAABAA3/3QPzA5AAGQAAFwYmNxMnJjY3JRM2MhcTBR4BDwETFgYnJQXzGC0FM9kTEBwBLYcONg+AAS0cEBPZMwUtGP7z/vMjDiUcASfTEzUFLQEMGBj+9C0FNRPT/tkcIAmNjQAAAwAA/8AEAAPAABsANwA9AAABIgcOAQcGFRQXHgEXFjMyNz4BNzY1NCcuAScmAyInLgEnJjU0Nz4BNzYzMhceARcWFRQHDgEHBgMjESE1IwIAal1eiygoKCiLXl1qal1eiygoKCiLXl1qT0ZGaR4eHh5pRkZPT0ZGaR4eHh5pRkYPgAEAgAPAKCiLXl1qal1eiygoKCiLXl1qal1eiygo/IAeHmlGRk9PRkZpHh4eHmlGRk9PRkZpHh4CgP7AgAAABP/9/8YEAwO6ABgAIwAxAD8AAAEDDgEjISImNQMjIiY1NDYzITIWFRQGKwEnIRMUFjMhMjY1EwMUBiMiJj0BNDYzMhYVAyEyFhUUBiMhLgE1NDYDajQEPSv+bCtBOmAYGxsYA6ATIBsYZmD95jMIBQGNBQhA2hsYEyAbGBMgwAEgEyAbGP7gGBsbApr9kys8PCsCbRkTFCAcGBgbB/2gBQgIBQJg/hMTIBsYmRQgHBgCdBwYGBsFGxMUIAABAAAAAQAAC8CgHV8PPPUACwQAAAAAANx/CdIAAAAA3H8J0v/9/8AEAwPAAAAACAACAAAAAAAAAAEAAAPA/8AAAAQD//3//QQDAAEAAAAAAAAAAAAAAAAAAAA5BAAAAAAAAAAAAAAAAgAAAAQAAEYEAP/+BAAAAAQAAAAEAAGXBAAAZwQAAAAEAAAFBAAAAAQAAAAEAwAiBAABNAQAATQEAAAHBAAAAAQBAAAD/wAABAAAEgQAABIEAAAABAAAPgQAAZ0EAACrBAAAMQQAAHQEAAEABAAAAALgABQEAABABAAAIAQAAAAEAAAaBAAAAAQAAAAEAAD5BAAA0gQAAFUEAAAABAAAAAKcAAMEAABHBAABAAQAAFUEAAA7BAAAgAQAAAAEAAA0BAAAOAQAAHoEAAB9BAAADQQAAAAEAP/9AAAAAAAKABQAHgCUAKoA1AFCAVYBlAHQAggCRAJ+AuwDGANEBEgEggSeBLoE4gUKBWwFgAWUBdIGMAaIBpYG8gcwB3wHvggACDIITAi8CNwJFgksCWYJ4AoiCmAKbgqECtILJAuAC9wMOgzqDWANkg3yDlAAAQAAADkAuAAIAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcArgABAAAAAAADAAcAhAABAAAAAAAEAAcAwwABAAAAAAAFAAsAYwABAAAAAAAGAAcAmQABAAAAAAAKABoAFQADAAEECQABAA4ABwADAAEECQACAA4AtQADAAEECQADAA4AiwADAAEECQAEAA4AygADAAEECQAFABYAbgADAAEECQAGAA4AoAADAAEECQAKADQAL3RpM0ZvbnQAdABpADMARgBvAG4AdEZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALlZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMHRpM0ZvbnQAdABpADMARgBvAG4AdHRpM0ZvbnQAdABpADMARgBvAG4AdFJlZ3VsYXIAUgBlAGcAdQBsAGEAcnRpM0ZvbnQAdABpADMARgBvAG4AdAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\") format(\"woff\")}.ti3-icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:ti3Font!important;font-style:normal;font-variant:normal;font-weight:400;speak:none;text-rendering:auto;text-transform:none}.ti3-icon-refresh:before{content:\"\\e900\"}.ti3-icon-checkmark:before{content:\"\\e901\"}.ti3-icon-alert-warn-bg:before{content:\"\\e902\"}.ti3-icon-add1:before{content:\"\\e903\"}.ti3-icon-alert-prompt:before{content:\"\\e904\"}.ti3-icon-close:before{content:\"\\e905\"}.ti3-icon-info-circle:before{content:\"\\e906\"}.ti3-icon-warn:before{content:\"\\e907\"}.ti3-icon-exclamation-circle:before{content:\"\\e908\"}.ti3-icon-check-circle:before{content:\"\\e909\"}.ti3-icon-calendar:before{content:\"\\e90a\"}.ti3-icon-angle-left:before{content:\"\\e90b\"}.ti3-icon-angle-right:before{content:\"\\e90c\"}.ti3-icon-config:before{content:\"\\e90d\"}.ti3-icon-minus-square:before{content:\"\\e90e\"}.ti3-icon-arrow-down:before{content:\"\\e90f\"}.ti3-icon-arrow-right:before{content:\"\\e910\"}.ti3-icon-accordion-fold:before{content:\"\\e911\"}.ti3-icon-accordion-unfold:before{content:\"\\e912\"}.ti3-icon-search:before{content:\"\\e913\"}.ti3-icon-alert-success:before{content:\"\\e914\"}.ti3-icon-alert-warn:before{content:\"\\e915\"}.ti3-icon-location:before{content:\"\\e916\"}.ti3-icon-sort:before{content:\"\\e917\"}.ti3-icon-go-to-old-edition:before{content:\"\\e918\"}.ti3-icon-left-1:before{content:\"\\e919\"}.ti3-icon-clear:before{content:\"\\e91a\"}.ti3-icon-x-thin:before{content:\"\\e91b\"}.ti3-icon-document:before{content:\"\\e91c\"}.ti3-icon-file:before{content:\"\\e91d\"}.ti3-icon-plus-square:before{content:\"\\e91e\"}.ti3-icon-add:before{content:\"\\e91f\"}.ti3-icon-reduce:before{content:\"\\e920\"}.ti3-icon-discount:before{content:\"\\e921\"}.ti3-icon-staricon:before{content:\"\\e922\"}.ti3-icon-left-2:before{content:\"\\e924\"}.ti3-icon-alarm:before{content:\"\\e925\"}.ti3-icon-discount-sup:before{content:\"\\e926\"}.ti3-icon-slider-point:before{content:\"\\e927\"}.ti3-icon-filter:before{content:\"\\e928\"}.ti3-icon-right-1:before{content:\"\\e929\"}.ti3-icon-right-2:before{content:\"\\e92a\"}.ti3-icon-edit:before{content:\"\\e92b\"}.ti3-icon-sold-out:before{content:\"\\e92c\"}.ti3-icon-delete:before{content:\"\\e92d\"}.ti3-icon-sort-ascent:before{content:\"\\e92e\"}.ti3-icon-sort-descent:before{content:\"\\e92f\"}.ti3-icon-action-binding:before{content:\"\\e930\"}.ti3-icon-star:before{content:\"\\e932\"}.ti3-icon-cancel:before{content:\"\\e923\"}.ti3-icon-refresh-1:before{content:\"\\e931\"}.ti3-icon-time:before{content:\"\\e933\"}.ti3-icon-delete-1:before{content:\"\\e934\"}"]
            },] }
];
TiIconClassComponent.ctorParameters = () => [
    { type: ElementRef }
];

// 如果base有@Component，那么所有子类都不必写constructor了，应该跟constructor注入有关
/**
 * 基类，已实现[id]，子类也可以使用hostRef, nativeElement, renderer
 */
class TiBaseComponent {
    constructor(hostRef, renderer) {
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.nativeElement = this.hostRef.nativeElement;
    }
    ngOnChanges(changes) {
        // id动态变化时，重新设置id
        if (changes['id'] && !changes['id'].firstChange) {
            this.setId();
        }
    }
    ngOnInit() {
        this.setId();
    }
    ngDoCheck() {
    }
    ngAfterContentInit() {
    }
    ngAfterContentChecked() {
    }
    ngAfterViewInit() {
    }
    ngAfterViewChecked() {
    }
    ngOnDestroy() {
    }
    // 给宿主设置Id
    setId() {
        // 空id都自动创建id
        if (Util.isEmptyString(this.id)) {
            this.id = Util.getUniqueId('ti_auto_id');
        }
        this.renderer.setProperty(this.nativeElement, 'id', this.id);
    }
    /**
     * 生成宿主Id：如果组件必须要有Id，那么调用此方法，无ID时会自动生成一个ID。
     */
    creatId() {
        // 如果用户没有写宿主id
        if (Util.isEmptyString(this.id)) {
            // 生成唯一id
            this.id = Util.getUniqueId('ti_auto_id');
            this.setId();
        }
    }
    /**
     * @ignore
     * 供内部子元素使用
     * @example
     * <span  [id]='appendId("label_span")'>{{label}}</span>
     * @param suffix 传入的字符串
     * @returns 返回的字符串this.id + '_' + suffix
     */
    appendId(suffix) {
        // 应该不存在空id了，因为所有组件都有自动生成id
        return `${this.id}_${suffix}`;
    }
}
TiBaseComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-base',
                template: ''
            },] }
];
TiBaseComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiBaseComponent.propDecorators = {
    id: [{ type: Input }]
};
/*
用户写宿主id三种方式：
1）给HTML属性id赋字符串id='mycheckbox',
2）给HTML属性id赋变量[attr.id]='mycheckboxid',用户不太会这么用，暂不考虑支持。
3）给DOM属性id赋变量[id]='mycheckboxid'
组件开发读写宿主id的三种方法：
1）读HTML属性id constructor(@Attribute('id') public id )
2）写HTML属性id @HostBinding('attr.id') id: string;
写DOM属性id @HostBinding('id') id: string;
3）读写DOM属性id constructor(private hostRef: ElementRef ) ngAfterViewInit() { ...this.hostRef.nativeElement.id... }
注意：
1）开发Checkbox时，是类似属性指令的组件，宿主元素是input，其他组件暂未尝试。
2）id='mycheckbox'，constructor就能拿到。但Angular[id]变量最早能在ngAfterViewInit()拿到，很迟。
3）自己定义一个id变量，会覆盖angular的id变量，在ngOnInit()就可以拿到，很早。
综上，nativeElement.id读写id，可以兼容以上三种用户写宿主id。
方案一：ngAfterViewInit()取到Angular的id,很晚。但模板中需要使用id，设置太迟，需要强制刷新。
ngAfterViewInit() {
this.setId(); // 取得[id]变量赋值，必须在ngAfterViewInit()。其他周期拿不到。
...
}
private setId() {
// 如果用户没有写宿主id
if (Util.isEmptyString(this.hostNode.id)) {
// 生成唯一id
this.hostNode.id = Util.getUniqueId('checkbox');
}
// 获取宿主id
this.id = this.hostNode.id;
this.cdRef.detectChanges(); // 强制检测，刷新视图中使用的id变量。因为有时视图绘制更早，变量变化后试图未更新。
// TODO: 强制检测变化会不会有性能负担？
}
方案二：自定义id覆盖覆盖Angular的[id]变量，ngOnInit()取到id，很早。无需强制刷新。
@Input('id') id: string; // 覆盖Angular的[id]变量。因为Angular[id]变量只能在ngAfterViewInit拿到，太迟。
ngOnInit() {
...
this.setId();
}
private setId() {
// 如果用户没有写宿主id
if (Util.isEmptyString(this.id)) {
// 生成唯一id
this.id = Util.getUniqueId('checkbox');
}
// 设置宿主id
this.renderer.setProperty(this.hostNode, 'id', this.id);
// this.cdRef.detectChanges(); // 无需强制检测
}
方案三：想办法尽早取到Angular的[id],暂无接口。
可能Angular确实是在AfterViewInit前一刻才取到[id][disabled]。
PrimeNG等库，也是用@Input('id')去覆盖[id] [disabled]等。

Chorme79版报相同id警告：
<span  [id]='appendId("label_span")'>{{label}}</span>
原生标签这样写法，哪怕appendID函数返回空字符串，也会有存在id属性。这样页面中存在多个相同空id。
解决方案：哪怕用户没有赋id，组件都会自动创建id，那么所有组件都有不同id，内部的span等也会有不同id。
*/

// TODO: aria-label
/**
 * 表单基类，已实现autofocus tabindex disabled focus() blur() focus/blur/change事件 ControlValueAccessor
 */
class TiFormComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * HTML属性tabindex
         */
        this.tabindex = '0';
        /**
         * HTML事件focus
         */
        // TODO：ip组件等是触发原生HTML的focus事件，便于校验？
        // TODO：一行有两个tslint错误，无法临时消除
        // tslint:disable-next-line:no-output-rename
        this.focusEvent = new EventEmitter();
        /**
         * HTML事件blur
         */
        // tslint:disable-next-line:no-output-rename
        this.blurEvent = new EventEmitter();
        /**
         * @ignore
         * HTML事件change
         */
        // blur时model值改变触发change
        // tslint:disable-next-line:no-output-rename
        this.changeEvent = new EventEmitter();
        /**
         * 整体focus/blur事件参与的元素，和disabled设置。
         * 组件具有多个input输入框:
         * 1)无元素聚焦->任一元素聚焦=整体聚焦事件。
         * 2)任一元素失焦->其他元素无焦点=整体失焦事件。
         */
        this.focusableElems = [];
        this.ngAfterViewCheckedFirst = true; // 是否第一次执行初始化
        /**
         * focus回调函数
         */
        this.focusCallbackFn = (event) => {
            this.focusedElem = event.target;
            // 非IE浏览器支持event.relatedTarget，使用event.relatedTarget进行处理
            if (!TiBrowser.isIE()) {
                // 当为内部焦点转移，不做处理
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(event.relatedTarget)) {
                    return;
                }
            }
            else { // IE浏览器的处理：浏览器不支持relatedTarget情况下的处理，参见blur中的说明
                if (event.target.tiFocusFrom) {
                    // return;
                    // 情况一：失焦后强制聚焦
                    if (event.target === event.target.tiFocusFrom) {
                        // 面板滚动条IE兼容：在focusin中，让失焦元素强制聚焦，会走到这里。
                        return;
                    }
                    // 情况二：内部焦点转移
                    if (this.focusableElems.length > 1 &&
                        this.focusableElems.includes(event.target.tiFocusFrom)) {
                        return;
                    }
                    // 情况三：较难理解：外部焦点转移时，(event.target as any).tiFocusFrom也是有值的。
                    // 这种情况，是因为组件嵌套使用，此聚焦元素分别从属于多个组件。
                    // 对于A组件来说，是焦点内部转移。对于B组件来说，是焦点外部转移。
                }
            }
            // 设置宿主元素的聚焦属性，用于标识该组件处于聚焦状态，该属性可用于css选择器：在宿主元素上增加属性focused
            this.setAttr(this.nativeElement, 'tiFocused', true);
            // 触发整体聚焦事件
            this.focusEvent.emit(event);
            // 保存focus时model值，blur时如果model值改变，则发送change事件
            this.focusModel = this.model;
        };
        /**
         * blur 回调函数
         */
        this.blurCallbackFn = (event) => {
            // 非IE浏览器支持event.relatedTarget，使用event.relatedTarget进行处理
            if (!TiBrowser.isIE()) {
                // 当为内部焦点转移，不做处理
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(event.relatedTarget)) {
                    return;
                }
            }
            else {
                // 已经失焦的元素，清除记录焦点从哪里而来。
                event.target.tiFocusFrom = undefined;
                // 如果失焦元素强制聚焦，不触发整体失焦事件。
                if (event.target === document.activeElement) {
                    // 面板滚动条IE兼容：在focusin中，让失焦元素强制聚焦，会走到这里。
                    // 即将聚焦（实际上已经聚焦）的元素，记录一下焦点从哪儿来：从自己来的
                    document.activeElement.tiFocusFrom = event.target;
                    return;
                }
                // 浏览器不支持relatedTarget:IE下不支持
                // 判断是否为内部焦点转移通过元素方法：
                // 两个元素的焦点切换时，会先触发a元素的失焦，再触发b元素的聚焦
                // a失焦处理：当前聚焦元素为该元素的可聚焦元素时，则认为是内部焦点转移，并且将聚焦元素的relatedTarget赋值为当前失焦元素，方便blur时的处理；
                // b聚焦处理：判断当前聚焦元素的relatedTarget是否为内部可聚焦元素，如果是的话，则判定其为内部焦点转移
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(document.activeElement)) {
                    // 即将聚焦（实际上已经聚焦）的元素，记录一下焦点从哪儿来。
                    document.activeElement.tiFocusFrom = event.target; // element setAttribute赋值不支持对象形式，因此使用该方式
                    return;
                }
            }
            this.focusedElem = undefined;
            // 取消宿主元素的聚焦属性
            this.setAttr(this.nativeElement, 'tiFocused', false);
            // 触发整体失焦事件
            this.blurEvent.emit(event);
            // blur时如果model值改变，则发送change事件
            if (this.model !== this.focusModel) {
                this.changeEvent.emit(this.model);
            }
            // 触发组件的touched回调，标志其已被touch过
            if (this.onModelTouched) {
                this.onModelTouched();
            }
        };
        /* 表单4接口end */
    }
    /**
     * @ignore
     * 实现表单注册接口
     * @param type 类型
     * @returns 对象
     */
    static getValueAccessor(type) {
        return {
            provide: NG_VALUE_ACCESSOR,
            // tslint:disable-next-line:no-forward-ref
            useExisting: forwardRef(() => type),
            multi: true
        };
    }
    /**
     * 是否组件整体聚焦
     */
    get focused() {
        return this.nativeElement.attributes.tiFocused !== undefined;
    }
    /**
     * 为Dom元素添加/移除属性，此处用于disabled和focused属性的操作
     * @param  element 需要操作的Dom元素
     * @param  attr 操作的属性
     * @param  value 属性值，为true时属性值即为属性值,为false时，移除属性
     */
    setAttr(element, attr, value) {
        // 如果可聚焦元素是原生input等，[disabled]属性会生效。
        // this.renderer.setProperty(this.focusElem, 'disabled', isDisabled); // 参照angular官方设置disabled源码，true和fasle都考虑了
        // 如果可聚焦元素是组件、div，[disabled]属性不会生效。但setAttribute会增加一项html属性。setProperty不增加。
        if (value) {
            this.renderer.setAttribute(element, attr, attr);
        }
        else {
            this.renderer.removeAttribute(element, attr);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        // 表单中统一加该属性，用于表单校验中的样式选择器
        this.renderer.setAttribute(this.nativeElement, 'tiForm', '');
    }
    /**
     * 监听disabled变化
     */
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        if (changes['disabled']) {
            this.setDisabledState(changes['disabled'].currentValue);
        }
    }
    /**
     * 注意：子类继承自Form基类，如果有this.setFocusableElems([xxx]), 那么要更晚调用super.ngAfterViewChecked()。
     * 子类ngAfterViewChecked(): void {
     *      this.setFocusableElems([xxx]);
     *      // 更晚调用super
     *      super.ngAfterViewChecked();
     * }
     */
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        if (this.ngAfterViewCheckedFirst) {
            this.ngAfterViewCheckedFirst = false;
            // 尽量延迟autoFocus的执行。因为有些组件在ngAfterViewInit才拿得到ngFor ngIf内的元素作为可聚焦元素。
            this.autoFocus();
        }
    }
    /**
     * 当做生命周期用吧，监听模型值变化。包括writeValue和this.model=赋值 这两个时刻。
     * @param model 模型值
     */
    ngOnModelChange(model) {
    }
    /**
     * 设置tab键/点击时的聚焦元素，会顺便设置组件focus()聚焦时可聚焦元素（第一个非disabled的可聚焦元素）。
     * 当可聚焦元素变动，或者单一元素disabled状态变动，都要重新调用此方法设置。
     * 建议一般在ngOnInit生命周期调用，如果ngFor/ngIf内元素在ngOnInit找不到那么可在ngAfterViewInit生命周期调用。
     * 注意：所有生命周期，都要调用类似super.ngOnInit()
     *
     * @param elems 可聚焦元素数组Array<Element>，第一个非disabled元素为整个组件的可聚焦元素。
     *
     * 目前使用分为几种情况：
     * 1）一般表单组件，含有可聚焦子元素。
     * 组件主动设置可聚焦元素数组this.setFocusableElems([xxxElement, yyyElement]);
     * 2）有的表单组件，永远不聚焦。
     * slider/list/menulist/droplist，统一不调用此接口。
     * a.不调用接口时，@Input() tabindex: string = '0';未生效。但用户在html标签上设置的属性tabindex="0"等，会生效。
     * b.调用了this.setFocusableElems([]);时，强制清除了标签属性tabindex。用户设置的属性tabindex="1"，会无效，不出现在标签上。
     * 3）少量组件，内部没有可聚焦元素。但是皮儿需要聚焦，ti-dominator。
     * 需要设置this.setFocusableElems([this.nativeElement]);
     */
    setFocusableElems(elems) {
        if (!elems) {
            // 不支持组件传入 null 和undefined，支持传入[]
            return;
        }
        // TODO: 第二次调用时，如果焦点元素减少，那么需要处理tabindex
        // TODO: 支持用户动态第二次设置setFocusableElems。其实，actionmenu会动态设置
        this.focusableElems = elems;
        // 将要上焦点的元素
        this.setFocusElem();
        // 给所有子元素添加tabindex。
        this.setElemsTabindex();
        // 设置宿主标签上的focus()/blur()方法
        this.setNativeElementFocusFn();
        // 设置focus/blur事件监听
        this.setFocusEvents();
    }
    /**
     *  调用focus()函数，会触发组件整体聚焦，此时焦点元素。
     */
    setFocusElem() {
        this.focusElem = undefined;
        // 寻找第一个非disabled元素，作为可聚焦元素
        for (const elem of this.focusableElems) {
            if (elem && elem.attributes.disabled === undefined) {
                this.focusElem = elem;
                break;
            }
        }
    }
    /**
     * 去除皮上的tabindex，给内部可聚焦子元素添加tabindex
     * 当然，特殊情况：this.setFocusableElems([this.nativeElement]);时，又会给皮上补上tabindex
     * 本来此方法，可以合入setFocusEvents()，减少遍历循环。但为了清晰，依然单独为函数。
     */
    setElemsTabindex() {
        // 去除组件标签上的tabindex属性。
        this.renderer.removeAttribute(this.nativeElement, 'tabindex');
        this.focusableElems.forEach((elem) => {
            // 给每一个元素添加tabindex
            this.setTabindex(elem);
        });
    }
    /**
     * @ignore
     */
    getFocusableElems() {
        return this.focusableElems;
    }
    /**
     * 宿主元素标签上添加类似原生focus()方法。
     * 用户调用方法: document.getElementById('ti-xxx').focus();
     * 其实，更推荐调用组件实例上的方法tiXxxComp.focus();
     */
    setNativeElementFocusFn() {
        // 注意：这里必须用箭头函数，以保证运行时this变量不变。
        if (this.focusElem !== this.nativeElement) { // 避免无限循环调用，所以要有此条件限制
            // SSR环境直接返回，是因为SSR环境报错：Cannot assign to read only property 'focus' of object 
            // 采用['nativeElement']['focus']也解决不了
            if (typeof global !== 'undefined') {
                return;
            }
            this.nativeElement.focus = () => {
                this.focus();
            };
            this.nativeElement.blur = () => {
                this.blur();
            };
        }
    }
    /**
     * 设置组件中的可聚焦元素并监听事件
     */
    setFocusEvents() {
        // if (elems.length === 1 && this.focusableElems && this.focusableElems.length > 1) {
        //     // 多聚焦元素，第二次setFocusElem()时，elems长度为1，也会走到这里，返回。
        //     return;
        // }
        // 取消原有的focus/blur监听
        if (this.focusCancelFns) {
            this.focusCancelFns.forEach((fn) => fn());
        }
        if (this.blurCancelFns) {
            this.blurCancelFns.forEach((fn) => fn());
        }
        if (this.mousedownCancelFns) {
            this.mousedownCancelFns.forEach((fn) => fn());
        }
        // 建立新的focus/blur监听
        this.focusCancelFns = new Array();
        this.blurCancelFns = new Array();
        this.mousedownCancelFns = new Array();
        this.focusableElems.forEach((elem) => {
            this.focusCancelFns.push(this.renderer.listen(elem, 'focus', this.focusCallbackFn));
            this.blurCancelFns.push(this.renderer.listen(elem, 'blur', this.blurCallbackFn));
        });
    }
    /**
     * 聚焦方法。类似HTML DOM节点方法focus
     */
    focus() {
        if (this.focusElem) {
            this.focusElem.focus();
        }
    }
    /**
     * 失焦方法。类似HTML DOM节点方法blur
     */
    blur() {
        if (this.focusedElem) {
            this.focusedElem.blur(); // 只对当前聚焦元素进行失焦处理
        }
    }
    /**
     * Tiny组件各种行为，尽量和原生一致。 autofocus也许可以做成一个指令
     * Tiny3新增：增加初始化焦点autofocus支持。IE9本来不支持autofocus，这时也支持了
     */
    autoFocus() {
        if (this.nativeElement.attributes.autofocus) {
            this.focus();
        }
    }
    /**
     * 实现类表单组件的set和get方法
     */
    get model() {
        return this._model;
    }
    /**
     * 设置model值，如果有变化，则触发ngModelChange
     */
    set model(model) {
        if (this._model === model) {
            return;
        }
        this._model = model;
        if (this.onModelChange) {
            this.onModelChange(model);
        }
        this.ngOnModelChange(model);
    }
    /* 表单4接口start */
    /**
     * @ignore
     * 如果用户改变了[ngModel]绑定的变量，那么Angular会通知到这里
     * 子类如果没有特殊需求，都需要首行调用super.writeValue（xxx）
     *
     * super.writeValue 和 this.model=xxx的区别：
     * super.writeValue不会触发ngModelChange
     * this.model=xxx会触发ngModelChange
     * @param model any类型
     */
    writeValue(model) {
        this._model = model;
        this.ngOnModelChange(model);
    }
    /**
     * @ignore
     * Angular将(ngModelChange)绑定的函数，通知到这里。
     * 当组件内部model值改变，需要调用这个函数向外通知。
     * @param fn 回调函数
     */
    registerOnChange(fn) {
        this.onModelChange = fn;
    }
    /**
     * @ignore
     * Blur时，或者需要校验时，需要调用此函数。（可能描述不准确，需要再查资料）
     * @param fn 回调函数
     */
    registerOnTouched(fn) {
        this.onModelTouched = fn;
    }
    /**
     * @ignore
     * 用户绑定在[disabled]上的变量变化，会通知到这里。
     * ti-xxx组件皮上设置[disabled]，会给皮上设置disabled属性，也会给所有可聚焦元素设置disabled属性。
     * 如有特殊需求，子类可以不使用super.setDisabledState(), 而是直接覆盖。
     * Angular原生[disabled]机制：checkbox/radio走不进原生setDisabledState()。原生[disabled][id]等取值也很晚。
     * 注意: Form基类@Input() disabled已经接管了Angular原生[disabled]机制。
     * ngOnChanges监听到disabled值（第一次和后续改变），会通知到这里。
     * @param isDisabled 是否禁用
     */
    setDisabledState(isDisabled) {
        // 表单this.form.controls.myselect.disable();会直接通知到这里，但不会通知到ngOnChanges。所以要设置this.disabled =
        this.disabled = isDisabled;
        // 给宿主添加disabled属性
        this.setAttr(this.nativeElement, 'disabled', isDisabled);
        // 给聚焦事件元素添加disabled属性
        this.focusableElems.forEach((element) => {
            this.setAttr(element, 'disabled', isDisabled);
            // 如果可聚焦元素是自定义组件、div等，那么标签上的disabled属性不生效。
            // 需要借助于tabindex控制是否允许焦点。
            // 控制禁用样式，方案一：（推荐）less里[disabled]属性模仿伪类，ti-xxx皮上的[disabled]更可靠
            // 方案二：html的ngClass用Form基类disabled变量。
            this.setTabindex(element);
        });
    }
    /**
     * 设置tabindex
     * @param element 原生标签元素
     */
    setTabindex(element) {
        // 整体禁用，或者小元素被禁用。
        if (element.attributes.disabled) {
            // 禁用时
            this.renderer.removeAttribute(element, 'tabindex');
            // A和input已经有disabled属性了，不需要加tabindex
            // 普通元素，也不需要加tabindex
            // A标签禁用时想要点击和tab都不落焦点，唯一方法是去除href
            if (element.tagName === 'A') {
                this.renderer.removeAttribute(element, 'href');
            }
        }
        else {
            if (element.tagName === 'A') {
                // 特例：A标签不设置tabindex='0'。Chrome浏览器不设置tabindex效果：点击时无蓝框，tab时有蓝框。
                if (this.tabindex === '0') {
                    this.renderer.removeAttribute(element, 'tabindex');
                }
                else {
                    this.renderer.setAttribute(element, 'tabindex', this.tabindex);
                }
                // disabled时去除的href，添加回来
                if (!element.attributes.href) {
                    // 默认所有的A标签都是tiny使用的标签，href都是javascript:void(0)
                    this.renderer.setAttribute(element, 'href', 'javascript:void(0)');
                }
            }
            else {
                this.renderer.setAttribute(element, 'tabindex', this.tabindex);
            }
        }
    }
}
TiFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-form',
                template: ''
            },] }
];
TiFormComponent.propDecorators = {
    tabindex: [{ type: Input }],
    disabled: [{ type: Input }],
    focusEvent: [{ type: Output, args: ['focus',] }],
    blurEvent: [{ type: Output, args: ['blur',] }],
    changeEvent: [{ type: Output, args: ['change',] }]
};
/**
 * tabindex相关知识：
 * 所有已设置tabindex的元素，都会点击聚焦。哪怕<div tabindex="-1">test</div>也会点击聚焦。
 * Tab键，会按照顺序聚焦：1,2,3,4，...0，按照此顺序聚焦。
 * tabindex='-1'不参与Tab键, 但是可以点击聚焦。
 * A标签不设置tabindex效果：Chrome浏览器点击时无蓝框，tab时有蓝框。其他浏览器有差异。
 * A标签禁用时想要点击和tab都不落焦点，唯一方法是去除href
 * input标签不设置tabindex效果：Chrome浏览器点击时/tab时都有蓝框。
 * 如果设置tabindex='',或者tabindex='tabindex'，这样非法设置，Chrome相当于没有设置。其他浏览器有差异
 */

// 编译lib要求注册Component，不能用抽象类
/**
 * 单选/多选共同的基类。单选多选唯一的差异：单选只有在未选状态才接受空格键改变状态。
 */
class TiRadioBaseComponent extends TiFormComponent {
    ngOnInit() {
        super.ngOnInit();
        this.creatId();
        this.setFocusableElems([this.proxyRef.nativeElement]);
        this.moveNode();
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this.renderer.removeChild(this.renderer.parentNode(this.nativeElement), this.renderer.nextSibling(this.nativeElement));
    }
    /**
     * 将input子元素label，调整为兄弟元素。
     */
    moveNode() {
        const parentNode = this.renderer.parentNode(this.nativeElement);
        const nextNode = this.renderer.nextSibling(this.nativeElement);
        this.renderer.insertBefore(parentNode, this.labelRef.nativeElement, nextNode);
    }
    // Tiny3 TODO: 原始节点改为0高度，不显示。那么所有宿主元素focus都转移到proxy。
    // @HostListener('focus') onHostFocus() {
    //       Logger.log('onHostFocus');
    //       this.proxyNode.focus();
    //   }
    /**
     * @ignore
     * 点选元素后，聚集到对应的checkbox-skin
     * 经赵梦测试，这段逻辑，是为了解决radio火狐下tab键只聚焦不选中。
     * @param event 鼠标点击事件
     */
    onHostClick(event) {
        if (!this.nativeElement.disabled) {
            this.focusElem.focus();
        }
    }
    // 阻止事件冒泡：当子组件中有input元素时，change事件会冒泡到父组件
    // 问题：多选树模板包含复选框组件，树组件中有自己的change事件，点击复选框会触发两次change事件
    // 一次是树组件自身触发，一次是复选框组件冒泡，故需阻止该事件，例如下边代码会打印日志
    onHostChange(event) {
        event.stopPropagation();
    }
    /**
     * @ignore
     * 阻止checkbox-skin和checkbox-label的事件冒泡，防止上层dom绑定的事件被多次触发
     * 原因：span和label使用for和input关联，input上的click等事件也会触发span/label的事件处理，
     * 如果不做处理，上层dom绑定的事件会被触发两次
     * @param event 鼠标点击事件
     */
    onLabelClick(event) {
        event.stopPropagation();
    }
    /**
     * @ignore
     * 快捷键的处理(Enter和Space)：考虑到交互的友好性及与原生的一致性，
     * 在keyup中做相应的事件处理(keydown和keypress会存在一次点击，多次触发的情况);
     * 此外，需要阻止浏览器默认事件（空格键会触发页面滚动条滚到底部的行为，
     * 默认事件的阻止需要在keyup之前，因此此处在keydown中阻止）
     * @param event 键盘按键事件
     */
    onSpaceKeydown(event) {
        if (!this.nativeElement.disabled) {
            event.preventDefault();
        }
    }
    /**
     * @ignore
     * @param event 键盘按键事件
     */
    onSpaceKeyup(event) {
        if (!this.nativeElement.disabled && this.canChange()) {
            this.nativeElement.checked = !this.nativeElement.checked; // 设置元素的选中状态
            // this.cdRef.detectChanges();  执行并不能触发checked改变检查，所以只有下面的change事件才可以。
            // 触发check原生的change事件"createEvent" in document. 因为原生只有blur时才触发onchange
            Util.trigger(this.nativeElement, 'change');
        }
    }
    /**
     * @ignore
     * 这是单选多选唯一的差异：单选只有在未选状态才接受空格键改变状态。
     * @returns 默认返回true，多选框会继承这个方法。单选框重写这个方法。
     */
    canChange() {
        return true;
    }
} // end of class
TiRadioBaseComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-radiobase',
                template: ''
            },] }
];
TiRadioBaseComponent.propDecorators = {
    label: [{ type: Input }],
    labelRef: [{ type: ViewChild, args: ['labelRef', /* TODO: add static flag */ { static: true },] }],
    proxyRef: [{ type: ViewChild, args: ['proxyRef', /* TODO: add static flag */ { static: true },] }],
    onHostClick: [{ type: HostListener, args: ['click', ['$event'],] }],
    onHostChange: [{ type: HostListener, args: ['change', ['$event'],] }]
};
// Tiny3去除：不再操作宿主tabindex。取消input元素的tab聚焦行为(input 可聚焦情况下，tab键切换时会聚焦该元素)
// this.renderer.setAttribute(hostNode, 'tabindex', '-1'); // 经测试，display：none元素压根拿不到焦点。
// Tiny3去除：不再支持fosused属性。
// if ( this.nativeElement.focused !== this.hostAttrOld.focused) {
//   Logger.log('change hostAttrOld.focused');
//   if (this.nativeElement.focused) {
//       this.mySkinRef.nativeElement.focus();
//   }
//   this.hostAttrOld.focused = this.nativeElement.focused;
// Tiny3去除：增加对半选状态的支持。改为用户在模板上直接操作indeterminate
// const partialCheck = this.nativeElement.getAttribute('partialCheck');
// if (partialCheck !== this.hostAttrOld.partialCheck) {
//   Logger.log('change partialCheck=' + partialCheck);
//   this.nativeElement.indeterminate = partialCheck;
//   this.hostAttrOld.partialCheck = partialCheck;
// }
// Tiny3去除：event.which ||

/**
 * 复原完整model对象基类，基于valueKey时，select/buttongroup实现复原选中值到完整对象
 */
class TiWholeComponent extends TiFormComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 找到value值的函数
         */
        this.valueFn = (item) => {
            return item[this.valueKey];
            // tslint:disable-next-line:semicolon
        }; // 这个分号是书写正确的
    }
    /**
     * @ignore
     */
    get modelWhole() {
        return this._modelWhole;
    }
    /**
     * @ignore
     * 用户点选时modelWhole改变，要同时更改model
     */
    set modelWhole(value) {
        this._modelWhole = value;
        if (this.valueKey && value !== undefined && value !== null) {
            // 存在valueKey，且value不为空
            this.model = this['multiple'] ?
                value.map((item) => this.valueFn(item))
                : this.valueFn(value);
        }
        else {
            this.model = value;
        }
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 监听 options/items 变化
        if ((changes['options'] || changes['items']) && this.valueKey && this.model) {
            // 存在 valueKey 时，modelWhole 需通过匹配 valueKey 来重新赋值（解决动态改变options/items时选中项不高亮问题 issues#1332）
            this.writeValue(this.model);
        }
    }
    /**
     * 每次用户主动设置ngModel值时，需要顺便更改modelWhole
     * @param model 设置的ngModel值
     */
    writeValue(model) {
        super.writeValue(model);
        if (this.valueKey && model !== undefined && model !== null) { // 存在valueKey，且value不为空
            // 历史设计缺陷：select总数据集是options，buttongroup总数据集时items
            const options = this['options'] ? this['options'] : this['items'];
            // 直接去写内部值，不触发set函数
            this._modelWhole = this['multiple'] ?
                options.filter((item) => model.includes(this.valueFn(item))) :
                options.find((item) => this.valueFn(item) === model);
        }
        else {
            this._modelWhole = model;
        }
    }
}
TiWholeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-whole',
                template: ''
            },] }
];
TiWholeComponent.propDecorators = {
    valueKey: [{ type: Input }],
    valueFn: [{ type: Input }]
};

/**
 * @ignore
 * 该基类用于组件设置autofocsu时获取焦点，涉及组件button、text、textarea
 */
class TiAutofocusComponent extends TiBaseComponent {
    /**
     * 此处在ngAfterViewInit生命周期内调用focus方法，因为textarea组件较为特殊
     * textarea组件在ngAfterViewInit会将宿主元素包裹在一层dom中，在此之前调用focus方法，获取不到焦点
     */
    ngAfterViewInit() {
        if (this.nativeElement.attributes.autofocus) {
            this.nativeElement.focus();
        }
    }
}
TiAutofocusComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-autofocus',
                template: ''
            },] }
];

// 在使用tiny npm包生产环境编辑时，要求基类也注册。
/**
 * @ignore
 */
class TiBaseModule {
}
TiBaseModule.decorators = [
    { type: NgModule, args: [{
                imports: [],
                exports: [],
                declarations: [
                    TiBaseComponent,
                    TiFormComponent,
                    TiRadioBaseComponent,
                    TiWholeComponent,
                    TiAutofocusComponent
                ]
            },] }
];

// TODO：如果封装为胶囊样式，DOM内部多一层，比现在优劣？
/**
 *  Icon组件
 *
 *  Icon组件可以设置显示Icon。
 *
 * <example-url>../tiny3demo/#/icon/icon-all</example-url>
 */
class TiIconComponent extends TiBaseComponent {
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        const nameChange = changes['name'];
        if (nameChange) {
            this.renderer.removeClass(this.nativeElement, `ti3-icon-${nameChange.previousValue}`);
            this.renderer.addClass(this.nativeElement, `ti3-icon-${nameChange.currentValue}`);
        }
    }
}
TiIconComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-icon',
                template: '<ng-content></ng-content>',
                host: {
                    '[class.ti3-icon]': 'true'
                },
                encapsulation: ViewEncapsulation.None,
                styles: ["@font-face{font-family:ti3Font;font-style:normal;font-weight:400;src:url(\"data:font/woff;base64,d09GRgABAAAAACHgAAsAAAAAIZQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIGSWNtYXAAAAFoAAAAVAAAAFQXVtK7Z2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAHKAAABygirn4gGhlYWQAAB5kAAAANgAAADYcHVghaGhlYQAAHpwAAAAkAAAAJAfDA/pobXR4AAAewAAAAOQAAADk14EPnGxvY2EAAB+kAAAAdAAAAHS1mryIbWF4cAAAIBgAAAAgAAAAIABCALpuYW1lAAAgOAAAAYYAAAGGttZRwHBvc3QAACHAAAAAIAAAACAAAwAAAAMD6wGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA6TQDwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADgAAAAKAAgAAgACAAEAIOk0//3//wAAAAAAIOkA//3//wAB/+MXBAADAAEAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQBG//gDvgOIAEkAAAEHIgYVFBYzNzI2PwE2JicmBg8BLgEnJgcOAQcGBwYXHgEXFhcWNz4BNzY3NiYnJgYHBgcOAQcGJyYnLgEnJjc2Nz4BNzYXHgEXAwYqFR0fFZUUHAIPAhsWFSACBDB4RF5aWZIyMxARFRVmTU1eU09PiDU1HggSExQnCBcpKWo+PkBJPDxPERANDScnckVGSjVeJgLGAR8VFR0DGxOgFSECAhsWJi08DBEVFmZMTV9eWVqSMjMQDw8OTT08TRMnCAgSEzwvLzwLDAwNJydyRUZKSTw8TxEQDQkwJAAAAAAB//4AaAQCAxgABgAAAScJAQcBNwQCfP48/rd7AcR8Ap56/kMBQ3n+Q3kAAAEAAP/AA/gDtwAVAAAJARYGBw4BIyEiJjU0NjcBPgEXHgEXAj4Bug0QGggQCfyMHSkEBAG6DjcaCQ8FA5n8lBs7DgUEKx8JEggDbBsSDwUPCgAAAAMAAP/ABAADwAAcADgATQAAExQXHgEXFjMyNz4BNzY1NCcuAScmIyIHDgEHBhUjNDc+ATc2MzIXHgEXFhUUBw4BBwYjIicuAScmJTMyFCsBFRQiPQEjIjQ7ATU0Mh0BWiEhc01NV1dNTXMhISEhc01NV1dNTXMhIVooKYtdXWpqXV6LKCgoKYtdXWpqXV6LKCgCLZMtLZNaky0tk1oBwFdNTXMhISEhc01NV1dNTXMhISEhc01NV2pdXosoKCgpi11dampdXosoKCgpi11dl1qTLS2TWpMtLZMAAAACAZcAFQJpA2sAAwAHAAABIzUzAyMDMwJZq6sSjCTSAsCr/KoCAAAAAQBnACcDmQNZACAAAAkBFhQHBiInCQEGIicmNDcJASY0NzYyFwkBNjIXFhQHAQJYAUESEhMzEv6//r8SMxMSEgFB/r8SEhMzEgFBAUESMxMSEv6/AcD+vxIzExISAUH+vxISEzMSAUEBQRIzExIS/r8BQRISEzMS/r8AAAMAAP/ABAADwAAbAB8AIwAAASIHDgEHBhUUFx4BFxYzMjc+ATc2NTQnLgEnJgMzFSMTIwMzAgBqXV6LKCgoKIteXWpqXV6LKCgoKIteXZldXVZNCF0DwCgoi15dampdXosoKCgoi15dampdXosoKP7/XP5HAXwAAAMABQAcA/gDeAAXABsAHwAAJSYnJgInJicmIgcGBwYCBwYHBhYzIT4BJSM1MzUjAzMD+AdDRKBGRg0SQREKREWgRUULDx0jA40iJf4cTExMC2JzDXJzARF2dxUdHQ90df7udXYSGzoCNUFNPgFmAAADAAD/wAQAA8AAGwAfACMAAAEiBw4BBwYVFBceARcWMzI3PgE3NjU0Jy4BJyYDIzUzNSMDMwIAal1diykoKCmLXV1qal1diykoKCmLXV1JTU1NCmIDwCgpi11dampdXYspKCgpi11dampdXYspKP0ITDsBZwAAAAACAAD/wAQAA8AAGwAhAAABIgcOAQcGFRQXHgEXFjMyNz4BNzY1NCcuAScmAyc3FwEXAgBqXV2LKSgoKYtdXWpqXV2LKSgoKYtdXaT5RrMBJ0YDwCgpi11dampdXYspKCgpi11dampdXYspKP0N+UezASZGAAgAIv/dA+IDowAhADcAOwA/AEMARwBLAE8AAAEzMhYVERQGIyEiJjURNDY7ATU0NjMyFh0BITU0NjMyFhUdARQGIyImPQEhFRQGIyImPQEjESERBTMVIzczFSM3MxUjBTMVIzczFSM3MxUjAwGgHSMjHPzAHSMjHKAcGBgbAUAbGBgOGxgYG/7AGxgYD4ADAP2Bf3+/gH+/gH/+gH9/v4B/v4B/Az0jHf0gHSMjHQLgHSMzEyAbGDMzEyAgE5MNEyAbGA0NEyAZFBP9YAKgoICAgICAgICAgICAAAABATQAPwLMAzEAFgAACQE2MhcWFAcJARYUBw4BIyImJwEmNDcBNAFKEC4QEBD+3QEjEBAIFAsLFAj+thAQAecBShAQEC4Q/t3+3RAuEAgICAgBShAuEAAAAQE0AD8CzAMxABYAAAkBJiIHBhQXCQEGFBceATMyNjcBNjQnAsz+thAuEBAQASP+3RAQCBQLCxQIAUoQEAHnAUoQEBAuEP7d/t0QLhAICAgIAUoQLhAAAAQAB//ZA/kDpwApAI4AqwC3AAABNS4BJy4BNycOASMiJicHFgYHDgEHFR4BFx4BBxc+ATMyFhc3JjY3PgE3PgEzMhYVMBQxFAYHDgEjIgYHBhQXFgYPAQYmJy4BIyIGBw4BLwEuATc2NCcuASMiJj0BNDYzMjY3NjQnJjY/ATYWFx4BMzI2Nz4BHwEeAQcGFBceATMyFh0BFAYHDgEjIiY9AQUiJy4BJyY1NDc+ATc2MzIXHgEXFhUUBw4BBwYjNTI2NTQmIyIGFRQWA58rSBcWCQ1nHVItLVIdZw0JFhdIKytIFxYJDWcdUi0tUh1nDQkWF0grCxYMEhsHBgcQCSA5EBAQCQkQrRAkCRA4ISE4EAkkEK0QCQkQEBA5IBIbGxIgORAQEAkJEK0QJAkQOCEhOBAJJBCtEAkJEBAQOSASGwcGBxAJExr+YiomJTgQEBAQOCUmKiomJTgQEBAQOCUmKjBDQzAwQ0MBhHgJNCcnWSo7ICUlIDsqWScnNAl4CTQnJ1kqOyAlJSA7KlknJzQJAwIaEgEJEAYGByAdHEEcECQJZAkKEBshIRsQCglkCSQQHEEcHSAaEsgSGiAdHEEcECQJZAkKEBshIRsQCglkCSQQHEEcHSAaEsgJEAYGBxoSKJEQEDglJioqJiU4EBAQEDglJioqJiU4EBBaQzAwQ0MwMEMAAAADAAD/wAQAA8AADwAfACQAACURNCYjISIGFREUFjMhMjYDMhYVERQGIyEiJjURNDYzEzUhFSEEAF1D/UBDXV1DAsBDXaAdKSkd/UAdKSkdYAIA/gBgAsBDXV1D/UBDXV0DSSkd/UAdKSkdAsAdKf4nZmAAAAIAAP/ABAEDwAAFAAkAAAEnCQEHAQMzESMEAQj+B/4CAgIAJ09PAcBa/hUB61r+AAQA/X8AAAAAAgAA/8AD/wPAAAUACQAAAQcJARcBJSEVIQH/WgHr/hVaAgD8AQKB/X8DwAj+CP4CAgIAJ04AAAABABIA0APuArAAEwAAJRYyNzY0JwEmIgcBBhQXFjI3CQEDmBIyEhIS/j0SMhL+PRISEjISAZgBmNAQEBAtEAGTEBD+bRAtEBAQAW3+kwAAAAEAEgDQA+4CsAATAAABNjIXFhQHAQYiJwEmNDc2MhcJAQOYEjISEhL+PRIyEv49EhISMhIBmAGYArAQEBAtEP5tEBABkxAtEBAQ/pMBbQAAAgAA/9MD7QPAACMAPwAAJRcWFAcGIi8BDgEjIicuAScmNTQ3PgE3NjMyFx4BFxYVFAYHBTI3PgE3NjU0Jy4BJyYjIgcOAQcGFRQXHgEXFgM/rhMTFDYUrTqNTl9UVH0lJCQlfVRUX2BUVH0lJDEr/o5KQUFgHBwcHGBBQUpJQUFhHBwcHGFBQd6tFDYUExOuKzEkJX1UVGBfVFR9JSQkJX1UVF9OjTpPHBxgQUFKSUFBYRwcHBxhQUFJSkFBYBwcAAAAAAEAPgBnA8IDGQAFAAAlATcXARcBm/6jY/oB1FNnAYdh5QGvTAAAAAACAZ0AFQJjA2sAAwAHAAAlIzUzJyMDMwJatLQfeyPGFbSHAhsAAAAAAgCrABUDVQNrABwAKAAAASIHDgEHBhUUFx4BFxYxMDc+ATc2NTQnLgEnJiMRIiY1NDYzMhYVFAYCAEY/PlwbGzU1gDY1NTaANTUbG1w+P0Y6V1c6OldXA2sbG10+PkdGWVmcNjY2NpxZWUZHPj5dGxv+GVg5OldXOjlYAAQAMQBZA9gDMwAOAB0ALABAAAABIiY1NDYzITIWFRQGIyERIiY1NDYzITIWFRQGIyERIiY1NDYzITIWFRQGIyEnETQ2MzIWFREUBi8BLgE3PgEfAQHeExobGAHAFCAcGP46ExobGAHAFCAcGP46EyAbGAHAEyAbGP5A7RsYGA87GMAPAQkTLA5zAowgExQgHBgYG/8AIBMUIBwYEyD/ABsYGBwcGBgbYAITFCAgFP2AIRgTrQ4qDg8GDmcAAgB0ACADmgNgACQAPQAAASMiBh0BMzU0NjsBMhYVERQGKwEiJj0BIxUUFjsBMjY1ETQmIwEhNSE3NjQnJiIPAQYUHwEeATMyNjc2NCcDGsA0TGASDsAPEREPwA4SYEw0wDVLSzX97QHT/jotDg4PKQ+GDg6GChMKCRIFDg4DYEU1eXkKEBAK/a0JEBAJenMwSkU1Akw1Rf4tZi0OKg4PD4wPKQ+GBQgIBQ4qDgAAAAABAQAAWgMAAyYAAgAACQERAQACAAHAAWb9NAAAAgAA/8AEAAPAABsAOwAAASIHDgEHBhUUFx4BFxYzMjc+ATc2NTQnLgEnJhMWFAcGIi8BBwYiJyY0PwEnJjQ3NjIfATc2MhcWFA8BAgBqXV6LKCgoKIteXWpqXV6KKSgoKIteXYMJCQkZCMPDCRkICQnCwgkJCRkIw8MIGggJCcIDwCgoi15dampdXYspKCgpi11dampdXosoKP09CBkJCQnCwgkJCRkIw8MIGQkJCcLCCQkJGAnDAAEAFABkAswDHAAgAAA3CQEWMjc2NCcJATY0JyYiBwkBJiIHBhQXCQEGFBcWMjdTAR0BHQ0lDQ0N/uMBHQ0NDSUN/uP+4w0lDQ0NAR7+4g0NDSUNZAEd/uMNDQ0lDQEdAR4NJA0NDf7jAR0NDQ0lDf7j/uMNJQ0NDQAAAAAGAED/wAPAA8AADQARACAAJAAoACwAAAEhIgYVERQWMyEyNjURJRcjNRMhIiY1ETQ2MyERIREUBgEhFSERIRUhESEVIQKt/fMoODgoAsAoOP8Ak5Og/UANExMNAeABABP9kwIA/gACAP4AAQD/AAPAOCj8wCg4OCgCjaaTk/ytEw0DQA0T/wD9oA0TAUBAAQBAAQBAAAAAAAMAIAAQA+MDcAASAB0AKQAAASEnISIGFREUFjMhMjY1ES4BIxMUBiMhIiY1ESERESE1NDY7ARchMhYVA4P+XVb+8yc2NicDCSc2AjcnHREM/PoMEQNA/MARDPBTAcMMEQL2ejYn/VonNjYnAi0mNv13DBERDAGT/m0B09MMEXoQDAAAAAQAAP/ABAADwAAPAB8AJAApAAAlETQmIyEiBhURFBYzITI2AzIWFREUBiMhIiY1ETQ2MwEjETMRJTUhFSEEAF1D/UBDXV1DAsBDXaAdKSkd/UAdKSkdAZNmYP7TAgD+AGACwENdXUP9QENdXQNJKR39QB0pKR0CwB0p/VoCAP4AzWZgAAEAGv/aA+YDpgAgAAABETQ2MzIWFREhMhYVFAYjIREUBiMiJjURISImNTQ2MyEBxCMZGSMBbxgjIxj+kSMZGSP+kRgjIxgBbwH8AW8YIyMY/pEjGRkj/pEYIyMYAW8jGRkjAAABAAABgQQAAf8ADgAAEyImNTQ2MyEyFhUUBiMhPxolJRoDgholJRr8fgGBJRoaJSUaGiUABgAA/8AEAAPAAA0AFAAjACcARwBOAAABMTM3Jy4BIyIGFR4BMwc3IxEzEQc3MTI2NTQmIzEiBgcxBxcBESERAyMRIREjNTMuATU0NjMyFhc5Ahc3PgEzMhYVFAYHMw8BJxEzESMBijMLJAgQDBMWBBQbJB9Imlz7HhAaDwgTBCkK/cMEAM0p/ewpQgcDRTYfOA8VFBQ0HzZKBwNHmR9SmkgCWg8uCAcUDxQVcST+zQEubL4ZEA8aCAguFAFm/AAEAP5N/oABgE0HFgwuQhsTGRkXF0IuDBILcU1h/t0BMwABAPkAxAMHArwADwAAARcnBxcHFzcXNyc3Jwc3IwHYCc4a1I8/g4M/j9QazQhQArzgTkw/qjG2tjGqP0xO4AAAAQDSAI0DLgLzACAAAAEXFgYHBiYvAQcOAScuAT8BJyY2NzYWHwE3PgEXHgEPAQJC7A0BDg4mDurqDiYODgEN7OwNAQ4OJg7q6g4mDg4BDewBwPEOJg4OAQ3w8A0BDg4mDvHxDiYODgEN8PANAQ4OJg7xAAABAFUAWgOrAyYABwAAASURJRUJARUCVQFW/qr+AAIAAjfv/Tzn7wFmAWbvAAIAAP/ABAADwAAbACEAAAEiBw4BBwYVFBceARcWMzI3PgE3NjU0Jy4BJyYDEyMBAzMCAGpdXYspKCgpi11dampdXYspKCgpi11d1zqgAUA6oAPAKCmLXV1qal1diykoKCmLXV1qal1diyko/MABDQFz/vMABwAA/8AEAAPAAAIAIwAxADgARwBPAFIAAAE5AQU+ATUmJy4BJyYjIgYPAScuASMiBhUUFhcjFTMRIREzNSUyFhcxFwcjIiY1PgEzEyERMwcXNzcxPgEzMTIWFRQGIzEjJxMhERc3JzMRATkBAdUBvAYLAxITOycnLTNeGSMiGV4zWnMLBm9EA4A8/SsMIAdEEVUzIwckGpH/AG8rIprVDRkNICUYLVUi9/8AkSszb/7eA3OzDSQTJyIiMw8PLSAqKiAtb00THhOA/YACgICADQ1MGiQgGiL9AAIAPICz7w0NJCAgHBr9ZgHmooA8/gADMwAAAAMAA//nApkDmQANABwAKwAAATQ2MzIWFREUBiMiJjUBNDYzMhYVERQGIyImNREhNDYzMhYVERQGIyImNREBFyAXFyAgFxcg/uwgFxcgIBcXIAIoIBcXICAXFyADYxYgIBb8uhYgIBYC+hYfHxb9UhYfHxYCrhYfHxb9UhYfHxYCrgAAAAIARwASA6EDcgAYACUAACUUFjclPgE1ETc2NCcuASMhIgYVFBYfAQM3ETQmLwEhBw4BFREHAUcvGAEADgv6GBgKHRP9LSIrCgn0B2AIBeYCjecJCqA/HRoKgAUZDwEt+RhDGAoQMB0OHQ76/k1NAXMJEgXt7QUSCf7gUwABAQAAWgMAAyYAAgAAJREBAQACAFoCzP6aAAAAAQBVAFoDqwMmAAcAAAkCNQURBTUBqwIA/gD+qgFWAyb+mv6a7+8CzO/vAAADADv/0AO7A5oABQAdACwAAAkBBzcBJzcXFhQHAQ4BDwEGJicmND8BPgE3ATYyFwEhMhYVFAYjISImNTQ2MwLw/iEsogHfdjeHFxf+FgcRCrseOAgDAjQCCwcB6hc/F/1BAyYTGhoT/NoTGhoTA1H+IaMtAeB1SYgXPxf+FgcKAzQJHx8KFQq8ChEHAesWFvyQGxITGhoTEhsAAAAEAIAAQAOAA0AACwAlACkANQAAJSIGFRQWMzI2NTQmATcnByMVMwcjAzUjFTMTIxUzBxc3ITUjEzcDIzczAyIGFRQWMzI2NTQmAVoeKioeHioqAS4lWy/Rs05sWZA7WgWnGVsiAQMCUBS0kk1/LR4qKh4eKirQKh4eKioeHioB4HIekGDwAdULYP4hAUwdaQEBT2D+sPD+gCoeHioqHh4qAAAAAAIAAP/ABAADwAAbADsAAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYTNzY0JyYiDwEnJiIHBhQfAQcGFBcWMj8BFxYyNzY0JwIAal1eiygoKCiLXl1qal1eiygoKCiLXl2bxAoKCh0KxMQKHQoKCsTECgoKHQrExAodCgoKA8AoKIteXWpqXV6LKCgoKIteXWpqXV6LKCj+AMQKHQoKCsTECgoKHQrExAodCgoKxMQKCgodCgAEADQAWQPUAzMADgAcACoAPgAAASImNTQ2OwEyFhUUBisBESImNTQ2MyEyFhUUBiMBIiY1NDYzITIWFRQGIyURNDYzMhYVERQGLwEuATc+AR8BAeETGhwYjBQgHBiTExocGAEZEyAbGP7gEyAbGAHAEyAbGP1THBgYDjsYwA8BCRQrDnMCjCATFCAcGBgb/wAgExQgHBgTIP8AGxgYHBwYGBtgAhMUICAU/YAhGBOtDioODwYOZwAABAA4AFkD0QMzAA4AHQArAD8AAAEiJjU0NjMhMhYVFAYjIREiJjU0NjMhMhYVFAYjIREiJjU0NjsBMhYVFAYjJRE0NjMyFhURFAYvAS4BNz4BHwEB3hMgIBMBwBMgIBP+QBMgIBMBIBMgGxj+4BMgGxiNEyAbGP6AGxgYGzsYwA4CCg4qDm0CjCATFCAcGBgb/wAgExQgHBgYG/8AGxgYHBwYGBtgAhMUICAU/YAhGBOtEyUODwEJZwAAAAADAHoAOwOGAzkAKwBbAHMAAAEHFRYGDwEGJicuATU0Nj8BPgEXMzcnJgYPAQ4BFRQWFx4BMzI2PwE+AS8BASYnLgEHBg8BDgEfATc1JjY/ATYWFx4BFRQGDwEOAScjBxceATMyNj8BPgE1LgEnARQWFx4BMzI2PwE+ATU0JicmIg8BDgEVAiBABRITJiJjIhMTEQ8mEzcdBkATOnMmJx0cIx0cUCcmSBgnJhoUBgEmHCUlTSUkHScrFRQGQAUNGCYiYyITExEPJhM3HQZAExMgFCZKHCcdHAQfHf4gCAUFEAUFEATgBQgIBQknCdoFCAGCQAcdNhMnIQEnEy4YGC0PIBMRBEAGExUrIB1LKyZKHR0jHR0mJ3M5FAGGHQ8QAg0OHSYmdDkTQAYdNhMnIQEnEy4YGC0OIBQRBUAHBQgdHSYdSiYnSR3+TQoLBQUICAXgBRAFCQwECgrgBBAFAAAAAQB9ADEDhgNPAEkAAAEuAScmBw4BBwYHBhceARcWFxY3PgE3Njc+ARceAQcGBw4BBwYnJicuAScmNzY3PgE3NhceARc3PgEXHgEPAQ4BIwciJjUmNjczAuUhUi9APT1kIiIMCw4PRTU0QDg2Nl0kJBUGIhIRDwcaLi54RUVIU0NDWRMTDw8sLH9PTlM7aSoDAhwTEhgCDAIZEYMSGwEaEyQCpSAqCAsOD0U0NUBBPTxkIiMLCgoKNSkoNREPBgciEUQ0NUMNDQ0OLSx/Tk9SU0NDWhITDwo1KCITGAICHBOMERcDGRMTGgEAAAABAA3/3QPzA5AAGQAAFwYmNxMnJjY3JRM2MhcTBR4BDwETFgYnJQXzGC0FM9kTEBwBLYcONg+AAS0cEBPZMwUtGP7z/vMjDiUcASfTEzUFLQEMGBj+9C0FNRPT/tkcIAmNjQAAAwAA/8AEAAPAABsANwA9AAABIgcOAQcGFRQXHgEXFjMyNz4BNzY1NCcuAScmAyInLgEnJjU0Nz4BNzYzMhceARcWFRQHDgEHBgMjESE1IwIAal1eiygoKCiLXl1qal1eiygoKCiLXl1qT0ZGaR4eHh5pRkZPT0ZGaR4eHh5pRkYPgAEAgAPAKCiLXl1qal1eiygoKCiLXl1qal1eiygo/IAeHmlGRk9PRkZpHh4eHmlGRk9PRkZpHh4CgP7AgAAABP/9/8YEAwO6ABgAIwAxAD8AAAEDDgEjISImNQMjIiY1NDYzITIWFRQGKwEnIRMUFjMhMjY1EwMUBiMiJj0BNDYzMhYVAyEyFhUUBiMhLgE1NDYDajQEPSv+bCtBOmAYGxsYA6ATIBsYZmD95jMIBQGNBQhA2hsYEyAbGBMgwAEgEyAbGP7gGBsbApr9kys8PCsCbRkTFCAcGBgbB/2gBQgIBQJg/hMTIBsYmRQgHBgCdBwYGBsFGxMUIAABAAAAAQAAC8CgHV8PPPUACwQAAAAAANx/CdIAAAAA3H8J0v/9/8AEAwPAAAAACAACAAAAAAAAAAEAAAPA/8AAAAQD//3//QQDAAEAAAAAAAAAAAAAAAAAAAA5BAAAAAAAAAAAAAAAAgAAAAQAAEYEAP/+BAAAAAQAAAAEAAGXBAAAZwQAAAAEAAAFBAAAAAQAAAAEAwAiBAABNAQAATQEAAAHBAAAAAQBAAAD/wAABAAAEgQAABIEAAAABAAAPgQAAZ0EAACrBAAAMQQAAHQEAAEABAAAAALgABQEAABABAAAIAQAAAAEAAAaBAAAAAQAAAAEAAD5BAAA0gQAAFUEAAAABAAAAAKcAAMEAABHBAABAAQAAFUEAAA7BAAAgAQAAAAEAAA0BAAAOAQAAHoEAAB9BAAADQQAAAAEAP/9AAAAAAAKABQAHgCUAKoA1AFCAVYBlAHQAggCRAJ+AuwDGANEBEgEggSeBLoE4gUKBWwFgAWUBdIGMAaIBpYG8gcwB3wHvggACDIITAi8CNwJFgksCWYJ4AoiCmAKbgqECtILJAuAC9wMOgzqDWANkg3yDlAAAQAAADkAuAAIAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcArgABAAAAAAADAAcAhAABAAAAAAAEAAcAwwABAAAAAAAFAAsAYwABAAAAAAAGAAcAmQABAAAAAAAKABoAFQADAAEECQABAA4ABwADAAEECQACAA4AtQADAAEECQADAA4AiwADAAEECQAEAA4AygADAAEECQAFABYAbgADAAEECQAGAA4AoAADAAEECQAKADQAL3RpM0ZvbnQAdABpADMARgBvAG4AdEZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALlZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMHRpM0ZvbnQAdABpADMARgBvAG4AdHRpM0ZvbnQAdABpADMARgBvAG4AdFJlZ3VsYXIAUgBlAGcAdQBsAGEAcnRpM0ZvbnQAdABpADMARgBvAG4AdAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\") format(\"woff\")}.ti3-icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:ti3Font!important;font-style:normal;font-variant:normal;font-weight:400;speak:none;text-rendering:auto;text-transform:none}.ti3-icon-refresh:before{content:\"\\e900\"}.ti3-icon-checkmark:before{content:\"\\e901\"}.ti3-icon-alert-warn-bg:before{content:\"\\e902\"}.ti3-icon-add1:before{content:\"\\e903\"}.ti3-icon-alert-prompt:before{content:\"\\e904\"}.ti3-icon-close:before{content:\"\\e905\"}.ti3-icon-info-circle:before{content:\"\\e906\"}.ti3-icon-warn:before{content:\"\\e907\"}.ti3-icon-exclamation-circle:before{content:\"\\e908\"}.ti3-icon-check-circle:before{content:\"\\e909\"}.ti3-icon-calendar:before{content:\"\\e90a\"}.ti3-icon-angle-left:before{content:\"\\e90b\"}.ti3-icon-angle-right:before{content:\"\\e90c\"}.ti3-icon-config:before{content:\"\\e90d\"}.ti3-icon-minus-square:before{content:\"\\e90e\"}.ti3-icon-arrow-down:before{content:\"\\e90f\"}.ti3-icon-arrow-right:before{content:\"\\e910\"}.ti3-icon-accordion-fold:before{content:\"\\e911\"}.ti3-icon-accordion-unfold:before{content:\"\\e912\"}.ti3-icon-search:before{content:\"\\e913\"}.ti3-icon-alert-success:before{content:\"\\e914\"}.ti3-icon-alert-warn:before{content:\"\\e915\"}.ti3-icon-location:before{content:\"\\e916\"}.ti3-icon-sort:before{content:\"\\e917\"}.ti3-icon-go-to-old-edition:before{content:\"\\e918\"}.ti3-icon-left-1:before{content:\"\\e919\"}.ti3-icon-clear:before{content:\"\\e91a\"}.ti3-icon-x-thin:before{content:\"\\e91b\"}.ti3-icon-document:before{content:\"\\e91c\"}.ti3-icon-file:before{content:\"\\e91d\"}.ti3-icon-plus-square:before{content:\"\\e91e\"}.ti3-icon-add:before{content:\"\\e91f\"}.ti3-icon-reduce:before{content:\"\\e920\"}.ti3-icon-discount:before{content:\"\\e921\"}.ti3-icon-staricon:before{content:\"\\e922\"}.ti3-icon-left-2:before{content:\"\\e924\"}.ti3-icon-alarm:before{content:\"\\e925\"}.ti3-icon-discount-sup:before{content:\"\\e926\"}.ti3-icon-slider-point:before{content:\"\\e927\"}.ti3-icon-filter:before{content:\"\\e928\"}.ti3-icon-right-1:before{content:\"\\e929\"}.ti3-icon-right-2:before{content:\"\\e92a\"}.ti3-icon-edit:before{content:\"\\e92b\"}.ti3-icon-sold-out:before{content:\"\\e92c\"}.ti3-icon-delete:before{content:\"\\e92d\"}.ti3-icon-sort-ascent:before{content:\"\\e92e\"}.ti3-icon-sort-descent:before{content:\"\\e92f\"}.ti3-icon-action-binding:before{content:\"\\e930\"}.ti3-icon-star:before{content:\"\\e932\"}.ti3-icon-cancel:before{content:\"\\e923\"}.ti3-icon-refresh-1:before{content:\"\\e931\"}.ti3-icon-time:before{content:\"\\e933\"}.ti3-icon-delete-1:before{content:\"\\e934\"}"]
            },] }
];
TiIconComponent.propDecorators = {
    name: [{ type: Input }]
};
/* ti-icon组件，为了防止多个组件重复使用字体图标文件，导致最终用户打包文件成倍增大。
因此封装该组件，确保最终打包只引用一份字体图标样式及文件 */

class TiIconModule {
}
TiIconModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiIconClassComponent, TiIconComponent],
                declarations: [TiIconClassComponent, TiIconComponent]
            },] }
];

/**
 * 手风琴组件，
 * 用于实现多个折叠面板的呈现方式，通过ti-accordion、ti-accordion-item、ti-accordion-head组件嵌套方式实现
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)
 * 中引入BrowserAnimationsModule。</span>这是因为此组件中使用了Angular动画，需要引入BrowserAnimationsModule，
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/accordion/acc-all</example-url>
 */
class TiAccordionComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 展开某一项时，是否关闭其它项
         */
        this.closeOthers = true;
        /**
         * 头部样式类
         */
        this.headClass = '';
        /**
         * 内容体样式类
         */
        this.bodyClass = '';
        this.items = [];
    }
    /**
     * @ignore
     * 关闭其余item
     */
    closeOtherItems(openItem) {
        if (!this.closeOthers) {
            return;
        }
        this.items.forEach((item) => {
            if (item.open && item !== openItem) {
                item.open = false;
            }
        });
    }
    /**
     * @ignore
     * 添加某一accordion条目到items数组中
     */
    addItem(item) {
        this.items.push(item);
    }
    /**
     * @ignore
     * 从items数组中删除某一accordion条目
     */
    removeItem(item) {
        const index = this.items.indexOf(item);
        if (index !== -1) {
            this.items.splice(index, 1);
        }
    }
}
TiAccordionComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-accordion',
                template: "<ng-content></ng-content>\r\n",
                host: {
                    '[class.ti3-accordion-group]': 'true'
                },
                styles: [":host.ti3-accordion-group{display:block}:host.ti3-accordion-panel{background-color:var(--ti-accordion-panel-bg-color);border:var(--ti-accordion-panel-border);border-radius:var(--ti-accordion-panel-border-radius);display:block;margin-bottom:0}.ti3-accordion-panel-heading{-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-accordion-panel-head-bg-color);color:var(--ti-common-color-text-primary);cursor:pointer;height:var(--ti-accordion-panel-height);line-height:var(--ti-accordion-panel-lineheight);padding:var(--ti-accordion-panel-head-padding);user-select:none}.ti3-accordion-panel-heading.disabled{background-color:var(--ti-accordion-panel-head-bg-color-disabled);cursor:not-allowed;outline:none}.ti3-accordion-panel-title-icon{color:var(--ti-accordion-panel-icon-color);display:inline-block;font-size:var(--ti-accordion-panel-icon-fs);line-height:var(--ti-accordion-panel-icon-fs);vertical-align:middle}.ti3-accordion-panel-title-icon-disabled{color:var(--ti-accordion-panel-icon-color-disabled)}.ti3-icon-angle-transform-down{transform:rotate(90deg)}.ti3-icon-angle-transform-up{transform:rotate(-90deg)}.ti3-accordion-panel-title{align-items:center;color:var(--ti-accordion-panel-title-color);display:flex;font-size:var(--ti-accordion-panel-fs);margin-bottom:0;margin-top:0}.ti3-accordion-panel-title-content{margin-left:var(--ti-accordion-panel-title-margin-left)}.ti3-accordion-panel-title-content-disabled{color:var(--ti-accordion-panel-title-color-disabled)}:host.ti3-accordion-group ::ng-deep .ti3-accordion-panel+.ti3-accordion-panel{margin-top:var(--ti-accordion-panel-space-between)}.ti3-accordion-panel-collapse{border-top:var(--ti-accordion-panel-collapse-border-top)}.ti3-accordion-panel-body{background-color:var(--ti-accordion-panel-body-bg);box-shadow:var(--ti-accordion-panel-body-shadow);padding:var(--ti-accordion-panel-body-padding)}"]
            },] }
];
TiAccordionComponent.propDecorators = {
    closeOthers: [{ type: Input }],
    headClass: [{ type: Input }],
    bodyClass: [{ type: Input }]
};

/**
 * 定义手风琴组件单个折叠面板，该组件包含在ti-accordion标签中
 * <example-url>../tiny3demo/#/accordion/acc-all</example-url>
 */
class TiAccordionItemComponent extends TiBaseComponent {
    /**
     * @ignore
     * 依赖注入tiAccordion（后续使用其方法）
     */
    constructor(accordion, hostRef, renderer) {
        super(hostRef, renderer);
        this.accordion = accordion;
        /**
         * 单个折叠面板项是否灰化
         */
        this.disabled = false;
        /**
         * 设置用户点击某一折叠面板的head时是否自动实现内容体展示状态切换
         *
         * 头部局部点击可切换场景，需要通过设置该变量实现
         */
        this.clickToggle = true;
        /**
         * 某一折叠面板的头部点击回调
         */
        this.headClick = new EventEmitter();
        /**
         * @ignore
         * 头部class,需要显示声明，否则ngClass会报错
         */
        this.headClass = '';
        /**
         * @ignore
         * body class,需要显示声明，否则ngClass会报错
         */
        this.bodyClass = '';
        // 面板展开状态获取/设置：此处处理涉及到内部和外部修改，因此此处通过set/get进行处理
        this.isOpen = false;
    }
    /**
     * 单个折叠面板是否处于展开状态，用于初始化设置，默认值为false
     *
     */
    get open() {
        return this.isOpen;
    }
    /**
     * @ignore
     */
    set open(value) {
        if (value !== this.open) {
            if (value) { // open属性更新且open值为true时，处理其它item的关闭状态
                this.accordion.closeOtherItems(this);
            }
            this.isOpen = value;
        }
    }
    // 初始化处理：添加当前item到列表中,设置该item的id值
    ngOnInit() {
        super.ngOnInit();
        this.accordion.addItem(this);
        this.headClass = this.accordion.headClass;
        this.bodyClass = this.accordion.bodyClass;
    }
    // item销毁处理：移除item列表中的该项数据
    ngOnDestroy() {
        super.ngOnDestroy();
        this.accordion.removeItem(this);
    }
    /**
     * @ignore
     * item头部点击事件逻辑处理
     */
    toggleOpen($event) {
        if (this.disabled) {
            return;
        }
        if (this.clickToggle) {
            this.open = !this.open;
        }
        this.headClick.emit($event);
    }
}
TiAccordionItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-accordion-item',
                template: "<div [ngClass]=\"[headClass, disabled ? 'disabled': '', 'ti3-accordion-panel-heading']\"\r\n[tabindex]=\"disabled ? -1 : 0\" tiOutline (keydown.enter)=\"toggleOpen($event)\"\r\n     (click)=\"toggleOpen($event)\" [id]=\"appendId('head')\">\r\n    <div class=\"ti3-accordion-panel-title\">\r\n        <div class=\"ti3-icon ti3-icon-angle-right ti3-accordion-panel-title-icon\"\r\n             [ngClass]=\"{'ti3-icon-angle-transform-down': !open,'ti3-icon-angle-transform-up': open,\r\n             'ti3-accordion-panel-title-icon-disabled': disabled}\"></div>\r\n        <span class=\"ti3-accordion-panel-title-content\">\r\n            <span [ngClass]=\"{'ti3-accordion-panel-title-content-disabled': disabled}\">\r\n                <ng-content select=\"ti-accordion-head\"></ng-content>\r\n            </span>\r\n        </span>\r\n    </div>\r\n</div>\r\n<div class=\"ti3-accordion-panel-collapse\" [tiCollapse]=\"!open\">\r\n    <div class=\"ti3-accordion-panel-body\" [ngClass]=\"[bodyClass]\">\r\n        <ng-content></ng-content>\r\n    </div>\r\n</div>",
                host: {
                    '[class.ti3-accordion-panel]': 'true'
                },
                styles: [":host.ti3-accordion-group{display:block}:host.ti3-accordion-panel{background-color:var(--ti-accordion-panel-bg-color);border:var(--ti-accordion-panel-border);border-radius:var(--ti-accordion-panel-border-radius);display:block;margin-bottom:0}.ti3-accordion-panel-heading{-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-accordion-panel-head-bg-color);color:var(--ti-common-color-text-primary);cursor:pointer;height:var(--ti-accordion-panel-height);line-height:var(--ti-accordion-panel-lineheight);padding:var(--ti-accordion-panel-head-padding);user-select:none}.ti3-accordion-panel-heading.disabled{background-color:var(--ti-accordion-panel-head-bg-color-disabled);cursor:not-allowed;outline:none}.ti3-accordion-panel-title-icon{color:var(--ti-accordion-panel-icon-color);display:inline-block;font-size:var(--ti-accordion-panel-icon-fs);line-height:var(--ti-accordion-panel-icon-fs);vertical-align:middle}.ti3-accordion-panel-title-icon-disabled{color:var(--ti-accordion-panel-icon-color-disabled)}.ti3-icon-angle-transform-down{transform:rotate(90deg)}.ti3-icon-angle-transform-up{transform:rotate(-90deg)}.ti3-accordion-panel-title{align-items:center;color:var(--ti-accordion-panel-title-color);display:flex;font-size:var(--ti-accordion-panel-fs);margin-bottom:0;margin-top:0}.ti3-accordion-panel-title-content{margin-left:var(--ti-accordion-panel-title-margin-left)}.ti3-accordion-panel-title-content-disabled{color:var(--ti-accordion-panel-title-color-disabled)}:host.ti3-accordion-group ::ng-deep .ti3-accordion-panel+.ti3-accordion-panel{margin-top:var(--ti-accordion-panel-space-between)}.ti3-accordion-panel-collapse{border-top:var(--ti-accordion-panel-collapse-border-top)}.ti3-accordion-panel-body{background-color:var(--ti-accordion-panel-body-bg);box-shadow:var(--ti-accordion-panel-body-shadow);padding:var(--ti-accordion-panel-body-padding)}"]
            },] }
];
TiAccordionItemComponent.ctorParameters = () => [
    { type: TiAccordionComponent, decorators: [{ type: Inject, args: [TiAccordionComponent,] }] },
    { type: ElementRef },
    { type: Renderer2 }
];
TiAccordionItemComponent.propDecorators = {
    disabled: [{ type: Input }],
    clickToggle: [{ type: Input }],
    headClick: [{ type: Output }],
    open: [{ type: Input }]
};

/**
 * 定义单个手风琴折叠面板头部内容,该组件包含在ti-accordion-item中使用
 * <example-url>../tiny3demo/#/accordion/acc-all</example-url>
 */
class TiAccordionHeadComponent {
}
TiAccordionHeadComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-accordion-head',
                template: '<ng-content></ng-content>'
            },] }
];

class TiAccordionModule {
}
TiAccordionModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule, TiCollapseModule, TiIconModule, TiOutlineModule],
                exports: [TiAccordionComponent, TiAccordionItemComponent, TiAccordionHeadComponent],
                declarations: [TiAccordionComponent, TiAccordionItemComponent, TiAccordionHeadComponent]
            },] }
];

/**
 * @ignore
 * 该类提供公共静态类方法，用于设置在body定位元素基于参照元素的位置信息,提供的核心方法如下：
 * setPosition()
 * 1. 入参为对象，参数信息如下：
 * {
 *   targetEle:需要定位的元素
 *   hostEle：参照元素
 *   position:定位位置
 *   hostSpace：待定位元素和参照元素间距
 *   browserSpace ：待定位元素和浏览器间距, 暂时只在上下位置生效
 *   hOffset: 自定义水平方向的偏移（在定位基础上的水平偏移，向左偏移为负值，向右偏移为正值）
 *   fixMaxHeight: 定位元素最大高度是否固定不变(显示不下时不用压缩高度)
 *   determinPositionFn：决定位置的函数
 * }
 * 2. 返回值为对象，信息如下：
 * {
 *   position:string 最终元素定位位置（当外部定义位置非13个可选位置时，会重新计算合适的位置进行定位，因此提供此位置信息供外部使用）
 *   avilableHeight:number 元素可用高度占位信息(外部可使用该信息进行高度的重新定义)
 * }
 */
class Position {
    static setPosition(options) {
        // 入参非有效元素情况下，不做处理
        if (!Util.isElement(options.hostEle) || !Util.isElement(options.targetEle)) {
            TiLog.warn('position: hostEle or targetEle type is not element');
            // 防止外部使用报错，此处做返回值处理
            return {
                position: 'top',
                avilableHeight: 9999
            };
        }
        // 分别获取宿主和待定位元素当前位置
        const curLayout = Position.getLayout(options.hostEle, options.targetEle, options.hostEleX);
        const hostSpace = options.hostSpace || 0;
        // 判断元素位置
        const position = (options.determinPositionFn) ? options.determinPositionFn(curLayout)
            : Position.determinPosition(options.position, curLayout, hostSpace, options.browserSpace || 0);
        const elePos = Position.getLayoutParam(curLayout, position, hostSpace, options.browserSpace || 0, options.hasOffsetFix || false);
        const hOffset = options.hOffset || 0;
        Position.setLayout(options.targetEle, elePos, curLayout, hOffset);
        Position.setMaxHeight(options.targetEle, elePos, curLayout, options.fixMaxHeight);
        Position.setDominatorDropDetachState(options.targetEle, elePos, curLayout, options.fixMaxHeight);
        return {
            position,
            avilableHeight: elePos.avilableHeight,
            hostLayout: curLayout.hostLayout
        };
    }
    /**
     * 添加影响host position的事件并返回其事件句柄
     * 由于Angular listen不支持多事件定义，因此在此处封装函数进行单独处理；此外，事件也不支持定义命名空间
     * 监听全局事件，用于处理页面位置出现变化导致宿主元素位置偏移，而tip的特殊情况下tip消失，
     * 并定义组件事件监听句柄，事件取消时会用到
     * 特殊场景包括：
     * 1. 拖动弹框位置导致的宿主元素位置变化
     * 2. 页面局部出滚动条，滚动条位置变化导致的宿主元素位置变化
     *    鼠标导致的滚轮事件可通过mousewheel/DOMMouseScroll监听（有冒泡的特性）
     *    拖拽导致的滚轮变化，需要业务通过trigger Tiny自定义事件tiScroll进行处理（无事件冒泡的特性）
     * 3.页面缩放
     * 4.路由切换页面
     */
    static addPosChangeEvts(eventCallback, render) {
        const eventHandles = [];
        // 修复SSR报错：ERROR ReferenceError: document is not defined
        if (typeof document === 'undefined') {
            return [];
        }
        // 需要添加的事件数据抽象
        const eventArr = [
            {
                ele: typeof document !== 'undefined' ? document : null,
                eventType: 'tiScroll',
                callback: eventCallback
            }, {
                ele: typeof window !== 'undefined' ? window : null,
                eventType: 'resize',
                callback: eventCallback
            }, {
                ele: typeof window !== 'undefined' ? window : null,
                eventType: 'hashchange',
                callback: eventCallback
            }
        ];
        eventArr.forEach((item) => {
            // 修复SSR问题： ERROR TypeError: Cannot read property 'addEventListener' of null
            if (item.ele) {
                return eventHandles.push(render.listen(item.ele, item.eventType, item.callback));
            }
        });
        return eventHandles;
    }
    /**
     * 清除绑定事件，与addPosChangeEvts对称
     */
    static removePosChangeEvts(eventHandles) {
        eventHandles.forEach((item) => {
            if (item) {
                item();
            }
        });
    }
    // 获取host和target元素的布局参数
    static getLayout(hostEle, targetEle, horizonHostEle) {
        const hostLayout = Position.getHostEleLayout(hostEle, horizonHostEle);
        return {
            hostLayout,
            targetLayout: Position.getEleLayout(targetEle),
            avilableLayout: Position.getAvilableLayout(hostLayout)
        };
    }
    /**
     * 根据高亮浮层位置及提示弹窗位置情况计算具体显示位置
     * @param  position 元素位置定义信息
     * @param  layout 宿主和待定位元素位置信息
     * @param  hostSpace 宿主和待定位元素间距
     * @param  browserSpace 浏览器和待定位元素间距
     * @returns 提示弹窗呈现位置
     */
    static determinPosition(position, layout, hostSpace, browserSpace) {
        // position定义有效情况下，不做处理
        if (Position.isValidPosition(position, layout, hostSpace, browserSpace)) {
            return position;
        }
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        // 元素位置距各部分位置
        const avilableLeft = avilableLayout.left;
        const avilableRight = avilableLayout.right;
        const avilableTop = avilableLayout.top;
        const avilableBottom = avilableLayout.bottom;
        const targetMaxWidth = targetLayout.width + hostSpace + browserSpace;
        const targetMaxHeight = targetLayout.height + hostSpace + browserSpace;
        const hostLayout = layout.hostLayout;
        if (avilableTop >= targetMaxHeight) { // 上方可显示完全
            const positionTop = Position.determinHorizon(layout, hostLayout);
            if (positionTop !== undefined) {
                return 'top' + positionTop;
            }
        }
        if (avilableRight >= targetMaxWidth) { // 右侧可显示完全，具体思路同上方可显示完全情况
            const positionRight = Position.determinVertical(layout, hostLayout);
            if (positionRight !== undefined) {
                return 'right' + positionRight;
            }
        }
        if (avilableBottom >= targetMaxHeight) { // 下方可显示完全，具体思路同上方可显示完全情况
            const positionBottom = Position.determinHorizon(layout, hostLayout);
            if (positionBottom !== undefined) {
                return 'bottom' + positionBottom;
            }
        }
        if (avilableLeft >= targetMaxWidth) { // 左侧足够显示情况下，左侧居中显示
            const positionLeft = Position.determinVertical(layout, hostLayout);
            if (positionLeft !== undefined) {
                return 'left' + positionLeft;
            }
        }
        return 'center'; // 上下左右均无法足够显示情况下，居中显示内容
    }
    /**
     * 垂直位置确定后，确定水平位置
     */
    static determinHorizon(layout, hostLayout) {
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        const avilableLeft = avilableLayout.left;
        const avilableMaxLeft = avilableLayout.maxLeft;
        const avilableRight = avilableLayout.right;
        const avilableMaxRight = avilableLayout.maxRight;
        const targetWidth = targetLayout.width;
        const targetCenterWidth = (targetLayout.width - hostLayout.width) / 2; // 水平居中情况下，左右侧占用的宽度分别比宿主元素宽多少
        if ((avilableRight >= targetCenterWidth) &&
            (avilableLeft >= targetCenterWidth)) { // 提示元素超出被提示元素部分足够显示的情况下，优先居中显示
            return '';
        }
        if (avilableMaxRight >= targetWidth) { // 提示元素可在被提示元素左边界靠右完全显示情况下，向右显示
            return '-left';
        }
        if (avilableMaxLeft >= targetWidth) { // 提示元素可在被提示元素左边界靠左完全显示情况下，向左显示
            return '-right';
        }
    }
    /**
     * 水平位置确定后，确定垂直位置
     */
    static determinVertical(layout, hostLayout) {
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        const avilableTop = avilableLayout.top;
        const avilableMaxTop = avilableLayout.maxTop;
        const avilableBottom = avilableLayout.bottom;
        const avilableMaxBottom = avilableLayout.maxBottom;
        const targetHeight = targetLayout.height;
        const targetMiddleHeight = (targetLayout.height - hostLayout.height) / 2; // 垂直居中情况下，上下两侧占用的高度分别比宿主元素高多少
        if ((avilableTop >= targetMiddleHeight) &&
            (avilableBottom >= targetMiddleHeight)) {
            return '';
        }
        if (avilableMaxBottom >= targetHeight) {
            return '-top';
        }
        if (avilableMaxTop >= targetHeight) {
            return '-bottom';
        }
    }
    // 判断定义的position是否为有效位置
    static isValidPosition(position, layout, hostSpace, browserSpace) {
        if (Position.positionArr.indexOf(position) === -1) {
            return false;
        }
        // 判断在指定的position是否能显示下
        const positionFragments = position.split('-');
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        // 元素位置距各部分位置
        const avilableLeft = avilableLayout.left;
        const avilableRight = avilableLayout.right;
        const avilableTop = avilableLayout.top;
        const avilableBottom = avilableLayout.bottom;
        const targetMaxWidth = targetLayout.width + hostSpace + browserSpace;
        const targetMaxHeight = targetLayout.height + hostSpace + browserSpace;
        if (positionFragments[0] === 'top') {
            if (avilableTop < targetMaxHeight) {
                return false;
            }
            return Position.isValidHorizonPosition(positionFragments[1], layout);
        }
        if (positionFragments[0] === 'bottom') {
            if (avilableBottom < targetMaxHeight) {
                return false;
            }
            return Position.isValidHorizonPosition(positionFragments[1], layout);
        }
        if (positionFragments[0] === 'left') {
            if (avilableLeft < targetMaxWidth) {
                return false;
            }
            return Position.isValidVerticalPosition(positionFragments[1], layout);
        }
        if (positionFragments[0] === 'right') {
            if (avilableRight < targetMaxWidth) {
                return false;
            }
            return Position.isValidVerticalPosition(positionFragments[1], layout);
        }
        return true;
    }
    // 确定垂直位置是有效的后，判断水平位置是否有效
    static isValidHorizonPosition(horizonPosition, layout) {
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        const hostLayout = layout.hostLayout;
        const avilableLeft = avilableLayout.left;
        const avilableRight = avilableLayout.right;
        const avilableMaxLeft = avilableLayout.maxLeft;
        const avilableMaxRight = avilableLayout.maxRight;
        const targetWidth = targetLayout.width;
        const targetCenterWidth = (targetLayout.width - hostLayout.width) / 2; // 水平居中情况下，左右侧占用的宽度分别比宿主元素宽多少
        if (!horizonPosition) {
            return (avilableRight >= targetCenterWidth) && (avilableLeft >= targetCenterWidth);
        }
        if (horizonPosition === 'left') {
            return avilableMaxRight >= targetWidth;
        }
        if (horizonPosition === 'right') {
            return avilableMaxLeft >= targetWidth;
        }
        return false;
    }
    // 确定水平位置是有效的后，判断垂直位置是否有效
    static isValidVerticalPosition(verticalPosition, layout) {
        const targetLayout = layout.targetLayout;
        const avilableLayout = layout.avilableLayout;
        const hostLayout = layout.hostLayout;
        const avilableTop = avilableLayout.top;
        const avilableBottom = avilableLayout.bottom;
        const avilableMaxTop = avilableLayout.maxTop;
        const avilableMaxBottom = avilableLayout.maxBottom;
        const targetHeight = targetLayout.height;
        const targetMiddleHeight = (targetLayout.height - hostLayout.height) / 2; // 垂直居中情况下，上下两侧占用的高度分别比宿主元素高多少
        if (!verticalPosition) {
            return (avilableTop >= targetMiddleHeight) && (avilableBottom >= targetMiddleHeight);
        }
        if (verticalPosition === 'top') {
            return avilableMaxBottom >= targetHeight;
        }
        if (verticalPosition === 'bottom') {
            return avilableMaxTop >= targetHeight;
        }
        return false;
    }
    // 设置提示弹窗位置
    static setLayout(ele, position, layoutParam, hOffset) {
        if (layoutParam.hostLayout.isFixed) { // fixed定位情况下，滚动条对其不受影响，因此此处需要减掉滚动条的位置影响
            ele.style.position = 'fixed';
            ele.style.left = `${position.left - window.pageXOffset + hOffset}px`;
            ele.style.top = `${position.top - window.pageYOffset}px`;
        }
        else {
            ele.style.left = `${position.left + hOffset}px`;
            ele.style.top = `${position.top}px`;
        }
    }
    // 设置提示弹窗的MaxHeight
    static setMaxHeight(ele, position, layoutParam, fixMaxHeight) {
        if (fixMaxHeight || position.avilableHeight >= layoutParam.targetLayout.height) {
            return;
        }
        ele.style.maxHeight = `${position.avilableHeight}px`;
    }
    /**
     * 当drop固定高度（设置fixMaxHeight=ture)，且空间不足时，dominator和drop不相邻，此场景需要隐藏drop中的边框覆盖线，
     * 添加样式类'ti3-detach-dominator-drop'标记drop的这种场景状态，通过css样式控制drop中边框覆盖线的隐藏和显示
     * 目前该场景出现在日期类组件中
     */
    static setDominatorDropDetachState(ele, position, layoutParam, fixMaxHeight) {
        if (!fixMaxHeight) {
            return;
        }
        if (position.avilableHeight < layoutParam.targetLayout.height) {
            ele.classList.add('ti3-detach-dominator-drop');
        }
        else {
            ele.classList.remove('ti3-detach-dominator-drop');
        }
    }
    static getEleLayout(ele) {
        // 修复SSR报错：ERROR TypeError: ele.getBoundingClientRect is not a function
        return {
            top: ele.offsetTop,
            left: ele.offsetLeft,
            width: (typeof ele.getBoundingClientRect) === 'function' ? ele.getBoundingClientRect().width : 0,
            height: (typeof ele.getBoundingClientRect) === 'function' ? ele.getBoundingClientRect().height : 0
        };
    }
    static getHostEleLayout(hostEle, horizonHostEle) {
        let horizonEle = hostEle;
        if (Util.isElement(horizonHostEle)) {
            horizonEle = horizonHostEle;
        }
        // 修复SSR报错：ERROR TypeError: hostEle.getBoundingClientRect is not a function
        // 元素相对于windows的位置
        let top = (typeof hostEle.getBoundingClientRect) === 'function' ? hostEle.getBoundingClientRect().top : 0;
        let left = (typeof hostEle.getBoundingClientRect) === 'function' ? horizonEle.getBoundingClientRect().left : 0;
        // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
        // 下面利用body相对于windows的位置，计算元素相对于body的位置。
        /* tslint:disable:no-null-keyword */
        const bodyPositon = (typeof getComputedStyle === 'function') ? getComputedStyle(document.body, null).position : 'static';
        // body是static|relative|absolute|fixed都已测试，Chrome高低版本/Firefox/IE11已测。
        if (bodyPositon === 'static') { // static时，body对window没有偏移，但是需要考虑页面滚动条
            if (typeof window !== 'undefined') {
                top += window.pageYOffset;
                left += window.pageXOffset;
            }
        }
        else {
            // relative|fix|absolute时，需要考虑body相对于windows的偏移。
            top -= document.body.getBoundingClientRect().top;
            left -= document.body.getBoundingClientRect().left;
        }
        return {
            top,
            left,
            width: horizonEle.offsetWidth,
            height: hostEle.offsetHeight,
            isFixed: this.isFixedPos(hostEle)
        };
    }
    static getAvilableLayout(hostLayout) {
        // 修复报错：ERROR ReferenceError: document is not defined
        // 当前浏览器可视区域的宽高
        const curBrowseWidth = (typeof document !== 'undefined') ? document.documentElement.clientWidth : 0;
        const curBrowseheight = (typeof document !== 'undefined') ? document.documentElement.clientHeight : 0;
        // 元素位置距各部分位置:
        // 1.以元素四个边为边界，上下左右预留的可用宽高，用avilableLeft等标识
        // 2.去掉元素的宽高占位，计算的最大可用宽高，用avilableMax...标识
        // 修复SSR错误：ERROR ReferenceError: pageXOffset is not defined
        const avilableLeft = hostLayout.left - ((typeof window !== 'undefined') ? window.pageXOffset : 0);
        const avilableMaxLeft = avilableLeft + hostLayout.width;
        const avilableRight = curBrowseWidth - avilableMaxLeft;
        const avilableMaxRight = curBrowseWidth - avilableLeft;
        // document.body.scrollTop  document.documentElement.scrollTop存在浏览器差异，chrome高低版本表现不同。
        const avilableTop = hostLayout.top - ((typeof window !== 'undefined') ? window.pageYOffset : 0); // pageYOffset支持IE9以上。
        const avilableMaxTop = avilableTop + hostLayout.height;
        const avilableBottom = curBrowseheight - avilableMaxTop;
        const avilableMaxBottom = curBrowseheight - avilableTop;
        return {
            left: avilableLeft,
            maxLeft: avilableMaxLeft,
            right: avilableRight,
            maxRight: avilableMaxRight,
            top: avilableTop,
            maxTop: avilableMaxTop,
            bottom: avilableBottom,
            maxBottom: avilableMaxBottom,
            clientHeight: curBrowseheight,
            clientWidth: curBrowseWidth
        };
    }
    // 确定元素是否为fixed定位
    static isFixedPos(ele) {
        if (!ele || ele.nodeName === 'HTML') {
            return false;
        }
        // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return false;
        }
        if (getComputedStyle(ele).position === 'fixed') {
            return true;
        }
        return this.isFixedPos(ele.parentNode);
    }
    static getLayoutParam(layout, position, hostSpace, browserSpace, hasOffsetFix) {
        const positionArr = position.split('-'); // 跟上面静态变量重名,最好改一下
        const left = Position.getHorizionParam(layout, positionArr, hostSpace, hasOffsetFix);
        const verticalParam = Position.getVerticalParam(layout, positionArr, hostSpace, browserSpace, hasOffsetFix);
        return {
            left,
            top: verticalParam.top,
            avilableHeight: verticalParam.avilableHeight
        };
    }
    static getHorizionParam(curLayout, posArr, space, hasOffsetFix) {
        const hostLayout = curLayout.hostLayout;
        const targetLayout = curLayout.targetLayout;
        // 定位偏差调整量（该偏差量针对较小元素，保证 tip 的箭头在被提示元素的中间）
        const offset = hasOffsetFix ? this.getOffsetFixVal(curLayout.hostLayout.width) : 0;
        // 'left', 'left-top', 'left-bottom'
        if (posArr[0] === 'left') {
            return hostLayout.left - targetLayout.width - space;
        }
        // 'right', 'right-top', 'right-bottom'
        if (posArr[0] === 'right') {
            return hostLayout.left + hostLayout.width + space;
        }
        // 'top-left', 'bottom-left'
        if (posArr[1] === 'left') {
            return hostLayout.left - offset;
        }
        // 'top-right', 'bottom-right'
        if (posArr[1] === 'right') {
            return hostLayout.left + hostLayout.width - targetLayout.width + offset;
        }
        // 'top', 'bottom', 'center'
        return hostLayout.left - (targetLayout.width - hostLayout.width) / 2;
    }
    static getVerticalParam(curLayout, posArr, hostSpace, browserSpace, hasOffsetFix) {
        const avilableLayout = curLayout.avilableLayout; // 宿主元素对应的可用位置参数
        const hostHeight = curLayout.hostLayout.height; // 宿主元素本身高度
        const targetLayout = curLayout.targetLayout;
        const hostLayout = curLayout.hostLayout;
        // 定位偏差调整量（该偏差量针对较小元素，保证 tip 的箭头在被提示元素的中间）
        const offset = hasOffsetFix ? this.getOffsetFixVal(curLayout.hostLayout.height) : 0;
        // 纵向可用高度是根据位置中top、bottom、居中情况进行的处理,因此,此处先将position进行分割，再根据其情况进行可用高度计算
        // 弹出元素下边线与宿主元素上边线相接后，弹出元素向上延伸情况，对应位置包含'top', 'top-left', 'top-right'
        if (posArr[0] === 'top') {
            const avilableHeight = avilableLayout.top - hostSpace - browserSpace;
            const top = (avilableHeight >= targetLayout.height) ?
                (hostLayout.top - targetLayout.height - hostSpace) :
                (hostLayout.top - avilableLayout.top + browserSpace);
            return {
                avilableHeight,
                top
            };
        }
        // 弹出元素上边线与宿主元素下边线相接后，弹出元素向下延伸情况，对应位置包含'bottom', 'bottom-left', 'bottom-right'
        if (posArr[0] === 'bottom') {
            return {
                avilableHeight: avilableLayout.bottom - hostSpace - browserSpace,
                top: hostLayout.top + hostLayout.height + hostSpace
            };
        }
        // 弹出元素上边线与宿主元素上边线对齐情况，对应位置包含'left-top', 'right-top'
        if (posArr[1] === 'top') {
            return {
                avilableHeight: avilableLayout.bottom + hostHeight,
                top: hostLayout.top - offset
            };
        }
        // 弹出元素上边线与宿主元素下边线对齐情况，对应位置包含'right-bottom', 'left-bottom'
        if (posArr[1] === 'bottom') {
            return {
                avilableHeight: avilableLayout.top + hostHeight,
                top: hostLayout.top + hostLayout.height - targetLayout.height + offset
            };
        }
        // 弹出元素中线与宿主元素中线对齐情况，对应位置包含'left', 'right', 'center'
        return {
            avilableHeight: avilableLayout.clientHeight,
            top: hostLayout.top - (targetLayout.height - hostLayout.height) / 2
        };
    }
    // 获取定位偏差调整量
    static getOffsetFixVal(hostLayoutSize) {
        return hostLayoutSize / 2 < Position.ADAPTIVE_SIZE ?
            Position.ADAPTIVE_SIZE - hostLayoutSize / 2 : 0;
    }
}
Position.positionArr = ['top', 'top-left', 'top-right', 'bottom', 'bottom-left', 'bottom-right',
    'left', 'left-top', 'left-bottom', 'right', 'right-top', 'right-bottom', 'center'];
/* tip 针对较小元素做位置自适应处理，保证 tip 的箭头在被提示元素的中间，这是宽度或者高度的阈值
 * 取值为 15 的原因： 箭头定位偏移量9 + 箭头宽度的一半6 = 15px 相关变量变化时需要修改该常量
 */
Position.ADAPTIVE_SIZE = 15;

/**
 * @ignore
 * 纯下拉面板组件，只有面板，没有内容。因为有时朝上弹，dropdown/dropup合称drop
 */
class TiDropComponent extends TiBaseComponent {
    constructor(hostRef, renderer, applicationRef) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.applicationRef = applicationRef;
        /**
         * 下拉面板的最大显示宽度，该变量与下拉类组件保持一致
         *
         * 1."justified"(默认): 下拉框的宽度与Select组件的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉选项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于Select组件的宽度)。例如："200px"
         */
        this.panelWidth = 'justified'; // 面板宽度
        /**
         * 面板最大高度
         */
        this.panelMaxHeight = '9999px'; // 面板最大高度
        /**
         * 空间不足时，依然保持固定高度。 select search等是可变最大高度，日历是固定最大高度。
         * 再就是上下空间都不足时，日历从下方弹出。
         */
        this.fixMaxHeight = false; // 再就是上下空间都不足时，日历从下方弹出。
        /**
         * 主题样式控制
         */
        this.theme = 'border';
        /**
         * 距离宿主元素距离，像素值
         */
        this.dominatorSpace = TiDropComponent.DOMINATOR_SPACE + 'px';
        /**
         * 距离浏览器上或下边沿的距离，像素值
         */
        this.browserSpace = TiDropComponent.BROWSER_SPACE + 'px';
        /**
         * 在定位基础上的水平方向的偏移，向左偏移为负值，向右偏移为正值，像素值
         */
        this.hOffset = 0;
        /**
         * 面板对齐方式
         */
        this.panelAlign = 'left';
        /**
         * @ignore
         */
        this.dropSubject = new Subject();
        this.posHandles = [];
        // 决定上下位置的函数
        this.defaultDeterminPositionFn = (layout) => {
            const dominatorSpace = parseInt(this.dominatorSpace, 10);
            const browserSpace = parseInt(this.browserSpace, 10);
            const needHeight = layout.targetLayout.height + dominatorSpace + browserSpace;
            if (layout.avilableLayout.bottom >= needHeight) { // 下方空间足够，向下展开
                return this.panelAlign === 'left' ? 'bottom-left' : 'bottom-right';
            }
            else if (layout.avilableLayout.top >= needHeight) { // 上方空间足够，向上展开
                return this.panelAlign === 'left' ? 'top-left' : 'top-right';
            }
            else if (layout.avilableLayout.bottom >= layout.avilableLayout.top) { // 下方空间较大，则向下展开
                // 因为日历组件存在问题，最大高度不压缩，极端情况时会显示在top为负显示不全。所以日历组件尽量向下弹出。
                return this.panelAlign === 'left' ? 'bottom-left' : 'bottom-right';
            }
            return this.panelAlign === 'left' ? 'top-left' : 'top-right'; // 向上展开
        };
    }
    /**
     * 外部接口: 获取当前状态, 只读不写
     */
    get isShow() {
        return this.hostRef.nativeElement.style.display === 'block';
    }
    ngOnDestroy() {
        // 从body上摘除。
        this.renderer.removeChild(this.renderer.parentNode(this.hostRef.nativeElement), this.hostRef.nativeElement);
        this.unlistenPosition();
    }
    /**
     * 切换面板状态：打开/关闭
     */
    toggle() {
        this.isShow ? this.hide() : this.show();
    }
    /**
     * 打开面板
     */
    show() {
        if (this.isShow) {
            return;
        }
        // 挂在body上，极远处
        this.appendToBodyFarAway();
        // 先显示，才能再计算
        this.setShow();
        this.setPanelWidth();
        // 设置位置：居下优先，居上其次
        this.setPosition();
        this.listenPosition();
        this.dropSubject.next(true);
        // const result = this.setPosition();
        // setTimeout(()=>{this.setPosition()},0);
        // 设置MaxHeight //此逻辑已经放入Position
        // this.setPanelMaxHeight(result.avilableHeight);
        // 设置Width。确保在显示之后设置下拉框的宽度，避免滚动条的影响
        // this.setPanelWidth();
    }
    /**
     * 关闭面板
     */
    hide() {
        if (!this.isShow) {
            return;
        }
        this.renderer.setStyle(this.hostRef.nativeElement, 'display', 'none');
        this.unlistenPosition();
    }
    appendToBodyFarAway() {
        // 如果不在body上，那么挂在body上。（逻辑应该移入Position.setPosition吧，因为那位置就是按照body定的，不在body会出错。）
        if (this.renderer.parentNode(this.hostRef.nativeElement) !== document.body) {
            this.renderer.appendChild(document.body, this.hostRef.nativeElement);
            const embeddedViewRef = this.dropTemplateRef.createEmbeddedView(null);
            this.applicationRef.attachView(embeddedViewRef); // 不做此处处理，ng-template中的标签不会解析
            Array.from(embeddedViewRef.rootNodes)
                .forEach((item) => {
                this.renderer.appendChild(this.hostRef.nativeElement, item);
            });
        }
        // 设置在极远处（逻辑应该移入Position.setPosition吧）
        this.renderer.setStyle(this.hostRef.nativeElement, 'left', '-9999px');
        this.renderer.setStyle(this.hostRef.nativeElement, 'top', '-9999px');
        // 更新max-height为默认值panelMaxHeight，因为上次显示可能更改了max-height
        this.renderer.setStyle(this.hostRef.nativeElement, 'max-height', this.panelMaxHeight);
        // 设置width,当出现滚动条时,更新width为默认的panelWidth，避免滚动条宽度的影响
        if (this.panelWidth === 'auto') {
            this.renderer.setStyle(this.hostRef.nativeElement, 'width', this.panelWidth);
        }
    }
    setShow() {
        // 显示才能计算宽度
        this.renderer.setStyle(this.hostRef.nativeElement, 'display', 'block');
    }
    /**
     * 监听位置变化, 并隐藏面板。打开面板时监听，关闭和销毁时取消监听。
     * TODO: 尝试hide改为rePosition
     */
    listenPosition() {
        this.posHandles = Position.addPosChangeEvts(() => {
            this.hide();
        }, this.renderer);
    }
    unlistenPosition() {
        Position.removePosChangeEvts(this.posHandles);
    }
    /**
     * 确定元素的显示样式，包括位置、最大高度、向上或向下
     * @returns 定位结果对象
     */
    setPosition() {
        const dominatorSpace = parseInt(this.dominatorSpace, 10);
        const browserSpace = parseInt(this.browserSpace, 10);
        const determinPositionFn = Util.isFunction(this.determinPositionFn) ? this.determinPositionFn :
            this.defaultDeterminPositionFn;
        // 设置位置
        const result = Position.setPosition({
            targetEle: this.hostRef.nativeElement,
            hostEle: this.dominatorElem,
            // position: undefined, // 可选参数
            hostSpace: dominatorSpace,
            browserSpace,
            fixMaxHeight: this.fixMaxHeight,
            hOffset: this.hOffset,
            determinPositionFn
        });
        return result.hostLayout;
    }
    resetPosition() {
        // 记录上一次dominator left值
        const hostLayout = this.setPosition();
        const dominatorLastLeft = hostLayout && hostLayout.left;
        // 记录当前dominator left值
        const dominatorCurLeft = Position.getHostEleLayout(this.dominatorElem).left;
        // dominator发生水平位移且面板处于打开状态时，需重新定位
        // 主要场景：下拉面板数据量变动引起body出现竖向滚动条，dominator发生水平方向偏移;
        if (dominatorLastLeft !== dominatorCurLeft) {
            if (this.isShow) {
                this.setPosition();
            }
        }
    }
    setPanelWidth() {
        const panelWidthNum = parseInt(this.panelWidth, 10);
        const scrollWidth = this.hostRef.nativeElement.offsetWidth - this.hostRef.nativeElement.clientWidth;
        const dominatorElemWidth = this.dominatorElem.offsetWidth;
        let width;
        if (!isNaN(panelWidthNum)) {
            width = panelWidthNum + 'px';
        }
        else if (this.panelWidth === 'auto') {
            width = 'auto';
            // Fix bug: 非IE下滚动条会覆盖部分内容
            if (!TiBrowser.isIE()) {
                // 需要重置宽度设置，根据下拉面板的真实宽度确定是否需要增加滚动条宽度
                width = null;
                // 有滚动条出现且文本较长时，需要再增加滚动条的宽度，否则内容显示不全
                if (scrollWidth) {
                    width = this.hostRef.nativeElement.offsetWidth + scrollWidth + 'px';
                }
            }
            const minWidth = dominatorElemWidth + 'px';
            this.renderer.setStyle(this.hostRef.nativeElement, 'min-width', minWidth);
        }
        else {
            // 默认宽度设置，包含justified
            width = dominatorElemWidth + 'px';
        }
        // 设置
        this.renderer.setStyle(this.hostRef.nativeElement, 'width', width);
    }
}
/**
 * 设置下拉距离dominator的距离：默认没有间距
 */
TiDropComponent.DOMINATOR_SPACE = 4;
/**
 * 控制下拉框距离浏览器上下边沿的距离为5px，预留一个余量，防止显示不了边框
 */
TiDropComponent.BROWSER_SPACE = 5;
TiDropComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-drop',
                template: "\r\n<ng-template #dropTemplateRef>\r\n    <ng-content></ng-content>\r\n</ng-template>\r\n\r\n",
                host: {
                    '[class.ti3-dropdown-container]': 'true',
                    '[class.ti3-dropdown-container-border]': 'theme ==="border"',
                    '[style.height]': 'panelHeight'
                },
                styles: [":host.ti3-dropdown-container{-ms-box-sizing:border-box;background-color:#fff;box-shadow:var(--ti-common-shadow-2-down);box-sizing:border-box;color:var(--ti-input-text-color);display:none;position:absolute;z-index:1060}:host.ti3-dropdown-container-border{border-radius:var(--ti-input-border-radius)}:host .ti3-drop-cover-line{background:var(--ti-common-color-line-dividing);height:1px;position:absolute}"]
            },] }
];
TiDropComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ApplicationRef }
];
TiDropComponent.propDecorators = {
    panelWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    panelHeight: [{ type: Input }],
    dominatorElem: [{ type: Input }],
    fixMaxHeight: [{ type: Input }],
    theme: [{ type: Input }],
    dominatorSpace: [{ type: Input }],
    browserSpace: [{ type: Input }],
    hOffset: [{ type: Input }],
    determinPositionFn: [{ type: Input }],
    panelAlign: [{ type: Input }],
    dropTemplateRef: [{ type: ViewChild, args: ['dropTemplateRef', { static: true },] }]
};
// offsetWidth属性可以返回对象的padding+border+width属性值之和, 是整数。与jQuery的outerWidth()完全相同，outerWidth(true)带有外边距。
// Element.clientWidth 属性表示元素的内部宽度，以像素计。该属性包括内边距，但不包括垂直滚动条（如果有）、边框和外边距。

/**
 * @ignore
 */
class TiDropModule {
}
TiDropModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiDropComponent],
                declarations: [TiDropComponent]
            },] }
];

/**
 * @ignore
 */
class TiPopupModule {
}
TiPopupModule.decorators = [
    { type: NgModule, args: [{
                imports: []
            },] }
];

/* eslint-disable no-param-reassign */
/**
 * @ignore
 */
class ContentRef {
    constructor(nodes, viewRef, componentRef) {
        this.nodes = nodes;
        this.viewRef = viewRef;
        this.componentRef = componentRef;
    }
}
/**
 * @ignore
 */
class TiPopupService {
    constructor(injector, rendererFactory, componentFactoryResolver, applicationRef, domSanitizer, document) {
        this.injector = injector;
        this.componentFactoryResolver = componentFactoryResolver;
        this.applicationRef = applicationRef;
        this.domSanitizer = domSanitizer;
        this.document = document;
        this.getContentRef = (content, context) => {
            // ng-template形式
            if (content instanceof TemplateRef) {
                // 将template实例化为内嵌视图,并将其放在可运行环境中进行解析
                const embeddedViewRef = content.createEmbeddedView({ context });
                this.applicationRef.attachView(embeddedViewRef); // 不做此处处理，ng-template中的标签不会解析
                return new ContentRef([embeddedViewRef.rootNodes], embeddedViewRef);
            }
            // 组件形式
            if (typeof content === 'function') {
                // 根据传入的component类（即content）创建组件引用
                const componentRef = this.createCompoentRef({
                    componentType: content,
                    context,
                    notDetectChanges: true
                });
                return new ContentRef([[componentRef.location.nativeElement]], componentRef.hostView, componentRef);
            }
            // element Dom形式
            if (content instanceof HTMLElement) {
                return new ContentRef([[content]]);
            }
            // string形式 或 SafeHtml(object类型) 形式，
            if (typeof content === 'string' || typeof content === 'object') {
                const wrapEle = this.renderer.createElement('div');
                wrapEle.innerHTML = this.domSanitizer.sanitize(SecurityContext.HTML, content);
                return new ContentRef([wrapEle.childNodes]);
            }
            return new ContentRef([]);
        };
        /* tslint:disable:no-null-keyword */
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    getParentEle(containerOpt) {
        if (containerOpt instanceof ElementRef) { // 父元素为正常element元素情况下
            return containerOpt.nativeElement;
        }
        else if (containerOpt === 'body') { // 父容器为body元素情况下
            return this.document.body;
        }
    }
    // 销毁组件相关内容
    static destroyComponentRef(_componentRef) {
        if (!_componentRef) {
            return;
        }
        // 销毁组件实例
        _componentRef.destroy();
        _componentRef = null;
    }
    // 销毁弹出内容相关内容
    static destroyContentRef(contentRef) {
        // 弹出内容如果有组件实例对象时，销毁组件实例
        if (contentRef.componentRef) {
            contentRef.componentRef.destroy();
        }
        // 销毁页面视图实例
        if (contentRef.viewRef) {
            contentRef.viewRef.destroy();
        }
        // 销毁内容实例
        contentRef = null;
    }
    create(componentType) {
        let _contentRef; // 弹出内容实例
        let _componentRef; // 生成的组件实例对象
        return {
            show: (options) => {
                // component已生成情况下，不再重复生成
                if (_componentRef) {
                    return _componentRef;
                }
                // 获取内容相关信息,包括：组件节点信息、组件实例信息、组件最小视图信息
                _contentRef = this.getContentRef(options && options.content, options && options.contentContext);
                // 创建组件实例：为内容本身再包一层父容器组件，用于控制组件（componentType）
                _componentRef = this.createCompoentRef({
                    componentType,
                    nodes: _contentRef.nodes,
                    context: options && options.context
                });
                // 将元素放置在指定容器中
                const parentEle = this.getParentEle(options && options.container);
                if (parentEle) {
                    parentEle.appendChild(_componentRef.location.nativeElement);
                }
                // 这时弹出内容已经append,可以对弹出内容进行解析了。
                // 弹出内容中某些元素会在初始化时需要获取自身DOM宽高等，所以要保证弹出内容先append，然后再解析。
                // 解析ng-template形式的弹出内容实例
                if (options.content instanceof TemplateRef) {
                    // 确保数据变化均可以被检测到
                    _contentRef.viewRef.markForCheck();
                    // 执行一次变化检测
                    _contentRef.viewRef.detectChanges();
                }
                // 解析component形式的弹出内容实例
                if (typeof options.content === 'function') {
                    // 在组件的 metadata 中如果设置了OnPush 条件，那么变化检测不会再次执行,
                    // 但是调用该方法，可以确保数据变化被检测到
                    _contentRef.componentRef.changeDetectorRef.markForCheck();
                    // 从该组件到其子组件执行一次变化检测
                    _contentRef.componentRef.changeDetectorRef.detectChanges();
                }
                _componentRef.tiContentRef = _contentRef;
                return _componentRef;
            },
            hide: () => {
                if (!_componentRef) {
                    return;
                }
                TiPopupService.destroyComponentRef(_componentRef);
                TiPopupService.destroyContentRef(_contentRef);
                // 由于该变量在destroyComponentRef函数中赋为null不会改变外部值的改变，导致下次show时判断错误，因此此处需要做处理
                _componentRef = null;
            }
        };
    }
    /**
     * 创建组件实例
     * options {
     *   componentType: 组件类
     *   nodes：组件中的可注入节点
     *   context: 组件属性配置,inputs属性均可在此配置
     * }
     */
    createCompoentRef(options) {
        // 1. 根据component类创建组件引用
        const componentRef = this.componentFactoryResolver
            .resolveComponentFactory(options.componentType)
            .create(this.injector, options.nodes);
        // 2. 将组件绑定在ng component树上，不做绑定情况下，内容中的指令无法解析
        this.applicationRef.attachView(componentRef.hostView);
        // 3. 绑定组件上下文定义
        Object.assign(componentRef.instance, options.context);
        // outputs事件绑定
        if (options.context && !Util.isUndefined(options.context.outputs)) {
            for (const key in options.context.outputs) {
                if (options.context.outputs.hasOwnProperty(key)) {
                    componentRef.instance[key].subscribe(options.context.outputs[key]);
                }
            }
        }
        // 4. 确保组件视图根据数据能实时刷新上。
        // 通过该处理可以确保组件及子组件都完成解析
        if (!options.notDetectChanges) {
            // 在组件的 metadata 中如果设置了OnPush 条件，那么变化检测不会再次执行,
            // 但是调用该方法，可以确保数据变化被检测到
            componentRef.changeDetectorRef.markForCheck();
            // 从该组件到其子组件执行一次变化检测
            componentRef.changeDetectorRef.detectChanges();
        }
        return componentRef;
    }
}
TiPopupService.ɵprov = ɵɵdefineInjectable({ factory: function TiPopupService_Factory() { return new TiPopupService(ɵɵinject(INJECTOR), ɵɵinject(RendererFactory2), ɵɵinject(ComponentFactoryResolver), ɵɵinject(ApplicationRef), ɵɵinject(DomSanitizer), ɵɵinject(DOCUMENT)); }, token: TiPopupService, providedIn: TiPopupModule });
TiPopupService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiPopupModule
            },] }
];
TiPopupService.ctorParameters = () => [
    { type: Injector },
    { type: RendererFactory2 },
    { type: ComponentFactoryResolver },
    { type: ApplicationRef },
    { type: DomSanitizer },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];

/**
 * @ignore
 */
class TiRendererModule {
}
TiRendererModule.decorators = [
    { type: NgModule, args: [{
                imports: []
            },] }
];

/**
 * @ignore
 */
class TiRenderer {
    constructor(rendererFactory) {
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    /**
     * @description: 将节点插入某节点元素之后
     * @param: sourceEle 被插入节点
     * @param: targetEle 节点插入位置
     */
    insertAfter(sourceEle, targetEle) {
        const parent = targetEle.parentNode;
        // 如果最后的节点是目标元素,则直接添加
        if (parent.lastChild === targetEle) {
            this.renderer.appendChild(parent, sourceEle);
        }
        else { // 如果不是,则插在目标元素的下一个兄弟节点之前
            this.renderer.insertBefore(parent, sourceEle, targetEle.nextSibling);
        }
    }
    /**
     * @description: 判读一个元素上是否存在某个样式类名
     * @param: ele 被判断的元素
     * @param: className 样式类名
     */
    hasClass(element, className) {
        const classList = element.classList;
        return classList.contains(className);
    }
    /**
     * @description: 给指定元素设置属性
     * @param: element 被设置的元素
     * @param: attr Object 属性对象
     */
    setAttributes(element, attr) {
        for (const key in attr) {
            if (attr.hasOwnProperty(key)) {
                this.renderer.setAttribute(element, key, String(attr[key]));
            }
        }
    }
    /**
     * @description: 为元素添加多个样式
     * @param: ele 元素对象
     * @param: styles  Object 样式对象，如：{width: 100, height: 200}
     */
    setStyles(ele, styles) {
        for (const key in styles) {
            if (styles.hasOwnProperty(key)) {
                this.renderer.setStyle(ele, key, styles[key]);
            }
        }
    }
    /**
     * @description: 将节点插入某父容器，作为第一个元素
     * @param: parentEle 父节点元素
     * @param: sourceEle 需要插入的节点元素
     */
    prepend(parentEle, sourceEle) {
        if (!parentEle) {
            return;
        }
        this.renderer.insertBefore(parentEle, sourceEle, parentEle.firstElementChild);
    }
    /**
     * @description: 查找一个元素下有某个样式类的子元素
     * @param: element 被查找的元素
     * @param: className 子元素的样式类名
     */
    findChildrenByClassName(element, className) {
        let resultChildren = [];
        resultChildren = Array.from(element.children).filter((child) => {
            return this.hasClass(child, className);
        });
        return resultChildren;
    }
    /**
     * @description: 查找一个元素下有某个样式类的子元素
     * @param: element 被查找的元素
     * @param: className 子元素的样式类名
     */
    findChildrenByTagName(element, tagName) {
        let resultChildren = [];
        resultChildren = Array.from(element.children).filter((child) => {
            return child.tagName === tagName;
        });
        return resultChildren;
    }
}
TiRenderer.ɵprov = ɵɵdefineInjectable({ factory: function TiRenderer_Factory() { return new TiRenderer(ɵɵinject(RendererFactory2)); }, token: TiRenderer, providedIn: TiRendererModule });
TiRenderer.decorators = [
    { type: Injectable, args: [{
                providedIn: TiRendererModule
            },] }
];
TiRenderer.ctorParameters = () => [
    { type: RendererFactory2 }
];

/**
 * @ignore
 */
class TiTipContainerComponent {
}
TiTipContainerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tip-container',
                template: `
    <div class='ti3-tooltip-content'><ng-content></ng-content></div>
    <div class='ti3-tooltip-sqr'></div>`,
                host: {
                    '[class.ti3-tooltip]': 'true'
                },
                styles: ["::ng-deep :root{--ti-tip-before-square-height:9px;--ti-tip-before-square-size:10px;--ti-tip-black-theme-bg:#000;--ti-tip-black-theme-border-color:var(--ti-tip-black-theme-bg);--ti-tip-black-theme-color:#fff;--ti-tip-offset:9px;--ti-tip-sqr-height:calc(var(--ti-tip-square-distance) + var(--ti-tip-before-square-height));--ti-tip-square-distance:5px;--ti-tip-white-theme-bg:#fff;--ti-tip-white-theme-border-color:var(--ti-tip-white-theme-bg);--ti-tip-white-theme-color:var(--ti-common-color-text-secondary);--ti-tip-z-index:5000}:host.ti3-tooltip{-ms-box-sizing:border-box;background-color:var(--ti-tip-bg-color);border:1px solid transparent;border:var(--ti-tip-border);border-radius:var(--ti-tip-border-radius);box-shadow:var(--ti-tip-box-shadow);box-sizing:border-box;color:var(--ti-tip-text-color);display:block;line-height:var(--ti-common-line-height-number);padding:11px 15px;padding:calc(var(--ti-tip-vertical-padding) - 1px) calc(var(--ti-tip-horizon-padding) - 1px);position:absolute;white-space:normal;word-wrap:break-word;z-index:var(--ti-tip-z-index)}:host.ti3-tooltip.ti3-tip-black-theme{background-color:var(--ti-tip-black-theme-bg);border-color:var(--ti-tip-black-theme-border-color);color:var(--ti-tip-black-theme-color)}:host.ti3-tooltip.ti3-tip-black-theme:after,:host.ti3-tooltip.ti3-tip-black-theme:before{background:var(--ti-tip-black-theme-bg)}:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-bottom-left:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-bottom-right:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-bottom:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-left-bottom:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-left-top:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-left:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-right-bottom:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-right-top:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-right:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-top-left:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-top-right:before,:host.ti3-tooltip.ti3-tip-black-theme.ti3-tooltip-top:before{border-left-color:var(--ti-tip-black-theme-border-color);border-top-color:var(--ti-tip-black-theme-border-color)}:host.ti3-tooltip.ti3-tip-white-theme{background-color:var(--ti-tip-white-theme-bg);border-color:var(--ti-tip-white-theme-border-color);color:var(--ti-tip-white-theme-color)}:host.ti3-tooltip.ti3-tip-white-theme:after,:host.ti3-tooltip.ti3-tip-white-theme:before{background:var(--ti-tip-white-theme-bg)}:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-bottom-left:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-bottom-right:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-bottom:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-left-bottom:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-left-top:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-left:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-right-bottom:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-right-top:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-right:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-top-left:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-top-right:before,:host.ti3-tooltip.ti3-tip-white-theme.ti3-tooltip-top:before{border-left-color:var(--ti-tip-white-theme-border-color);border-top-color:var(--ti-tip-white-theme-border-color)}.ti3-tooltip-content,:host.ti3-tooltip.ti3-tip-white-theme .ti3-tooltip-content{overflow-y:auto;padding:1px}.ti3-tooltip-content ::ng-deep a{color:var(--ti-common-color-text-link-darkbg);text-decoration:none}.ti3-tooltip-content ::ng-deep a:hover{color:var(--ti-common-color-text-link-darkbg-hover);text-decoration:underline}.ti3-tooltip-position-before{background:var(--ti-tip-bg-color);border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);content:\"\";display:block;height:var(--ti-tip-before-square-size);overflow:hidden;position:absolute;transform:rotate(45deg);width:var(--ti-tip-before-square-size)}.ti3-tooltip-bottom-left-sqr,.ti3-tooltip-bottom-right-sqr,.ti3-tooltip-bottom-sqr{background-color:transparent;bottom:100%;box-sizing:border-box;height:var(--ti-tip-sqr-height);left:0;position:absolute;width:100%}:host.ti3-tooltip-bottom:after{height:10px;margin-left:-10px;top:0;width:20px}:host.ti3-tooltip-bottom:after,:host.ti3-tooltip-bottom:before{background:var(--ti-tip-bg-color);content:\"\";display:block;left:50%;overflow:hidden;position:absolute}:host.ti3-tooltip-bottom:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);margin-left:calc(-1*var(--ti-tip-before-square-size)/2);top:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-bottom-left:after{height:10px;left:calc(var(--ti-tip-offset) - 3px);top:0;width:20px}:host.ti3-tooltip-bottom-left:after,:host.ti3-tooltip-bottom-left:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-bottom-left:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);left:var(--ti-tip-offset);top:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-bottom-right:after{height:10px;right:calc(var(--ti-tip-offset) - 3px);top:0;width:20px}:host.ti3-tooltip-bottom-right:after,:host.ti3-tooltip-bottom-right:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-bottom-right:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);right:var(--ti-tip-offset);top:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);width:var(--ti-tip-before-square-size)}.ti3-tooltip-top-left-sqr,.ti3-tooltip-top-right-sqr,.ti3-tooltip-top-sqr{background-color:transparent;box-sizing:border-box;height:var(--ti-tip-sqr-height);left:0;position:absolute;top:100%;width:100%}:host.ti3-tooltip-top:after{bottom:0;height:10px;margin-left:-10px;width:20px}:host.ti3-tooltip-top:after,:host.ti3-tooltip-top:before{background:var(--ti-tip-bg-color);content:\"\";display:block;left:50%;overflow:hidden;position:absolute}:host.ti3-tooltip-top:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);bottom:calc(-1*var(--ti-tip-before-square-size)/2);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);margin-left:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);transform:rotate(-135deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-top-left:after{bottom:0;height:10px;left:calc(var(--ti-tip-offset) - 3px);width:20px}:host.ti3-tooltip-top-left:after,:host.ti3-tooltip-top-left:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-top-left:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);bottom:calc(-1*var(--ti-tip-before-square-size)/2);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);left:var(--ti-tip-offset);transform:rotate(45deg);transform:rotate(-135deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-top-right:after{bottom:0;height:10px;right:calc(var(--ti-tip-offset) - 3px);width:20px}:host.ti3-tooltip-top-right:after,:host.ti3-tooltip-top-right:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-top-right:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);bottom:calc(-1*var(--ti-tip-before-square-size)/2);box-shadow:-1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);right:var(--ti-tip-offset);transform:rotate(45deg);transform:rotate(-135deg);width:var(--ti-tip-before-square-size)}.ti3-tooltip-left-bottom-sqr,.ti3-tooltip-left-sqr,.ti3-tooltip-left-top-sqr{background-color:transparent;box-sizing:border-box;height:100%;left:100%;position:absolute;top:0;width:var(--ti-tip-sqr-height)}:host.ti3-tooltip-left:after{height:20px;margin-top:-10px;right:0;width:10px}:host.ti3-tooltip-left:after,:host.ti3-tooltip-left:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute;top:50%}:host.ti3-tooltip-left:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);margin-top:calc(-1*var(--ti-tip-before-square-size)/2);right:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);transform:rotate(135deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-left-top:after{height:20px;right:0;top:calc(var(--ti-tip-offset) - 3px);width:10px}:host.ti3-tooltip-left-top:after,:host.ti3-tooltip-left-top:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-left-top:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);right:calc(-1*var(--ti-tip-before-square-size)/2);top:var(--ti-tip-offset);transform:rotate(45deg);transform:rotate(135deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-left-bottom:after{bottom:calc(var(--ti-tip-offset) - 3px);height:20px;right:0;width:10px}:host.ti3-tooltip-left-bottom:after,:host.ti3-tooltip-left-bottom:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-left-bottom:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);bottom:var(--ti-tip-offset);box-shadow:1px -1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);right:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);transform:rotate(135deg);width:var(--ti-tip-before-square-size)}.ti3-tooltip-right-bottom-sqr,.ti3-tooltip-right-sqr,.ti3-tooltip-right-top-sqr{background-color:transparent;box-sizing:border-box;height:100%;position:absolute;right:100%;top:0;width:var(--ti-tip-sqr-height)}:host.ti3-tooltip-right:after{height:20px;left:0;margin-top:-10px;width:10px}:host.ti3-tooltip-right:after,:host.ti3-tooltip-right:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute;top:50%}:host.ti3-tooltip-right:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:-1px 1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);left:calc(-1*var(--ti-tip-before-square-size)/2);margin-top:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);transform:rotate(-45deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-right-top:after{height:20px;left:0;top:calc(var(--ti-tip-offset) - 3px);width:10px}:host.ti3-tooltip-right-top:after,:host.ti3-tooltip-right-top:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-right-top:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);box-shadow:-1px 1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);left:calc(-1*var(--ti-tip-before-square-size)/2);top:var(--ti-tip-offset);transform:rotate(45deg);transform:rotate(-45deg);width:var(--ti-tip-before-square-size)}:host.ti3-tooltip-right-bottom:after{bottom:calc(var(--ti-tip-offset) - 3px);height:20px;left:0;width:10px}:host.ti3-tooltip-right-bottom:after,:host.ti3-tooltip-right-bottom:before{background:var(--ti-tip-bg-color);content:\"\";display:block;overflow:hidden;position:absolute}:host.ti3-tooltip-right-bottom:before{border-left:var(--ti-tip-border);border-top:var(--ti-tip-border);bottom:var(--ti-tip-offset);box-shadow:-1px 1px 5px var(--ti-tip-box-shadow-color);height:var(--ti-tip-before-square-size);left:calc(-1*var(--ti-tip-before-square-size)/2);transform:rotate(45deg);transform:rotate(-45deg);width:var(--ti-tip-before-square-size)}.ti3-tooltip-clone{-ms-box-sizing:border-box;box-sizing:border-box;overflow:visible!important;position:absolute!important;visibility:hidden!important;width:auto!important}"]
            },] }
];

/**
 * @ignore
 */
class TiTipServiceModule {
}
TiTipServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiPopupModule,
                    TiRendererModule
                ],
                exports: [],
                declarations: [TiTipContainerComponent],
                entryComponents: [TiTipContainerComponent]
            },] }
];

/* eslint-disable no-eq-null */
/**
 * tip提供了两种使用方式:
 *
 * 1.服务方式（见如下说明），使用该服务时需要引入模块TiTipServiceModule
 *
 * 2.指令方式：[TiTipDirective]{@link ../directives/TiTipDirective.html}
 *
 * <example-url>../tiny3demo/#/tip/tip-all</example-url>
 */
class TiTipService {
    constructor(popService, rendererFactory, tiRenderer, zone, document) {
        this.popService = popService;
        this.tiRenderer = tiRenderer;
        this.zone = zone;
        this.document = document;
        /* tslint:disable:no-null-keyword */
        this.render = rendererFactory.createRenderer(null, null);
    }
    /**
     * 页面激活窗口改变事件处理，此处获取事件名称，该事件后续会在tip显示时注册，隐藏时销毁
     * 添加该事件用于解决的问题现象是：tip带链接，并且点击链接跳转至新开页面，因此，当返回先前页面时，tip不消失（因为未触发任何tip消失的事件），
     * 且移入其他出tip的元素，会出现页面有多个tip的现象
     */
    getVisibleChangeEventName() {
        const hiddenProperty = 'hidden' in this.document ? 'hidden' :
            'webkitHidden' in this.document ? 'webkitHidden' :
                'mozHidden' in this.document ? 'mozHidden' :
                    '';
        return hiddenProperty.replace(/hidden/i, 'visibilitychange');
    }
    create(hostEle, config) {
        // 宿主元素不存在情况下，不做处理
        if (!Util.isElement(hostEle)) {
            return;
        }
        const tipInstance = this.createTip(hostEle, config);
        this.addTriggerEvent(hostEle, config, tipInstance);
        return tipInstance;
    }
    /**
     * 创建Tip实例
     *
     * @param hostEle tip生成所依附的宿主元素
     *
     * @param config tip属性配置
     *
     * @returns 生成的Tip实例对象如下：
     *
     * ```
     * {
     *      // 显示tip方法
     *      // @param content {string | TemplateRef<any> | any} tip显示内容，可为字符串/ng-template/component，具体用法见示例
     *      // @param context {any} tip显示内容对应的上下文，content类型为templateRef或Component形式时会用到该参数
     *      show: (content: string | TemplateRef<any> | any, context?: any) => void;
     *
     *      // 隐藏tip方法
     *      hide: () => void;
     * }
     * ```
     */
    createTip(hostEle, config) {
        const popInstance = this.popService.create(TiTipContainerComponent); // tip弹出服务实例，可通过调用show/hide方法切换组件的显示状态
        let tipComponentRef; // 生成好的 tip 组件实例对象componentRef
        const visibilityChangeEvent = this.getVisibleChangeEventName();
        let visibleChangeEvtHandle;
        // 组件添加全局事件销毁相关处理
        let eventHandles = []; // 用于存储事件句柄，事件句柄在事件取消时需要用到
        // 隐藏处理函数
        const hideFn = () => {
            if (tipComponentRef != null) {
                // 销毁弹出元素
                popInstance.hide();
                // 通过执行事件返回句柄方法解绑事件
                Position.removePosChangeEvts(eventHandles);
                if (config.registerVisibilityChangeEvent !== false) {
                    visibleChangeEvtHandle();
                }
                tipComponentRef = null;
            }
        };
        return {
            show: (content, context) => {
                if (Util.isUndefined(content) || content === '') {
                    return;
                }
                // 显示Tip元素
                tipComponentRef = this.showTip({
                    popInstance,
                    hostEle,
                    content,
                    context,
                    config
                });
                // 添加全局事件，用于控制特殊情况下宿主位置改变时Tip的隐藏
                eventHandles = Position.addPosChangeEvts(hideFn, this.render);
                if (config.registerVisibilityChangeEvent !== false) {
                    visibleChangeEvtHandle = this.render.listen(this.document, visibilityChangeEvent, hideFn);
                }
                return tipComponentRef;
            },
            hide: () => {
                hideFn();
            },
            // 销毁tip
            destroy: () => {
                // 销毁tip前先隐藏
                hideFn();
            }
        };
    }
    // 根据trigger配置为宿主元素添加事件，该事件用于控制tip的显示/隐藏
    addTriggerEvent(hostEle, config, tipInstance) {
        // 非mouse情况下，不用做事件处理
        if (config.trigger !== 'mouse') {
            return;
        }
        let tipComponentRef = null;
        // 默认情况下，使用mouse进行tip显示和隐藏控制（只对指令形式有效）
        this.zone.runOutsideAngular(() => {
            const unlistenMouseenterFn = this.render.listen(hostEle, 'mouseenter', () => {
                if (typeof config.showFn !== 'function') {
                    return;
                }
                const showInfo = config.showFn();
                if (!showInfo) {
                    return;
                }
                this.zone.run(() => {
                    tipComponentRef = tipInstance.show(showInfo.content, showInfo.context);
                    if (!tipComponentRef) {
                        return;
                    }
                    // 根据trigger配置添加tip元素本身事件，此处事件用于支持移出tip元素时tip消失
                    const targetEle = tipComponentRef.location.nativeElement;
                    // eslint-disable-next-line max-nested-callbacks
                    this.render.listen(targetEle, 'mouseleave', (event) => {
                        /**
                         * 此处处理是为了解决Chrome高版本下，连续点击tip区域情况下，导致tip消失的问题
                         * 【问题原因】chrome高版本（chrome60以上版本）下，连续的click事件会触发tipEle的mouseleave事件,
                         * 从而导致tip消失
                         * 【解决方案】如mouseleve事件是由tip元素本身点击触发的，则event.relatedTarget为null，则通过该
                         * 方式进行特殊情况排除
                         */
                        if (event.relatedTarget === null) {
                            return;
                        }
                        tipInstance.hide();
                        tipComponentRef = null;
                    });
                });
            });
            const unlistenMouseleaveFn = this.render.listen(hostEle, 'mouseleave', (event) => {
                // 鼠标移入tip时，tip不消失
                if (tipComponentRef && !tipComponentRef.location.nativeElement.contains(event.relatedTarget)) {
                    this.zone.run(() => {
                        tipInstance.hide();
                        tipComponentRef = null;
                    });
                }
            });
            // 给实例添加销毁方法
            tipInstance.destroy = () => {
                // 先隐藏tip示例再取消监听事件
                tipInstance.hide();
                unlistenMouseenterFn();
                unlistenMouseleaveFn();
            };
        });
    }
    showTip(options) {
        const tipComponentRef = options.popInstance.show({
            content: options.content,
            contentContext: options.context,
            container: 'body'
        });
        const targetEle = tipComponentRef.location.nativeElement;
        this.tiRenderer.setStyles(targetEle, {
            left: '-9999px',
            top: '-9999px'
        });
        this.setTipTheme(targetEle, options.config);
        // 计算元素宽高时，需要确保元素已生成
        this.setTipWidth(targetEle, options.config);
        this.setPosition(options.hostEle, targetEle, options.config);
        return tipComponentRef;
    }
    setTipTheme(ele, config) {
        if (!config || !config.theme) {
            return;
        }
        if (config.theme === 'black') {
            this.render.addClass(ele, 'ti3-tip-black-theme');
        }
        else if (config.theme === 'white') {
            this.render.addClass(ele, 'ti3-tip-white-theme');
        }
    }
    setTipWidth(ele, config) {
        const maxWidth = parseInt((config && config.maxWidth) || TiTipService.DEFAULT_WIDTH, 10);
        // 修复SSR错误：ERROR TypeError: ele.getBoundingClientRect is not a function
        if (typeof ele.getBoundingClientRect !== 'function') {
            return;
        }
        const targetWidth = ele.getBoundingClientRect().width;
        if (targetWidth > maxWidth) {
            // 如果宽度超过最大值，重新设置当前tip的内容宽度
            this.render.setStyle(ele, 'width', `${maxWidth}px`);
        }
    }
    setPosition(hostEle, targetEle, config) {
        const result = Position.setPosition({
            targetEle,
            hostEle,
            hostEleX: config.hostEleX,
            position: config && config.position || 'auto',
            hostSpace: TiTipService.SPACE,
            fixMaxHeight: true,
            hasOffsetFix: true
        });
        const position = result.position;
        if (!config || config.hasArrow !== false) { // 未定义或定义为false情况下都需要加该样式类控制三角样式
            this.render.addClass(targetEle, `ti3-tooltip-${position}`);
        }
        // 设置该样式类是为了支持鼠标移入Tip不消失：使用该样式类用于确保tip和宿主元素连接处的DOM在tip范围内
        this.render.addClass(targetEle.querySelector('.ti3-tooltip-sqr'), `ti3-tooltip-${position}-sqr`);
        // 设置当前tip的内容最大高度，超出显示滚动条
        this.tiRenderer.setStyles(targetEle.querySelector('.ti3-tooltip-content'), {
            maxHeight: result.avilableHeight
        });
    }
}
TiTipService.DEFAULT_WIDTH = 276; // tip换行宽度
TiTipService.SPACE = 6.5 + 5; // tip框与元素本身的距离 = 三角宽高 + tip三角到触发tip的内容区域的距离
TiTipService.ɵprov = ɵɵdefineInjectable({ factory: function TiTipService_Factory() { return new TiTipService(ɵɵinject(TiPopupService), ɵɵinject(RendererFactory2), ɵɵinject(TiRenderer), ɵɵinject(NgZone), ɵɵinject(DOCUMENT)); }, token: TiTipService, providedIn: TiTipServiceModule });
TiTipService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiTipServiceModule
            },] }
];
TiTipService.ctorParameters = () => [
    { type: TiPopupService },
    { type: RendererFactory2 },
    { type: TiRenderer },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];

// TODO:exportAs: 'tiTip' 可去除？
/**
 * tip提供了两种使用方式:
 * 1.服务方式：[TiTipService]{@link ../injectables/TiTipService.html}
 *
 * 2.指令方式（见如下说明）
 *
 * <example-url>../tiny3demo/#/tip/tip-all</example-url>
 */
class TiTipDirective {
    constructor(tipService, hostEleRef) {
        this.tipService = tipService;
        /**
         * Tip显示位置属性配置
         */
        this.tiTipPosition = 'auto';
        /**
         * 最大宽度
         *
         */
        this.tiTipMaxWidth = '276px';
        /**
         * 是否带箭头
         */
        this.tiTipHasArrow = true;
        /**
         * tip生成方式，默认支持鼠标移入移出时显示/隐藏
         *
         * 注意：指令形式时才会使用到该参数
         */
        this.tiTipTrigger = 'mouse';
        this.hostEle = hostEleRef.nativeElement;
    }
    static isInValidValue(value) {
        return Util.isUndefined(value) || Util.isNull(value) || value === '';
    }
    ngOnInit() {
        // 初始创建tip实例
        this.tipInstance = this.tipService.create(this.hostEle, {
            position: this.tiTipPosition,
            maxWidth: this.tiTipMaxWidth,
            hasArrow: this.tiTipHasArrow,
            hostEleX: this.tiTipHostEleX,
            trigger: this.tiTipTrigger || 'mouse',
            showFn: () => {
                if (!this.tipInstance || TiTipDirective.isInValidValue(this._tiTip)) {
                    return;
                }
                return { content: this._tiTip, context: this.tiTipContext };
            }
        });
    }
    /**
     * tip显示内容配置
     *
     * 类型：string | TemplateRef<any> | any
     *
     * 传入string类型时，在v3.0.6及之前的版本存在XSS攻击风险；v3.0.7做了安全处理后不存在XSS风险了，把传入的字符串当做纯文本解析，传入什么显示什么；
     * v10.1.4版本支持html字符串片段，也已做安全处理。
     */
    set tiTip(value) {
        this._tiTip = value;
        if (TiTipDirective.isInValidValue(value)) {
            this.hide();
        }
    }
    /**
     * @ignore
     */
    get tiTip() {
        return this._tiTip;
    }
    /**
     * 显示tip方法
     */
    show() {
        if (!this.tipInstance || TiTipDirective.isInValidValue(this._tiTip)) {
            return;
        }
        return this.tipInstance.show(this._tiTip, this.tiTipContext);
    }
    /**
     * 隐藏tip方法
     */
    hide() {
        if (this.tipInstance) {
            this.tipInstance.hide();
        }
    }
    // 宿主销毁，tip连带销毁
    ngOnDestroy() {
        this.tipInstance.hide();
        /* tslint:disable:no-null-keyword */
        this.tipInstance = null;
    }
}
TiTipDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiTip]',
                exportAs: 'tiTip'
            },] }
];
TiTipDirective.ctorParameters = () => [
    { type: TiTipService },
    { type: ElementRef }
];
TiTipDirective.propDecorators = {
    tiTipPosition: [{ type: Input }],
    tiTipMaxWidth: [{ type: Input }],
    tiTipHasArrow: [{ type: Input }],
    tiTipContext: [{ type: Input }],
    tiTipTrigger: [{ type: Input }],
    tiTipHostEleX: [{ type: Input }],
    tiTip: [{ type: Input }]
};

// 引用TiTipModule，可以使用Tip指令和Tip服务
class TiTipModule {
}
TiTipModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiTipServiceModule
                ],
                exports: [TiTipDirective],
                declarations: [TiTipDirective]
            },] }
];

/**
 * @ignore
 * Tiny组件中使用的中文国际化词条
 */
const zh_CN = {
    tiLocaleKey: 'zh-CN',
    tiLocaleDate: {
        date: 'yyyy/MM/dd',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: '确定',
        cancelBtn: '取消'
    },
    tiActionmenu: {
        more: '更多',
        operation: '操作'
    },
    tiValid: {
        errorMsg: {
            required: '输入不能为空。',
            maxLength: '输入长度不能超过{0}个字符。',
            minLength: '输入长度不能小于{0}个字符。',
            rangeSize: '输入长度范围为{0}到{1}个字符。',
            maxValue: '输入值不能超过{0}。',
            minValue: '输入值不能小于{0}。',
            rangeValue: '输入值必须在{0}到{1}之间。',
            regExp: '输入值无效。',
            contains: '输入值必须包含有字符{0}。',
            notContains: '输入值不能含有非法字符{0}。',
            notScript: '输入值不能含有script标签。',
            equal: '输入值必须等于{0}。',
            notEqual: '输入值不能等于{0}。',
            port: '端口号为{0}到{1}的整数。',
            path: '输入值未满足路径格式要求。',
            email: '输入email地址无效。',
            date: '输入日期无效。',
            url: '输入URL无效。',
            integer: '输入值不是有效整数。',
            number: '输入值不是有效数字。',
            digits: '输入值不是有效数字字符。',
            ipv4: '输入值不是有效IPv4地址。',
            ipv6: '输入值不是有效IPv6地址。',
            password: '密码输入不符合要求，请重新输入。'
        },
        message: {
            rangeSize: '{0}~{1}个字符。',
            minCharType: '至少包含以下字符中的{0}种：大写字母、小写字母、数字、特殊字符`~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/?  和空格。',
            notEqualPosRev: '不能与用户名或倒序的用户名相同。'
        },
        passwordStrength: {
            securityText: '安全程度:',
            levelDecArr: ['弱', '中', '强']
        }
    },
    tiPagination: {
        gotoLabel: '跳转',
        prevTitle: '上一页',
        nextTitle: '下一页',
        totalLabel: '总条数：'
    },
    tiMessage: {
        prompt: '提示',
        warn: '警告',
        confirm: '确认',
        error: '错误',
        ok: '确认',
        cancel: '取消'
    },
    tiUpload: {
        addFile: '添加文件',
        error: '上传失败！',
        successInfo: '上传成功！',
        uploadingSingleInfo: '正在上传',
        errorSingleInfo: '上传失败！',
        addSuccessMutiInfo: '已添加{0}个文件',
        uploadingMutiInfo: '{0} 正在上传',
        errorMultiInfo: '{0}个文件上传失败！',
        clearAll: '清空选择',
        upload: '上传文件',
        cancel: '取消上传',
        reload: '重新上传',
        autoUploadFilePlaceholder: '点击右侧按钮上传文件',
        autoUploadFilesPlaceholder: '点击右侧按钮上传文件',
        notAutoUploadFilePlaceholder: '点击右侧按钮先添加再上传',
        notAutoUploadFilesPlaceholder: '点击右侧按钮先添加再上传'
    },
    tiDate: {
        datePlaceholder: '请选择日期',
        datetimePlaceholder: '请选择日期时间',
        weekNamesAbb: ['日', '一', '二', '三', '四', '五', '六'],
        weeknamesTitle: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
        monthNamesAbb: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9个月', '1 年', '2 年', '3 年'],
        yearSuffixLabel: '年',
        rangeBeginLabel: '开始日期',
        rangeEndLabel: '结束日期',
        selectTime: '选择时间',
        selectDate: '选择日期',
        hour: '时',
        minute: '分',
        second: '秒'
    },
    tiSelect: {
        search: '搜索',
        selected: '已选'
    },
    tiTable: {
        colsToggleTip: '自定义列表项'
    },
    tiList: {
        selectAll: '(全选)'
    },
    tiIntro: {
        skip: '跳过',
        previous: '上一步',
        next: '下一步',
        finish: '立即体验'
    },
    tiPopconfirm: {
        yesLabel: '是',
        noLabel: '否'
    },
    tiTree: {
        reload: '重新加载',
        loadError: '加载失败，',
        newNode: '新节点'
    }
};

/**
 * @ignore
 * Tiny组件中使用的英文国际化词条
 */
const en_US = {
    tiLocaleKey: 'en-US',
    tiLocaleDate: {
        date: 'MMM dd, yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'OK',
        cancelBtn: 'Cancel'
    },
    tiActionmenu: {
        more: 'More',
        operation: 'Operation'
    },
    tiValid: {
        errorMsg: {
            required: 'This field cannot be left blank.',
            maxLength: 'Enter a maximum of {0} characters.',
            minLength: 'Enter at least {0} characters.',
            rangeSize: 'Enter {0} to {1} characters.',
            maxValue: 'Enter a value less than or equal to {0}.',
            minValue: 'Enter a value greater than or equal to {0}.',
            rangeValue: 'Enter a value from {0} to {1}.',
            regExp: 'Invalid value.',
            contains: 'The value must contain the following characters: {0}.',
            notContains: 'The value cannot contain the following invalid characters: {0}.',
            notScript: 'The value cannot contain script tags.',
            equal: 'The value must be {0}.',
            notEqual: 'The value cannot be {0}.',
            port: 'Enter an integer from {0} to {1}.',
            path: 'Enter a valid file path.',
            email: 'Enter a valid email address.',
            date: 'Enter a valid date.',
            url: 'Enter a valid URL.',
            integer: 'Enter a valid integer.',
            number: 'Enter a valid number.',
            digits: 'Enter a valid number.',
            ipv4: 'Enter a valid IPv4 address.',
            ipv6: 'Enter a valid IPv6 address.',
            password: 'Invalid password.'
        },
        message: {
            rangeSize: 'Must be {0} to {1} characters long.',
            minCharType: 'Must contain at least {0} of the following character types: ' +
                'letters, digits, and special characters ( `~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/? and spaces). ',
            notEqualPosRev: 'Cannot be the username or the username spelled backwards.'
        },
        passwordStrength: {
            securityText: 'Password Strength:',
            levelDecArr: ['Weak', 'Medium', 'Strong']
        }
    },
    tiPagination: {
        gotoLabel: 'Go',
        prevTitle: 'Previous',
        nextTitle: 'Next',
        totalLabel: 'Total Records: '
    },
    // message控件词条
    tiMessage: {
        prompt: 'Information',
        warn: 'Warning',
        confirm: 'Confirm',
        error: 'Error',
        ok: 'OK',
        cancel: 'Cancel'
    },
    tiUpload: {
        addFile: 'Select File',
        error: 'Failed to upload the file.',
        successInfo: 'File uploaded successfully.',
        uploadingSingleInfo: 'Uploading',
        errorSingleInfo: 'Failed to upload the file.',
        addSuccessMutiInfo: 'You have added {0} files.',
        uploadingMutiInfo: 'Uploading: {0}',
        errorMultiInfo: 'Failed to upload {0} files.',
        clearAll: 'Clear All',
        upload: 'Upload',
        cancel: 'Cancel',
        reload: 'Upload Again',
        autoUploadFilePlaceholder: 'Select a file to upload.',
        autoUploadFilesPlaceholder: 'Select files to upload.',
        notAutoUploadFilePlaceholder: 'Add a file and upload it.',
        notAutoUploadFilesPlaceholder: 'Add files and upload them.'
    },
    tiDate: {
        datePlaceholder: 'Select a date.',
        datetimePlaceholder: 'Select a date and time.',
        weekNamesAbb: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
        weeknamesTitle: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
        monthNamesAbb: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 months', '1 year', '2 years', '3 years'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Start Date',
        rangeEndLabel: 'End Date',
        selectTime: 'Select Time',
        selectDate: 'Select Date',
        hour: 'Hour',
        minute: 'Minute',
        second: 'Second'
    },
    tiSelect: {
        search: 'Search',
        selected: 'Selected'
    },
    tiTable: {
        colsToggleTip: 'Customize Column'
    },
    tiList: {
        selectAll: '(Select all)'
    },
    tiIntro: {
        skip: 'Skip',
        previous: 'Previous',
        next: 'Next',
        finish: 'Finish'
    },
    tiPopconfirm: {
        yesLabel: 'Yes',
        noLabel: 'No'
    },
    tiTree: {
        reload: 'Reload',
        loadError: 'Loading failed. ',
        newNode: 'New node '
    }
};

/**
 * @ignore
 * Tiny组件中使用的德语国际化词条
 */
const de_DE = {
    tiLocaleKey: 'de-DE',
    tiLocaleDate: {
        date: 'dd.MM.yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'OK',
        cancelBtn: 'Abbrechen'
    },
    tiActionmenu: {
        more: 'Mehr',
        operation: 'Betrieb'
    },
    tiValid: {
        errorMsg: {
            required: 'Die Eingabe muss erfolgen.',
            maxLength: 'Die Länge der Eingabe kann {0} nicht überschreiten.',
            minLength: 'Die Länge der Eingabe kann nicht kleiner als {0} sein.',
            rangeSize: 'Die Länge der Eingabe muss zwischen {0} und {1} liegen.',
            maxValue: 'Der Eingabewert kann {0} nicht überschreiten.',
            minValue: 'Der Eingabewert kann nicht kleiner als {0} sein.',
            rangeValue: 'Der Eingabewert muss im Bereich zwischen {0} und {1} liegen.',
            regExp: 'Der Eingabewert ist ungültig.',
            contains: 'The value must contain the following characters: {0}.',
            notContains: 'Der Eingabewert kann keine unzulässigen Zeichen enthalten {0}.',
            notScript: 'Der Eingabewert kann keinen Skript-Tag enthalten.',
            equal: 'Der Eingabewert muss gleich {0} sein.',
            notEqual: 'The value cannot be {0}.',
            port: 'Die Portnummer ist eine ganze Zahl zwischen {0} und {1}.',
            path: 'Der Eingabewert entspricht nicht den Anforderungen an das Pfadformat.',
            email: 'Der Eingabewert ist keine gültige E-Mails-Adresse.',
            date: '"Der Eingabewert ist keine gültiges Datum.',
            url: 'Der Eingabewert ist keine gültige URL.',
            integer: 'Der Eingabewert ist keine gültige ganze Zahl.',
            number: '"Der Eingabewert ist keine gültige Zahl.',
            digits: 'Der Eingabewert ist keine gültige Zahl.',
            ipv4: 'Der Eingabewert ist keine gültige IPv4-Adresse.',
            ipv6: 'Der Eingabewert ist keine gültige IPv6-Adresse.',
            password: 'Invalid password.'
        },
        message: {
            rangeSize: 'Must be {0} to {1} characters long.',
            minCharType: 'Must contain at least {0} of the following character types: ' +
                'uppercase letters, lowercase letters, digits, and special characters ( `~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/? and spaces).',
            notEqualPosRev: 'Cannot be the username or the username spelled backwards.'
        },
        passwordStrength: {
            securityText: 'Password Strength:',
            levelDecArr: ['Weak', 'Medium', 'Strong']
        }
    },
    tiPagination: {
        gotoLabel: 'Navigieren Sie',
        prevTitle: 'Vorherige',
        nextTitle: 'Weiter',
        totalLabel: 'Gesamtzahl der Datensätze: '
    },
    tiMessage: {
        prompt: 'Informationen',
        warn: 'Warnung',
        confirm: 'Bestätigen',
        error: 'Fehler',
        ok: 'OK',
        cancel: 'Abbrechen'
    },
    tiUpload: {
        addFile: 'Datei hinzufügen',
        error: 'Failed to upload the file.',
        successInfo: 'Hochladen.',
        uploadingSingleInfo: 'Uploading',
        errorSingleInfo: 'Failed to upload the file.',
        addSuccessMutiInfo: 'You have added {0} files.',
        uploadingMutiInfo: 'Uploading: {0}',
        errorMultiInfo: 'Failed to upload {0} files.',
        clearAll: 'Clear All',
        upload: 'Upload',
        cancel: 'Cancel',
        reload: 'Upload Again',
        autoUploadFilePlaceholder: 'Select a file to upload.',
        autoUploadFilesPlaceholder: 'Select files to upload.',
        notAutoUploadFilePlaceholder: 'Add a file and upload it.',
        notAutoUploadFilesPlaceholder: 'Add files and upload them.'
    },
    tiDate: {
        datePlaceholder: 'Select a date.',
        datetimePlaceholder: 'Select a date and time.',
        weekNamesAbb: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
        weeknamesTitle: ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'],
        monthNamesAbb: ['Jan', 'Feb', 'Mrz', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 months', '1 year', '2 years', '3 years'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Start Date',
        rangeEndLabel: 'End Date',
        selectTime: 'Select Time',
        selectDate: 'Select Date',
        hour: 'Hour',
        minute: 'Minute',
        second: 'Second'
    },
    tiSelect: {
        search: 'Search',
        selected: 'Selected'
    },
    tiTable: {
        colsToggleTip: 'Customize Column'
    },
    tiList: {
        selectAll: '(Alle auswählen)'
    },
    tiIntro: {
        skip: 'Skip',
        previous: 'Previous',
        next: 'Next',
        finish: 'Try Now'
    },
    tiPopconfirm: {
        yesLabel: 'Yes',
        noLabel: 'No'
    },
    tiTree: {
        reload: 'Reload',
        loadError: 'Loading failed. ',
        newNode: 'New node '
    }
};

/**
 * @ignore
 * Tiny组件中使用的欧洲西语国际化词条
 */
const es_ES = {
    tiLocaleKey: 'es-ES',
    tiLocaleDate: {
        date: 'dd/MM/yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'Aceptar',
        cancelBtn: 'Cancelar'
    },
    tiActionmenu: {
        more: 'Más',
        operation: 'Operar'
    },
    tiValid: {
        errorMsg: {
            required: 'Este campo es obligatorio.',
            maxLength: 'Introduzca {0} caracteres como máximo.',
            minLength: 'Introduzca {0} caracteres como mínimo.',
            rangeSize: 'Introduzca entre {0} y {1} caracteres.',
            maxValue: 'Introduzca un valor inferior o igual a {0}.',
            minValue: 'Introduzca un valor superior o igual a {0}.',
            rangeValue: 'Introduzca un valor entre {0} y {1}.',
            regExp: 'Valor no válido.',
            contains: 'El valor debe contener los siguientes caracteres: {0}.',
            notContains: 'El valor no puede contener los siguientes caracteres no válidos: {0}.',
            notScript: 'El valor no puede contener etiquetas de scripts.',
            equal: 'El valor debe ser {0}',
            notEqual: 'El valor no puede ser {0}.',
            port: 'Introduzca un número entero entre {0} y {1}.',
            path: 'Introduzca una ruta de fichero válida.',
            email: 'Introduzca una dirección de correo electrónico válida.',
            date: 'Introduzca una fecha válida.',
            url: 'Introduzca un URL válido.',
            integer: 'Introduzca un número entero válido.',
            number: 'Introduzca un número válido.',
            digits: 'Introduzca un número válido.',
            ipv4: 'Introduzca una dirección IPv4 válida.',
            ipv6: 'Introduzca una dirección IPv6 válida.',
            password: 'Contraseña no válida.'
        },
        message: {
            rangeSize: 'Debe contener entre {0} y {1} caracteres.',
            minCharType: 'Debe contener al menos {0} de los siguientes tipos de caracteres: ' +
                'letras, dígitos y caracteres especiales ( `~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/?  o espacios). ',
            notEqualPosRev: 'No puede ser el nombre de usuario ni el nombre de usuario escrito al revés.'
        },
        passwordStrength: {
            securityText: 'Nivel de seguridad:',
            levelDecArr: ['Bajo', 'Medio', 'Alto']
        }
    },
    tiPagination: {
        gotoLabel: 'Ir',
        prevTitle: 'Anterior',
        nextTitle: 'Siguiente',
        totalLabel: 'Cantidad total de registros: '
    },
    tiMessage: {
        prompt: 'Información',
        warn: 'Advertencia',
        confirm: 'Confirmar',
        error: 'Error',
        ok: 'Aceptar',
        cancel: 'Cancelar'
    },
    tiUpload: {
        addFile: 'Seleccionar fichero',
        error: 'Error al cargar el fichero.',
        successInfo: 'Se ha cargado el fichero.',
        uploadingSingleInfo: 'Cargando',
        errorSingleInfo: 'Error al cargar el fichero.',
        addSuccessMutiInfo: 'Se han agregado {0} ficheros.',
        uploadingMutiInfo: 'Cargando: {0}',
        errorMultiInfo: 'Error al cargar {0} ficheros.',
        clearAll: 'Eliminar todo',
        upload: 'Cargar',
        cancel: 'Cancelar',
        reload: 'Volver a cargar',
        autoUploadFilePlaceholder: 'Seleccione un fichero para cargar.',
        autoUploadFilesPlaceholder: 'Seleccione ficheros para cargar.',
        notAutoUploadFilePlaceholder: 'Añada un fichero y cárguelo.',
        notAutoUploadFilesPlaceholder: 'Añada ficheros y cárguelos.'
    },
    tiDate: {
        datePlaceholder: 'Seleccione una fecha.',
        datetimePlaceholder: 'Seleccione una fecha y hora.',
        weekNamesAbb: ['Do.', 'Lu.', 'Ma.', 'Mi.', 'Ju.', 'Vi.', 'Sá.'],
        weeknamesTitle: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
        monthNamesAbb: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dec'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 meses', '1 año', '2 años', '3 años'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Inicio',
        rangeEndLabel: 'Fin',
        selectTime: 'Seleccionar hora',
        selectDate: 'Seleccionar fecha',
        hour: 'Hora',
        minute: 'Minuto',
        second: 'Segundo'
    },
    tiSelect: {
        search: 'Buscar',
        selected: 'Seleccionados'
    },
    tiTable: {
        colsToggleTip: 'Personalizar columna'
    },
    tiList: {
        selectAll: '(Seleccionar todo)'
    },
    tiIntro: {
        skip: 'Omitir',
        previous: 'Anterior',
        next: 'Siguiente',
        finish: 'Finalizar'
    },
    tiPopconfirm: {
        yesLabel: 'Sí',
        noLabel: 'No'
    },
    tiTree: {
        reload: 'Volver a cargar',
        loadError: 'Error al cargar. ',
        newNode: 'Nodo nuevo '
    }
};

/**
 * @ignore
 * Tiny组件中使用的拉美西语国际化词条
 */
const es_US = {
    tiLocaleKey: 'es-US',
    tiLocaleDate: {
        date: 'dd/MM/yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'Aceptar',
        cancelBtn: 'Cancelar'
    },
    tiActionmenu: {
        more: 'Más',
        operation: 'Operación'
    },
    tiValid: {
        errorMsg: {
            required: 'Este campo es obligatorio.',
            maxLength: 'Ingrese {0} caracteres como máximo.',
            minLength: 'Ingrese {0} caracteres como mínimo.',
            rangeSize: 'Ingrese entre {0} y {1} caracteres.',
            maxValue: 'Ingrese un valor inferior o igual a {0}.',
            minValue: 'Ingrese un valor superior o igual a {0}.',
            rangeValue: 'Ingrese un valor entre {0} y {1}.',
            regExp: 'Valor no válido.',
            contains: 'El valor debe contener los siguientes caracteres: {0}.',
            notContains: 'El valor no puede contener los siguientes caracteres no válidos: {0}.',
            notScript: 'El valor no puede contener etiquetas de scripts.',
            equal: 'El valor debe ser {0}',
            notEqual: 'El valor no puede ser {0}.',
            port: 'Ingrese un número entero entre {0} y {1}.',
            path: 'Ingrese una ruta de archivo válida.',
            email: 'Ingrese una dirección de correo electrónico válida.',
            date: 'Ingrese una fecha válida.',
            url: 'Ingrese un URL válido.',
            integer: 'Ingrese un número entero válido.',
            number: 'Ingrese un número válido.',
            digits: 'Ingrese un número válido.',
            ipv4: 'Ingrese una dirección IPv4 válida.',
            ipv6: 'Ingrese una dirección IPv6 válida.',
            password: 'Contraseña no válida.'
        },
        message: {
            rangeSize: 'Debe contener entre {0} y {1} caracteres.',
            minCharType: 'Debe contener al menos {0} de los siguientes tipos de caracteres: ' +
                'letras, dígitos y caracteres especiales ( `~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/?  o espacios). ',
            notEqualPosRev: 'No puede ser el nombre de usuario ni el nombre de usuario escrito al revés.'
        },
        passwordStrength: {
            securityText: 'Nivel de seguridad:',
            levelDecArr: ['Bajo', 'Medio', 'Alto']
        }
    },
    tiPagination: {
        gotoLabel: 'Ir',
        prevTitle: 'Anterior',
        nextTitle: 'Siguiente',
        totalLabel: 'Cantidad total de registros: '
    },
    tiMessage: {
        prompt: 'Información',
        warn: 'Advertencia',
        confirm: 'Confirmar',
        error: 'Error',
        ok: 'Aceptar',
        cancel: 'Cancelar'
    },
    tiUpload: {
        addFile: 'Seleccionar archivo',
        error: 'Error al cargar el archivo.',
        successInfo: 'Se cargó el archivo.',
        uploadingSingleInfo: 'Cargando',
        errorSingleInfo: 'Error al cargar el archivo.',
        addSuccessMutiInfo: 'Se agregaron {0} archivos.',
        uploadingMutiInfo: 'Cargando: {0}',
        errorMultiInfo: 'Error al cargar {0} archivos.',
        clearAll: 'Eliminar todo',
        upload: 'Cargar',
        cancel: 'Cancelar',
        reload: 'Volver a cargar',
        autoUploadFilePlaceholder: 'Seleccione un archivo para cargar.',
        autoUploadFilesPlaceholder: 'Seleccione archivos para cargar.',
        notAutoUploadFilePlaceholder: 'Agregue un archivo y cárguelo.',
        notAutoUploadFilesPlaceholder: 'Agregue archivos y cárguelos.'
    },
    tiDate: {
        datePlaceholder: 'Seleccione una fecha.',
        datetimePlaceholder: 'Seleccione una fecha y hora.',
        weekNamesAbb: ['Do.', 'Lu.', 'Ma.', 'Mi.', 'Ju.', 'Vi.', 'Sá.'],
        weeknamesTitle: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
        monthNamesAbb: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dec'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 meses', '1 año', '2 años', '3 años'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Inicio',
        rangeEndLabel: 'Fin',
        selectTime: 'Seleccionar hora',
        selectDate: 'Seleccionar fecha',
        hour: 'Hora',
        minute: 'Minuto',
        second: 'Segundo'
    },
    tiSelect: {
        search: 'Buscar',
        selected: 'Seleccionados'
    },
    tiTable: {
        colsToggleTip: 'Personalizar columna'
    },
    tiList: {
        selectAll: '(Seleccionar todo)'
    },
    tiIntro: {
        skip: 'Omitir',
        previous: 'Anterior',
        next: 'Siguiente',
        finish: 'Finalizar'
    },
    tiPopconfirm: {
        yesLabel: 'Sí',
        noLabel: 'No'
    },
    tiTree: {
        reload: 'Volver a cargar',
        loadError: 'Error al cargar. ',
        newNode: 'Nodo nuevo '
    }
};

/**
 * @ignore
 * Tiny组件中使用的法语国际化词条
 */
const fr_FR = {
    tiLocaleKey: 'fr-FR',
    tiLocaleDate: {
        date: 'dd/MM/yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'OK',
        cancelBtn: 'Annuler'
    },
    tiActionmenu: {
        more: 'Plus',
        operation: 'Opérer'
    },
    tiValid: {
        errorMsg: {
            required: 'Ce champs ne peut pas être vide.',
            maxLength: 'Saisissez un maximum de {0} caractères.',
            minLength: 'Saisissez au moins {0} caractères.',
            rangeSize: 'Saisissez les caractères {0} à {1}.',
            maxValue: 'Saisissez une valeur inférieure ou égale à {0}.',
            minValue: 'Saisissez une valeur supérieure ou égale à {0}.',
            rangeValue: 'Saisissez une valeur comprise entre {0} et {1}.',
            regExp: 'Valeur non valable.',
            contains: 'La valeur doit contenir les caractères suivants : {0}.',
            notContains: 'La valeur ne peut pas contenir les caractères non valables suivants : {0}.',
            notScript: 'La valeur ne peut pas contenir de script tags.',
            equal: 'La valeur d\'entrée doit être égale à {0}.',
            notEqual: 'La valeur ne peut pas être {0}',
            port: 'Le numéro de port est un nombre entier allant de {0} à {1}.',
            path: 'Entrez un chemin de fichier valide.',
            email: 'Entrez une adresse électronique valide.',
            date: 'Saisissez une date valide.',
            url: 'Saisissez une URL valide.',
            integer: 'Saisissez un nombre entier valide.',
            number: 'Saisissez un nombre valide.',
            digits: 'Saisissez un nombre valide.',
            ipv4: 'Saisissez une adresse IPv4 valide.',
            ipv6: 'Saisissez une adresse IPv6 valide.',
            password: 'Mot de passe non valide.'
        },
        message: {
            rangeSize: 'Doit comporter de {0} à {1} caractères.',
            minCharType: 'Doit contenir au moins {0} des types de caractères suivants: ' +
                'lettres, chiffres et caractères spéciaux ( `~!@#$%^&*()-_=+\|[{}];:\'\",<.>/ ? et espaces). ',
            notEqualPosRev: 'Il ne peut s\'agir du nom d\'utilisateur ou du nom d\'utilisateur orthographié à l\'envers.'
        },
        passwordStrength: {
            securityText: 'Force du mot de passe :',
            levelDecArr: ['Faible', 'Moyen', 'Fort']
        }
    },
    tiPagination: {
        gotoLabel: 'Aller',
        prevTitle: 'Précédent',
        nextTitle: 'Prochain',
        totalLabel: 'Total des enregistrements: '
    },
    tiMessage: {
        prompt: 'Information',
        warn: 'Attention',
        confirm: 'Confirmer',
        error: 'Erreur',
        ok: 'OK',
        cancel: 'Annuler'
    },
    tiUpload: {
        addFile: 'Ajouter le fichier',
        error: 'Échec à télécharger le fichier.',
        successInfo: 'Etape réalisée avec succès.',
        uploadingSingleInfo: 'Téléchargement',
        errorSingleInfo: 'Échec à télécharger le fichier.',
        addSuccessMutiInfo: 'Vous avez ajouté {0} fichiers.',
        uploadingMutiInfo: 'Téléchargement : {0}',
        errorMultiInfo: 'Echec à télécharger {0} fichiers.',
        clearAll: 'Tout effacer',
        upload: 'Télécharger',
        cancel: 'Annuler',
        reload: 'Télécharger à nouveau',
        autoUploadFilePlaceholder: 'Sélectionnez un fichier à télécharger.',
        autoUploadFilesPlaceholder: 'Sélectionnez les fichiers à télécharger.',
        notAutoUploadFilePlaceholder: 'Ajoutez un fichier et le télécharger.',
        notAutoUploadFilesPlaceholder: 'Ajoutez des fichiers et les télécharger.'
    },
    tiDate: {
        datePlaceholder: 'Sélectionnez une date.',
        datetimePlaceholder: 'Sélectionnez une date et une heure.',
        weekNamesAbb: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
        weeknamesTitle: ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'],
        monthNamesAbb: ['Jan', 'Feb', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 mois', '1 an', '2 ans', '3 ans'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Date de début',
        rangeEndLabel: 'Date de fin',
        selectTime: `Sélectionner l'heure`,
        selectDate: 'Sélectionner la date',
        hour: 'Heure',
        minute: 'Minute',
        second: 'Second'
    },
    tiSelect: {
        search: 'Recherchez',
        selected: 'Sélectionné'
    },
    tiTable: {
        colsToggleTip: 'Personnaliser la colonne'
    },
    tiList: {
        selectAll: '(Sélectionner tout)'
    },
    tiIntro: {
        skip: 'Sauter',
        previous: 'Précédent',
        next: 'Suivant',
        finish: 'Terminer'
    },
    tiPopconfirm: {
        yesLabel: 'Oui',
        noLabel: 'Non'
    },
    tiTree: {
        reload: 'Recharger',
        loadError: 'Le chargement a échoué. ',
        newNode: 'Nouveau nœud '
    }
};

/**
 * @ignore
 * Tiny组件中使用的葡语国际化词条
 */
const pt_BR = {
    tiLocaleKey: 'pt-BR',
    tiLocaleDate: {
        date: 'dd/MM/yyyy',
        time: 'HH:mm:ss'
    },
    tiCommon: {
        okBtn: 'OK',
        cancelBtn: 'Cancelar'
    },
    tiActionmenu: {
        more: 'Mais',
        operation: 'Operação'
    },
    tiValid: {
        errorMsg: {
            required: 'Este campo não pode ser deixado em branco.',
            maxLength: 'Insira um máximo de {0} caracteres.',
            minLength: 'Insira pelo menos {0} caracteres.',
            rangeSize: 'Insira de {0} a {1} caracteres.',
            maxValue: 'Insira um valor inferior ou igual a {0}.',
            minValue: 'Insira um valor superior ou igual a {0}.',
            rangeValue: 'Insira um valor de {0} a {1}.',
            regExp: 'Valor inválido.',
            contains: 'O valor deve conter os caracteres a seguir: {0}.',
            notContains: 'O valor não pode conter os caracteres a seguir: {0}.',
            notScript: 'O valor não pode conter tags de scripts.',
            equal: 'O valor deve ser {0}.',
            notEqual: 'O valor não pode ser {0}.',
            port: 'Insira um número inteiro de {0} a {1}.',
            path: 'Insira um caminho de arquivo válido.',
            email: 'Insira um endereço de e-mail válido.',
            date: 'Insira uma data válida.',
            url: 'Insira uma URL válida.',
            integer: 'Insira um número inteiro válido.',
            number: 'Insira um número válido.',
            digits: 'Insira um número válido.',
            ipv4: 'Insira um endereço IPv4 válido.',
            ipv6: 'Insira um endereço IPv6 válido.',
            password: 'Senha inválida.'
        },
        message: {
            rangeSize: 'Deve ter de {0} a {1} caracteres.',
            minCharType: 'Deve conter pelo menos {0} dos seguintes tipos de caracteres: ' +
                'letras, dígitos e caracteres especiais ( `~!@#$%^&*()-_=+\\|[{}];:\'\",<.>/? e espaços). ',
            notEqualPosRev: 'Não pode ser o nome de usuário escrito normalmente ou de trás para frente.'
        },
        passwordStrength: {
            securityText: 'Força da senha:',
            levelDecArr: ['Fraca', 'Média', 'Forte']
        }
    },
    tiPagination: {
        gotoLabel: 'Ir',
        prevTitle: 'Anterior',
        nextTitle: 'Próximo',
        totalLabel: 'Total de registros: '
    },
    tiMessage: {
        prompt: 'Informação',
        warn: 'Aviso',
        confirm: 'Confirmar',
        error: 'Erro',
        ok: 'OK',
        cancel: 'Cancelar'
    },
    tiUpload: {
        addFile: 'Selecionar arquivo',
        error: 'Não foi possível carregar o arquivo.',
        successInfo: 'Arquivo carregado com sucesso.',
        uploadingSingleInfo: 'Carregando',
        errorSingleInfo: 'Não foi possível carregar o arquivo.',
        addSuccessMutiInfo: 'Você adicionou {0} arquivos.',
        uploadingMutiInfo: 'Carregando: {0}',
        errorMultiInfo: 'Não foi possível carregar {0} arquivos.',
        clearAll: 'Limpar tudo',
        upload: 'Carregar',
        cancel: 'Cancelar',
        reload: 'Carregar novamente',
        autoUploadFilePlaceholder: 'Selecione um arquivo para ser carregado.',
        autoUploadFilesPlaceholder: 'Selecione arquivos para serem carregados.',
        notAutoUploadFilePlaceholder: 'Adicione um arquivo e carregue-o.',
        notAutoUploadFilesPlaceholder: 'Adicione arquivos e carregue-os.'
    },
    tiDate: {
        datePlaceholder: 'Selecione uma data.',
        datetimePlaceholder: 'Selecione uma data e um horário.',
        weekNamesAbb: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
        weeknamesTitle: ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'],
        monthNamesAbb: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        btnSliderArr: ['1', '2', '3', '4', '5', '6', '7', '8', '9 meses', '1 ano', '2 anos', '3 anos'],
        yearSuffixLabel: '',
        rangeBeginLabel: 'Data de início',
        rangeEndLabel: 'Data de término',
        selectTime: 'Selecionar horário',
        selectDate: 'Selecionar data',
        hour: 'Hora',
        minute: 'Minuto',
        second: 'Segundo'
    },
    tiSelect: {
        search: 'Pesquisar',
        selected: 'Selecionados:'
    },
    tiTable: {
        colsToggleTip: 'Personalizar coluna'
    },
    tiList: {
        selectAll: '(Selecionar tudo)'
    },
    tiIntro: {
        skip: 'Pular',
        previous: 'Anterior',
        next: 'Próximo',
        finish: 'Finalizar'
    },
    tiPopconfirm: {
        yesLabel: 'Sim',
        noLabel: 'Não'
    },
    tiTree: {
        reload: 'Recarregar',
        loadError: 'Erro no carregamento. ',
        newNode: 'Novo nó '
    }
};

/**
 * Tiny组件中使用的国际化词条配置方法类
 *
 * 可通过在启动模块中通过配置具体的国际化语种的方式设置组件的国际化，使用方式如下：
 *
 *
 *      import {TiLocale} from '@cloud/tiny3';
 *
 *      export class AppModule {
 *
 *          constructor() {
 *              TiLocale.setLocale(TiLocale.EN_US);
 *          }
 *      }
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/locale/locale-basic" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiLocale {
    /**
     * 静态代码段执行：如过word和locale未初始化，那么执行初始化。
     */
    static initWordsAndLocale() {
        if (!TiLocale.getWords()) {
            // 默认所有语言都打包进来
            TiLocale.setWords({
                'zh-CN': zh_CN,
                'en-US': en_US,
                'de-DE': de_DE,
                'es-ES': es_ES,
                'es-US': es_US,
                'fr-FR': fr_FR,
                'pt-BR': pt_BR
            });
        }
        if (!TiLocale.getLocale()) {
            TiLocale.setLocale(TiLocale.ZH_CN);
        }
    }
    /**
     * Sets words
     * @param Words 全量的语言包，由语言名称：语言词条包组成。
     *
     * @returns words
     */
    static setWords(words) {
        // 设计缺陷：如果tiWords放在类成员变量上，会更好。window在SSR环境找不到。
        if (typeof window !== 'undefined') {
            window.tiWords = words;
        }
        else if (typeof global !== 'undefined') {
            global.tiWords = words;
        }
    }
    static getWords() {
        if (typeof window !== 'undefined') {
            return window.tiWords;
        }
        else if (typeof global !== 'undefined') {
            return global.tiWords;
        }
    }
    /**
     * 设置组件国际化语种
     * @param locale 国际化字符，可通过TiLocale.ZH_CN/TiLocale.EN_US等语种关键字设置参数
     */
    static setLocale(locale) {
        if (typeof window !== 'undefined') {
            window.tiLocale = locale;
        }
        else if (typeof global !== 'undefined') {
            global.tiLocale = locale;
        }
    }
    static getLocale() {
        if (typeof window !== 'undefined') {
            return window.tiLocale;
        }
        else if (typeof global !== 'undefined') {
            return global.tiLocale;
        }
    }
    /**
     * 设置组件国际化语种
     * @param localeKey 国际化字符，可通过TiLocale.ZH_CN/TiLocale.EN_US等语种关键字设置参数
     */
    /**
     * @ignore
     * 获取当前语言下，组件国际化语种对应的词条集合
     */
    static getLocaleWords() {
        return TiLocale.getWords()[TiLocale.getLocale()];
    }
    /**
     * @ignore
     * 获取单个词条的国际化文本/对象
     * 参数：
     */
    static translate(keyValue, params) {
        const keyArr = keyValue.split('.');
        let value = TiLocale.getLocaleWords();
        keyArr.forEach((key) => {
            value = value[key];
        });
        return Util.formatEntry(value, params);
    }
}
/**
 * 英文语种关键字，关键字均使用中划线形式命名，确保和浏览器保持一致
 */
TiLocale.EN_US = 'en-US';
/**
 * 语种关键字
 */
TiLocale.ZH_CN = 'zh-CN';
/**
 * 语种关键字
 */
TiLocale.DE_DE = 'de-DE';
/**
 * 语种关键字
 */
TiLocale.ES_ES = 'es-ES';
/**
 * 语种关键字
 */
TiLocale.ES_US = 'es-US';
/**
 * 语种关键字
 */
TiLocale.FR_FR = 'fr-FR';
/**
 * 语种关键字
 */
TiLocale.PT_BR = 'pt-BR';
// private static localeKey: string = TiLocale.ZH_CN; // 语种关键字
/**
 * Typescript没有静态代码段，所以这样代替静态代码段
 */
TiLocale.staticCode = TiLocale.initWordsAndLocale();

/**
 * @ignore
 */
class TiTranslatePipe {
    transform(keyValue, params) {
        return TiLocale.translate(keyValue, params);
    }
}
TiTranslatePipe.decorators = [
    { type: Pipe, args: [{
                name: 'tiTranslate'
            },] }
];

/**
 * @ignore
 *
 * 只供内部使用，外部使用tinyplus3提供的国际化方法
 *
 * 该类提供一个方法集，用于数字、时间日期的国际化处理
 * 其中 tiny提供的数字、时间日期和货币的国际化处理方法，用于屏蔽angular方法需要传入format/localeId的复杂处理
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/locale/locale-format" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
class TiLocaleFormat {
    /**
     * 获取语种关键字，默认为'en'
     * @return 语种关键字
     */
    static getLocaleKey() {
        let locale = TiLocale.getLocaleWords().tiLocaleKey;
        try { // local信息未注册情况下，getLocaleId该方法会报错，因此使用try catch的方式
            getLocaleId(TiLocale.getLocaleWords().tiLocaleKey);
        }
        catch (error) {
            locale = TiLocaleFormat.DEFAULT_LOCALE;
        }
        return locale;
    }
    /**
     * @description 对国际化数字进行处理(包含小数点)
     * @param: number 国际化数字
     * @param: isIntegerValid 只针对integer的情况
     * @return 返回数字信息
     */
    static parseNumWithDecimal(number, isIntegerValid) {
        const groupSep = TiLocaleFormat.getNumberSymbol('Group');
        const decimalSep = TiLocaleFormat.getNumberSymbol('Decimal');
        /* tslint:disable:prefer-template */
        const numberReg = new RegExp('^(?:-?\\d*|-?\\d(?:\\' + groupSep + '?\\d*)+)?(?:\\' + decimalSep + '\\d*)?$');
        // const numberFormat = number.toString();
        const numberFormat = number;
        if (!numberReg.test(numberFormat)) {
            return NaN;
        }
        const groupReg = new RegExp('\\' + groupSep, 'g');
        const decimalReg = new RegExp('\\' + decimalSep, 'g');
        const numberFormatString = numberFormat.replace(groupReg, '')
            .replace(decimalReg, '.');
        const numberFloat = parseFloat(numberFormatString);
        /*
        * *只针对integer的情况
        * 截取转换前的小数位字符串numFormatSlice
        * 转换前的小数位字符串长度numFormatCount
        * 转换后的小数位为0,就添加小数位个数的0，返回值是string类型
        * */
        if (isIntegerValid && (numberFormatString.indexOf('.') !== -1)) {
            return numberFormatString;
        }
        return numberFloat;
    }
    /**
     * 获取数字规则信息
     * key 规则关键字
     */
    static getNumberSymbol(key) {
        const standardNumber = 10000.0;
        const localeNumber = TiLocaleFormat.formatNumber(standardNumber, '1.1-1');
        return key === 'Group' ? localeNumber.charAt(2) : localeNumber.charAt(6);
    }
    /**
     * @description 对数字进行国际化处理
     * @param: number 数字
     * @param: numberFormat 数字格式化形式
     * @return 返回格式化后的信息
     */
    static formatNumber(number, format) {
        let options;
        if (format) {
            options = {
                minimumIntegerDigits: format.substring(0, format.indexOf('.')),
                minimumFractionDigits: format.substring(format.indexOf('.') + 1, format.indexOf('-')),
                maximumFractionDigits: format.substring(format.indexOf('-') + 1)
            };
        }
        // TODO: new Intl.NumberFormat es西语下整数部分有四位时，本地化数字没有千位分隔
        const res = new Intl.NumberFormat(TiLocale.getLocaleWords().tiLocaleKey, options)
            .format(number);
        return res;
    }
    /**
     * @description 对国际化数字进行标准化处理
     * @param: number 国际化数字
     * @return 返回数字信息
     */
    static parseNumber(number) {
        return parseFloat(TiLocaleFormat.parseNumWithDecimal(number));
    }
    /**
     * @description 对时间进行国际化处理
     * @param: time 时间
     * @param: format 时间格式
     * @return 返回格式化后的信息
     */
    static formatTime(time, format, timezone) {
        return formatDate(time, format || TiLocaleFormat.TIME_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * @description 对日期进行国际化处理
     * @param date 日期
     * @param format 日期格式
     * @return 返回格式化后的信息
     */
    static formatDate(date, format, timezone) {
        return formatDate(date, format || TiLocaleFormat.DATE_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * @description 对时间日期进行国际化处理
     * @param: 时间日期
     * @param: 时间日期格式
     * @return 返回格式化后的信息
     */
    static formatDateTime(dateTime, format, timezone) {
        return formatDate(dateTime, format || TiLocaleFormat.DATETIME_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * 功能描述：去除千位分隔符，得到标准化数字
     * value: 带有千位分隔符的数据
     */
    static deleteGroupSep(value) {
        let res;
        res = String(value);
        const groupSep = TiLocaleFormat.getNumberSymbol('Group');
        const groupSepReg = new RegExp('\\' + groupSep, 'g');
        return res.replace(groupSepReg, '');
    }
    /**
     * 检测format接口配置是否合法。目前spinner和inputnumber组件会用到
     */
    static isInvalidFormat(format) {
        if (typeof (format) !== 'string'
            || format.charAt(0)
                .toUpperCase() !== 'N'
            || Number.isNaN(parseInt(format.slice(1), 10))) {
            return true;
        }
        return false;
    }
}
TiLocaleFormat.TIME_FORMAT = 'mediumTime'; // 'h:mm:ss a' (e.g. 9:03:01 AM)
TiLocaleFormat.DATE_FORMAT = 'mediumDate'; // 'MMM d, y' (e.g. Jun 15, 2015).
TiLocaleFormat.DATETIME_FORMAT = 'medium'; // 'MMM d, y, h:mm:ss a' (e.g. Jun 15, 2015, 9:03:01 AM)
TiLocaleFormat.DEFAULT_LOCALE = 'en';

/* tslint:disable:file-name-casing */

/**
 * @ignore
 */
class TiLocaleModule {
}
TiLocaleModule.decorators = [
    { type: NgModule, args: [{
                declarations: [TiTranslatePipe],
                exports: [TiTranslatePipe]
            },] }
];

/**
 * @ignore
 *  列表组件，使用者有menu、droplist
 */
class TiListComponent extends TiFormComponent {
    constructor(render, hostRef, zone) {
        super(hostRef, render);
        this.zone = zone;
        // 列表数据配置
        this.multiple = false; // 是否多选
        this.labelKey = 'label'; // 要显示的字段
        this.tipPosition = 'right';
        this.noDataText = '...'; // 无数据时的显示文本
        this.hideEmptyOption = false; // 过滤空字符串选项
        this.selectAll = false; // 多选模式下是否有全选功能
        /**
         * 10.0.4 版本新增，
         * 用于配置是否显示children字段数据，大部分场景需要显示children，cascader不需要
         */
        this.showChildren = true;
        /**
         * @ignore
         * 10.1.0新增
         * 适配内部time类组件，点选滚动效果,暂不开放。
         */
        this.scrollTop = 0;
        /**
         * 选中事件，向外通知option数据
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        this.hover = new EventEmitter();
        /**
         *  需要阻止失焦标记: 点击面板时，会触发失焦，需要阻止失焦。
         *  IE兼容性问题: 点击滚动条，触发失焦，面板会收起
         *  修复方案：点击list面板区域（包含滚动条）后，给失焦元素强制获取焦点。修改Form基类不触发组件整体失焦。
         */
        this.stopBlur = false;
        this.unlistenIEScrollbarBugFns = [];
        this.selectAllText = TiLocale.getLocaleWords().tiList.selectAll;
        this.optionSelectAll = 'all';
        this.optionScrollTopLastTime = 0;
        // 判断是否禁用的函数: 函数类型是(any) => boolean，赋值是(item: any) => {}
        this.isDisabledFn = (item) => {
            return item && item.disabled === true;
            // tslint:disable-next-line:semicolon
        }; // 这个分号是书写正确的
    }
    get hoverOption() {
        return this._hoverOption;
    }
    set hoverOption(hoverOption) {
        if (this._hoverOption !== hoverOption) {
            this._hoverOption = hoverOption;
            this.hover.emit(hoverOption);
        }
    }
    // 在Selected使用List时，Selected的聚焦元素是Dominator和Searchbox，它们接收按键，并调用list来处理。
    // 在表格列设置时，List自己聚焦，List处理按键。
    onKeydown(event) {
        // 10.0.2删除 KEY_SPACE 空格快捷键的响应
        switch (event.keyCode) {
            case TiKeymap.KEY_ENTER: // ENTER键 相当于click
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(苹果数字小键盘)
                if (this.hoverOption) {
                    this.selectOption(this.hoverOption);
                }
                break;
            case TiKeymap.KEY_ESCAPE: // Esc键，仅可关闭
            case TiKeymap.KEY_TAB: // Tab键，仅可关闭
                break;
            case TiKeymap.KEY_ARROW_UP: // 向上箭头，上移选项
                event.preventDefault(); // 防止上下按键默认行为：移动滚动条
                this.nextOption(true);
                break;
            case TiKeymap.KEY_ARROW_DOWN: // 向下箭头，下移选项
                event.preventDefault(); // 防止上下按键默认行为：移动滚动条
                this.nextOption(false);
                break;
            default:
                break;
        }
    }
    ngOnInit() {
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(this.nativeElement, 'mousedown', (event) => {
                // Select时，点击滚动条和点击面板，不要触发默认行为：dominator blur
                // 现在，list默认不聚焦。在所有场合，点击面板或者滚动条，都不触发默认焦点事件。
                event.preventDefault(); // 防止dominator blur行为
                // list自身可以落焦点时，需要聚焦的默认行为。
            });
            // list内部滚动条会引起外部滚动条事件触发，引起弹框内的下拉组件无法使用鼠标拖动滚动条，因此此处阻止事件冒泡
            this.renderer.listen(this.nativeElement, 'mousewheel', (event) => {
                event.stopPropagation();
            });
            this.renderer.listen(this.nativeElement, 'DOMMouseScroll', (event) => {
                event.stopPropagation();
            });
        });
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        if (this.multiple && this.selectAll) {
            const optionsChange = changes['options'];
            if (optionsChange) {
                this.setSelectedAllState();
            }
        }
        // time及datetime/datetimeRange组件使用list，点选时候需要滚动效果
        if (changes['scrollTop'] && !changes['scrollTop'].firstChange) {
            this.setScrollFn();
        }
        if (changes['options']) {
            this.setHoverOption();
        }
    }
    ngAfterViewInit() {
        if (this.scrollTop > 0) {
            this.setScrollFn();
        }
    }
    writeValue(model) {
        super.writeValue(model);
        if (this.multiple && this.selectAll) {
            this.setSelectedAllState();
        }
    }
    // time及datetime/datetimeRange组件使用list，点选时候需要滚动效果
    setScrollFn() {
        if (TiBrowser.isIE()) {
            this.renderer.setProperty(this.hostRef.nativeElement, 'scrollTop', this.scrollTop);
            return;
        }
        this.hostRef.nativeElement.scrollTo(0, this.scrollTop);
    }
    // 下拉选项的鼠标按下操作
    onMousedownItem(event, own) {
        event.preventDefault();
        event.stopPropagation();
        own.classList.add('ti3-menu-panel-list-active');
    }
    // 下拉选项的鼠标按下后的抬起操作
    onMouseupItem(event, own) {
        this.removeClass(event, own);
    }
    // 下拉选项的鼠标离开时的操作
    onMouseleaveItem(event, own) {
        this.removeClass(event, own);
    }
    // 移除li元素上的ti3-menu-panel-list-active类
    removeClass(event, own) {
        event.preventDefault();
        event.stopPropagation();
        own.classList.remove('ti3-menu-panel-list-active');
    }
    // 下拉选项的单击操作（包括组名所在的<li>元素）
    onClickItem(event, option) {
        // Selected时，点击选项，不要触发默认行为：dominator blur。
        event.preventDefault(); // 防止dominator blur行为
        // Group节点和禁用节点，无需响应。
        if (this.isGroup(option) || this.isDisabledFn(option)) {
            event.stopPropagation();
            return;
        }
        // 只处理左键和中键
        if (event.button !== TiKeymap.MOUSE_LEFT_BUTTON
            && event.button !== TiKeymap.MOUSE_MIDDLE_BUTTON) { // Tiny2这里逻辑错误TODO：
            return;
        }
        // 点击选中项
        this.selectOption(option);
        // 更新hover
        this.hoverOption = option;
    }
    selectOption(option) {
        // 全选
        if (this.multiple && this.selectAll && option === this.optionSelectAll) {
            this.selectAllOptions();
            this.select.emit(option);
            return;
        }
        let index = -1;
        if (this.multiple) { // 多选
            if (!this.model) { // 如果为空值
                this.model = [];
            }
            // 是否选中，取反
            index = this.model.indexOf(option);
            if (index === -1) {
                this.model.push(option); // 点击下拉项选中，选中项按用户操作顺序显示
            }
            else if (index !== -1) {
                this.model.splice(index, 1);
            }
            // 强行向外通知model改变。
            this.model = this.model.concat();
            // 设置全选状态
            if (this.selectAll) {
                this.setSelectedAllState();
            }
        }
        else { // 单选
            this.model = option;
        }
        this.select.emit(option);
    }
    selectAllOptions() {
        if (!this.model) { // 如果为空值
            this.model = [];
        }
        const listOptions = this.getListOptions();
        let isChange = false;
        if (this.selectAllState === false || this.selectAllState === null) {
            listOptions.forEach((item) => {
                if (this.model.indexOf(item) === -1 && this.isSelectable(item)) { // 不在当前选中项且为可选数据项（排除禁用项和组名项）
                    // 点击全选按钮时的选中值顺序与option的顺序一致
                    const insertIndex = this.getInsertIndex(item);
                    this.model.splice(insertIndex, 0, item);
                    isChange = true;
                }
            });
            this.selectAllState = true;
        }
        else {
            listOptions.forEach((item) => {
                const index = this.model.indexOf(item);
                if (index !== -1 && !this.isDisabledFn(item)) {
                    this.model.splice(index, 1);
                    isChange = true;
                }
            });
            this.selectAllState = false;
        }
        if (isChange) {
            // model的值在以上循环中，多次变化，或者不变，根据isChange，一次性触发变化检测
            this.model = this.model.concat();
        }
    }
    setSelectedAllState() {
        if (!this.model || this.model.length === 0 || !this.options || this.options.length === 0) {
            this.selectAllState = false;
            return;
        }
        const listOptions = this.getListOptions();
        const selectedOptions = listOptions.filter((item) => {
            return this.isSelectable(item) && this.model.includes(item);
        });
        if (selectedOptions.length === 0) {
            this.selectAllState = false;
            return;
        }
        const selectableOptions = listOptions.filter((item) => {
            return this.isSelectable(item);
        });
        this.selectAllState = selectedOptions.length === selectableOptions.length ? true : null;
    }
    // 获取新插入元素的插入次序，该次序与list集合中的元素顺序保持一致
    getInsertIndex(option) {
        const listOptions = this.getListOptions();
        const indexOfList = listOptions.indexOf(option); // 当前元素在list中的排序
        // 将该元素与已选中在list中的次序进行比较，如果该元素在某选中项次序之后，则将其插入该元素之后
        for (let i = this.model.length; i > 0; i--) {
            const itemIndexOfList = listOptions.indexOf(this.model[i - 1]);
            if (itemIndexOfList < indexOfList) {
                return i;
            }
        }
        return 0;
    }
    onMouseenterItem(event, option) {
        // 是可选项，且不是在选中项置Top时鼠标经过。
        // tslint:disable-next-line:prefer-conditional-expression
        if (this.isSelectable(option) && new Date().getTime() - this.optionScrollTopLastTime > TiListComponent.SCROLL_TOP_TIME) {
            this.hoverOption = option; // 更新hover
        }
    }
    // 寻找下一个可选项。参数：向上/向下
    nextOption(isUp) {
        const listOptions = this.getListOptions();
        if (this.multiple && this.selectAll) {
            listOptions.unshift(this.optionSelectAll);
        }
        if (listOptions.filter((x) => this.isSelectable(x)).length === 0) { // 没有可选中的项目
            return;
        }
        let nextOption = this.hoverOption;
        let curIndex = listOptions.indexOf(nextOption);
        do {
            if (isUp) {
                // tslint:disable-next-line:prefer-conditional-expression
                if (curIndex > 0) { // 找到了，且不是第一个元素
                    curIndex = curIndex - 1;
                }
                else { // -1没有找到, 0第一个元素
                    curIndex = listOptions.length - 1; // 跳到第一个元素。
                }
            }
            else {
                // tslint:disable-next-line:prefer-conditional-expression
                if (curIndex < listOptions.length - 1) { // -1没有找到, 和不是最后一个
                    curIndex = curIndex + 1;
                }
                else { // length - 1 最后一个元素
                    curIndex = 0; // 跳到第一个元素。
                }
            }
            nextOption = listOptions[curIndex];
        } while (!(this.isSelectable(nextOption) || nextOption === this.hoverOption)); // 找到停止，或者寻找一圈停止
        // 没有找到结果
        if (nextOption === null || nextOption === this.hoverOption) {
            return;
        }
        // 改变hover选项。
        this.hoverOption = nextOption;
        // 更新滚动条
        this.optionScollTop(this.hoverOption);
    }
    getListOptions() {
        let listOptions = []; // 装有所有选项的数组
        if (this.options) {
            this.options.forEach((x) => {
                listOptions.push(x);
                if (this.isGroup(x)) {
                    listOptions = listOptions.concat(x.children);
                }
            });
        }
        return listOptions;
    }
    // 滚动到选中项元素，多选定位到第一个选中项元素，无选中项时定义到第一项元素；
    // 适用于每次下拉打开的场景
    scrollToSelected() {
        // 获取当前选中项
        let selectedItem;
        // tslint:disable-next-line:prefer-conditional-expression
        if (this.multiple) {
            selectedItem = (this.model && this.model.length > 0) ? this.model[0] : null;
        }
        else {
            selectedItem = this.model;
        }
        if (selectedItem) { // 有选中项时，自动定位到第一个选中元素
            this.scrollToEle(selectedItem, true);
        }
        else { // 无选中项时，定位在第一项元素
            this.nativeElement.scrollTop = 0;
        }
        this.setHoverOption();
    }
    /**
     * 设置hoverOption
     * 用于数据更新时，非鼠标或快捷键操作时
     */
    setHoverOption() {
        var _a, _b;
        this.hoverOption = ((_a = this.options) === null || _a === void 0 ? void 0 : _a.length) > 0
            ? (this.hasSelectedinList()
                ? this.getHoverOptionInModel()
                : (this.multiple && this.selectAll
                    ? this.optionSelectAll
                    : (((_b = this.options[0]) === null || _b === void 0 ? void 0 : _b.children) ? this.getGroupHoverOption()
                        : this.options.find((option) => !this.isDisabledFn(option)))))
            : undefined;
    }
    /**
     * 单选有model的时候，单选的model不会是禁用项，hoverOption应当是model，
     * 多选有model的时候，hoverOption是第一个非禁用的model，如果model全部禁用，hoverOption是第一个禁用项往下的第一个可用项。
     */
    getHoverOptionInModel() {
        return this.multiple
            ? (this.model.find((item) => !this.isDisabledFn(item))
                || this.options.find((item, index) => {
                    return index > this.options.indexOf(this.model[0]) && !this.isDisabledFn(item);
                }))
            : this.model;
    }
    /**
     * 判断当前list中是否有选中项，过滤后的数据有可能不含有选中项
     */
    hasSelectedinList() {
        var _a;
        const listOption = this.getListOptions();
        if (this.multiple && ((_a = this.model) === null || _a === void 0 ? void 0 : _a.length) > 0) {
            return !!this.model.find((item) => listOption.includes(item));
        }
        else if (this.model) {
            return listOption.includes(this.model);
        }
        else {
            return false;
        }
    }
    // 分组情况下，找到hoverOption
    getGroupHoverOption() {
        let groupHoverOption;
        this.options.find((option) => {
            if (option.children.length > 0) {
                groupHoverOption = option.children.find((child) => !this.isDisabledFn(child));
            }
            return groupHoverOption ? true : false; // 这个return只是为了结束find方法
        });
        return groupHoverOption; // 这个return是为了返回查找结果
    }
    scrollToEle(option, isScrollBySelected = false) {
        if (!option || !this.ulRef) { // 第一次model值改变时, ulRef不存在。
            return;
        }
        const listOptions = this.getListOptions();
        if (this.multiple && this.selectAll) {
            listOptions.unshift(this.optionSelectAll);
        }
        const curIndex = listOptions.indexOf(option);
        if (curIndex < 2 && isScrollBySelected) {
            return; // 前两项不需要滚动
        }
        // 下拉框有滚动条时，若上下选项足够，选中项为下拉框的第二项，这样可以展示选中项的前后选项
        const scrollTopOptionIndex = Math.max(curIndex - 1, 0);
        const ele = this.ulRef.nativeElement.getElementsByTagName('LI')[scrollTopOptionIndex];
        if (ele) {
            this.nativeElement.scrollTop = ele.offsetTop;
        }
    }
    optionScollTop(option) {
        this.optionScrollTopLastTime = new Date().getTime();
        this.scrollToEle(option);
    }
    // 是组数据项
    isGroup(item) {
        return item && item.hasOwnProperty('children') && this.showChildren;
    }
    // 是可选数据项
    isSelectable(item) {
        return !this.isGroup(item) && !this.isDisabledFn(item);
    }
    // 是已选中数据项
    isSelected(item) {
        return (!this.multiple && item === this.model) ||
            (this.multiple && this.model && this.model.includes(item));
    }
    /**
     * 修复点击IE滚动条，面板关闭。
     * 打开面板时监听，关闭和销毁面板时取消监听。
     */
    listenIESrollbarBug() {
        // IE兼容性涉及知识，见本文件底部。
        // IE兼容性问题: 点击滚动条，触发失焦，面板会收起
        // 修复方案：点击list面板区域（包含滚动条）后，给失焦元素强制获取焦点。修改Form基类不触发组件整体失焦。
        if (TiBrowser.isIE()) {
            // 点击面板，阻止Blur
            this.unlistenIEScrollbarBugFns.push(this.renderer.listen(this.nativeElement, 'mousedown', (event) => {
                this.stopBlur = true; // 标记，以供focusin消耗
                // 阻止冒泡到document，因为document会把标志位改回false。和下面修复双击滚动条Bug配合
                event.stopPropagation();
            }));
            // 修复bug：双击滚动条，再点击面板之外，不失焦。
            this.unlistenIEScrollbarBugFns.push(this.renderer.listen(document, 'mousedown', (event) => {
                // 点击面板之外区域，不阻止blur
                this.stopBlur = false;
            }));
            // IE事件顺序：focusout->foucsin->blur->focus, 支持冒泡的focusin/focusout, 不支持冒泡的是focus/blur
            this.unlistenIEScrollbarBugFns.push(this.renderer.listen(document.body, 'focusin', (event) => {
                if (this.stopBlur && event.relatedTarget !== document.body) {
                    // 本来不需要!==document, 但连续多次点击太快，会发生：刚点击一下，上次的dominator->body focusin, 会进来
                    // 清零，因为下面的聚焦事件，又会触发focusin事件，并不想处理
                    this.stopBlur = false; // 一般情况这里置为false是可以的。
                    // focusin事件，target是聚焦元素。relatedTarget是失焦元素。
                    // 强制让失焦元素，重新获得焦点。
                    event.relatedTarget.focus();
                }
            }));
        }
    }
    unlistenIESrollbarBug() {
        if (TiBrowser.isIE()) {
            // 解绑监听
            for (const x of this.unlistenIEScrollbarBugFns) {
                x();
            }
        }
    }
}
TiListComponent.SCROLL_TOP_TIME = 200; // 设置选中项滚动到TOP所需时间。Chorme下简单测试。TODO：其他浏览器、复杂数据
TiListComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-list',
                template: "<ul #ulRef tabindex=\"-1\" *ngIf=\"options&&options.length > 0 else nodatatemplate\"  [ngClass]=\"{'ti3-dropdown-group':isGroup(options[0])}\" class=\"ti3-drop-list-ul\" [id]=\"appendId('list')\">\r\n        <li *ngIf=\"selectAll && multiple\"\r\n            class=\"ti3-dropdown-option\"\r\n            [ngClass]=\"{'ti3-dropdown-option-hover': optionSelectAll === hoverOption}\"\r\n            (click)=\"onClickItem($event, optionSelectAll)\"\r\n            (mouseenter)=\"onMouseenterItem($event, optionSelectAll)\"\r\n            [id]=\"appendId('select_all')\">\r\n                <section class=\"ti3-overflow-padding\">\r\n                        <label  class=\"ti3-icon ti3-icon-checkmark ti3-multi-select-checkbox\"\r\n                                [ngClass]=\"{'ti3-multi-select-checkbox-selected': selectAllState === true,\r\n                                            'ti3-multi-select-checkbox-indeterminate': selectAllState === null}\">\r\n                        </label>\r\n                        <span [title]=\"selectAllText\">{{selectAllText}}</span>\r\n                </section>\r\n\r\n        </li>\r\n        <ng-container *ngFor=\"let option of options; let i = index\">\r\n                <ng-container *ngTemplateOutlet=\"optionTemplate; context:  {$implicit: option, index: i, liid: i}\">\r\n                </ng-container>\r\n                <ng-container *ngIf=\"showChildren\">\r\n                        <ng-container *ngFor=\"let child of option.children; let j = index;let last = last;\">\r\n                                <ng-container *ngTemplateOutlet=\"optionTemplate; context:  {$implicit: child, index: j, liid: i+'_'+j,last: last}\">\r\n                                </ng-container>\r\n                        </ng-container>\r\n                </ng-container>\r\n        </ng-container>\r\n</ul>\r\n<!-- no data\u6A21\u677F -->\r\n<ng-template #nodatatemplate>\r\n        <div class=\"ti3-dropdown-no-data\" [innerHtml]=\"noDataText\"></div>\r\n</ng-template>\r\n<!-- \u5206\u7EC4\u548C\u9009\u9879\u7684\u6A21\u677F -->\r\n<ng-template #optionTemplate let-item let-i=index let-lid=liid let-last=last><!--\u4E24\u5C42\u6A21\u677F\u5D4C\u5957\uFF0C\u6709\u70B9\u96BE\u7406\u89E3-->\r\n        <li #liRefs [ngClass]=\"{'ti3-dropdown-group-list':isGroup(item),\r\n                'ti3-dropdown-group-list-cascader': item.children && item.children.length > 0 && !showChildren,\r\n                'ti3-dropdown-option':!isGroup(item),\r\n                'ti3-dropdown-option-disabled': !isGroup(item)&&isDisabledFn(item),\r\n                'ti3-dropdown-option-selected': !isGroup(item)&&!multiple&&isSelected(item),\r\n                'ti3-dropdown-option-hover': !isGroup(item)&&item === hoverOption}\"\r\n                (click)=\"onClickItem($event, item)\"\r\n                (mouseenter)=\"onMouseenterItem($event, item)\"\r\n                [id]=\"appendId(lid)\">\r\n                        <section [tiTip]=\"item.tip\"\r\n                                [tiTipPosition]=\"tipPosition\"\r\n                                [tiTipHostEleX]=\"nativeElement\"\r\n                                [tiTipContext]=\"item\"\r\n                                class=\"ti3-overflow-padding\">\r\n                                <label *ngIf=\"multiple&&!isGroup(item)\"\r\n                                        class=\"ti3-icon ti3-icon-checkmark ti3-multi-select-checkbox\"\r\n                                        [ngClass]=\"{'ti3-multi-select-checkbox-selected': isSelected(item)}\">\r\n                                </label>\r\n                                <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item, index: i,last: last}\">\r\n                                        </ng-container>\r\n                                </ng-container>\r\n                                <ng-template #labelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n                        </section>\r\n        </li>\r\n</ng-template>",
                providers: [TiFormComponent.getValueAccessor(TiListComponent)],
                styles: ["::ng-deep :root{--ti-multiselect-text-min-height:30px}:host{box-sizing:border-box;display:inline-block;overflow-x:hidden;overflow-y:auto;padding:var(--ti-common-space-base) 0;position:relative}:host:focus{outline:none}.ti3-dropdown-group>.ti3-dropdown-option{padding-left:var(--ti-common-space-3x)}.ti3-overflow-padding{overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.ti3-dropdown-option{background-color:var(--ti-common-color-bg-white-normal);color:inherit;cursor:pointer;line-height:var(--ti-common-line-height-number);list-style:none;padding:var(--ti-common-space-6) 0;text-align:left}.ti3-dropdown-option [tiTextweaken]{color:var(--ti-common-color-text-weaken)}.ti3-dropdown-option:first-child{margin-top:0}.ti3-dropdown-group-list{box-sizing:border-box;color:var(--ti-select-group-color);font-weight:700;height:var(--ti-multiselect-text-min-height);line-height:var(--ti-multiselect-text-min-height);text-align:left}.ti3-dropdown-group-list-cascader{padding-right:var(--ti-common-space-4x);position:relative}.ti3-dropdown-group-list-cascader:after{border-bottom:5px solid var(--ti-common-color-icon-normal);border-left:4px solid transparent;border-right:4px solid transparent;content:\"\";display:block;height:0;position:absolute;right:calc(var(--ti-common-space-3x) - 2px);top:50%;transform:translateY(-50%) rotate(90deg);width:0}.ti3-dropdown-option-selected.ti3-dropdown-group-list-cascader:after{border-bottom-color:var(--ti-common-color-icon-white)}.ti3-dropdown-option-disabled.ti3-dropdown-group-list-cascader:after{border-bottom-color:var(--ti-common-color-icon-disabled)}.ti3-dropdown-no-data,.ti3-dropdown-option.ti3-dropdown-option-disabled,.ti3-dropdown-option.ti3-dropdown-option-disabled:hover,.ti3-dropdown-option.ti3-dropdown-option-disabled [tiTextweaken],.ti3-dropdown-option.ti3-dropdown-option-disabled [tiTextweaken]:hover{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-dropdown-no-data{line-height:var(--ti-common-line-height-number);padding:var(--ti-common-space-6) var(--ti-input-padding-horizontal)}.ti3-dropdown-option-hover,.ti3-dropdown-option-hover [tiTextweaken]{background-color:var(--ti-select-item-bg-color-hover);color:var(--ti-select-item-text-color-hover)}.ti3-dropdown-option-selected,.ti3-dropdown-option-selected [tiTextweaken]{background-color:var(--ti-select-item-selected-bg-color);color:var(--ti-select-item-selected-text-color)}.ti3-drop-list-ul{overflow-x:hidden;overflow-y:auto}", ".ti3-multi-select-checkbox{-ms-box-sizing:border-box;background-color:var(--ti-checkbox-bg-color);border:1px solid var(--ti-checkbox-border-color);border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;color:var(--ti-common-color-text-white);cursor:pointer;display:inline-block;height:var(--ti-checkbox-size);line-height:var(--ti-checkbox-mark-size);margin-right:10px;text-align:center;width:var(--ti-checkbox-size)}.ti3-dropdown-option .ti3-multi-select-checkbox-selected{background:var(--ti-checkbox-bg-color-checked);border-color:var(--ti-checkbox-bg-color-checked)}.ti3-dropdown-option .ti3-multi-select-checkbox-indeterminate{border-color:var(--ti-checkbox-bg-color-checked);border-width:5px;vertical-align:sub}.ti3-dropdown-option .ti3-multi-select-checkbox-indeterminate:before{content:\"\"}.ti3-dropdown-option-disabled .ti3-multi-select-checkbox{background:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-common-color-line-dividing);color:var(--ti-checkbox-bg-color-disable);cursor:not-allowed}.ti3-dropdown-option-disabled .ti3-multi-select-checkbox.ti3-multi-select-checkbox-selected{color:var(--ti-checkbox-mark-color-disabled)}"]
            },] }
];
TiListComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
TiListComponent.propDecorators = {
    multiple: [{ type: Input }],
    options: [{ type: Input }],
    labelKey: [{ type: Input }],
    tipPosition: [{ type: Input }],
    noDataText: [{ type: Input }],
    hideEmptyOption: [{ type: Input }],
    selectAll: [{ type: Input }],
    showChildren: [{ type: Input }],
    scrollTop: [{ type: Input }],
    select: [{ type: Output }],
    hover: [{ type: Output }],
    itemTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    ulRef: [{ type: ViewChild, args: ['ulRef',] }],
    isDisabledFn: [{ type: Input }],
    onKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
/*
IE兼容性问题：点击面板滚动条，触发失焦，无法阻止。
解决方案：给失焦元素强制获取焦点。修改Form基类不触发组件整体失焦。

涉及知识点：
点击div面板的滚动条，浏览器会失焦，焦点到body。event.preventDefault();，可以阻止默认失焦行为。
点击div面板的滚动条，浏览器会失焦，焦点到body。无法阻止。（问题产生）

Chrome浏览器事件顺序：
blur->focusout->focus->foucsin
IE浏览器事件顺序：
focusout->focusin->blur->focus

IE浏览器，在blur事件里，失焦元素.focus(),	会先显示失焦css，后显示聚焦css，会闪一下。
IE浏览器，在focusout事件里，失焦元素.focus(), 无效。
IE浏览器，在focusin事件里，失焦元素.focus(), 会一直显示聚焦css，不会闪。（作为解决问题的方案）

Chrome blur事件时，document.activeElement是body
IE blur事件时，document.activeElement是将要聚焦的元素。
IE 如果在focusin里，失焦元素.focus()，那么blur时document.activeElement刚好是这个失焦并强制聚焦的元素。

第一版方案：
强制聚焦，用了延时处理
整体onBlur时，IE特殊处理，不闭合面板
闭合面板时，处理标志位。
解决双击滚动条bug，利用监听面板之外点击。

第二版方案：
强制聚焦，不用延时。
修复Form基类，不再触发整体失焦/聚焦。
闭合面板时，处理标志位 （TODO: 设法去除。尽量集中对标志位的管理）
解决双击滚动条bug，利用监听面板之外点击。（TODO: 设法去除。尽量集中对标志位的管理）

第三版方案：
面板打开时监听mouse，面板闭合时不再监听

 */

/**
 * @ignore
 */
class TiListModule {
}
TiListModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiTipModule
                ],
                exports: [TiListComponent],
                declarations: [TiListComponent]
            },] }
];

/**
 * @ignore
 */
class TiMenuListComponent extends TiListComponent {
    constructor() {
        super(...arguments);
        this.panelAlign = 'right'; // 设置下拉菜单面板与按钮对齐方式。这里是为了决定了面板上箭头方向。
    }
    isSelectable(item) {
        return !this.isDisabledFn(item);
    }
    getListOptions() {
        return this.options;
    }
    hasBorder(item, items) {
        const index = items.indexOf(item);
        const indexPre = (index === 0) ? 0 : index - 1;
        return item.groupId !== items[indexPre].groupId;
    }
    onMouseenterItem(event, option) {
        // 不是在选中项置Top时鼠标经过。
        // tslint:disable-next-line:prefer-conditional-expression
        if (new Date().getTime() - this.optionScrollTopLastTime > TiListComponent.SCROLL_TOP_TIME) {
            this.hoverOption = option; // 更新hover
        }
    }
    // 防止继承list的ngOnChanges,初始化hoverOption变更触发hover事件，导致menu组件中的onhover事件报错
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnChanges() {
    }
}
TiMenuListComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-menulist',
                template: "<ul #ulRef *ngIf=\"options&&options.length > 0 else nodatatemplate\" [id]=\"appendId('list')\">\r\n        <ng-container *ngFor=\"let option of options; let i = index\">\r\n                <ng-container *ngTemplateOutlet=\"optionTemplate; context:  {$implicit: option, items:options, index: i, liid: i}\">\r\n                </ng-container>\r\n                <!-- <ng-container *ngFor=\"let child of option.children; let j = index;\">\r\n                        <ng-container *ngTemplateOutlet=\"optionTemplate; context:  {$implicit: child, index: j, liid: i+'_'+j}\">\r\n                        </ng-container>\r\n                </ng-container> -->\r\n        </ng-container>\r\n</ul>\r\n        <!-- no data\u6A21\u677F -->\r\n<ng-template #nodatatemplate>\r\n        <div class=\"ti3-dropdown-no-data\" [innerHtml]=\"noDataText\"></div>\r\n</ng-template>\r\n        <!-- \u5206\u7EC4\u548C\u9009\u9879\u7684\u6A21\u677F -->\r\n<ng-template #optionTemplate let-item let-items=items let-i=index let-lid=liid><!--\u4E24\u5C42\u6A21\u677F\u5D4C\u5957\uFF0C\u6709\u70B9\u96BE\u7406\u89E3-->\r\n        <!--\u76F8\u5BF9\u4E8Elist\uFF0C\u6837\u5F0F\u6709\u8C03\u6574-->\r\n        <li #liRefs class=\"ti3-menu-panel-list\"\r\n                [ngClass]=\"{'ti3-menu-panel-list-disabled':isDisabledFn(item),\r\n                'ti3-menu-groupId' : hasBorder(item,items),\r\n                'ti3-menu-panel-list-hover': item === hoverOption}\"\r\n                (mousedown)=\"onMousedownItem($event, liRefs)\"\r\n                (mouseup)=\"onMouseupItem($event, liRefs)\"\r\n                (click)=\"onClickItem($event, item)\"\r\n                (mouseenter)=\"onMouseenterItem($event, item)\"\r\n                (mouseleave)=\"onMouseleaveItem($event, liRefs)\"\r\n                [id]=\"appendId(lid)\">\r\n                <section style=\"display:inline\" *ngIf=\"isGroup(item)\"\r\n                         [ngClass]=\"{'ti3-menu-list-left-icon' : panelAlign === 'right',\r\n                          'ti3-menu-list-right-icon' : panelAlign === 'left'}\">\r\n                </section>\r\n                <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item, index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #labelTemplate>{{item[labelKey]}}</ng-template>\r\n        </li>\r\n</ng-template>",
                providers: [TiFormComponent.getValueAccessor(TiMenuListComponent)],
                styles: ["::ng-deep :root{--ti-multiselect-text-min-height:30px}:host{box-sizing:border-box;display:inline-block;overflow-x:hidden;overflow-y:auto;padding:var(--ti-common-space-base) 0;position:relative}:host:focus{outline:none}.ti3-dropdown-group>.ti3-dropdown-option{padding-left:var(--ti-common-space-3x)}.ti3-overflow-padding{overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.ti3-dropdown-option{background-color:var(--ti-common-color-bg-white-normal);color:inherit;cursor:pointer;line-height:var(--ti-common-line-height-number);list-style:none;padding:var(--ti-common-space-6) 0;text-align:left}.ti3-dropdown-option [tiTextweaken]{color:var(--ti-common-color-text-weaken)}.ti3-dropdown-option:first-child{margin-top:0}.ti3-dropdown-group-list{box-sizing:border-box;color:var(--ti-select-group-color);font-weight:700;height:var(--ti-multiselect-text-min-height);line-height:var(--ti-multiselect-text-min-height);text-align:left}.ti3-dropdown-group-list-cascader{padding-right:var(--ti-common-space-4x);position:relative}.ti3-dropdown-group-list-cascader:after{border-bottom:5px solid var(--ti-common-color-icon-normal);border-left:4px solid transparent;border-right:4px solid transparent;content:\"\";display:block;height:0;position:absolute;right:calc(var(--ti-common-space-3x) - 2px);top:50%;transform:translateY(-50%) rotate(90deg);width:0}.ti3-dropdown-option-selected.ti3-dropdown-group-list-cascader:after{border-bottom-color:var(--ti-common-color-icon-white)}.ti3-dropdown-option-disabled.ti3-dropdown-group-list-cascader:after{border-bottom-color:var(--ti-common-color-icon-disabled)}.ti3-dropdown-no-data,.ti3-dropdown-option.ti3-dropdown-option-disabled,.ti3-dropdown-option.ti3-dropdown-option-disabled:hover,.ti3-dropdown-option.ti3-dropdown-option-disabled [tiTextweaken],.ti3-dropdown-option.ti3-dropdown-option-disabled [tiTextweaken]:hover{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-dropdown-no-data{line-height:var(--ti-common-line-height-number);padding:var(--ti-common-space-6) var(--ti-input-padding-horizontal)}.ti3-dropdown-option-hover,.ti3-dropdown-option-hover [tiTextweaken]{background-color:var(--ti-select-item-bg-color-hover);color:var(--ti-select-item-text-color-hover)}.ti3-dropdown-option-selected,.ti3-dropdown-option-selected [tiTextweaken]{background-color:var(--ti-select-item-selected-bg-color);color:var(--ti-select-item-selected-text-color)}.ti3-drop-list-ul{overflow-x:hidden;overflow-y:auto}.ti3-menu-groupId{border-top:1px solid #ccc}.ti3-menu-panel-list{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;background-color:#fff;box-sizing:border-box;clear:both;cursor:pointer;display:block;font-weight:400;line-height:18px;padding:6px 20px;position:relative;text-decoration:none;user-select:none;white-space:inherit}.ti3-menu-panel-list.ti3-menu-panel-list-active,.ti3-menu-panel-list.ti3-menu-panel-list.ti3-menu-panel-list-selected-item{background:var(--ti-menu-panel-item-bg-active);color:var(--ti-menu-panel-item-color-active)}.ti3-menu-panel-list.ti3-menu-panel-list-active>.ti3-menu-list-left-icon,.ti3-menu-panel-list.ti3-menu-panel-list.ti3-menu-panel-list-selected-item>.ti3-menu-list-left-icon{border-right-color:var(--ti-menu-panel-item-color-active)}.ti3-menu-panel-list.ti3-menu-panel-list-active>.ti3-menu-list-right-icon,.ti3-menu-panel-list.ti3-menu-panel-list.ti3-menu-panel-list-selected-item>.ti3-menu-list-right-icon{border-left-color:var(--ti-menu-panel-item-color-active)}.ti3-menu-panel-list.ti3-menu-panel-list-disabled{background-color:#fff;cursor:not-allowed}.ti3-menu-panel-list.ti3-menu-panel-list-disabled ::ng-deep *{color:var(--ti-menu-item-color-disabled)!important}.ti3-menu-panel-list.ti3-menu-panel-list-disabled>.ti3-menu-list-left-icon{border-right-color:var(--ti-menu-item-color-disabled)}.ti3-menu-panel-list.ti3-menu-panel-list-disabled>.ti3-menu-list-right-icon{border-left-color:var(--ti-menu-item-color-disabled)}.ti3-menu-panel-list-hover{background:var(--ti-menu-item-bg-hover);color:var(--ti-menu-panel-item-color-hover)}.ti3-menu-panel-list-hover>.ti3-menu-list-left-icon{border-right-color:var(--ti-menu-panel-item-color-hover)}.ti3-menu-panel-list-hover>.ti3-menu-list-right-icon{border-left-color:var(--ti-menu-panel-item-color-hover)}.ti3-menu-list-left-icon{border-right:5px solid #333;left:5px;top:11px}.ti3-menu-list-left-icon,.ti3-menu-list-right-icon{border-bottom:4px solid transparent;border-top:4px solid transparent;content:\"\";display:inline-block;height:0;margin-left:3px;position:absolute;vertical-align:middle;width:0}.ti3-menu-list-right-icon{border-left:5px solid #333;right:5px;top:43%}.ti3-menu-panel-list-tooltip{display:inline-block;height:100%;left:0;position:absolute;top:0;width:100%}"]
            },] }
];
TiMenuListComponent.propDecorators = {
    panelAlign: [{ type: Input }]
};

/**
 * Menu菜单组件
 *
 * 提供了一种方便的生成菜单下拉列表的方式，提供分组、自定义内容等功能。
 *
 * <example-url>../tiny3demo/#/menu/menu-all</example-url>
 */
class TiMenuComponent extends TiFormComponent {
    constructor() {
        super(...arguments);
        /**
         * 下拉菜单面板与按钮对齐方式。
         */
        this.panelAlign = 'right';
        /**
         * 下拉面板最大宽度，超过时换行，对所有子菜单都生效。
         */
        this.panelMaxWidth = '9999px';
        /**
         * 下拉面板最大高度，超过时出现竖向滚动条，对所有子菜单都生效。
         */
        this.panelMaxHeight = '9999px';
        /**
         * 要显示文字的键值
         */
        this.labelKey = 'label'; // labelKey
        /**
         * 选中菜单项事件
         */
        this.select = new EventEmitter();
        /**
         * 打开面板之前，通知事件。完全交给业务用户处理。
         */
        this.beforeOpen = new EventEmitter();
        /**
         * @ignore
         * itemsArr[0]存放根面板内容，itemArr[1]存放次级面板内容，itemArr[2]存放次次级面板内容
         */
        this.itemsArr = [];
        /**
         * @ignore
         *  与开关距离
         */
        this.dominatorSpace = '10px';
    }
    ngOnInit() {
        // 基类中做了设置宿主id的操作
        super.ngOnInit();
        this.hasBorder = this.nativeElement.hasAttribute('hasborder');
    }
    ngOnChanges(changes) {
        this.setFocusableElems([this.mytoggleRef.nativeElement]);
        super.ngOnChanges(changes);
        if (changes['items']) { // 外部修改show属性的处理，初始定义在ngOnInit中处理
            this.itemsArr[0] = this.items;
        }
    }
    /**
     * 兼容旧版：
     * 10.0.3 版本之前只能内嵌一个模板，无命名。
     * 新版可以内嵌两个模板，示例书写要求都命名（#item，#tip）。
     * 但需要兼容旧版无命名测试用例。
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果 item 模板为空 && 存在第一个模板，那么把第一个出现的 “非#tip 标签” 的模板作为 item 模板
        if (!this.itemTemplate && this.firstTemplate
            && (this.firstTemplate.elementRef.nativeElement !== (this.tipTemplate && this.tipTemplate.elementRef.nativeElement))) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    /**
     * 打开面板
     */
    open() {
        if (this.disabled) {
            return;
        }
        // 打开面板前重置menulist最大高度
        this.initListMaxHeight();
        this.dropComs.first.show();
        this.listComs.first.hoverOption = null;
        // 根据drop的最大高度设置menulist最大高度
        this.restyleListMaxHeight();
        // IE滚动条Bug的监听
        this.listComs.toArray().forEach(listCom => {
            listCom.listenIESrollbarBug();
        });
    }
    /**
     * 关闭面板
     */
    close() {
        this.dropComs.first.hide();
        this.onHover(null, 0);
        // 解除IE滚动条Bug的监听
        this.listComs.toArray().forEach(listCom => {
            listCom.unlistenIESrollbarBug();
        });
    }
    /**
     * 切换面板状态：打开/关闭
     */
    toggle() {
        this.dropComs.first.isShow ? this.close() : this.open();
    }
    /**
     * @ignore
     */
    onKeydown(event) {
        switch (event.keyCode) {
            case TiKeymap.KEY_SPACE: // 原生SPACE键仅可打开。但Tiny2,3都跟Enter键保持一致
            case TiKeymap.KEY_ENTER: // ENTER键 相当于click
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(苹果数字小键盘)
                // 第一级已打开，但无选中项。或者第一级没有打开。相当于鼠标点击逻辑。
                if ((this.dropComs.first.isShow && !this.listComs.toArray()[0].hoverOption)
                    || !this.dropComs.first.isShow) {
                    this.onMousedown(null); // 相当于鼠标点击
                    break; // 注意:break在if内，如果if不满足，则走到default，list处理按键
                }
            // 上面的回车键, 可能继续走到下面分支。
            // tslint:disable-next-line:no-switch-case-fall-through
            // eslint-disable-next-line no-fallthrough
            case TiKeymap.KEY_ARROW_LEFT: // 左右箭头，焦点在左右面板转移
            case TiKeymap.KEY_ARROW_RIGHT: // 左右箭头，焦点在左右面板转移
            case TiKeymap.KEY_ARROW_UP: // 上下箭头，上下移动选中项
            case TiKeymap.KEY_ARROW_DOWN: // 上下箭头，上下移动选中项
                for (let i = this.dropComs.length - 1; i >= 0; i--) { // 寻找末尾面板且有hover，list处理按键
                    if (this.dropComs.toArray()[i].isShow && this.listComs.toArray()[i].hoverOption) {
                        this.onKeydownLastHoverList(event, i);
                        // break; //这里触发了for循环的break；并没有走到switch的break;所以改为return;
                        return;
                    }
                }
                // 没有hover的面板，那么第一级面板（肯定是展开的）处理按键
                this.listComs.first.onKeydown(event);
                break;
            default:
                break;
        }
    }
    onKeydownLastHoverList(event, i) {
        switch (event.keyCode) {
            case TiKeymap.KEY_ARROW_LEFT: // 左右箭头，焦点在左右面板转移
            case TiKeymap.KEY_ARROW_RIGHT: // 左右箭头，焦点在左右面板转移
                if ((this.panelAlign === 'right' && event.keyCode === TiKeymap.KEY_ARROW_LEFT)
                    || (this.panelAlign === 'left' && event.keyCode === TiKeymap.KEY_ARROW_RIGHT)) { // 次级面板方向键
                    if (i + 1 < this.dropComs.length && this.dropComs.toArray()[i + 1].isShow) { // 次级存在且展开
                        this.listComs.toArray()[i + 1].nextOption(false); // 次级面板hover由null改为下一个
                    }
                }
                else { // 上级面板方向键
                    this.listComs.toArray()[i].hoverOption = null;
                }
                break;
            case TiKeymap.KEY_SPACE: // 原生SPACE键仅可打开。但Tiny2,3都跟Enter键保持一致
            case TiKeymap.KEY_ENTER: // ENTER键 相当于click
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(苹果数字小键盘)
                if (!this.listComs.toArray()[i].isGroup(this.listComs.toArray()[i].hoverOption)) {
                    this.listComs.toArray()[i].onKeydown(event);
                }
                break;
            default: // 上下键等，和上面的回车键也会走到这里。
                this.listComs.toArray()[i].onKeydown(event);
                break;
        }
    }
    /**
     * @ignore
     */
    onMousedown(event) {
        if (this.dropComs.first.isShow) { // 已打开，则关闭
            this.close();
        }
        else if (this.beforeOpen.observers.length === 0) { // 已打开，且无beforeOpen，则打开
            this.open();
        }
        else { // 已打开，有beforeOpen
            this.beforeOpen.emit(this);
        }
    }
    /**
     * @ignore
     */
    onSelect(panelIndex) {
        this.select.emit(this.listComs.toArray()[panelIndex].model);
        this.close();
    }
    /**
     * @ignore
     */
    onBlur() {
        this.close();
    }
    /**
     * @ignore
     */
    onHover(item, panelIndex) {
        if (panelIndex + 1 === this.dropComs.length) { // 当前hover面板，已经是最后一级面板
            return;
        }
        const dropComArr = this.dropComs.toArray();
        const listComArr = this.listComs.toArray();
        if (item && listComArr[panelIndex].isGroup(item) && !listComArr[panelIndex].isDisabledFn(item)) { // 根据数据，是否展开下一级
            this.itemsArr[panelIndex + 1] = item.children; // 下一级数据，赋新值。
            listComArr[panelIndex + 1].hoverOption = null; // 下一级面板赋空hoverOption，会触发onHover，进而关闭下一级面板的后续面板。
            // 赋新值以后，等模板有了新的尺寸，再弹出。
            setTimeout(() => {
                const currentPanel = dropComArr[panelIndex].nativeElement; // 当前面板元素
                const nextPanel = dropComArr[panelIndex + 1].nativeElement; // 下一级面板元素
                dropComArr[panelIndex + 1].show(); // 打开下一级面板
                // 位置调整，X方向 // TODO: 使用Position是否可行？
                const leftOffset = (this.panelAlign === 'left') ?
                    currentPanel.offsetLeft + currentPanel.offsetWidth :
                    currentPanel.offsetLeft - nextPanel.offsetWidth;
                nextPanel.style.left = `${leftOffset}px`;
                // 位置调整，Y方向
                const itemIndex = this.itemsArr[panelIndex].indexOf(item);
                const itemElem = listComArr[panelIndex].nativeElement.getElementsByTagName('LI')[itemIndex];
                // 当前li距离面板顶部的距离 = 当前li距离可视区顶部的距离 - 当前面板到可视区顶部的距离;
                const itemElmTop = itemElem.getBoundingClientRect().top - currentPanel.getBoundingClientRect().top;
                // 当前li距离页面底部的距离 = 可视区窗口高度 + 文档滚动高度 - 当前面板的offsetTop - 当前li距离面板顶部的距离;
                const bottomOffset = document.documentElement.clientHeight + document.documentElement.scrollTop -
                    currentPanel.offsetTop - itemElmTop;
                // 下一级面板的的高度
                const itemHeight = nextPanel.offsetHeight;
                // 底部空间能放下下一级面板：下一级面板的top = 当前面板的offsetTop + 当前li距离面板顶部的距离 - 面板的上下留白
                const nextPanelTop = currentPanel.offsetTop + itemElmTop - 4;
                if (bottomOffset > itemHeight) {
                    nextPanel.style.top = nextPanelTop + 'px';
                    return;
                }
                // 底部空间不足，和浏览器底部对齐
                nextPanel.style.top = nextPanelTop + bottomOffset - itemHeight + 'px';
            }, 0);
        }
        else {
            // 当hover到具体项目（非分组）或 null（移出当前面板），需要闭合所有后续面板
            for (let i = panelIndex + 1; i < dropComArr.length; i++) {
                dropComArr[i].hide();
            }
        }
    }
    /**
     * @ignore
     */
    onMouseoutDrop(event, panelIndex) {
        // 默认需要隐藏, 除非鼠标进入面板区域。
        for (let i = 0; i < this.dropComs.length; i++) {
            const dropRect = this.dropComs.toArray()[i].nativeElement
                .getBoundingClientRect();
            // 因为慢慢移出本面板时，移出鼠标事件依然停留在本面板内（1px误差），所以面板rect四周范围要更小1px。
            if (dropRect.left < event.clientX && event.clientX < dropRect.right
                && dropRect.top < event.clientY && event.clientY < dropRect.bottom) {
                return;
            }
        }
        // 给第一级面板置无选中，那么次级面板自然会关闭。
        this.listComs.first.hoverOption = null; // 会触发到上面this.onHover(null, 0);
    }
    // 初始化menulist最大高度
    initListMaxHeight() {
        this.menulistMaxHeight = parseInt(this.panelMaxHeight, 10);
        this.listComs.toArray().forEach(listCom => {
            this.renderer.setStyle(listCom.nativeElement, 'max-height', this.menulistMaxHeight + 'px');
        });
    }
    // 考虑drop的压缩情况，设置menulist的max-height
    restyleListMaxHeight() {
        const dropCurMaxHeight = parseInt(this.dropComs.first.nativeElement.style.maxHeight, 10);
        if (!isNaN(dropCurMaxHeight) && dropCurMaxHeight < this.menulistMaxHeight) {
            this.listComs.toArray().forEach(listCom => {
                this.renderer.setStyle(listCom.nativeElement, 'max-height', dropCurMaxHeight + 'px');
            });
        }
    }
}
TiMenuComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-menu',
                template: "<a #mytoggle class=\"ti3-menu-toggle ti3-menu-toggle-menu \"\r\n        (mousedown)=\"onMousedown($event)\"\r\n        (keydown)=\"onKeydown($event)\"\r\n        oncontextmenu=\"return false\"\r\n        href=\"javascript:void(0)\"\r\n        [id]=\"appendId('toggle')\">\r\n        <ng-content></ng-content>\r\n</a>\r\n<ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[0], panelIndex: 0}\">\r\n</ng-container>\r\n<ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[1],panelIndex: 1}\">\r\n</ng-container>\r\n<ng-container *ngTemplateOutlet=\"pannelTemplate; context: {$implicit: itemsArr[2], panelIndex: 2}\">\r\n</ng-container>\r\n<ng-template #pannelTemplate let-options let-panelIndex=panelIndex>\r\n        <ti-drop #drop\r\n        [ngClass]=\"{'ti3-menu-border-drop': hasBorder}\"\r\n        class=\"ti3-menu-panel-container\"\r\n        [dominatorElem]=\"mytoggleRef.nativeElement\"\r\n        [panelAlign]=\"panelAlign\"\r\n        panelWidth='auto'\r\n        height='auto'\r\n        [id]=\"appendId('drop'+panelIndex)\"\r\n        (mouseout)=\"onMouseoutDrop($event, panelIndex)\">\r\n                <ti-menulist #menulist\r\n                        [options]=\"options\"\r\n                        [labelKey]=\"labelKey\"\r\n                        [panelAlign]=\"panelAlign\"\r\n                        style=\"display:block;\"\r\n                        (select)=\"onSelect(panelIndex)\"\r\n                        size =\"small\"\r\n                        [ngStyle]=\"{'max-width': panelMaxWidth}\"\r\n                         (hover)=\"onHover($event, panelIndex)\"\r\n                         [id]=\"appendId('menulist'+panelIndex)\">\r\n                        <ng-template let-item let-i=index>\r\n                                <section [tiTip]='tipTemplate ? tipTemplate : item.tip' [tiTipContext]='item' [tiTipPosition]='item.tipPosition'>\r\n                                        <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                                                <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                                                </ng-container>\r\n                                        </ng-container>\r\n                                        <ng-template #listLabelTemplate>{{item[labelKey]}}</ng-template>\r\n                                </section>\r\n                        </ng-template>\r\n                </ti-menulist>\r\n        </ti-drop>\r\n<ng-template>\r\n",
                host: {
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host[hasborder]{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host[hasborder]:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host[hasborder]:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host[hasborder]:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[hasborder][disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}:host{display:inline-block}.ti3-menu-toggle,a.ti3-menu-toggle:focus{color:var(--ti-menu-item-color)}.ti3-menu-toggle-menu{-ms-user-select:none;-webkit-user-select:none;cursor:pointer;display:inline-block;text-decoration:none;user-select:none}.ti3-menu-toggle-menu:hover{color:var(--ti-menu-item-color-hover)}.ti3-menu-toggle-menu:hover:after{border-top-color:var(--ti-menu-item-color-hover)}.ti3-menu-toggle-menu:active{color:var(--ti-menu-item-color-active)}.ti3-menu-toggle-menu:active:after{border-top-color:var(--ti-menu-item-color-active)}.ti3-menu-toggle-menu:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--ti-menu-item-color);content:\"\";display:inline-block;height:0;margin-left:5px;vertical-align:middle;width:0}.ti3-menu-toggle-button{-ms-user-select:none;-webkit-user-select:none;cursor:pointer;display:inline-block;user-select:none}.ti3-menu-toggle-button:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid;content:\"\";display:inline-block;height:0;margin-left:3px;vertical-align:middle;width:0}.ti3-menu-panel-container{-ms-box-sizing:border-box;background-color:#fff;border-radius:2px;box-shadow:0 2px 8px 1px rgba(0,0,0,.2);box-sizing:border-box;display:none;list-style:none;position:absolute;z-index:1060}.ti3-menu-panel-container.ti3-button-menu-panel-container{border:1px solid var(--ti-menu-button-panel-border-color);box-shadow:none}.ti3-menu-panel-container.ti3-button-menu-panel-container .ti3-menu-panel-list:hover{color:var(--ti-menu-button-panel-border-color)}.ti3-menu-panel-container.ti3-button-menu-panel-container .ti3-menu-panel-list.ti3-menu-panel-list-active{background-color:var(--ti-menu-button-panel-border-color);color:var(--ti-menu-panel-item-color-active)}.ti3-menu-panel-container.ti3-region-menu-panel-container-down{border-top:1px solid #ccc}.ti3-menu-panel-container.ti3-region-menu-panel-container-up{border-bottom:1px solid #ccc}:host[hasborder] .ti3-menu-toggle-menu{border:1px solid transparent;color:var(--ti-input-text-color);height:var(--ti-input-height);line-height:var(--ti-input-height);margin:-1px;padding-left:var(--ti-common-space-5x);padding-right:var(--ti-common-space-4x)}:host[hasborder] .ti3-menu-toggle-menu:focus,:host[hasborder] .ti3-menu-toggle-menu:hover{color:var(--ti-default-font-color)}:host[hasborder] .ti3-menu-toggle-menu:after,:host[hasborder] .ti3-menu-toggle-menu:hover:after{border-top-color:var(--ti-dominator-select-arrow-color)}:host[hasborder]:hover:not([disabled]){border-color:var(--ti-common-color-line-active)}:host[disabled] .ti3-menu-toggle-menu{color:var(--ti-input-text-color-disabled)!important;cursor:not-allowed}:host[disabled] .ti3-menu-toggle-menu:after{border-top-color:var(--ti-input-text-color-disabled)!important}.ti3-menu-border-drop ti-menulist{max-height:inherit;overflow-y:auto}.ti3-menu-border-drop ti-menulist .ti3-menu-panel-list{padding-left:var(--ti-common-space-10);padding-right:var(--ti-common-space-10)}"]
            },] }
];
TiMenuComponent.propDecorators = {
    panelAlign: [{ type: Input }],
    items: [{ type: Input }],
    panelMaxWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    labelKey: [{ type: Input }],
    mytoggleRef: [{ type: ViewChild, args: ['mytoggle', { static: true },] }],
    dropComs: [{ type: ViewChildren, args: [TiDropComponent,] }],
    listComs: [{ type: ViewChildren, args: [TiMenuListComponent,] }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    tipTemplate: [{ type: ContentChild, args: ['tip', /* TODO: add static flag */ { static: false },] }],
    select: [{ type: Output }],
    beforeOpen: [{ type: Output }]
};

class TiMenuModule {
}
TiMenuModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiDropModule,
                    TiTipModule
                ],
                exports: [TiMenuComponent, TiMenuListComponent],
                declarations: [TiMenuComponent, TiMenuListComponent]
            },] }
];

// 空间设置规则：
// 可显示项目数（children项目必须出现在“更多”），最大显示数目，空间宽度。
// 更多”里面至少两个选项
// 如果只有一个带children项目那么直接用menu。
/**
 * ActionMenu菜单按钮组件
 *
 * ActionMenu组件主要是一组操作按钮。当按钮数量太多导致预留空间大小无法显示所有按钮时，自动将超出部分的按钮放置在一个menu组件下拉中。
 *
 * 使用该组件，用户只需关注操作项配置，无需关注操作项显示不足的情况。
 *
 * 注意：ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked.（本组件在调试环境报此错误，不必理会。生产环境不报错，功能也不受影响。）
 *
 * <example-url>../tiny3demo/#/actionmenu/actionmenu-all</example-url>
 */
class TiActionmenuComponent extends TiFormComponent {
    constructor(hostRef, renderer, iterableDiffers, keyValueDiffers) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.iterableDiffers = iterableDiffers;
        this.keyValueDiffers = keyValueDiffers;
        /**
         * 下拉面板最大宽度，超过时换行，对所有子菜单都生效。
         */
        this.panelMaxWidth = '130px';
        /**
         * 下拉面板最大高度度，超过时出现竖向滚动条，对所有子菜单都生效。
         */
        this.panelMaxHeight = '9999px';
        /**
         * 数据中要显示字符串的key
         */
        this.labelKey = 'label';
        /**
         * 用户点击选中菜单项事件
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        /* Menu参数透传end */
        /**
         * 外部容器宽度
         */
        this.maxWidth = '250px';
        /**
         * 各item的间距
         */
        this.space = '10px';
        // 分割线为divider，分割字符叫做separator（比如分割ip里的点）
        /**
         * 各item之间是否展示分割线
         *
         * 3.1.3新增
         */
        this.showDivider = true;
        /**
         * 最大显示个数, 包含下拉菜单
         */
        this.maxShowNum = 4;
        /**
         * @ignore
         * 下拉菜单绑定的选项数据
         */
        this.panelItems = [];
        /**
         * @ignore
         * 各item之间间隔的一半距离
         */
        this.halfSpace = '';
        this.needInitItems = false;
        const localeWords = TiLocale.getLocaleWords();
        this.moreText = localeWords.tiActionmenu.more;
        this.menuText = localeWords.tiActionmenu.operation;
    }
    // 纠正 IE下同一行两个元素 offsetTop 值可能存在的一些(目前测试到有1px)的误差
    static isEqualOffsetTop(elem1, elem2) {
        return Math.abs(elem1.offsetTop - elem2.offsetTop) <= 2;
    }
    /**
     * @ignore
     *  选中菜单内选项
     * @param item 菜单项数据
     */
    onSelect(item) {
        if (!item.disabled) {
            this.select.emit(item);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        this.panelItems = this.items;
        this.halfSpace = Number.parseInt(this.space, 10) / 2 + 'px';
    }
    ngDoCheck() {
        if (this.data) {
            if (!this.dataDiffer) { // 首次docheck是ngOnInit()之后
                this.dataDiffer = this.keyValueDiffers.find(this.data)
                    .create();
            }
            const dataChanges = this.dataDiffer.diff(this.data);
            if (dataChanges) { // 根据data初始化items. 注意：第一次diff会走入changes
                this.items = this.dataToItemsFn(this.data);
            }
        }
        if (this.items) {
            if (!this.itemsDiffer) {
                this.itemsDiffer = this.iterableDiffers.find(this.items)
                    .create();
                this.needInitItems = true;
            }
            const itemsChanges = this.itemsDiffer.diff(this.items);
            // 注意：如果有数据，那么第一次diff会就走入changes。如果是空数据，第一次diff结果是null，不会进入changes。
            if (itemsChanges) { // 如果items改变，则重新初始化。
                this.needInitItems = true;
            }
        }
    }
    /**
     * 兼容旧版：
     * 10.0.3 版本之前只能内嵌一个模板，无命名。
     * 新版可以内嵌两个模板，示例书写要求都命名（#item，#tip）。
     * 但需要兼容旧版无命名测试用例。
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果 item 模板为空 && 存在第一个模板，那么把第一个出现的 “非 #tip 标签” 的模板作为 item 模板
        if (!this.itemTemplate && this.firstTemplate
            && (this.firstTemplate.elementRef.nativeElement !== (this.tipTemplate && this.tipTemplate.elementRef.nativeElement))) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    ngAfterViewChecked() {
        if (this.needInitItems) {
            this.initItems();
        }
        super.ngAfterViewChecked(); // 内部执行了autofocus
    }
    /**
     * 计算那些item应该显示在外部，移除不该显示的item，调整pannel上显示的item项，调整menu显示的文字。
     */
    initItems() {
        this.needInitItems = false;
        const itemElems = this.hostRef.nativeElement.getElementsByClassName('ti3-action-menu-item');
        const dividingElems = this.hostRef.nativeElement.getElementsByClassName('ti3-action-menu-divider');
        const menuElem = this.menuCom.nativeElement;
        const moreTextElem = this.hostRef.nativeElement.getElementsByClassName('tiMoreText')[0];
        const menuTextElem = this.hostRef.nativeElement.getElementsByClassName('tiMenuText')[0];
        // 情况一：items为空
        if (!this.items || this.items.length === 0) {
            this.setDisplay(menuElem, false);
            return;
        }
        else {
            this.setDisplay(menuElem, true);
        }
        // 注意: itemElems不是数组，并且数据更新时，取到的length不对。所以，得使用items的length
        let firstChildrenIndex = -1; // 第一个含有子项目的索引
        // 这个for循环，做了两件事：找含有子项目，重置item可见。
        for (let i = 0; i < this.items.length; i++) {
            if (this.items[i].hasOwnProperty('children')) {
                firstChildrenIndex = i; // 找到第一个含有子项目的索引
                // break;
            }
            this.setDisplay(itemElems[i], true); // 因为动态修改item，所以第二次进入时需要重置item可见。
        }
        // 情况二：不显示menu  //条件：没有超过最大显示个数，且最后一个项目也在第一行, 且没有子项
        if (this.items.length <= this.maxShowNum
            && TiActionmenuComponent.isEqualOffsetTop(itemElems[this.items.length - 1], itemElems[0])
            && firstChildrenIndex === -1) {
            for (let i = 0; i < this.items.length; i++) {
                this.setAttr(itemElems[i], 'disabled', this.items[i].disabled);
            }
            this.setDisplay(menuElem, false);
            // 设置可聚焦元素
            const focusItems = [];
            for (let i = 0; i < this.items.length; i++) {
                focusItems.push(itemElems[i]);
            }
            this.setFocusableElems(focusItems);
            return;
        }
        // 情况三：显示Menu，显示数目条件：有子项目的一定在菜单内/倒数第二个一定在菜单内/最大显示个数（含menu）。3值取最小。
        if (firstChildrenIndex === -1) {
            firstChildrenIndex = this.items.length; // firstChild给一个超越数组大小的索引，方便下面计算
        }
        let outShowNum = (this.items.length - 2) < (this.maxShowNum - 1) ? (this.items.length - 2) :
            (this.maxShowNum - 1) < (firstChildrenIndex + 1) ? (this.maxShowNum - 1) : (firstChildrenIndex + 1);
        for (let i = this.items.length - 1; i >= 0; i--) {
            if (i > outShowNum - 1) { // 本项属于超出的数目，先删除掉
                //  TODO: remove和style哪个效率高？
                this.setDisplay(itemElems[i], false);
                if (dividingElems[i]) {
                    this.setDisplay(dividingElems[i], false);
                }
            }
            else if (!TiActionmenuComponent.isEqualOffsetTop(menuElem, itemElems[0])) { // 菜单没有在第一行，删除本项
                this.setDisplay(itemElems[i], false);
                if (dividingElems[i]) {
                    this.setDisplay(dividingElems[i], false);
                }
                outShowNum--;
            }
            else {
                this.setAttr(itemElems[i], 'disabled', this.items[i].disabled);
            }
        }
        // 设置菜单显示文字，设置可聚焦元素
        if (outShowNum === 0) { // 立即生效，否则根据模板变量生效慢
            this.renderer.setStyle(menuElem, 'margin-left', '0px');
            this.setDisplay(moreTextElem, false);
            this.setDisplay(menuTextElem, true);
            // 设置可聚焦元素
            this.setFocusableElems(this.menuCom.getFocusableElems());
        }
        else {
            this.setDisplay(moreTextElem, true);
            this.setDisplay(menuTextElem, false);
            // 设置可聚焦元素
            const focusItems = [];
            for (let i = 0; i < outShowNum; i++) {
                focusItems.push(itemElems[i]);
            }
            this.setFocusableElems(focusItems.concat(this.menuCom.getFocusableElems()));
        }
        /**
         * 此句改变了模板变量，需要强制刷新
         * 这里引起ng-serve环境报错ExpressionChangedAfterItHasBeenCheckedError, 所以用Promise延时
         */
        Promise.resolve().then(() => {
            this.panelItems = this.items.slice(outShowNum, this.items.length);
        });
    }
    /**
     * 设置显示/隐藏样式，比ngIf更及时生效。
     * @param elem HTML元素
     * @param isShow 是否显示
     */
    setDisplay(elem, isShow) {
        this.renderer.setStyle(elem, 'display', isShow ? 'inline-block' : 'none');
    }
    /**
     * @ignore
     * ngFor遍历的 trackBy函数，防止数据更新导致所有DOM重新渲染。TODO：这里是否该使用trackBy?
     * @param index 索引
     * @param item 数据
     * @returns 索引
     */
    trackByFn(index, item) {
        return index;
    }
}
TiActionmenuComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-actionmenu',
                template: "<ng-container *ngFor=\"let item of items; let i = index; let first = first; let last = last; trackBy: trackByFn\">\r\n    <a href=\"javascript:void(0)\"\r\n        oncontextmenu=\"return false\"\r\n        class=\"ti3-action-menu-item\"\r\n        [ngStyle]=\"{ 'margin-left': first ? 'none' : halfSpace, 'margin-right': last ? 'none' : halfSpace}\"\r\n        (click)=\"onSelect(item)\"\r\n        [tiPopconfirm]=\"item.popConfig&&!item.disabled ? item.popConfig : {}\"\r\n        [id]=\"appendId('item'+i)\">\r\n        <section [tiTip]='tipTemplate ? tipTemplate : item.tip' [tiTipContext]='item' [tiTipPosition]='item.tipPosition'\r\n                 >\r\n                <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #labelTemplate>{{item[labelKey]}}</ng-template>\r\n        </section>\r\n    </a>\r\n    <span class=\"ti3-action-menu-divider\" *ngIf=\"showDivider && !last\"></span>\r\n</ng-container>\r\n<ti-menu\r\npanelAlign=\"right\"\r\n[panelMaxWidth]=\"panelMaxWidth\"\r\n[panelMaxHeight]=\"panelMaxHeight\"\r\n[labelKey]=\"labelKey\"\r\n[items]=\"panelItems\"\r\n(select)=\"onSelect($event)\"\r\n[ngStyle]=\"{'margin-left': halfSpace}\"\r\nstyle=\"display: none\"\r\n[id]=\"appendId('menu')\">\r\n<section class=\"tiMoreText\" style=\"display:inline-block\">{{moreText}}</section>\r\n<section class=\"tiMenuText\" style=\"display:none\">{{menuText}}</section>\r\n<ng-template #item let-item let-i=index>\r\n        <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                </ng-container>\r\n        </ng-container>\r\n        <ng-template #labelTemplate>{{item[labelKey]}}</ng-template>\r\n</ng-template>\r\n<ng-template #tip let-item=\"context\" *ngIf=\"tipTemplate\">\r\n        <ng-container *ngTemplateOutlet=\"tipTemplate; context: {context: item}\">\r\n        </ng-container>\r\n</ng-template>\r\n</ti-menu>\r\n\r\n",
                host: {
                    '[style.max-width]': 'maxWidth'
                },
                styles: [":host{display:inline-block}.ti3-action-menu-item{-ms-user-select:none;-webkit-user-select:none;color:var(--ti-actionmenu-item-text-color);cursor:pointer;display:inline-block;text-decoration:none;user-select:none}.ti3-action-menu-item:hover{color:var(--ti-actionmenu-item-text-color-hover);text-decoration:none}.ti3-action-menu-item[disabled]{cursor:not-allowed;outline:none!important;text-decoration:none}.ti3-action-menu-item[disabled] *{color:var(--ti-actionmenu-item-text-color-disabled)!important}a.ti3-action-menu-item:active,a.ti3-action-menu-item:focus{color:var(--ti-actionmenu-item-text-color-active)}.ti3-action-menu-divider{background:var(--ti-actionmenu-divider-color);display:inline-block;height:12px;position:relative;top:2px;width:1px}"]
            },] }
];
TiActionmenuComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: IterableDiffers },
    { type: KeyValueDiffers }
];
TiActionmenuComponent.propDecorators = {
    items: [{ type: Input }],
    panelMaxWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    labelKey: [{ type: Input }],
    select: [{ type: Output }],
    maxWidth: [{ type: Input }],
    space: [{ type: Input }],
    showDivider: [{ type: Input }],
    maxShowNum: [{ type: Input }],
    moreText: [{ type: Input }],
    menuText: [{ type: Input }],
    data: [{ type: Input }],
    dataToItemsFn: [{ type: Input }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    tipTemplate: [{ type: ContentChild, args: ['tip', /* TODO: add static flag */ { static: true },] }],
    menuCom: [{ type: ViewChild, args: [TiMenuComponent, { static: true },] }]
};

class TiPopconfirmComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        this.tiPopconfirm = TiLocale.getLocaleWords().tiPopconfirm;
    }
    ngOnInit() {
        this.config.yesText = this.config.yesText || this.tiPopconfirm.yesLabel;
        this.config.noText = this.config.noText || this.tiPopconfirm.noLabel;
    }
    ngAfterViewInit() {
        // 轻量级弹窗阴影定制
        this.renderer.addClass(this.nativeElement.offsetParent, 'ti3-popconfirm-tip'); // 在init中设置会影响button样式 TODO: IE下还存在背景闪烁问题
    }
}
TiPopconfirmComponent.decorators = [
    { type: Component, args: [{
                template: "<div class=\"ti3-popconfirm-header\" >\r\n    <ti-icon class=\"ti3-popconfirm-warn-icon\" name=\"warn\"></ti-icon>\r\n    <span *ngIf='config.content' class=\"ti3-popconfirm-title\" [innerHtml]='config.content'></span>\r\n</div>\r\n<div class=\"ti3-popconfirm-footer\">\r\n    <button [id]=\"appendId('yesbutton')\"\r\n            type=\"button\"\r\n            tiButton\r\n            color=\"{{config.yesPrimary ? 'danger' : ''}}\"\r\n            (click)=\"destroyPopover(true)\">{{ config.yesText }}</button><!--\r\n    --><button [id]=\"appendId('nobutton')\"\r\n               type=\"button\"\r\n               tiButton\r\n               color=\"{{!config.yesPrimary ? 'danger' : ''}}\"\r\n               (click)=\"destroyPopover(false)\">{{ config.noText }}</button>\r\n</div>",
                host: {
                    '[class.ti3-popconfirm-container]': 'true',
                    '[tabindex]': '0'
                },
                styles: [".ti3-popconfirm-tip{box-shadow:var(--ti-common-shadow-4-down)!important}:host.ti3-popconfirm-container{display:inline-block;outline:none}.ti3-popconfirm-header{align-content:center;display:flex}.ti3-popconfirm-warn-icon{color:var(--ti-common-color-warn);font-size:var(--ti-common-font-size-2);line-height:18px}.ti3-popconfirm-title{color:var(--ti-common-color-text-primary);font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-left:var(--ti-common-space-2x)}.ti3-popconfirm-footer{margin-top:12px;text-align:right}.ti3-popconfirm-footer button:nth-of-type(2){margin-left:var(--ti-common-space-2x)}"]
            },] }
];
TiPopconfirmComponent.propDecorators = {
    config: [{ type: Input }],
    destroyPopover: [{ type: Input }]
};

/**
 * Button按钮组件
 *
 * 尽管这是一个组件，但使用方法有点像属性指令。
 *
 * 按钮组件基于原生button组件进行扩展，原生button加tiButton属性即为tiny button，button的多种样式则通过为button设置不同的样式类来进行区分，具体用法见示例。
 *
 * <example-url>../tiny3demo/#/button/button-all</example-url>
 */
class TiButtonComponent extends TiAutofocusComponent {
    constructor(renderer, hostEle, zone) {
        super(hostEle, renderer);
        this.renderer = renderer;
        this.hostEle = hostEle;
        this.zone = zone;
        /**
         * 按钮颜色：默认按钮/强调色按钮/主题色按钮
         */
        this.color = 'default';
        /**
         * 是否含有icon
         */
        this.icon = false;
        /**
         * 是否为纯图标按钮
         */
        this.onlyIcon = false;
        /**
         * 样式大小：XS/S/M/L四个尺寸按钮 默认M尺寸
         */
        this.size = 'middle';
        /**
         * 10.1.4新增
         *
         * 是否处于加载状态，主要用于弹窗的异步任务提交场景
         */
        this.loading = false;
    }
    ngAfterViewInit() {
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(this.hostEle.nativeElement, 'mousedown', () => {
                this.renderer.setStyle(this.hostEle.nativeElement, 'outline', 'none');
            });
            this.renderer.listen(this.hostEle.nativeElement, 'blur', () => {
                this.renderer.setStyle(this.hostEle.nativeElement, 'outline', '');
            });
        });
    }
}
TiButtonComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiButton]',
                template: "<ti-loading *ngIf=\"loading\"></ti-loading>\r\n<ng-content></ng-content>\r\n",
                host: {
                    '[class.ti3-btn-primary]': 'color === "primary"',
                    '[class.ti3-btn-danger]': 'color === "danger"',
                    '[class.ti3-btn-icon]': 'icon',
                    '[class.ti3-btn-onlyIcon]': 'onlyIcon',
                    '[class.ti3-btn-large]': 'size === "large"',
                    '[class.ti3-btn-middle]': 'size === "middle"',
                    '[class.ti3-btn-small]': 'size === "small"',
                    '[class.ti3-btn-xs]': 'size === "xs"',
                    '[class.ti3-btn-loading]': 'loading'
                },
                encapsulation: ViewEncapsulation.None // 让宿主元素也用上button.less样式。否则，默认胶囊封装避免CSS污染。
                ,
                styles: [".ti3-btn,[tiButton]{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;border:1px solid transparent;border-radius:var(--ti-button-border-radius);box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-button-middle-height);line-height:calc(var(--ti-button-middle-height) - 2px);padding:0 var(--ti-button-middle-padding-horizon);text-align:center;transition:background-color .15s var(--ti-timing-function-default),border-color .15s var(--ti-timing-function-default),box-shadow .15s var(--ti-timing-function-default),color .15s var(--ti-timing-function-default);user-select:none;vertical-align:middle;white-space:nowrap}.ti3-btn[disabled],[tiButton][disabled]{cursor:not-allowed}.ti3-btn-icon{padding:0 var(--ti-button-icon-padding-horizon)}.ti3-btn-large{height:var(--ti-button-large-height);line-height:calc(var(--ti-button-large-height) - 2px);padding:0 var(--ti-button-large-padding-horizon)!important}.ti3-btn-large,.ti3-btn-middle{border-radius:var(--ti-button-border-radius);font-size:var(--ti-common-font-size-base)}.ti3-btn-middle{height:var(--ti-button-middle-height);line-height:calc(var(--ti-button-middle-height) - 2px);padding:0 var(--ti-button-middle-padding-horizon)!important}.ti3-btn-small{height:var(--ti-button-small-height);line-height:calc(var(--ti-button-small-height) - 2px);padding:0 var(--ti-button-small-padding-horizon)!important}.ti3-btn-small,.ti3-btn-xs{border-radius:var(--ti-button-border-radius);font-size:var(--ti-common-font-size-base)}.ti3-btn-xs{height:var(--ti-button-xs-height);line-height:calc(var(--ti-button-xs-height) - 2px);padding:0 var(--ti-button-xs-padding-horizon)!important}.ti3-btn-onlyIcon{font-size:var(--ti-button-onlyIcon-fontSize);height:var(--ti-button-onlyIcon-height);line-height:1;padding:var(--ti-button-onlyIcon-padding)!important;width:var(--ti-button-onlyIcon-width)}.ti3-btn-default,[tiButton]{background:var(--ti-button-default-normal-bg-color);border-color:var(--ti-button-default-normal-border-color);color:var(--ti-button-default-normal-color)}.ti3-btn-default:not([disabled]):focus,.ti3-btn-default:not([disabled]):hover,[tiButton]:not([disabled]):focus,[tiButton]:not([disabled]):hover{background:var(--ti-button-default-bg-color-hover);border-color:var(--ti-button-default-border-color-hover);box-shadow:var(--ti-button-default-box-shadow);color:var(--ti-button-default-color-hover)}.ti3-btn-default:not([disabled]):active,[tiButton]:not([disabled]):active{background:var(--ti-button-default-bg-color-active);border-color:var(--ti-button-default-border-color-active);box-shadow:none;color:var(--ti-button-default-color-active)}.ti3-btn-default[disabled],[tiButton][disabled]{background:var(--ti-button-default-bg-color-disabled);border-color:var(--ti-button-default-border-color-disabled);color:var(--ti-button-default-color-disabled)}.ti3-btn-primary{background:var(--ti-button-primary-normal-bg-color);border-color:var(--ti-button-primary-normal-border-color);color:var(--ti-button-primary-normal-color)}.ti3-btn-primary:not([disabled]):focus,.ti3-btn-primary:not([disabled]):hover{background:var(--ti-button-primary-bg-color-hover);border-color:var(--ti-button-primary-border-color-hover);box-shadow:var(--ti-button-default-box-shadow);color:var(--ti-button-primary-color-hover)}.ti3-btn-primary:not([disabled]):active{background:var(--ti-button-primary-bg-color-active);border-color:var(--ti-button-primary-border-color-active);box-shadow:none;color:var(--ti-button-primary-color-active)}.ti3-btn-primary[disabled]{background:var(--ti-button-primary-bg-color-disabled);border-color:var(--ti-button-primary-border-color-disabled);color:var(--ti-button-primary-color-disabled)}.ti3-btn-danger{background:var(--ti-button-danger-normal-bg-color);border-color:var(--ti-button-danger-normal-border-color);color:var(--ti-button-danger-normal-color)}.ti3-btn-danger:not([disabled]):focus,.ti3-btn-danger:not([disabled]):hover{background:var(--ti-button-danger-bg-color-hover);border-color:var(--ti-button-danger-border-color-hover);box-shadow:var(--ti-button-danger-box-shadow);color:var(--ti-button-danger-color-hover)}.ti3-btn-danger:not([disabled]):active{background:var(--ti-button-danger-bg-color-active);border-color:var(--ti-button-danger-border-color-active);box-shadow:none;color:var(--ti-button-danger-color-active)}.ti3-btn-danger[disabled]{background:var(--ti-button-danger-bg-color-disabled);border-color:var(--ti-button-danger-border-color-disabled);color:var(--ti-button-danger-color-disabled)}.ti3-btn-loading{pointer-events:none}.ti3-btn-loading ti-loading{margin-right:var(--ti-common-space-2x);vertical-align:middle}.ti3-btn-loading ti-loading .ti3-loading-default{border-color:var(--ti-common-color-icon-white);border-right-color:transparent}.ti3-btn-loading.ti3-btn-primary:not([disabled]){background:var(--ti-button-primary-bg-color-hover);border-color:var(--ti-button-primary-border-color-hover);color:var(--ti-button-primary-color-hover)}.ti3-btn-loading.ti3-btn-danger:not([disabled]){background:var(--ti-button-danger-bg-color-hover);border-color:var(--ti-button-danger-border-color-hover);color:var(--ti-button-danger-color-hover)}.ti3-btn-danger:not([disabled]):active,.ti3-btn-danger:not([disabled]):focus,.ti3-btn-danger:not([disabled]):hover,.ti3-btn-default:not([disabled]):active,.ti3-btn-default:not([disabled]):focus,.ti3-btn-default:not([disabled]):hover,[tiButton]:not([disabled]):active,[tiButton]:not([disabled]):focus,[tiButton]:not([disabled]):hover{transition:background-color .2s var(--ti-timing-function-default),border-color .2s var(--ti-timing-function-default),box-shadow .2s var(--ti-timing-function-default),color .2s var(--ti-timing-function-default)}"]
            },] }
];
TiButtonComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
TiButtonComponent.propDecorators = {
    color: [{ type: Input }],
    icon: [{ type: Input }],
    onlyIcon: [{ type: Input }],
    size: [{ type: Input }],
    loading: [{ type: Input }]
};

/**
 * Loading组件用于加载场景，提供了两种类型
 *
 * 10.0.3新增
 *
 * <example-url>../tiny3demo/#/loading/loading-all</example-url>
 */
class TiLoadingComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 弱类型有4个圈
         */
        this.items = [];
        this.type = 'default'; // 加载类型
        this.size = 'small'; // 加载尺寸
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        this.items.length = 4;
    }
    /**
     * @ignore
     * 根据用户传入尺寸获取border的宽度
     */
    getBorderWidth(size) {
        return parseInt(size, 10) * 0.3 / 2 + 'px';
    }
}
TiLoadingComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-loading',
                template: "<div *ngIf=\"type === 'default'\"\r\n    class=\"ti3-loading-default\"\r\n    [ngStyle]=\"{'width': size, 'height': size, 'border-width': getBorderWidth(size)}\"\r\n    [ngClass]=\"{'ti3-loading-default-small': size === 'small',\r\n                'ti3-loading-default-middle': size === 'middle',\r\n                'ti3-loading-default-large': size === 'large'}\"></div>\r\n\r\n<div  *ngIf=\"type === 'weak'\">\r\n    <span *ngFor=\"let item of items\" class=\"ti3-loading-weak\"></span>\r\n</div>",
                styles: ["::ng-deep :root{--ti-loading-default-large-size:32px;--ti-loading-default-middle-size:24px;--ti-loading-default-small-size:12px;--ti-loading-weak-size:5px}.ti3-loading-default{animation:default-animation .8s linear 0s infinite;border-color:var(--ti-common-color-line-active);border-radius:50%;border-right-color:transparent;border-style:solid;box-sizing:border-box;display:inline-block}.ti3-loading-default.ti3-loading-default-small{border-width:calc(var(--ti-loading-default-small-size)*0.3/2);height:var(--ti-loading-default-small-size);width:var(--ti-loading-default-small-size)}.ti3-loading-default.ti3-loading-default-middle{border-width:calc(var(--ti-loading-default-middle-size)*0.3/2);height:var(--ti-loading-default-middle-size);width:var(--ti-loading-default-middle-size)}.ti3-loading-default.ti3-loading-default-large{border-width:calc(var(--ti-loading-default-large-size)*0.3/2);height:var(--ti-loading-default-large-size);width:var(--ti-loading-default-large-size)}.ti3-loading-weak{animation:weak-animation 1.2s ease-in-out infinite;background-color:var(--ti-common-color-line-active);border-radius:50%;display:inline-block;height:var(--ti-loading-weak-size);margin-right:var(--ti-common-space-2x);opacity:.7;width:var(--ti-loading-weak-size)}.ti3-loading-weak:first-child{animation-delay:0s}.ti3-loading-weak:nth-child(2){animation-delay:.2s}.ti3-loading-weak:nth-child(3){animation-delay:.4s}.ti3-loading-weak:nth-child(4){animation-delay:.6s}@keyframes default-animation{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes weak-animation{0%{opacity:.2}25%{opacity:.5}50%{opacity:.7}to{opacity:.2}}"]
            },] }
];
TiLoadingComponent.propDecorators = {
    type: [{ type: Input }],
    size: [{ type: Input }]
};

class TiLoadingModule {
}
TiLoadingModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiLoadingComponent],
                declarations: [TiLoadingComponent]
            },] }
];

class TiButtonModule {
}
TiButtonModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule, TiLoadingModule],
                exports: [TiButtonComponent],
                declarations: [TiButtonComponent]
            },] }
];

/**
 * TiPopconfirm 气泡确认框指令
 *
 * 一般用于操作执行后对用户业务不会有严重影响的轻量级场景。
 *
 * 10.0.3/9.0.7版本新增
 *
 * <example-url>../tiny3demo/#/popconfirm/popconfirm-all</example-url>
 */
class TiPopconfirmDirective extends TiTipDirective {
    constructor(tiTipService, hostEleRef, zone, render, document) {
        super(tiTipService, hostEleRef);
        this.tiTipService = tiTipService;
        this.hostEleRef = hostEleRef;
        this.zone = zone;
        this.render = render;
        this.document = document;
        this.popoverComponentRef = null;
        // 可聚焦元素
        this.focusableElementsString = `a[href], area[href], input:not([disabled]):not([tabindex=\'-1\']),
     button:not([disabled]):not([tabindex=\'-1\']),select:not([disabled]):not([tabindex=\'-1\']),
     textarea:not([disabled]):not([tabindex=\'-1\']),
     iframe, object, embed, *[tabindex]:not([tabindex=\'-1\']), *[contenteditable=true]`;
        /**
         * tip组件配置
         */
        this.tipConfig = {
            trigger: 'manual',
            theme: 'white'
        };
    }
    ngOnInit() {
        if (!this.tiPopconfirm || !this.tiPopconfirm.content) {
            return;
        }
        this.hostElement = this.hostEleRef.nativeElement;
        // 创建实例
        this.tipInstance = this.tiTipService.create(this.hostElement, Object.assign(Object.assign({}, this.tipConfig), { position: this.tiPopconfirm.position, registerVisibilityChangeEvent: false }));
        this.addClickEvent();
    }
    ngOnDestroy() {
        if (this.tipInstance) {
            super.ngOnDestroy();
        }
        if (this.unlistenClick) {
            this.unlistenClick();
        }
        if (this.unListenDocumentKeydown) {
            this.unListenDocumentKeydown();
        }
    }
    addClickEvent() {
        this.zone.runOutsideAngular(() => {
            this.unlistenClick = this.render.listen(this.document, 'click', (event) => {
                if (this.hostElement.contains(event.target) && !this.popoverComponentRef) {
                    this.showPopandFocus();
                    return;
                }
                const tipElement = this.popoverComponentRef && this.popoverComponentRef.location.nativeElement;
                if (!(tipElement && tipElement.contains(event.target))) {
                    this.zone.run(() => {
                        this.hide();
                    });
                    this.popoverComponentRef = null;
                }
            });
            this.unListenDocumentKeydown = this.render.listen(document, 'keydown', (event) => {
                switch (event.which) {
                    case TiKeymap.KEY_TAB: // tab键用于处理在提示框内循环获取焦点
                        this.clickTab(event);
                        break;
                    case TiKeymap.KEY_ENTER:
                        if (this.hostElement.contains(event.target) && !this.popoverComponentRef) {
                            this.showPopandFocus();
                        }
                        break;
                    default:
                        break;
                }
            });
        });
    }
    clickTab(event) {
        const dialogModalEle = document.querySelector('.ti3-popconfirm-container');
        const focusableElements = dialogModalEle === null || dialogModalEle === void 0 ? void 0 : dialogModalEle.querySelectorAll(this.focusableElementsString);
        Util.focusInDialogOnTabchange(event, focusableElements);
    }
    /**
     * 打开气泡组件，并且把焦点转移到提示框内部，为后续把焦点限制在提示框内做准备。
     * @private
     */
    showPopandFocus() {
        this.zone.run(() => {
            this.popoverComponentRef = this.show();
            const popContainerEle = document.querySelector('.ti3-popconfirm-container');
            if (popContainerEle) {
                popContainerEle.focus();
            }
        });
    }
    /**
     * 显示气泡确认框
     * @ignore
     */
    show() {
        if (!this.tipInstance) {
            return;
        }
        const destroyPopover = (result) => {
            this.hide();
            if (result && Util.isFunction(this.tiPopconfirm.close)) {
                this.tiPopconfirm.close(this.data);
            }
            else if (!result && Util.isFunction(this.tiPopconfirm.dismiss)) {
                this.tiPopconfirm.dismiss(this.data);
            }
        };
        return this.tipInstance.show(TiPopconfirmComponent, {
            id: this.tiPopconfirm.id,
            config: this.tiPopconfirm,
            destroyPopover
        });
    }
}
TiPopconfirmDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiPopconfirm]'
            },] }
];
TiPopconfirmDirective.ctorParameters = () => [
    { type: TiTipService },
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiPopconfirmDirective.propDecorators = {
    tiPopconfirm: [{ type: Input }],
    data: [{ type: Input }]
};

class TiPopconfirmModule {
}
TiPopconfirmModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiTipServiceModule,
                    TiLocaleModule,
                    TiIconModule,
                    TiButtonModule
                ],
                exports: [TiPopconfirmDirective],
                declarations: [TiPopconfirmComponent, TiPopconfirmDirective],
                entryComponents: [TiPopconfirmComponent]
            },] }
];

class TiActionmenuModule {
}
TiActionmenuModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule,
                    TiMenuModule,
                    TiTipModule,
                    TiPopconfirmModule],
                exports: [TiActionmenuComponent],
                declarations: [TiActionmenuComponent]
            },] }
];

/**
 * Alert组件用于消息提示，提供了四种类型
 *
 * <example-url>../tiny3demo/#/alert/alert-all</example-url>
 */
class TiAlertComponent extends TiBaseComponent {
    constructor(hostRef, renderer, document) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.document = document;
        /**
         * 是否显示左侧提示类型图标
         */
        this.typeIcon = true;
        /**
         * 是否显示关闭按钮
         */
        this.closeIcon = true;
        /**
         * 是否触发下拉类组件消失的事件，适用于alert的呈现状态影响页面下拉类组件位置的场景
         */
        this.triggerScroll = false;
        /**
         * 弹框类型
         */
        this.type = 'success';
        /**
         * 样式大小
         */
        this.size = 'normal';
        this.isOpen = true;
        /**
         * 是否为深色背景提示框
         */
        this.darkTheme = false;
        /**
         * @ignore
         * 是否设置阴影，组件规范定义无阴影（页面级及卡片内）
         */
        this.boxShadow = false;
        /**
         * open状态变化事件，点击关闭按钮或延时消失时都会触发
         */
        this.openChange = new EventEmitter();
    }
    /* tslint:disable:no-redundant-jsdoc */
    /**
     * 用于设置弹框是否弹出，可动态修改，默认值为true
     *
     * **请注意：动态修改情况下，需要设置为双向绑定，以确保组件延迟消失时open状态的正确感知**
     *
     * @type：boolean
     *
     */
    get open() {
        return this.isOpen;
    }
    /**
     * @ignore
     */
    set open(value) {
        if (value === this.open) {
            return;
        }
        if (value) { // 值为true时，才会延迟关闭
            this.dismissOnTime();
        }
        else { // 值为false时，关闭时清除定时器
            this.clearTimeout();
        }
        // open动态修改均涉及tiScroll事件
        this.triggerScrollEvent();
        this.isOpen = value;
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始open值为true时，设置延时关闭
        if (this.open) {
            this.dismissOnTime();
        }
    }
    ngOnDestroy() {
        if (this.timeoutId !== undefined) {
            clearTimeout(this.timeoutId);
            if (this.open) {
                this.close();
            }
        }
    }
    /**
     * @ignore
     * alert呈现后，处理多长时间后消失
     */
    dismissOnTime() {
        // 未配置消失时间或当前已处于隐藏状态，则不做处理
        if (isNaN(this.dismissOnTimeout)) {
            return;
        }
        this.timeoutId = setTimeout(() => {
            this.close();
        }, this.dismissOnTimeout);
    }
    /**
     * @ignore
     * 关闭alert方法，供内部关闭调用
     */
    close() {
        this.open = false;
        this.openChange.emit(this.open); // 及时通知open状态，确保open状态双向绑定功能正常
    }
    /**
     * @ignore
     * alert出现或者消失时，可能会触发页面滚动，此时需要触发tiScroll事件通知相关组件
     */
    triggerScrollEvent() {
        if (!this.triggerScroll) {
            return;
        }
        setTimeout(() => {
            Util.trigger(this.document, 'tiScroll');
        }, 0);
    }
    clearTimeout() {
        if (this.timeoutId !== undefined) {
            clearTimeout(this.timeoutId);
        }
    }
}
TiAlertComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-alert',
                template: "<div class=\"ti3-alert-container\"\r\n     *ngIf=\"open\"\r\n     [ngClass]=\"{'ti3-alert-prompt-container': type === 'prompt',\r\n             'ti3-alert-error-container': type === 'error',\r\n             'ti3-alert-warn-container': type === 'warn',\r\n             'ti3-alert-success-container': type === 'success',\r\n             'ti3-alert-simple-container': type === 'simple',\r\n             'ti3-alert-box-shadow': boxShadow,\r\n             'ti3-alert-dark-theme': darkTheme,\r\n             'ti3-alert-size-small': size === 'small'}\">\r\n    <span class=\"ti3-alert-circle\" *ngIf=\"(type === 'prompt' || type === 'error' || type === 'success') && typeIcon\"><!--\r\n --><span class=\"ti3-icon\"\r\n          [ngClass]=\"{'ti3-icon-alert-prompt': type === 'prompt',\r\n                     'ti3-icon-alert-warn': type === 'error',\r\n                     'ti3-icon-alert-success': type === 'success'}\"></span><!--\r\n --></span><!--\r\n --><span class=\"ti3-icon ti3-icon-alert-warn-bg ti3-alert-warn-bg\" *ngIf=\"type === 'warn' && typeIcon\"><!--\r\n        --><span class=\"ti3-icon ti3-icon-alert-warn ti3-alert-warn-icon\" ></span>\r\n     </span><!--\r\n --><div class=\"ti3-alert-label\"\r\n        [ngClass]=\"{'ti3-alert-label-with-closeIcon': closeIcon && (!typeIcon || type === 'simple'),\r\n                    'ti3-alert-label-with-typeIcon': !closeIcon && typeIcon && type !== 'simple',\r\n                    'ti3-alert-only-label': !closeIcon && (!typeIcon || type === 'simple')}\"\r\n                    [id]=\"appendId('label')\">\r\n        <ng-content></ng-content>\r\n    </div><!--\r\n --><span class=\"ti3-alert-close-icon ti3-icon ti3-icon-close\"\r\n         *ngIf=\"closeIcon\"\r\n         (click)=\"close()\"\r\n         [tabindex]=\"0\"\r\n         tiOutline\r\n         (keydown.enter)=\"close()\"\r\n          [id]=\"appendId('alert_close_icon')\"></span>\r\n</div>",
                styles: ["::ng-deep :root{--ti-alert-label-line-height-value:calc(var(--ti-common-line-height-number)*var(--ti-common-font-size-base));--ti-alert-padding-horizon:15px;--ti-alert-padding-vertical:11px;--ti-alert-small-padding-vertical:7px;--ti-alert-type-icon-vertical-align:top}:host{display:block;width:var(--ti-alert-default-width)}.ti3-alert-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-alert-box-radius);box-sizing:border-box;font-weight:400;padding:var(--ti-alert-padding-vertical) var(--ti-alert-padding-horizon);width:100%}.ti3-alert-container.ti3-alert-dark-theme{background:var(--ti-alert-dark-bg-color);border:none}.ti3-alert-container.ti3-alert-dark-theme .ti3-alert-label{color:var(--ti-common-color-text-gray)}.ti3-alert-container.ti3-alert-dark-theme .ti3-alert-close-icon{color:var(--ti-common-color-icon-darkbg-normal)}.ti3-alert-container.ti3-alert-size-small{padding:var(--ti-alert-small-padding-vertical) var(--ti-alert-padding-horizon)}.ti3-alert-error-container{background:var(--ti-alert-error-bg-color);border-color:var(--ti-alert-error-border-color)}.ti3-alert-error-container .ti3-alert-circle{background:var(--ti-alert-error-icon-color)}.ti3-alert-prompt-container{background:var(--ti-alert-prompt-bg-color);border-color:var(--ti-alert-prompt-border-color)}.ti3-alert-prompt-container .ti3-alert-circle{background:var(--ti-alert-prompt-icon-color)}.ti3-alert-warn-container{background:var(--ti-alert-warn-bg-color);border-color:var(--ti-alert-warn-border-color)}.ti3-alert-success-container{background:var(--ti-alert-success-bg-color);border-color:var(--ti-alert-success-border-color)}.ti3-alert-success-container .ti3-alert-circle{background:var(--ti-alert-success-close-color)}.ti3-alert-simple-container{border-color:var(--ti-alert-simple-border-color)}.ti3-alert-success-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-success-box-shadow)}.ti3-alert-error-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-error-box-shadow)}.ti3-alert-prompt-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-prompt-box-shadow)}.ti3-alert-warn-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-warn-box-shadow)}.ti3-alert-dark-theme.ti3-alert-box-shadow{box-shadow:var(--ti-alert-dark-box-shadow)}.ti3-alert-circle{border-radius:50%;color:var(--ti-common-color-icon-white);height:var(--ti-alert-type-icon-width);line-height:var(--ti-alert-type-icon-width);text-align:center;width:var(--ti-alert-type-icon-width)}.ti3-alert-circle,.ti3-alert-warn-bg{display:inline-block;margin:calc((var(--ti-alert-label-line-height-value) - var(--ti-alert-type-icon-width))/2) var(--ti-alert-type-icon-margin-right) 0 0;vertical-align:var(--ti-alert-type-icon-vertical-align)}.ti3-alert-warn-bg{color:var(--ti-alert-warn-icon-color);font-size:var(--ti-alert-type-icon-width);position:relative}.ti3-alert-warn-icon{bottom:1px;color:var(--ti-common-color-icon-white);font-size:var(--ti-common-font-size-base);left:calc((var(--ti-alert-type-icon-width) - var(--ti-common-font-size-base))/2);position:absolute}.ti3-alert-label{color:var(--ti-alert-label-color);display:inline-block;line-height:var(--ti-common-line-height-number);overflow-wrap:break-word;width:calc(100% - var(--ti-alert-type-icon-width) - var(--ti-alert-close-icon-width) - var(--ti-alert-type-icon-margin-right) - var(--ti-alert-close-icon-margin-left));word-wrap:break-word}.ti3-alert-label.ti3-alert-label-with-closeIcon{width:calc(100% - var(--ti-alert-close-icon-width) - var(--ti-alert-close-icon-margin-left))}.ti3-alert-label.ti3-alert-label-with-typeIcon{width:calc(100% - var(--ti-alert-type-icon-width) - var(--ti-alert-type-icon-margin-right))}.ti3-alert-label.ti3-alert-only-label{width:100%}.ti3-alert-close-icon{cursor:pointer;display:inline-block;line-height:var(--ti-common-line-height-number);margin-left:var(--ti-alert-close-icon-margin-left);vertical-align:top;width:var(--ti-alert-close-icon-width)}.ti3-alert-error-container .ti3-alert-close-icon{color:var(--ti-alert-error-close-color)}.ti3-alert-prompt-container .ti3-alert-close-icon{color:var(--ti-alert-prompt-close-color)}.ti3-alert-success-container .ti3-alert-close-icon{color:var(--ti-alert-success-close-color)}.ti3-alert-warn-container .ti3-alert-close-icon{color:var(--ti-alert-warn-close-color)}.ti3-alert-simple-container .ti3-alert-close-icon{color:var(--ti-alert-simple-close-color)}"]
            },] }
];
TiAlertComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiAlertComponent.propDecorators = {
    typeIcon: [{ type: Input }],
    closeIcon: [{ type: Input }],
    dismissOnTimeout: [{ type: Input }],
    triggerScroll: [{ type: Input }],
    type: [{ type: Input }],
    size: [{ type: Input }],
    darkTheme: [{ type: Input }],
    boxShadow: [{ type: Input }],
    open: [{ type: Input }],
    openChange: [{ type: Output }]
};

class TiAlertModule {
}
TiAlertModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiOutlineModule
                ],
                exports: [TiAlertComponent],
                declarations: [TiAlertComponent]
            },] }
];

/**
 * @ignore
 * 下拉面板带有数组列表组件，用于aucomplete等。它有子类TiDropsearchComponent
 */
class TiDroplistComponent extends TiFormComponent {
    constructor(render, hostRef, zone) {
        super(hostRef, render);
        this.render = render;
        this.zone = zone;
        /**
         * 默认高度8条 DEFAULT_LIST_MAX_HEIGHT
         */
        this.defaultListMaxHeight = 30 * 8 + 8;
        /**
         * 面板中，除去list外，其它元素的占位高度
         */
        this.heightExcludeList = 2;
        /**
         * drop面板自定义底部高度
         */
        this.footerHeight = 0;
        /**
         * 是否多选
         */
        this.multiple = false;
        /**
         * 下拉面板的最大显示宽度，该变量与下拉类组件保持一致
         *
         * 1."justified"(默认): 下拉框的宽度与Select组件的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉选项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于Select组件的宽度)。例如："200px"
         */
        this.panelWidth = 'justified';
        this.labelKey = 'label';
        this.noDataText = '...';
        this.tipPosition = 'right';
        this.dominatorSpace = TiDropComponent.DOMINATOR_SPACE + 'px'; // 10.0.1新增
        this.panelAlign = 'left'; // 10.0.1新增
        /**
         * 内部接口，用作suggestion时type传入suggestion，默认值default
         */
        this.type = 'default';
        /**
         * 大小样式，default/small. 默认值default
         */
        this.size = 'default';
        /**
         * 选中选项后面板是否保持显示， 默认值false
         */
        this.isShowAfterSelect = false;
        /**
         * 选中事件，向外通知option数据
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        /**
         * 储存donimator bottom旧值
         */
        this.dominatorLastBottom = undefined;
        /**
         * 储存donimator left旧值
         */
        this.dominatorLastLeft = undefined;
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始设置list高度
        this.initListMaxHeight();
        this.listenKeydown(this.dominatorElem);
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // dominatorElem 改变后重新添加监听
        if (changes['dominatorElem'] && !changes['dominatorElem'].firstChange) {
            this.unlistenKendown();
            this.listenKeydown(this.dominatorElem);
        }
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        // 解除按键监听
        this.unlistenKendown();
        // 解除IE滚动条Bug的监听
        this.listCom.unlistenIESrollbarBug();
    }
    /**
     * 当做生命周期用吧，监听模型值变化。包括writeValue和this.model=赋值 这两个时刻。
     * @param model ngModel值
     */
    ngOnModelChange(model) {
        super.ngOnModelChange(model);
        if (!this.multiple || !this.dominatorElem) { // 多选才会有dominator行高切换
            return;
        }
        if (this.dominatorLastBottom === undefined && this.dominatorElem) { // 第一次只记录位置，不走进重定位逻辑
            // 修复SSR错误：ERROR TypeError: this.dominatorElem.getBoundingClientRect is not a function
            if (typeof this.dominatorElem.getBoundingClientRect === 'function') {
                this.dominatorLastBottom = this.dominatorElem.getBoundingClientRect().bottom;
                this.dominatorLastLeft = this.dominatorElem.getBoundingClientRect().left;
            }
            return;
        }
        this.zone.runOutsideAngular(() => {
            setTimeout(() => {
                if (!this.dominatorElem) {
                    return;
                }
                // ngModel更新（点击checkbox，或者点击叉叉号）后，dominator有可能一行/两行变换，所以更新下拉面板位置。
                // 甚至donimator本身位置也会变动。（比如测试用例中元素变动，引起donimator本身变动 ???）
                if (this.dominatorLastBottom !== this.dominatorElem.getBoundingClientRect().bottom ||
                    this.dominatorLastLeft !== this.dominatorElem.getBoundingClientRect().left) {
                    if (this.dropCom.isShow) {
                        // 仅当高度变化时，重定位。
                        this.rePosition();
                    }
                    this.dominatorLastBottom = this.dominatorElem.getBoundingClientRect().bottom;
                    this.dominatorLastLeft = this.dominatorElem.getBoundingClientRect().left;
                }
            }, 0);
        });
    }
    /**
     *  监听keydown
     * @param focusElem 焦点元素
     */
    listenKeydown(focusElem) {
        if (!focusElem) {
            return;
        }
        this.unlistenKeydownFn = this.renderer.listen(focusElem, 'keydown', (event) => {
            if (!this.isShow) {
                return;
            }
            // 10.0.2删除 KEY_SPACE 空格快捷键的响应
            switch (event.keyCode) {
                case TiKeymap.KEY_ESCAPE: // Esc键，仅可关闭
                case TiKeymap.KEY_TAB: // Tab键，仅可关闭
                    event.preventDefault(); // 阻止触发blurFn
                    this.hide();
                    break;
                case TiKeymap.KEY_ARROW_UP: // 向上箭头，上移选项
                case TiKeymap.KEY_ARROW_DOWN: // 向下箭头，下移选项
                case TiKeymap.KEY_ENTER: // ENTER键 相当于click
                case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(苹果数字小键盘)
                    this.listCom.onKeydown(event);
                    break;
                default:
                    break;
            }
            // 如果droplist响应了按键，那么就不再冒泡。
            event.stopPropagation();
        });
    }
    unlistenKendown() {
        if (this.unlistenKeydownFn) {
            this.unlistenKeydownFn();
        }
    }
    /**
     * 外部接口: 获取当前状态, 只读不写
     */
    get isShow() {
        return this.dropCom.isShow;
    }
    /**
     * 打开面板
     */
    show() {
        if (!this.isShow) {
            // 打开面板
            // 每次打开面板前需要重置list的高度确保drop高度不受其影响
            this.initListMaxHeight();
            // 打开面板
            this.dropCom.show();
            // 根据drop的最大高度设置list的最大高度
            this.restyleListMaxHeight();
            this.listCom.scrollToSelected();
            // IE滚动条Bug的监听
            this.listCom.listenIESrollbarBug();
        }
    }
    /**
     * 关闭面板的处理
     */
    hide() {
        // this.listCom.hide(); // 隐藏时list也需要做处理：清除当前hover项状态
        if (this.isShow) {
            this.dropCom.hide(); // 关闭面板
            // 解除IE滚动条Bug的监听
            this.listCom.unlistenIESrollbarBug();
        }
    }
    /**
     * 重新设置元素位置
     */
    rePosition(optionsChange) {
        if (optionsChange) {
            this.dropCom.resetPosition();
        }
        else {
            this.dropCom.setPosition();
        }
        this.restyleListMaxHeight();
    }
    /**
     * 根据drop的压缩情况，设置list的max-height
     */
    restyleListMaxHeight() {
        // 计算自定义底部的高度
        if (this.footerElemRef && this.footerElemRef.nativeElement) {
            let rect = this.footerElemRef.nativeElement.getBoundingClientRect();
            if (rect.height) {
                this.footerHeight = rect.height;
            }
        }
        // 如果drop被压缩，则根据drop最大高度设置当前list最大高度。
        const dropCurMaxHeight = parseInt(this.dropCom.nativeElement.style.maxHeight, 10);
        let dropMaxHeightAdapted = this.dropMaxHeight + this.footerHeight;
        if (!isNaN(dropCurMaxHeight) && dropCurMaxHeight < dropMaxHeightAdapted) {
            dropMaxHeightAdapted = dropCurMaxHeight;
            const computedListMaxHeight = dropMaxHeightAdapted - this.heightExcludeList - this.footerHeight;
            // 设置list max-height
            this.renderer.setStyle(this.listCom.nativeElement, 'max-height', computedListMaxHeight + 'px');
        }
    }
    // 初始化list最大高度
    initListMaxHeight() {
        this.dropMaxHeight = this.panelMaxHeight ? parseInt(this.panelMaxHeight, 10) :
            this.defaultListMaxHeight + this.heightExcludeList;
        this.renderer.setStyle(this.listCom.nativeElement, 'max-height', (this.dropMaxHeight - this.heightExcludeList) + 'px');
    }
    // 鼠标或enter点击选项后，组件隐藏
    onSelect(option) {
        this.select.emit(option);
        // nextlevel只用在省市区regionselect组件场景，选中省、市级别面板不关闭
        if (!this.isShowAfterSelect && !this.multiple && !option.nextLevel) {
            this.hide();
        }
    }
}
/**
 * 带搜索框情况下需要去除的高度
 */
// tslint:disable-next-line:binary-expression-operand-order
TiDroplistComponent.SEARCHBOX_EXCLUDE_HEIGHT = 28; // 下拉框中的搜索框的高度
TiDroplistComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-droplist',
                template: "<ti-drop [dominatorElem]=\"dominatorElem\"\r\n    [dominatorSpace]=\"dominatorSpace\"\r\n    [panelAlign]='panelAlign'\r\n    [panelWidth]='panelWidth' [class.ti3-select-small]=\"size === 'small'\">\r\n    <ti-list [multiple]=\"multiple\"\r\n        [options]=\"options\"\r\n        [(ngModel)]=\"model\"\r\n        style=\"display:block;\"\r\n        (select)=\"onSelect($event)\"\r\n        [id]=\"appendId('list')\"\r\n        [tipPosition]=\"tipPosition\"\r\n        [noDataText]=\"noDataText\">\r\n        <ng-template let-item let-i=index>\r\n                <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #listLabelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n        </ng-template>\r\n    </ti-list>\r\n</ti-drop>",
                providers: [TiFormComponent.getValueAccessor(TiDroplistComponent)]
            },] }
];
TiDroplistComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
TiDroplistComponent.propDecorators = {
    dominatorElem: [{ type: Input }],
    multiple: [{ type: Input }],
    panelWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    options: [{ type: Input }],
    labelKey: [{ type: Input }],
    noDataText: [{ type: Input }],
    tipPosition: [{ type: Input }],
    dominatorSpace: [{ type: Input }],
    panelAlign: [{ type: Input }],
    type: [{ type: Input }],
    size: [{ type: Input }],
    isShowAfterSelect: [{ type: Input }],
    select: [{ type: Output }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, { static: true },] }],
    listCom: [{ type: ViewChild, args: [TiListComponent, { static: true },] }],
    footerElemRef: [{ type: ViewChild, args: ['footer', { static: false },] }],
    itemTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }]
};

/**
 * @ignore
 */
class TiDroplistModule {
}
TiDroplistModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiListModule,
                    TiDropModule
                ],
                exports: [TiDroplistComponent],
                declarations: [TiDroplistComponent]
            },] }
];

/**
 * 本组件基于原生input标签进行扩展，原生input加 tiText 属性即为text组件,
 * 原生input的所有属性以及 Angular 的各种属性指令都可以使用。
 *
 * <example-url>../tiny3demo/#/text/text-all</example-url>
 */
class TiTextComponent extends TiAutofocusComponent {
    constructor(elementRef, renderer, tiRenderer, formControl, zone) {
        super(elementRef, renderer);
        this.tiRenderer = tiRenderer;
        this.formControl = formControl;
        this.zone = zone;
        /**
         * clear事件：当开启清除功能时(使用clearable属性)，点击删除按钮触发
         */
        this.clear = new EventEmitter();
        /**
         * @ignore
         *
         * 初始获取文本框类型
         */
        this.isPassword = false;
        this.isFirstFocus = true; // 是否为第一次聚焦
        this.hasClear = false; // 是否有清除功能
        this.lastIsHover = undefined; // 最后一次绘制叉号的状态。
        this.lastDisabled = undefined; // 最后一次叉号是否禁用。
        this.isVisible = false; // 密码是否可见，默认不可见
        this.isNoEye = false; // 眼睛是否不显示，默认显示
        /**
         * @ignore
         * 鼠标移入清除按钮区域时，给宿主元素添加ti-text-clear-active样式
         */
        this.handleMousemove = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear && !this.isPassword) {
                return;
            }
            // 鼠标移入清除按钮区域时，给宿主元素添加ti-text-clear-active样式;
            // 否则去掉ti-text-clear-active样式
            this.isClearActive = this.isIconField(event);
            this.isClearActive ? this.renderer.addClass(this.nativeElement, 'ti3-text-clear-active') :
                this.renderer.removeClass(this.nativeElement, 'ti3-text-clear-active');
            // 密码类型只需要设置悬浮时手型样式
            if (this.isPassword) {
                return;
            }
            // 叉号特殊处理，3）hover
            this.isClearActive ? this.setClearBackgroud(true) : this.setClearBackgroud(false);
        };
        /**
         * @ignore
         */
        this.handleMouseout = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear) {
                return;
            }
            // 叉号特殊处理，3）hover
            this.setClearBackgroud(false);
        };
        /**
         * @ignore
         * 切换密码可见不可见时，输入框需处于失焦状态
         */
        this.handleMousedown = (event) => {
            if (this.nativeElement.disabled || !this.isPassword || !this.isIconField(event)) {
                return;
            }
            event.preventDefault();
            // 聚焦到可输入区域，再点击眼睛图标时，输入框应失焦
            if (document.activeElement === this.nativeElement) {
                this.nativeElement.blur();
            }
        };
        /**
         *  @ignore
         * 当在清除按钮区域点击时，清空输入框内容
         */
        this.handleClick = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear && !this.isPassword || !this.isIconField(event)) {
                return;
            }
            if (this.isShowClear) {
                this.renderer.setProperty(this.nativeElement, 'value', '');
                Util.trigger(this.nativeElement, 'input');
                this.zone.run(() => {
                    this.clear.emit(event);
                });
                // 点击清除按钮后延时才能聚焦元素
                setTimeout(() => {
                    this.nativeElement.focus();
                }, 0);
            }
            if (this.isPassword) {
                this.isVisible = !this.isVisible;
                this.lastIsHover = undefined;
                this.controlEyeShow();
            }
        };
    }
    ngOnInit() {
        super.ngOnInit();
        this.isNoEye = this.nativeElement.hasAttribute('noeye');
        this.isPassword = this.nativeElement.type === 'password' && !this.isNoEye;
        this.hasClear = this.nativeElement.hasAttribute('clearable') && !this.isPassword;
        this.isNoBorder = this.nativeElement.hasAttribute('noborder');
        // 初始化注册事件
        this.initFn();
        this.handlePassword();
        // Chrome下输入框有时出现自动联想(该问题出现无规律可寻，比较奇怪)，
        // 将其autocomplete置为off可规避此问题
        // 之后firefox及IE11也出现类似问题，所以不区分浏览器差异，统一添加这层处理
        if (this.nativeElement.type === 'text' && this.nativeElement.autocomplete !== 'on') {
            this.renderer.setAttribute(this.nativeElement, 'autocomplete', 'off');
        }
        // 由于在valueChanges中监听不到动态表单中文本框的初始值
        // 所以此处对初始值要做单独处理
        this.controlClearShow(this.nativeElement.value);
        // 文本框的值发生变化时触发
        this.formControl.valueChanges.subscribe((value) => {
            this.controlClearShow(value);
        });
        // 初始设置eye图标
        this.controlEyeShow();
    }
    ngDoCheck() {
        const disabled = this.nativeElement.disabled;
        // 与上次disabled状态相同，则返回
        if (this.lastDisabled === disabled) {
            return;
        }
        // 叉号特殊处理，2）禁用
        if (this.isShowClear || this.isPassword) {
            if (disabled) {
                this.setClearBackgroud(null);
                this.lastDisabled = true;
            }
            else { // 从禁用改为非禁用
                this.setClearBackgroud(false);
                this.lastDisabled = false;
            }
        }
    }
    ngOnDestroy() {
        // 销毁组件时需要将内部生成dom也移除
        if (this.pwdHackEle) {
            this.renderer.removeChild(this.renderer.parentNode(this.pwdHackEle), this.pwdHackEle);
        }
    }
    /**
     * @ignore
     */
    handleFocus() {
        // IE和火狐浏览器在首次autofoucus聚焦时会将光标移到文字起始位置，用户体验不好
        // 需要手动设置光标位置到行尾
        if (this.isFirstFocus && this.nativeElement.autofocus &&
            (TiBrowser.isFirefox() || TiBrowser.isIE())) {
            this.nativeElement.setSelectionRange(this.nativeElement.value.length, this.nativeElement.value.length);
        }
        this.isFirstFocus = false;
    }
    initFn() {
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(this.nativeElement, 'mousemove', this.handleMousemove);
            this.renderer.listen(this.nativeElement, 'mouseout', this.handleMouseout);
            this.renderer.listen(this.nativeElement, 'mousedown', this.handleMousedown);
            this.renderer.listen(this.nativeElement, 'click', this.handleClick);
        });
    }
    /**
     *
     * @param isHover true标示悬浮，false标示非悬浮，null标示禁用，undefinded标示不画叉号。
     * @returns
     */
    setClearBackgroud(isHover) {
        // 如果跟上次一样，则返回。
        if (this.lastIsHover === isHover) {
            return;
        }
        else {
            this.lastIsHover = isHover;
        }
        let colorStr = '';
        if (Util.supportsCssVars()) {
            // Chrome等支持CSSVar的浏览器，正常操作,  从CSSVar变量中取出颜色。
            const varName = isHover === false ? '--ti-input-clear-color' :
                isHover === true ? '--ti-input-clear-color-hover' :
                    isHover === null ? '--ti-input-clear-color-disabled' : '';
            // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
            if (typeof getComputedStyle !== 'undefined') {
                colorStr = getComputedStyle(document.documentElement).getPropertyValue(varName);
            }
        }
        else {
            // IE和低版Edge不支持CSSVar的浏览器，从一个CSS样式中取出颜色。
            const styleName = isHover === false ? 'flood-color' :
                isHover === true ? 'lighting-color' :
                    isHover === null ? 'stop-color' : '';
            // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
            if (typeof getComputedStyle !== 'undefined') {
                colorStr = getComputedStyle(this.nativeElement).getPropertyValue(styleName);
            }
        }
        colorStr = colorStr.trim().replace('#', '%23'); // URL编码
        let urlStr;
        if (this.isPassword) {
            urlStr = this.isVisible ? `url(data:image/svg+xml,%3Csvg%20version=%221.1%22%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2232%22%20height=%2232%22%20viewBox=%220%200%2032%2032%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d=%22M16%206.4c9.4%200%2016%206.4%2016%209.6%200%203-6.6%209.6-16%209.6-9.2%200-16-6.4-16-9.6s6.8-9.6%2016-9.6zM16%208.2c-4.2%200-7.8%203.6-7.8%207.8%200%204.4%203.4%207.8%207.8%207.8%204.2%200%207.8-3.6%207.8-7.8%200-4.4-3.6-7.8-7.8-7.8zM16%2011c2.8%200%205%202.2%205%205s-2.2%205-5%205-5-2.2-5-5c0-2.8%202.2-5%205-5z%22%3E%3C/path%3E%3C/svg%3E%0A)` :
                `url(data:image/svg+xml,%3Csvg%20version=%221.1%22%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2232%22%20height=%2232%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d=%22M1.6%202.925c0.6-0.6%201.4-0.6%201.8%200v0l25.6%2024.2c0.2%200.2%200.4%200.6%200.4%201s-0.2%200.6-0.4%201c-0.2%200.2-0.6%200.4-1%200.4s-0.8-0.2-1-0.4v0l-5-5.2c-2%200.6-4%201-6%201-9.2%200-16-6.6-16-9.8%200-1.8%202-4.6%205.4-6.6v0l-3.6-3.8c-0.6-0.4-0.6-1.2-0.2-1.8zM9%2011.725c-0.4%201-0.6%202.2-0.6%203.4%200%204.4%203.4%208%207.8%208%201.4%200%202.8-0.4%203.8-1v0l-2.4-2.4c-0.4%200.2-1%200.4-1.6%200.4-2.8%200-5-2.2-5-5%200-0.4%200-0.8%200.2-1.2v0l-2.2-2.2zM16%205.325c9.4%200%2016%206.6%2016%209.8%200%201.8-2%204.6-5.6%206.8v0l-3.4-3.2c0.6-1%200.8-2.2%200.8-3.4%200-4.4-3.4-8-7.8-8-1.4%200-2.8%200.4-4%201.2v0%200l-2-2c2-1%204-1.2%206-1.2zM16%209.925c2.8%200%205%202.2%205%205%200%200.4%200%201-0.2%201.4v0l-6.6-6c0.6-0.2%201.2-0.4%201.8-0.4z%22%3E%3C/path%3E%3C/svg%3E)`;
        }
        else {
            urlStr = `url(data:image/svg+xml,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216px%22%20height%3D%2216px%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d%3D%22M12.529%2C11.469L9.061%2C8l3.469-3.469c0.294-0.294%2C0.295-0.768%2C0.001-1.062c-0.293-0.293-0.769-0.293-1.061%2C0L8%2C6.938L4.53%2C3.469c-0.292-0.293-0.767-0.293-1.061%2C0C3.177%2C3.762%2C3.177%2C4.238%2C3.471%2C4.532L6.939%2C8l-3.469%2C3.468c-0.294%2C0.293-0.294%2C0.768-0.001%2C1.062C3.616%2C12.678%2C3.81%2C12.75%2C4%2C12.75s0.384-0.072%2C0.53-0.219L8%2C9.062l3.47%2C3.469c0.147%2C0.146%2C0.339%2C0.219%2C0.53%2C0.219c0.192%2C0%2C0.384-0.072%2C0.53-0.219C12.823%2C12.236%2C12.824%2C11.762%2C12.529%2C11.469z%22%2F%3E%3C%2Fsvg%3E)`;
        }
        this.renderer.setStyle(this.nativeElement, 'backgroundImage', urlStr);
    }
    handlePassword() {
        // 密码框情况下，默认关闭autocomplete，避免浏览器弹出记住密码提示框引起的安全问题
        if (TiBrowser.isChrome() && this.nativeElement.type === 'password' &&
            this.nativeElement.autocomplete !== 'on') {
            this.pwdHackEle = this.renderer.createElement('input');
            this.tiRenderer.setAttributes(this.pwdHackEle, { type: 'text', tabindex: -1, autocomplete: 'off' });
            this.renderer.addClass(this.pwdHackEle, 'ti3-password-hack-input');
            // 插入一个input元素，阻止密码框前面的input联想用户名
            this.renderer.insertBefore(this.nativeElement.parentElement, this.pwdHackEle, this.nativeElement);
        }
    }
    // 控制clear是否显示，文本框为空时不显示，有内容时才显示
    controlClearShow(value) {
        if (!this.hasClear) {
            return;
        }
        const lastIsShowClear = this.isShowClear;
        this.isShowClear = (Util.isString(value) && value !== '');
        // 与上次状态相同，则返回
        if (this.isShowClear === lastIsShowClear) {
            return;
        }
        // 叉号特殊处理，1)初始化和监听是否显示
        if (this.isShowClear) {
            this.setClearBackgroud(false);
        }
        else {
            this.renderer.removeStyle(this.nativeElement, 'background');
            this.lastIsHover = undefined;
        }
    }
    // 控制eye是否显示，
    controlEyeShow() {
        if (!this.isPassword) {
            return;
        }
        this.setClearBackgroud(false);
        this.nativeElement.type = this.isVisible ? 'text' : 'password';
    }
    // 判断事件是否在清除按钮区域
    isIconField(event) {
        const iconWidth = this.isPassword ? TiTextComponent.PASSWORD_WIDTH : TiTextComponent.CLEAR_WIDTH;
        return event.clientX - this.nativeElement.getBoundingClientRect().left >
            this.nativeElement.getBoundingClientRect().width - iconWidth;
    }
}
TiTextComponent.CLEAR_WIDTH = 26; // 常量，清除按钮区域宽度
TiTextComponent.PASSWORD_WIDTH = 36; // 常量，眼睛按钮区域宽度
TiTextComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiText]',
                template: '',
                host: {
                    '[class.ti3-text-input-show-icon]': 'isShowClear || isPassword',
                    '[class.ti3-text-input-show-clear]': 'isShowClear',
                    '[class.ti3-text-input-show-password]': 'isPassword',
                    '[class.ti3-text-input-noborder]': 'isNoBorder',
                    '(focus)': 'handleFocus()'
                },
                styles: ["::ng-deep :root{--ti-text-clear-width:26px;--ti-text-password-width:36px}:host[tiText]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);flood-color:var(--ti-input-clear-color);font-size:var(--ti-input-font-size);height:var(--ti-input-height);lighting-color:var(--ti-input-clear-color-hover);line-height:normal;outline:none;padding:0 var(--ti-input-padding-horizontal);stop-color:var(--ti-input-clear-color-disabled);vertical-align:middle}:host[tiText].ti3-text-input-show-icon{background-repeat:no-repeat;background-size:16px}:host[tiText].ti3-text-input-show-clear{background-position:center right 5px;padding-right:var(--ti-text-clear-width)!important}:host[tiText].ti3-text-input-show-password{background-position:center right 10px;padding-right:var(--ti-text-password-width)!important}:host[tiText].ti3-text-input-noborder{border:0;box-shadow:none;outline:0}:host[tiText]:not([disabled]):not([noborder]).ti3-text-input-show-icon.ti3-text-clear-active:hover{cursor:pointer}:host[tiText]:not([disabled]):not([noborder]):hover{border:1px solid var(--ti-input-border-color-hover)}:host[tiText]:not([disabled]):not([noborder]):focus{border:1px solid var(--ti-input-border-color-focus)}:host[tiText][disabled]:disabled{background-color:var(--ti-input-bg-color-disabled);border:1px solid var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}:host[tiText][disabled]:disabled.ti3-text-input-noborder{border:0}.ti3-password-hack-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}:host[tiText]{transition:border-color .15s}:host[tiText].ti3-text-input-show-icon:focus{transition:transform .15s cubic-bezier(.4,0,.2,1),font-size .15s cubic-bezier(.4,0,.2,1)}:host[tiText]:hover:not(:focus){transition:border-color .2s}"]
            },] }
];
TiTextComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiRenderer },
    { type: NgControl },
    { type: NgZone }
];
TiTextComponent.propDecorators = {
    clear: [{ type: Output }]
};

class TiTextModule {
}
TiTextModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiRendererModule
                ],
                exports: [TiTextComponent],
                declarations: [TiTextComponent]
            },] }
];

/**
 * 自动补全输入框组件
 *
 * <example-url>../tiny3demo/#/autocomplete/autocomplete-all</example-url>
 */
class TiAutocompleteComponent extends TiFormComponent {
    constructor() {
        super(...arguments);
        /**
         * 预留提示文本
         */
        this.placeholder = '';
        /**
         * 是否开启清空输入框内容的功能
         *
         * 10.1.0/9.1.0版本之后默认不开启，在此之前版本默认开启
         */
        this.clearable = false;
        /**
         * 1."justified"(默认): 下拉框的宽度与输入框的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于输入框的宽度)。例如："200px"。
         */
        this.panelWidth = 'justified';
        /**
         * 指定下拉建议项中显示的文本对应的字段关键字
         */
        this.labelKey = 'label';
        /**
         * 10.0.1版本新增
         *
         * 下拉建议项
         */
        this.options = [];
        /**
         * 10.0.2版本新增
         *
         * 下拉建议项文字超长显示...，hover时tip弹出方向
         */
        this.tipPosition = 'right';
        /**
         * suggest事件，当聚焦或值改变时触发事件，为开发者提供设置建议项的时机。
         *
         * 参数：组件实例
         */
        this.suggest = new EventEmitter();
        /**
         * clear事件，点击清除按钮时触发
         *
         * 10.0.2版本新增(tiAutocomplete组件)
         *
         * 3.0.6版本新增(tiSearchbox组件)
         *
         */
        this.clear = new EventEmitter();
        /**
         * @ignore
         *
         */
        this.suggestions = [];
        /**
         * @ignore
         * 是否聚焦的标志位
         */
        this.isFocused = false;
        /**
         * 最后一次下拉建议项
         */
        this.lastSuggestions = [];
        /**
         * @ignore
         */
        this.inputChangeObserve = new Subject();
        // 内部公共方法集合--end
    }
    ngOnInit() {
        super.ngOnInit();
        this.setFocusableElems([this.textComp.nativeElement]);
        this.createInputChangeObserve();
        if (this.clearable) {
            this.renderer.setAttribute(this.textComp.nativeElement, 'clearable', '');
        }
    }
    ngOnDestroy() {
        // 修正SSR报错：TypeError: Cannot read property 'unsubscribe' of undefined
        this.inputChangeSub && this.inputChangeSub.unsubscribe();
    }
    // 组件交互方法集合--start
    /**
     * @ignore
     * 输入框中内容改变事件
     */
    onInputChange(value) {
        if (this.disabled || !this.isFocused) {
            return;
        }
        this.inputChangeObserve.next(value);
    }
    /**
     * @ignore
     * 两种情况下触发
     * 1.在suggestion面板展开的情况下，通过hover选中一项，然后按下enter
     * 2.在suggestion面板展开的情况下，通过鼠标点击选中一项
     */
    onDroplistChange(value) {
        if (value) {
            this.model = value[this.labelKey] || value.label;
        }
    }
    /**
     * @ignore
     */
    onFocus() {
        if (this.disabled) {
            return;
        }
        this.isFocused = true;
        if (this.isInputClear()) { // 如果是点击清除按钮，值会改变，那么就会在onInputChange中处理
            return;
        }
        this.showSuggestions();
    }
    /**
     * @ignore
     */
    onBlur() {
        this.dropListComp && this.dropListComp.hide();
        this.isFocused = false;
    }
    /**
     * @ignore
     *
     * 避免滚动页面下拉框隐藏之后组件仍聚焦时再次点击，下拉框无法展开
     *
     * mousedown在focus事件之前执行
     */
    onInputMousedown() {
        if (this.disabled || !this.isFocused || this.isInputClear()) { // 如果是点击清除按钮，值会改变，那么就会在onInputChange中处理
            return;
        }
        this.showSuggestions();
    }
    /**
     * @ignore
     * 点击叉号时触发
     *
     */
    onClear(event) {
        this.clear.emit(event);
    }
    // 组件交互方法集合--end
    // 内部公共方法集合--start
    /**
     * @description: 创建inputValue的observable，确保收集2ms内的数据后再更新下拉
     *  触发该observable时，使用next方法
     */
    createInputChangeObserve() {
        this.inputChangeSub = this.inputChangeObserve
            .pipe(debounceTime(200), // 200ms延迟执行，解决请求太频繁问题
        // TODO: 在点击清除按钮或者快捷键删除时数据不准确，可能导致在这些操作时触发不了下面的逻辑
        // distinctUntilChanged(),避免前后两次相同数据重复处理，只有上次数据和200ms后的数据不相等时才触发后续动作。
        switchMap(// TODO: 这个switchMap有可能没有生效。测试用例增加，switchMap
        (value) => {
            if (this.isFocused) {
                if (this.suggest.observers.length === 0) {
                    this.lastSuggestions = this.suggestions;
                    this.suggestions = this.filter(value);
                    if (this.suggestions.length > 0) {
                        this.show();
                    }
                    else {
                        this.dropListComp && this.dropListComp.hide();
                    }
                }
                else {
                    this.suggest.emit(this);
                }
            }
            return empty();
        }))
            .subscribe();
    }
    /**
     * 设置下拉建议项数据
     *
     * @param value 下拉建议项数组
     */
    setSuggestions(value) {
        this.lastSuggestions = this.suggestions;
        this.suggestions = value;
        if (this.suggestions.length > 0) {
            this.show();
        }
        else {
            this.dropListComp.hide();
        }
    }
    filter(searchWord) {
        if (this.options && this.options.length >= 0) {
            // 搜索结果临时值。结果默认值，是原数据
            let searchResult = this.options;
            // 如果搜索词存在
            if (!Util.isEmptyString(searchWord)) {
                // 在集合中搜索
                searchResult = searchResult.filter((option) => {
                    return option[this.labelKey].toLowerCase()
                        .indexOf(searchWord.toLowerCase()) >= 0;
                });
            }
            return searchResult;
        }
        return [];
    }
    show() {
        if (this.dropListComp.isShow) {
            // 搜索时，按需重新定位
            if (this.lastSuggestions.length !== this.suggestions.length) {
                setTimeout(() => {
                    this.dropListComp.rePosition(true);
                }, 0);
            }
        }
        else {
            // 数据更新后，未及时通知到droplist，初始化时按照默认值[]绘制视图，需延时处理
            setTimeout(() => {
                this.dropListComp.show();
                this.selected = undefined; // 为了去掉选中样式
                this.dropListComp.listCom.hoverOption = undefined; // 去掉hoverOption
            }, 0);
        }
    }
    isInputClear() {
        return this.textComp.isShowClear && this.textComp.isClearActive;
    }
    showSuggestions() {
        if (this.suggest.observers.length === 0) {
            this.lastSuggestions = this.suggestions;
            this.suggestions = this.filter(this.model);
            if (this.suggestions.length > 0) {
                this.show();
            }
        }
        else {
            this.suggest.emit(this);
        }
    }
}
TiAutocompleteComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-autocomplete',
                template: "<input #input tiText\r\n        class=\"ti3-autocomplete-input\"\r\n        [disabled]=\"disabled\"\r\n        spellcheck=false\r\n        [(ngModel)] = \"model\"\r\n        [placeholder]=\"placeholder\"\r\n        (ngModelChange)=\"onInputChange($event)\"\r\n        [maxlength]=\"maxlength\"\r\n        [id]=\"appendId('input')\"\r\n        (mousedown)=\"onInputMousedown()\"\r\n        (clear)=\"onClear($event)\">\r\n<ti-droplist #droplist\r\n              [dominatorElem]=\"nativeElement\"\r\n              [options]=\"suggestions\"\r\n              [(ngModel)]=\"selected\"\r\n              [labelKey]=\"labelKey\"\r\n              [panelMaxHeight]=\"panelMaxHeight\"\r\n              [panelWidth]=\"panelWidth\"\r\n              [tipPosition]=\"tipPosition\"\r\n              (ngModelChange)=\"onDroplistChange($event)\"\r\n              [id]=\"appendId('droplist')\">\r\n</ti-droplist>",
                providers: [TiFormComponent.getValueAccessor(TiAutocompleteComponent)],
                host: {
                    '[class.ti3-autocomplete-container]': 'true',
                    '(blur)': 'onBlur()',
                    '(focus)': 'onFocus()'
                },
                styles: [":host.ti3-autocomplete-container{background-color:var(--ti-common-color-bg-white-normal);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-common-border-radius-normal);display:inline-block;vertical-align:middle}:host.ti3-autocomplete-container:hover{border-color:var(--ti-input-border-color-hover)}:host.ti3-autocomplete-container[tifocused]{border-color:var(--ti-input-border-color-focus)}:host.ti3-autocomplete-container[disabled]{border-color:var(--ti-input-border-color-disabled)}:host.ti3-autocomplete-container[disabled] .ti3-autocomplete-input{background-color:var(--ti-input-bg-color-disabled)}:host.ti3-autocomplete-container .ti3-autocomplete-input{background-color:transparent;border:none!important;width:100%}"]
            },] }
];
TiAutocompleteComponent.propDecorators = {
    placeholder: [{ type: Input }],
    clearable: [{ type: Input }],
    maxlength: [{ type: Input }],
    panelWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    labelKey: [{ type: Input }],
    options: [{ type: Input }],
    tipPosition: [{ type: Input }],
    suggest: [{ type: Output }],
    clear: [{ type: Output }],
    textComp: [{ type: ViewChild, args: ['input', { static: true },] }],
    dropListComp: [{ type: ViewChild, args: ['droplist', { static: false },] }]
};

class TiAutocompleteModule {
}
TiAutocompleteModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDroplistModule,
                    TiTextModule
                ],
                exports: [TiAutocompleteComponent],
                declarations: [TiAutocompleteComponent]
            },] }
];

/**
 * buttonGroup选择按钮组组件
 *
 * 该组件支持单选、多选两种形式，显示内容支持用户自定义
 *
 * 单选块：用户要从一个数据集中选择单个选项。
 * 分大尺寸，小尺寸，无边框三种类型。
 * 支持可取消选中，默认选中时再次点击不取消当前选中项；
 *
 * 多选块：允许用户从一个数据集中选择多个选项。
 * 分大尺寸，小尺寸两种类型。
 *
 * <example-url>../tiny3demo/#/buttongroup/buttongroup-all</example-url>
 */
class TiButtongroupComponent extends TiWholeComponent {
    constructor(elementRef, renderer2, changeDetectorRef, iterableDiffers) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.changeDetectorRef = changeDetectorRef;
        this.iterableDiffers = iterableDiffers;
        /**
         * 用来控制按钮的尺寸大小:默认是large
         *
         * 单选按钮有大小尺寸、无边框之分：取值 'large','small','noBorder'
         *
         * 多选按钮有空间充足，空间不足之分：取值 'large','small',
         */
        this.type = 'large';
        /**
         * 设置是否为多选按钮组
         */
        this.multiple = false;
        // TODO:Tiny4 deselectable改为unselectable
        /**
         * 设置单选按钮组是否可以取消选中
         */
        this.deselectable = false;
        /**
         * 10.0.2新增
         *
         * 按钮是否为多行，设置为多行时，按钮块有下边距，否则没有。
         */
        /**
         * 用于取代公共样式类ti3-button-group-bottom-space
         * <ti-button-group class="ti3-button-group-bottom-space"></ti-button-group>
         */
        this.multiline = false;
    }
    ngOnInit() {
        super.ngOnInit();
        // 处理激活样式
        this.actClass = this.activeClass || 'ti3-active';
        this.itemsDiffer = this.iterableDiffers.find(this.items || [])
            .create();
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        const itemsDiffer = this.itemsDiffer.diff(this.items || []);
        if (itemsDiffer) {
            const focusElements = [];
            this.btns.forEach((item) => {
                focusElements.push(item.nativeElement);
            });
            this.setFocusableElems(focusElements);
        }
    }
    /**
     * 兼容旧版：
     * 10.1.2 版本之前只能内嵌一个模板，无命名。
     * 新版可以内嵌两个模板，示例书写要求都命名（#item，#sup）。
     * 但需要兼容旧版无命名测试用例。
     */
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果 item 模板为空 && 存在第一个模板，那么把第一个出现的 “非 #sup 标签” 的模板作为 item 模板
        if (!this.itemTemplate && this.firstTemplate
            && (this.firstTemplate.elementRef.nativeElement !== (this.supTemplate && this.supTemplate.elementRef.nativeElement))) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    /**
     * @ignore
     * sup属性存在class类或text存在且有效
     */
    isSuperScript(item) {
        return item.sup && (item.sup.constructor === Object) &&
            ((Util.isString(item.sup.class) && item.sup.class !== '') ||
                (Util.isString(item.sup.text) && item.sup.text !== ''));
    }
    /**
     * @ignore
     * @description 根据selectedId来设置每个按钮的样式
     * @param: item
     */
    setActiveClass(item) {
        if (this.hasSelected(item)) {
            return this.actClass;
        }
        return '';
    }
    /**
     * @ignore
     * 每个item上的点击事件
     */
    onClick(item) {
        if (item.disabled || this.disabled) { // 灰化状态下 ，点击操作无效
            return;
        }
        this.selectItem(item);
    }
    /**
     * @ignore
     * 每个item上的点击事件
     */
    selectItem(item) {
        if (this.multiple) {
            if (Util.isUndefined(this.modelWhole)) {
                this.modelWhole = [item];
            }
            else {
                const index = this.modelWhole.indexOf(item);
                if (index !== -1) { // 如果存在，则将其移除
                    this.modelWhole.splice(index, 1);
                }
                else { // 先前未选中情况下，勾选
                    this.modelWhole.push(item);
                }
                // selectedId是引用类型，内容改变不会触发modelchange，故需改变引用地址
                this.modelWhole = this.modelWhole.concat();
            }
        }
        else {
            this.modelWhole = (Object.is(item, this.modelWhole) && this.deselectable) ? '' : item;
        }
    }
    /**
     * @ignore
     * 判断是不是选中项
     */
    hasSelected(item) {
        if (Util.isUndefined(this.modelWhole) || Util.isNull(this.modelWhole)) {
            return;
        }
        if (this.multiple) {
            return this.modelWhole.indexOf(item) !== -1;
        }
        else {
            return Object.is(item, this.modelWhole);
        }
    }
}
TiButtongroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-button-group',
                template: "<!--TODO:div\u548Cspan\u662F\u5426\u53EF\u4EE5\u5408\u4E00\uFF1F\u5F31\u5316button\uFF0C\u6FC0\u6D3B\u72B6\u6001\u4E5F\u653E\u5728\u6700\u5916\u5C42-->\r\n<span style=\"margin-top:-50px\">\r\n<div *ngFor=\"let item of items; index as i;\"\r\n    [id]=\"appendId(i)\" class=\"ti3-btn-item-container\"\r\n    [class.ti3-btn-checkbox-enough-space]=\"type === 'large' && multiple\"\r\n    [class.ti3-btn-checkbox-deficient-space]=\"type === 'small' && multiple\"\r\n    [class.ti3-btn-item-small]=\"type === 'small' && !multiple\"\r\n    [tiTip]=\"item.tipContent\"\r\n    [tiTipContext]=\"item\"\r\n    [tiTipPosition]='item.tipPosition'\r\n    (click)=\"onClick(item)\"\r\n    [ngClass]=\"setActiveClass(item)\">\r\n        <button #btn type=\"button\" tiOutline\r\n                [ngStyle]=\"{'min-width': minWidth}\"\r\n                class=\"ti3-btn-item\"\r\n                [ngClass]=\"{'ti3-btn-item-radio': !multiple,\r\n                            'ti3-btn-item-noBorder': !multiple && type === 'noBorder',\r\n                            'ti3-btn-item-checkbox': multiple}\"\r\n                [disabled]=\"item.disabled || disabled\"\r\n\r\n                ><ng-container *ngIf=\"!itemTemplate else customcontent\">\r\n                    <span class=\"ti3-btn-item-text\" [title]=\"item.text\">{{item.text}}</span>\r\n                </ng-container>\r\n                <ng-template #customcontent>\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate;\r\n                                    context: {$implicit: item, index: i}\"></ng-container>\r\n                </ng-template>\r\n        </button>\r\n        <section *ngIf=\"supTemplate else defaultTemplate\" class=\"ti3-btn-item-sup\">\r\n            <ng-container *ngTemplateOutlet=\"supTemplate; context: {$implicit: item.sup,index: i}\">\r\n            </ng-container>\r\n        </section>\r\n\r\n        <ng-template #defaultTemplate>\r\n            <ng-container *ngIf=\"isSuperScript(item)\">\r\n                <span class=\"ti3-btn-item-sup\" [ngClass]=\"[item.sup.class]\">{{item.sup.text}}</span>\r\n                <!-- \u8FD9\u4E2Aspan\u662F\u4E3A\u4E86\u5728\u6709\u89D2\u6807\u7684\u573A\u666F\u4E0B\u80FD\u89E3\u6790icon\uFF0C\u6240\u4EE5\u4E0D\u663E\u793A -->\r\n                <span class=\"ti3-icon\" style=\"display: none;\"></span>\r\n            </ng-container>\r\n        </ng-template>\r\n\r\n        <span class=\"ti3-btn-multi-selection-icon\" *ngIf=\"multiple && setActiveClass(item)\">\r\n            <span class=\"ti3-icon ti3-icon-checkmark\"></span>\r\n        </span>\r\n</div>\r\n</span>",
                host: {
                    '[class.ti3-button-group-bottom-space]': 'multiline'
                },
                providers: [TiFormComponent.getValueAccessor(TiButtongroupComponent)],
                styles: ["::ng-deep :root{--ti-button-enough-space-padding:20px;--ti-button-insufficient-space-padding:8px;--ti-button-item-small-padding:20px;--ti-button-multi-selection-maxwidth:300px;--ti-button-sup-height:16px}:host[disabled] .ti3-btn-item-container.ti3-active .ti3-btn-item-radio{background-color:var(--ti-button-group-bg-color-active-disabled);color:var(--ti-button-group-text-color-disabled)}.ti3-btn-item-container{display:inline-block;position:relative}.ti3-btn-item-container .ti3-btn-item-sup{color:var(--ti-common-color-text-white);font-size:var(--ti-common-font-size-base);height:var(--ti-button-sup-height);line-height:var(--ti-button-sup-height);min-width:var(--ti-button-sup-height);position:absolute;right:0;text-align:center;top:calc(-1*var(--ti-button-sup-height)/2)}.ti3-btn-item-container .ti3-btn-item.ti3-btn-item-checkbox{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container:last-child .ti3-btn-item.ti3-btn-item-radio{border-radius:0 var(--ti-button-group-border-radius) var(--ti-button-group-border-radius) 0}.ti3-btn-item-container:last-child .ti3-btn-item.ti3-btn-item-noBorder{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container:first-child .ti3-btn-item.ti3-btn-item-radio{border-radius:var(--ti-button-group-border-radius) 0 0 var(--ti-button-group-border-radius)}.ti3-btn-item-container:first-child .ti3-btn-item.ti3-btn-item-noBorder{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container.ti3-active .ti3-btn-item-radio{background-color:var(--ti-button-group-bg-color-active);color:var(--ti-button-group-text-color-active);transition:background .25s,color .25s}.ti3-btn-item-container.ti3-active .ti3-btn-item-radio[disabled]{background-color:var(--ti-button-group-bg-color-active-disabled);color:var(--ti-button-group-text-color-disabled)}.ti3-btn-item-container .ti3-btn-item[disabled]{background-color:var(--ti-button-group-bg-color-disabled);border-color:var(--ti-button-group-bg-color-disabled);color:var(--ti-button-group-text-color-disabled);cursor:not-allowed}.ti3-btn-item-container .ti3-btn-item[disabled].ti3-btn-item-noBorder{background-color:var(--ti-common-color-bg-white-normal)}.ti3-btn-checkbox-enough-space{margin-right:var(--ti-common-space-2x)}.ti3-btn-checkbox-enough-space:last-child{margin-right:0}.ti3-btn-checkbox-enough-space .ti3-btn-item.ti3-btn-item-checkbox{padding:0 var(--ti-button-enough-space-padding)}.ti3-btn-checkbox-deficient-space{margin-right:var(--ti-common-space-2x)}.ti3-btn-checkbox-deficient-space:last-child{margin-right:0}.ti3-btn-checkbox-deficient-space .ti3-btn-item.ti3-btn-item-checkbox{padding:0 var(--ti-button-insufficient-space-padding)}.ti3-btn-item{-ms-box-sizing:border-box;background-color:var(--ti-button-group-bg-color);border:1px solid var(--ti-button-group-border-color);box-sizing:border-box;color:var(--ti-button-group-text-color);cursor:pointer;display:inline-block;height:var(--ti-button-group-height);line-height:calc(var(--ti-button-group-height) - 2px);max-width:var(--ti-button-multi-selection-maxwidth);position:relative;text-align:center;transition:border-color .15s ease-in,background .15s ease-in;vertical-align:middle;white-space:nowrap}.ti3-btn-item.ti3-btn-item-radio{border:none;line-height:var(--ti-button-group-height);padding:0 30px}.ti3-btn-item-text{display:inline-block;overflow:hidden;text-overflow:ellipsis;vertical-align:top;white-space:nowrap;width:100%}.ti3-btn-item-small .ti3-btn-item{height:var(--ti-button-group-height-small);line-height:var(--ti-button-group-height-small);padding:0 var(--ti-button-item-small-padding)}.ti3-btn-item-container:not(.ti3-active) .ti3-btn-item:not([disabled]):focus,.ti3-btn-item-container:not(.ti3-active) .ti3-btn-item:not([disabled]):hover{background-color:var(--ti-button-group-bg-color-hover);border-color:var(--ti-button-group-border-color-hover);color:var(--ti-button-group-text-color-hover);transition:border-color .2s,background .2s}.ti3-btn-item:before{background:var(--ti-button-group-border-left-color);content:\"\";height:100%;left:0;position:absolute;top:0}.ti3-btn-item.ti3-btn-item-checkbox:before{width:0}.ti3-btn-item.ti3-btn-item-radio:after,.ti3-btn-item.ti3-btn-item-radio:before{width:1px}.ti3-btn-item-container:first-child .ti3-btn-item:before{display:none}.ti3-btn-item:after{background:var(--ti-button-group-border-left-color);content:\"\";height:100%;position:absolute;right:0;top:0}.ti3-btn-item.ti3-btn-item-checkbox:after{width:0}.ti3-btn-item-container:last-child .ti3-btn-item:after{display:none}.ti3-btn-item-container.ti3-active .ti3-btn-item{border-color:var(--ti-button-group-border-color-active)}.ti3-btn-item-container.ti3-active .ti3-btn-item:after,.ti3-btn-item-container.ti3-active .ti3-btn-item:before{background:var(--ti-common-color-bg-white-normal)}.ti3-btn-item-noBorder.ti3-btn-item{background-color:transparent;border-radius:var(--ti-button-group-border-radius);padding:0 var(--ti-button-item-small-padding)}.ti3-btn-item-noBorder.ti3-btn-item:hover{background-color:var(--ti-button-group-bg-color-hover)}.ti3-btn-item-noBorder.ti3-btn-item[disabled]{border:none}.ti3-btn-item-noBorder.ti3-btn-item.ti3-btn-item-radio:after,.ti3-btn-item-noBorder.ti3-btn-item.ti3-btn-item-radio:before{width:0}.ti3-btn-multi-selection-icon{border-bottom:16px solid transparent;border-right:16px solid var(--ti-button-group-border-color-active);color:#fff;display:inline-block;font-size:12px;height:0;position:absolute;right:1px;top:1px;width:0}.ti3-btn-multi-selection-icon .ti3-icon-checkmark{position:relative;right:-5px;top:-2px}:host.ti3-button-group-bottom-space .ti3-btn-item-container{margin-bottom:var(--ti-button-group-space-bottom)}"]
            },] }
];
TiButtongroupComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: IterableDiffers }
];
TiButtongroupComponent.propDecorators = {
    items: [{ type: Input }],
    activeClass: [{ type: Input }],
    minWidth: [{ type: Input }],
    type: [{ type: Input }],
    multiple: [{ type: Input }],
    deselectable: [{ type: Input }],
    multiline: [{ type: Input }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    supTemplate: [{ type: ContentChild, args: ['sup', /* TODO: add static flag */ { static: true },] }],
    btns: [{ type: ViewChildren, args: ['btn',] }]
};

class TiButtongroupModule {
}
TiButtongroupModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiTipModule,
                    TiOutlineModule
                ],
                exports: [
                    TiButtongroupComponent
                ],
                declarations: [
                    TiButtongroupComponent
                ]
            },] }
];

/**
 * Checkbox组件，尽管这是一个组件，但使用方法有点像属性指令。主要功能为设置某一条件是否被选中。
 *
 * Checkbox组件完全基于原生input checkbox实现，
 *
 * 可以使用Angular针对原生Checkbox提供的所有指令，包括：disabled, model, click等，
 *
 * 但是要记得在input中添加TinyUI提供的tiCheckbox属性。
 *
 * <example-url>../tiny3demo/#/checkbox/checkbox-all</example-url>
 */
class TiCheckboxComponent extends TiRadioBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 问题一：浏览器兼容性问题：用angular提供的indeterminate属性设置半选，在谷歌下全部正常显示。
         * 在火狐和IE下，checked=true 和indeterminate=true同时存在时，半选样式存在问题，不知道是否和tiny组件的css样式写法有关。
         * 为了统一逻辑和预测，checkgroup和tree组件内部本应该这样使用：置indeterminate=true时，同时会置checked = false
         * 但是，暂时tree组件没有这样做，由TiCheckboxComponent来纠错。
         * TiCheckboxComponent补充效果：tree组件/业务用户，置indeterminate=true时，组件自身会置checked = false
         * 问题二：浏览器兼容性问题：Chrome/Firefox半选点击后变为全选，checked状态改变。IE半选点击后变为不选，checked状态未改变，所以没有通知change事件。
         * 但checkgroup需要change事件去维护子选项
         * TiCheckboxComponent IE补充效果：监听IE的click，当indeterminate从true变为false时，组件会置checked = false，并通知change事件。
         */
        this.lastIndeterminate = undefined;
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        // 补充效果：tree组件/业务用户，置indeterminate=true时，组件自身会置checked = false
        if (this.nativeElement.indeterminate) {
            this.nativeElement.checked = false;
        }
        this.lastIndeterminate = this.nativeElement.indeterminate;
    }
    /**
     * @ignore
     * IE补充效果：监听IE的click，当indeterminate从true变为false时，组件会置checked = false，并通知change事件。
     */
    onHostClick(event) {
        if (TiBrowser.isIE() && this.lastIndeterminate && !this.nativeElement.indeterminate) {
            this.checked(true);
        }
    }
    /**
     * @ignore
     * 设置checked属性，indeterminate，同时可能触发change事件。
     * 以后可以考虑开放这个接口，给用户调用
     * @protected
     * @param checked true/false/半选   半选用'indeterminate'或null
     */
    checked(checked) {
        const lastChecked = this.nativeElement.checked;
        const lastIndeterminate = (this.nativeElement.indeterminate === true) ? true : false; // 将undefined也转为false。
        switch (checked) {
            case true: // 全选
                this.nativeElement.checked = true;
                this.nativeElement.indeterminate = false;
                break;
            case false: // 全不选
                this.nativeElement.checked = false;
                this.nativeElement.indeterminate = false;
                break;
            case null: // 半选
            case 'indeterminate': // 半选
                this.nativeElement.checked = false; // TODO: 为了保证IE下点击半选后，变为全选，这里设false。未验证。
                this.nativeElement.indeterminate = true;
                break;
            default: // 不会走到这里。
                TiLog.error('setChecked(),switch default, can not reach code');
                break;
        }
        // indeterminate初始时为undefined。
        if (this.nativeElement.checked !== lastChecked || this.nativeElement.indeterminate !== lastIndeterminate) {
            Util.trigger(this.nativeElement, 'change'); // 必须主动触发change事件，否则ngModel不更新。也走不到change回调。
        }
    }
}
TiCheckboxComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiCheckbox]',
                template: "<!--Tiny3\u4F18\u5316\uFF1A\u51CF\u5C11label\u5D4C\u5957\uFF0C\u53BB\u9664\u5185\u5C42label-->\r\n<label #labelRef class='ti3-checkbox' [for]='id'  [id]=\"appendId('checkbox')\">\r\n    <!-- \u517C\u5BB9IE11\u6DFB\u52A0spacebar\u4E8B\u4EF6 -->\r\n    <span #proxyRef class='ti3-checkbox-skin ti3-icon ti3-icon-checkmark' tiOutline\r\n        (keydown.spacebar)=\"onSpaceKeydown($event)\"  (keyup.spacebar)=\"onSpaceKeyup($event)\"\r\n        (keydown.space)=\"onSpaceKeydown($event)\"  (keyup.space)=\"onSpaceKeyup($event)\"></span>\r\n    <span class='ti3-checkbox-label' [id]=\"appendId('label')\">{{label}}</span>\r\n</label>",
                styles: [":hostinput[type=checkbox][tiCheckbox]{display:none!important}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:inline-block;font-weight:400;line-height:1em;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{-ms-box-sizing:border-box;background-color:var(--ti-checkbox-bg-color);border:1px solid var(--ti-checkbox-border-color);border-collapse:separate;border-radius:2px;box-sizing:border-box;color:transparent;display:inline-block;height:var(--ti-checkbox-size);line-height:var(--ti-checkbox-mark-size);margin-bottom:0;margin-right:var(--ti-checkbox-label-right-space);position:relative;text-align:center;transition:background-color .15s,border-color .15s;vertical-align:middle;width:var(--ti-checkbox-size)}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-label{-ms-user-select:none;-webkit-user-select:none;color:var(--ti-checkbox-label-color);display:inline;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-checked);border-color:var(--ti-checkbox-border-color-checked);color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-bg-color-checked-hover);border-color:var(--ti-checkbox-bg-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-checked-active);border-color:var(--ti-checkbox-bg-color-checked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:hover{border-color:var(--ti-checkbox-border-color-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-unchecked-active);border-color:var(--ti-checkbox-border-color-unchecked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-partial-color-checked);border-color:var(--ti-checkbox-partial-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-partial-color-checked-hover);border-color:var(--ti-checkbox-partial-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox{cursor:not-allowed}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-label-color-checked);outline:none}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-label{color:var(--ti-checkbox-label-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-checked-disabled);color:var(--ti-checkbox-mark-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:not(:checked)+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-unchecked-disabled);color:transparent}:hostinput[type=checkbox][tiCheckbox][disabled]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-partial-color-checked-disabled)}:hostinput[type=checkbox][tiCheckbox]:checked+.ti3-checkbox .ti3-checkbox-skin:before{-ms-box-sizing:border-box;border-style:solid;border-width:0 2px 2px 0;box-sizing:border-box;content:\" \";display:table;height:9px;left:21%;position:absolute;top:50%;transform:rotate(45deg) translate(-55%,-55%) scale(1);width:7px}:hostinput[type=checkbox][tiCheckbox]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{border-radius:1px;content:\"\";height:var(--ti-checkbox-partial-center-size);left:4px;position:absolute;top:4px;width:var(--ti-checkbox-partial-center-size)}@keyframes rect-selectedAnimate{0%{transform:scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:scale(1);transform-origin:center}}@keyframes tick-selectedAnimate{0%{transform:rotate(45deg) translate(-55%,-55%) scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:rotate(45deg) translate(-55%,-55%) scale(1);transform-origin:center}}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-icon-checkmark:before{animation:tick-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):indeterminate+.ti3-checkbox .ti3-icon-checkmark:before{animation:rect-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-checkbox-skin:hover{transition:border-color .2s var(--ti-timing-function-default),background-color .2s var(--ti-timing-function-default)}"]
            },] }
];
TiCheckboxComponent.propDecorators = {
    onHostClick: [{ type: HostListener, args: ['click', ['$event'],] }]
};

class TiCheckboxModule {
}
TiCheckboxModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiIconModule,
                    TiOutlineModule
                ],
                exports: [TiCheckboxComponent],
                declarations: [TiCheckboxComponent]
            },] }
];

/**
 * Checkitem多选选项组件，尽管这是一个组件，使用时像属性指令。
 *
 */
class TiCheckitemComponent extends TiCheckboxComponent {
    constructor(hostRef, renderer, iterableDiffers) {
        // 是因为group item两个子类都用到differs，所以放在父类这里。
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.iterableDiffers = iterableDiffers;
        this.globeCheckedMapObserverItemFn = (item, value, isAdd, from) => {
            if (from !== this && item === this.item && isAdd) {
                // 从全局同步过来的，可能是半选
                const lastChecked = this.nativeElement.checked;
                const lastIndeterminate = (this.nativeElement.indeterminate === true) ? true : false; // 将undefined也转为false。
                this.nativeElement.checked = (value === true);
                this.nativeElement.indeterminate = (value === null);
                if (this.nativeElement.checked !== lastChecked || this.nativeElement.indeterminate !== lastIndeterminate) {
                    Util.trigger(this.nativeElement, 'change'); // 必须主动触发change事件，否则ngModel不更新。
                }
            }
        };
    }
    /**
     * @ignore
     * 监听change事件，会多触发一次DoCheck。 //TODO: 不让这条HostListener('change', ['$event'])在文档显示
     * @param checked
     * @returns
     */
    onHostChange(checked) {
        // item checked同步到globeCheckedSet
        if (!this.item) {
            return;
        }
        this.nativeElement.checked ?
            TiCheckitemComponent.globeCheckedMap.set(this.item, true, this) :
            this.nativeElement.indeterminate ?
                TiCheckitemComponent.globeCheckedMap.set(this.item, null, this) :
                TiCheckitemComponent.globeCheckedMap.set(this.item, false, this);
        // item checked同步到beCheckedSet
        if (this.beCheckedSet) {
            const value = this.getValue(this.item);
            this.nativeElement.checked ? this.beCheckedSet.add(value) : this.beCheckedSet.delete(value);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        this.initBeCheckedSet();
        if (!this.item) { // 用户忘了设定，或者继承的子类无需设定
            return;
        }
        this.initGlobeCheckedSetItem();
        this.setCheckedItem();
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 外部直接给item重新赋值了。
        if (changes['item'] && !changes['item'].isFirstChange()) {
            // 删除已使用的静态资源。当然，这里有可能误删除。因为此item还在别处使用。   全选按钮那里，有纠正机制。
            this.deleteGlobeRef(changes['item'].previousValue);
            // 添加新的资源
            this.setCheckedItem();
            // 重新设置disabled
            this.setDisabledStateGlobe();
        }
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        // 删除已使用的静态资源
        this.deleteGlobeRef(this.item);
        // 解除监听
        TiCheckitemComponent.globeCheckedMap.removeObserver(this.globeCheckedMapObserverItemFn);
    }
    // 删除已使用的静态资源
    deleteGlobeRef(item) {
        TiCheckitemComponent.globeCheckedMap.delete(this.item);
        TiCheckitemComponent.globeDisabledSet.delete(this.item);
    }
    ngDoCheck() {
        super.ngDoCheck();
        if (!this.beCheckedSet) {
            return;
        }
        const beCheckedsChanges = this.beCheckedsDiffer.diff(this.beCheckeds);
        if (beCheckedsChanges) { // beCheckeds同步到beCheckedSet
            beCheckedsChanges.forEachAddedItem(record => {
                this.beCheckedSet.add(record.item);
            });
            beCheckedsChanges.forEachRemovedItem(record => {
                this.beCheckedSet.delete(record.item);
            });
        }
    }
    initBeCheckedSet() {
        if (!this.beCheckeds) {
            return;
        }
        this.beCheckedsDiffer = this.iterableDiffers.find(this.beCheckeds).create(null);
        this.beCheckedSet = new ObservableSet(this.beCheckeds); // TODO:写共用的Array/Set转Set
        this.beCheckedSet.addObserver((item, isAdd) => {
            // beCheckedSet的变化同步到beCheckeds
            if (this.beCheckeds instanceof Set) {
                isAdd ? this.beCheckeds.add(item) : this.beCheckeds.delete(item);
            }
            else if (this.beCheckeds instanceof Array) { // TODO:写公用的Array remove函数
                const index = this.beCheckeds.indexOf(item);
                if (isAdd && index === -1) {
                    this.beCheckeds.push(item);
                }
                else if (!isAdd && index !== -1) {
                    this.beCheckeds.splice(index, 1);
                }
            }
            // checkedSet通知到item checked
            this.setCheckedItem();
        });
    }
    /**
     * globeCheckedSet同步到item checked
     */
    initGlobeCheckedSetItem() {
        // 初始化时，不往globeCheckedSet放值，是因为group优先级更高。
        TiCheckitemComponent.globeCheckedMap.addObserver(this.globeCheckedMapObserverItemFn);
    }
    setCheckedItem() {
        if (!this.item) {
            return;
        }
        const lastChecked = this.nativeElement.checked;
        const value = this.getValue(this.item);
        // 如果beCheckeds存在，优先级更高，以beCheckeds为准。
        this.nativeElement.checked = this.beCheckedSet ? this.beCheckedSet.has(value) : TiCheckitemComponent.globeCheckedMap.get(this.item);
        // 这里应该不用考虑半选吧？
        if (this.nativeElement.checked !== lastChecked) {
            Util.trigger(this.nativeElement, 'change'); // 必须主动触发change事件，否则ngModel不更新。
        }
    }
    /**
     * @ignore
     */
    setDisabledState(isDisabled) {
        super.setDisabledState(isDisabled);
        this.setDisabledStateGlobe();
    }
    setDisabledStateGlobe() {
        this.nativeElement.disabled ? TiCheckitemComponent.globeDisabledSet.add(this.item)
            : TiCheckitemComponent.globeDisabledSet.delete(this.item);
    }
    /**
     * 输入：某个数据项
     * 输出：当有valueKey,返回值基于valueKey；当没有valueKey时，返回输入值
     */
    getValue(item) {
        return this.valueKey ? item[this.valueKey] : item;
    }
}
/**
 * @ignore
 * 全局item数据(多个group的item都在这里)
 */
TiCheckitemComponent.globeCheckedMap = new ObservableMap();
/**
 * @ignore
 * 全局灰化禁用数据(多个group的item都在这里)
 */
TiCheckitemComponent.globeDisabledSet = new ObservableSet();
TiCheckitemComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiCheckitem]',
                template: "<!--Tiny3\u4F18\u5316\uFF1A\u51CF\u5C11label\u5D4C\u5957\uFF0C\u53BB\u9664\u5185\u5C42label-->\r\n<label #labelRef class='ti3-checkbox' [for]='id'  [id]=\"appendId('checkbox')\">\r\n    <!-- \u517C\u5BB9IE11\u6DFB\u52A0spacebar\u4E8B\u4EF6 -->\r\n    <span #proxyRef class='ti3-checkbox-skin ti3-icon ti3-icon-checkmark' tiOutline\r\n        (keydown.spacebar)=\"onSpaceKeydown($event)\"  (keyup.spacebar)=\"onSpaceKeyup($event)\"\r\n        (keydown.space)=\"onSpaceKeydown($event)\"  (keyup.space)=\"onSpaceKeyup($event)\"></span>\r\n    <span class='ti3-checkbox-label' [id]=\"appendId('label')\">{{label}}</span>\r\n</label>",
                // tslint:disable-next-line:use-host-property-decorator
                host: {
                    'tiCheckbox': '' // 给宿主元素添加tiCheckbox属性，实现定制样式
                },
                styles: [":hostinput[type=checkbox][tiCheckbox]{display:none!important}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:inline-block;font-weight:400;line-height:1em;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{-ms-box-sizing:border-box;background-color:var(--ti-checkbox-bg-color);border:1px solid var(--ti-checkbox-border-color);border-collapse:separate;border-radius:2px;box-sizing:border-box;color:transparent;display:inline-block;height:var(--ti-checkbox-size);line-height:var(--ti-checkbox-mark-size);margin-bottom:0;margin-right:var(--ti-checkbox-label-right-space);position:relative;text-align:center;transition:background-color .15s,border-color .15s;vertical-align:middle;width:var(--ti-checkbox-size)}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-label{-ms-user-select:none;-webkit-user-select:none;color:var(--ti-checkbox-label-color);display:inline;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-checked);border-color:var(--ti-checkbox-border-color-checked);color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-bg-color-checked-hover);border-color:var(--ti-checkbox-bg-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-checked-active);border-color:var(--ti-checkbox-bg-color-checked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:hover{border-color:var(--ti-checkbox-border-color-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-unchecked-active);border-color:var(--ti-checkbox-border-color-unchecked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-partial-color-checked);border-color:var(--ti-checkbox-partial-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-partial-color-checked-hover);border-color:var(--ti-checkbox-partial-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox{cursor:not-allowed}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-label-color-checked);outline:none}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-label{color:var(--ti-checkbox-label-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-checked-disabled);color:var(--ti-checkbox-mark-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:not(:checked)+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-unchecked-disabled);color:transparent}:hostinput[type=checkbox][tiCheckbox][disabled]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-partial-color-checked-disabled)}:hostinput[type=checkbox][tiCheckbox]:checked+.ti3-checkbox .ti3-checkbox-skin:before{-ms-box-sizing:border-box;border-style:solid;border-width:0 2px 2px 0;box-sizing:border-box;content:\" \";display:table;height:9px;left:21%;position:absolute;top:50%;transform:rotate(45deg) translate(-55%,-55%) scale(1);width:7px}:hostinput[type=checkbox][tiCheckbox]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{border-radius:1px;content:\"\";height:var(--ti-checkbox-partial-center-size);left:4px;position:absolute;top:4px;width:var(--ti-checkbox-partial-center-size)}@keyframes rect-selectedAnimate{0%{transform:scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:scale(1);transform-origin:center}}@keyframes tick-selectedAnimate{0%{transform:rotate(45deg) translate(-55%,-55%) scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:rotate(45deg) translate(-55%,-55%) scale(1);transform-origin:center}}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-icon-checkmark:before{animation:tick-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):indeterminate+.ti3-checkbox .ti3-icon-checkmark:before{animation:rect-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-checkbox-skin:hover{transition:border-color .2s var(--ti-timing-function-default),background-color .2s var(--ti-timing-function-default)}"]
            },] }
];
TiCheckitemComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: IterableDiffers }
];
TiCheckitemComponent.propDecorators = {
    item: [{ type: Input }],
    valueKey: [{ type: Input }],
    beCheckeds: [{ type: Input }],
    onHostChange: [{ type: HostListener, args: ['change', ['$event'],] }]
};

// TODO: 有些用户提出，响应式表单里，checkgroup value没有绑定已选中数据，不方便。
/**
 * Checkgroup全选框组件，主要功能为从一数据集合中选择某几条数据，与多选组件(Select multiple)功能相同，只是数据规模和视觉呈现不同。
 *
 * 复选框组通常由一个全选框和多个子复选框构成。
 *
 * <example-url>../tiny3demo/#/checkgroup/checkgroup-all</example-url>
 */
class TiCheckgroupComponent extends TiCheckitemComponent {
    constructor() {
        super(...arguments);
        /**
         * 已选中数据集，双向绑定
         */
        this.checkedsChange = new EventEmitter();
        this.disabledSet = new ObservableSet(); // 储存本组所有禁用的子选项
        /**
         * 【6】globeCheckedMap→checkedMap
         */
        this.globeCheckedMapObserverFn = (item, value, isAdd, from) => {
            if (from !== this.checkedMap && this.items.includes(item)) {
                // 同步globe的改变到本地
                if (isAdd) {
                    this.checkedMap.set(item, value, TiCheckitemComponent.globeCheckedMap);
                }
                else {
                    // !isAdd. 如果globe删除了某项，但这项属于自己的子项，那么把这一项添加回globe。（场景：子项item动态改变，并未销毁，却触发了全局delete）
                    TiCheckitemComponent.globeCheckedMap.set(item, this.checkedMap.get(item), this.checkedMap);
                }
            }
        };
        /**
         * 【7】globeDisabledSet→disabledSet
         */
        this.globeDisabledSetObserverFn = (item, isAdd) => {
            if (isAdd && this.items.includes(item)) {
                this.disabledSet.add(item);
            }
            else if (!isAdd) {
                this.disabledSet.delete(item);
            }
        };
    }
    /**
     * @ignore
     * 监听change事件，会多触发一次DoCheck。
     * @param checked 原生change事件选中状态：全选，全不选
     */
    onHostChange(checked) {
        super.onHostChange(checked);
        if (this.nativeElement.checked === true) {
            // 全选
            this.checkAll(true);
        }
        else if (this.nativeElement.indeterminate === true) {
            // 半选情况，不作处理。
        }
        else {
            // 全不选
            this.checkAll(false);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        this.initCheckedMap();
        this.initGlobeCheckedMap();
        this.initDisabledSet();
        this.setChecked();
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        // 解除监听
        TiCheckitemComponent.globeCheckedMap.removeObserver(this.globeCheckedMapObserverFn);
        TiCheckitemComponent.globeDisabledSet.removeObserver(this.globeDisabledSetObserverFn);
    }
    ngDoCheck() {
        super.ngDoCheck();
        // 【1】[items][checkeds] →  checkedMap
        const itemsChanges = this.itemsDiffer.diff(this.items);
        const checkedsChanges = this.checkedsDiffer.diff(this.checkeds);
        if (checkedsChanges) {
            checkedsChanges.forEachAddedItem(record => {
                const item = this.getItem(record.item);
                if (this.items.includes(item)) {
                    this.checkedMap.set(item, true, this.checkeds);
                }
                else {
                    // 正常不会走到这里
                    this.checkedMap.delete(item, this.checkeds);
                    // 表格需求：允许用户设置的checkeds，范围大于items。所以会走到这里
                    // TiLog.warn('checkeds new item is not in items');
                }
            });
            checkedsChanges.forEachRemovedItem(record => {
                const item = this.getItem(record.item);
                if (this.items.includes(item)) {
                    if (this.checkedMap.get(item) === true || this.checkedMap.get(item) === undefined) {
                        this.checkedMap.set(item, false, this.checkeds);
                    }
                }
                else {
                    this.checkedMap.delete(item, this.checkeds);
                }
                // 强调：如果子选项是半选状态null，就不再置false了。
                // 规律：父节点，不会下达让子节点由null到false的指令。父节点，只会下达让节点由null到true的指令。
                // 注意：在树型结构中，外界@Input checkeds不能强制指定某个半选节点，变为不选。（checkeds中去除某个节点，此节点保持半选不变。）
            });
        }
        // 将每次的变化，合入到全局变量中。因为多出来的项目，可能是刚才使用过的，所以需要重新赋值
        if (itemsChanges) {
            itemsChanges.forEachAddedItem(record => {
                // Map中没有此项，会返回undefined
                if (this.checkedMap.has(record.item)) {
                    //  初始化为什么会走到这里？本以为没有代码可以走到这里
                    // 【5】checkedMap→globeCheckedMap
                    TiCheckitemComponent.globeCheckedMap.set(record.item, this.checkedMap.get(record.item), this.checkedMap);
                }
                else {
                    // 表格需求：checkeds允许范围比items更大。所以，根据checkeds来给checkedMap设置。
                    let isChecked = false;
                    const value = this.getValue(record.item);
                    if (this.checkeds instanceof Array) {
                        isChecked = this.checkeds.includes(value);
                    }
                    else if (this.checkeds instanceof Set) {
                        isChecked = this.checkeds.has(value);
                    }
                    this.checkedMap.set(record.item, isChecked, this.checkeds);
                    if (TiCheckitemComponent.globeDisabledSet.has(record.item)) {
                        this.disabledSet.add(record.item);
                    }
                    else {
                        this.disabledSet.delete(record.item);
                    }
                }
            });
            itemsChanges.forEachRemovedItem(record => {
                this.checkedMap.delete(record.item, this.checkeds); // from标志从checkeds来，所以词条checkedMap变化，并未同步到checkeds。
                // 注意：会造成checkeds范围大于items
                this.disabledSet.delete(record.item);
            });
        }
        if (checkedsChanges || itemsChanges) {
            // 【3】checkedMap →  Group checked
            this.setChecked(); // 设置全选状态。本地checkedMap变化，元素很多，但只初始化一次。
        }
        // 发出事件：checkeds改变
        if (checkedsChanges) {
            // TODO：后面可能要做，更新引用。
            // 一旦更新引用，就得要求所有用户双向绑定[(checkeds)]。但旧版demo里是单向绑定，对一些遗留用户不友好。
            // tslint:disable-next-line:prefer-conditional-expression
            // if (this.checkeds instanceof Array) {
            //     this.checkeds = this.checkeds.concat([]); // 更新引用
            // } else {
            //     this.checkeds = new Set(Array.from(this.checkeds)); // 更新引用
            // }
            /**
             * checkedsChange 回调中同步修改其他数据会报错，影响正常功能，所以需要延时，
             * 为什么不使用setTimout而使用Promise，Promise.then 是微任务，比setTimout(宏任务)先执行，想尽量早emit事件
             * 宏任务和微任务：https://juejin.cn/post/6844903657264136200
             * issue: https://git.huawei.com/WCC/Tiny3/issues/1588
             * 扩展：ngDoCheck,ngAfterViewChecked中emit事件，在事件回调中同步修改数据，都存在同样问题。
             */
            Promise.resolve(null).then(() => {
                this.checkedsChange.emit(this.checkeds);
            });
        }
    }
    initCheckedMap() {
        // 监听items和checkeds
        this.itemsDiffer = this.iterableDiffers.find(this.items).create(null);
        this.checkedsDiffer = this.iterableDiffers.find(this.checkeds).create(null);
        this.checkedMap = new ObservableMap();
        this.items.forEach(// 【1】[items][checkeds] →  checkedMap
        // 【1】[items][checkeds] →  checkedMap
        item => {
            let isChecked = false;
            const value = this.getValue(item);
            if (this.checkeds instanceof Array) {
                isChecked = this.checkeds.includes(value);
            }
            else if (this.checkeds instanceof Set) {
                isChecked = this.checkeds.has(value);
            }
            if (isChecked) { // 选中态，直接添加
                this.checkedMap.set(item, true, this.checkeds);
            }
            else if (this.checkedMap.get(item) === true || this.checkedMap.get(item) === undefined) { // 初始化
                this.checkedMap.set(item, false, this.checkeds);
                // 强调：如果子选项是半选状态null，就不再置false了。
                // 规律：父节点，不会下达让子节点由null到false的指令。父节点，只会下达让节点由null到true的指令。
                // 注意：在树型结构中，外界@Input checkeds不能强制指定某个半选节点，变为不选。（checkeds中去除某个节点，此节点保持半选不变。）
            }
        });
        this.checkedMap.addObserver((item, value, isAdd, from) => {
            // 有多个来源：chekceds，（items），checkall，globe
            // 不是从checkeds来的，就要同步到chekeds
            if (from !== this.checkeds) {
                // 【2】checkedMap- >[checkeds]
                const isChecked = isAdd && this.checkedMap.get(item);
                const newItem = this.getValue(item);
                if (this.checkeds instanceof Set) {
                    isChecked ? this.checkeds.add(newItem) : this.checkeds.delete(item);
                }
                else if (this.checkeds instanceof Array) { // TODO:写公用的Array remove函数
                    const index = this.checkeds.indexOf(newItem);
                    if (isChecked && index === -1) {
                        this.checkeds.push(newItem);
                    }
                    else if (!isChecked && index !== -1) {
                        this.checkeds.splice(index, 1);
                    }
                }
            }
            // 不是从全局来的，就要同步到全球。
            if (from !== TiCheckitemComponent.globeCheckedMap) {
                // 【5】checkedMap→globeCheckedMap
                TiCheckitemComponent.globeCheckedMap.set(item, value, this.checkedMap);
            }
            // 从全局来的，需要更新全选状态。（树形结构层级较多，需要这个逻辑）
            if (from === TiCheckitemComponent.globeCheckedMap) {
                // 【3】checkedMap →  Group checked
                this.setChecked();
            }
        });
    }
    initGlobeCheckedMap() {
        // checkedMap以group端优先，disabled以item端优先。
        // checkedMap同步加入到globeCheckedMap
        this.checkedMap.getMap()
            .forEach(item => {
            // 【5】checkedMap→globeCheckedMap
            TiCheckitemComponent.globeCheckedMap.set(item[0], item[1], this.checkedMap);
        });
        // 监听globecheckedMap
        TiCheckitemComponent.globeCheckedMap.addObserver(this.globeCheckedMapObserverFn);
    }
    initDisabledSet() {
        // 【7】globeDisabledSet→disabledSet，并监听
        this.items.forEach(item => {
            TiCheckitemComponent.globeDisabledSet.has(item) ?
                this.disabledSet.add(item) : this.disabledSet.delete(item);
        });
        // 【7】globeDisabledSet→disabledSet，监听globeDisabledSet
        TiCheckitemComponent.globeDisabledSet.addObserver(this.globeDisabledSetObserverFn);
        // 【8】disabledSet→Group checked
        this.disabledSet.addObserver((item, isAdd) => {
            this.setChecked();
        });
    }
    /**
     * 设置本group全选框的状态 【3】checkedMap →  Group checked
     */
    setChecked() {
        this.checked(this.getCheckedStatus());
    }
    /**
     * 规则一：disabled状态的复选框不影响全选状态，所以需要将其从统计信息中过滤
     * 例如有3个复选框，前两个为选中状态，最后一个是disabled，则认为整体为全部选中状态
     * 所以无需关心disabled复选框的选中状态，只需关心非disabled状态即可
     * 规则二：但当子复选框全部是disabled状态时，将会影响全选的状态
     * @returns 全选：true，全不选：false，半选：null
     */
    getCheckedStatus() {
        if (this.items.length === 0) { // 情景零：没有选项
            return false;
        }
        // 用户可勾选项目数
        let checkedableNum = this.items.length - this.disabledSet.size;
        const isTotalCount = (this.disabledSet.size === 0 || checkedableNum === 0); // 全部可用，或者全部禁用。所有选项进入统计。
        if (checkedableNum === 0) { // 如果全部禁用，那么所有选项都计入统计。
            checkedableNum = this.items.length;
        }
        let checkedNum = 0; // 选中项数目（非禁用）
        let notCheckedNum = 0; // 未选项数目（非禁用）
        for (const item of this.items) {
            if (isTotalCount || !this.disabledSet.has(item)) { // 全部进入统计，或者未禁用项进入统计。
                switch (this.checkedMap.get(item)) {
                    case true:
                        checkedNum++;
                        break;
                    case false:
                        notCheckedNum++;
                        break;
                    case null:
                        return null; // 只要有一个子选项是半选，那么结果是半选。
                    default:
                        // 不会走到这里
                        TiLog.error('getCheckedStatus(),can not reach code, items item is not in checkedMap');
                        break;
                }
                if (checkedNum !== 0 && notCheckedNum !== 0) {
                    // 有选中，有不选中，所以半选。
                    return null; // 半选
                }
                else if (checkedNum === checkedableNum) {
                    return true;
                }
                else if (notCheckedNum === checkedableNum) {
                    return false;
                }
            }
        }
        // Logger.error('getCheckedStatus(),end, can not reach code,');
        return false;
    }
    /**
     *  设置全选框的状态值
     * 【4】Group checked →  checkedMap
     * @param checked
     */
    checkAll(checked) {
        this.items.forEach(item => {
            if (!this.disabledSet.has(item)) {
                // 【4】Group checked →  checkedMap
                this.checkedMap.set(item, checked, this.checkAll);
            }
        });
    }
    /**
     * 输出：得到整个item对象
     * @param value item对象或者数据的身份标识
     *
     */
    getItem(value) {
        for (const obj of this.items) {
            if (obj === value || obj[this.valueKey] === value) {
                return obj;
            }
        }
        return null;
    }
}
TiCheckgroupComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiCheckgroup]',
                template: "<!--Tiny3\u4F18\u5316\uFF1A\u51CF\u5C11label\u5D4C\u5957\uFF0C\u53BB\u9664\u5185\u5C42label-->\r\n<label #labelRef class='ti3-checkbox' [for]='id'  [id]=\"appendId('checkbox')\">\r\n    <!-- \u517C\u5BB9IE11\u6DFB\u52A0spacebar\u4E8B\u4EF6 -->\r\n    <span #proxyRef class='ti3-checkbox-skin ti3-icon ti3-icon-checkmark' tiOutline\r\n        (keydown.spacebar)=\"onSpaceKeydown($event)\"  (keyup.spacebar)=\"onSpaceKeyup($event)\"\r\n        (keydown.space)=\"onSpaceKeydown($event)\"  (keyup.space)=\"onSpaceKeyup($event)\"></span>\r\n    <span class='ti3-checkbox-label' [id]=\"appendId('label')\">{{label}}</span>\r\n</label>",
                // tslint:disable-next-line:use-host-property-decorator
                host: {
                    'tiCheckbox': '' // 给宿主元素添加tiCheckbox属性，实现定制样式
                },
                styles: [":hostinput[type=checkbox][tiCheckbox]{display:none!important}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:inline-block;font-weight:400;line-height:1em;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{-ms-box-sizing:border-box;background-color:var(--ti-checkbox-bg-color);border:1px solid var(--ti-checkbox-border-color);border-collapse:separate;border-radius:2px;box-sizing:border-box;color:transparent;display:inline-block;height:var(--ti-checkbox-size);line-height:var(--ti-checkbox-mark-size);margin-bottom:0;margin-right:var(--ti-checkbox-label-right-space);position:relative;text-align:center;transition:background-color .15s,border-color .15s;vertical-align:middle;width:var(--ti-checkbox-size)}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-label{-ms-user-select:none;-webkit-user-select:none;color:var(--ti-checkbox-label-color);display:inline;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-checked);border-color:var(--ti-checkbox-border-color-checked);color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-bg-color-checked-hover);border-color:var(--ti-checkbox-bg-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-checked-active);border-color:var(--ti-checkbox-bg-color-checked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:hover{border-color:var(--ti-checkbox-border-color-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-unchecked-active);border-color:var(--ti-checkbox-border-color-unchecked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-partial-color-checked);border-color:var(--ti-checkbox-partial-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-partial-color-checked-hover);border-color:var(--ti-checkbox-partial-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox{cursor:not-allowed}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-label-color-checked);outline:none}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-label{color:var(--ti-checkbox-label-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-checked-disabled);color:var(--ti-checkbox-mark-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:not(:checked)+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-unchecked-disabled);color:transparent}:hostinput[type=checkbox][tiCheckbox][disabled]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-partial-color-checked-disabled)}:hostinput[type=checkbox][tiCheckbox]:checked+.ti3-checkbox .ti3-checkbox-skin:before{-ms-box-sizing:border-box;border-style:solid;border-width:0 2px 2px 0;box-sizing:border-box;content:\" \";display:table;height:9px;left:21%;position:absolute;top:50%;transform:rotate(45deg) translate(-55%,-55%) scale(1);width:7px}:hostinput[type=checkbox][tiCheckbox]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{border-radius:1px;content:\"\";height:var(--ti-checkbox-partial-center-size);left:4px;position:absolute;top:4px;width:var(--ti-checkbox-partial-center-size)}@keyframes rect-selectedAnimate{0%{transform:scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:scale(1);transform-origin:center}}@keyframes tick-selectedAnimate{0%{transform:rotate(45deg) translate(-55%,-55%) scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:rotate(45deg) translate(-55%,-55%) scale(1);transform-origin:center}}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-icon-checkmark:before{animation:tick-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):indeterminate+.ti3-checkbox .ti3-icon-checkmark:before{animation:rect-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-checkbox-skin:hover{transition:border-color .2s var(--ti-timing-function-default),background-color .2s var(--ti-timing-function-default)}"]
            },] }
];
TiCheckgroupComponent.propDecorators = {
    items: [{ type: Input }],
    checkeds: [{ type: Input }],
    checkedsChange: [{ type: Output }],
    onHostChange: [{ type: HostListener, args: ['change', ['$event'],] }]
};
/*
需求：Group checked，Item checked，[(checkedSet)]三者其一改变，都要通知其他二者。所以采用中介者模式。

版本一：Tiny2,中介者是[(checkedSet)]，但要求Item也去绑定[(groupCheckedSet)]

                           Group checked    ←  disabledSet
                                     ↕                               ↑
[dataArray]         [checkedSet]            groupDisabledSet
                                     ↕                               ↑
                            Item checked             Item disabled

版本二：中介者是全局变量globeCheckedSet，不要求Item绑定其他变量。

                          Group checked   ←   disabledSet
[dataArray]                   ↕                              ↑
[(checkedSet)]↔globeCheckedSet     globeDisabledSet
                                     ↕                              ↑
                            Item checked           Item disabled

版本三：链条传递，不要求Item绑定其他变量。

                   Group checked       ←     disabledSet
                            ↕                                         ↑
[dataArray] [checkedSet]                               ↑
                            ↕                                         ↑
                   globeCheckedSet            globeDisabledSet
                            ↕                                         ↑
                    Item checked                  Item disabled

版本四：Tiny3, 链条传递，不要求Item绑定其他变量。但也可以绑定所属于组织选中变量。Array/Set兼容

                                    Group checked       ←     disabledSet
                                            ↕                                     ↑
            [checkeds] ↔  checkedSet                            ↑
                                            ↕                                     ↑
                                    globeCheckedSet            globeDisabledSet
                                             ↕                                     ↑
                                    Item checked                   Item disabled
                                             ↕
         [beCheckeds] ↔ beCheckedSet
版本五：Tiny3, 链条传递，不要求Item绑定其他变量。但也可以绑定所属于组织选中变量。Array/Set兼容。
兼容Tree树形结构，子节点也有可能是半选状态。
                                                                    8
                                    Group checked       ←     disabledSet
                             1>         3↑↓4                                 ↑
 [items][checkeds] ↔  checkedMap                           ↑
                            <2          5↓↑6                                  ↑7
                                    globeCheckedMap          globeDisabledSet
                                            ↓↑                                     ↑
                                    Item checked                    Item disabled
                                            ↓↑
         [beCheckeds] ↔ beCheckedSet
*/
/*
@Input支持Set<any>|Array<any>
方案一：每次使用时，都判断类型，调用不同方法。
方案二：@Input set时，给Array绑定上has()、add()、delete()方法，但是get size怎么绑定？
方案三：Set<any>|Array，赋值给新的Set。Tiny3采用
 */
/* TODO：Tiny3已去除此逻辑，推测Tiny3应该没有此Bug。等IE环境好了后，再测试。
  解决IE浏览器下的复选框半选状态BUG，
  bug单号：http://code.huawei.com/WCC/TinyPlus/issues/1397
  BUG表现：当复选框的状态为半选状态，
           点击复选框的时候IE浏览器会把复选框状态为  checked = false，
           而其他浏览器会直接变成checked = true,
  原因分析参考地址：https://github.com/jquery/jquery/issues/1698
                    http://www.xuebuyuan.com/1322692.html
  解决方案：绑定点击事件，手动更改checked状态，同时更新子复选框选中状态。
 */

class TiCheckgroupModule {
}
TiCheckgroupModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiIconModule,
                    TiOutlineModule
                ],
                exports: [TiCheckgroupComponent, TiCheckitemComponent],
                declarations: [TiCheckgroupComponent, TiCheckitemComponent]
            },] }
];

class TiOverflowServiceModule {
}
TiOverflowServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiRendererModule,
                    TiTipServiceModule
                ]
            },] }
];

/**
 * @ignore
 * 文本过长出...并tip提示配置项，使用该服务时需要引入模块TiOverflowServiceModule，该组件提供了两种使用方式:
 *
 * 1.服务方式（见如下说明）
 *
 * 2.指令方式：[TiOverflowDirective]{@link ../directives/TiOverflowDirective.html}
 *
 * <example-url>../tiny3demo/#/overflow/overflow-all</example-url>
 */
class TiOverflowService {
    constructor(rendererFactory, tiRenderer, tipService) {
        this.tiRenderer = tiRenderer;
        this.tipService = tipService;
        /* tslint:disable:no-null-keyword */
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    /**
     * 生成tip提示方法
     * @param hostElement 文本过长的宿主对象
     * @param config overflow配置项
     * 返回 {destroy(): void} 销毁文本过长的tip提示，使用服务方式时，需要在宿主元素销毁时，通过调用该方法销毁文本过长的tip提示
     */
    create(hostElement, config) {
        this.tiRenderer.setStyles(hostElement, {
            whiteSpace: 'nowrap',
            textOverflow: 'ellipsis',
            overflow: 'hidden'
        });
        // 非法情况处理
        if (!Util.isElement(hostElement)) {
            TiLog.warn('overflow: hostEle type is not element');
            // 防止外部使用报错，此处做返回值处理
            return {
                destroy() { }
            };
        }
        // 如果该元素为inline元素时，宽度不生效会导致元素出...样式不生效，因此此处做处理
        // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle !== 'undefined' && getComputedStyle(hostElement).display === 'inline') {
            this.renderer.setStyle(hostElement, 'display', 'inline-block');
        }
        const tipInstance = this.generateTip(hostElement, config || {});
        return {
            destroy() {
                if (tipInstance) {
                    tipInstance.hide();
                }
            }
        };
    }
    /**
     * @ignore
     */
    isOverflow(element) {
        // 复制DOM，并计算元素宽度
        // 此处使用clone方式而不使用scrollWidth方式,是因为目前发现scrollWidth在IE下获取到的值有问题，不可作为文本溢出的判断条件
        const eleStyles = getComputedStyle(element);
        const cloneEle = element.cloneNode(true);
        this.tiRenderer.setStyles(cloneEle, {
            // 涉及内容字体的相关样式处理
            fontSize: eleStyles.fontSize,
            fontWeight: eleStyles.fontWeight,
            fontFamily: eleStyles.fontFamily,
            padding: eleStyles.padding,
            paddingLeft: eleStyles.paddingLeft,
            paddingRight: eleStyles.paddingRight,
            border: eleStyles.border,
            boxSizing: eleStyles.boxSizing,
            height: eleStyles.height,
            // 涉及宽度布局的相关样式处理
            maxWidth: 'none',
            width: 'auto',
            overflow: 'visible',
            display: 'inline-block',
            visibility: 'hidden',
            whiteSpace: 'nowrap',
            position: 'absolute',
            left: '-9999px',
            top: '-9999px'
        });
        this.renderer.appendChild(document.body, cloneEle);
        // 使用getBoundingClientRect而不使用getComputedStyle,是因为getComputedStyle在
        // 各浏览器获取到的宽度不一致（IE下取到的是内容宽度，而在Chrome和FF下取到的是整个元素宽度）。
        // IE下计算精度高(小数点后15位)，多数中文和数字或英文混排的文本计算出来的 maxWidth 和 textWidth
        // 由于精度高而导致有微小差距，从而影响了 isOverflow 的判断结果，从实际测试得来结论：保留两位小数能够保证判断结果更准确些。
        const maxWidth = parseFloat(element.getBoundingClientRect().width
            .toFixed(2));
        const textWidth = parseFloat(cloneEle.getBoundingClientRect().width
            .toFixed(2));
        // 此处没有使用angular的Renderer2是因为Renderer2.removeChild必须有变化检测才能在dom上生效，
        // 此处考虑到性能不触发变化检测，所以选择使用原生的removeChild方法。
        document.body.removeChild(cloneEle);
        return textWidth > maxWidth;
    }
    generateTip(element, options) {
        // 文本超长时，显示tip提示：
        // tip显示位置元素设置：默认为element
        const config = options || {};
        let hostEleConfig = config.tipElement;
        if (typeof hostEleConfig === 'function') {
            hostEleConfig = hostEleConfig(element);
        }
        const tipHostEle = hostEleConfig || element;
        return this.tipService.create(tipHostEle, {
            hostEleX: config.tipHostEleX,
            position: config.tipPosition,
            maxWidth: config.tipMaxWidth,
            trigger: 'mouse',
            showFn: () => {
                // tipContent 为空 或者 未溢出情况下，不显示tip
                // tipPosition设置为none是去除Select默认超长tip，改由template内容自定义tip
                if (config.tipPosition === 'none' || config.tipContent === '' || !this.isOverflow(element)) {
                    return;
                }
                // tip内容设置：默认为元素中的文本内容
                let tipContent = config.tipContent;
                if (Util.isUndefined(tipContent)) { // content可能为""，因此此处判断undefined而不使用||
                    tipContent = element.textContent;
                }
                return { content: tipContent };
            }
        });
    }
}
TiOverflowService.ɵprov = ɵɵdefineInjectable({ factory: function TiOverflowService_Factory() { return new TiOverflowService(ɵɵinject(RendererFactory2), ɵɵinject(TiRenderer), ɵɵinject(TiTipService)); }, token: TiOverflowService, providedIn: TiOverflowServiceModule });
TiOverflowService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiOverflowServiceModule
            },] }
];
TiOverflowService.ctorParameters = () => [
    { type: RendererFactory2 },
    { type: TiRenderer },
    { type: TiTipService }
];

/**
 * 超长情况下文本处理出...并tip提示
 *
 * <example-url>../tiny3demo/#/overflow/overflow-all</example-url>
 */
class TiOverflowDirective {
    constructor(ele, overflowService) {
        this.ele = ele;
        this.overflowService = overflowService;
        /**
         * 配置文本过长时显示的tip的最大宽度。
         *
         * 3.0.9新增
         */
        this.tiTipMaxWidth = '276px';
    }
    ngOnInit() {
        this.overflowRef = this.overflowService.create(this.ele.nativeElement, {
            tipContent: this.tiTipContent,
            tipPosition: this.tiTipPosition,
            tipHostEleX: this.tiTipHostEleX,
            tipMaxWidth: this.tiTipMaxWidth
        });
    }
    // 服务方式的overflow无法自销毁，因此此处在组件销毁时销毁服务方式生成的组件实例
    ngOnDestroy() {
        if (this.overflowRef) {
            this.overflowRef.destroy();
        }
    }
}
TiOverflowDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiOverflow]:not([maxLine])'
            },] }
];
TiOverflowDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: TiOverflowService }
];
TiOverflowDirective.propDecorators = {
    tiOverflow: [{ type: Input }],
    tiTipContent: [{ type: Input }],
    tiTipPosition: [{ type: Input }],
    tiTipMaxWidth: [{ type: Input }],
    tiTipHostEleX: [{ type: Input }]
};

/**
 * 多行文本超出情况下文本处理出...并tip提示
 *
 */
class TiOverflowMaxlineDirective {
    constructor(hostRef, renderer2, tipService, zone) {
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.tipService = tipService;
        this.zone = zone;
        /**
         * 文本最大行数，默认3行
         */
        this.maxLine = 3;
        /**
         * 配置文本过长时显示的tip的最大宽度。
         *
         * 3.0.9新增
         */
        this.tiTipMaxWidth = '276px';
        /**
         * 图标提示
         */
        this.iconTip = '';
        /**
         * @ignore
         * 文本被截断之后的末尾填充符号
         */
        this.character = '...'; // 暂不开放
        /**
         * @ignore
         * 图标是否可以聚焦，默认不可聚焦。
         */
        this.iconFocusable = false;
        /**
         * @ignore
         * 图标是否灰化，默认不灰化
         */
        this.iconDisabled = false;
        /**
         * @ignore
         * 文本被截断之后末尾图标点击事件
         */
        this.iconClick = new EventEmitter();
        this.shaveTextFn = () => {
            let fontHtml;
            if (Util.isEmptyString(this.iconName)) {
                fontHtml = '';
            }
            else {
                // 此处添加属性tiOverflowEndicon为了适配在plus3中定义末尾图标的样式
                // 在labelEditor组件中，需要可以聚焦。
                fontHtml = this.iconFocusable ? `<span style="display:inline-block;width:16px;line-height: 1"
                tabindex="${this.iconDisabled ? -1 : 0}" tiOverflowEndicon  class="ti3-icon-${this.iconName} ti3-icon"></span>`
                    : `<span style="display:inline-block;width:16px;line-height: 1"
                tiOverflowEndicon class="ti3-icon-${this.iconName} ti3-icon"></span>`;
            }
            // 修复SSR错误：ERROR ReferenceError: getComputedStyle is not defined
            if (typeof getComputedStyle === 'undefined') {
                return;
            }
            const lineHeight = parseFloat(getComputedStyle(this.nativeElement)
                .getPropertyValue('line-height'));
            const multiLineHeight = lineHeight * this.maxLine;
            this.nativeElement.textContent = this.text;
            // 如果该元素为inline元素时，宽度不生效会导致元素出...样式不生效，因此此处做处理
            if (getComputedStyle(this.nativeElement).display === 'inline') {
                this.renderer2.setStyle(this.nativeElement, 'display', 'inline-block');
            }
            this.nativeElement.insertAdjacentHTML('beforeend', fontHtml);
            if (this.text.length < 2 || this.nativeElement.offsetHeight <= multiLineHeight) {
                this.setEvents();
                this.isShave = false;
                return;
            }
            let charHtml = this.character;
            charHtml = charHtml.concat(fontHtml);
            // 以下使用二分算法计算文本截取位置
            let max = this.text.length - 1;
            let min = 0;
            let middle;
            while (min < max) {
                middle = (min + max + 1) / 2;
                this.nativeElement.textContent = this.text.slice(0, middle);
                this.nativeElement.insertAdjacentHTML('beforeend', charHtml);
                if (this.nativeElement.offsetHeight > multiLineHeight + 1) {
                    max = middle - 1; // 截取的内容少
                }
                else {
                    min = middle; // 截取的内容多
                }
            }
            this.nativeElement.textContent = this.text.slice(0, max);
            this.nativeElement.insertAdjacentHTML('beforeend', charHtml);
            this.setEvents();
            this.isShave = true;
        };
        this.nativeElement = this.hostRef.nativeElement;
    }
    ngOnChanges(changes) {
        this.text = this.textContent || this.nativeElement.innerHTML;
        if ((changes.maxLine && !changes.maxLine.firstChange)
            || (changes.textContent && !changes.textContent.firstChange)) {
            this.shaveTextFn();
        }
        if (this.iconFocusable && changes.iconDisabled && !changes.iconDisabled.firstChange) {
            const spanEle = this.nativeElement.querySelector('span[tiOverflowEndicon]');
            if (spanEle) {
                this.renderer2.setAttribute(spanEle, 'tabindex', this.iconDisabled ? '-1' : '0');
            }
        }
    }
    // tip配置
    ngAfterViewInit() {
        this.text = this.textContent || this.nativeElement.innerHTML; // 视图初始化完成后获取宿主元素文本
        if (TiBrowser.isIE()) {
            setTimeout(() => {
                this.shaveTextFn(); // IE下需延时处理，否则初始化获取到 offsetHeight 值与谷歌有差异
            }, 0);
        }
        else {
            this.shaveTextFn();
        }
        this.renderer2.listen(this.nativeElement, 'mouseenter', () => {
            if (this.isShave) {
                this.tipContent = this.tiTipContent || this.text;
                if (!this.tipInstance) {
                    this.tipInstance = this.tipService.create(this.nativeElement, {
                        position: this.tiTipPosition || 'right',
                        maxWidth: this.tiTipMaxWidth,
                        trigger: 'mouse'
                    });
                    this.tipInstance.show(this.tipContent);
                }
                else {
                    this.tipInstance.show(this.tipContent);
                }
            }
        });
        this.renderer2.listen(this.nativeElement, 'mouseleave', () => {
            if (this.tipInstance) {
                this.tipInstance.hide();
            }
        });
        // 修复SSR错误：ERROR ReferenceError: window is not defined
        if (typeof window === 'undefined') {
            return;
        }
        this.zone.runOutsideAngular(() => {
            this.windowResizeListener = this.renderer2.listen(window, 'resize', this.shaveTextFn);
        });
    }
    ngAfterContentChecked() {
        if (!this.nativeElement.children || this.nativeElement.children.length < 1) {
            return;
        }
        // 解绑原有监听
        if (this.listenFns) {
            this.listenFns.forEach((fn) => fn());
        }
        this.listenFns = new Array();
        this.listenFns.push(this.renderer2.listen(this.nativeElement.children[0], 'click', () => {
            this.iconClick.emit();
            if (this.icontipInstance) {
                this.icontipInstance.hide();
            }
        }));
        this.listenFns.push(this.renderer2.listen(this.nativeElement.children[0], 'mouseenter', () => {
            if (this.tipInstance) {
                this.tipInstance.hide();
            }
            this.icontipInstance = this.tipService.create(this.nativeElement.children[0], {
                position: 'top',
                maxWidth: this.tiTipMaxWidth,
                trigger: 'mouse'
            });
            this.icontipInstance.show(this.iconTip);
        }));
        this.listenFns.push(this.renderer2.listen(this.nativeElement.children[0], 'mouseleave', () => {
            if (this.tipInstance) {
                this.tipInstance.show(this.tipContent);
            }
            if (this.icontipInstance) {
                this.icontipInstance.hide();
            }
        }));
    }
    ngOnDestroy() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
        if (this.listenFns) {
            this.listenFns.forEach((fn) => fn());
        }
    }
    setEvents() {
        if (this.iconFocusable) {
            const clickIconEle = this.nativeElement.querySelector('span[tiOverflowEndicon]');
            if (!clickIconEle) {
                return;
            }
            this.zone.runOutsideAngular(() => {
                this.renderer2.listen(clickIconEle, 'mousedown', () => {
                    this.renderer2.setStyle(clickIconEle, 'outline', 'none');
                });
                this.renderer2.listen(clickIconEle, 'blur', () => {
                    this.renderer2.setStyle(clickIconEle, 'outline', '');
                });
            });
        }
    }
}
TiOverflowMaxlineDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiOverflow][maxLine]'
            },] }
];
TiOverflowMaxlineDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiTipService },
    { type: NgZone }
];
TiOverflowMaxlineDirective.propDecorators = {
    maxLine: [{ type: Input }],
    tiTipMaxWidth: [{ type: Input }],
    tiTipPosition: [{ type: Input }],
    tiTipContent: [{ type: Input }],
    iconName: [{ type: Input }],
    iconTip: [{ type: Input }],
    textContent: [{ type: Input }],
    character: [{ type: Input }],
    iconFocusable: [{ type: Input }],
    iconDisabled: [{ type: Input }],
    iconClick: [{ type: Output }]
};

class TiOverflowModule {
}
TiOverflowModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiOverflowServiceModule
                ],
                exports: [TiOverflowDirective, TiOverflowMaxlineDirective],
                declarations: [TiOverflowDirective, TiOverflowMaxlineDirective]
            },] }
];

/**
 * @ignore
 */
class TiDateDominatorComponent extends TiFormComponent {
    constructor(render, hostRef) {
        super(hostRef, render);
        this.render = render;
        this.hostRef = hostRef;
        this.clear = new EventEmitter(); // 点击删除按钮的事件回调
    }
    ngOnInit() {
        super.ngOnInit();
        this.setFocusableElems([this.nativeElement]);
    }
    onIconClearClick(event) {
        this.clear.emit(event);
    }
    onMouseenter() {
        this.showClear = true;
    }
    onMouseleave() {
        this.showClear = false;
    }
}
TiDateDominatorComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-date-dominator',
                template: "<!-- \u6587\u672C\u663E\u793A\u533A\u57DF -->\r\n<section *ngIf=\"model else placeholderContainer\"\r\n      tiOverflow\r\n      class=\"ti3-date-show\">{{model}}</section>\r\n<!-- placeholder \u663E\u793A\u533A\u57DF -->\r\n<ng-template #placeholderContainer >\r\n    <section class=\"ti3-date-show ti3-date-placeholder-container\" tiOverflow>\r\n       <ng-content></ng-content></section>\r\n</ng-template>\r\n<section #calendar class=\"ti3-date-icon-container ti3-icon \" [id]=\"appendId('close')\"\r\n[ngClass]=\"{ 'ti3-icon-calendar' : (!model || !clearable || disabled || (!showClear && !focused)) && !isTime,\r\n'ti3-icon-time' : (!model || !clearable || disabled || (!showClear && !focused)) && isTime,\r\n'ti3-icon-close' : model && clearable && !disabled && (showClear || focused)}\"\r\n(click)=\"model ? onIconClearClick($event) : ''\"\r\n></section>\r\n",
                // tslint:disable-next-line:use-host-property-decorator
                host: {
                    '(mouseenter)': 'onMouseenter()',
                    '(mouseleave)': 'onMouseleave()',
                    '[class.ti3-date-dominator-container]': 'true'
                },
                encapsulation: ViewEncapsulation.None,
                providers: [TiFormComponent.getValueAccessor(TiDateDominatorComponent)],
                styles: ["::ng-deep :root{--ti-date-clear-icon-font-size:12px;--ti-date-clear-icon-width:20px;--ti-date-icon-font-size:16px;--ti-date-icon-width:35px}.ti3-date-dominator-container{-ms-box-sizing:border-box;border-left:1px solid transparent;border-right:1px solid transparent;box-sizing:border-box;color:var(--ti-input-text-color);cursor:pointer;display:inline-block;height:var(--ti-datetime-time-height);line-height:normal;margin:0 -1px;position:relative;vertical-align:middle;width:calc(100% + 2px)}.ti3-date-dominator-container:focus{outline:none}.ti3-date-dominator-container .ti3-date-show{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;background-color:transparent;box-sizing:border-box;display:inline-block;height:100%;left:0;line-height:var(--ti-datetime-time-height);padding-left:var(--ti-input-padding-horizontal);position:absolute;text-align:left;user-select:none;vertical-align:inherit;width:calc(100% - var(--ti-date-icon-width))}.ti3-date-dominator-container .ti3-date-show:before{content:\"\";display:inline-block;height:100%;line-height:100%;vertical-align:middle}.ti3-date-dominator-container .ti3-date-placeholder-container{color:var(--ti-input-placeholder-color);width:calc(100% - var(--ti-date-icon-width))}.ti3-date-dominator-container .ti3-date-clear-icon{background-color:transparent;border-right:1px solid var(--ti-datetime-clear-icon-border-right-color);box-sizing:border-box;color:var(--ti-common-color-icon-normal);cursor:pointer;display:inline-block;font-size:var(--ti-date-clear-icon-font-size);left:calc(100% - var(--ti-date-icon-width) - var(--ti-date-clear-icon-width));margin-top:calc((var(--ti-datetime-time-height) - var(--ti-date-clear-icon-font-size))/2);position:absolute;right:var(--ti-date-icon-width);width:var(--ti-date-clear-icon-width)}.ti3-date-dominator-container .ti3-date-clear-icon:before{position:relative;top:calc(50% - var(--ti-date-clear-icon-font-size)/2)}.ti3-date-dominator-container .ti3-date-icon-container{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-common-color-icon-normal);cursor:pointer;display:inline-block;font-size:var(--ti-common-font-size-2);left:calc(100% - var(--ti-date-icon-width));line-height:var(--ti-datetime-time-height);padding:0 10px;position:absolute;right:0;text-align:right;top:0;width:35px}.ti3-date-dominator-container .ti3-date-icon-container:before{position:relative;top:calc(50% - var(--ti-date-icon-font-size)/2)}.ti3-date-dominator-container:not([disabled]) .ti3-date-clear-icon:hover{color:var(--ti-input-clear-color-hover)}.ti3-date-dominator-container:not([disabled]) .ti3-date-icon-container:hover{color:var(--ti-input-border-color-focus)}.ti3-date-dominator-container[disabled],.ti3-date-dominator-container[disabled] .ti3-date-clear-icon,.ti3-date-dominator-container[disabled] .ti3-date-icon-container{color:var(--ti-input-text-color-disabled);cursor:not-allowed}.ti3-date-icon-container.ti3-icon-close{font-size:var(--ti-common-font-size-base)}"]
            },] }
];
TiDateDominatorComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
TiDateDominatorComponent.propDecorators = {
    clearable: [{ type: Input }],
    format: [{ type: Input }],
    type: [{ type: Input }],
    isTime: [{ type: Input }],
    clear: [{ type: Output }]
};

/**
 * @ignore
 */
class TiDateDominatorModule {
}
TiDateDominatorModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiOverflowModule
                ],
                exports: [TiDateDominatorComponent],
                declarations: [TiDateDominatorComponent]
            },] }
];

/**
 * @ignore
 */
class TiDateEditComponent extends TiFormComponent {
    constructor(hostRef, render) {
        super(hostRef, render);
        this.hostRef = hostRef;
        this.render = render;
        /**
         * @ignore
         */
        this.display = 'inline-block';
        this.inputValue = '';
        this.MAX = TiDateUtil.maxDate();
        this.MIN = TiDateUtil.minDate();
    }
    writeValue(value) {
        super.writeValue(value);
        // model为null时，输入框不显示内容
        if (value === null) {
            return;
        }
        // 传入的model值是非日期时，设置为当前日期
        if (!TiDateUtil.isDate(value)) {
            this.model = new Date();
        }
        else if (TiDateUtil.isBigger(value, this.max)) { // 如果大于最大值，设置为最大值
            this.model = this.max;
        }
        else if (TiDateUtil.isSmaller(value, this.min)) { // 小于最小值，设置为最小值
            this.model = this.min;
        }
    }
    // model值变化时的回调: dateedit中inputValue变化时未能及时渲染到页面上
    ngOnModelChange() {
        setTimeout(() => {
            this.formatValue();
        }, 0);
    }
    ngOnInit() {
        super.ngOnInit();
        // 设置聚焦元素为input
        this.setFocusableElems([this.inputRef.nativeElement]);
        // format接口校验:对时间日期进行国际化处理
        this.validateFormat();
        // 最大最小值校验
        this.validateMinAndMax();
        if (!Util.isUndefined(this.format)) {
            this.setPlacehoderText();
        }
        this.oldMinvalue = this.min;
        this.oldMaxvalue = this.max;
    }
    ngOnChanges(changes) {
        // format支持动态变更
        if (changes['format'] && !changes['format'].firstChange) {
            // 新的format是非法时，format值保持之前值不变
            if (!Util.isString(changes['format'].currentValue) && !Util.isString(changes['format'].currentValue.date)) {
                this.format = changes['format'].previousValue;
                return;
            }
            if (!Util.isString(changes['format'].currentValue)) {
                this.format = changes['format'].currentValue.date;
            }
            this.setPlacehoderText();
            this.formatValue();
        }
    }
    /**
     * 不同场景下设置日期输入框placehoder文本
     */
    setPlacehoderText() {
        // 以下是为了处理英文状态下，dateEdit输入时有问题，将其placeholder调整为国际化以后的值
        const englishFormatArr = this.format.match(/M/g);
        // tslint:disable-next-line:newline-per-chained-call
        const formatPureArr = this.format.split(/[-\/\.\_,\s]/).filter(this.filterEmptyFn);
        // 确定其为英文显示月份
        if (Util.isArray(englishFormatArr) && englishFormatArr.length === 3) {
            formatPureArr.length === 3 ? this.placehoderText = 'MM/dd/yyyy' : this.placehoderText = 'MM/yyyy';
        }
        else {
            this.placehoderText = this.format;
        }
    }
    onFocus() {
        // 在输入框聚焦时获取当前合法的model值：
        this.oldModel = this.model;
    }
    onBlur() {
        if (this.oldInputvalue !== this.inputValue) {
            this.handleInputValue();
        }
    }
    onKeydown(event) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.handleInputValue();
        }
    }
    /**
     * @ignore
     */
    handleInputValue() {
        // blur时拿到输入框的值
        this.inputValue = this.inputRef.nativeElement.value;
        // 校验输入框中值：得到合法的model值
        if (this.inputValue !== '') {
            this.getValidModel();
        }
        else {
            this.model = null; // 当用户输入为空或者为null的情况,model赋值为null
        }
        // 根据model值格式化
        this.formatValue();
        this.oldInputvalue = this.inputValue;
    }
    isValidValue(value) {
        // value值为null时会将输入框清空，是一个合法的value值
        if (value === null) {
            return true;
        }
        // value值为一个Date类型值并且在最大最小值范围内时，是一个合法值
        if (TiDateUtil.isDate(value) &&
            !TiDateUtil.isBigger(value, this.max) && !TiDateUtil.isSmaller(value, this.min)) {
            return true;
        }
        return false;
    }
    /**
     * @ignore
     */
    filterEmptyFn(value) {
        return value !== '';
    }
    // 日期格式校验
    validateFormat() {
        if (Util.isString(this.format) && this.format !== '') {
            return;
        }
        // TODO:如果配置时间日期国际化
        this.format = TiLocale.getLocaleWords().tiLocaleDate['date'];
    }
    // 最大值最小值校验
    validateMinAndMax() {
        // 最大值合法性校验:(时分秒：23:59:59)
        const maxTimeChanged = TiDateUtil.changeMaxTime(this.max);
        this.max = TiDateUtil.isDate(this.max) ? maxTimeChanged : this.MAX;
        // 最小值合法性校验:(时分秒：0:0:0)
        const minTimeChanged = TiDateUtil.changeMinTime(this.min);
        this.min = TiDateUtil.isDate(this.min) ? minTimeChanged : this.MIN;
        // 最大最小值矛盾时，设置为默认值
        if (this.max.getTime() < this.min.getTime()) {
            this.max = this.MAX;
            this.min = this.MIN;
        }
    }
    // 根据model值和format接口，格式化显示时间日期
    formatValue() {
        this.inputValue = (this.model !== null) ? TiLocaleFormat.formatDate(this.model, this.placehoderText) : '';
        this.oldInputvalue = this.inputValue;
    }
    // 校验输入框中的值
    getValidModel() {
        // 支持分隔符:中划线，下划线，点，斜杠
        const reg = new RegExp('[年\\月\\日\\-\\/\\.\\_]');
        const dateArr = this.inputValue.split(reg);
        const formatArr = this.placehoderText.split(reg);
        let dateValue;
        const arr = []; // 保存format格式下年月日的顺序下标；年月日，日月年，月日年，年月。。。
        for (let i = 0; i < formatArr.length; i++) {
            if (formatArr[i].indexOf('y') !== -1) {
                arr[0] = i;
            }
            else if (formatArr[i].indexOf('M') !== -1) {
                arr[1] = i;
            }
            else if (formatArr[i].indexOf('d') !== -1) {
                arr[2] = i;
            }
        }
        // 处理年月情况
        if (arr.length === 2) {
            dateArr[arr[2]] = '1';
        }
        // 浏览器兼容性处理：对于非法日期表现不一致：eg:new Date('2018/13/12'),谷歌和火狐处理为非法日期对象，而IE浏览器会处理为2019/1/12；
        // 获取当前月总天数
        const totalDays = new Date(parseInt(dateArr[arr[0]], 10), parseInt(dateArr[arr[1]], 10), 0).getDate();
        // 将时间日期转换成字符串，原因：2018-3-34 不合法日期，用new Date(2018, 2, 34)生成日期对象，会处理成 ==>2018/4/3
        // 将其转换成字符串形式：new Date('2018/2/34')生成日期对象，处理成 ==>Invalid Date对象
        dateValue = TiBrowser.isIE() && (parseInt(dateArr[arr[1]], 10) > 12 || parseInt(dateArr[arr[2]], 10) > totalDays)
            || (String(new Date(parseInt(dateArr[arr[0]], 10), parseInt(dateArr[arr[1]], 10), parseInt(dateArr[arr[2]], 10))) === 'Invalid Date')
            || dateArr.length > 3 ?
            'Invalid Date' : new Date(`${dateArr[arr[0]]}/${dateArr[arr[1]]}/${dateArr[arr[2]]}`);
        // 1.输入值为不合法日期：2018-3-34;
        // 2.输入值不在最小值最大值范围内;
        // 3.当前输入框中的值，和上次输入框中的值相同时;
        // tslint:disable-next-line:triple-equals
        this.model = String(dateValue) === 'Invalid Date' || !this.isValidValue(dateValue) || this.isDisabledDays(dateValue)
            ? this.oldModel : new Date(TiDateUtil.getDateStr(dateValue));
    }
    /**
     * @ignore
     * 是否为禁用日期
     */
    isDisabledDays(value) {
        let isDisabled = false;
        if (Util.isArray(this.disabledDays) && this.disabledDays.length > 0) {
            this.disabledDays.forEach((item) => {
                if (item.getTime() === value.getTime()) {
                    isDisabled = true;
                }
            });
        }
        return isDisabled;
    }
}
TiDateEditComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-date-edit',
                template: "<input #input\r\n    [placeholder]=\"placehoderText\"\r\n    style=\"width: 100%\"\r\n    type=\"text\"\r\n    maxlength=\"20\"\r\n    [(ngModel)]=\"inputValue\"\r\n    (blur)=\"onBlur()\"\r\n    (focus)=\"onFocus()\"\r\n    [disabled]='disabled'\r\n    (keydown)='onKeydown($event)'\r\n    [id]=\"appendId('input')\"\r\n    tiText>",
                providers: [TiFormComponent.getValueAccessor(TiDateEditComponent)],
                styles: ["::ng-deep :root{--ti-text-clear-width:26px;--ti-text-password-width:36px}:host[tiText]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);flood-color:var(--ti-input-clear-color);font-size:var(--ti-input-font-size);height:var(--ti-input-height);lighting-color:var(--ti-input-clear-color-hover);line-height:normal;outline:none;padding:0 var(--ti-input-padding-horizontal);stop-color:var(--ti-input-clear-color-disabled);vertical-align:middle}:host[tiText].ti3-text-input-show-icon{background-repeat:no-repeat;background-size:16px}:host[tiText].ti3-text-input-show-clear{background-position:center right 5px;padding-right:var(--ti-text-clear-width)!important}:host[tiText].ti3-text-input-show-password{background-position:center right 10px;padding-right:var(--ti-text-password-width)!important}:host[tiText].ti3-text-input-noborder{border:0;box-shadow:none;outline:0}:host[tiText]:not([disabled]):not([noborder]).ti3-text-input-show-icon.ti3-text-clear-active:hover{cursor:pointer}:host[tiText]:not([disabled]):not([noborder]):hover{border:1px solid var(--ti-input-border-color-hover)}:host[tiText]:not([disabled]):not([noborder]):focus{border:1px solid var(--ti-input-border-color-focus)}:host[tiText][disabled]:disabled{background-color:var(--ti-input-bg-color-disabled);border:1px solid var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}:host[tiText][disabled]:disabled.ti3-text-input-noborder{border:0}.ti3-password-hack-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}:host[tiText]{transition:border-color .15s}:host[tiText].ti3-text-input-show-icon:focus{transition:transform .15s cubic-bezier(.4,0,.2,1),font-size .15s cubic-bezier(.4,0,.2,1)}:host[tiText]:hover:not(:focus){transition:border-color .2s}"]
            },] }
];
TiDateEditComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiDateEditComponent.propDecorators = {
    format: [{ type: Input }],
    min: [{ type: Input }],
    max: [{ type: Input }],
    disabled: [{ type: Input }],
    disabledDays: [{ type: Input }],
    inputRef: [{ type: ViewChild, args: ['input', { static: true },] }],
    display: [{ type: HostBinding, args: ['style.display',] }]
};

/**
 * @ignore
 */
class TiDateEditModule {
}
TiDateEditModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiTextModule
                ],
                exports: [TiDateEditComponent],
                declarations: [TiDateEditComponent]
            },] }
];

/* eslint-disable no-param-reassign */
// lib编译要求@Component
class TiDateBaseComponent extends TiFormComponent {
    constructor(hostRef, render, zone, document) {
        super(hostRef, render);
        this.hostRef = hostRef;
        this.render = render;
        this.zone = zone;
        this.document = document;
        /**
         * 设置最小值
         */
        this.min = TiDateUtil.minDate();
        /**
         * 设置最大值
         */
        this.max = TiDateUtil.maxDate();
        /**
         * 控制时间日期类组件是否展示清除日期图标（默认显示）
         */
        this.clearIcon = true;
        /**
         * 面板对齐方式
         */
        this.panelAlign = 'left';
        /**
         * 开始值固定不可选
         */
        this.isBeginFixed = false;
        /**
         * 结束值固定不可选
         */
        this.isEndFixed = false;
        /**
         * 此接口只适用于dateRange组件，是否允许结束日期和开始日期为同一天
         */
        this.isAllowBeginEqualEnd = true;
        /**
         * （date组件无该接口）点击时间日期面板上的确认按钮触发的事件
         */
        this.okClick = new EventEmitter();
        /**
         * 点击日期面板上的日期触发的事件
         */
        this.dayClick = new EventEmitter();
        this.localeWords = TiLocale.getLocaleWords();
        /**
         * @ignore
         * 标志是时间选择面板还是日期选择面板
         */
        this.selectTime = false;
        /**
         * @ignore
         * 对应每个时间日期组件的最大最小值的配置
         */
        this.config = {
            min: TiDateUtil.minDate(),
            max: TiDateUtil.maxDate()
        };
        /**
         * @ignore
         * model默认值
         */
        this.defaultValue = {
            begin: null,
            end: null
        };
        /**
         * @ignore
         * 模板初始化
         */
        this.datePanel = {
            value: this.defaultValue
        };
        /**
         * @ignore
         * date/datetime 面板宽度
         */
        this.datePanelWidth = '286px';
        /**
         * @ignore
         * daterange/datetimerange 面板宽度
         */
        this.daterangePanelWidth = '558px';
        /**
         * @ignore
         * 日期显示字符串
         */
        this.inputValue = '';
        /**
         * @ignore
         * 模板中使用
         */
        this.browserSpace = TiDateBaseComponent.BROWSER_SPACE + 'px';
        /**
         * @ignore 面板与dominator的距离
         */
        this.dominatorSpace = TiDateBaseComponent.DOMINATOR_SPACE + 'px';
        /**
         * @ignore
         * 记录当前面板内部编辑区域焦点位置
         */
        this.focusedPosition = 'begin';
        /**
         * @ignore
         * 时间编辑框placehoder
         */
        this.timeplaceholder = 'hh:mm:ss';
        /**
         * @ignore
         * 标志是否存在左侧自定义时间区域
         */
        this.hasCustomizeTime = false;
        /**
         * @ignore
         * 可聚焦元素集合
         */
        this.focusElementsArr = [];
        this.keydownHandlerFn = (event) => {
            if (!this.dropCom.isShow) {
                return;
            }
            if (event.keyCode === TiKeymap.KEY_ESCAPE) {
                this.hidePanel();
                this.dominatorCom.focus();
            }
            this.tabKeydown(event);
        };
        /**
         * @ignore
         * 决定上下位置的函数
         */
        this.determinPositionFn = (layout) => {
            const needHeight = layout.targetLayout.height + TiDateBaseComponent.DOMINATOR_SPACE + TiDateBaseComponent.BROWSER_SPACE;
            if (layout.avilableLayout.bottom >= needHeight) { // 下方空间足够，向下展开
                return this.panelAlign === 'left' ? 'bottom-left' : 'bottom-right';
            }
            else {
                return this.panelAlign === 'left' ? 'top-left' : 'top-right';
            }
        };
    }
    static getFocusElements(focusComs, focusElements) {
        for (const focusCom of focusComs.toArray()) {
            focusElements = focusElements.concat(focusCom.getFocusableElems());
        }
        return focusElements;
    }
    /**
     * 组件快捷键处理tab键 enter键
     */
    onKeydown(event) {
        switch (event.keyCode) {
            case TiKeymap.KEY_TAB: // TAB键
                this.hidePanel();
                break;
            case TiKeymap.KEY_ENTER: // ENTER键(大键盘)
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(数字小键盘)
                this.responseEnter();
                break;
            default:
                break;
        }
    }
    /**
     * @ignore
     * writeValue区分是不是range组件：
     */
    writeValue(value) {
        super.writeValue(value);
        // 1.daterange和datetimerange组件的处理
        // 新旧值判断处理放在docheck中
        if (this.isRange) {
            // value不是对象时，将value设置为null，输入框中显示空白
            if (!(value instanceof Object) || !this.isValidValue(value)) {
                this.model = null;
                return;
            }
        }
        // 2.date和datetime组件的处理，非法时间日期值统一置为null，显示空
        if (!this.isValidValue(value)) {
            this.model = null;
            return;
        }
        // 新旧值相同时不作处理；
        if (TiDateUtil.isDateEqual(value, this.model)) {
            return;
        }
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 是否存在左侧自定义面板
        this.hasCustomizeTime = !Util.isUndefined(this.customizeOptions) && !Util.isNull(this.customizeOptions);
        // format接口校验:对时间日期进行国际化处理
        this.validateFormat(this.isDatetime);
        // 最大最小值校验
        this.validateMinAndMax(this.config, this.isDatetime);
        this.zone.runOutsideAngular(() => {
            // document上的Ecs快捷键功能
            this.documentKeydownListener = this.render.listen(this.document, 'keydown', this.keydownHandlerFn);
        });
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        // 定义变量存储聚焦元素；
        let focusElements = [];
        // 获取dateedit的聚焦元素
        focusElements = TiDateBaseComponent.getFocusElements(this.dateEditComs, focusElements);
        // 获取时间编辑框聚焦元素
        if (this.textComs.length !== 0) {
            for (const textCom of this.textComs.toArray()) {
                focusElements = focusElements.concat(textCom.nativeElement);
            }
        }
        if (this.inputRef) {
            focusElements = focusElements.concat(this.inputRef.nativeElement);
        }
        // 获取确认取消按钮的聚焦元素
        for (const buttonCom of this.buttonComs.toArray()) {
            focusElements = focusElements.concat(buttonCom.nativeElement);
        }
        this.focusElementsArr = focusElements;
        this.setFocusableElems([this.dominatorCom.nativeElement]
            .concat(this.dropCom.nativeElement)
            .concat(focusElements));
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        if (this.documentKeydownListener) {
            this.documentKeydownListener();
        }
    }
    /**
     * 实现按tab键时，focus在下拉面板中循环
     */
    tabKeydown(event) {
        if (this.focusElementsArr.length === 0) {
            return;
        }
        let focusChanged = false;
        if (event.keyCode === TiKeymap.KEY_TAB) {
            const panelFocusElementsArr = this.focusElementsArr.filter((item) => !item.hasAttribute('disabled'));
            if (event.shiftKey) {
                if (event.target === panelFocusElementsArr[0]) {
                    focusChanged = true;
                    panelFocusElementsArr[panelFocusElementsArr.length - 1].focus();
                }
            }
            else if (event.target === panelFocusElementsArr[panelFocusElementsArr.length - 1]) {
                focusChanged = true;
                panelFocusElementsArr[0].focus();
            }
        }
        if (focusChanged) {
            event.preventDefault();
            event.stopPropagation();
        }
    }
    // ----------------------------- 公共事件处理 -----------------------------
    /**
     * @ignore
     * 点击面板展开收起函数
     */
    onShowClick() {
        if (this.disabled) { // 非灰化可点击展开面板
            return;
        }
        if (this.dropCom.isShow || this.isClearClick) {
            this.isClearClick = false;
            this.dropCom.hide();
        }
        else {
            // 配置时间日期面板接口
            this.setPickerDate();
            this.show();
            this.selectTime = false; // 面板打开初次总展示日期面板
            setTimeout(() => {
                if (this.isBeginFixed && !this.isEndFixed) {
                    this.dateEditComs.last.focus(); // 开始值固定，则第二个编辑区域聚焦
                    this.focusedPosition = 'end';
                }
                else {
                    this.dateEditComs.first.focus(); // 初始化打开面板，第一个编辑区域聚焦
                    this.focusedPosition = 'begin';
                }
            }, 0);
        }
    }
    /**
     * @ignore
     * 左侧自定义时间文本点击事件
     */
    customizeTimeClickFn(val) {
        this.model = val;
        this.dropCom.hide();
    }
    /**
     * @ignore
     * 点击选择时间，根据初始传入值设定下拉选择项
     */
    selectTimeFn() {
        if (this.timeEditDisabled) {
            return;
        }
        this.selectTime = true; // 切换为时间选择面板
        this.textComs.first.nativeElement.focus();
    }
    /**
     * @ignore
     */
    selectDateFn() {
        this.selectTime = false;
        this.dateEditComs.first.nativeElement.focus();
        this.focusedPosition = 'begin';
    }
    /**
     * @ignore
     */
    dateEditClick(val) {
        if (this.isBeginFixed || this.isEndFixed) {
            return;
        }
        this.focusedPosition = val;
        this.selectTime = false;
    }
    /**
     * @ignore
     */
    dateEditFocus(val) {
        this.focusedPosition = val;
        this.selectTime = false;
    }
    /**
     * @ignore
     * 时间框聚焦
     */
    timeFocus(val) {
        this.selectTime = true;
        this.focusedPosition = val === 'begin' ? 'beginTime' : 'endTime';
    }
    /**
     * @ignore
     */
    setTimeFn(obj, beginTime, endTime) {
        const timePosition = obj.timeOption;
        const beginTimeArr = beginTime.value.split(':');
        let endTimeArr;
        if (!Util.isUndefined(endTime)) {
            endTimeArr = endTime.value.split(':');
        }
        switch (timePosition) {
            case 'beginHour':
                beginTimeArr[0] = obj.val.label;
                break;
            case 'beginMinute':
                beginTimeArr[1] = obj.val.label;
                break;
            case 'beginSecond':
                beginTimeArr[2] = obj.val.label;
                break;
            case 'endHour':
                endTimeArr[0] = obj.val.label;
                break;
            case 'endMinute':
                endTimeArr[1] = obj.val.label;
                break;
            case 'endSecond':
                endTimeArr[2] = obj.val.label;
                break;
            default:
                break;
        }
        beginTime.value = beginTimeArr.join(':');
        if (!Util.isUndefined(endTime)) {
            endTime.value = endTimeArr.join(':');
        }
    }
    /**
     * @ignore
     * 点击删除按钮
     */
    onIconClearClick(event) {
        // 阻止事件冒泡：可以防止点击叉号引起面板的显示或者隐藏，但此处不能阻止事件冒泡，
        // 事件不会冒泡到document上，会出现页面上其他下拉类组件面板不收起情况
        // 添加标志量，在onShowClick函数中处理
        if (this.disabled || !this.clearIcon) {
            return;
        }
        this.isClearClick = true;
        this.model = null;
        this.oldBeginValue = null;
        this.oldEndValue = null;
        this.inputValue = '';
        // 时间日期面板显示则隐藏
        this.hidePanel();
    }
    /**
     * @ignore
     * 隐藏drop, 适用于drop中用户点击引起drop隐藏，阻止了整体失焦。
     */
    hideDrop() {
        // 阻止整体失去焦点
        this.dominatorCom.focus();
        this.dropCom.hide();
    }
    /**
     * @ignore
     * 隐藏面板
     */
    hidePanel() {
        if (this.dropCom.isShow) {
            this.dropCom.hide();
        }
    }
    /**
     * @ignore
     * enter键的功能：如果面板展开不处理，面板收起则展开，设置datePanel指令的接口值
     */
    responseEnter() {
        if (this.dropCom.isShow) {
            return;
        }
        // 面板收起前是年或月面板，按enter键重新设置datePanel指令的接口值
        this.setPickerDate();
        // 时间面板展开
        this.show();
        setTimeout(() => {
            this.dateEditComs.first.nativeElement.focus();
            this.focusedPosition = 'begin';
        }, 0);
    }
    /**
     * @ignore
     *
     * 设置按钮禁用场景下 过度input的样式（适配tab快捷键场景）
     */
    setInputStyle(val) {
        if (val) {
            this.render.removeStyle(this.inputRef.nativeElement, 'display');
            this.render.setStyle(this.inputRef.nativeElement, 'opacity', '0');
        }
        else {
            this.render.setStyle(this.inputRef.nativeElement, 'display', 'none');
        }
    }
    // ----------------------------- 公共方法处理 -----------------------------
    /**
     * @ignore
     * 判断是不是合法的DatetimeFormat: format为对象 {date:'', time: ''}
     */
    isValidDatetimeFormat() {
        return (this.format instanceof Object) && Util.isString(this.format['date']) && Util.isString(this.format['time']);
    }
    /**
     * @ignore
     * 最大值最小值校验:和date组件不同，此处不需要做最大最小时分秒处理
     */
    validateMinAndMax(dateCofig, isDatetime) {
        const maxChanged = isDatetime ? this.max : TiDateUtil.changeMaxTime(this.max);
        this.max = TiDateUtil.isDate(this.max) ? maxChanged : dateCofig.max;
        const minChanged = isDatetime ? this.min : TiDateUtil.changeMinTime(this.min);
        this.min = TiDateUtil.isDate(this.min) ? minChanged : dateCofig.min;
        // 最大最小值矛盾时，设置为默认值
        if (this.max.getTime() < this.min.getTime()) {
            this.max = dateCofig.max;
            this.min = dateCofig.min;
        }
    }
    /**
     * @ignore
     * 校验format接口
     */
    validateFormat(isDatetime) {
        if (isDatetime) {
            this.validateDatetimeFormat();
        }
        else {
            this.validateDateFormat();
        }
    }
    /**
     * @ignore
     * 校验format: string类型，
     */
    validateDateFormat() {
        if (Util.isString(this.format)) {
            return;
        }
        // TODO:如果配置时间日期国际化
        this.format = this.localeWords.tiLocaleDate['date'];
    }
    /**
     * @ignore
     * 校验format: 对象类型{date:'', time:''}
     */
    validateDatetimeFormat() {
        // TODO:初始化为ngLocale格式
        // 用户设置format不是一个对象，设置为国际配置的format或默认值
        if (!(this.format instanceof Object)) {
            this.format = {
                date: this.localeWords.tiLocaleDate['date'],
                time: this.localeWords.tiLocaleDate['time']
            };
            return;
        }
        // format 为联合类型:此处处理DatetimeFormat类型
        this.format = this.format;
        // 日期格式校验
        if (!Util.isString(this.format.date)) {
            this.format.date = this.localeWords.tiLocaleDate['date'];
        }
        // 日期格式校验
        if (!Util.isString(this.format.time)) {
            this.format.time = this.localeWords.tiLocaleDate['time'];
        }
    }
    /**
     * @ignore
     * 判断range类型的model是否变化：比较起始时间和结束时间
     */
    rangeValueIsEqual(newValue, oldValue, isDatetime) {
        if (newValue === oldValue) {
            return true;
        }
        if ((newValue instanceof Object) && (oldValue instanceof Object)) {
            if (isDatetime) {
                return (TiDateUtil.isDatetimeEqual(newValue['begin'], oldValue['begin']) &&
                    TiDateUtil.isDatetimeEqual(newValue['end'], oldValue['end']));
            }
            else {
                return (TiDateUtil.isDateEqual(newValue['begin'], oldValue['begin']) &&
                    TiDateUtil.isDateEqual(newValue['end'], oldValue['end']));
            }
        }
        return false;
    }
    // ----------------------------- 动态监听处理 -----------------------------
    /**
     * @ignore
     * model值动态变更：支持仅修改begin或end值
     */
    setModel(isDatetime) {
        if (this.rangeValueIsEqual(this.model, this.oldModel, isDatetime)) {
            return;
        }
        // model中begin或者end值的变更
        this.formatValue();
        // 通过按钮改变model值：当面板处于打开状态时需要重新设置面板接口
        if (this.dropCom.isShow) {
            this.setPickerDate();
        }
        this.oldModel = (this.model === null) ? null : {
            begin: this.model.begin,
            end: this.model.end
        };
    }
    /**
     * @ignore
     * datetime与datetimeRange组件format动态变更
     */
    setFormat() {
        if (this.format && this.format['date'] === this.oldFormat['date'] &&
            this.format['time'] === this.oldFormat['time']) {
            return;
        }
        if (!this.isValidDatetimeFormat()) {
            this.format = this.oldFormat;
            return;
        }
        this.formatValue();
        this.oldFormat = this.format;
    }
    show() {
        if (this.renderer.parentNode(this.dropCom.nativeElement) === document.body) {
            this.dropCom.show();
        }
        else {
            // 使用setTimeout是为了保证datepanel渲染完成后再显示，否则首次打开时定位计算不准确
            setTimeout(() => {
                this.dropCom.show();
            }, 0);
        }
    }
    // ----------------------------- 需要在子类中实现 -----------------------------
    /**
     * @ignore
     * 0.判断是不是合法的model
     */
    isValidValue(value) {
        return true;
    }
    /**
     * @ignore
     * 1.配置时间日期面板接口
     */
    setPickerDate() { }
    /**
     * @ignore
     * 2.根据format格式model值
     */
    formatValue() { }
    /**
     * @ignore
     * 3.根据当前值设置确认按钮的状态
     */
    setOkBtnState() { }
    /**
     * @ignore
     * 起始面板日期有变化时，要重新设置其time组件对应最大值 datetimeRange组件中实现此方法
     */
    setBeginTimeMaxValue() { }
    /**
     * @ignore
     * 起始面板日期有变化时，要重新设置其time组件对应最小值 datetimeRange组件中实现此方法
     */
    setBeginTimeMinValue() { }
    /**
     * @ignore
     * 结束日期有变化时，要重新设置其time组件对应最大值 datetimeRange组件中实现此方法
     */
    setEndTimeMaxValue() { }
    /**
     * @ignore
     * 结束日期有变化时，要重新设置其time组件对应最小值 datetimeRange组件中实现此方法
     */
    setEndTimeMinValue() { }
}
/**
 * @ignore
 * 下拉距离选择框0px
 */
TiDateBaseComponent.DOMINATOR_SPACE = -30;
/**
 * 日期/日期时间下拉选择框距离浏览器上下边沿的距离为5px，开发者可在项目中整体配置
 */
TiDateBaseComponent.BROWSER_SPACE = 5;
TiDateBaseComponent.decorators = [
    { type: Component, args: [{
                template: ''
            },] }
];
TiDateBaseComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiDateBaseComponent.propDecorators = {
    min: [{ type: Input }],
    max: [{ type: Input }],
    format: [{ type: Input }],
    nowDateTime: [{ type: Input }],
    clearIcon: [{ type: Input }],
    panelAlign: [{ type: Input }],
    customizeOptions: [{ type: Input }],
    disabledDays: [{ type: Input }],
    isBeginFixed: [{ type: Input }],
    isEndFixed: [{ type: Input }],
    isAllowBeginEqualEnd: [{ type: Input }],
    okClick: [{ type: Output }],
    dayClick: [{ type: Output }],
    dominatorCom: [{ type: ViewChild, args: [TiDateDominatorComponent, /* TODO: add static flag */ { static: true },] }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, /* TODO: add static flag */ { static: true },] }],
    inputRef: [{ type: ViewChild, args: ['input', { static: true },] }],
    dateEditComs: [{ type: ViewChildren, args: [TiDateEditComponent,] }],
    textComs: [{ type: ViewChildren, args: [TiTextComponent,] }],
    buttonComs: [{ type: ViewChildren, args: [TiButtonComponent,] }],
    onKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};

// 在使用tiny npm包生产环境编辑时，要求基类也注册。
/**
 * @ignore
 */
class TiDateBaseModule {
}
TiDateBaseModule.decorators = [
    { type: NgModule, args: [{
                imports: [],
                exports: [],
                declarations: [
                    TiDateBaseComponent
                ]
            },] }
];

/**
 * @ignore
 */
class TiDatePanelComponent extends TiBaseComponent {
    constructor(render, hostRef, drop) {
        super(hostRef, render);
        this.render = render;
        this.hostRef = hostRef;
        this.drop = drop;
        this.valueChange = new EventEmitter();
        this.picker = 'day'; // 设置年、月、日面板
        this.pickerChange = new EventEmitter();
        /**
         * 开始日期是否禁用
         */
        this.isBeginFixed = false;
        /**
         * 结束日期是否禁用
         */
        this.isEndFixed = false;
        // 日期面板，月份面板点击每个日期、月份的事件回调
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        // 时间面板选择时分秒的事件回调
        this.selectTimeFn = new EventEmitter();
        this.dayArr = [];
        this.nextdayArr = [];
        this.monthArr = [];
        this.endpanelMonthArr = [];
        this.yearArr = [];
        this.endpanelYearArr = [];
        this.pickerValue = {}; // 面板头部显示文本数据
        this.nextPickerValue = {}; // 面板头部显示文本数据
        this.oldValue = {
            begin: undefined,
            end: undefined
        };
        this.hourOptions = this.setOptions(24);
        this.minuteOptions = this.setOptions(60);
        this.secondOptions = this.setOptions(60);
        this.endHourOptions = this.setOptions(24);
        this.endMinuteOptions = this.setOptions(60);
        this.endSecondOptions = this.setOptions(60);
        this.isChinese = true;
        this.local = {
            weekArr: [],
            weekTitleArr: [],
            monthArr: [],
            yearText: ''
        };
    }
    ngOnInit() {
        super.ngOnInit();
        const localeWords = TiLocale.getLocaleWords();
        this.isChinese = localeWords.tiLocaleKey === TiLocale.ZH_CN;
        this.local = {
            weekArr: localeWords.tiDate['weekNamesAbb'],
            weekTitleArr: localeWords.tiDate['weeknamesTitle'],
            monthArr: localeWords.tiDate['monthNamesAbb'],
            yearText: localeWords.tiDate['yearSuffixLabel']
        };
        this.drop.dropSubject.subscribe(() => {
            this.setValue();
        });
        this.renderer.listen(this.nativeElement, 'mousedown', (event) => {
            event.preventDefault(); // 防止dominator blur行为
        });
    }
    ngOnChanges(changes) {
        if (changes['endTimeDisabled'] && !changes['endTimeDisabled'].firstChange) {
            this.endHourOptions = this.setOptions(24, 'end');
            this.endMinuteOptions = this.setOptions(60, 'end');
            this.endSecondOptions = this.setOptions(60, 'end');
        }
        if (changes['beginTimeDisabled'] && !changes['beginTimeDisabled'].firstChange) {
            this.hourOptions = this.setOptions(24);
            this.minuteOptions = this.setOptions(60);
            this.secondOptions = this.setOptions(60);
        }
        // format支持动态变更
        if (changes['picker'] && !changes['picker'].firstChange) {
            if (Util.isUndefined(this.date)) {
                return;
            }
            // 设置下拉面板的数据
            this.setDatePanel();
        }
        // 最大最小值更新时，需要更新面板来保证最大最小值外的禁用有效
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.setDatePanel();
        }
        // 根据传入值确定时间下拉选择项
        if (changes['selectTime'] && !changes['selectTime'].firstChange) {
            const beginTimeStrArr = this.beginTime.value.split(':');
            this.beginHour = this.hourOptions.find((item) => item.label === beginTimeStrArr[0]);
            this.beginMinute = this.minuteOptions.find((item) => item.label === beginTimeStrArr[1]);
            this.beginSecond = this.secondOptions.find((item) => item.label === beginTimeStrArr[2]);
            if (this.endTime) {
                const endTimeStrArr = this.endTime.value.split(':');
                this.endHour = this.endHourOptions.find((item) => item.label === endTimeStrArr[0]);
                this.endMinute = this.endMinuteOptions.find((item) => item.label === endTimeStrArr[1]);
                this.endSecond = this.endSecondOptions.find((item) => item.label === endTimeStrArr[2]);
            }
            setTimeout(() => {
                this.timeHandleFn(this.beginHour, this.beginHourContainerRef);
                this.timeHandleFn(this.beginMinute, this.beginMinuteContainerRef);
                this.timeHandleFn(this.beginSecond, this.beginSecondContainerRef);
                if (this.endTime) {
                    this.timeHandleFn(this.endHour, this.endHourContainerRef);
                    this.timeHandleFn(this.endMinute, this.endMinuteContainerRef);
                    this.timeHandleFn(this.endSecond, this.endSecondContainerRef);
                }
            }, 0);
        }
        if (changes['beginTime'] && !changes['beginTime'].firstChange) {
            const beginTimeArr = changes['beginTime'].currentValue.value.split(':');
            this.beginHour = this.hourOptions.find((item) => item.label === beginTimeArr[0]);
            this.beginMinute = this.minuteOptions.find((item) => item.label === beginTimeArr[1]);
            this.beginSecond = this.secondOptions.find((item) => item.label === beginTimeArr[2]);
            this.timeHandleFn(this.beginHour, this.beginHourContainerRef);
            this.timeHandleFn(this.beginMinute, this.beginMinuteContainerRef);
            this.timeHandleFn(this.beginSecond, this.beginSecondContainerRef);
        }
        if (changes['endTime'] && !changes['endTime'].firstChange) {
            const endTimeArr = changes['endTime'].currentValue.value.split(':');
            this.endHour = this.endHourOptions.find((item) => item.label === endTimeArr[0]);
            this.endMinute = this.endMinuteOptions.find((item) => item.label === endTimeArr[1]);
            this.endSecond = this.endSecondOptions.find((item) => item.label === endTimeArr[2]);
            this.timeHandleFn(this.endHour, this.endHourContainerRef);
            this.timeHandleFn(this.endMinute, this.endMinuteContainerRef);
            this.timeHandleFn(this.endSecond, this.endSecondContainerRef);
        }
    }
    timeHandleFn(model, ele) {
        if (model === undefined) {
            return;
        }
        const index = model.label;
        this.render.setProperty(ele.nativeElement.children[0], 'scrollTop', index * 30);
        // TODO 动画效果
    }
    ngDoCheck() {
        super.ngDoCheck();
        // 只有点击面板打开时，才会有接口值，需要渲染面板，在没有打开时间日期面板时不需要渲染面板数据
        if (Util.isUndefined(this.value) || Util.isUndefined(this.max)) {
            return;
        }
        if (!TiDateUtil.isDateEqual(this.oldValue['begin'], this.value['begin']) ||
            !TiDateUtil.isDateEqual(this.oldValue['end'], this.value['end'])) {
            this.setValue();
            this.oldValue = {
                begin: this.value.begin,
                end: this.value.end
            };
        }
    }
    // 处理左侧年后退按钮事件
    onPreYearClick(event) {
        // 最小月，最小年，最小年时间段：左按钮灰化
        if (this.isPickerYearMinValue()) {
            return;
        }
        // 日期和月份面板
        if (this.picker === 'day' || this.picker === 'month' || this.picker === 'onlyYearMonth') {
            const year = this.date.year - 1; // 年份减1
            if (year >= this.min.getFullYear()) { // 当年份大于等于最小值
                this.date.year = year;
                if (this.isSmallerThanMinMonth(year, this.date.month)) {
                    this.date.month = this.min.getMonth() + 1;
                }
                this.setYearMonthText();
                this.setPreNextState(year, this.date.month);
                this.setDayMonthArr(this.picker);
            }
            return;
        }
        // 年面板
        if (this.picker === 'year') {
            // 当前年减10
            const year = this.date.year - 10; // 年份减10
            const minValueRange = this.getYearRange(this.min.getFullYear()); // 最小年：年面板的范围
            const currentYearRange = this.getYearRange(year); // 当前年面板的范围
            // 当年份大于等于最小年面板的最小值是有效的
            if (year >= minValueRange.min) {
                this.date.year = currentYearRange.min; // 默认跳转到年面板的第一个有效年
                // 设置下拉面板头部显示文本
                this.setYearMonthText();
                // 设置左右键状态
                this.setYearRangePreNextState();
                // 设置年份面板的值和状态
                this.setYearArr();
                this.setEndpanelYearArr();
            }
        }
    }
    // 处理左侧月后退按钮事件
    onPreMonthClick(event) {
        // 最小月，最小年，最小年时间段：左按钮灰化
        if (this.isMinMonth) {
            return;
        }
        // 日期面板
        let month;
        let year;
        if (this.date.month === 1) {
            month = 12;
            year = this.date.year - 1;
        }
        else {
            month = this.date.month - 1;
            year = this.date.year;
        }
        if (!this.isSmallerThanMinMonth(year, month)) {
            this.date.month = month;
            this.date.year = year;
            this.setYearMonthText();
            this.setPreNextState(year, month);
            this.setDayArr();
            this.setNextDayArr();
        }
    }
    // 处理右侧月前进按钮事件
    onNextMonthClick(event) {
        // 最大月，最大年，最大年时间段
        if (this.isMaxMonth) {
            return;
        }
        let month;
        let year;
        if (this.date.month === 12) {
            month = 1;
            year = this.date.year + 1;
        }
        else {
            month = this.date.month + 1;
            year = this.date.year;
        }
        if (!this.isBiggerThanMaxMonth(year, month)) {
            this.date.month = month;
            this.date.year = year;
            this.setYearMonthText();
            this.setPreNextState(year, month);
            this.setDayArr();
            this.setNextDayArr();
        }
    }
    // 处理右侧年前进按钮事件
    onNextYearClick(event) {
        // 最大月，最大年，最大年时间段
        if (this.isPickerYearMaxValue()) {
            return;
        }
        // 日期和月份面板
        if (this.picker === 'day' || this.picker === 'month' || this.picker === 'onlyYearMonth') {
            const year = this.date.year + 1; // 年份加1
            if (year <= this.max.getFullYear()) { // 判断是否小于等于最大年
                this.date.year = year;
                if (this.isBiggerThanMaxMonth(year, this.date.month)) {
                    this.date.month = this.max.getMonth() + 1;
                }
                this.setYearMonthText();
                this.setPreNextState(year, this.date.month);
                this.setDayMonthArr(this.picker);
            }
            return;
        }
        // 年面板
        if (this.picker === 'year' || this.picker === 'onlyYear') {
            const year = this.date.year + 10; // 年份加10
            const maxValueRange = this.getYearRange(this.max.getFullYear());
            const currentYearRange = this.getYearRange(year);
            // 当年份小于等于最大年面板的最大值是有效的
            if (year <= maxValueRange.max) {
                this.date.year = currentYearRange.min;
                // 设置下拉面板头部显示文本
                this.setYearMonthText();
                // 设置左右键状态
                this.setYearRangePreNextState();
                // 设置年份面板的值和状态
                this.setYearArr();
                this.setEndpanelYearArr();
            }
        }
    }
    // 面板头部文本点击事件
    onHeadTextClick(picker) {
        // 点击日期面板头部，跳转到月份面板
        this.picker = picker;
        this.pickerChange.emit(picker);
    }
    // 日期面板：日期点击事件
    onDayClick(isNext, day, event) {
        if (day.state === 'disable') {
            return;
        }
        if (day.state === 'preMonth') { // 如果是上个月的日期则跳转到上个月
            this.onPreMonthClick(event);
        }
        else if (day.state === 'nextMonth') { // 如果是下个月的日期则跳转到下个月
            this.onNextMonthClick(event);
        }
        let dateSelect;
        const newDate = JSON.parse(JSON.stringify(this.date));
        if (isNext) {
            newDate.year = this.date.month === 12 ? this.date.year + 1 : this.date.year;
            newDate.month = this.date.month === 12 ? 1 : this.date.month + 1;
            dateSelect = new Date(newDate.year, newDate.month - 1, Number(day.value));
        }
        else {
            dateSelect = new Date(this.date.year, this.date.month - 1, day.value);
        }
        if (this.focusedPosition !== 'begin' && this.isRange) {
            if (this.value.end === null && this.value.begin !== null && TiDateUtil.isBigger(this.value.begin, dateSelect)) {
                this.value.begin = dateSelect;
                this.valueChange.emit(this.value);
                // 事件回调：点击日期执行面板收起操作
                this.select.emit(day.state);
                return;
            }
            this.value.end = dateSelect;
            if (this.value.begin !== null && TiDateUtil.isBigger(this.value.begin, this.value.end)) {
                this.value.begin = null;
            }
        }
        else {
            this.value.begin = dateSelect;
            if (this.value.end !== null && TiDateUtil.isBigger(this.value.begin, this.value.end)) {
                this.value.end = null;
            }
        }
        this.valueChange.emit(this.value);
        // 事件回调：点击日期执行面板收起操作
        this.select.emit(day.state);
    }
    // 月份面板：月份点击事件
    onMonthClick(month, event, isEndClick) {
        // 月份灰化不可点击
        if (month.state === 'disable') {
            return;
        }
        // 当前月值变更
        this.date.month = this.local.monthArr.indexOf(String(month.value)) + 1;
        // 根据当前月更新面板头部月份显示
        this.pickerValue = this.pickerValue instanceof Object ? this.pickerValue : {};
        this.nextPickerValue = this.nextPickerValue instanceof Object ? this.nextPickerValue : {};
        this.pickerValue['month'] = this.local.monthArr[this.date.month - 1];
        this.nextPickerValue['month'] = this.date.month === 12 ? this.local.monthArr[0] : this.local.monthArr[this.date.month];
        // 无日期面板：点击月份将value值变更。将执行select事件回调
        // 有日期面板：点击跳转到日期面板，根据年月设置左右按钮状态和日期面板值；
        if (this.format.indexOf('d') === -1) { // 只显示年月
            this.date.year = isEndClick ? this.date.year + 1 : this.date.year;
            if (this.focusedPosition === 'begin') {
                this.value.begin = new Date(this.date.year, this.date.month - 1);
            }
            else {
                this.value.end = new Date(this.date.year, this.date.month - 1);
            }
            this.valueChange.emit(this.value);
            this.select.emit();
        }
        else {
            this.picker = 'day';
            this.pickerChange.emit(this.picker);
        }
    }
    // 年范围面板：年点击事件
    onYearClick(year, event) {
        if (year.state !== 'disable') {
            this.date.year = year.value;
            this.pickerValue = this.pickerValue instanceof Object ? this.pickerValue : {};
            this.nextPickerValue = this.nextPickerValue instanceof Object ? this.nextPickerValue : {};
            this.pickerValue['year'] = `${this.date.year}${this.local.yearText}`;
            this.nextPickerValue['year'] = this.date.month === 12 ? `${this.date.year + 1}${this.local.yearText}`
                : `${this.date.year}${this.local.yearText}`;
            this.nextPickerValue['onlyYear'] = `${this.date.year + 1}${this.local.yearText}`;
            // 只有年份面板
            if (this.format.indexOf('M') === -1) {
                if (this.focusedPosition === 'begin') {
                    this.value.begin = new Date(this.date.year, 1, 1);
                }
                else {
                    this.value.end = new Date(this.date.year, 1, 1);
                }
                this.valueChange.emit(this.value);
                this.select.emit();
                return;
            }
            // 年月格式
            if (this.format.indexOf('d') === -1) {
                this.picker = 'onlyYearMonth';
                this.setDayMonthArr(this.picker);
                return;
            }
            this.picker = 'month';
            this.pickerChange.emit(this.picker);
        }
    }
    onSelect(val, timeOption) {
        const obj = {
            timeOption,
            val
        };
        this.selectTimeFn.emit(obj);
        switch (timeOption) {
            case 'beginHour':
                this.timeHandleFn(val, this.beginHourContainerRef);
                break;
            case 'beginMinute':
                this.timeHandleFn(val, this.beginMinuteContainerRef);
                break;
            case 'beginSecond':
                this.timeHandleFn(val, this.beginSecondContainerRef);
                break;
            case 'endHour':
                this.timeHandleFn(val, this.endHourContainerRef);
                break;
            case 'endMinute':
                this.timeHandleFn(val, this.endMinuteContainerRef);
                break;
            case 'endSecond':
                this.timeHandleFn(val, this.endSecondContainerRef);
                break;
            default:
                break;
        }
    }
    // 分年月日三个面板：根据不同面板设置相应的值
    setDatePanel() {
        // 设置下拉面板头部显示文本
        this.setYearMonthText();
        // 设置年月文本；设置左右键状态；设置下拉面板中日期
        switch (this.picker) {
            case 'day':
                this.setPreNextState(this.date.year, this.date.month);
                this.setDayArr();
                this.setNextDayArr();
                break;
            case 'month':
            case 'onlyYearMonth':
                this.setPreNextState(this.date.year, this.date.month);
                this.setMonthArr();
                this.setEndpanelMonthArr();
                break;
            case 'year':
            case 'onlyYear':
                this.setYearRangePreNextState();
                this.setYearArr();
                this.setEndpanelYearArr();
                break;
            default:
                break;
        }
    }
    /**
     * @description 设置展示的日期
     */
    setValue() {
        // 1.根据接口值获取合法的当前值
        let date;
        let today;
        if ((this.value instanceof Object) && TiDateUtil.isDate(this.value.begin)) {
            date = this.value.begin;
        }
        else if ((this.value instanceof Object) && TiDateUtil.isDate(this.value.end)) {
            date = this.value.end;
        }
        else {
            // 1.1根据nowDateTime接口获取现在时间
            today = (this.nowDateTime && TiDateUtil.isDate(this.nowDateTime)) ? this.nowDateTime : new Date();
            // 1.2根据最大值最小值对获取的现在时间进行进一步判断
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            date = (!this.isBiggerThanMaxDay(year, month, day) && !this.isSmallerThanMinDay(year, month, day))
                ? today : this.min;
        }
        // 2.将当前时间的年月日存在对象
        this.date = {
            year: date.getFullYear(),
            month: date.getMonth() + 1,
            day: date.getDate()
        };
        this.setDatePanel();
    }
    /**
     * @description 判断参数传来的日期是否大于最大日期：大于返回true，小于返回false
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isBiggerThanMaxDay(year, month, day) {
        // 1.最大值不是合法的时间对象
        if (!TiDateUtil.isDate(this.max)) {
            return false;
        }
        // 2.重新生成一个新的最大值的原因：防止传入一个带时分的最大值
        let max = this.max;
        max = new Date(max.getFullYear(), max.getMonth(), max.getDate());
        if (max.getTime() < new Date(year, month - 1, day).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 判断参数传来的日期是否小于最小日期：小于返回true，大于返回false
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isSmallerThanMinDay(year, month, day) {
        if (!TiDateUtil.isDate(this.min)) {
            return false;
        }
        // 防止传入一个带时分的最小值
        let min = this.min;
        min = new Date(min.getFullYear(), min.getMonth(), min.getDate());
        if (min.getTime() > new Date(year, month - 1, day).getTime()) {
            return true;
        }
        return false;
    }
    // 是否为禁用日期
    isDisabledDay(year, month, day) {
        if (!Util.isArray(this.disabledDays)) {
            return false;
        }
        let isDisabled = false;
        this.disabledDays.forEach((item) => {
            if (item.getTime() === new Date(year, month - 1, day).getTime()) {
                isDisabled = true;
            }
        });
        return isDisabled;
    }
    // 开始日期或者结束日期固定不允许修改时，超出范围的需要禁用
    isFixedWithDisabled(year, month, day) {
        if (!this.isBeginFixed && !this.isEndFixed || this.value === null) {
            return false;
        }
        // 开始日期有值并且禁用
        if (this.isBeginFixed) {
            if (this.value.begin.getTime() > new Date(year, month - 1, day).getTime()) {
                return true;
            }
        }
        if (this.isEndFixed) {
            if (this.value.end.getTime() < new Date(year, month - 1, day).getTime()) {
                return true;
            }
        }
        return false;
    }
    /**
     * @description 设置下拉面板中年月文本
     */
    setYearMonthText() {
        // 1.大于等于最大年，设置年为最大年，月大于最大月，设置为最大月；
        if (this.date.year >= this.max.getFullYear()) {
            this.date.year = this.max.getFullYear();
            if (this.date.month > (this.max.getMonth() + 1)) {
                this.date.month = this.max.getMonth() + 1;
            }
        }
        // 2.小于等于最小年，设置年为最小年，月份小于最小月设置为最小月；
        if (this.date.year <= this.min.getFullYear()) {
            this.date.year = this.min.getFullYear();
            if (this.date.month < (this.min.getMonth() + 1)) {
                this.date.month = this.min.getMonth() + 1;
            }
        }
        // 3.根据年月值，拼成下拉面板中年月文本
        const start = this.date.year - this.date.year % 10;
        this.pickerValue = this.pickerValue instanceof Object ? this.pickerValue : {};
        this.nextPickerValue = this.nextPickerValue instanceof Object ? this.nextPickerValue : {};
        this.pickerValue['year'] = `${this.date.year}${this.local.yearText}`;
        this.nextPickerValue['onlyYear'] = `${this.date.year + 1}${this.local.yearText}`;
        this.nextPickerValue['year'] = this.date.month === 12 ? `${this.date.year + 1}${this.local.yearText}`
            : `${this.date.year}${this.local.yearText}`;
        this.pickerValue['month'] = this.local.monthArr[this.date.month - 1];
        this.nextPickerValue['month'] = this.date.month === 12 ? this.local.monthArr[0] : this.local.monthArr[this.date.month];
        this.pickerValue['yearRange'] = `${start} - ${start + 9}`;
        this.pickerValue['endpanelYearRange'] = `${start + 10} - ${start + 19}`;
    }
    /**
     * @description 设置上月、下月按钮状态：已经是最大、最小月时，将对应的按钮置灰
     * @param year 年份
     * @param month 月份
     */
    setPreNextState(year, month) {
        this.isMaxMonth = this.isEqualToMaxMonth(year, month);
        this.isMinMonth = this.isEqualToMinMonth(year, month);
        this.isMaxYear = year === this.max.getFullYear();
        this.isMinYear = year === this.min.getFullYear();
    }
    /**
     * @description 判断参数传来的年月是否等于最大月份：等于返回true，不等于返回false
     * @param year 年份
     * @param month 月份
     */
    isEqualToMaxMonth(year, month) {
        // 1.最大值不是合法的时间对象
        if (!TiDateUtil.isDate(this.max)) {
            return false;
        }
        // 2.重新生成一个新的最大值的原因：防止传入一个带时分的最大值
        let max = this.max;
        max = new Date(max.getFullYear(), max.getMonth(), 1);
        if (max.getTime() === new Date(year, month - 1, 1).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 判断参数传来的年月是否等于最小月份：等于返回true，不等于返回false
     * @param year 年份
     * @param month 月份
     */
    isEqualToMinMonth(year, month) {
        if (!TiDateUtil.isDate(this.min)) {
            return false;
        }
        let min = this.min;
        min = new Date(min.getFullYear(), min.getMonth(), 1);
        if (min.getTime() === new Date(year, month - 1, 1).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 根据面板设置 dayArr或monthArr
     *
     */
    setDayMonthArr(picker) {
        if (picker === 'day') {
            this.setDayArr();
            this.setNextDayArr();
        }
        else if (picker === 'month' || picker === 'onlyYearMonth') {
            this.setMonthArr();
            this.setEndpanelMonthArr();
        }
    }
    /**
     * @description 根据当前年月值，设置下拉面板中显示的日数据
     */
    // tslint:disable-next-line:cyclomatic-complexity
    // eslint-disable-next-line complexity
    setDayArr() {
        // 获取当前年月
        const year = parseInt(String(this.date.year), 10);
        const month = parseInt(String(this.date.month), 10);
        // 1：计算这个月1号是下拉面板第一行的第几个
        // 获取到这个月1号是周几 周一到周六：1-6，周天：0；
        const begin = new Date(year, month - 1, 1).getDay();
        // 2：将上个月的日期存入数组dateArr
        const dateArr = []; // 存储下拉面板中所有日的值和状态
        const preMonth = (month === 1 ? 12 : (month - 1)); // 上个月
        const preMonthDays = new Date(year, preMonth, 0).getDate(); // 上个月总天数
        const preMonthStart = preMonthDays - begin + 1; // 获取到第一行的起始值
        let preMonthDayState = ''; // 上个月日期的状态
        // 本月是最小月时的上月日期置灰
        preMonthDayState = this.isMinMonth ? 'disable' : 'preMonth';
        for (let i = 0; i < begin; i++) {
            dateArr[i] = {
                value: preMonthStart + i,
                state: preMonthDayState
            };
            if (this.isSmallerThanMinDay(year, month - 1, preMonthStart + i) || this.isDisabledDay(year, month - 1, preMonthStart + i)
                || this.isFixedWithDisabled(year, month - 1, preMonthStart + i)) {
                dateArr[i].state = 'disable';
            }
        }
        // 3：将本月的日存入数组dateArr
        let dayNum = 1;
        const monthDays = new Date(year, month, 0).getDate(); // 这个月总天数
        const length = begin + monthDays;
        let state = '';
        for (let j = begin; j < length; j++) {
            if (this.isBiggerThanMaxDay(year, month, dayNum) ||
                this.isSmallerThanMinDay(year, month, dayNum) ||
                this.isDisabledDay(year, month, dayNum) ||
                this.isFixedWithDisabled(year, month, dayNum)) {
                state = 'disable'; // 日样式置灰
            }
            else if (this.isEqualToValue('day', year, month, dayNum)) {
                state = 'current'; // 当前选中
            }
            else if (this.isBetweenInRange(year, month, dayNum)) {
                state = 'select'; // 在选中范围
            }
            else {
                state = 'default'; // 没有选中
            }
            dateArr[j] = {
                value: dayNum,
                state,
                isToday: this.isEqualToToday('day', year, month, dayNum)
            };
            dayNum++;
        }
        // 4：将下个月的日存入数组dateArr
        dayNum = 1;
        const nextMonthDayState = this.isMaxMonth ? 'disable' : 'nextMonth'; // 下个月日期的状态
        for (let k = dateArr.length; k < 42; k++) {
            dateArr[k] = {
                value: dayNum,
                state: nextMonthDayState
            };
            if (this.isBiggerThanMaxDay(year, month + 1, dayNum) || this.isDisabledDay(year, month + 1, dayNum)
                || this.isFixedWithDisabled(year, month + 1, dayNum)) {
                dateArr[k].state = 'disable';
            }
            dayNum++;
        }
        // 5：将dateArr组装成下拉面板中显示日的二维数组dayArr
        for (let p = 0; p < dateArr.length / 7; p++) {
            this.dayArr[p] = [];
            for (let q = 0; q < 7; q++) {
                this.dayArr[p].push(dateArr[q + p * 7]);
            }
        }
    }
    /**
      * @description 根据当前年月值，设置下拉面板中显示的日数据
      */
    // tslint:disable-next-line:cyclomatic-complexity
    // eslint-disable-next-line complexity
    setNextDayArr() {
        // 获取当前年月
        const sss = this.date.month === 12 ? 1 : this.date.month + 1;
        const yyy = this.date.month === 12 ? this.date.year + 1 : this.date.year;
        const year = parseInt(String(yyy), 10);
        const month = parseInt(String(sss), 10);
        //    const monthNext: number = parseInt(String(this.date.month + 1), 10);
        // 1：计算这个月1号是下拉面板第一行的第几个
        // 获取到这个月1号是周几 周一到周六：1-6，周天：0；
        const begin = new Date(year, month - 1, 1).getDay();
        // 2：将上个月的日期存入数组dateArr
        const dateArr = []; // 存储下拉面板中所有日的值和状态
        const preMonth = (month === 1 ? 12 : (month - 1)); // 上个月
        const preMonthDays = new Date(year, preMonth, 0).getDate(); // 上个月总天数
        const preMonthStart = preMonthDays - begin + 1; // 获取到第一行的起始值
        for (let i = 0; i < begin; i++) {
            dateArr[i] = {
                value: preMonthStart + i,
                state: 'preMonth'
            };
            if (this.isBiggerThanMaxDay(year, month - 1, preMonthStart + i) ||
                this.isSmallerThanMinDay(year, month - 1, preMonthStart + i) ||
                this.isDisabledDay(year, month - 1, preMonthStart + i) ||
                this.isFixedWithDisabled(year, month - 1, preMonthStart + i)) {
                dateArr[i].state = 'disable';
            }
        }
        // 3：将本月的日存入数组dateArr
        let dayNum = 1;
        const monthDays = new Date(year, month, 0).getDate(); // 这个月总天数
        const length = begin + monthDays;
        let state = '';
        for (let j = begin; j < length; j++) {
            if (this.isBiggerThanMaxDay(year, month, dayNum) ||
                this.isSmallerThanMinDay(year, month, dayNum) ||
                this.isDisabledDay(year, month, dayNum) ||
                this.isFixedWithDisabled(year, month, dayNum)) {
                state = 'disable'; // 日样式置灰
            }
            else if (this.isEqualToValue('day', year, month, dayNum)) {
                state = 'current'; // 当前选中
            }
            else if (this.isBetweenInRange(year, month, dayNum)) {
                state = 'select'; // 在选中范围
            }
            else {
                state = 'default'; // 没有选中
            }
            dateArr[j] = {
                value: dayNum,
                state,
                isToday: this.isEqualToToday('day', year, month, dayNum)
            };
            dayNum++;
        }
        // 4：将下个月的日存入数组dateArr
        dayNum = 1;
        const nextMonthDayState = this.isMaxMonth ? 'disable' : 'nextMonth'; // 下个月日期的状态
        for (let k = dateArr.length; k < 42; k++) {
            dateArr[k] = {
                value: dayNum,
                state: nextMonthDayState
            };
            if (this.isBiggerThanMaxDay(year, month + 1, dayNum) ||
                this.isDisabledDay(year, month + 1, dayNum) ||
                this.isFixedWithDisabled(year, month + 1, dayNum)) {
                dateArr[k].state = 'disable';
            }
            dayNum++;
        }
        // 5：将dateArr组装成下拉面板中显示日的二维数组dayArr
        for (let p = 0; p < dateArr.length / 7; p++) {
            this.nextdayArr[p] = [];
            for (let q = 0; q < 7; q++) {
                this.nextdayArr[p].push(dateArr[q + p * 7]);
            }
        }
    }
    /**
     * @description 判断参数传来的日期是否begin值小于end的值，end值大于begion值
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isOutInRange(year, month, day) {
        const value = this.value;
        const curValue = new Date(year, month - 1, day).getTime();
        if (!(value instanceof Object)) {
            return false;
        }
        let end = value.end;
        let endValue;
        if (TiDateUtil.isDate(value.end)) {
            // 只取年月日：防止传入带有时分秒的值
            end = new Date(end.getFullYear(), end.getMonth(), end.getDate());
            endValue = end.getTime();
            return curValue > endValue;
        }
        return false;
    }
    /**
     * @description 判断参数传来的日期是否等于当前选中的日期：等于返回true，不等于返回false
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isEqualToValue(type, year, month, day) {
        const beginVal = this.value.begin;
        const endVal = this.value.end;
        if (beginVal === null && endVal === null) {
            return false;
        }
        else {
            let value1;
            let value2;
            let beginV;
            let endV;
            if (beginVal !== null) {
                value1 = new Date(beginVal.getFullYear(), beginVal.getMonth(), beginVal.getDate());
                beginV = this.isEqualValue(type, value1, year, month, day);
            }
            if (endVal !== null) {
                value2 = new Date(endVal.getFullYear(), endVal.getMonth(), endVal.getDate());
                endV = this.isEqualValue(type, value2, year, month, day);
            }
            return beginV || endV;
        }
    }
    /**
     * @description 判断参数传来的日期是否在当前选中日期的范围内,并且不等于当前选中的值：符合返回true，不符合返回false
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isBetweenInRange(year, month, day) {
        const value = this.value;
        // value不是对象，begin或者end不是合法日期
        if (!(value instanceof Object) || !TiDateUtil.isDate(value.begin) || !TiDateUtil.isDate(value.end)) {
            return false;
        }
        let begin = value.begin;
        begin = new Date(begin.getFullYear(), begin.getMonth(), begin.getDate());
        const beginValue = begin.getTime();
        let end = value.end;
        end = new Date(end.getFullYear(), end.getMonth(), end.getDate());
        const endValue = end.getTime();
        const curValue = new Date(year, month - 1, day).getTime();
        if (beginValue < curValue && curValue <= endValue) {
            return true;
        }
        return false;
    }
    /**
     * @description 判断参数传来的日期是否等于当前日期时间
     * @param year 年份
     * @param month 月份
     * @param day 日
     */
    isEqualToToday(type, year, month, day) {
        const today = (this.nowDateTime && TiDateUtil.isDate(this.nowDateTime)) ? this.nowDateTime : new Date();
        return this.isEqualValue(type, today, year, month, day);
    }
    // 判断日期是当前日期或当前选中日期
    // tslint:disable-next-line:prefer-function-over-method
    isEqualValue(type, value, year, month, day) {
        let _value;
        if (type === 'year') { // 年
            _value = value.getFullYear();
            if (_value === year) {
                return true;
            }
            return false;
        }
        if (type === 'month') { // 年、月
            _value = new Date(value.getFullYear(), value.getMonth());
            if (_value.getTime() === new Date(year, month - 1).getTime()) {
                return true;
            }
            return false;
        }
        // 年、月、日
        _value = new Date(value.getFullYear(), value.getMonth(), value.getDate());
        if (_value.getTime() === new Date(year, month - 1, day).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 根据当前年份和最大最小值，设置下拉面板中显示的月份状态
     */
    setMonthArr() {
        const year = this.date.year;
        const innerMonth = [];
        let state = '';
        // 设置每个月份对应的值和状态
        for (let month = 1; month <= 12; month++) {
            // tslint:disable-next-line:prefer-conditional-expression
            if (this.isSmallerThanMinMonth(year, month) || (this.isBiggerThanMaxMonth(year, month))) {
                state = 'disable'; // 月样式置灰
            }
            else if (this.isEqualToValue('month', year, month)) {
                state = 'current'; // 当前选中
            }
            else {
                state = 'default'; // 没有选中
            }
            innerMonth[month - 1] = {
                value: this.local.monthArr[month - 1],
                state,
                isMonth: this.isEqualToToday('month', year, month)
            };
        }
        // 将月份数据格式化为二维数组
        this.monthArr = [];
        for (let p = 0; p < 3; p++) {
            this.monthArr[p] = [];
            for (let q = 0; q < 4; q++) {
                this.monthArr[p].push(innerMonth[q + p * 4]);
            }
        }
    }
    /**
     * @description 根据当前年份和最大最小值，设置下拉面板中显示的月份状态
     */
    setEndpanelMonthArr() {
        const year = this.date.year + 1;
        const innerMonth = [];
        let state = '';
        // 设置每个月份对应的值和状态
        for (let month = 1; month <= 12; month++) {
            // tslint:disable-next-line:prefer-conditional-expression
            if (this.isSmallerThanMinMonth(year, month) || (this.isBiggerThanMaxMonth(year, month))) {
                state = 'disable'; // 月样式置灰
            }
            else if (this.isEqualToValue('month', year, month)) {
                state = 'current'; // 当前选中
            }
            else {
                state = 'default'; // 没有选中
            }
            innerMonth[month - 1] = {
                value: this.local.monthArr[month - 1],
                state,
                isMonth: this.isEqualToToday('month', year, month)
            };
        }
        // 将月份数据格式化为二维数组
        this.endpanelMonthArr = [];
        for (let p = 0; p < 3; p++) {
            this.endpanelMonthArr[p] = [];
            for (let q = 0; q < 4; q++) {
                this.endpanelMonthArr[p].push(innerMonth[q + p * 4]);
            }
        }
    }
    /**
     * @description 判断参数传来的年月是否小于最小月份：小于返回true，大于返回false
     * @param year 年份
     * @param month 月份
     */
    isSmallerThanMinMonth(year, month) {
        if (!TiDateUtil.isDate(this.min)) {
            return false;
        }
        let min = this.min;
        min = new Date(min.getFullYear(), min.getMonth(), 1);
        if (min.getTime() > new Date(year, month - 1, 1).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 判断参数传来的年月是否大于最大月份：大于返回true，小于返回false
     * @param year 年份
     * @param month 月份
     */
    isBiggerThanMaxMonth(year, month) {
        if (!TiDateUtil.isDate(this.max)) {
            return false;
        }
        let max = this.max;
        max = new Date(max.getFullYear(), max.getMonth(), 1);
        if (max.getTime() < new Date(year, month - 1, 1).getTime()) {
            return true;
        }
        return false;
    }
    /**
     * @description 设置按钮状态：
     */
    setYearRangePreNextState() {
        const minValueRange = this.getYearRange(this.min.getFullYear());
        const maxValueRange = this.getYearRange(this.max.getFullYear());
        this.isMaxYearRange = (this.date.year >= maxValueRange.min && this.date.year <= maxValueRange.max) ? true : false;
        this.isMinYearRange = (this.date.year >= minValueRange.min && this.date.year <= minValueRange.max) ? true : false;
    }
    // 获取时间面板：最大值和最小值年面板范围
    getYearRange(year) {
        const minDateRange = year - year % 10;
        const maxDateRange = minDateRange + 9;
        return {
            min: minDateRange,
            max: maxDateRange
        };
    }
    /**
     * @description 根据当前年份和最大最小值，设置下拉面板中显示的年份状态
     */
    setYearArr() {
        // 1.获取当前年；算出起始年，
        const innerYear = []; // 存储年值
        const year = this.date.year - this.date.year % 10;
        // 2.数组的第一个为起始年 -1；
        const start = year - 1;
        const end = year + 9;
        let index = 0;
        let state = '';
        const preYearRange = (start <= this.min.getFullYear()) ? 'disable' : 'preYear';
        innerYear.push({
            state: preYearRange,
            value: start
        });
        // 3.起始年  - 最终年（起始年+9）（for遍历）
        for (let i = year; i <= end; i++) {
            index++;
            if (i < this.min.getFullYear() || i > this.max.getFullYear()) {
                state = 'disable';
            }
            else if (this.isEqualToValue('year', i)) {
                state = 'current'; // 当前选中
            }
            else {
                state = 'default';
            }
            innerYear[index] = {
                value: i,
                state,
                isYear: this.isEqualToToday('year', i)
            };
        }
        // 判断是不是大于最大年：大于最大年状态为灰化
        const nextYearRange = (end >= this.max.getFullYear()) ? 'disable' : 'nextYear';
        innerYear.push({
            state: nextYearRange,
            value: end + 1
        });
        // 将月份数据格式化为二维数组
        this.yearArr = [];
        for (let p = 0; p < 3; p++) {
            this.yearArr[p] = [];
            for (let q = 0; q < 4; q++) {
                this.yearArr[p].push(innerYear[q + p * 4]);
            }
        }
    }
    /**
     * @description 根据当前年份和最大最小值，设置下拉面板中显示的年份状态
     */
    setEndpanelYearArr() {
        // 1.获取当前年；算出起始年，
        const innerYear = []; // 存储年值
        const year = this.date.year - this.date.year % 10 + 10;
        // 2.数组的第一个为起始年 -1；
        const start = year - 1;
        const end = year + 9;
        let index = 0;
        let state = '';
        const preYearRange = (start <= this.min.getFullYear()) ? 'disable' : 'preYear';
        innerYear.push({
            state: preYearRange,
            value: start
        });
        // 3.起始年  - 最终年（起始年+9）（for遍历）
        for (let i = year; i <= end; i++) {
            index++;
            if (i < this.min.getFullYear() || i > this.max.getFullYear()) {
                state = 'disable';
            }
            else if (this.isEqualToValue('year', i)) {
                state = 'current'; // 当前选中
            }
            else {
                state = 'default';
            }
            innerYear[index] = {
                value: i,
                state,
                isYear: this.isEqualToToday('year', i)
            };
        }
        // 判断是不是大于最大年：大于最大年状态为灰化
        const nextYearRange = (end >= this.max.getFullYear()) ? 'disable' : 'nextYear';
        innerYear.push({
            state: nextYearRange,
            value: end + 1
        });
        // 将月份数据格式化为二维数组
        this.endpanelYearArr = [];
        for (let p = 0; p < 3; p++) {
            this.endpanelYearArr[p] = [];
            for (let q = 0; q < 4; q++) {
                this.endpanelYearArr[p].push(innerYear[q + p * 4]);
            }
        }
    }
    // 设置左年后退按钮灰化
    isPickerYearMinValue() {
        return this.picker === 'year' ? this.isMinYearRange : this.isMinYear;
    }
    // 设置右年前进按钮灰化
    isPickerYearMaxValue() {
        return this.picker === 'year' ? this.isMaxYearRange : this.isMaxYear;
    }
    trackByFn(index, item) {
        return index;
    }
    setOptions(num, pos) {
        const options = [];
        for (let i = 0; i < num; i++) {
            options[i] = {
                label: i < 10 ? '0' + i : String(i),
                disabled: pos === 'end' ? this.endTimeDisabled : this.beginTimeDisabled
            };
        }
        return options;
    }
    /**
    * @ignore
    * 时间选择框部分鼠标移出时去除hover样式
    */
    onMouseleave(listCom) {
        listCom.hoverOption = null;
    }
}
TiDatePanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-date-panel',
                template: "<!-- 1.\u9762\u677F\u5934\u90E8-->\r\n<section class=\"ti3-date-picker-header\" *ngIf='!selectTime'>\r\n    <!-- 1.1\u5DE6\u6309\u94AE-->\r\n    <section class=\"ti3-date-picker-icons-prev\">\r\n      <!-- \u6309\u5E74\u540E\u9000 -->\r\n      <section class=\"ti3-icon ti3-icon-left-2\"\r\n        [ngClass]=\"{'ti3-date-state-disabled' : isPickerYearMinValue()}\" [id]=\"appendId('pre-year')\"\r\n        (click)=\"onPreYearClick($event)\">\r\n      </section>\r\n      <!-- \u6309\u6708\u540E\u9000-->\r\n      <section *ngIf=\"picker === 'day'\" class=\"ti3-icon ti3-icon-left-1\"\r\n        [ngClass]=\"{'ti3-date-state-disabled' : isMinMonth}\" [id]=\"appendId('pre-month')\"\r\n        (click)=\"onPreMonthClick($event)\">\r\n      </section>\r\n    </section>\r\n    <!-- 1.2\u53F3\u6309\u94AE -->\r\n    <section class=\"ti3-date-picker-icons-next\">\r\n      <!-- \u6309\u6708\u524D\u8FDB-->\r\n      <section #next *ngIf=\"picker === 'day'\" class=\"ti3-icon ti3-icon-right-1\"\r\n        [ngClass]=\"{'ti3-date-state-disabled' : isMaxMonth}\" [id]=\"appendId('next-month')\"\r\n        (click)=\"onNextMonthClick($event)\">\r\n      </section>\r\n      <!-- \u6309\u5E74\u524D\u8FDB -->\r\n      <section #nextYear class=\" ti3-icon ti3-icon-right-2\"\r\n        [ngClass]=\"{'ti3-date-state-disabled' :isPickerYearMaxValue()}\" [id]=\"appendId('next-year')\"\r\n        (click)=\"onNextYearClick($event)\">\r\n      </section>\r\n    </section>\r\n    <!-- 1.3\u5E74\u6708\u65E5/\u5E74\u6708\u6587\u672C\u663E\u793A\u533A\u57DF-->\r\n    <section class=\"ti3-header-year-month-picker\">\r\n        <section class=\"ti3-date-picker-year-month\" [ngClass]=\"{'ti3-date-picker-year-month-text': !isRange || picker !== 'day' && picker !== 'onlyYear'&& picker !== 'onlyYearMonth'}\"\r\n             [id]=\"appendId('head')\">\r\n            <div [ngClass]=\"{'ti3-date-picker-text' : isRange && (picker === 'day' || picker === 'onlyYear' || picker === 'onlyYearMonth')}\">\r\n                <span *ngIf=\"picker === 'day' && !isChinese\" (click)=\"onHeadTextClick('month')\" [id]=\"appendId('head_left_month')\">{{pickerValue.month}} </span>\r\n                <span *ngIf=\"picker === 'day' || picker === 'month' || picker === 'onlyYearMonth'\" (click)=\"onHeadTextClick('year')\" [id]=\"appendId('head_left_year')\">{{pickerValue.year}} </span>\r\n                <span *ngIf=\"picker === 'day' && isChinese\" (click)=\"onHeadTextClick('month')\" [id]=\"appendId('head_left_month')\">{{pickerValue.month}}</span>\r\n                <span *ngIf=\"picker === 'onlyYear' || picker === 'year'\">{{pickerValue.yearRange}}</span>\r\n            </div>\r\n            <div *ngIf=\"(picker === 'day' || picker === 'onlyYear' || picker === 'onlyYearMonth') && isRange\" class='ti3-date-picker-endpanel-text'>\r\n                <span *ngIf=\"picker === 'day' && !isChinese\" (click)=\"onHeadTextClick('month')\" [id]=\"appendId('head_right_month')\">{{nextPickerValue.month}} </span>\r\n                <span *ngIf=\"picker === 'day'\" (click)=\"onHeadTextClick('year')\" [id]=\"appendId('head_right_year')\">{{nextPickerValue.year}} </span>\r\n                <span *ngIf=\"picker === 'onlyYearMonth'\" (click)=\"onHeadTextClick('year')\" [id]=\"appendId('head_right_year')\">{{nextPickerValue.onlyYear}} </span>\r\n                <span *ngIf=\"picker === 'day' && isChinese\" (click)=\"onHeadTextClick('month')\" [id]=\"appendId('head_right_month')\">{{nextPickerValue.month}}</span>\r\n                <span *ngIf=\"picker === 'onlyYear'\">{{pickerValue.endpanelYearRange}}</span>\r\n            </div>\r\n        </section>\r\n    </section>\r\n</section>\r\n\r\n<!-- 2.\u65E5\u671F\u9762\u677F-->\r\n<section *ngIf=\"picker === 'day' && !selectTime\" class=\"ti3-date-picker-container\">\r\n        <section style='float:left'>\r\n            <!-- 2.1\u661F\u671F\uFF1A\u5468\u4E00\u5230\u5468\u4E94-->\r\n            <thead>\r\n                <tr>\r\n                    <th *ngFor=\"let week of local.weekArr; index as i\" class=\"ti3-date-week\" title=\"{{local.weekTitleArr[i]}}\">{{week}}</th>\r\n                </tr>\r\n            </thead>\r\n        <!-- 2.2\u65E5\u671F\uFF1A-->\r\n            <tbody>\r\n                <tr *ngFor=\"let week of dayArr; index as i; trackBy: trackByFn\" class=\"ti3-date-day-tr\">\r\n                    <th *ngFor=\"let day of week; index as j; trackBy: trackByFn\"\r\n                        [ngClass]=\"{'ti3-date-today-current-td': day.isToday && day.state === 'current'}\"\r\n                        (click)=\"onDayClick(false, day, $event)\">\r\n                        <section [ngClass]=\"{\r\n                            'ti3-date-current-day' : day.state === 'current',\r\n                            'ti3-dateRange-select-day' : day.state === 'select',\r\n                            'ti3-date-today' : day.isToday && day.state !== 'disable',\r\n                            'ti3-date-default-day' : day.state === 'default',\r\n                            'ti3-date-disable-day' : day.state === 'disable',\r\n                            'ti3-date-beside-day' : day.state === 'preMonth' || day.state === 'nextMonth'}\"\r\n                            [id]=\"appendId('day_left_' + i + '_' + j)\">{{day.value}}</section>\r\n                    </th>\r\n                </tr>\r\n            </tbody>\r\n        </section>\r\n        <section style='margin-left: 20px;float: right;' *ngIf='isRange'>\r\n            <thead>\r\n                <tr>\r\n                    <th *ngFor=\"let week of local.weekArr; index as i\" class=\"ti3-date-week\" title=\"{{local.weekTitleArr[i]}}\">{{week}}</th>\r\n                </tr>\r\n            </thead>\r\n            <!-- 2.2\u65E5\u671F\uFF1A-->\r\n            <tbody>\r\n                <tr *ngFor=\"let week of nextdayArr; index as i; trackBy: trackByFn\" class=\"ti3-date-day-tr\">\r\n                    <th *ngFor=\"let day of week; index as j; trackBy: trackByFn\"\r\n                        [ngClass]=\"{'ti3-date-today-current-td': day.isToday && day.state === 'current'}\"\r\n                        (click)=\"onDayClick(true, day, $event)\">\r\n                        <section [ngClass]=\"{\r\n                            'ti3-date-current-day' : day.state === 'current',\r\n                            'ti3-dateRange-select-day' : day.state === 'select',\r\n                            'ti3-date-today' : day.isToday && day.state !== 'disable',\r\n                            'ti3-date-default-day' : day.state === 'default',\r\n                            'ti3-date-disable-day' : day.state === 'disable',\r\n                            'ti3-date-beside-day' : day.state === 'preMonth' || day.state === 'nextMonth'}\"\r\n                            [id]=\"appendId('day_right_' + i + '_' + j)\">{{day.value}}</section>\r\n                    </th>\r\n                </tr>\r\n            </tbody>\r\n        </section>\r\n</section>\r\n\r\n<!-- 3.\u6708\u4EFD\u9762\u677F-->\r\n<section *ngIf=\"picker === 'month' && !selectTime\" class=\"ti3-date-picker-container ti3-date-picker-year\">\r\n    <section *ngFor=\"let monthList of monthArr; index as i\" class='ti3-date-year-month-picker-container'>\r\n        <section *ngFor=\"let month of monthList; index as j\" style='display: inline-block;'\r\n            (click)=\"onMonthClick(month, $event)\">\r\n            <section class=\"ti3-date-month\"\r\n                     [ngClass]=\"{'ti3-date-disable-month': month.state === 'disable',\r\n                                 'ti3-date-default-month' : month.state === 'default',\r\n                                 'ti3-date-current-month' : month.state === 'current',\r\n                                 'ti-date-nowMonth' : month.isMonth && month.state !== 'disable'}\"\r\n                                 [id]=\"appendId('month_' + i + '_' + j)\">{{month.value}}</section>\r\n        </section>\r\n    </section>\r\n</section>\r\n\r\n<!-- \u5E74\u6708\u683C\u5F0F\u5C55\u793A\u9762\u677F -->\r\n<section *ngIf=\"picker === 'onlyYearMonth' && !selectTime\" class=\"ti3-date-picker-year-month-container\">\r\n    <section  class=\"ti3-date-picker-container ti3-date-picker-year\">\r\n        <section *ngFor=\"let monthList of monthArr; index as i;\" class='ti3-date-year-month-picker-container'>\r\n            <section *ngFor=\"let month of monthList; index as j;\" style='display: inline-block;'\r\n                (click)=\"onMonthClick(month, $event, false)\">\r\n                <section class=\"ti3-date-month\"\r\n                         [ngClass]=\"{'ti3-date-disable-month': month.state === 'disable',\r\n                                     'ti3-date-default-month' : month.state === 'default',\r\n                                     'ti3-date-current-month' : month.state === 'current',\r\n                                     'ti-date-nowMonth' : month.isMonth && month.state !== 'disable'}\"\r\n                                     [id]=\"appendId('month_left_' + i + '_' + j)\">{{month.value}}</section>\r\n            </section>\r\n        </section>\r\n    </section>\r\n    <section *ngIf=\"isRange\" class=\"ti3-date-picker-container ti3-date-picker-year ti3-date-picker-right-zone\">\r\n        <section *ngFor=\"let monthList of endpanelMonthArr; index as i;\" class='ti3-date-year-month-picker-container'>\r\n            <section *ngFor=\"let month of monthList; index as j;\" style='display: inline-block;'\r\n                (click)=\"onMonthClick(month, $event, true)\">\r\n                <section class=\"ti3-date-month\"\r\n                         [ngClass]=\"{'ti3-date-disable-month': month.state === 'disable',\r\n                                     'ti3-date-default-month' : month.state === 'default',\r\n                                     'ti3-date-current-month' : month.state === 'current',\r\n                                     'ti-date-nowMonth' : month.isMonth && month.state !== 'disable'}\"\r\n                                     [id]=\"appendId('month_right_' + i + '_' + j)\">{{month.value}}</section>\r\n            </section>\r\n        </section>\r\n    </section>\r\n</section>\r\n\r\n<!-- 4.\u5E74\u9762\u677F -->\r\n<section *ngIf=\"picker === 'year' && !selectTime\" class=\"ti3-date-picker-container ti3-date-picker-month\">\r\n    <section *ngFor=\"let yearList of yearArr; index as i;\" class='ti3-date-year-month-picker-container'>\r\n        <section *ngFor=\"let year of yearList; index as j;\" style='display: inline-block;'\r\n            (click)=\"onYearClick(year, $event)\">\r\n            <section class=\"ti3-date-year\"\r\n                     [ngClass]=\"{'ti3-date-disable-year': year.state === 'disable',\r\n                                 'ti3-date-default-year' : year.state === 'default',\r\n                                 'ti3-date-preNext-year' : year.state === 'preYear' || year.state === 'nextYear',\r\n                                 'ti3-date-current-year' : year.state === 'current',\r\n                                 'ti-date-nowYear': year.isYear && year.state !== 'disable'}\"\r\n                                 [id]=\"appendId('year_' + i + '_' + j)\">{{year.value}}</section>\r\n        </section>\r\n    </section>\r\n</section>\r\n<!-- \u7EAF\u5E74\u4EFD\u5C55\u793A\u9762\u677F -->\r\n<section *ngIf=\"picker === 'onlyYear' && !selectTime\" class=\"ti3-date-picker-only-year-container\">\r\n    <section class=\"ti3-date-picker-container ti3-date-picker-month\">\r\n        <section *ngFor=\"let yearList of yearArr; index as i;\" class='ti3-date-year-month-picker-container'>\r\n            <section *ngFor=\"let year of yearList; index as j;\" style='display: inline-block;'\r\n                (click)=\"onYearClick(year, $event)\">\r\n                <section class=\"ti3-date-year\"\r\n                         [ngClass]=\"{'ti3-date-disable-year': year.state === 'disable',\r\n                                     'ti3-date-default-year' : year.state === 'default',\r\n                                     'ti3-date-preNext-year' : year.state === 'preYear' || year.state === 'nextYear',\r\n                                     'ti3-date-current-year' : year.state === 'current',\r\n                                     'ti-date-nowYear': year.isYear && year.state !== 'disable'}\"\r\n                                     [id]=\"appendId('year_left_' + i + '_' + j)\">{{year.value}}</section>\r\n            </section>\r\n        </section>\r\n    </section>\r\n    <section *ngIf=\"isRange\" class=\"ti3-date-picker-container ti3-date-picker-month ti3-date-picker-right-zone\">\r\n        <section *ngFor=\"let yearList of endpanelYearArr; index as i;\" class='ti3-date-year-month-picker-container'>\r\n            <section *ngFor=\"let year of yearList; index as j;\" style='display: inline-block;'\r\n                (click)=\"onYearClick(year, $event)\">\r\n                <section class=\"ti3-date-year\"\r\n                         [ngClass]=\"{'ti3-date-disable-year': year.state === 'disable',\r\n                                     'ti3-date-default-year' : year.state === 'default',\r\n                                     'ti3-date-preNext-year' : year.state === 'preYear' || year.state === 'nextYear',\r\n                                     'ti3-date-current-year' : year.state === 'current',\r\n                                     'ti-date-nowYear': year.isYear && year.state !== 'disable'}\"\r\n                                     [id]=\"appendId('year_right_' + i + '_' + j)\">{{year.value}}</section>\r\n            </section>\r\n        </section>\r\n    </section>\r\n</section>\r\n<!-- 5.\u65F6\u95F4\u9009\u62E9\u9762\u677F -->\r\n<div [hidden]='!selectTime' [ngClass]=\"{'ti3-time-select-panel': selectTime}\">\r\n    <div class='ti3-time-select-container' [ngClass]=\"{'ti3-time-select-container-border': selectTime}\">\r\n        <div class='ti3-time-hourselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.hour' | tiTranslate }}</span>\r\n            <ti-list #beginHourContainer\r\n               [options]='hourOptions'\r\n                [(ngModel)]=\"beginHour\"\r\n                (select)=\"onSelect($event, 'beginHour')\"\r\n                (mouseleave)=\"onMouseleave(beginHourContainer)\"\r\n                [id]=\"appendId('list_beginhour')\"></ti-list>\r\n        </div>\r\n        <div class='ti3-time-minuteselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.minute' | tiTranslate }}</span>\r\n           <ti-list #beginMinuteContainer [options]='minuteOptions'\r\n           [(ngModel)]=\"beginMinute\"\r\n           (select)=\"onSelect($event, 'beginMinute')\"\r\n           (mouseleave)=\"onMouseleave(beginMinuteContainer)\"\r\n           [id]=\"appendId('list_beginminute')\"></ti-list>\r\n        </div>\r\n        <div class='ti3-time-secondselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.second' | tiTranslate }}</span>\r\n            <ti-list #beginSecondContainer [options]='secondOptions'\r\n            [(ngModel)]=\"beginSecond\"\r\n            (select)=\"onSelect($event, 'beginSecond')\"\r\n            (mouseleave)=\"onMouseleave(beginSecondContainer)\"\r\n            [id]=\"appendId('list_beginsecond')\"></ti-list>\r\n        </div>\r\n    </div>\r\n    <div [hidden]='!isRange' class='ti3-time-select-container ti3-endtime-select-container' [ngClass]=\"{'ti3-endtime-select-none': !isRange, 'ti3-time-select-container-border': selectTime}\">\r\n        <div class='ti3-time-hourselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.hour' | tiTranslate }}</span>\r\n            <ti-list #endHourContainer [options]='endHourOptions'\r\n                [(ngModel)]=\"endHour\"\r\n                (select)=\"onSelect($event, 'endHour')\"\r\n                (mouseleave)=\"onMouseleave(endHourContainer)\"\r\n                [id]=\"appendId('list_endhour')\"></ti-list>\r\n        </div>\r\n        <div class='ti3-time-minuteselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.minute' | tiTranslate }}</span>\r\n           <ti-list #endMinuteContainer [options]='endMinuteOptions'\r\n           [(ngModel)]=\"endMinute\"\r\n           (select)=\"onSelect($event, 'endMinute')\"\r\n           (mouseleave)=\"onMouseleave(endMinuteContainer)\"\r\n           [id]=\"appendId('list_endminute')\"></ti-list>\r\n        </div>\r\n        <div  class='ti3-time-secondselect-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.second' | tiTranslate }}</span>\r\n            <ti-list #endSecondContainer [options]='endSecondOptions'\r\n            [(ngModel)]=\"endSecond\"\r\n            (select)=\"onSelect($event, 'endSecond')\"\r\n            (mouseleave)=\"onMouseleave(endSecondContainer)\"\r\n            [id]=\"appendId('list_endsecond')\"></ti-list>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!--IE\u6D4F\u89C8\u5668\u517C\u5BB9\u6027\u95EE\u9898\uFF1A\u5728IE\u4E0B\uFF0C\u6240\u6709div\uFF0C\u90E8\u5206span\uFF08\u8BBE\u7F6E\u4E3Ainline-block\u3001block\u7684span\uFF09\uFF0Ctable\uFF0Ctd\u662F\u4EA4\u4E92\u5143\u7D20\uFF0C\u53EF\u4EE5\u843D\u7126\u70B9\u3002\r\n\u800C\u5176\u4ED6\u6D4F\u89C8\u5668\uFF0Cdiv\u548Cspan\u9ED8\u8BA4\u662F\u4E0D\u53EF\u4EA4\u4E92\u5143\u7D20\uFF0C\u4E0D\u80FD\u843D\u7126\u70B9\u3002\r\n\u89E3\u51B3\u65B9\u6848\uFF1Asection\u6807\u7B7E\uFF0C\u53EF\u4EE5\u7B49\u540C\u4E8Ediv\u4F7F\u7528\uFF0CIE\u548C\u5176\u4ED6\u6D4F\u89C8\u5668\u884C\u4E3A\u4E00\u81F4\u3002\r\n-->\r\n",
                styles: ["::ng-deep :root{--date-day-line-width:12px;--date-day-picker-line-bottom:calc((var(--ti-datetime-day-height) - 16px)/2 - 2px);--date-month-line-width:24px;--date-picker-line-bottom:calc((var(--ti-date-picker-month-height) - 16px)/2 - 4px);--date-year-line-width:30px;--ti-date-picker-header-height:18px;--ti-date-picker-header-margin:12px;--ti-date-picker-icon-width:16px;--ti-date-picker-month-height:32px;--ti-date-picker-month-width:63px;--ti-date-picker-week-height:18px;--ti-date-picker-year-month-width:166px}.ti3-date-picker-header{-ms-box-sizing:content-box;box-sizing:content-box;font-weight:400;margin:var(--ti-date-picker-header-margin) 0;position:relative}.ti3-date-picker-header,.ti3-date-picker-icons-next,.ti3-date-picker-icons-prev{height:var(--ti-date-picker-header-height);line-height:var(--ti-date-picker-header-height)}.ti3-date-picker-icons-next,.ti3-date-picker-icons-prev{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-datetime-icon-color-normal);cursor:pointer;display:block;font-size:var(--ti-common-font-size-base);padding:0;position:absolute;text-align:right;top:0;width:calc(var(--ti-date-picker-icon-width)*2 + var(--ti-common-space-10))}.ti3-date-picker-icons-next .ti3-icon,.ti3-date-picker-icons-prev .ti3-icon{display:inline-block;text-align:center;width:var(--ti-date-picker-icon-width)}.ti3-date-picker-icons-next .ti3-icon:active,.ti3-date-picker-icons-next .ti3-icon:hover,.ti3-date-picker-icons-prev .ti3-icon:active,.ti3-date-picker-icons-prev .ti3-icon:hover{color:var(--ti-datetime-icon-color-hover)}.ti3-date-picker-icons-prev{left:0;padding-left:10px;text-align:left}.ti3-date-picker-icons-next{padding-right:10px;right:0;text-align:right}.ti3-date-state-disabled{color:var(--ti-datetime-icon-color-disabled)!important;cursor:not-allowed!important}.ti3-header-year-month-picker{margin:0 calc((var(--ti-datetime-day-width)*7 - var(--ti-date-picker-year-month-width) + 2px)/2)}.ti3-date-picker-year-month{-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-input-bg-color);color:var(--ti-datetime-content-color-normal);cursor:pointer;font-weight:700;user-select:none}.ti3-date-picker-year-month span:hover{color:var(--ti-datetime-picker-color-hover)}.ti3-date-picker-year-month-text{text-align:center}.ti3-date-picker-container{background-color:var(--ti-input-bg-color);font-size:var(--ti-datetime-input-font-size);*zoom:1}.ti3-date-picker-container:after{clear:both;content:\"\";display:table}.ti3-date-picker-container:before{content:\"\";display:table}.ti3-date-picker-container th{font-weight:400}.ti3-date-picker-container.ti3-date-picker-month,.ti3-date-picker-container.ti3-date-picker-year{margin-top:42px}.ti3-date-week{-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-datetime-week-bg-color);border:0;color:var(--ti-datetime-beside-day-color);font-weight:400;height:var(--ti-date-picker-week-height);text-align:center;user-select:none}.ti3-date-day-tr{height:var(--ti-datetime-day-height)}.ti3-date-today-current-td{position:relative}.ti3-date-current-day{background-color:var(--ti-datetime-content-color-active);color:var(--ti-datetime-current-day-color)}.ti3-date-current-day,.ti3-dateRange-select-day{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:block;height:var(--ti-datetime-day-height);line-height:var(--ti-datetime-day-height);margin-top:var(--ti-datetime-day-margin-top);min-width:var(--ti-datetime-day-width);padding:0;text-align:center;text-decoration:none;user-select:none}.ti3-dateRange-select-day{background-color:var(--ti-datetime-range-selected-day-bg-color);color:var(--ti-input-text-color)}.ti3-dateRange-select-day:hover{background-color:var(--ti-datetime-range-selected-day-bg-color-hover)}.ti3-date-default-day{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-input-bg-color);box-sizing:border-box;color:var(--ti-datetime-default-day-color);cursor:pointer;display:block;font-size:var(--ti-datetime-input-font-size);height:var(--ti-datetime-day-height);line-height:var(--ti-datetime-day-height);margin-top:var(--ti-datetime-day-margin-top);min-width:var(--ti-datetime-day-width);padding:0;text-align:center;text-decoration:none;user-select:none}.ti3-date-default-day:hover{background-color:var(--ti-common-color-bg-white-emphasize);color:var(--ti-datetime-content-text-color-hover)}.ti3-date-today{position:relative}.ti3-date-today.ti3-date-current-day{background-color:var(--ti-datetime-content-color-active);border:0}.ti3-date-today:after{background:var(--ti-common-color-line-active);bottom:var(--date-day-picker-line-bottom);content:\"\";height:1px;left:calc((var(--ti-datetime-day-width) - var(--date-day-line-width))/2);position:absolute;width:var(--date-day-line-width)}.ti3-date-disable-day{background-color:var(--ti-datetime-disable-day-bg-color);background-image:none;color:var(--ti-common-color-line-normal);cursor:not-allowed}.ti3-date-beside-day,.ti3-date-disable-day{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;display:block;font-size:var(--ti-datetime-input-font-size);height:var(--ti-datetime-day-height);line-height:var(--ti-datetime-day-height);margin-top:var(--ti-datetime-day-margin-top);min-width:var(--ti-datetime-day-width);padding:0;text-align:center;text-decoration:none;user-select:none}.ti3-date-beside-day{color:var(--ti-datetime-beside-day-color);cursor:pointer}.ti3-date-beside-day:hover{background-color:var(--ti-datetime-beside-day-bg-color-hover)}.ti3-date-month,.ti3-date-year{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:block;height:var(--ti-date-picker-month-height);line-height:var(--ti-date-picker-month-height);text-align:center;text-decoration:none;user-select:none;width:var(--ti-date-picker-month-width)}.ti3-date-default-month,.ti3-date-default-year{background-color:var(--ti-input-bg-color);color:var(--ti-pagination-text-color)}.ti3-date-default-month:hover,.ti3-date-default-year:hover{background-color:var(--ti-common-color-bg-white-emphasize)}.ti3-date-current-month,.ti3-date-current-year{background-color:var(--ti-datetime-content-color-active);color:var(--ti-datetime-current-day-color)}.ti3-date-disable-month,.ti3-date-disable-year{background-color:var(--ti-input-bg-color);color:var(--ti-common-color-line-normal);cursor:not-allowed}.ti3-date-preNext-year{background-color:var(--ti-input-bg-color);color:var(--ti-input-text-color-disabled)}::ng-deep .ti3-time-select-container{border:1px solid var(--ti-common-color-line-dividing);border-bottom:none;display:flex;height:265px;margin-top:10px;width:250px}::ng-deep .ti3-time-select-container ul{height:231px;overflow-y:auto;text-align:center;width:82px}::ng-deep .ti3-time-select-container ul li{margin-top:0!important;text-align:center!important}.ti3-time-select-title{color:var(--ti-common-color-text-darkbg);display:inline-block;font-size:var(--ti-common-font-size-base);height:30px;line-height:30px;margin-left:-6px;text-align:center;width:100%}.ti3-endtime-select-container,.ti3-time-select-panel{display:flex}.ti3-endtime-select-container{margin-left:var(--ti-common-space-5x)}.ti3-endtime-select-none{display:none}.ti3-date-picker-text{display:inline;padding-left:58px}.ti3-date-picker-endpanel-text{display:inline;padding-left:204px}.ti3-time-hourselect-container,.ti3-time-minuteselect-container{border-right:1px solid var(--ti-common-color-line-dividing)}.ti3-date-year-month-picker-container{display:flex;justify-content:space-around;margin-bottom:32px}.ti3-time-select-container-border{border-bottom:1px solid var(--ti-common-color-line-dividing)}.ti-date-nowMonth{position:relative}.ti-date-nowMonth:after{background:var(--ti-common-color-line-active);bottom:var(--date-picker-line-bottom);content:\"\";height:1px;left:calc((var(--ti-date-picker-month-width) - var(--date-month-line-width))/2);position:absolute;width:var(--date-month-line-width)}.ti-date-nowYear{position:relative}.ti-date-nowYear:after{background:var(--ti-common-color-line-active);bottom:var(--date-picker-line-bottom);content:\"\";height:1px;left:calc((var(--ti-date-picker-month-width) - var(--date-year-line-width))/2);position:absolute;width:var(--date-year-line-width)}.ti3-date-picker-only-year-container,.ti3-date-picker-year-month-container{display:flex}.ti3-date-picker-right-zone{padding-left:var(--ti-common-space-5x)}"]
            },] }
];
TiDatePanelComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: TiDropComponent }
];
TiDatePanelComponent.propDecorators = {
    value: [{ type: Input }],
    valueChange: [{ type: Output }],
    picker: [{ type: Input }],
    pickerChange: [{ type: Output }],
    nowDateTime: [{ type: Input }],
    max: [{ type: Input }],
    min: [{ type: Input }],
    format: [{ type: Input }],
    disabledDays: [{ type: Input }],
    endTimeDisabled: [{ type: Input }],
    beginTimeDisabled: [{ type: Input }],
    focusedPosition: [{ type: Input }],
    selectTime: [{ type: Input }],
    beginTime: [{ type: Input }],
    endTime: [{ type: Input }],
    isRange: [{ type: Input }],
    isBeginFixed: [{ type: Input }],
    isEndFixed: [{ type: Input }],
    select: [{ type: Output }],
    selectTimeFn: [{ type: Output }],
    nextRef: [{ type: ViewChild, args: ['next', { static: true },] }],
    beginHourContainerRef: [{ type: ViewChild, args: ['beginHourContainer', { static: true },] }],
    beginMinuteContainerRef: [{ type: ViewChild, args: ['beginMinuteContainer', { static: true },] }],
    beginSecondContainerRef: [{ type: ViewChild, args: ['beginSecondContainer', { static: true },] }],
    endHourContainerRef: [{ type: ViewChild, args: ['endHourContainer', { static: true },] }],
    endMinuteContainerRef: [{ type: ViewChild, args: ['endMinuteContainer', { static: true },] }],
    endSecondContainerRef: [{ type: ViewChild, args: ['endSecondContainer', { static: true },] }]
};

/**
 * @ignore
 */
class TiDatePanelModule {
}
TiDatePanelModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiIconModule,
                    TiListModule,
                    TiLocaleModule
                ],
                exports: [TiDatePanelComponent],
                declarations: [TiDatePanelComponent]
            },] }
];

/**
 * Date日期组件
 *
 * Date组件提供了一种方便的显示和设置日期的方式
 *
 * <example-url>../tiny3demo/#/date/date-all</example-url>
 */
class TiDateComponent extends TiDateBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 标记date/datetime的类型
         */
        this.isDatetime = false;
        /**
         * @ignore
         * 用于标记是不是range
         */
        this.isRange = false;
        /**
         * @ignore
         * placeholder提示文本
         */
        this.placeholder = `${TiLocale.getLocaleWords().tiDate.datePlaceholder}`;
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngOnChanges(changes) {
        // format支持动态变更
        if (changes['format'] && !changes['format'].firstChange) {
            // 新的format是非法时，format值保持之前值不变
            if (!Util.isString(changes['format'].currentValue)) {
                this.format = changes['format'].previousValue;
                return;
            }
            this.formatValue();
            // 配置面板的接口值
            this.setPickerDate();
        }
        // 验证最大值最小值，为了处理最大值和最小值从合法日期变为undefined 的情景
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.validateMinAndMax(this.config, this.isDatetime);
        }
    }
    /**
     * @ignore
     * model值变化时的回调
     */
    ngOnModelChange() {
        if (!TiDateUtil.isDate(this.model)) {
            this.inputValue = '';
            return;
        }
        this.formatValue();
        this.setPickerDate();
    }
    /**
     * @ignore
     */
    setInputValue(value) {
        let isDisabled = false;
        if (Util.isArray(this.disabledDays) && this.disabledDays.length > 0) {
            this.disabledDays.forEach((item) => {
                if (item.getTime() === value.getTime()) {
                    isDisabled = true;
                }
            });
        }
        if (isDisabled) {
            return;
        }
        if (this.isValidValue(value)) {
            this.model = value;
        }
    }
    /**
     * @ignore
     */
    onKeydownFn(event, val, pos) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.hideDrop();
        }
    }
    /**
     * @ignore
     * 配置时间日期面板接口
     */
    setPickerDate() {
        this.datePanel = {
            value: {
                begin: this.model,
                // tslint:disable-next-line:no-null-keyword
                end: null
            },
            picker: 'day',
            min: this.min,
            max: this.max,
            format: this.format,
            nowDateTime: this.nowDateTime,
            select: () => {
                // 点击面板：新旧值相同不做处理，不相同，将新值赋给model
                if (!TiDateUtil.isDateEqual(this.model, this.datePanel['value'].begin)) {
                    this.model = this.datePanel['value'].begin;
                }
                this.hideDrop();
            }
        };
        // 如果只显示年
        if (this.format.indexOf('M') === -1 && this.format !== 'mediumDate') {
            this.datePanel['picker'] = 'year';
        }
        else if (this.format.indexOf('d') === -1) { // 如果只显示年月
            this.datePanel['picker'] = 'month';
        }
    }
    /**
     * @ignore
     * 根据model值和format接口，格式化显示时间日期
     */
    formatValue() {
        this.inputValue = (this.model !== null) ? TiLocaleFormat.formatDate(this.model, this.format) : '';
    }
    /**
     * @ignore
     * 判断是不是合法的model
     */
    isValidValue(value) {
        if (TiDateUtil.isDate(value) && TiDateUtil.isBetweenMaxAndmin(value, this.min, this.max)) {
            return true;
        }
        return false;
    }
}
TiDateComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-date',
                template: "<ti-date-dominator #dominator\r\n                   [id]=\"appendId('dominator')\"\r\n                   [clearable]=\"clearIcon\"\r\n                   [(ngModel)]=\"inputValue\"\r\n                   [disabled]=\"disabled\"\r\n                   (clear)=\"onIconClearClick($event)\"\r\n                   (click)=\"onShowClick()\">{{ placeholder }}</ti-date-dominator>\r\n<ti-drop #drop\r\n        [id]=\"appendId('drop')\"\r\n        class=\"ti3-date-picker\"\r\n        [ngClass]=\"{'ti3-date-customize': hasCustomizeTime}\"\r\n        [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        fixMaxHeight=\"true\"\r\n        [panelWidth]=\"datePanelWidth\"\r\n        [dominatorSpace]='dominatorSpace'\r\n        [panelAlign]=\"panelAlign\"\r\n        [browserSpace]=\"browserSpace\"\r\n        [determinPositionFn]=\"determinPositionFn\"\r\n        theme='noborder'>\r\n        <section class='ti3-date-clear'>\r\n            <section *ngIf='hasCustomizeTime' class='ti3-date-customize-container'>\r\n                <ng-container *ngTemplateOutlet=\"customizeTemplate; context:  {$implicit: customizeOptions}\"></ng-container>\r\n            </section>\r\n            <section [ngClass]=\"{'ti3-date-panel-container': hasCustomizeTime}\">\r\n                <ti-date-edit\r\n                [id]=\"appendId('date-edit')\"\r\n                class='ti3-date-edit'\r\n                [(ngModel)] = \"datePanel.value.begin\"\r\n                [min] = \"datePanel.min\"\r\n                [max] = \"datePanel.max\"\r\n                [format]=\"datePanel.format\"\r\n                [disabledDays]='disabledDays'\r\n                (keydown)=\"onKeydownFn($event, datePanel.value.begin, 'begin')\"\r\n                (ngModelChange)=\"setInputValue(datePanel.value.begin)\">\r\n            </ti-date-edit>\r\n            <ti-date-panel\r\n                [id]=\"appendId('panel')\"\r\n                [(value)]=\"datePanel.value\"\r\n                [focusedPosition]='focusedPosition'\r\n                [isRange]='false'\r\n                [(picker)]=\"datePanel.picker\"\r\n                [min]=\"datePanel.min\"\r\n                [max]=\"datePanel.max\"\r\n                [disabledDays]='disabledDays'\r\n                [nowDateTime]=\"datePanel.nowDateTime\"\r\n                [format]=\"datePanel.format\"\r\n                (select)=\"datePanel.select()\"></ti-date-panel>\r\n            </section>\r\n        </section>\r\n</ti-drop>\r\n\r\n<ng-template #customizeTemplate let-options>\r\n    <ul [id]=\"appendId('list')\">\r\n        <li *ngFor='let option of options; index as i;' class='ti3-customize-time-label' (click)='customizeTimeClickFn(option.value.begin)' [id]=\"appendId('label_' + i)\">{{option.label}}</li>\r\n    </ul>\r\n</ng-template>\r\n",
                // tslint:disable-next-line:use-host-property-decorator
                host: {
                    '[class.ti3-date-input-container]': 'true',
                    '(blur)': 'hidePanel()'
                },
                providers: [TiFormComponent.getValueAccessor(TiDateComponent)],
                styles: [".ti3-compnent-container-border,:host.ti3-date-input-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-date-input-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-date-input-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-date-input-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-date-input-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-customize-time-label{color:var(--ti-common-color-text-primary);cursor:pointer;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-bottom:10px}.ti3-customize-time-label:hover{color:var(--ti-common-color-line-active)}.ti3-date-clear{display:flex;*zoom:1}.ti3-date-clear:after{clear:both}.ti3-date-clear:after,.ti3-date-clear:before{content:\"\";display:table}.ti3-datetime-select-btn{color:var(--ti-common-color-text-highlight);cursor:pointer;float:right;line-height:24px;padding-right:var(--ti-common-space-2x)}.ti3-datetime-select-btn-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-date-range-splitline{padding:0 6px}.ti3-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}::ng-deep :root{--ti-date-picker-padding-bottom:12px;--ti-date-picker-padding-horizon:16px}:host.ti3-date-input-container{width:160px}.ti3-dropdown-container.ti3-date-picker{font-size:var(--ti-datetime-input-font-size);padding:var(--ti-date-picker-padding-bottom) var(--ti-date-picker-padding-horizon);width:calc(var(--ti-datetime-day-width)*7 + var(--ti-date-picker-padding-horizon)*2 + 2px);z-index:var(--ti-datetime-z-index)}.ti3-dropdown-container.ti3-date-picker:focus{outline:0}.ti3-dropdown-container.ti3-date-picker.ti3-date-customize{width:399px!important}.ti3-date-customize-container{border-right:1px solid var(--ti-common-color-line-dividing);height:292px;padding-right:var(--ti-common-space-4x);width:80px}.ti3-date-edit{width:100%}::ng-deep .ti3-date-edit input[tiText]{border-color:var(--ti-input-border-color-focus)!important}.ti3-date-panel-container{padding-left:var(--ti-common-space-4x)}"]
            },] }
];
TiDateComponent.propDecorators = {
    customizeTemplate: [{ type: ContentChild, args: ['customize', { static: true },] }]
};

class TiDateModule {
}
TiDateModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDropModule,
                    TiButtonModule,
                    TiDateEditModule,
                    TiDatePanelModule,
                    TiDateDominatorModule,
                    TiLocaleModule
                ],
                exports: [TiDateComponent],
                declarations: [TiDateComponent]
            },] }
];

/**
 * DateRange日期范围组件
 *
 * DateRange组件提供了一种方便的显示和设置日期范围的方式
 *
 * <example-url>../tiny3demo/#/daterange/daterange-all</example-url>
 */
class TiDateRangeComponent extends TiDateBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 标记date/datetime的类型
         */
        this.isDatetime = false;
        /**
         * @ignore
         * 用于标记是不是range
         */
        this.isRange = true;
        /**
         * @ignore
         * 保存model值
         */
        this.oldModel = {
            begin: null,
            end: null
        };
        /**
         * @ignore
         * placeholder提示文本
         */
        this.placeholder = `${TiLocale.getLocaleWords().tiDate.rangeBeginLabel} ─ ${TiLocale.getLocaleWords().tiDate.rangeEndLabel}`;
    }
    ngOnChanges(changes) {
        // format支持动态变更
        if (changes['format'] && !changes['format'].firstChange) {
            // 新的format是非法时，format值保持之前值不变
            if (!Util.isString(changes['format'].currentValue)) {
                this.format = changes['format'].previousValue;
                return;
            }
            this.formatValue();
        }
        // 验证最大值最小值，为了处理最大值和最小值从合法日期变为undefined 的情景
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.validateMinAndMax(this.config, this.isDatetime);
        }
    }
    ngDoCheck() {
        // 监听value值
        if (!Util.isUndefined(this.model)) {
            if (!this.isValidValue(this.model)) {
                return;
            }
            // 监听model值的变化
            this.setModel(this.isDatetime);
        }
    }
    /**
     * @ignore
     * 将value转换成format接口格式的字符串
     */
    formatValue() {
        if (this.model === null || (this.model.begin === null && this.model.end === null)) {
            this.inputValue = '';
        }
        else {
            const begin = TiLocaleFormat.formatDate(this.model.begin, this.format);
            const end = TiLocaleFormat.formatDate(this.model.end, this.format);
            // 注意：中划线用的是制表符中的中划线，与正常的中线区分开2017-2-12 - 2018-3-20
            this.inputValue = `${begin} ─ ${end}`;
        }
    }
    /**
     * @ignore
     */
    onKeydownFn(event, pos) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.dateEditBlur(pos);
        }
    }
    /**
     * @ignore
     */
    dateEditBlur(pos) {
        // 输入值超出最大最小 认为非法
        const value = this.datePanel.value;
        if (TiDateUtil.isDate(value.begin) && TiDateUtil.isDate(value.end)) {
            if (TiDateUtil.isBigger(value.begin, value.end)) {
                if (pos === 'begin') {
                    this.datePanel.value.begin = this.oldBeginValue || this.oldModel && this.oldModel.begin;
                }
                else {
                    this.datePanel.value.end = this.oldEndValue || this.oldModel && this.oldModel.end;
                }
            }
            this.oldBeginValue = this.datePanel.value.begin;
            this.oldEndValue = this.datePanel.value.end;
        }
        this.setOkBtnState();
    }
    /**
     * @ignore
     * 确认按钮
     */
    onOkClick() {
        if (this.inValidValue) {
            return;
        }
        if (this.datePanel instanceof Object) {
            // 新旧值不同更新model值
            if (!this.rangeValueIsEqual(this.model, this.datePanel['value'], this.isDatetime)) {
                this.model = {
                    begin: this.datePanel['value'].begin,
                    end: this.datePanel['value'].end
                };
            }
        }
        this.hideDrop();
        this.okClick.emit(this.model);
    }
    /**
     * @ignore
     * 是否为禁用日期
     */
    isDisabledDays(value) {
        let isDisabled = false;
        if (Util.isArray(this.disabledDays) && this.disabledDays.length > 0) {
            this.disabledDays.forEach((item) => {
                if (item.getTime() === value.getTime()) {
                    isDisabled = true;
                }
            });
        }
        return isDisabled;
    }
    /**
     * @ignore
     * model值的合法性判断
     */
    isValidValue(value) {
        if (value === null) {
            return true;
        }
        return this.isValidRange(value) ? true : false;
    }
    // 判断是不是合法范围
    isValidRange(value) {
        if (!(value instanceof Object) || !TiDateUtil.isDate(value.begin) || !TiDateUtil.isDate(value.end)) {
            return false;
        }
        const startDate = new Date(value.begin.getFullYear(), value.begin.getMonth(), value.begin.getDate());
        const endDate = new Date(value.end.getFullYear(), value.end.getMonth(), value.end.getDate());
        return startDate.getTime() <= endDate.getTime() && TiDateUtil.isBetweenMaxAndmin(startDate, this.min, this.max)
            && TiDateUtil.isBetweenMaxAndmin(endDate, this.min, this.max);
    }
    /**
     * @ignore
     * 设置确认按钮的状态
     */
    setOkBtnState() {
        const date = this.datePanel.value;
        let endTime;
        let beginTime;
        if (TiDateUtil.isDate(date.end)) {
            endTime = new Date(date.end.getFullYear(), date.end.getMonth(), date.end.getDate()).getTime();
        }
        if (TiDateUtil.isDate(date.begin)) {
            beginTime = new Date(date.begin.getFullYear(), date.begin.getMonth(), date.begin.getDate()).getTime();
        }
        const isBeginSmallorEqualEnd = this.isAllowBeginEqualEnd ? endTime < beginTime : endTime <= beginTime;
        this.inValidValue = !(date instanceof Object)
            || !TiDateUtil.isDate(date.begin)
            || !TiDateUtil.isDate(date.end)
            || isBeginSmallorEqualEnd;
        if (this.buttonComs) {
            this.setAttr(this.buttonComs.last.nativeElement, 'disabled', this.inValidValue);
            this.setInputStyle(this.inValidValue);
        }
    }
    /**
     * @ignore
     * 配置时间日期面板接口
     */
    setPickerDate() {
        // 做深拷贝的原因：不让model和datePanel组件中value双向绑定，
        // 因为下拉面板中日期变化时，不立即更新到输入框中
        let value;
        if (this.model === null || this.model === undefined) {
            value = {
                begin: null,
                end: null
            };
        }
        else {
            value = {
                begin: this.model.begin,
                end: this.model.end
            };
        }
        this.datePanel = {
            value,
            format: this.format,
            max: this.max,
            min: this.min,
            picker: 'day',
            select: () => {
                const obj = {
                    value: this.datePanel.value[this.focusedPosition],
                    focusedPosition: this.focusedPosition
                };
                this.dayClick.emit(obj);
                // 初始化选择结束之后，如果开始未选择，焦点转移到开始日期编辑框
                if (this.focusedPosition === 'end' && this.datePanel.value.begin === null) {
                    this.focusedPosition = 'begin';
                    this.dateEditComs.first.focus();
                }
                else {
                    if (!this.isEndFixed) {
                        this.focusedPosition = 'end';
                        this.dateEditComs.last.focus();
                    }
                }
                this.setOkBtnState();
            }
        };
        // 如果只显示年
        if (this.format.indexOf('M') === -1 && this.format !== 'mediumDate') {
            this.datePanel['picker'] = 'onlyYear';
        }
        else if (this.format.indexOf('d') === -1) { // 如果只显示年月
            this.datePanel['picker'] = 'onlyYearMonth';
        }
        this.setOkBtnState();
    }
}
TiDateRangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-date-range',
                template: "<ti-date-dominator  #dominator\r\n                    [id]=\"appendId('dominator')\"\r\n                    type = \"range\"\r\n                    [format]=\"format\"\r\n                    [disabled]=\"disabled\"\r\n                    [clearable]=\"clearIcon\"\r\n                    [(ngModel)]=\"inputValue\"\r\n                    (clear)=\"onIconClearClick($event)\"\r\n                    (click)=\"onShowClick()\">{{placeholder}}</ti-date-dominator><!-- \u5206\u5272\u7EBF\u662F\u7279\u6B8A\u5B57\u7B26\u5236\u8868\u7B26\uFF0C\u4E0D\u662F\u666E\u901A\u4E2D\u7EBF -->\r\n<ti-drop #drop\r\n    class=\"ti3-date-range-picker\"\r\n    [ngClass]=\"{'ti3-date-range-customize': hasCustomizeTime}\"\r\n    [dominatorElem]=\"dominatorCom.nativeElement\"\r\n    fixMaxHeight=\"true\"\r\n    [panelWidth]=\"daterangePanelWidth\"\r\n    [panelAlign]=\"panelAlign\"\r\n    [browserSpace]=\"browserSpace\"\r\n    [dominatorSpace]='dominatorSpace'\r\n    [determinPositionFn]=\"determinPositionFn\"\r\n    theme='noborder'\r\n    [id]=\"appendId('drop')\">\r\n\r\n   <section class='ti3-date-clear'>\r\n    <section *ngIf='hasCustomizeTime' class='ti3-date-range-customize-container'>\r\n        <ng-container *ngTemplateOutlet=\"customizeTemplate; context:  {$implicit: customizeOptions}\"></ng-container>\r\n    </section>\r\n\r\n    <section style='float: right;'>\r\n        <section class=\"ti3-date-edit-container\">\r\n            <ti-date-edit class='ti3-date-range-edit'\r\n                        [ngClass]=\"{'ti3-date-range-begin-edit': focusedPosition === 'begin'}\"\r\n                        [(ngModel)] = \"datePanel.value.begin\"\r\n                        [min] = \"datePanel.min\"\r\n                        [max] = \"datePanel.max\"\r\n                        (click)=\"dateEditClick('begin')\"\r\n                        [disabled]='isBeginFixed'\r\n                        [disabledDays]='disabledDays'\r\n                        (focus)=\"dateEditFocus('begin')\"\r\n                        (blur)=\"dateEditBlur('begin')\"\r\n                        (keydown)=\"onKeydownFn($event, 'begin')\"\r\n                        [format]=\"datePanel.format\" [id]=\"appendId('begin_edit')\"></ti-date-edit>\r\n                        <span class='ti3-date-range-splitline'> \u2500 </span>\r\n                    <ti-date-edit class='ti3-date-range-edit'\r\n                    [ngClass]=\"{'ti3-date-range-end-edit': focusedPosition === 'end'}\"\r\n                    [(ngModel)] = \"datePanel.value.end\"\r\n                    [min] = \"datePanel.min\"\r\n                    [max] = \"datePanel.max\"\r\n                    [disabledDays]='disabledDays'\r\n                    [disabled]='isEndFixed'\r\n                    (focus)=\"dateEditFocus('end')\"\r\n                    (blur)=\"dateEditBlur('end')\"\r\n                    (keydown)=\"onKeydownFn($event, 'end')\"\r\n                    (click)=\"dateEditClick('end')\"\r\n                    [format]=\"datePanel.format\" [id]=\"appendId('end_edit')\"></ti-date-edit>\r\n                    <!-- \u786E\u8BA4\u6309\u94AE\u7981\u7528\u573A\u666F\u4E0B\uFF0C\u7ED3\u675F\u6846\u8F93\u5165\u4E4B\u540E\u65E0\u6CD5\u76F4\u63A5tab\u5207\u6362\u7126\u70B9\u81F3\u786E\u8BA4\u6309\u94AE\uFF0C\u6545\u6DFB\u52A0\u6B64\u8FC7\u5EA6input -->\r\n                    <input #input type=\"text\" class=\"ti3-tab-input\"/>\r\n        </section>\r\n        <ti-date-panel\r\n            [id]=\"appendId('begin-panel')\"\r\n            [(value)]=\"datePanel.value\"\r\n            [focusedPosition]='focusedPosition'\r\n            [(picker)]=\"datePanel.picker\"\r\n            [isRange]='true'\r\n            [disabledDays]='disabledDays'\r\n            [isBeginFixed]='isBeginFixed'\r\n            [isEndFixed]='isEndFixed'\r\n            (select)='datePanel.select()'\r\n            [min]=\"datePanel.min\"\r\n            [max]=\"datePanel.max\"\r\n            [format]=\"datePanel.format\"\r\n            [nowDateTime]=\"nowDateTime\"></ti-date-panel>\r\n    </section>\r\n   </section>\r\n    <section  class=\"ti3-date-picker-footer-right\">\r\n        <button class=\"ti3-date-picker-footer-btn\"\r\n                        [id]=\"appendId('okBtn')\"\r\n                        type=\"button\"\r\n                        size=\"small\"\r\n                        (click)=\"onOkClick()\"\r\n                        tiButton>{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n    </section>\r\n</ti-drop>\r\n<ng-template #customizeTemplate let-options>\r\n    <ul [id]=\"appendId('list')\">\r\n        <li *ngFor='let option of options; index as i;' class='ti3-customize-time-label' (click)='customizeTimeClickFn(option.value)' [id]=\"appendId('label_' + i)\">{{option.label}}</li>\r\n    </ul>\r\n</ng-template>\r\n",
                // tslint:disable-next-line:use-host-property-decorator
                host: {
                    '[class.ti3-date-range-input-container]': 'true',
                    '(blur)': 'hidePanel()'
                },
                providers: [TiFormComponent.getValueAccessor(TiDateRangeComponent)],
                styles: [".ti3-compnent-container-border,:host.ti3-date-range-input-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-date-range-input-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-date-range-input-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-date-range-input-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-date-range-input-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-customize-time-label{color:var(--ti-common-color-text-primary);cursor:pointer;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-bottom:10px}.ti3-customize-time-label:hover{color:var(--ti-common-color-line-active)}.ti3-date-clear{display:flex;*zoom:1}.ti3-date-clear:after{clear:both}.ti3-date-clear:after,.ti3-date-clear:before{content:\"\";display:table}.ti3-datetime-select-btn{color:var(--ti-common-color-text-highlight);cursor:pointer;float:right;line-height:24px;padding-right:var(--ti-common-space-2x)}.ti3-datetime-select-btn-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-date-range-splitline{padding:0 6px}.ti3-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}::ng-deep :root{--ti-date-picker-middle-margin:20px;--ti-date-picker-padding-bottom:12px;--ti-date-picker-padding-horizon:16px}:host.ti3-date-range-input-container{width:240px}.ti3-dropdown-container.ti3-date-range-picker{font-size:var(--ti-datetime-input-font-size);padding:var(--ti-date-picker-padding-bottom) var(--ti-date-picker-padding-horizon);width:calc(var(--ti-datetime-day-width)*7 + var(--ti-date-picker-padding-horizon) + var(--ti-date-picker-middle-margin) + 2px);z-index:var(--ti-datetime-z-index)}.ti3-dropdown-container.ti3-date-range-picker:focus{outline:0}.ti3-date-range-begin-end-text{color:var(--ti-datetime-picker-color);height:var(--ti-datetime-input-font-size);line-height:var(--ti-datetime-input-font-size);margin-top:var(--ti-common-space-10);padding-left:var(--ti-common-space-10)}.ti3-date-range-customize{width:669px!important}.ti3-date-range-edit{display:inline-block;width:248px}::ng-deep .ti3-date-range-begin-edit input[tiText],::ng-deep .ti3-date-range-end-edit input[tiText]{border-color:var(--ti-input-border-color-focus)!important}.ti3-date-range-customize-container{border-right:1px solid var(--ti-common-color-line-dividing);float:left;height:292px;margin-right:var(--ti-common-space-4x);padding-right:var(--ti-common-space-4x);width:80px}::ng-deep :root .ti3-date-picker-footer-right{border-top:1px solid var(--ti-common-color-line-dividing);margin-top:var(--ti-common-space-3x);padding-top:var(--ti-common-space-3x);width:100%}.ti3-date-picker-footer-btn{float:right}"]
            },] }
];

class TiDateRangeModule {
}
TiDateRangeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiLocaleModule,
                    TiDropModule,
                    TiButtonModule,
                    TiDatePanelModule,
                    TiDateEditModule,
                    TiDateDominatorModule
                ],
                exports: [TiDateRangeComponent],
                declarations: [TiDateRangeComponent]
            },] }
];

/**
 * Datetime日期时间组件
 *
 * Datetime组件提供了一种方便的显示和设置日期时间的方式。
 *
 * <example-url>../tiny3demo/#/datetime/datetime-all</example-url>
 */
class TiDatetimeComponent extends TiDateBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 配置time组件的接口
         */
        this.beginTime = {};
        /**
         * @ignore
         * 标记date/datetime的类型
         */
        this.isDatetime = true;
        /**
         * @ignore
         * 用于标记是不是range
         */
        this.isRange = false;
        /**
         * @ignore
         * placeholder提示文本
         */
        this.placeholder = `${TiLocale.getLocaleWords().tiDate.datetimePlaceholder}`;
        /**
         * @ignore
         * 旧时间值
         */
        this.oldValue = '';
    }
    ngOnInit() {
        super.ngOnInit();
        this.oldFormat = this.format;
    }
    ngOnChanges(changes) {
        // 验证最大值最小值，为了处理最大值和最小值从合法日期变为undefined 的情景
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.validateMinAndMax(this.config, this.isDatetime);
        }
    }
    ngDoCheck() {
        // 监听format的变化
        this.setFormat();
    }
    /**
     * @ignore
     * model值变化时的回调
     */
    ngOnModelChange() {
        if (!TiDateUtil.isDate(this.model)) {
            this.inputValue = '';
            return;
        }
        this.formatValue();
        this.setOkBtnState();
        this.setPickerDate();
    }
    /**
     * @ignore
     * 确认按钮的点击事件处理
     */
    onOkClick() {
        if (this.inValidValue) {
            return;
        }
        if (!TiDateUtil.isDate(this.datePanel['value']['begin'])) {
            this.dropCom.hide();
            return;
        }
        // 获取时间的字符串
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        // 空格误删
        const newValue = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        // 点击确认按钮对比新旧值：相等不做处理，不相等将新值赋给model
        if (!TiDateUtil.isDatetimeEqual(this.model, newValue)) {
            this.model = newValue;
        }
        this.hideDrop();
        this.okClick.emit(this.model);
    }
    /**
     * @ignore
     * 设置下拉面板中datePanel组件接口
     */
    setDatePanel() {
        this.datePanel = {
            picker: 'day',
            max: this.max,
            min: this.min,
            format: this.format,
            nowDateTime: this.nowDateTime,
            value: {
                begin: this.model,
                end: null
            },
            select: () => {
                // 点击日期面板值，校验时间的最大值最小值
                // 原因：当选择的日期是最小或者最大时，需要校验当前的时间是否合法
                // 设定时间范围
                if (TiDateUtil.isDateEqual(this.datePanel['value']['begin'], this.max)) {
                    this.beginTime['max'] = TiDateUtil.getTimeStr(this.max);
                    this.beginTime['min'] = '00:00:00';
                }
                else if (TiDateUtil.isDateEqual(this.datePanel['value']['begin'], this.min)) {
                    this.beginTime['max'] = '23:59:59';
                    this.beginTime['min'] = TiDateUtil.getTimeStr(this.min);
                }
                else {
                    this.beginTime['min'] = '00:00:00';
                    this.beginTime['max'] = '23:59:59';
                }
                this.setBeginTime();
                this.setOkBtnState();
            },
            selectTimeFn: (obj) => {
                this.setTimeFn(obj, this.beginTime);
                this.setOkBtnState();
            }
        };
    }
    setBeginTime() {
        if (this.timeEditDisabled) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(new Date());
        }
        // 1.获取时间的字符串
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        // 空格误删
        const datetimeStr = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        // 最大值校验
        if (TiDateUtil.isBigger(datetimeStr, this.max)) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(this.max);
        }
        // 最小值校验
        if (TiDateUtil.isSmaller(datetimeStr, this.min)) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(this.min);
        }
        this.oldValue = this.beginTime['value'];
        this.timeEditDisabled = false;
    }
    /**
     * @ignore
     * @param event
     * @param val
     */
    onKeydownFn(event, val) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            if (!TiDateUtil.isDate(val)) {
                return;
            }
            this.setBeginTime();
            this.setOkBtnState();
        }
    }
    /**
     * @ignore
     */
    editBlur(val) {
        if (val !== null) {
            this.setBeginTime();
            this.setOkBtnState();
        }
    }
    // 设置下拉面板中time组件接口
    setTime() {
        // value接口设置
        this.setTimeValue();
        // maxValue接口设置
        this.setTimeMaxValue();
        // minValue接口设置
        this.setTimeMinValue();
    }
    setTimeValue() {
        this.beginTime['value'] = TiDateUtil.isDate(this.model) ? TiDateUtil.getTimeStr(this.model) : '';
    }
    setTimeMaxValue() {
        if (!TiDateUtil.isDate(this.model)) {
            return;
        }
        this.beginTime['max'] = (TiDateUtil.isDateEqual(this.model, this.max)) ?
            TiDateUtil.getTimeStr(this.max) : '23:59:59';
    }
    setTimeMinValue() {
        if (!TiDateUtil.isDate(this.model)) {
            return;
        }
        this.beginTime['min'] = (TiDateUtil.isDateEqual(this.model, this.min)) ?
            TiDateUtil.getTimeStr(this.min) : '00:00:00';
    }
    /**
     * @ignore
     */
    isValidValue(value) {
        if (TiDateUtil.isDate(value) && TiDateUtil.isBetweenMaxAndmin(value, this.min, this.max)) {
            return true;
        }
        return false;
    }
    /**
     * @ignore
     */
    setPickerDate() {
        // 设置下拉面板中datePanel组件接口
        this.setDatePanel();
        // 设置下拉面板中time组件接口
        this.setTime();
        this.setOkBtnState();
        this.timeEditDisabled = TiDateUtil.isDate(this.model) ? false : true;
        if (this.timeEditDisabled) {
            this.selectTime = false;
        }
    }
    /**
     * @ignore
     * 设置确认按钮的状态
     */
    setOkBtnState() {
        // 输入中文冒号之后，及时转换为英文冒号
        const inputvalue = this.beginTime.value;
        if (!Util.isUndefined(inputvalue)) {
            this.beginTime.value = inputvalue.replace('：', ':');
        }
        const date = this.datePanel.value.begin;
        if (!TiDateUtil.isDate(date)) {
            this.inValidValue = true;
        }
        else {
            const dateTime = new Date(`${TiDateUtil.getDateStr(date)} ${TiDateUtil.addColon(this.beginTime['value'])}`);
            this.inValidValue = !TiDateUtil.isBetweenMaxAndmin(dateTime, this.min, this.max);
        }
        if (this.buttonComs) {
            this.setAttr(this.buttonComs.last.nativeElement, 'disabled', this.inValidValue);
            this.setInputStyle(this.inValidValue);
        }
    }
    /**
     * @ignore
     * 将value转换为format接口格式的字符串
     */
    formatValue() {
        if (this.model === null) {
            this.inputValue = '';
        }
        else {
            // 空格误删
            const format = `${this.format.date} ${TiDateUtil.addAmPm(this.format.time)}`;
            this.inputValue = TiLocaleFormat.formatDateTime(this.model, format);
        }
        this.oldValue = TiDateUtil.getTimeStr(this.model);
    }
    /**
     * @ignore
     * 时间框失焦事件
     */
    timeBlur() {
        this.handleTimeValue();
    }
    /**
     * @ignore
     * 时间框enter事件
     */
    timeKeydown(event) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.handleTimeValue();
        }
    }
    /**
     * @ignore
     * time时间框输入内容处理
     */
    handleTimeValue() {
        // 区分中英文冒号
        const reg = new RegExp('[\\:\\：]');
        const dateReg = new RegExp('[年\\月\\日\\-\\/\\.\\_]');
        // 输入区间是否存在小数点，非整数
        let isNotInteger = false;
        this.beginTime = JSON.parse(JSON.stringify(this.beginTime));
        const timeArr = this.beginTime.value.split(reg);
        timeArr.forEach((item, index) => {
            if (item.length === 1) {
                timeArr[index] = '0' + item;
            }
            if (parseInt(item, 10) !== Number(item)) {
                isNotInteger = true;
            }
        });
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        const dateArr = dateStr.split(dateReg);
        this.beginTime.value = timeArr.join(':');
        const datetime = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        const dateVal = new Date(parseInt(dateArr[0], 10), parseInt(dateArr[1], 10), parseInt(dateArr[2], 10), parseInt(timeArr[0], 10), parseInt(timeArr[1], 10), parseInt(timeArr[2], 10));
        if (String(datetime) === 'Invalid Date' || String(dateVal) === 'Invalid Date' || timeArr.length > 3 || isNotInteger) {
            this.beginTime.value = this.oldValue;
            this.setOkBtnState();
            return;
        }
        this.oldValue = this.beginTime.value;
        this.setOkBtnState();
    }
    /**
     * @description 判读字符串是否是合法的时间
     * @param: time: 校验的时间
     */
    isValidTime(time) {
        if (!Util.isString(time) || time.trim() === '') {
            return false;
        }
        const date = new Date(`2018/5/15 ${time}`);
        return !(String(date) === 'Invalid Date');
    }
}
TiDatetimeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-datetime',
                template: "<ti-date-dominator #dominator\r\n                   [id]=\"appendId('dominator')\"\r\n                   [clearable]=\"clearIcon\"\r\n                   [(ngModel)]=\"inputValue\"\r\n                   [disabled]=\"disabled\"\r\n                   (clear)=\"onIconClearClick($event)\"\r\n                   (click)=\"onShowClick()\">{{ placeholder }}</ti-date-dominator>\r\n<ti-drop #drop\r\n        [id]=\"appendId('drop')\"\r\n        class=\"ti3-datetime-picker\"\r\n        [ngClass]=\"{'ti3-date-time-customize': hasCustomizeTime}\"\r\n        [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        fixMaxHeight=\"true\"\r\n        [panelWidth]=\"datePanelWidth\"\r\n        [panelAlign]=\"panelAlign\"\r\n        [browserSpace]=\"browserSpace\"\r\n        [dominatorSpace]='dominatorSpace'\r\n        [determinPositionFn]=\"determinPositionFn\"\r\n        theme='noborder'>\r\n        <!-- <section *ngIf=\"dropCom.isShow\"> -->\r\n\r\n        <section class='ti3-date-clear'>\r\n                <section *ngIf='hasCustomizeTime' class='ti3-date-time-customize-contianer'>\r\n                        <ng-container *ngTemplateOutlet=\"customizeTemplate; context:  {$implicit: customizeOptions}\"></ng-container>\r\n                </section>\r\n\r\n                <section [ngClass]=\"{'ti3-datetime-panel-container': hasCustomizeTime}\">\r\n                        <ti-date-edit class='ti3-datetime-dateedit'\r\n                        [ngClass]=\"{'ti3-datetime-dateedit-input': this.focusedPosition === 'begin'}\"\r\n                        [(ngModel)] = \"datePanel.value.begin\"\r\n                        [min] = \"datePanel.min\"\r\n                        [max] = \"datePanel.max\"\r\n                        (keydown)=\"onKeydownFn($event, datePanel.value.begin)\"\r\n                        (click)=\"dateEditClick('begin')\"\r\n                        (focus)=\"dateEditFocus('begin')\"\r\n                        (blur)='editBlur(datePanel.value.begin)'\r\n                        [format]=\"datePanel.format\" [id]=\"appendId('edit')\"></ti-date-edit>\r\n                        <!-- \u786E\u8BA4\u6309\u94AE\u7981\u7528\u573A\u666F\u4E0B\uFF0C\u7ED3\u675F\u6846\u8F93\u5165\u4E4B\u540E\u65E0\u6CD5\u76F4\u63A5tab\u5207\u6362\u7126\u70B9\u81F3\u786E\u8BA4\u6309\u94AE\uFF0C\u6545\u6DFB\u52A0\u6B64\u8FC7\u5EA6input -->\r\n                        <input #input type=\"text\" class=\"ti3-tab-input\"/>\r\n                    <input  class='ti3-datetime-timeedit'\r\n                    [ngClass]=\"{'ti3-datetime-timeedit-input': this.focusedPosition === 'beginTime'}\"\r\n                    type=\"text\"\r\n                    (focus)=\"timeFocus('begin')\"\r\n                    (blur)='timeBlur()'\r\n                    maxlength='8'\r\n                    [disabled]=\"timeEditDisabled\"\r\n                    [placeholder]='timeplaceholder'\r\n                    [(ngModel)]=\"beginTime.value\"\r\n                    (keydown)='timeKeydown($event)'\r\n                    [id]=\"appendId('input')\"\r\n                    tiText/>\r\n                        <ti-date-panel\r\n                                [id]=\"appendId('panel')\"\r\n                                [(value)]=\"datePanel.value\"\r\n                                [(picker)]=\"datePanel.picker\"\r\n                                [isRange]='false'\r\n                                [beginTime]='beginTime'\r\n                                [selectTime]='selectTime'\r\n                                (selectTimeFn)='datePanel.selectTimeFn($event)'\r\n                                [min]=\"datePanel.min\"\r\n                                [max]=\"datePanel.max\"\r\n                                [nowDateTime]=\"datePanel.nowDateTime\"\r\n                                [format]=\"format.date\"\r\n                                (select)=\"datePanel.select()\"\r\n                                (valueChange)=\"setOkBtnState()\"></ti-date-panel>\r\n                </section>\r\n        </section>\r\n                <section class=\"ti3-datetime-btn-picker-footer\" [ngClass]=\"{'ti3-datetime-select-time': selectTime}\">\r\n                        <button class=\"ti3-datetime-picker-footer-btn\"\r\n                                [id]=\"appendId('okBtn')\"\r\n                                type=\"button\"\r\n                                size=\"small\"\r\n                                (click)=\"onOkClick()\"\r\n                                tiButton>{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n                        <section (click)='selectTimeFn()' [id]=\"appendId('select_time')\" *ngIf='!selectTime' [ngClass]=\"{'ti3-datetime-select-btn-disabled': timeEditDisabled}\" class='ti3-datetime-select-btn'>{{'tiDate.selectTime' | tiTranslate}}</section>\r\n                        <section (click)='selectDateFn()' [id]=\"appendId('select_date')\" *ngIf='selectTime' class='ti3-datetime-select-btn'>{{'tiDate.selectDate' | tiTranslate}}</section>\r\n                </section>\r\n</ti-drop>\r\n\r\n<ng-template #customizeTemplate let-options>\r\n        <ul [id]=\"appendId('list')\">\r\n            <li *ngFor='let option of options; index as i;' class='ti3-customize-time-label' (click)='customizeTimeClickFn(option.value.begin)' [id]=\"appendId('label_' + i)\">{{option.label}}</li>\r\n        </ul>\r\n</ng-template>\r\n",
                host: {
                    '[class.ti3-datetime-input-container]': 'true',
                    '(blur)': 'hidePanel()'
                },
                providers: [TiFormComponent.getValueAccessor(TiDatetimeComponent)],
                styles: [".ti3-compnent-container-border,:host.ti3-datetime-input-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-datetime-input-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-datetime-input-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-datetime-input-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-datetime-input-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-customize-time-label{color:var(--ti-common-color-text-primary);cursor:pointer;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-bottom:10px}.ti3-customize-time-label:hover{color:var(--ti-common-color-line-active)}.ti3-date-clear{display:flex;*zoom:1}.ti3-date-clear:after{clear:both}.ti3-date-clear:after,.ti3-date-clear:before{content:\"\";display:table}.ti3-datetime-select-btn{color:var(--ti-common-color-text-highlight);cursor:pointer;float:right;line-height:24px;padding-right:var(--ti-common-space-2x)}.ti3-datetime-select-btn-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-date-range-splitline{padding:0 6px}.ti3-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}::ng-deep :root{--ti-date-picker-padding-bottom:12px;--ti-date-picker-padding-horizon:16px}:host.ti3-datetime-input-container{width:200px}.ti3-dropdown-container.ti3-datetime-picker{font-size:var(--ti-datetime-input-font-size);padding:var(--ti-date-picker-padding-bottom) var(--ti-date-picker-padding-horizon);width:calc(var(--ti-datetime-day-width)*7 + var(--ti-date-picker-padding-horizon)*2 + 2px);z-index:var(--ti-datetime-z-index)}.ti3-dropdown-container.ti3-datetime-picker:focus{outline:0}.ti3-datetime-picker-footer{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;clear:both;padding-bottom:var(--ti-common-space-10);user-select:none;width:100%;*zoom:1}.ti3-datetime-picker-footer:after{clear:both;content:\"\";display:table}.ti3-datetime-picker-footer:before{content:\"\";display:table}.ti3-date-picker-footer-right{float:right}.ti3-datetime-btn-picker-footer{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;border-top:1px solid var(--ti-common-color-line-dividing);box-sizing:border-box;clear:both;margin-top:var(--ti-common-space-3x);padding-top:var(--ti-common-space-3x);user-select:none;width:100%;*zoom:1}.ti3-datetime-btn-picker-footer:after{clear:both;content:\"\";display:table}.ti3-datetime-btn-picker-footer:before{content:\"\";display:table}.ti3-datetime-btn-picker-footer .ti3-datetime-picker-footer-btn{float:right}.ti3-datetime-btn-picker-footer .ti3-datetime-picker-footer-btn:last-child{margin-right:var(--ti-common-space-10)}.ti3-datetime-btn-picker-footer.ti3-datetime-select-time{border-top:none;margin-top:0}.ti3-date-time-customize{width:397px!important}.ti3-date-time-customize-contianer{border-right:1px solid var(--ti-common-color-line-dividing);float:left;height:292px;padding-right:var(--ti-common-space-4x);width:80px}.ti3-datetime-dateedit{margin-right:var(--ti-common-space-2x)}.ti3-datetime-dateedit,.ti3-datetime-timeedit{display:inline-block;width:122px}.ti3-datetime-panel-container{float:right;padding-left:var(--ti-common-space-4x)}::ng-deep .ti3-datetime-dateedit-input input[tiText],::ng-deep .ti3-datetime-timeedit-input{border-color:var(--ti-input-border-color-focus)!important}"]
            },] }
];

/**
 * Time时间组件
 *
 * Time组件提供了一种方便的显示和设置时间的方式。
 *
 * <example-url>../tiny3demo/#/time/time-all</example-url>
 */
class TiTimeComponent extends TiFormComponent {
    constructor(zone, hostRef, renderer2, document) {
        super(hostRef, renderer2);
        this.zone = zone;
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.document = document;
        /**
         * 是否展示清除时间图标（默认显示）
         *
         * 10.1.2新增接口
         */
        this.clearIcon = true;
        this.localeWords = TiLocale.getLocaleWords();
        /**
         * @ignore
         * time编辑框内部value值
         */
        this.inputValue = '';
        /**
         * @ignore
         * dominator最终显示时间值
         */
        this.timeValue = '';
        /**
         * @ignore
         * 时间下拉面板宽度，根据时间格式宽度各异
         */
        this.timePanelWidth = 284;
        /**
         * @ignore
         * 底部确认按钮是否禁用
         */
        this.buttonDisabled = true;
        /**
         * @ignore
         */
        this.oldInputValue = '';
        /**
         * @ignore
         * 面板与dominator的距离
         */
        this.dominatorSpace = '-30px';
        this.keydownHandlerFn = (event) => {
            if (event.keyCode === TiKeymap.KEY_ESCAPE) {
                this.hidePanel();
            }
        };
    }
    /**
     * @description: 若时间字符串没有一个冒号时处理成合法的事件字符串（加冒号）
     * @param value 时间字符串
     */
    static addColon(value) {
        // new Date()时，时间中没有一个冒号得到的是非法时间
        if (value.match(/:/)) {
            return value;
        }
        let ampm = value.match(/am|AM|pm|PM/);
        ampm = ampm || '';
        return `${parseInt(value, 10)}: ${ampm}`;
    }
    /**
     * @description 判读字符串是否是合法的时间
     * @param: time: 校验的时间
     */
    static isValidTime(time) {
        // value非字符串或者为空字符串时，为非法时间
        if (!Util.isString(time) || time.trim() === '') {
            return false;
        }
        const date = new Date(`2018/5/15 ${TiTimeComponent.addColon(time)}`);
        // any类型是为了防止编译报错 Date类型不能和string类型比较
        return !(String(date) === 'Invalid Date');
    }
    /**
     * @description: hh/HH/mm/ss 时间格式时，显示的值处理成2位，不足2位补0
     * @param: num : 各个时间显示框的数值
     * @param: length : 需要处理之后的长度
     */
    static addZero(num, length) {
        const zeroNum = `00${num}`;
        return zeroNum.substr(zeroNum.length - length, length);
    }
    /**
     * @description newVal参数为合法值时返回newVal，否则返回defaultValue参数
     * @param: newVal:新值
     * @param: defaultValue:默认值
     */
    static verifyTime(newVal, defaultValue) {
        return TiTimeComponent.isValidTime(newVal) ? newVal : defaultValue;
    }
    /**
     * @description 比较value1和value2两个时间值大小.value1 < value2时，返回true；否则返回false  ；
     * @param: value1:比较的前一个值
     * @param: value2:比较的后一个值
     */
    static isSmaller(value1, value2) {
        return Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value1)}`) < Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value2)}`);
    }
    /**
     * @description 比较value1和value2两个时间值大小.value1 > value2时，返回true；否则返回false  ；
     * @param: value1:比较的前一个值
     * @param: value2:比较的后一个值
     */
    static isBigger(value1, value2) {
        return Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value1)}`) > Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value2)}`);
    }
    /**
     * @description 比较value1和value2两个时间值大小.value1 <= value2时，返回true；否则返回false  ；
     * @param: value1:比较的前一个值
     * @param: value2:比较的后一个值
     */
    static isSmallerOrEqual(value1, value2) {
        return Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value1)}`) <= Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value2)}`);
    }
    /**
     * @description 比较value1和value2两个时间值大小.value1 >= value2时，返回true；否则返回false  ；
     * @param: value1:比较的前一个值
     * @param: value2:比较的后一个值
     */
    static isBiggerOrEqual(value1, value2) {
        return Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value1)}`) >= Date.parse(`2018/5/15 ${TiTimeComponent.addColon(value2)}`);
    }
    // 组件声明周期钩子--start
    ngOnInit() {
        super.ngOnInit();
        // 初始化变量
        this.initVariable();
        // 最大最小值校验
        this.validateMaxAndMin();
        this.showTimeWithFormat();
        this.setTimeOptions();
        this.placeholder = this.format;
        this.zone.runOutsideAngular(() => {
            // document上的Ecs快捷键功能
            this.documentKeydownListener = this.renderer2.listen(this.document, 'keydown', this.keydownHandlerFn);
        });
    }
    setTimeOptions() {
        this.hourOptions = this.setOptions(24, 'hour');
        this.minuteOptions = this.setOptions(60, 'minute');
        this.secondOptions = this.setOptions(60, 'second');
    }
    // 根据格式format判断面板展示情况
    showTimeWithFormat() {
        // 纯小时
        if (this.format.indexOf('m') === -1) {
            this.onlyHour = true;
        }
        else if (this.format.indexOf('s') === -1) { // 仅时分
            this.onlyHourMinute = true;
        }
    }
    initVariable() {
        // 1. 时间格式校验
        this.format = Util.isString(this.format) ? this.format : this.localeWords.tiLocaleDate['time'];
    }
    validateMaxAndMin() {
        const defaultMaxValue = '23:59:59';
        const defaultMinValue = '00:00:00';
        // 最大值合法性校验
        this.max = TiTimeComponent.verifyTime(this.max, defaultMaxValue);
        // 最小值合法性校验
        this.min = TiTimeComponent.verifyTime(this.min, defaultMinValue);
        // 最大最小值矛盾时，设置为默认值
        if (TiTimeComponent.isSmaller(this.max, this.min)) {
            this.min = defaultMinValue;
            this.max = defaultMaxValue;
        }
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 1.0 minValue监控
        if (changes['min'] && !changes['min'].isFirstChange()) {
            // 新minValue值非法时，恢复到之前值
            if (!this.isValidMinValue(changes['min'].currentValue)) {
                this.min = changes['min'].previousValue;
                return;
            }
            // 对value值进行最小值校验
            setTimeout(() => {
                if (TiTimeComponent.isValidTime(this.model) && TiTimeComponent.isSmaller(this.model, this.min)) {
                    this.model = this.min;
                    this.formatValue();
                }
                this.setDisableData();
            }, 0);
        }
        // 2.0 maxValue监控
        if (changes['max'] && !changes['max'].isFirstChange()) {
            // 新maxValue值非法时，恢复到之前值
            if (!this.isValidMaxValue(changes['max'].currentValue)) {
                this.max = changes['max'].previousValue;
                return;
            }
            // 对value值进行最小值校验
            setTimeout(() => {
                if (TiTimeComponent.isValidTime(this.model) && TiTimeComponent.isBigger(this.model, this.max)) {
                    this.model = this.max;
                    this.formatValue();
                }
                this.setDisableData();
            }, 0);
        }
        // 3.0 format监控
        if (changes['format'] && !changes['format'].isFirstChange()) {
            // 新format值非法时，恢复到之前值
            if (!Util.isString(changes['format'].currentValue)) {
                this.format = changes['format'].previousValue;
                return;
            }
            this.showTimeWithFormat();
            if (TiTimeComponent.isValidTime(this.model)) {
                this.formatValue();
            }
        }
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        setTimeout(() => {
            this.dominatorCom = this.containerRef.nativeElement;
            this.setFocusableElems([this.dominatorCom]
                .concat(this.dropCom.nativeElement)
                .concat(this.textCom.nativeElement)
                .concat(this.inputEle.nativeElement)
                .concat(this.buttonEle.nativeElement));
        }, 0);
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        if (this.documentKeydownListener) {
            this.documentKeydownListener();
        }
    }
    // 组件声明周期钩子--end
    // 实现ControlValueAccessor接口
    /**
     * @ignore
     */
    writeValue(value) {
        super.writeValue(value);
        if (value === '' || !this.isValidValue(value)) {
            this.model = '';
            this.buttonDisabled = true;
            this.setDisableData();
            return;
        }
        this.buttonDisabled = false;
        this.model = value;
        this.formatValue();
        this.setDisableData();
    }
    // 实现ControlValueAccessor接口--end
    /**
     * @ignore
     * @description: 组件整体失焦之后处理函数
     */
    onBlur() {
        // 失焦后下拉关闭
        this.hidePanel();
        this.inputValue = this.model;
        this.setDisableData();
        this.setSelectVal();
        this.getScrollData();
    }
    // 面板延迟200ms关闭,用户输入新值之后，直接点击确认按钮关闭面板时，
    // 面板内部选中项先刷新 再关闭 200ms的延迟 用户可以看到这样一个视觉的过程
    // 200ms通过本地用例，跟规范侧共同决定的一个延时数值
    hidePanel() {
        setTimeout(() => {
            this.dropCom.hide();
            // 初始化数据，保证有时间值时，初次打开数据定位在顶部
            this.hourScroll = -1;
            this.minuteScroll = -1;
            this.secondScroll = -1;
        }, 200);
    }
    /**
     * @ignore
     * 点击dominator打开面板
     */
    onShowClick() {
        if (this.disabled) {
            return;
        }
        if (this.isClearClick) {
            this.isClearClick = false;
            return;
        }
        this.getScrollData();
        this.dropCom.show();
        this.textCom.nativeElement.focus();
        this.buttonDisabled = !this.model;
    }
    /**
     * @ignore
     * 点击确认按钮关闭面板
     */
    okClickFn() {
        this.timeValue = this.inputValue;
        this.model = this.inputValue;
        // 记录旧值，当输入非法时，返回之前合法值
        this.oldInputValue = this.inputValue;
        this.containerRef.nativeElement.focus();
        this.hidePanel();
    }
    /**
     * @ignore
     * 时间面板点击选择事件
     * @param val
     * @param title
     */
    onSelect(val, title) {
        // 禁用状态
        if (val.disabled) {
            return;
        }
        const arr = this.onlyHour ? ['00'] : this.onlyHourMinute ? ["00", "00"] : ["00", "00", "00"];
        const timeArr = this.inputValue === '' ? arr : this.inputValue.split(':');
        switch (title) {
            case 'hour':
                timeArr[0] = val.label;
                this.hourScroll = val.label * 30;
                break;
            case 'minute':
                timeArr[1] = val.label;
                this.minuteScroll = val.label * 30;
                break;
            case 'second':
                timeArr[2] = val.label;
                this.secondScroll = val.label * 30;
                break;
            default:
                break;
        }
        this.inputValue = timeArr.join(':');
        this.setSelectVal();
        this.oldInputValue = this.inputValue;
        this.buttonDisabled = false;
        this.setDisableData();
    }
    setSelectVal() {
        if (!TiTimeComponent.isValidTime(this.inputValue)) {
            this.selectedHour = null;
            this.selectedMinute = null;
            this.selectedSecond = null;
            return;
        }
        if (TiTimeComponent.isSmaller(this.inputValue, this.min)) {
            this.inputValue = this.min;
        }
        if (TiTimeComponent.isBigger(this.inputValue, this.max)) {
            this.inputValue = this.max;
        }
        const newtimeArr = this.inputValue.split(':');
        const hourVal = TiTimeComponent.addZero(Number(newtimeArr[0]), 2);
        const minuteVal = TiTimeComponent.addZero(Number(newtimeArr[1]), 2);
        const secondVal = TiTimeComponent.addZero(Number(newtimeArr[2]), 2);
        this.selectedHour = this.getSelectedVal(this.hourOptions, hourVal);
        this.selectedMinute = this.getSelectedVal(this.minuteOptions, minuteVal);
        this.selectedSecond = this.getSelectedVal(this.secondOptions, secondVal);
        // 失焦之后，个位的数字需补零
        if (this.onlyHour) {
            this.inputValue = hourVal;
        }
        else if (this.onlyHourMinute) {
            this.inputValue = hourVal + ':' + minuteVal;
        }
        else {
            this.inputValue = hourVal + ':' + minuteVal + ':' + secondVal;
        }
        this.getScrollData();
    }
    /**
     * 组件快捷键处理tab键 enter键
     */
    onKeydown(event) {
        switch (event.keyCode) {
            case TiKeymap.KEY_ENTER: // ENTER键(大键盘)
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(数字小键盘)
                this.responseEnter();
                break;
            default:
                break;
        }
    }
    /**
     * @ignore
     * enter键的功能：如果面板展开不处理，面板收起则展开，设置datePanel指令的接口值
     */
    responseEnter() {
        if (this.dropCom.isShow) {
            return;
        }
        this.getScrollData();
        // 时间面板展开
        this.dropCom.show();
        this.textCom.nativeElement.focus();
    }
    /**
     * @ignore
     * 输入为中文冒号时，自动转换为英文冒号
     * @param val
     */
    onInputChangeFn(val) {
        if (!Util.isEmptyString(val)) {
            let value = val;
            value = value.replace('：', ':');
            this.inputValue = value;
        }
        else {
            this.buttonDisabled = true;
        }
    }
    /**
     * @ignore
     * 时间框enter事件
     */
    timeKeydownFn(event, val) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.timeBlur(val);
        }
    }
    timeBlur(val) {
        if (val === '') {
            this.buttonDisabled = true;
            this.inputValue = '';
            this.oldInputValue = this.inputValue;
            this.getScrollData();
            return;
        }
        // 区分中英文冒号
        const reg = new RegExp('[\\:\\：]');
        let timeArr = val.split(reg);
        const formatArr = this.format.split(':');
        // 用户输入与format不匹配时，按照非法字符处理
        if (timeArr.length !== formatArr.length) {
            this.inputValue = this.oldInputValue;
            return;
        }
        timeArr.forEach((item) => {
            if ((item < 0 || item > 59) || isNaN(Number(item)) || parseInt(item, 10) !== Number(item)) {
                this.inputValue = this.oldInputValue;
                if (Util.isEmptyString(this.inputValue)) {
                    this.buttonDisabled = false;
                }
                return;
            }
        });
        this.oldInputValue = this.inputValue;
        this.buttonDisabled = false;
        this.setSelectVal();
        this.getScrollData();
        this.setDisableData();
    }
    // 获取滚动值
    getScrollData() {
        if (Util.isEmptyString(this.inputValue)) {
            this.hourScroll = 0;
            this.minuteScroll = 0;
            this.secondScroll = 0;
        }
        else {
            const reg = new RegExp('[\\:\\：]');
            const timeArr = this.inputValue.split(reg);
            this.hourScroll = timeArr[0] * 30;
            this.minuteScroll = timeArr[1] * 30;
            this.secondScroll = timeArr[2] * 30;
        }
    }
    /**
     * @ignore
     * 清除
     */
    onIconClearClick() {
        if (this.disabled || !this.clearIcon) {
            return;
        }
        this.inputValue = '';
        this.oldInputValue = '';
        this.timeValue = '';
        this.model = '';
        this.selectedHour = null;
        this.selectedMinute = null;
        this.selectedSecond = null;
        this.buttonDisabled = true;
        this.isClearClick = true;
        this.setDisableData();
    }
    getSelectedVal(options, val) {
        return options.find((item) => {
            if (!item.disabled && item.label === val) {
                return item;
            }
            else {
                return null;
            }
        });
    }
    setOptions(num, labelKey) {
        const options = [];
        for (let i = 0; i < num; i++) {
            options[i] = {
                label: TiTimeComponent.addZero(i, 2),
                disabled: false
            };
        }
        return options;
    }
    setDisableData() {
        if (this.max === '23:59:59' && this.min === '00:00:00') {
            return false;
        }
        const maxArr = this.max.split(':');
        const minArr = this.min.split(':');
        const timeArr = this.inputValue.split(':');
        // 根据最大最小值判定小时禁用项
        this.hourOptions.forEach((item) => {
            item.disabled = Number(item.label) < Number(minArr[0]) || Number(item.label) > Number(maxArr[0]);
        });
        // 最小小时情况,需考虑分钟禁用
        if (Number(timeArr[0]) === Number(minArr[0])) {
            this.minuteOptions.forEach((minuteItem) => {
                minuteItem.disabled = Number(minuteItem.label) < Number(minArr[1]);
            });
        }
        // 最大小时情况,需考虑分钟禁用
        if (Number(timeArr[0]) === Number(maxArr[0])) {
            this.minuteOptions.forEach((minuteItem) => {
                minuteItem.disabled = Number(minuteItem.label) > Number(maxArr[1]);
            });
        }
        // 最小时分情况,需考虑秒数禁用
        if (Number(timeArr[0]) === Number(minArr[0]) && Number(timeArr[1]) === Number(minArr[1])) {
            this.secondOptions.forEach((secondItem) => {
                secondItem.disabled = Number(secondItem.label) < Number(minArr[2]);
            });
        }
        else if (Number(timeArr[0]) === Number(maxArr[0]) && Number(timeArr[1]) === Number(maxArr[1])) { // 最大时分情况,需考虑秒数禁用
            this.secondOptions.forEach((secondItem) => {
                secondItem.disabled = Number(secondItem.label) > Number(maxArr[2]);
            });
        }
        else {
            this.secondOptions.forEach((secondItem) => {
                secondItem.disabled = false;
            });
        }
        // 非临界值(最大最小小时)时需复原
        if (Number(timeArr[0]) !== Number(minArr[0]) && Number(timeArr[0]) !== Number(maxArr[0])) {
            this.minuteOptions.forEach((minuteItem) => {
                minuteItem.disabled = false;
            });
        }
    }
    /**
    * @ignore
    * 时间选择框部分鼠标移出时去除hover样式
    */
    onMouseleave(listCom) {
        listCom.hoverOption = null;
    }
    // 组件交互方法集合--end
    // 内部公共方法集合--start
    /**
     * @description:最大值最小值检验
     */
    validateValue() {
        // 最小值校验
        if (TiTimeComponent.isSmaller(this.model, this.min)) {
            this.model = this.min;
        }
        // 最大值校验
        if (TiTimeComponent.isBigger(this.model, this.max)) {
            this.model = this.max;
        }
    }
    /**
     * @description: 时间格式化及时间各个框显示值设置
     */
    formatValue() {
        // 格式化value
        const date = new Date(`2018/5/15 ${TiTimeComponent.addColon(this.model)}`);
        const formatStr = TiLocaleFormat.formatTime(date, this.format);
        if (this.model !== formatStr) {
            this.model = formatStr;
        }
        this.timeValue = this.model;
        this.inputValue = this.model;
        this.oldInputValue = this.inputValue;
        const timeArr = this.inputValue.split(':');
        this.selectedHour = this.getSelectedVal(this.hourOptions, TiTimeComponent.addZero(Number(timeArr[0]), 2));
        this.selectedMinute = this.getSelectedVal(this.minuteOptions, TiTimeComponent.addZero(Number(timeArr[1]), 2));
        this.selectedSecond = this.getSelectedVal(this.secondOptions, TiTimeComponent.addZero(Number(timeArr[2]), 2));
    }
    /**
     * @description: 校验动态更新的minValue是否是合法值
     * @param: minValue:动态更新的传入的minValue
     */
    isValidMinValue(minValue) {
        return TiTimeComponent.isValidTime(minValue) && TiTimeComponent.isSmallerOrEqual(minValue, this.max);
    }
    /**
     * @description: 校验动态更新的maxValue是否是合法值
     * @param: maxValue:动态更新的传入的maxValue
     */
    isValidMaxValue(maxValue) {
        return TiTimeComponent.isValidTime(maxValue) && TiTimeComponent.isBiggerOrEqual(maxValue, this.min);
    }
    /**
     * @description: 判断动态更新写入组件的value值是否是一个合法值
     * @param: value 动态更新写入组件的value值
     */
    isValidValue(value) {
        return TiTimeComponent.isValidTime(value) &&
            TiTimeComponent.isBiggerOrEqual(value, this.min) &&
            TiTimeComponent.isSmallerOrEqual(value, this.max);
    }
}
TiTimeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-time',
                template: "<ti-date-dominator #dominator\r\n    [id]=\"appendId('dominator')\"\r\n    [clearable]=\"clearIcon\"\r\n    [disabled]=\"disabled\"\r\n    [isTime]='true'\r\n    [(ngModel)]=\"timeValue\"\r\n    (clear)=\"onIconClearClick()\"\r\n    (click)=\"onShowClick()\">{{ placeholder }}</ti-date-dominator>\r\n\r\n<ti-drop #drop [dominatorElem]=\"dominatorCom\"\r\n    [dominatorSpace]='dominatorSpace'\r\n    fixMaxHeight=\"true\"\r\n    [panelWidth]=\"timePanelWidth\" class='ti3-time-drop-container'\r\n    [id]=\"appendId('drop')\">\r\n    <input class='ti3-time-edit'\r\n                    type=\"text\"\r\n                    [(ngModel)]='inputValue'\r\n                    (ngModelChange)='onInputChangeFn($event)'\r\n                    (blur)='timeBlur(inputValue)'\r\n                    maxlength=\"8\"\r\n                    (keydown)='timeKeydownFn($event, inputValue)'\r\n                    [id]=\"appendId('input')\"\r\n                    #text\r\n                    tiText/>\r\n                    <!-- \u786E\u8BA4\u6309\u94AE\u7981\u7528\u573A\u666F\u4E0B\uFF0C\u65F6\u95F4\u8F93\u5165\u4E4B\u540E\u65E0\u6CD5\u76F4\u63A5tab\u5207\u6362\u7126\u70B9\u81F3\u786E\u8BA4\u6309\u94AE\uFF0C\u6545\u6DFB\u52A0\u6B64\u8FC7\u5EA6input -->\r\n                    <input #input type=\"text\"\r\n                    [ngClass]=\"{'ti3-time-edit-with-button-disabled': buttonDisabled,\r\n                    'ti3-time-edit-with-button-undisabled': !buttonDisabled}\"\r\n                    class=\"ti3-time-tab-input\"/>\r\n    <section class='ti3-time-select-container'>\r\n        <!-- \u65F6 -->\r\n        <div class='ti3-time-select-item-container'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.hour' | tiTranslate }}</span>\r\n            <ti-list #hourContainer class='ti3-time-select-list' [options]='hourOptions'\r\n                [(ngModel)]=\"selectedHour\"\r\n                [scrollTop]='hourScroll'\r\n                (select)=\"onSelect($event, 'hour')\"\r\n                (mouseleave)=\"onMouseleave(hourContainer)\"\r\n                [id]=\"appendId('list_hour')\"></ti-list>\r\n        </div>\r\n        <!-- \u5206 -->\r\n        <div class='ti3-time-select-item-container' *ngIf=\"!onlyHour\">\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.minute' | tiTranslate }}</span>\r\n           <ti-list #minuteContainer class='ti3-time-select-list' [options]='minuteOptions'\r\n           [(ngModel)]=\"selectedMinute\"\r\n           [scrollTop]='minuteScroll'\r\n           (select)=\"onSelect($event, 'minute')\"\r\n           (mouseleave)=\"onMouseleave(minuteContainer)\"\r\n           [id]=\"appendId('list_minute')\"></ti-list>\r\n        </div>\r\n        <!-- \u79D2 -->\r\n        <div class='ti3-time-select-item-container' *ngIf='!onlyHour && !onlyHourMinute'>\r\n            <span class='ti3-time-select-title'>{{ 'tiDate.second' | tiTranslate }}</span>\r\n            <ti-list #secondContainer class='ti3-time-select-list' [options]='secondOptions'\r\n            [(ngModel)]=\"selectedSecond\"\r\n            [scrollTop]='secondScroll'\r\n            (select)=\"onSelect($event, 'second')\"\r\n            (mouseleave)=\"onMouseleave(secondContainer)\"\r\n            [id]=\"appendId('list_second')\"></ti-list>\r\n        </div>\r\n    </section>\r\n    <div class='ti3-time-button-confirm'>\r\n        <button #button tiButton size=\"small\" [disabled]=\"buttonDisabled\" (click)='okClickFn()' [id]=\"appendId('button')\">{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n    </div>\r\n</ti-drop>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiTimeComponent)],
                host: {
                    '[class.ti3-time-container]': 'true',
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host.ti3-time-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-time-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-time-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-time-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-time-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}:host.ti3-time-container{width:120px}::ng-deep :root .ti3-time-drop-container:focus{outline:0}:host.ti3-time-container{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block;font-size:var(--ti-common-font-size-base);height:var(--ti-input-height);line-height:normal;position:relative;user-select:none;vertical-align:middle}.ti3-time-select-container{border:1px solid var(--ti-common-color-line-dividing);display:flex;justify-content:space-around}.ti3-time-select-item-container{border-right:1px solid var(--ti-common-color-line-dividing);width:100%}.ti3-time-select-item-container:last-child{border-right:none}::ng-deep :root .ti3-time-select-list{height:230px;overflow-y:auto;width:100%}::ng-deep :root .ti3-time-select-list li{margin-top:0;text-align:center}.ti3-time-drop-container{height:365px;padding:var(--ti-common-space-3x) var(--ti-common-space-4x)}.ti3-time-edit{display:block;margin-bottom:var(--ti-common-space-3x);width:100%}::ng-deep .ti3-time-edit{border-color:var(--ti-input-border-color-focus)!important}.ti3-time-select-title{display:block;height:30px;line-height:30px;margin-left:-6px;text-align:center;width:100%}.ti3-time-button-confirm{float:right;margin-top:var(--ti-common-space-3x)}::ng-deep .ti3-time-edit-with-button-disabled{opacity:0}::ng-deep .ti3-time-edit-with-button-undisabled{display:none}.ti3-time-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}"]
            },] }
];
TiTimeComponent.ctorParameters = () => [
    { type: NgZone },
    { type: ElementRef },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiTimeComponent.propDecorators = {
    format: [{ type: Input }],
    max: [{ type: Input }],
    min: [{ type: Input }],
    clearIcon: [{ type: Input }],
    containerRef: [{ type: ViewChild, args: ['dominator', { static: true },] }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, { static: true },] }],
    textCom: [{ type: ViewChild, args: ['text', { static: true },] }],
    inputEle: [{ type: ViewChild, args: ['input', { static: true },] }],
    buttonEle: [{ type: ViewChild, args: ['button', { static: true },] }],
    onKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};

class TiTimeModule {
}
TiTimeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiButtonModule,
                    TiDropModule,
                    TiListModule,
                    TiDateDominatorModule,
                    TiLocaleModule,
                    TiTextModule
                ],
                exports: [TiTimeComponent],
                declarations: [TiTimeComponent]
            },] }
];

class TiDatetimeModule {
}
TiDatetimeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiLocaleModule,
                    TiDropModule,
                    TiButtonModule,
                    TiDatePanelModule,
                    TiDateEditModule,
                    TiTextModule,
                    TiTimeModule,
                    TiDateDominatorModule
                ],
                exports: [TiDatetimeComponent],
                declarations: [TiDatetimeComponent]
            },] }
];

/**
 * DatetimeRange日期时间范围组件
 *
 * Datetime组件提供了一种方便的显示和设置日期时间范围的方式。
 *
 * <example-url>../tiny3demo/#/datetimerange/datetimerange-all</example-url>
 */
class TiDatetimeRangeComponent extends TiDateBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 保存model值
         */
        this.oldModel = {
            begin: null,
            end: null,
        };
        /**
         * @ignore
         * 对应Time组件的接口属性
         */
        this.beginTime = {};
        /**
         * @ignore
         * 对应Time组件的接口属性
         */
        this.endTime = {};
        /**
         * @ignore
         * 标记date/datetime的类型
         */
        this.isDatetime = true;
        /**
         * @ignore
         * 用于标记是不是range
         */
        this.isRange = true;
        /**
         * @ignore
         */
        this.oldBegintimeValue = '';
        /**
         * @ignore
         */
        this.oldEndtimeValue = '';
        /**
         * @ignore
         * placeholder提示文本
         */
        this.placeholder = `${TiLocale.getLocaleWords().tiDate.rangeBeginLabel} ─ ${TiLocale.getLocaleWords().tiDate.rangeEndLabel}`;
    }
    ngOnInit() {
        super.ngOnInit();
        // 将日期与时间的format拼接为一个字符串
        this.dominatorFormat = `${this.format.date} ${this.format.time}`;
        this.oldFormat = this.format;
        // model有值时，需要记录初始时间值
        if (Util.isUndefined(this.model)) {
            return;
        }
        if (this.model !== null) {
            setTimeout(() => {
                this.oldBegintimeValue = TiDateUtil.getTimeStr(this.model.begin);
                this.oldEndtimeValue = TiDateUtil.getTimeStr(this.model.end);
            }, 0);
        }
    }
    ngOnChanges(changes) {
        // 验证最大值最小值，为了处理最大值和最小值从合法日期变为undefined 的情景
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.validateMinAndMax(this.config, this.isDatetime);
        }
    }
    ngDoCheck() {
        if (!Util.isUndefined(this.model)) {
            // 监听model值的变化
            this.setModel(this.isDatetime);
            // 监听format变化
            this.setFormat();
        }
    }
    /**
     * @ignore
     * 确认按钮事件处理
     */
    onOkClick() {
        if (this.inValidValue) {
            return;
        }
        const beginDateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        // 中间空格误删
        const beginValue = new Date(`${beginDateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        const endDateStr = TiDateUtil.getDateStr(this.datePanel['value']['end']);
        // 中间空格误删
        const endValue = new Date(`${endDateStr} ${TiDateUtil.addColon(this.endTime['value'])}`);
        const newModel = {
            begin: beginValue,
            end: endValue
        };
        // 新旧值不同更新model值
        if (!this.rangeValueIsEqual(this.model, newModel, this.isDatetime)) {
            this.model = newModel;
        }
        this.hideDrop();
        this.okClick.emit(this.model);
    }
    /**
     * @ignore
     * model值的合法性判断
     */
    isValidValue(value) {
        if (value === null) {
            return true;
        }
        if (TiDateUtil.isDate(value['begin']) && TiDateUtil.isDate(value['end']) &&
            value['begin'].getTime() <= value['end'].getTime() &&
            TiDateUtil.isBetweenMaxAndmin(value['begin'], this.min, this.max) &&
            TiDateUtil.isBetweenMaxAndmin(value['end'], this.min, this.max)) {
            return true;
        }
        return false;
    }
    /**
     * @ignore
     * 将value转换成format接口格式的字符串
     */
    formatValue() {
        if (this.model === null || (this.model.begin === null && this.model.end === null)) {
            this.inputValue = '';
        }
        else {
            // 空格误删
            const format = `${this.format.date} ${TiDateUtil.addAmPm(this.format.time)}`;
            const begin = TiLocaleFormat.formatDateTime(this.model.begin, format);
            const end = TiLocaleFormat.formatDateTime(this.model.end, format);
            // 注意：中划线用的是制表符中的中划线，与正常的中线区分开2017-2-12 - 2018-3-20
            this.inputValue = `${begin} ─ ${end}`;
        }
    }
    /**
     * @ignore
     * 配置时间日期面板接口
     */
    setPickerDate() {
        // 设置datepanel指令接口
        this.setDatePanelOptions();
        // 设置time指令接口
        this.setTimeOptions();
        // 设置OK按钮状态
        this.setOkBtnState();
        this.beginTimeDisabled = this.model === null ? true : false;
        this.endTimeDisabled = this.model === null ? true : false;
        this.timeEditDisabled = this.beginTimeDisabled && this.endTimeDisabled;
    }
    // 设置datepanel指令接口
    setDatePanelOptions() {
        let value;
        if (this.model === null) {
            value = {
                begin: null,
                end: null
            };
        }
        else {
            value = {
                begin: this.model.begin,
                end: this.model.end
            };
        }
        this.datePanel = {
            value,
            max: this.max,
            min: this.min,
            format: this.format,
            picker: 'day',
            select: () => {
                const obj = {
                    value: this.datePanel.value[this.focusedPosition],
                    focusedPosition: this.focusedPosition
                };
                this.dayClick.emit(obj);
                // 选择开始日期
                if (this.focusedPosition === 'begin') {
                    if (this.beginTimeDisabled) {
                        this.beginTime['value'] = TiDateUtil.getTimeStr(new Date());
                    }
                    this.beginTimeDisabled = false;
                    this.timeEditDisabled = false;
                    this.dateEditComs.last.focus();
                    this.focusedPosition = 'end';
                }
                else {
                    if (this.endTimeDisabled) {
                        this.endTime['value'] = TiDateUtil.getTimeStr(new Date());
                    }
                    this.endTimeDisabled = false;
                    if (this.focusedPosition === 'end' && this.datePanel.value.begin === null) {
                        this.focusedPosition = 'begin';
                        this.dateEditComs.first.focus();
                    }
                }
                this.validTime();
                this.setOkBtnState();
            },
            selectTimeFn: (obj) => {
                this.setTimeFn(obj, this.beginTime, this.endTime);
                this.setOkBtnState();
                // 选择结束时分秒 焦点移动到结束时间框
                if (obj.timeOption.includes('end')) {
                    this.textComs.last.nativeElement.focus();
                }
                else {
                    // 选择开始时分秒 焦点移动到开始时间框
                    this.textComs.first.nativeElement.focus();
                }
            }
        };
    }
    validTime() {
        const beginDateStr = this.datePanel.value.begin ? TiDateUtil.getDateStr(this.datePanel.value.begin) : '';
        const beginDateTime = new Date(` ${beginDateStr} ${this.beginTime.value}`);
        const endDateStr = this.datePanel.value.end ? TiDateUtil.getDateStr(this.datePanel.value.end) : '';
        const endDateTime = new Date(` ${endDateStr} ${this.endTime.value}`);
        if (TiDateUtil.isSmaller(beginDateTime, this.min)) {
            this.beginTime.value = TiDateUtil.getTimeStr(this.min);
        }
        if (TiDateUtil.isBigger(beginDateTime, this.max)) {
            this.beginTime.value = TiDateUtil.getTimeStr(this.max);
        }
        if (TiDateUtil.isBigger(endDateTime, this.max)) {
            this.endTime.value = TiDateUtil.getTimeStr(this.max);
        }
        this.oldBegintimeValue = this.beginTime['value'];
        this.oldEndtimeValue = this.endTime['value'];
    }
    /**
     * @ignore
     *  时间框失焦事件
     */
    timeBlur(pos, val) {
        let timeVal = val;
        // 区分中英文冒号
        const reg = new RegExp('[\\:\\：]');
        this.beginTime = JSON.parse(JSON.stringify(this.beginTime));
        this.endTime = JSON.parse(JSON.stringify(this.endTime));
        // 输入区间是否存在小数点，非整数
        let isNotInteger = false;
        const timeArr = val.split(reg);
        timeArr.forEach((item, index) => {
            if (item.length === 1) {
                timeArr[index] = '0' + item;
            }
            if (parseInt(item, 10) !== Number(item)) {
                isNotInteger = true;
            }
        });
        timeVal = timeArr.join(':');
        const dateStr = '2020/10/30';
        if (pos === 'begin') {
            this.beginTime.value = timeVal;
            const beginDateVal = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.begin)} ${this.beginTime.value}`);
            const isSmallerThanMin = TiDateUtil.isSmaller(beginDateVal, this.min);
            const beginDate = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
            const dateVal = new Date(2020, 10, 30, parseInt(timeArr[0], 10), parseInt(timeArr[1], 10), parseInt(timeArr[2], 10));
            if (String(beginDate) === 'Invalid Date' || String(dateVal) === 'Invalid Date' || timeArr.length > 3 || isNotInteger || !this.isBeginSmallerThanEnd() || isSmallerThanMin) {
                this.beginTime.value = this.oldBegintimeValue;
            }
            else {
                this.oldBegintimeValue = this.beginTime.value;
            }
        }
        else {
            this.endTime.value = timeVal;
            const endDateVal = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.end)} ${this.endTime.value}`);
            const isBiggerThanMax = TiDateUtil.isBigger(endDateVal, this.max);
            const endDate = new Date(`${dateStr} ${TiDateUtil.addColon(this.endTime['value'])}`);
            const dateVal = new Date(2020, 10, 30, parseInt(timeArr[0], 10), parseInt(timeArr[1], 10), parseInt(timeArr[2], 10));
            if (String(endDate) === 'Invalid Date' || String(dateVal) === 'Invalid Date' || timeArr.length > 3 || isNotInteger || !this.isBeginSmallerThanEnd() || isBiggerThanMax) {
                this.endTime.value = this.oldEndtimeValue;
            }
            else {
                this.oldEndtimeValue = this.endTime.value;
            }
        }
        this.setOkBtnState();
    }
    /**
     * @ignore
     * 时间框enter事件
     */
    timeKeydown(pos, val, event) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.timeBlur(pos, val);
        }
    }
    /**
     * @ignore
     */
    dateEditBlur(val, pos) {
        if (val === null) {
            return;
        }
        if (TiDateUtil.isBetweenMaxAndmin(val, this.min, this.max)) {
            if (pos === 'begin') {
                const inputValue = this.dateEditComs.first.nativeElement.firstChild.value;
                if (inputValue === '') {
                    return;
                }
                const beginDateVal = new Date(`${inputValue} ${this.beginTime['value']}`);
                if (TiDateUtil.isDate(this.datePanel.value.end)) {
                    const endDateVal = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.end)} ${this.endTime['value']}`);
                    if (TiDateUtil.isBigger(beginDateVal, endDateVal)) {
                        this.datePanel.value.begin = this.oldBeginValue || this.oldModel && this.oldModel.begin;
                        return;
                    }
                }
                if (this.beginTimeDisabled) {
                    this.beginTime['value'] = TiDateUtil.getTimeStr(new Date());
                }
                this.oldBeginValue = this.datePanel.value.begin;
                this.beginTimeDisabled = false;
            }
            else {
                if (this.endTimeDisabled) {
                    this.endTime['value'] = TiDateUtil.getTimeStr(new Date());
                }
                const inputValue = this.dateEditComs.last.nativeElement.firstChild.value;
                if (inputValue === '') {
                    return;
                }
                const endDateVal = new Date(`${inputValue} ${this.endTime['value']}`);
                if (TiDateUtil.isDate(this.datePanel.value.begin)) {
                    const beginDateVal = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.begin)} ${this.beginTime['value']}`);
                    if (TiDateUtil.isBigger(beginDateVal, endDateVal)) {
                        this.datePanel.value.end = this.oldEndValue || this.oldModel && this.oldModel.end;
                        return;
                    }
                }
                this.oldEndValue = this.datePanel.value.end;
                this.endTimeDisabled = false;
            }
            this.validTime();
            this.setOkBtnState();
            this.timeEditDisabled = this.beginTimeDisabled && this.endTimeDisabled;
        }
    }
    /**
     * @ignore
     */
    onKeydownFn(event, val, pos) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.dateEditBlur(val, pos);
        }
    }
    // 设置time指令接口
    setTimeOptions() {
        // 设置开始time指令接口
        this.setBeginTimeOptions();
        // 设置结束time指令接口
        this.setEndTimeOptions();
    }
    // 设置开始面板time指令接口
    setBeginTimeOptions() {
        // value接口设置
        this.setBeginTimeValue();
        // max接口设置
        this.setBeginTimeMaxValue();
        // min接口设置
        this.setBeginTimeMinValue();
    }
    // time指令的起始面板的value接口设置 点击删除按钮：如果设置nowDateTime并且值为合法时间日期，时间设置为nowDateTime的时间
    setBeginTimeValue() {
        if (this.model === null || this.model['begin'] === null && this.model['end'] === null) {
            this.beginTime['value'] = '';
            return;
        }
        this.beginTime['value'] = TiDateUtil.getTimeStr(this.model.begin);
    }
    /**
     * @ignore
     * time指令的起始面板的max接口设置
     */
    setBeginTimeMaxValue() {
        // 起始日期是最大日期时，时间组件最大值是max接口中的时间；其他情况最大值是"23:59:59"
        const value = this.datePanel['value'];
        this.beginTime['max'] = ((value instanceof Object) && TiDateUtil.isDateEqual(this.max, value['begin'])) ?
            TiDateUtil.getTimeStr(this.max) : '23:59:59';
    }
    /**
     * @ignore
     * time指令的起始面板的min接口设置
     */
    setBeginTimeMinValue() {
        // 起始日期是最小日期时，时间组件最小值是min接口中的时间；其他情况最大值是"00:00:00"
        const value = this.datePanel['value'];
        this.beginTime['min'] = ((value instanceof Object) && TiDateUtil.isDateEqual(this.min, value['begin'])) ?
            TiDateUtil.getTimeStr(this.min) : '00:00:00';
    }
    // 设置结束面板time指令接口
    setEndTimeOptions() {
        // value接口设置
        this.setEndTimeValue();
        // max接口设置
        this.setEndTimeMaxValue();
        // min接口设置
        this.setEndTimeMinValue();
    }
    // time指令的结束面板的value接口设置
    setEndTimeValue() {
        if (this.model === null || this.model['begin'] === null && this.model['end'] === null) {
            this.endTime['value'] = '';
            return;
        }
        this.endTime['value'] = TiDateUtil.getTimeStr(this.model.end);
    }
    /**
     * @ignore
     * time指令的结束面板的max接口设置
     */
    setEndTimeMaxValue() {
        // 结束日期是最大日期时，时间组件最大值是max接口中的时间; 否则，时间组件最大值是"23:59:59"
        const value = this.datePanel['value'];
        this.endTime['max'] = ((value instanceof Object) && TiDateUtil.isDateEqual(this.max, value['end'])) ?
            TiDateUtil.getTimeStr(this.max) : '23:59:59';
    }
    /**
     * @ignore
     * time指令的结束面板的min接口设置
     */
    setEndTimeMinValue() {
        // 起始日期是最小日期时，时间组件最小值是min接口中的时间；其他情况最大值是"00:00:00"
        const value = this.datePanel['value'];
        this.endTime['min'] = ((value instanceof Object) && TiDateUtil.isDateEqual(this.min, value['end'])) ?
            TiDateUtil.getTimeStr(this.min) : '00:00:00';
    }
    /**
     * @ignore
     * 设置确认按钮的状态
     */
    setOkBtnState() {
        // 输入中文冒号之后，及时转换为英文冒号
        const inputvalue = this.beginTime.value;
        const inputvalue1 = this.endTime.value;
        this.beginTime.value = inputvalue.replace('：', ':');
        this.endTime.value = inputvalue1.replace('：', ':');
        // 判断下拉面板中时间区间是否合法
        this.inValidValue = !this.isValidRange();
        if (this.buttonComs) {
            this.setAttr(this.buttonComs.last.nativeElement, 'disabled', this.inValidValue);
            this.setInputStyle(this.inValidValue);
        }
    }
    // 判断下拉面板中时间区间是否合法
    isValidRange() {
        const date = this.datePanel.value;
        return (date instanceof Object) && (TiDateUtil.isDate(date.begin)) &&
            (TiDateUtil.isDate(date.end)) && this.isBeginSmallerThanEnd();
    }
    // 判断起始值和结束值都在最小值最大值之间
    isBeginSmallerThanEnd() {
        if (!TiDateUtil.isDate(this.datePanel.value.begin) || !TiDateUtil.isDate(this.datePanel.value.end)) {
            return false;
        }
        // 组装起始日期时间 空格误删
        const begin = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.begin)} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        const end = new Date(`${TiDateUtil.getDateStr(this.datePanel.value.end)} ${TiDateUtil.addColon(this.endTime['value'])}`);
        return begin.getTime() <= end.getTime();
    }
}
TiDatetimeRangeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-datetime-range',
                template: "<ti-date-dominator  #dominator\r\n                    [id]=\"appendId('dominator')\"\r\n                    type = \"range\"\r\n                    [format] = \"dominatorFormat\"\r\n                    [disabled]=\"disabled\"\r\n                    [clearable]=\"clearIcon\"\r\n                    [(ngModel)]=\"inputValue\"\r\n                    (clear)=\"onIconClearClick($event)\"\r\n                    (click)=\"onShowClick()\">{{placeholder}}</ti-date-dominator><!-- \u5206\u5272\u7EBF\u662F\u7279\u6B8A\u5B57\u7B26\u5236\u8868\u7B26\uFF0C\u4E0D\u662F\u666E\u901A\u4E2D\u7EBF -->\r\n<ti-drop #drop\r\n        [id]=\"appendId('drop')\"\r\n        class=\"ti3-date-range-picker\"\r\n        [ngClass]=\"{'ti3-date-time-range-customize': hasCustomizeTime}\"\r\n        [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        fixMaxHeight=\"true\"\r\n        [panelWidth]=\"daterangePanelWidth\"\r\n        [panelAlign]=\"panelAlign\"\r\n        [browserSpace]=\"browserSpace\"\r\n        [dominatorSpace]='dominatorSpace'\r\n        [determinPositionFn]=\"determinPositionFn\"\r\n        theme='noborder'>\r\n\r\n        <section class='ti3-date-clear'>\r\n            <section *ngIf='hasCustomizeTime' class='ti3-date-time-range-customize-container'>\r\n                <ng-container *ngTemplateOutlet=\"customizeTemplate; context:  {$implicit: customizeOptions}\"></ng-container>\r\n        </section>\r\n\r\n        <section [ngClass]=\"{'ti3-datetime-range-panel-container': hasCustomizeTime}\">\r\n            <ti-date-edit class='ti3-date-time-range-dateedit'\r\n                [ngClass]=\"{'ti3-date-time-range-begin-edit': focusedPosition === 'begin'}\"\r\n                [(ngModel)] = \"datePanel.value.begin\"\r\n                [min] = \"datePanel.min\"\r\n                [max] = \"datePanel.max\"\r\n                (click)=\"dateEditClick('begin')\"\r\n                (focus)=\"dateEditFocus('begin')\"\r\n                (blur)=\"dateEditBlur(datePanel.value.begin, 'begin')\"\r\n                (keydown)=\"onKeydownFn($event, datePanel.value.begin, 'begin')\"\r\n                [format]=\"datePanel.format\"\r\n                [id]=\"appendId('begin_edit')\"></ti-date-edit>\r\n            <input class='ti3-date-time-range-timeedit'\r\n                [ngClass]=\"{'ti3-date-time-range-begintime-edit': focusedPosition === 'beginTime'}\"\r\n                type=\"text\"\r\n                maxlength='8'\r\n                [(ngModel)]=\"beginTime.value\"\r\n                (focus)=\"timeFocus('begin')\"\r\n                [disabled]=\"beginTimeDisabled\"\r\n                [placeholder]='timeplaceholder'\r\n                (blur)=\"timeBlur('begin',beginTime.value)\"\r\n                (keydown)=\"timeKeydown('begin', beginTime.value, $event)\"\r\n                [id]=\"appendId('begin_input')\"\r\n                tiText/>\r\n            <span class='ti3-date-range-splitline'> \u2500 </span>\r\n            <ti-date-edit class='ti3-date-time-range-dateedit'\r\n                [ngClass]=\"{'ti3-date-time-range-end-edit': focusedPosition === 'end'}\"\r\n                [(ngModel)] = \"datePanel.value.end\"\r\n                [min] = \"datePanel.min\"\r\n                [max] = \"datePanel.max\"\r\n                (click)=\"dateEditClick('end')\"\r\n                (focus)=\"dateEditFocus('end')\"\r\n                (blur)=\"dateEditBlur(datePanel.value.end, 'end')\"\r\n                (keydown)=\"onKeydownFn($event, datePanel.value.end, 'end')\"\r\n                [format]=\"datePanel.format\"\r\n                [id]=\"appendId('end_edit')\"></ti-date-edit>\r\n                <!-- \u786E\u8BA4\u6309\u94AE\u7981\u7528\u573A\u666F\u4E0B\uFF0C\u7ED3\u675F\u6846\u8F93\u5165\u4E4B\u540E\u65E0\u6CD5\u76F4\u63A5tab\u5207\u6362\u7126\u70B9\u81F3\u786E\u8BA4\u6309\u94AE\uFF0C\u6545\u6DFB\u52A0\u6B64\u8FC7\u5EA6input -->\r\n                <input #input type=\"text\" class=\"ti3-tab-input\"/>\r\n            <input type=\"text\" class='ti3-date-time-range-timeedit'\r\n                [ngClass]=\"{'ti3-date-time-range-endtime-edit': focusedPosition === 'endTime'}\"\r\n                [(ngModel)]=\"endTime.value\"\r\n                [disabled]=\"endTimeDisabled\"\r\n                [placeholder]='timeplaceholder'\r\n                maxlength='8'\r\n                tiText\r\n                (focus)=\"timeFocus('end')\"\r\n                (keydown)=\"timeKeydown('end',endTime.value, $event)\"\r\n                (blur)=\"timeBlur('end',endTime.value)\"\r\n                [id]=\"appendId('end_input')\"/>\r\n            <ti-date-panel\r\n                [id]=\"appendId('begin-panel')\"\r\n                [(value)]=\"datePanel.value\"\r\n                [focusedPosition]='focusedPosition'\r\n                [selectTime]='selectTime'\r\n                [beginTime]='beginTime'\r\n                [endTime]='endTime'\r\n                [endTimeDisabled]='endTimeDisabled'\r\n                [beginTimeDisabled]='beginTimeDisabled'\r\n                [isRange]='true'\r\n                [(picker)]=\"datePanel.picker\"\r\n                (select)='datePanel.select()'\r\n                (selectTimeFn)='datePanel.selectTimeFn($event)'\r\n                [min]=\"datePanel.min\"\r\n                [max]=\"datePanel.max\"\r\n                [format]=\"format.date\"\r\n                [nowDateTime]=\"nowDateTime\"></ti-date-panel>\r\n        </section>\r\n        </section>\r\n        <section class=\"ti3-date-range-picker-footer\" [ngClass]=\"{'ti3-date-range-select-time': selectTime}\">\r\n            <section class=\"ti3-date-picker-footer-right\">\r\n                <button class=\"ti3-date-picker-footer-btn\"\r\n                        [ngClass]=\"{'ti3-date-picker-footer-noborder': selectTime}\"\r\n                        [id]=\"appendId('okBtn')\"\r\n                        type=\"button\"\r\n                        size=\"small\"\r\n                        (click)=\"onOkClick()\"\r\n                        tiButton>{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n                <section (click)='selectTimeFn()' [id]=\"appendId('select_time')\" *ngIf='!selectTime'  class='ti3-datetime-select-btn' [ngClass]=\"{'ti3-datetime-select-btn-disabled': timeEditDisabled}\">{{'tiDate.selectTime' | tiTranslate}}</section>\r\n                <section (click)='selectDateFn()' [id]=\"appendId('select_date')\" *ngIf='selectTime' class='ti3-datetime-select-btn'>{{'tiDate.selectDate' | tiTranslate}}</section>\r\n            </section>\r\n        </section>\r\n</ti-drop>\r\n<ng-template #customizeTemplate let-options>\r\n    <ul [id]=\"appendId('list')\">\r\n        <li *ngFor='let option of options; index as i;' class='ti3-customize-time-label' (click)='customizeTimeClickFn(option.value)' [id]=\"appendId('label_' + i)\">{{option.label}}</li>\r\n    </ul>\r\n</ng-template>\r\n",
                host: {
                    '[class.ti3-datetime-range-input-container]': 'true',
                    '(blur)': 'hidePanel()'
                },
                providers: [TiFormComponent.getValueAccessor(TiDatetimeRangeComponent)],
                styles: [".ti3-compnent-container-border,:host.ti3-datetime-range-input-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-datetime-range-input-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-datetime-range-input-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-datetime-range-input-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-datetime-range-input-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-customize-time-label{color:var(--ti-common-color-text-primary);cursor:pointer;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-bottom:10px}.ti3-customize-time-label:hover{color:var(--ti-common-color-line-active)}.ti3-date-clear{display:flex;*zoom:1}.ti3-date-clear:after{clear:both}.ti3-date-clear:after,.ti3-date-clear:before{content:\"\";display:table}.ti3-datetime-select-btn{color:var(--ti-common-color-text-highlight);cursor:pointer;float:right;line-height:24px;padding-right:var(--ti-common-space-2x)}.ti3-datetime-select-btn-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-date-range-splitline{padding:0 6px}.ti3-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}::ng-deep :root{--ti-date-picker-middle-margin:20px;--ti-date-picker-padding-bottom:12px;--ti-date-picker-padding-horizon:16px}:host.ti3-datetime-range-input-container{width:320px}.ti3-dropdown-container.ti3-date-range-picker{font-size:var(--ti-datetime-input-font-size);padding:var(--ti-date-picker-padding-bottom) var(--ti-date-picker-padding-horizon);width:calc(var(--ti-datetime-day-width)*7 + var(--ti-date-picker-padding-horizon) + var(--ti-date-picker-middle-margin) + 2px);z-index:var(--ti-datetime-z-index)}.ti3-dropdown-container.ti3-date-range-picker:focus{outline:0}.ti3-date-range-begin-end-text{color:var(--ti-datetime-picker-color);height:var(--ti-datetime-input-font-size);line-height:var(--ti-datetime-input-font-size);margin-top:var(--ti-common-space-10);padding-left:var(--ti-common-space-10)}.ti3-datetime-range-time{height:var(--ti-input-height)}.ti3-date-range-end-container{float:right;width:calc(var(--ti-datetime-day-width)*7)}.ti3-date-range-end-container ti-date-edit>input{text-align:center}.ti3-date-range-picker-footer{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;border-top:1px solid var(--ti-common-color-line-dividing);box-sizing:border-box;clear:both;margin-top:var(--ti-common-space-3x);padding-top:var(--ti-common-space-10);user-select:none;width:100%;*zoom:1}.ti3-date-range-picker-footer:after{clear:both;content:\"\";display:table}.ti3-date-range-picker-footer:before{content:\"\";display:table}.ti3-date-range-picker-footer .ti3-date-picker-footer-btn{float:right}.ti3-date-range-picker-footer .ti3-date-picker-footer-btn:last-child{margin-right:var(--ti-common-space-10)}.ti3-date-range-picker-footer.ti3-date-range-select-time{border-top:none;margin-top:0}.ti3-date-picker-footer-right{float:right}.ti3-date-time-range-customize{width:677px!important}.ti3-date-time-range-customize-container{border-right:1px solid var(--ti-common-color-line-dividing);float:left;height:292px;padding-right:var(--ti-common-space-4x);width:80px}.ti3-date-time-range-dateedit{display:inline-block;margin-right:var(--ti-common-space-2x);width:120px}::ng-deep .ti3-date-time-range-begin-edit input[tiText],::ng-deep .ti3-date-time-range-begintime-edit,::ng-deep .ti3-date-time-range-end-edit input[tiText],::ng-deep .ti3-date-time-range-endtime-edit{border-color:var(--ti-input-border-color-focus)!important}.ti3-date-time-range-timeedit{display:inline-block;width:120px}.ti3-datetime-range-panel-container{float:right;padding-left:var(--ti-common-space-4x)}"]
            },] }
];

class TiDatetimeRangeModule {
}
TiDatetimeRangeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiLocaleModule,
                    TiDropModule,
                    TiButtonModule,
                    TiDatePanelModule,
                    TiDateEditModule,
                    TiTimeModule,
                    TiTextModule,
                    TiDateDominatorModule
                ],
                exports: [TiDatetimeRangeComponent],
                declarations: [TiDatetimeRangeComponent]
            },] }
];

/**
 * @ignore
 */
class TiDominatorComponent extends TiFormComponent {
    constructor(render, hostRef, zone) {
        super(hostRef, render);
        this.zone = zone;
        this.buttonStyle = 'dropdown'; // 按钮样式 三角or加号 'dropdown' 'plus'
        this.multiple = false; // 单选多选
        this.selectedTipPosition = 'auto'; // 选中项文本超出时tip展开方向
        this.dropshow = false; // 在select组件中使用，记录下拉面板展开状态
        /**
         * 设置dominator最多显示几行，默认2行, multiple为true时生效
         */
        this.maxLine = 2;
        /**
         * 设置是否显示已选项的个数，默认不显示，multiple为true时生效
         *
         * 10.1.0新增
         */
        this.showSelectedNumber = false;
        /**
         * 单选下拉选择框是否开启清除已选项功能
         *
         * 3.0.8新增
         */
        this.clearable = false;
        this.delete = new EventEmitter();
        /**
         * 当单选下拉选择框开启清除已选项功能时，点击清除按钮时触发
         *
         * 3.0.8新增
         */
        this.clear = new EventEmitter();
        this.isMouseIn = false;
    }
    ngOnInit() {
        super.ngOnInit();
        // 每行tag的高度24px, +2 是因为 .ti3-select-dominator-text 元素上下padding
        // tslint:disable-next-line: binary-expression-operand-order
        this.maxHeight = !this.multiple ? '' : this.maxHeight ? this.maxHeight : (this.maxLine * 24 + 2) + 'px';
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.setFocusableElems([this.nativeElement]);
        this.zone.runOutsideAngular(() => {
            // 内部mousedown事件冒泡至根节点
            this.renderer.listen(this.nativeElement, 'mousedown', (event) => {
                if (this.disabled) {
                    event.preventDefault(); // 不能聚焦，不能click
                }
            });
            if (this.clearable && !this.multiple) {
                this.renderer.listen(this.nativeElement, 'mouseenter', () => {
                    if (this.disabled || Util.isEmptyString(this.model)) {
                        return;
                    }
                    this.zone.run(() => {
                        this.isMouseIn = true;
                    });
                });
                this.renderer.listen(this.nativeElement, 'mouseleave', () => {
                    if (this.isMouseIn) {
                        this.zone.run(() => {
                            this.isMouseIn = false;
                        });
                    }
                });
            }
        });
    }
    /**
     * 兼容旧版：
     * 3.1.2版select只能内嵌一个模板，无命名。
     * 新版可以内嵌2个模板，示例书写要求都命名。
     * 但需要兼容旧版无命名测试用例。
     */
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果item模板为空，那么把第一个出现的无标签（无footer等标签）模板作为item
        if (!this.itemTemplate && this.firstTemplate !== this.placeholderTemplate) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    /**
     * 用户点击叉号，删除一个项目
     * @param item
     * @returns
     */
    onDelete(item) {
        if (item.disabled === true) {
            return;
        }
        // 删除选中
        const index = this.model.indexOf(item);
        if (index !== -1) {
            this.model.splice(index, 1);
        }
        this.delete.emit({
            item: item,
            model: this.model
        });
        // 强行向外通知model改变。
        this.model = this.model.concat();
    }
    /**
     * @ignore
     */
    onClickClear(event) {
        event.stopPropagation();
        this.model = null;
        this.clear.emit();
    }
    showClear() {
        return this.clearable && !this.multiple && !this.disabled && (this.isMouseIn || this.focused) && this.model;
    }
}
TiDominatorComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-dominator',
                template: "<!--\u6A21\u677F\u4F18\u5148\uFF0Clabel\u5176\u6B21-->\r\n<section class=\"ti3-select-dominator-text\"\r\n    [ngStyle]=\"{'max-height': maxHeight}\"\r\n    [ngClass]=\"{\r\n        'ti3-multiselect-container': multiple,\r\n        'ti3-tags-input-container': type === 'tagsinput'\r\n        }\"\r\n    [id]=\"appendId('input')\">\r\n    <!-- \u5355\u9009 -->\r\n    <ng-container *ngIf=\"!multiple else multipleTemplate\">\r\n        <section class=\"ti3-overflow-padding\"\r\n            [tiTip]=\" model?model.tip : ''\"\r\n            [tiTipContext]=\"model\"\r\n            [tiTipPosition]='selectedTipPosition'\r\n            [tiTipHostEleX]=\"nativeElement\"\r\n            ><ng-container  *ngIf=\"model else placeholderTemplate?placeholderTemplate:defaultPlaceholderTemplate\">\r\n                <ng-container *ngIf=\"itemTemplate else defaultItemTemplate\">\r\n                  <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: model}\">\r\n                  </ng-container>\r\n                </ng-container>\r\n                <ng-template #defaultItemTemplate><span [title]=\"model[labelKey]\">{{model[labelKey]}}</span></ng-template>\r\n            </ng-container>\r\n            <ng-template #defaultPlaceholderTemplate><span class=\"ti3-placeholder\" [title]=\"placeholder\">{{placeholder}}</span></ng-template>\r\n        </section>\r\n    </ng-container>\r\n    <!-- \u591A\u9009 -->\r\n    <ng-template #multipleTemplate>\r\n        <ng-container *ngIf=\"model && model.length else placeholderTemplate?placeholderTemplate:defaultPlaceholderMultiTemplate\">\r\n            <ti-tag *ngFor=\"let item of model; let i = index\" [maxWidth]=\"tagMaxWidth\" [id]=\"appendId('tag'+i)\"\r\n                [disabled]=\"disabled||item.disabled\"\r\n                [tiTip]=\"item.tip\"\r\n                [tiTipPosition]='selectedTipPosition'\r\n                [tiTipContext]=\"item\"\r\n                (delete)=\"onDelete(item)\"\r\n                ><ng-container *ngIf=\"itemTemplate else defaultItemTemplate\">\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item, index: i}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n                <ng-template #defaultItemTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n            </ti-tag>\r\n        </ng-container>\r\n\r\n        <!-- tagsinput\u7EC4\u4EF6\u4E2Ddominator\u7684\u6700\u540E\u4E00\u4E2A\u5143\u7D20\u4E3Ainput\u8F93\u5165\u6846 -->\r\n        <ng-container *ngIf=\"type === 'tagsinput'\">\r\n            <ng-content select=\"input\"></ng-content>\r\n        </ng-container>\r\n        <!-- tag\u8F93\u5165\u533A\u57DF\uFF0C\u7EFC\u5408\u641C\u7D22\u4F7F\u7528-->\r\n        <ng-container>\r\n            <ng-content select=\"[tag-editor]\"></ng-content>\r\n        </ng-container>\r\n        <ng-template #defaultPlaceholderMultiTemplate>\r\n            <section *ngIf=\"type !== 'tagsinput'\" class=\"ti3-overflow-padding ti3-placeholder\" [title]=\"placeholder\">{{placeholder}}</section>\r\n        </ng-template>\r\n    </ng-template>\r\n</section>\r\n\r\n<!-- tagsinput\u7EC4\u4EF6\u6CA1\u6709\u4E0B\u62C9\u6309\u94AE -->\r\n<section *ngIf=\"type !== 'tagsinput' && !showClear()\"\r\n         [ngClass]=\"{'ti3-select-dominator-dropdown-btn':(buttonStyle==='dropdown'),\r\n                     'ti3-icon ti3-icon-add ti3-select-dominator-plus-btn':(buttonStyle==='plus'),\r\n                    'ti3-select-dominator-dropdown-btn-transform-up': dropshow}\"\r\n         [id]=\"appendId('btn')\">\r\n</section>\r\n\r\n<!-- \u591A\u9009\u65F6\uFF1A\u663E\u793A\u5F53\u524D\u9009\u4E2D\u4E86\u51E0\u9879 -->\r\n<section *ngIf=\"showSelectedNumber && multiple && model && model.length > 0\" class=\"ti3-multiselect-selected\">{{ 'tiSelect.selected' | tiTranslate }}<span\r\n    style=\"padding-left: 4px\">{{model.length}}</span>\r\n</section>\r\n\r\n<!-- \u5355\u9009\u6709\u53EF\u6E05\u9664\u7684\u573A\u666F -->\r\n<section *ngIf=\"showClear()\"\r\n         class=\"ti3-icon ti3-icon-close ti3-select-dominator-clear-btn\"\r\n        [id]=\"appendId('clear')\"\r\n        (click)=\"onClickClear($event)\">\r\n</section>\r\n<!-- dominator\u53F3\u4FA7\u56FE\u6807\u6309\u94AE\u7EC4, \u7EFC\u5408\u641C\u7D22\u7EC4\u4EF6\u4F7F\u7528 -->\r\n<ng-content select=\"[actions]\"></ng-content>\r\n<!--IE\u6D4F\u89C8\u5668\u517C\u5BB9\u6027\u95EE\u9898\uFF1A\u5728IE\u4E0B\uFF0C\u6240\u6709div\uFF0C\u90E8\u5206span\uFF08\u8BBE\u7F6E\u4E3Ainline-block\u3001block\u7684span\uFF09\u662F\u4EA4\u4E92\u5143\u7D20\uFF0C\u53EF\u4EE5\u843D\u7126\u70B9\u3002\r\n\u800C\u5176\u4ED6\u6D4F\u89C8\u5668\uFF0Cdiv\u548Cspan\u9ED8\u8BA4\u662F\u4E0D\u53EF\u4EA4\u4E92\u5143\u7D20\uFF0C\u4E0D\u80FD\u843D\u7126\u70B9\u3002\r\n\u89E3\u51B3\u65B9\u6848\uFF1Asection\u6807\u7B7E\uFF0C\u53EF\u4EE5\u7B49\u540C\u4E8Ediv\u4F7F\u7528\uFF0CIE\u548C\u5176\u4ED6\u6D4F\u89C8\u5668\u884C\u4E3A\u4E00\u81F4\u3002\r\n-->",
                host: {
                    '[class.ti3-select-dominator-container]': 'true',
                    '[class.ti3-multiselect-container]': 'multiple'
                },
                providers: [TiFormComponent.getValueAccessor(TiDominatorComponent)],
                styles: ["::ng-deep :root{--ti-dominator-button-type-dropdown-width:35px;--ti-dominator-select-box-width:calc(var(--ti-input-height) - 2px)}:host{display:inline-block}:host.ti3-select-dominator-container{-ms-box-sizing:border-box;border:1px solid transparent;box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-input-height);line-height:calc(var(--ti-input-height) - 2px);margin:-1px;position:relative;text-align:left;vertical-align:middle;white-space:normal;width:calc(100% + 2px)}:host.ti3-select-dominator-container:focus{outline:none}:host[disabled].ti3-select-dominator-container{cursor:not-allowed!important}:host[disabled] .ti3-select-dominator-dropdown-btn:after{border-top-color:var(--ti-dominator-select-arrow-color-disabled)!important}:host[disabled] .ti3-select-dominator-text{color:var(--ti-common-color-text-disabled)}:host[disabled] .ti3-multiselect-box-cell{border:1px solid var(--ti-dominator-multiselect-box-cell-border-color-disabled)}.ti3-overflow-padding{height:100%;overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.ti3-select-dominator-text{-ms-box-sizing:border-box;border:none;border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);display:inline-block;height:100%;text-decoration:none;width:calc(100% - var(--ti-dominator-select-box-width))}.ti3-placeholder{color:var(--ti-input-placeholder-color)}.ti3-select-dominator-clear-btn,.ti3-select-dominator-dropdown-btn{-ms-box-sizing:border-box;border-radius:0 var(--ti-input-border-radius) var(--ti-input-border-radius) 0;box-sizing:border-box;float:right;height:calc(var(--ti-input-height) - 2px);width:var(--ti-dominator-select-box-width)}.ti3-select-dominator-dropdown-btn:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--ti-dominator-select-arrow-color);content:\"\";height:0;position:absolute;right:calc(var(--ti-dominator-select-box-width)/2 - 4px);top:calc((var(--ti-input-height) - 7px)/2);width:0}.ti3-select-dominator-dropdown-btn-transform-up:after{transform:rotate(180deg)}.ti3-select-dominator-clear-btn{color:var(--ti-dominator-select-clear-color);font-size:12px;text-align:center}.ti3-select-dominator-clear-btn:hover{color:var(--ti-common-color-icon-hover)}:host.ti3-multiselect-container{height:auto;line-height:1;min-height:var(--ti-input-height);overflow:hidden}:host.ti3-multiselect-container>.ti3-select-dominator-text{line-height:calc(var(--ti-input-height) - 4px);max-height:calc(2*var(--ti-input-height) - 4px);overflow-y:auto;padding:1px;vertical-align:middle}:host.ti3-multiselect-container>.ti3-select-dominator-text::-webkit-scrollbar-track{margin:0}:host.ti3-multiselect-container>.ti3-select-dominator-text:after{content:\"\";display:block;overflow:hidden}:host.ti3-multiselect-container>.ti3-select-dominator-text.ti3-tags-input-container{width:100%}:host.ti3-multiselect-container .ti3-multiselect-selected{display:inline-block;padding:var(--ti-common-space-base) var(--ti-common-space-3x)}"]
            },] }
];
TiDominatorComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
TiDominatorComponent.propDecorators = {
    labelKey: [{ type: Input }],
    placeholder: [{ type: Input }],
    buttonStyle: [{ type: Input }],
    multiple: [{ type: Input }],
    selectedTipPosition: [{ type: Input }],
    dropshow: [{ type: Input }],
    tagMaxWidth: [{ type: Input }],
    maxLine: [{ type: Input }],
    showSelectedNumber: [{ type: Input }],
    maxHeight: [{ type: Input }],
    type: [{ type: Input }],
    clearable: [{ type: Input }],
    delete: [{ type: Output }],
    clear: [{ type: Output }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    placeholderTemplate: [{ type: ContentChild, args: ['placeholder',] }]
};

// TODO: 等待规范统一，可能只保留方形tag
// TODO: hover时是否需要高亮，选中是否高亮。增加selectable接口，表示是否可以选中。
// TODO: 禁用时是否显示叉号？规范和tiny2不一致。
// TODO: 禁用时，不发出原生click事件。
/**
 * Tag标签组件，支持显示自定义内容，和删除事件通知。
 *
 * <example-url>../tiny3demo/#/tag/tag-all</example-url>
 */
class TiTagComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        // @Input() data; // 数据，作为唯一标识
        /**
         * @ignore
         * 样式：有方形和箭头形两种样式，后面可能废弃箭头样式
         */
        // @Input() shape: 'rect'|'arrow'  = 'rect';
        /**
         * 是否禁用
         */
        this.disabled = false;
        /**
         * 选中项文本超出时tip展开方向
         *
         * 9.0.3新增
         */
        this.selectedTipPosition = 'auto';
        /**
         * 删除Tag时的通知事件
         */
        this.delete = new EventEmitter();
    }
    /**
     * @ignore
     * @param $event
     */
    onClickDelete($event) {
        if (this.disabled) {
            return;
        }
        $event.stopPropagation(); // 阻止冒泡，阻止了Tag整体的onClick事件，也阻止Tag之外接收到Click。
        this.delete.emit();
    }
    /**
     * 删除Tag标签element
     */
    remove() {
        this.renderer.removeChild(this.renderer.parentNode(this.nativeElement), this.nativeElement);
    }
}
TiTagComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tag',
                template: "<!--\u5DE6\u53F3\u4E24\u4E2Adiv\u662Fabsolute\uFF0C\u8131\u79BB\u6587\u6863\u6D41\uFF0C\u6302\u5728\u7236\u5BB9\u5668\u4E4B\u5916\u7684\u3002ti-overflow\u72EC\u5360\u4E00\u884C-->\r\n<!-- <ng-container *ngIf=\"shape ==='arrow'\">\r\n        <div class=\"ti3-tag-selected-triangle\"></div>\r\n        <div tiOverflow><ng-content></ng-content></div>\r\n        <div *ngIf=\"!disabled\" class=\"ti3-tag-clear ti3-icon ti3-icon-close\" (click)=\"onClickDelete($event)\" [id]=\"appendId('_tag')\">\r\n        </div>\r\n</ng-container>\r\n<ng-container *ngIf=\"shape ==='rect'\"> -->\r\n        <section #content class=\"ti3-box-cell-key\" [id]=\"appendId('content')\" [title]=\"content.textContent\"><ng-content></ng-content></section>\r\n        <section class=\"ti3-icon ti3-icon-clear ti3-icon-close-staic\" (click)=\"onClickDelete($event)\" [id]=\"appendId('closeicon')\"></section>\r\n<!-- </ng-container> -->\r\n",
                host: {
                    '[class.ti3-multiselect-box-cell]': 'true',
                    '[class.ti3-multiselect-option-disabled]': 'disabled',
                    '[style.maxWidth]': 'maxWidth'
                }
                // styleUrls: ['./tag-rect.less', './tag-arrow.less'],
                // host: {
                //       '[class.ti3-tag-container]': 'shape ==="arrow"',
                //       '[class.ti3-multiselect-box-cell]': 'shape ==="rect"',
                //       '[class.ti3-multiselect-option-disabled]': 'shape ==="rect"&&disabled'
                // }
                ,
                styles: ["::ng-deep :root{--ti-tag-box-cell-space:1px;--ti-tag-icon-area-width:32px}:host.ti3-multiselect-box-cell{background-color:var(--ti-tag-bg-color);border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;color:var(--ti-tag-text-color);display:inline-block;float:left;height:calc(var(--ti-input-height) - 6px);line-height:calc(var(--ti-input-height) - 6px);margin:var(--ti-tag-box-cell-space);max-width:calc(100% - var(--ti-tag-box-cell-space)*2);overflow:hidden;width:auto}:host.ti3-multiselect-box-cell:after{content:\"\";display:block;overflow:hidden}:host.ti3-multiselect-box-cell .ti3-box-cell-key{box-sizing:border-box;float:left;margin-left:var(--ti-common-space-10);margin-right:var(--ti-common-space-6);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:calc(100% - var(--ti-tag-icon-area-width) - var(--ti-common-space-6) - var(--ti-common-space-10))}:host.ti3-multiselect-box-cell .ti3-box-cell-key:hover{color:var(--ti-tag-text-color-hover)}:host.ti3-multiselect-box-cell .ti3-icon-close-staic{box-sizing:border-box;color:var(--ti-tag-icon-color);float:left;height:100%;text-align:center;width:var(--ti-tag-icon-area-width)}:host.ti3-multiselect-box-cell .ti3-icon-close-staic:hover{color:var(--ti-tag-icon-color-hover)}:host.ti3-multiselect-box-cell.ti3-multiselect-option-disabled{background-color:var(--ti-tag-bg-color-disabled);color:var(--ti-tag-text-color-disabled);cursor:not-allowed}:host.ti3-multiselect-box-cell.ti3-multiselect-option-disabled .ti3-box-cell-key{color:var(--ti-tag-text-color-disabled)}:host.ti3-multiselect-box-cell.ti3-multiselect-option-disabled .ti3-icon-close-staic{color:var(--ti-tag-icon-color-disabled)}"]
            },] }
];
TiTagComponent.propDecorators = {
    disabled: [{ type: Input }],
    selectedTipPosition: [{ type: Input }],
    maxWidth: [{ type: Input }],
    delete: [{ type: Output }]
};

class TiTagModule {
}
TiTagModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule
                ],
                exports: [TiTagComponent],
                declarations: [TiTagComponent]
            },] }
];

/**
 * @ignore
 */
class TiDominatorModule {
}
TiDominatorModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiTipModule,
                    TiLocaleModule,
                    TiTagModule
                ],
                exports: [TiDominatorComponent],
                declarations: [TiDominatorComponent]
            },] }
];

/*
 * @Author: walker
 * @Date: 2018-09-06 15:05:42
 * @Last Modified by: walker
 * @Last Modified time: 2018-09-12 11:03:35
 */
/**
 * 搜索框组件
 *
 * <example-url>../tiny3demo/#/searchbox/searchbox-all</example-url>
 */
class TiSearchboxComponent extends TiAutocompleteComponent {
    constructor() {
        super(...arguments);
        /**
         * 10.0.4版本新增
         *
         * 是否删除用户搜索内容的首尾空格，不配置时不删除空格
         */
        this.trimmed = false;
        /**
         * search事件，当选中下拉选项/按enter键/点击搜索图标时触发
         *
         * 参数：搜索框文本
         */
        this.search = new EventEmitter();
    }
    ngOnInit() {
        // 默认有清除图标且不可配置
        // 此处先赋值后继承，是由于父类中初始化需要读取clearable的值，设置清除图标
        this.clearable = true;
        super.ngOnInit();
    }
    /**
     * @ignore
     * 组件model更改时，更新input绑定值
     */
    writeValue(model) {
        super.writeValue(model);
        this.inputValue = model;
    }
    // 组件交互方法集合--start
    /**
     * @ignore
     * enter的触发有两种情况：
     * 1.在input框中输入值，然后按下enter，此时正常执行search
     * 2.在suggestion面板展开的情况下，通过hover选中一项，然后按下enter，
     *   此时的search应该在下拉面板的onDroplistChange回调中触发
     */
    onInputEnter() {
        if (!this.isSearchWithHoverOption()) { // 排除第2中情况
            this.onSearch();
        }
    }
    /**
     * @ignore
     * 搜索事件触发
     */
    onSearch() {
        if (this.disabled) {
            return;
        }
        this.search.emit(this.model);
    }
    /**
     * @ignore
     * 两种情况下触发
     * 1.在suggestion面板展开的情况下，通过hover选中一项，然后按下enter
     * 2.在suggestion面板展开的情况下，通过鼠标点击选中一项
     */
    onDroplistChange(value) {
        if (value) {
            this.model = this.inputValue = value[this.labelKey] || value.label;
            this.onSearch();
        }
    }
    // 组件交互方法集合--end
    isSearchWithHoverOption() {
        // suggestion面板展开且存在hover选中项的情况
        return this.dropListComp.isShow && this.dropListComp.listCom.hoverOption;
    }
    /**
     * @ignore
     * 输入框中内容改变事件
     */
    onInputChange(value) {
        if (this.disabled || !this.isFocused) {
            return;
        }
        const searchValue = this.trimValue(value);
        this.model = searchValue;
        this.inputChangeObserve.next(searchValue);
    }
    /**
     * 控制是否删除搜索内容的首尾空格
     */
    trimValue(value) {
        let searchValue = value;
        if (this.trimmed && searchValue) {
            searchValue = searchValue.trim();
        }
        return searchValue;
    }
}
TiSearchboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-searchbox',
                template: "<input #input tiText\r\n        class=\"ti3-searchbox-input\"\r\n        [disabled]=\"disabled\"\r\n        spellcheck=false\r\n        (keyup.enter)=\"onInputEnter()\"\r\n        [(ngModel)] = \"inputValue\"\r\n        [placeholder]=\"placeholder\"\r\n        (clear)=\"onClear($event)\"\r\n        (ngModelChange)=\"onInputChange($event)\"\r\n        [maxlength]=\"maxlength\"\r\n        [id]=\"appendId('input')\"\r\n        (mousedown)=\"onInputMousedown()\">\r\n<div class=\"ti3-searchbox-divider\"\r\n     (mousedown)=\"onSearch()\"\r\n     [hidden]=\"model === '' || model === undefined || model === null\"></div>\r\n<div class=\"ti3-searchbox-search ti3-icon ti3-icon-search\" tiOutline [tabindex]=\"disabled ? -1 : 0\" style=\"outline-offset: -2px;\"\r\n     (mousedown)=\"onSearch()\" (keydown.enter)=\"onSearch()\"\r\n     [id]=\"appendId('search')\"></div>\r\n<ti-droplist #droplist\r\n              [dominatorElem]=\"nativeElement\"\r\n              [options]=\"suggestions\"\r\n              [(ngModel)]=\"selected\"\r\n              [labelKey]=\"labelKey\"\r\n              [panelMaxHeight]=\"panelMaxHeight\"\r\n              [panelWidth]=\"panelWidth\"\r\n              (ngModelChange)=\"onDroplistChange($event)\"\r\n              [id]=\"appendId('droplist')\">\r\n        <ng-template let-item let-i=index>\r\n                <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #listLabelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n        </ng-template>\r\n</ti-droplist>",
                providers: [TiFormComponent.getValueAccessor(TiSearchboxComponent)],
                host: {
                    '[class.ti3-searchbox-container]': 'true',
                    '(blur)': 'onBlur()',
                    '(focus)': 'onFocus()'
                },
                styles: ["::ng-deep :root{--ti-searchbox-container-width:200px;--ti-searchbox-divider-height:calc(var(--ti-input-height)/2);--ti-searchbox-divider-width:1px;--ti-searchbox-icon-area-width:34px;--ti-searchbox-icon-size:14px}:host.ti3-searchbox-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-input-height);line-height:normal;position:relative;text-align:left;vertical-align:middle;width:var(--ti-searchbox-container-width)}:host.ti3-searchbox-container:after{content:\"\";display:inline-block;height:100%;line-height:100%;vertical-align:middle}:host.ti3-searchbox-container .ti3-searchbox-input{background-color:transparent;border:none!important;border-radius:3px;box-shadow:none;box-sizing:border-box;float:left;height:100%;outline:none;overflow:hidden;padding:0 0 0 var(--ti-input-padding-horizontal);text-decoration:none;text-overflow:ellipsis;white-space:nowrap;width:calc(100% - var(--ti-searchbox-icon-area-width) - var(--ti-searchbox-divider-width))}:host.ti3-searchbox-container .ti3-searchbox-divider{height:var(--ti-searchbox-divider-height);position:absolute;right:var(--ti-searchbox-icon-area-width);top:calc(50% - var(--ti-searchbox-divider-height)/2);vertical-align:middle;width:var(--ti-searchbox-divider-width)}:host.ti3-searchbox-container .ti3-searchbox-search{border-radius:0 3px 3px 0;float:right;font-size:var(--ti-searchbox-icon-size);height:100%;text-align:center;width:var(--ti-searchbox-icon-area-width)}:host.ti3-searchbox-container .ti3-searchbox-search:before{position:relative;top:calc(50% - var(--ti-searchbox-icon-size)/2)}:host.ti3-searchbox-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}:host.ti3-searchbox-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}:host.ti3-searchbox-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-divider{background-color:var(--ti-common-color-line-dividing)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search{color:var(--ti-common-color-icon-normal)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search:hover{color:var(--ti-common-color-icon-hover)}:host.ti3-searchbox-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed}:host.ti3-searchbox-container[disabled] .ti3-searchbox-divider{background-color:var(--ti-input-border-color-disabled)}:host.ti3-searchbox-container[disabled] .ti3-searchbox-search{color:var(--ti-common-color-icon-disabled)}"]
            },] }
];
TiSearchboxComponent.propDecorators = {
    trimmed: [{ type: Input }],
    search: [{ type: Output }],
    itemTemplate: [{ type: ContentChild, args: ['item', { static: true },] }]
};

/**
 * @ignore
 */
class TiSearchboxNotsearchComponent extends TiSearchboxComponent {
    onInputEnter() {
        event.preventDefault(); // 不做搜索等处理
    }
    onSearch() {
        event.preventDefault(); // 点击搜索图标时，阻止默认行为
    }
}
TiSearchboxNotsearchComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-searchbox-notsearch',
                template: "<input #input tiText\r\n        class=\"ti3-searchbox-input\"\r\n        [disabled]=\"disabled\"\r\n        spellcheck=false\r\n        (keyup.enter)=\"onInputEnter()\"\r\n        [(ngModel)] = \"inputValue\"\r\n        [placeholder]=\"placeholder\"\r\n        (clear)=\"onClear($event)\"\r\n        (ngModelChange)=\"onInputChange($event)\"\r\n        [maxlength]=\"maxlength\"\r\n        [id]=\"appendId('input')\"\r\n        (mousedown)=\"onInputMousedown()\">\r\n<div class=\"ti3-searchbox-divider\"\r\n     (mousedown)=\"onSearch()\"\r\n     [hidden]=\"model === '' || model === undefined || model === null\"></div>\r\n<div class=\"ti3-searchbox-search ti3-icon ti3-icon-search\" tiOutline [tabindex]=\"disabled ? -1 : 0\" style=\"outline-offset: -2px;\"\r\n     (mousedown)=\"onSearch()\" (keydown.enter)=\"onSearch()\"\r\n     [id]=\"appendId('search')\"></div>\r\n<ti-droplist #droplist\r\n              [dominatorElem]=\"nativeElement\"\r\n              [options]=\"suggestions\"\r\n              [(ngModel)]=\"selected\"\r\n              [labelKey]=\"labelKey\"\r\n              [panelMaxHeight]=\"panelMaxHeight\"\r\n              [panelWidth]=\"panelWidth\"\r\n              (ngModelChange)=\"onDroplistChange($event)\"\r\n              [id]=\"appendId('droplist')\">\r\n        <ng-template let-item let-i=index>\r\n                <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #listLabelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n        </ng-template>\r\n</ti-droplist>",
                providers: [TiFormComponent.getValueAccessor(TiSearchboxNotsearchComponent)],
                host: {
                    '[class.ti3-searchbox-container]': 'true',
                    '(blur)': 'onBlur()',
                    '(focus)': 'onFocus()'
                },
                styles: ["::ng-deep :root{--ti-searchbox-container-width:200px;--ti-searchbox-divider-height:calc(var(--ti-input-height)/2);--ti-searchbox-divider-width:1px;--ti-searchbox-icon-area-width:34px;--ti-searchbox-icon-size:14px}:host.ti3-searchbox-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-input-height);line-height:normal;position:relative;text-align:left;vertical-align:middle;width:var(--ti-searchbox-container-width)}:host.ti3-searchbox-container:after{content:\"\";display:inline-block;height:100%;line-height:100%;vertical-align:middle}:host.ti3-searchbox-container .ti3-searchbox-input{background-color:transparent;border:none!important;border-radius:3px;box-shadow:none;box-sizing:border-box;float:left;height:100%;outline:none;overflow:hidden;padding:0 0 0 var(--ti-input-padding-horizontal);text-decoration:none;text-overflow:ellipsis;white-space:nowrap;width:calc(100% - var(--ti-searchbox-icon-area-width) - var(--ti-searchbox-divider-width))}:host.ti3-searchbox-container .ti3-searchbox-divider{height:var(--ti-searchbox-divider-height);position:absolute;right:var(--ti-searchbox-icon-area-width);top:calc(50% - var(--ti-searchbox-divider-height)/2);vertical-align:middle;width:var(--ti-searchbox-divider-width)}:host.ti3-searchbox-container .ti3-searchbox-search{border-radius:0 3px 3px 0;float:right;font-size:var(--ti-searchbox-icon-size);height:100%;text-align:center;width:var(--ti-searchbox-icon-area-width)}:host.ti3-searchbox-container .ti3-searchbox-search:before{position:relative;top:calc(50% - var(--ti-searchbox-icon-size)/2)}:host.ti3-searchbox-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}:host.ti3-searchbox-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}:host.ti3-searchbox-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-divider{background-color:var(--ti-common-color-line-dividing)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search{color:var(--ti-common-color-icon-normal)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search:hover{color:var(--ti-common-color-icon-hover)}:host.ti3-searchbox-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed}:host.ti3-searchbox-container[disabled] .ti3-searchbox-divider{background-color:var(--ti-input-border-color-disabled)}:host.ti3-searchbox-container[disabled] .ti3-searchbox-search{color:var(--ti-common-color-icon-disabled)}", ":host.ti3-searchbox-container:not([disabled])[noBorder]{background-color:var(--ti-searchbox-select-bg-color);border:none}:host.ti3-searchbox-container:not([disabled])[noBorder]:hover{background-color:var(--ti-searchbox-select-bg-color-hover)}:host.ti3-searchbox-container:not([disabled])[noBorder] .ti3-searchbox-input{background-color:transparent}:host ::ng-deep .ti3-searchbox-search[noBorder]{color:var(--ti-common-color-icon-normal)!important}:host ::ng-deep .ti3-searchbox-search[noBorder]:hover{color:var(--ti-common-color-icon-hover)!important}", "::ng-deep :root{--ti-text-clear-width:26px;--ti-text-password-width:36px}:host[tiText]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);flood-color:var(--ti-input-clear-color);font-size:var(--ti-input-font-size);height:var(--ti-input-height);lighting-color:var(--ti-input-clear-color-hover);line-height:normal;outline:none;padding:0 var(--ti-input-padding-horizontal);stop-color:var(--ti-input-clear-color-disabled);vertical-align:middle}:host[tiText].ti3-text-input-show-icon{background-repeat:no-repeat;background-size:16px}:host[tiText].ti3-text-input-show-clear{background-position:center right 5px;padding-right:var(--ti-text-clear-width)!important}:host[tiText].ti3-text-input-show-password{background-position:center right 10px;padding-right:var(--ti-text-password-width)!important}:host[tiText].ti3-text-input-noborder{border:0;box-shadow:none;outline:0}:host[tiText]:not([disabled]):not([noborder]).ti3-text-input-show-icon.ti3-text-clear-active:hover{cursor:pointer}:host[tiText]:not([disabled]):not([noborder]):hover{border:1px solid var(--ti-input-border-color-hover)}:host[tiText]:not([disabled]):not([noborder]):focus{border:1px solid var(--ti-input-border-color-focus)}:host[tiText][disabled]:disabled{background-color:var(--ti-input-bg-color-disabled);border:1px solid var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}:host[tiText][disabled]:disabled.ti3-text-input-noborder{border:0}.ti3-password-hack-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}:host[tiText]{transition:border-color .15s}:host[tiText].ti3-text-input-show-icon:focus{transition:transform .15s cubic-bezier(.4,0,.2,1),font-size .15s cubic-bezier(.4,0,.2,1)}:host[tiText]:hover:not(:focus){transition:border-color .2s}"]
            },] }
];

class TiSearchboxModule {
}
TiSearchboxModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiOverflowModule,
                    TiDroplistModule,
                    TiIconModule,
                    TiTextModule,
                    TiOutlineModule
                ],
                exports: [TiSearchboxComponent, TiSearchboxNotsearchComponent],
                declarations: [TiSearchboxComponent, TiSearchboxNotsearchComponent]
            },] }
];

/**
 * @ignore
 * 下拉面板带有可搜索的数组组件，主要用于select，表格列设置。
 */
class TiDropsearchComponent extends TiDroplistComponent {
    constructor() {
        super(...arguments);
        this.searchable = false;
        this.selectAll = false; // 多选模式下是否有全选功能
        /**
         * 面板对齐方式, drop中的panelAlign接口透传出去
         */
        this.panelAlign = 'left';
        /**
         * @ignore
         * dominator 到drop的距离
         */
        this.dominatorSpace = TiDropComponent.DOMINATOR_SPACE + 'px';
        /**
         * @ignore
         * 10.0.2新增
         *
         * 后台搜索，传出搜索框的值
         */
        this.beforeSearch = new EventEmitter();
        this.placeholder = TiLocale.getLocaleWords().tiSelect.search;
        /**
         * 搜索结果数组
         */
        this.searchResult = new Array();
        this.oldSearchable = null;
        this.focusableElemsInSearch = [];
        this.focusableElemsInPagination = [];
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 外部修改show属性的处理，初始定义在ngOnInit中处理
        if (this.searchable) {
            if (changes['options'] && this.options && !changes['options'].firstChange) {
                this.searchWordChange(this.searchboxCom.model);
            }
        }
        if (changes['searchable']) {
            this.heightExcludeList = changes['searchable'].currentValue ? TiDroplistComponent.SEARCHBOX_EXCLUDE_HEIGHT : 2;
        }
    }
    ngOnInit() {
        super.ngOnInit();
        this.searchResult = this.options;
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        let focusableElemsChange;
        if (this.searchable !== this.oldSearchable) {
            super.unlistenKendown();
            if (this.searchable) {
                this.focusableElemsInSearch = this.searchboxCom.getFocusableElems();
                focusableElemsChange = true;
                super.listenKeydown(this.searchboxCom.getFocusableElems()[0]);
            }
            else {
                this.focusableElemsInSearch = [];
                super.listenKeydown(this.dominatorElem);
            }
            this.oldSearchable = this.searchable;
        }
        if (this.pagination && this.pagination.updateFocusableElems) {
            this.focusableElemsInPagination = this.pagination.getFocusableElems();
            focusableElemsChange = true;
        }
        if (focusableElemsChange) {
            this.setFocusableElems(this.focusableElemsInSearch.concat(this.focusableElemsInPagination));
        }
    }
    /**
     * 覆盖父类show()
     */
    show() {
        if (this.isShow) {
            return;
        }
        // 清空搜索框并处理下拉列表内容
        if (this.searchable) {
            this.searchResult = this.options;
            setTimeout(() => {
                super.show();
                // 焦点转移至搜索框
                this.searchboxCom.focus();
            }, 0);
        }
        else {
            super.show();
        }
    }
    /**
     * 覆盖父类hide(), 有搜索框时焦点转移
     */
    hide() {
        if (this.isShow) {
            super.hide();
            if (this.searchable) {
                this.dominatorElem.focus();
                this.searchWord = '';
            }
        }
    }
    /**
     * 仅hide，不带焦点转移。
     */
    hideWithoutFocus() {
        super.hide();
        this.searchWord = '';
    }
    searchWordChange(searchWord) {
        this.beforeSearch.emit();
        if (this.hasBeforeSearchObservers) {
            return;
        }
        if (this.options && this.options.length >= 0) {
            // 搜索结果临时值。结果默认值，是原数据
            let searchResult = this.options;
            // 如果搜索词存在
            if (!Util.isEmptyString(searchWord)) {
                // 如果是分组，则找出第二级item集合
                if (this.options[0] && this.listCom.isGroup(this.options[0])) {
                    searchResult = [];
                    this.options.forEach((group) => {
                        searchResult = searchResult.concat(group.children);
                    });
                }
                // 在集合中搜索
                searchResult = searchResult.filter((option) => {
                    if (!this.searchKeys) {
                        // 没有定义searchKeys时，取labelKey
                        return Util.isString(option[this.labelKey]) && option[this.labelKey].toLowerCase()
                            .indexOf(searchWord.toLowerCase()) >= 0;
                    }
                    else {
                        //  已定义searchKeys，任一条目匹配即可
                        for (const searchKey of this.searchKeys) {
                            if (Util.isString(option[searchKey]) && option[searchKey].toLowerCase()
                                .indexOf(searchWord.toLowerCase()) >= 0) {
                                return true;
                            }
                        }
                        return false;
                    }
                });
            }
            this.setSearchResult(searchResult);
        }
    }
    /**
     * 搜索后，按需重新定位、设置hoverOption
     */
    setSearchResult(searchResult) {
        var _a;
        // list个数不同时，重定位下拉位置
        if (((_a = this.searchResult) === null || _a === void 0 ? void 0 : _a.length) !== searchResult.length) {
            setTimeout(() => {
                this.rePosition(true);
            }, 0);
        }
        this.searchResult = searchResult;
    }
}
TiDropsearchComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-dropsearch',
                template: "<ti-drop [dominatorElem]=\"dominatorElem\"\r\n    [panelWidth]='panelWidth' [class.ti3-select-small]=\"size === 'small'\"\r\n    [panelAlign]=\"panelAlign\"\r\n    [dominatorSpace]=\"dominatorSpace\">\r\n    <ng-content select=\"[custom]\"></ng-content>\r\n    <div *ngIf=\"searchable\">\r\n        <ti-searchbox-notsearch #searchboxCom noBorder\r\n                class =\"ti3-dropdown-searchbox\"\r\n                [placeholder]=\"placeholder\"\r\n                [(ngModel)]=\"searchWord\"\r\n                (ngModelChange)=\"searchWordChange($event)\"\r\n                [id]=\"appendId('searchbox')\">\r\n        </ti-searchbox-notsearch>\r\n    </div>\r\n    <ti-list [multiple]=\"multiple\"\r\n        [options]=\"((type !== 'suggestion' && searchable) || type === 'suggestion')?searchResult:options\"\r\n        [(ngModel)]=\"model\"\r\n        [selectAll]=\"selectAll\"\r\n        style=\"display:block;\"\r\n        (select)=\"onSelect($event)\"\r\n        [id]=\"appendId('list')\"\r\n        [tipPosition]=\"tipPosition\"\r\n        [noDataText]=\"noDataText\">\r\n        <ng-template let-item let-i=index let-last=last>\r\n                <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i,last: last}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #listLabelTemplate>{{item[labelKey]}}</ng-template>\r\n        </ng-template>\r\n    </ti-list>\r\n    <ng-container *ngIf=\"footerTemplateRef\">\r\n        <section #footer>\r\n            <ng-container *ngTemplateOutlet=\"footerTemplateRef\"></ng-container>\r\n        </section>\r\n    </ng-container>\r\n</ti-drop>",
                providers: [TiFormComponent.getValueAccessor(TiDropsearchComponent)],
                styles: [".ti3-dropdown-searchbox{width:100%!important}"]
            },] }
];
TiDropsearchComponent.propDecorators = {
    searchable: [{ type: Input }],
    searchKeys: [{ type: Input }],
    selectAll: [{ type: Input }],
    panelAlign: [{ type: Input }],
    dominatorSpace: [{ type: Input }],
    beforeSearch: [{ type: Output }],
    searchboxCom: [{ type: ViewChild, args: [TiSearchboxNotsearchComponent,] }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent,] }],
    footerTemplateRef: [{ type: ContentChild, args: ['footer', { static: true },] }]
};

/**
 * @ignore
 */
class TiDropsearchModule {
}
TiDropsearchModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDropModule,
                    TiListModule,
                    TiSearchboxModule
                ],
                exports: [TiDropsearchComponent],
                declarations: [TiDropsearchComponent]
            },] }
];

/**
 * @ignore
 * 此指令功能:清空宿主元素的子元素，将传入的string或Node放入(append)
 *
 * 类似angular.js的ng-bind-html功能
 */
class TiIncludeDirective {
    constructor(elementRef, renderer) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.element = this.elementRef.nativeElement;
    }
    ngOnChanges(changes) {
        if (changes['tiInclude'] && !Util.isUndefined(this.tiInclude)) {
            // 清空宿主元素的子节点
            if (this.element.childNodes.length > 0) {
                this.element.innerHTML = '';
            }
            // 如果 tiInclude 为字符串，则当作文本节点处理
            const node = Util.isString(this.tiInclude) ?
                this.renderer.createText(this.tiInclude) : this.tiInclude;
            this.renderer.appendChild(this.element, node);
        }
    }
}
TiIncludeDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiInclude]'
            },] }
];
TiIncludeDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiIncludeDirective.propDecorators = {
    tiInclude: [{ type: Input }]
};

/**
 * @ignore
 */
class TiIncludeModule {
}
TiIncludeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiIncludeDirective],
                declarations: [TiIncludeDirective]
            },] }
];

/**
 * 本组件实现对多个表单元素的布局，支持单列和多列布局。
 * 其中包含了tiFormfield、tiItem、tiItemLabel和tiButtonItem几个组件。
 *
 * <example-url>../tiny3demo/#/formfield/formfield-all</example-url>
 */
class TiFormfieldComponent extends TiBaseComponent {
    constructor(hostRef, renderer, changeDetector) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.changeDetector = changeDetector;
        /**
         * 设置表单类型，不设置时默认为带输入控件类表单;当为 text 时，为纯文本描述类表单
         *
         * 带输入控件类表单：各个表单条目的内容区主要为输入框、下拉框、按钮组等输入组件；
         *
         * 纯文本描述类表单：各个表单条目的内容区为纯文本。
         */
        this.type = 'default';
        /**
         * 设置表单布局的列数
         */
        this.colsNumber = 1;
        /**
         * 设置列与列之间的间隔，只有多列（colsNumber >= 2）时该属性配置才生效。
         */
        this.colsGap = [];
        /**
         * 统一设置表单条目的垂直对齐方式（上下布局表单不支持该属性）。
         */
        this.verticalAlign = 'top';
        /**
         * 设置各列宽度（IE不支持，行合并列合并暂不支持）
         *
         * 设置该接口后，colsGap第一个值表示各列间距
         *
         * 10.1.1 新增
         */
        this.colsWidth = [];
        /**
         * @ignore
         * 纯文本描述类表单的type的值
         */
        this.textType = 'text';
        /**
         * @ignore
         * ti-formfield中包含的所有ti-item的集合
         */
        this.items = [];
        /**
         * @ignore
         * ti-formfield中包含的所有ti-btn-item的集合
         */
        this.btnItems = [];
        /**
         * @ignore
         * 根据colsNum对 items 分组后的数据
         */
        this.groupedItems = [];
        /**
         * @ignore
         * 表单的列数
         */
        this.colsNum = 1;
        /**
         * @ignore
         * 当前formfield下ti-item的总个数
         */
        this.itemTotal = 0;
        /**
         * @ignore
         * 表单是否为上下布局
         */
        this.isVertical = false;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        this.isVertical = this.nativeElement.hasAttribute('vertical');
        this.setColsNumber();
        // 统一设置表单内容的垂直对齐方式;
        // tbody、tr、td的verticalAlign继承于此(table),所以此处可以
        // 统一设置表单内容的垂直对齐方式
        this.setFieldStyle();
    }
    setColsNumber() {
        if (this.colsNumber) {
            // tslint:disable-next-line:prefer-template
            const colsNumber = parseInt(String(this.colsNumber), 10);
            if (!Number.isNaN(colsNumber) && colsNumber >= 1) {
                this.colsNum = colsNumber;
            }
        }
    }
    setFieldStyle() {
        if (!Util.isEmptyString(this.verticalAlign)) {
            this.containterObj = { 'vertical-align': this.verticalAlign };
        }
        // 设置width接口时，配置grid，IE下不支持grid布局，存在兼容性问题
        const isSupportGrid = (typeof window !== 'undefined') && window.CSS && window.CSS.supports && window.CSS.supports('(display: grid)');
        this.useGrid = this.colsWidth && this.colsWidth.length > 0 && isSupportGrid;
        if (this.useGrid) {
            this.labelWidth = this.labelWidth ? this.labelWidth : '80px'; // 给定宽度，确保content对齐；
            for (let i = 0; i < this.colsWidth.length; i++) {
                // 各列设置百分比且设置列间距时，需要重新计算各列宽度，设置宽度-各列间距总和
                const calcWidth = `calc( ${this.colsWidth[i]} - ${parseFloat(this.colsGap[0]) * (this.colsWidth.length - 1) / this.colsWidth.length}px)`;
                this.colsWidth[i] = /%$/.test(this.colsWidth[i]) && this.colsGap[0] ? calcWidth : this.colsWidth[i];
            }
            this.containterObj['grid-template-columns'] = `${this.colsWidth.join(' ')}`;
            this.containterObj['grid-column-gap'] = this.colsGap[0]; // 列间距 grid-column-gap属性只支持一个值，取首项作为列间距
            this.buttonStyle = this.isVertical ? {} : { 'margin-left': `calc(${this.labelWidth} + 20px)` }; // 20px padding
        }
    }
    /**
     * @ignore
     * 需要在TiItemComponent.ts中调用
     */
    addCntItem(item) {
        this.items.push(item);
        this.items.sort((a, b) => {
            return a.itemIndex - b.itemIndex;
        });
        this.groupedItems = this.chunkArray(this.items, this.colsNum);
        // 强制变检一次，消除报错(Expression has changed after it was checked)
        this.changeDetector.detectChanges();
    }
    /**
     * @ignore
     * 需要在 TiItemComponent.ts 中调用
     */
    removeCntItem(item) {
        const itemIndex = this.items.indexOf(item);
        if (itemIndex !== -1) {
            this.items.splice(itemIndex, 1);
            this.groupedItems = this.chunkArray(this.items, this.colsNum);
            // 强制变检一次，消除报错(Expression has changed after it was checked)
            // ti-item和ti-formfiled组件都销毁时，视图也已销毁，不需要再强制变检;
            // 因此，强制变检需要在一定的条件下执行，消除服务报错（Attempt to use a destroyed view: detectChanges）
            if (!this.changeDetector['destroyed']) {
                this.changeDetector.detectChanges();
            }
        }
    }
    /**
     * @ignore
     * 需要在 TiButtonItemComponent.ts 中调用
     */
    addBtnItem(item) {
        this.btnItems.push(item);
    }
    /**
     * @ignore
     * 需要在 TiButtonItemComponent.ts 中调用
     */
    removeBtnItem(item) {
        const itemIndex = this.btnItems.indexOf(item);
        if (itemIndex !== -1) {
            this.btnItems.splice(itemIndex, 1);
        }
    }
    // tslint:disable-next-line:prefer-function-over-method
    chunkArray(array, size) {
        const length = array ? array.length : 0;
        if (!length || size < 1) {
            return [];
        }
        const result = [];
        // 单列
        if (size === 1) {
            array.forEach((item) => {
                result.push([item]);
            });
            // 多列
        }
        else {
            const rowspanNums = new Array(size); // 记录每一列的行合并的信息
            let onegroup = [];
            let colIndex = 0;
            array.forEach((item, index) => {
                while (rowspanNums[colIndex] > 0) {
                    rowspanNums[colIndex] = rowspanNums[colIndex] - 1;
                    colIndex++;
                    if (colIndex === size) {
                        result.push(onegroup);
                        onegroup = [];
                        colIndex = 0;
                    }
                }
                onegroup.push(item);
                // 如果该单元是行合并，则影响后续行
                if (item.rowspan > 1) {
                    rowspanNums[colIndex] = item.rowspan - 1;
                }
                // 如果该单元是列合并，则影响当前行
                if (item.colspan > 1) {
                    colIndex += (item.colspan - 1);
                }
                // 设置列间距
                if (colIndex < size - 1) {
                    // 设置宽度时，为使IE下有良好的呈现，取首项作为各列间距
                    item.gapWidth = this.colsWidth && this.colsWidth.length > 0 && this.colsGap[0] ? this.colsGap[0] : (this.colsGap[colIndex] || TiFormfieldComponent.COLS_GAP);
                }
                colIndex++;
                if (colIndex === size || index === array.length - 1) {
                    result.push(onegroup);
                    onegroup = [];
                    colIndex = 0;
                }
            });
        }
        return result;
    }
    /**
     * @ignore
     * 需要在html模板中使用
     */
    trackByFn(index, item) {
        return item.itemIndex;
    }
    /**
     * @ignore
     * 每项图标是否占位，设置按钮及content样式
     */
    getRequire(item, index) {
        let hasRequire;
        for (let i = 0; i < this.groupedItems.length; i++) {
            const groupedItem = this.groupedItems[i];
            if (groupedItem[index % this.colsNum] && groupedItem[index % this.colsNum].required) {
                hasRequire = true;
            }
        }
        if (index === 0 && hasRequire) {
            this.buttonStyle = { 'margin-left': `calc(${this.labelWidth} + 36px)` }; // 20 padding + 16 图标
        }
        if (hasRequire) {
            item.contentStyle['width'] = item.hasLabel ? `calc(100% - ${this.labelWidth} - 36px)` : `calc(100% - 16px)`;
        }
        else {
            // TiItemComponent 初始化时，ti-item-label指令无法获取到label，导致宽度设置不正确，因此在此处设置宽度
            item.contentStyle['width'] = item.hasLabel ? `calc(100% - ${this.labelWidth} - 20px)` : '100%';
        }
        return hasRequire;
    }
}
/**
 * 默认两列的间距
 */
TiFormfieldComponent.COLS_GAP = '70px';
TiFormfieldComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-formfield',
                template: "<h3 *ngIf=\"title\" class=\"ti3-form-title\" [id]=\"appendId('title')\">{{title}}</h3>\r\n<ng-container *ngIf=\"!useGrid else gridLayout\">\r\n    <table style=\"max-width: 100%;\" class=\"ti3-form\" [ngStyle]=\"containterObj\">\r\n        <tbody [ngClass]=\"{'ti3-text-form': type === textType}\">\r\n            <tr *ngFor=\"let groupedItem of groupedItems;index as groupIndex;\"\r\n                [ngClass]=\"{ 'ti3-form-list' : groupedItems.length === (groupIndex + 1)}\">\r\n                <ng-container *ngFor=\"let item of groupedItem;index as i;trackBy: trackByFn\">\r\n                    <ng-container\r\n                        *ngTemplateOutlet=\"isVertical&&type!==textType ? topAlign : leftAlign; context: {$implicit: item}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngFor=\"let item of btnItems;\">\r\n                <td *ngIf=\"!isVertical\"></td>\r\n                <td *ngIf=\"!isVertical\"></td>\r\n                <td [tiInclude]=\"item.btnContent\" [ngStyle]=\"item.verticalAlignObj\" class=\"ti3-form-button-item\"\r\n                    [attr.colspan]=\"item.btnColspan\"></td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n\r\n    <ng-template #leftAlign let-item>\r\n        <td [ngStyle]=\"item.verticalAlignObj\"\r\n            [ngClass]=\"{'ti3-form-require': item.required}\"\r\n            [attr.rowspan]=\"item.rowspan\">\r\n            <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon\"></span>\r\n        </td>\r\n        <td [tiInclude]=\"item.itemLabel\"\r\n            class=\"ti3-form-label ti3-text-form-label\"\r\n            [attr.rowspan]=\"item.rowspan\"\r\n            *ngIf=\"item.hasLabel\"\r\n            [ngStyle]=\"item.labelStyle\"></td>\r\n        <td [tiInclude]=\"item.element\"\r\n            [attr.colspan]=\"(item.colspan - 1) * 4 + 1 + (item.hasLabel ? 0 : 1)\"\r\n            [attr.rowspan]=\"item.rowspan\"\r\n            [ngStyle]=\"item.contentStyle\"\r\n            class=\"ti3-form-content ti3-text-form-content\"></td>\r\n        <td [ngStyle]=\"{width: item.gapWidth}\"\r\n            [attr.rowspan]=\"item.rowspan\"></td>\r\n    </ng-template>\r\n\r\n    <ng-template #topAlign let-item>\r\n        <td [attr.rowspan]=\"item.rowspan\">\r\n            <div class=\"ti3-form-top-label\">\r\n                <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon ti3-form-top-require\"></span>\r\n                <span [tiInclude]=\"item.itemLabel\"\r\n                      class=\"ti3-form-top-text\"\r\n                      [attr.rowspan]=\"item.rowspan\"\r\n                      *ngIf=\"item.hasLabel\"\r\n                      [ngStyle]=\"item.labelStyle\"></span>\r\n            </div>\r\n            <div [tiInclude]=\"item.element\"\r\n                 [attr.colspan]=\"(item.colspan - 1) * 4 + 1 + (item.hasLabel ? 0 : 1)\"\r\n                 [attr.rowspan]=\"item.rowspan\"\r\n                 [ngStyle]=\"item.contentStyle\"\r\n                 class=\"ti3-form-content\"></div>\r\n        </td>\r\n        <td [ngStyle]=\"{width: item.gapWidth}\"\r\n            [attr.rowspan]=\"item.rowspan\"></td>\r\n    </ng-template>\r\n</ng-container>\r\n\r\n<ng-template #gridLayout>\r\n    <div class=\"ti3-form\">\r\n        <div class=\"ti3-form-grid-container\" [ngStyle]=\"containterObj\">\r\n            <div *ngFor=\"let item of items;index as i;trackBy: trackByFn\"\r\n                 [ngClass]=\"{ 'ti3-text-form': type === textType }\"\r\n                 [ngStyle]=\"item.itemStyle\">\r\n                <ng-container\r\n                    *ngTemplateOutlet=\"isVertical&&type!==textType ? gridTopAlign : gridLeftAlign; context: {$implicit: item, index: i}\">\r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n        <div *ngFor=\"let item of btnItems;\" class=\"ti3-form-button-item\" [ngStyle]=\"buttonStyle\">\r\n            <div [tiInclude]=\"item.btnContent\" [ngStyle]=\"item.verticalAlignObj\"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <ng-template #gridLeftAlign let-item let-i=index>\r\n        <div [ngStyle]=\"item.verticalAlignObj\"\r\n             [ngClass]=\"{'ti3-form-require': item.required}\"\r\n             class=\"ti3-form-grid-require\"\r\n             *ngIf=\"getRequire(item, i)\">\r\n            <ti-icon [hidden]=\"!item.required\" name=\"staricon\"></ti-icon>\r\n        </div>\r\n        <div [tiInclude]=\"item.itemLabel\"\r\n             class=\"ti3-form-label ti3-text-form-label\"\r\n             *ngIf=\"item.hasLabel\"\r\n             [ngStyle]=\"item.labelStyle\"\r\n             style=\"display: inline-block;\"></div>\r\n        <div [tiInclude]=\"item.element\"\r\n             [ngStyle]=\"item.contentStyle\"\r\n             class=\"ti3-form-content ti3-text-form-content\"\r\n             style=\"display: inline-block;\"></div>\r\n    </ng-template>\r\n\r\n    <ng-template #gridTopAlign let-item>\r\n        <div class=\"ti3-form-top-label\">\r\n            <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon ti3-form-top-require\"></span>\r\n            <span [tiInclude]=\"item.itemLabel\"\r\n                  class=\"ti3-form-top-text\"\r\n                  *ngIf=\"item.hasLabel\"\r\n                  [ngStyle]=\"item.labelStyle\"></span>\r\n        </div>\r\n        <div [tiInclude]=\"item.element\"\r\n             [ngStyle]=\"item.contentStyle\"\r\n             class=\"ti3-form-content\"></div>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n",
                styles: [".ti3-form-title{color:var(--ti-common-color-text-primary);font-size:20px;margin-bottom:30px}.ti3-form{text-align:left}.ti3-form>tbody,.ti3-form>tbody tr,.ti3-form div,.ti3-form div tr{vertical-align:inherit}.ti3-form>tbody tr>td,.ti3-form div tr>td{vertical-align:inherit;white-space:normal}.ti3-form>tbody tr>td.ti3-form-label,.ti3-form div tr>td.ti3-form-label{white-space:nowrap}.ti3-form .ti3-form-grid-container{display:-ms-grid;display:grid}.ti3-form .ti3-form-list .ti3-form-content,.ti3-form .ti3-form-list .ti3-form-label,.ti3-form .ti3-form-list .ti3-form-require{padding-bottom:0}.ti3-form .ti3-form-require{padding:0 var(--ti-formfield-item-required-padding-right) var(--ti-formfield-item-padding-bottom) 0}.ti3-form .ti3-form-require .ti3-icon{color:var(--ti-common-color-error);font-size:var(--ti-formfield-item-required-font-size);font-weight:400;line-height:var(--ti-formfield-item-required-label-line-height)}.ti3-form .ti3-form-grid-require{display:inline-block;width:16px}.ti3-form .ti3-form-label{color:var(--ti-common-color-text-secondary);font-size:var(--ti-default-font-size);line-height:var(--ti-formfield-item-required-label-line-height);padding:0 var(--ti-formfield-item-label-padding-right) var(--ti-formfield-item-padding-bottom) 0}.ti3-form .ti3-form-content{padding-bottom:var(--ti-formfield-item-padding-bottom);word-break:break-word}.ti3-form .ti3-form-content input[type=checkbox][ti-checkbox]+.ti3-checkbox,.ti3-form .ti3-form-content input[type=radio][ti-radio]+.ti3-radio{display:inline-block;line-height:var(--ti-formfield-item-content-line-height)}.ti3-form .ti3-form-grid-container+.ti3-form-button-item,.ti3-form td.ti3-form-button-item{padding-top:var(--ti-formfield-button-item-padding-top)}.ti3-form .ti3-text-form .ti3-text-form-content,.ti3-form .ti3-text-form .ti3-text-form-label{line-height:var(--ti-formfield-text-from-item-line-height);padding-bottom:0}.ti3-form .ti3-text-form .ti3-text-form-label{color:var(--ti-formfield-text-form-label-color)}.ti3-form .ti3-form-top-label{align-items:center;color:var(--ti-common-color-text-secondary);display:flex;font-size:var(--ti-default-font-size);padding-bottom:var(--ti-common-space-2x);white-space:nowrap}.ti3-form .ti3-form-top-require{color:var(--ti-common-color-error);font-size:var(--ti-formfield-item-required-font-size)}.ti3-form .ti3-form-top-text{line-height:var(--ti-common-line-height-number)}"]
            },] }
];
TiFormfieldComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef }
];
TiFormfieldComponent.propDecorators = {
    type: [{ type: Input }],
    title: [{ type: Input }],
    labelWidth: [{ type: Input }],
    colsNumber: [{ type: Input }],
    colsGap: [{ type: Input }],
    verticalAlign: [{ type: Input }],
    textLineHeight: [{ type: Input }],
    colsWidth: [{ type: Input }]
};

/**
 * 本组件嵌在 tiFormfield 中使用，包裹着单个表单条目的所有内容
 */
class TiItemComponent {
    constructor(formfield, elementRef, changeDetector) {
        this.formfield = formfield;
        this.elementRef = elementRef;
        this.changeDetector = changeDetector;
        /**
         * 设置当前表单条目是否是必填，如果是必填，则前面会显示 *
         */
        this.required = false;
        /**
         * 设置当前表单条目是否显示
         *
         * tiItem 不支持 ngIf 和 hidden，由该接口来控制单个表单条目的显示与否
         */
        this.show = true;
        /**
         * 行合并，设置当前表单条目可横跨的行数
         */
        this.rowspan = 1;
        /**
         * 列合并，设置当前表单条目可横跨的列数
         */
        this.colspan = 1;
        /**
         * @ignore
         */
        this.hasLabel = false;
        /**
         * @ignore
         */
        this.gapWidth = '0px';
    }
    // 有两处改变label
    // 1. label接口传入的值
    // 2. 在ti-item-label组件中修改label的值
    /**
     * 设置当前表单条目的label文本，支持简单字符串文本，如果开发者希望基于html定制文本，
     * 建议使用[TiItemLabelComponent]{@link ./TiItemLabelComponent.html}组件
     *
     * 类型：string | Node
     */
    set label(labelParm) {
        this.setItemLabel(labelParm);
    }
    ngOnInit() {
        this.formfield.itemTotal++;
        this.decorateItem();
        if (this.show) {
            this.formfield.addCntItem(this);
        }
    }
    ngOnChanges(changes) {
        const showObj = changes['show'];
        if (showObj && !showObj.firstChange) {
            if (showObj.currentValue) {
                this.formfield.addCntItem(this);
            }
            else {
                this.formfield.removeCntItem(this);
            }
        }
    }
    ngOnDestroy() {
        // 在外部将ti-iem销毁时，应将此item从items数组中去掉
        this.formfield.removeCntItem(this);
        this.changeDetector.detach();
    }
    decorateItem() {
        this.itemIndex = Util.isNumber(this.index) ? this.index : this.formfield.itemTotal - 1;
        this.element = this.elementRef.nativeElement;
        this.verticalAlignObj = Util.isUndefined(this.verticalAlign) ?
            {} : { 'vertical-align': this.verticalAlign };
        // item-label的自定义的样式（垂直对齐方式、宽度）
        this.labelStyle = {
            'vertical-align': this.verticalAlign,
            width: this.formfield.labelWidth
        };
        // item-content的自定义的样式（垂直对齐方式）
        this.contentStyle = {
            'vertical-align': this.verticalAlign
        };
        // 为纯文本描述类表单时，可设置 item 的行高
        if (this.formfield.type === this.formfield.textType) {
            this.labelStyle['line-height'] = this.formfield.textLineHeight;
            this.contentStyle['line-height'] = this.formfield.textLineHeight;
        }
        // item 自定义行列合并样式
        if (this.formfield.useGrid) {
            this.itemStyle = { 'grid-area': `span ${this.rowspan} / span ${this.colspan}` };
        }
    }
    setItemLabel(label) {
        if (label) {
            this.hasLabel = true;
            this.itemLabel = label;
        }
        else {
            this.hasLabel = false;
        }
        this.changeDetector.detectChanges();
    }
}
TiItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-item',
                template: "<ng-content></ng-content>"
            },] }
];
TiItemComponent.ctorParameters = () => [
    { type: TiFormfieldComponent },
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
TiItemComponent.propDecorators = {
    required: [{ type: Input }],
    verticalAlign: [{ type: Input }],
    show: [{ type: Input }],
    rowspan: [{ type: Input }],
    colspan: [{ type: Input }],
    index: [{ type: Input }],
    label: [{ type: Input }]
};

/**
 * 本组件嵌在 tiItem 中使用，包裹着单个表单条目中 label显示的dom片段
 */
class TiItemLabelComponent {
    constructor(item, elementRef) {
        this.item = item;
        this.elementRef = elementRef;
    }
    ngAfterContentInit() {
        // ti-item 封装在自定义组件里时，使用ti-item-label，开发环境报错ExpressionChangedAfterItHasBeenCheckedError
        Promise.resolve().then(() => {
            this.item.label = this.elementRef.nativeElement;
        });
    }
}
TiItemLabelComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-item-label',
                template: "<ng-content></ng-content>"
            },] }
];
TiItemLabelComponent.ctorParameters = () => [
    { type: TiItemComponent },
    { type: ElementRef }
];

/**
 * 本组件嵌在 tiFormfield 中使用，包裹着表单按钮
 */
class TiButtonItemComponent {
    constructor(formfield, elementRef) {
        this.formfield = formfield;
        this.elementRef = elementRef;
        /**
         * 设置表单按钮是否显示
         *
         * tiButtonItem 不支持 ngIf 和 hidden，由该接口来控制表单按钮的显示与否
         */
        this.show = true;
        /**
         * @ignore
         */
        this.verticalAlignObj = {};
    }
    ngOnInit() {
        this.btnContent = this.elementRef.nativeElement;
        this.btnColspan = (this.formfield.colsNum - 1) * TiButtonItemComponent.TD_NUM_PER_ITEM + 2;
        if (this.verticalAlign) {
            this.verticalAlignObj['vertical-align'] = this.verticalAlign;
        }
        if (this.show) {
            this.formfield.addBtnItem(this);
        }
    }
    ngOnChanges(changes) {
        const showObj = changes['show'];
        if (showObj && !showObj.firstChange) {
            if (showObj.currentValue) {
                this.formfield.addBtnItem(this);
            }
            else {
                this.formfield.removeBtnItem(this);
            }
        }
    }
    ngOnDestroy() {
        this.formfield.removeBtnItem(this);
    }
}
/**
 * 每一个ti-item占4个td。第一个td用来显示“*”，第二个td用来显示label，
 * 第三个td用来显示content, 第四个td是item间距。
 */
TiButtonItemComponent.TD_NUM_PER_ITEM = 4;
TiButtonItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-button-item',
                template: "<ng-content></ng-content>"
            },] }
];
TiButtonItemComponent.ctorParameters = () => [
    { type: TiFormfieldComponent },
    { type: ElementRef }
];
TiButtonItemComponent.propDecorators = {
    show: [{ type: Input }],
    verticalAlign: [{ type: Input }]
};

class TiFormfieldModule {
}
TiFormfieldModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiIncludeModule
                ],
                exports: [TiFormfieldComponent,
                    TiItemComponent,
                    TiItemLabelComponent,
                    TiButtonItemComponent],
                declarations: [TiFormfieldComponent,
                    TiItemComponent,
                    TiItemLabelComponent,
                    TiButtonItemComponent]
            },] }
];

/**
 * @ignore
 *
 * 10.0.2版本新增组件
 *
 * 该组件主要用于图片放大预览
 *
 * <example-url>../tiny3demo/#/imagepreview/imagepreview-all</example-url>
 */
class TiImagepreviewComponent extends TiBaseComponent {
    constructor(sanitizer, renderer, elementRef) {
        super(elementRef, renderer);
        this.sanitizer = sanitizer;
        this.renderer = renderer;
        this.elementRef = elementRef;
        /**
         * 需要预览的文件列表
         */
        this.fileList = [];
        /**
         * 是否展示文件名称，默认展示
         */
        this.showFileName = true;
        /**
         * 默认展示的图片的索引
         */
        this.index = 0;
    }
    ngAfterViewInit() {
        this.addImgLoadListener();
    }
    /**
     * @ignore 翻到上一张图片
     */
    toNext() {
        if (this.index === (this.fileList.length - 1)) {
            return;
        }
        this.addImgLoadListener();
        this.index++;
    }
    /**
     * @ignore 翻到下一张图片
     */
    toPrevious() {
        if (this.index === 0) {
            return;
        }
        this.addImgLoadListener();
        this.index--;
    }
    // 由于图片高度不确定，需动态设置top值，所以增加load事件。
    addImgLoadListener() {
        this.imgTemplate.nativeElement.onload = () => {
            const imgHeight = this.imgTemplate.nativeElement.height;
            if (imgHeight !== 0) {
                const top = (imgHeight - 48) / 2;
                this.renderer.setStyle(this.switchBtnTemplate.nativeElement, 'top', top + 'px');
            }
            // 防止循环触发load事件
            // tslint:disable-next-line: no-null-keyword
            this.imgTemplate.nativeElement.onload = null;
        };
    }
}
TiImagepreviewComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-imagepreview',
                template: "<ti-modal-header class=\"ti3-image-preview-modal-header\">\r\n    <span *ngIf=\"showFileName\" [id]=\"appendId('name')\">{{fileList[index].name}}</span>\r\n</ti-modal-header>\r\n<ti-modal-body class='ti3-image-preview-modal-body'>\r\n    <div class='ti3-image-preview-container'>\r\n        <img #imgTemplate [src]='sanitizer.bypassSecurityTrustUrl(fileList[index].previewUrl)' />\r\n    </div>\r\n    <div #switchBtn class=\"ti3-image-preview-icon-container\">\r\n        <ti-icon tiOutline [tabindex]=\"index === 0 ? -1 : 0\" name='angle-left' class=\"ti3-image-preview-icon ti3-image-preview-icon-left\"\r\n            [ngClass]=\"{'ti3-image-preview-icon-disabled': index === 0 ? true: false }\" (click)=\"toPrevious()\" (keydown.enter)=\"toPrevious()\" [id]=\"appendId('left')\"></ti-icon>\r\n        <ti-icon tiOutline [tabindex]=\"index === fileList.length - 1 ? -1 : 0\" name=\"angle-right\" class=\"ti3-image-preview-icon ti3-image-preview-icon-right\"\r\n            [ngClass]=\"{'ti3-image-preview-icon-disabled': index === fileList.length - 1 ? true : false}\" (click)=\"toNext()\" (keydown.enter)=\"toNext()\" [id]=\"appendId('right')\"></ti-icon>\r\n    </div>\r\n</ti-modal-body>",
                styles: ["::ng-deep :root{--ti-image-preview-container-margin:var(--ti-common-space-5x);--ti-image-preview-container-width:600px;--ti-image-preview-icon-width:24px;--ti-image-preview-modal-header-font-size:14px;--ti-image-preview-modal-header-line-height:20px;--ti-image-preview-modal-header-padding-left:var(--ti-common-space-5x);--ti-image-preview-modal-header-padding-top:12px}.ti3-image-preview-modal-header{font-size:var(--ti-image-preview-modal-header-font-size)!important;line-height:var(--ti-image-preview-modal-header-line-height)!important;padding:var(--ti-image-preview-modal-header-padding-top) var(--ti-image-preview-modal-header-padding-left)!important}.ti3-image-preview-modal-body{margin:0 var(--ti-image-preview-container-margin)!important;max-height:none!important;padding:0}.ti3-image-preview-container{margin:0 auto var(--ti-image-preview-container-margin);width:var(--ti-image-preview-container-width)}.ti3-image-preview-container img{border-style:none;display:inline-block;width:100%}.ti3-image-preview-icon-container{position:absolute;width:100%}.ti3-image-preview-icon-container .ti3-image-preview-icon{background:rgba(0,0,0,.2);border-radius:2px;color:#fff;cursor:pointer;display:inline-block;font-size:calc(var(--ti-common-font-size-base)*2);height:calc(var(--ti-image-preview-icon-width)*2);line-height:calc(var(--ti-image-preview-icon-width)*2);width:var(--ti-image-preview-icon-width)}.ti3-image-preview-icon-container .ti3-image-preview-icon:focus,.ti3-image-preview-icon-container .ti3-image-preview-icon:hover{background:rgba(0,0,0,.3)}.ti3-image-preview-icon-container .ti3-image-preview-icon-disabled{background:rgba(0,0,0,.2)!important;color:hsla(0,0%,100%,.4);cursor:not-allowed;outline:none}.ti3-image-preview-icon-container .ti3-image-preview-icon-left{float:left}.ti3-image-preview-icon-container .ti3-image-preview-icon-right{float:right}"]
            },] }
];
TiImagepreviewComponent.ctorParameters = () => [
    { type: DomSanitizer },
    { type: Renderer2 },
    { type: ElementRef }
];
TiImagepreviewComponent.propDecorators = {
    fileList: [{ type: Input }],
    showFileName: [{ type: Input }],
    index: [{ type: Input }],
    imgTemplate: [{ type: ViewChild, args: ['imgTemplate', { static: true },] }],
    switchBtnTemplate: [{ type: ViewChild, args: ['switchBtn', { static: true },] }]
};

/**
 * @ignore
 */
const animateStyle = '0.3s cubic-bezier(0.40, 0.00, 0.20, 1.00)';
/**
 * @ignore
 */
class TiModalComponent extends TiBaseComponent {
    constructor(ele, tiRenderer, renderer, document) {
        super(ele, renderer);
        this.tiRenderer = tiRenderer;
        this.renderer = renderer;
        this.document = document;
        this.index = 0; // 多个弹出框情况下，zindex层级设置辅助
        this.focusableElements = []; // 弹框中可聚焦元素列表
    }
    set showState(value) {
        this._showState = value;
    }
    get showState() {
        return this._showState;
    }
    static preventEvent(event) {
        event.preventDefault();
        event.stopPropagation();
    }
    // 路由切换后，modal还会存在，因此此处做了事件处理
    onhashchange() {
        this.modalInstance._remove();
    }
    // 缩放时重置弹框位置
    onResize() {
        this.tiRenderer.setStyles(this.contentRef.nativeElement, {
            left: 0,
            top: 0
        });
    }
    // 键盘事件处理
    onKeydown(event) {
        switch (event.which) {
            case TiKeymap.KEY_ESCAPE: // close on ESC
                if (this.closeOnEsc) {
                    this.dismissModal();
                }
                break;
            case TiKeymap.KEY_TAB: // tab键用于处理在弹框内循环获取焦点
                this.onTabChange(event);
                break;
            default:
                break;
        }
    }
    // 弹窗外围出现的滚动条滚动会导致下拉等定位在body上的组件相对于宿主元素定位偏移，
    // 因此触发tiScroll事件做处理，事件包括：
    // 整个页面滚动条滚轮滚动事件, mousewheel处理Chrome和IE下事件，DOMMouseScroll处理firefox下事件
    // 整个页面滚动条鼠标滚动事件
    onTiScroll() {
        Util.trigger(document, 'tiScroll');
    }
    ngAfterContentInit() {
        this.dragOptions = {
            // 这时弹窗内容DOM还未解析，所以需要使用标签选择器('ti-modal-header')来获取元素
            handle: this.nativeElement.querySelector('ti-modal-header'),
            drag: (opts) => {
                Util.trigger(document, 'tiScroll');
                // 当前浏览器可视区域的宽高
                const curBrowseWidth = document.documentElement.clientWidth;
                const curBrowseheight = document.documentElement.clientHeight;
                // 元素原始位置（由于元素本身left和top实时变化，因此取其父元素位置）
                const eleRect = opts.helper.parentElement.getBoundingClientRect();
                // 元素距页面可视区域的可用位置范围
                const minLeft = -eleRect.left + document.body.scrollLeft;
                const maxLeft = Math.max(curBrowseWidth + minLeft - eleRect.width, minLeft);
                const minTop = -eleRect.top + document.body.scrollTop;
                const maxTop = Math.max(curBrowseheight + minTop - eleRect.height, minTop);
                const position = opts.position;
                // 元素left位置根据可用left范围计算
                if (position.left < minLeft) {
                    position.left = minLeft;
                }
                else if (position.left > maxLeft) {
                    position.left = maxLeft;
                }
                // 元素top位置根据可用top范围计算
                if (position.top < minTop) {
                    position.top = minTop;
                }
                else if (position.top > maxTop) {
                    position.top = maxTop;
                }
                return position;
            }
        };
    }
    dismissModal() {
        this.modalInstance.dismiss();
    }
    onAnimationDone($event) {
        // 弹框toState有三种状态:'show'/'hide'/null
        // 弹框显示动画结束后,重新将焦点聚焦在弹框元素/弹框中
        if ($event.toState === 'show') {
            this.reStyleModal();
            this.focusInModal();
            return;
        }
        // 弹框隐藏动画结束后,销毁弹框DOM
        if ($event.toState === 'hide') {
            this.modalInstance._remove();
        }
    }
    // 弹框打开时，设置弹框元素样式
    reStyleModal() {
        const parentEle = this.nativeElement.querySelector('.ti3-modal-header');
        if (this.draggable !== false) {
            this.renderer.setStyle(parentEle, 'cursor', 'move');
        }
        if (this.headerAlign === 'center' || this.headerAlign === 'right') {
            this.renderer.setStyle(parentEle, 'text-align', this.headerAlign);
        }
        this.renderer.addClass(this.document.body, 'ti3-modal-open');
        this.setMaxHeight();
    }
    /**
     * 设置弹框高度：
     * 根据UCD3.0规范，modal最大高度不能超过弹框宽度,所以需要获取到modal的宽度值，用其减去modal的header和footer的高度
     * 后设为body的最大高度，当高度超出时，ti-modal-body垂直方向上出现滚动条
     * 10.1.1变更说明：
     * 根据规范变更，弹框高度可以超过弹框宽度，同时弹窗的最大高度是660px。
     */
    setMaxHeight() {
        // 修复SSR问题：ERROR TypeError: modalHeaderEle.getBoundingClientRect is not a function
        const modalHeaderEle = this.nativeElement.querySelector('.ti3-modal-header');
        const modalHeaderHeight = modalHeaderEle && (typeof modalHeaderEle.getBoundingClientRect === 'function') ? modalHeaderEle.getBoundingClientRect().height : 0;
        const modalFooterEle = this.nativeElement.querySelector('.ti3-modal-footer');
        const modalFooterHeight = modalFooterEle && (typeof modalFooterEle.getBoundingClientRect === 'function') ? modalFooterEle.getBoundingClientRect().height : 0;
        const modalBodyMaxHeight = TiModalComponent.MODAL_MAX_HEIGHT - modalHeaderHeight - modalFooterHeight;
        this.renderer.setStyle(this.nativeElement.querySelector('.ti3-modal-body'), 'maxHeight', modalBodyMaxHeight + 'px');
    }
    focusInModal() {
        /**
         * 首先判断新打开的modal是否已存在获取焦点的元素
         * 如果存在，则需要对modal元素再次设置焦点
         * 否则，对modal容器设置焦点
         */
        const activeElement = this.document.activeElement;
        const isfocusedInModal = activeElement && this.nativeElement.contains(activeElement);
        if (isfocusedInModal) {
            /**
             * 对已经设置焦点的元素，再次设置焦点，是为了解决以下两个问题：
             * 1>首次加载时，已经获取焦点的元素，其输入tip提示位置偏移
             * 2>首次加载时，IE浏览器中，已经获取焦点的元素input，光标位置出现偏移
             */
            if (activeElement) {
                activeElement.blur();
                // tiautofocusinmodal属性需要在change校验中使用(ChangeCheck.ts)
                this.renderer.setAttribute(activeElement, 'tiautofocusinmodal', '');
                activeElement.focus();
                this.renderer.removeAttribute(activeElement, 'tiautofocusinmodal');
            }
        }
        else {
            // 弹窗内未找到已聚焦元素情况下，优先处理 input 和 textarea 原生标签autofocus聚焦
            // (input,textarea.button原生标签的autofocus弹窗打开时无效(chrome是从第二次打开无效)，因此要做此处理)
            let focusEle = this.nativeElement.querySelector(`input[autofocus]:not([disabled]):not([tabindex=\'-1\']),
                textarea[autofocus]:not([disabled]):not([tabindex=\'-1\']), button[autofocus]:not([disabled]):not([tabindex=\'-1\'])`);
            // 如果通过上述处理，聚焦元素仍未获取到的情况下，则可聚焦元素为当前弹框
            focusEle = focusEle || this.modalEleRef.nativeElement;
            focusEle.focus();
        }
    }
    // 用于处理tab键行为，确保tab时只可在弹框内循环获取焦点
    onTabChange(event) {
        const focusableElementList = this.getFocusableElesInModal(); // 获取当前弹出框DOM中可以获取焦点的元素列表
        const focusableListLength = focusableElementList.length;
        if (focusableListLength === 0) {
            return;
        }
        const target = event.target; // 事件对象元素
        const firstFocusableEle = focusableElementList[0]; // 第一个可获取焦点的元素
        const lastFocusableEle = focusableElementList[focusableListLength - 1]; // 最后一个可获取焦点的元素
        // 按下tab+shift键时，如果当前已获取焦点元素是弹出框中的第一个可获取焦点元素或弹框本身，则聚焦最后一个元素
        if (event.shiftKey) {
            if (target === firstFocusableEle || target === this.modalEleRef.nativeElement) {
                lastFocusableEle.focus();
                TiModalComponent.preventEvent(event); // 阻止默认事件及继续冒泡，确保此处手动focus生效
            }
            return;
        }
        // 按下tab键时，如当前已获取焦点元素是弹框中最后一个可获取焦点元素，则聚焦第一个元素
        if (target === lastFocusableEle) {
            firstFocusableEle.focus();
            TiModalComponent.preventEvent(event);
        }
    }
    getFocusableElesInModal() {
        if (this.focusableElements.length !== 0) {
            return this.focusableElements;
        }
        const contentEle = this.contentRef.nativeElement;
        if (contentEle) {
            const elements = contentEle.querySelectorAll(TiModalComponent.tababbleSelector);
            [].forEach.call(elements, (element) => {
                if (getComputedStyle(element).display !== 'none' &&
                    element.offsetWidth > 0 && element.offsetHeight > 0) {
                    this.focusableElements.push(element);
                }
            });
        }
        return this.focusableElements;
    }
}
/**
 * 10.1.1新增
 * 规范刷新，弹窗整体的最大高度为660px（按照最小分辨率1280*768计算）
 */
TiModalComponent.MODAL_MAX_HEIGHT = 660;
// 可通过tab聚焦的元素选择器列表
TiModalComponent.tababbleSelector = `a[href], area[href], input:not([disabled]):not([tabindex=\'-1\']),
       button:not([disabled]):not([tabindex=\'-1\']),select:not([disabled]):not([tabindex=\'-1\']),
       textarea:not([disabled]):not([tabindex=\'-1\']),
       iframe, object, embed, *[tabindex]:not([tabindex=\'-1\']), *[contenteditable=true]`;
TiModalComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-wrapper',
                template: "<div #modalEle class='ti3-modal' tabindex='-1'\r\n     [@.disabled]='!animation' [@modalAnimate]='showState'>\r\n    <div [ngClass]='[modalClass||\"\", \"ti3-modal-dialog\"]' [@modalPosAnimate]='showState' (@modalPosAnimate.done)='onAnimationDone($event)'>\r\n        <div class=\"ti3-modal-content\" #modalContent [tiDraggable] = \"dragOptions\" [tiDragDisabled] = \"!draggable\">\r\n            <span *ngIf='closeIcon' class='ti3-close ti3-icon ti3-icon-close'\r\n            [tabindex]=\"0\" (keydown.enter)=\"dismissModal()\" tiOutline\r\n            (click)='dismissModal()' [id]=\"appendId('close')\"></span>\r\n            <ng-content></ng-content>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                animations: [
                    trigger('modalAnimate', [
                        state('show', style({
                            opacity: 1
                        })),
                        state('hide, void', style({
                            opacity: 0
                        })),
                        transition('show => hide', animate(animateStyle)),
                        transition('hide => show', animate(animateStyle))
                    ]),
                    trigger('modalPosAnimate', [
                        state('show', style({
                            transform: 'translate(0, 0px)'
                        })),
                        state('hide, void', style({
                            transform: 'translate(0, -6px)'
                        })),
                        transition('show => hide', animate(animateStyle)),
                        transition('hide => show', animate(animateStyle))
                    ])
                ],
                styles: [":root{--ti-modal-content-margin:0 32px;--ti-modal-footer-padding:28px 32px 32px;--ti-modal-header-font-size:var(--ti-common-font-size-3);--ti-modal-header-height:36px;--ti-modal-header-padding:32px 32px 28px;--ti-modal-width:550px}.ti3-modal{-ms-box-sizing:border-box;-webkit-overflow-scrolling:touch;bottom:0;box-sizing:border-box;left:0;outline:0;overflow:hidden;position:fixed;right:0;top:0;z-index:1050}.ti3-modal-open .ti3-modal{overflow-x:hidden;overflow-y:auto}.ti3-modal-dialog{-ms-box-sizing:border-box;box-sizing:border-box;margin:10px;position:relative;width:auto}.ti3-modal-dialog.ti3-msg-default-width{width:var(--ti-message-default-width)}.ti3-modal-content{background-clip:padding-box;background-color:var(--ti-modal-content-bg-color);border-radius:var(--ti-common-border-radius-normal);box-shadow:var(--ti-common-shadow-4-down);outline:0;position:relative}.ti3-modal-content,.ti3-modal-header{-ms-box-sizing:border-box;box-sizing:border-box}.ti3-modal-header{border-radius:var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal) 0 0;color:var(--ti-modal-header-text-color);display:block;font-size:var(--ti-modal-header-font-size);font-weight:var(--ti-modal-header-font-weight);line-height:100%;padding:var(--ti-modal-header-padding)}.ti3-modal-header.ti3-modal-title-center{text-align:center}.ti3-close{-moz-osx-font-smoothing:grayscale;-ms-box-sizing:border-box;-webkit-font-smoothing:antialiased;box-sizing:border-box;color:var(--ti-modal-close-icon-color);cursor:pointer;font:normal normal normal var(--ti-common-font-size-base)/var(--ti-modal-header-height) ti3Font;position:absolute;right:var(--ti-modal-close-icon-position-right);text-rendering:auto;text-transform:none;top:var(--ti-modal-close-icon-position-top);z-index:2000}.ti3-close:hover{color:var(--ti-modal-close-icon-color-hover)}.ti3-modal-body{-ms-box-sizing:border-box;box-sizing:border-box;display:block;overflow-y:auto;padding:var(--ti-modal-content-margin);position:relative}.ti3-modal-footer{border-radius:0 0 var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal);display:block;padding:var(--ti-modal-footer-padding);text-align:center}.ti3-modal-footer button:nth-of-type(2){margin-left:10px}@media screen and (min-width:768px){.ti3-modal-dialog{margin:150px auto 0;width:var(--ti-modal-width)}}"]
            },] }
];
TiModalComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: TiRenderer },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiModalComponent.propDecorators = {
    contentRef: [{ type: ViewChild, args: ['modalContent', { static: true },] }],
    modalEleRef: [{ type: ViewChild, args: ['modalEle', { static: true },] }],
    onhashchange: [{ type: HostListener, args: ['window:hashchange',] }],
    onResize: [{ type: HostListener, args: ['window:resize',] }],
    onKeydown: [{ type: HostListener, args: ['document:keydown', ['$event'],] }],
    onTiScroll: [{ type: HostListener, args: ['document:mousewheel',] }, { type: HostListener, args: ['document:DOMMouseScroll',] }, { type: HostListener, args: ['window:scroll',] }]
};

/**
 * @ignore
 */
class TiModalNoAnimationComponent extends TiModalComponent {
    set showState(value) {
        this._showState = value;
        this.onAnimationDone({ toState: value });
    }
}
TiModalNoAnimationComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-wrapper-no-animation',
                template: "<div #modalEle class='ti3-modal' tabindex='-1'>\r\n    <div [ngClass]='[modalClass||\"\", \"ti3-modal-dialog\"]'>\r\n        <div class=\"ti3-modal-content\" #modalContent [tiDraggable] = \"dragOptions\" [tiDragDisabled] = \"!draggable\">\r\n            <span *ngIf='closeIcon' class='ti3-close ti3-icon ti3-icon-close'\r\n            [tabindex]=\"0\" (keydown.enter)=\"dismissModal()\" (click)='dismissModal()' [id]=\"appendId('close')\"></span>\r\n            <ng-content></ng-content>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                styles: [":root{--ti-modal-content-margin:0 32px;--ti-modal-footer-padding:28px 32px 32px;--ti-modal-header-font-size:var(--ti-common-font-size-3);--ti-modal-header-height:36px;--ti-modal-header-padding:32px 32px 28px;--ti-modal-width:550px}.ti3-modal{-ms-box-sizing:border-box;-webkit-overflow-scrolling:touch;bottom:0;box-sizing:border-box;left:0;outline:0;overflow:hidden;position:fixed;right:0;top:0;z-index:1050}.ti3-modal-open .ti3-modal{overflow-x:hidden;overflow-y:auto}.ti3-modal-dialog{-ms-box-sizing:border-box;box-sizing:border-box;margin:10px;position:relative;width:auto}.ti3-modal-dialog.ti3-msg-default-width{width:var(--ti-message-default-width)}.ti3-modal-content{background-clip:padding-box;background-color:var(--ti-modal-content-bg-color);border-radius:var(--ti-common-border-radius-normal);box-shadow:var(--ti-common-shadow-4-down);outline:0;position:relative}.ti3-modal-content,.ti3-modal-header{-ms-box-sizing:border-box;box-sizing:border-box}.ti3-modal-header{border-radius:var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal) 0 0;color:var(--ti-modal-header-text-color);display:block;font-size:var(--ti-modal-header-font-size);font-weight:var(--ti-modal-header-font-weight);line-height:100%;padding:var(--ti-modal-header-padding)}.ti3-modal-header.ti3-modal-title-center{text-align:center}.ti3-close{-moz-osx-font-smoothing:grayscale;-ms-box-sizing:border-box;-webkit-font-smoothing:antialiased;box-sizing:border-box;color:var(--ti-modal-close-icon-color);cursor:pointer;font:normal normal normal var(--ti-common-font-size-base)/var(--ti-modal-header-height) ti3Font;position:absolute;right:var(--ti-modal-close-icon-position-right);text-rendering:auto;text-transform:none;top:var(--ti-modal-close-icon-position-top);z-index:2000}.ti3-close:hover{color:var(--ti-modal-close-icon-color-hover)}.ti3-modal-body{-ms-box-sizing:border-box;box-sizing:border-box;display:block;overflow-y:auto;padding:var(--ti-modal-content-margin);position:relative}.ti3-modal-footer{border-radius:0 0 var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal);display:block;padding:var(--ti-modal-footer-padding);text-align:center}.ti3-modal-footer button:nth-of-type(2){margin-left:10px}@media screen and (min-width:768px){.ti3-modal-dialog{margin:150px auto 0;width:var(--ti-modal-width)}}"]
            },] }
];

/**
 * @ignore
 */
const animateStyle$1 = '0.3s cubic-bezier(0.40, 0.00, 0.20, 1.00)';
/**
 * @ignore
 */
class TiBackdropComponent {
    constructor(renderer) {
        this.renderer = renderer;
        this.index = 0; // 多个弹出框情况下，zindex层级设置辅助
    }
    set showState(value) {
        this._showState = value;
    }
    get showState() {
        return this._showState;
    }
    // 在微前端，多个子应用之间url路径跳转,等到弹窗隐藏结束后，this.destroy() 已经无效。
    onhashchange() {
        this.destroy();
    }
    onAnimationDone($event) {
        // 弹框隐藏动画结束后,销毁弹框DOM
        if ($event.toState === 'hide') {
            this.destroy();
            return;
        }
    }
}
TiBackdropComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-backdrop',
                template: `<div class='ti3-modal-backdrop'
                [@.disabled]='!animation' [@backdropAnimate] = 'showState'
                (@backdropAnimate.done)='onAnimationDone($event)'></div>`,
                animations: [
                    trigger('backdropAnimate', [
                        state('show', style({
                            opacity: 0.2
                        })),
                        state('hide, void', style({
                            opacity: 0
                        })),
                        transition('show => hide', animate(animateStyle$1)),
                        transition('hide => show', animate(animateStyle$1))
                    ])
                ],
                styles: [".ti3-modal-backdrop{background-color:var(--ti-modal-backdrop-bg-color);bottom:0;box-sizing:border-box;left:0;opacity:.2;position:fixed;right:0;top:0;z-index:1040}"]
            },] }
];
TiBackdropComponent.ctorParameters = () => [
    { type: Renderer2 }
];
TiBackdropComponent.propDecorators = {
    onhashchange: [{ type: HostListener, args: ['window:hashchange',] }]
};

/**
 * @ignore
 */
class TiBackdropNoAnimationComponent extends TiBackdropComponent {
    set showState(value) {
        this._showState = value;
        this.onAnimationDone({ toState: value });
    }
}
TiBackdropNoAnimationComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-backdrop-no-animation',
                template: `<div class='ti3-modal-backdrop' #backdrop></div>`,
                styles: [".ti3-modal-backdrop{background-color:var(--ti-modal-backdrop-bg-color);bottom:0;box-sizing:border-box;left:0;opacity:.2;position:fixed;right:0;top:0;z-index:1040}"]
            },] }
];

/**
 * 弹框header容器标签，可将弹框头部内容定义在该容器内
 */
class TiModalHeaderComponent {
}
TiModalHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-header',
                template: `<span><ng-content></ng-content></span>`,
                host: {
                    '[class.ti3-modal-header]': 'true'
                }
            },] }
];

/**
 * 弹框body容器标签，可将弹框body内容定义在该容器内
 */
class TiModalBodyComponent {
}
TiModalBodyComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-body',
                template: `<ng-content></ng-content>`,
                host: {
                    '[class.ti3-modal-body]': 'true'
                }
            },] }
];

/**
 * 弹框header容器标签，可将弹框底部内容定义在该容器内
 */
class TiModalFooterComponent {
}
TiModalFooterComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-footer',
                template: `<ng-content></ng-content>`,
                host: {
                    '[class.ti3-modal-footer]': 'true'
                }
            },] }
];

// 命名含有Service的Module，都不是对外暴露的Service，是内部使用。外部使用此Service，导入TiDragModule即可
/**
 * @ignore
 */
class TiDragServiceModule {
}
TiDragServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiRendererModule
                ]
            },] }
];

/**
 * 拖拽服务，适用于可拖拽元素不在html模板中显示声明的情况，除服务方式外，还提供了指令生成方式[TiDraggableDirective]{@link ../directives/TiDraggableDirective.html}，
 * 使用该服务时需要引入模块TiDragServiceModule
 *
 * <example-url>../tiny3demo/#/drag/drag-all</example-url>
 */
class TiDragService {
    constructor(rendererFactory, tiRenderer) {
        this.tiRenderer = tiRenderer;
        /* tslint:disable:no-null-keyword */
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    /**
     * 创建拖拽对象
     *
     * 函数返回值为
     * {
     * destroy: () => void
     * }
     */
    create(options) {
        const helper = options.helper; // 可拖拽元素，原生HTML类型
        const handle = options.handle || helper; // 拖拽生效元素,未定义情况下，默认为helper元素
        // 标志位，用于记录是否是拖拽引起的事件触发,在mousedown和mouseup中分别进行了置位
        let mouseStart = false;
        // 记录初始位置信息
        let originalPagePos;
        let originalPos;
        // 设置给helper元素的位置信息，用于位置设置及事件中参数传递
        let position;
        // 非定位元素情况下设置left/top无效，因此需先将其设置为relative定位
        // 修复SSR错误：ERROR ReferenceError: getComputedStyle is not defined
        const pos = typeof getComputedStyle !== 'undefined' ? getComputedStyle(helper).position : '';
        if (!/(fixed|absolute|relative)/.test(pos)) {
            this.renderer.setStyle(helper, 'position', 'relative');
        }
        // 拖拽时需要用到的mouse事件句柄记录
        let mouseMoveEvt;
        let mouseUpEvt;
        this.renderer.listen(handle, 'mousedown', (event) => {
            if (options.disabled) { // 灰化情况下不做处理
                return;
            }
            event.preventDefault(); // 阻止拖拽过程中文本的选中处理等操作
            mouseStart = true;
            // 初始拖拽时鼠标距离页面边距位置（包含滚动条在内）
            originalPagePos = {
                pageX: event.pageX,
                pageY: event.pageY
            };
            // 拖拽元素初始位置,由于获取到的位置为'xxpx',因此此处需要转化为数字
            originalPos = position = {
                left: parseInt(getComputedStyle(helper).left, 10) || 0,
                top: parseInt(getComputedStyle(helper).top, 10) || 0
            };
            // 触发初始拖拽事件
            triggerEvt('start');
            mouseMoveEvt = this.renderer.listen(document, 'mousemove', (evt) => {
                onMouseMove(evt);
            });
            mouseUpEvt = this.renderer.listen(document, 'mouseup', (evt) => {
                onMouseUp(evt);
            });
        });
        const onMouseMove = (evt) => {
            // 防止非拖拽触发的mousemove事件
            if (!mouseStart) {
                return;
            }
            evt.preventDefault(); // 阻止拖拽过程中的选中处理等操作
            const topPos = (options.axis === 'x')
                ? originalPos.top
                : (evt.pageY - originalPagePos.pageY + originalPos.top - document.body.scrollTop);
            const leftPos = (options.axis === 'y')
                ? originalPos.left
                : (evt.pageX - originalPagePos.pageX + originalPos.left - document.body.scrollLeft);
            position = {
                left: leftPos,
                top: topPos
            };
            // 触发拖拽时间，该事件中处理拖拽过程中的位置纠正
            triggerEvt('drag');
            this.tiRenderer.setStyles(helper, {
                left: `${position.left}px`,
                top: `${position.top}px`
            });
        };
        const onMouseUp = (evt) => {
            mouseStart = false;
            evt.preventDefault();
            triggerEvt('stop');
            // 拖拽停止后，解绑document上的相关事件
            mouseMoveEvt();
            mouseUpEvt();
        };
        const triggerEvt = (evtType) => {
            if (options[evtType]) {
                const ret = options[evtType]({ position, helper });
                if (typeof ret === 'object') {
                    position = Object.assign(Object.assign({}, ret), position);
                }
            }
        };
        return {
            destroy: () => {
                if (!Util.isUndefined(mouseMoveEvt)) {
                    mouseMoveEvt();
                }
                if (!Util.isUndefined(mouseUpEvt)) {
                    mouseUpEvt();
                }
            }
        };
    }
}
TiDragService.ɵprov = ɵɵdefineInjectable({ factory: function TiDragService_Factory() { return new TiDragService(ɵɵinject(RendererFactory2), ɵɵinject(TiRenderer)); }, token: TiDragService, providedIn: TiDragServiceModule });
TiDragService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiDragServiceModule
            },] }
];
TiDragService.ctorParameters = () => [
    { type: RendererFactory2 },
    { type: TiRenderer }
];

/**
 * 拖拽指令，除指令方式外，还提供了服务生成方式[TiDragService]{@link ../injectables/TiDragService.html}
 *
 * <example-url>../tiny3demo/#/drag/drag-all</example-url>
 */
class TiDraggableDirective {
    constructor(hostEle, dragService) {
        this.hostEle = hostEle;
        this.dragService = dragService;
        /**
         * 拖拽是否灰化，可动态修改
         */
        this.tiDragDisabled = false;
    }
    ngOnInit() {
        this.options = Object.assign(Object.assign({}, this.tiDraggable), { helper: this.hostEle.nativeElement, disabled: this.tiDragDisabled });
        this.dragInstance = this.dragService.create(this.options);
    }
    ngOnChanges(changes) {
        // 通过直接修改options的方式修改disabled状态
        if (changes['tiDragDisabled'] && !changes['tiDragDisabled'].firstChange) {
            this.options.disabled = this.tiDragDisabled;
        }
    }
    ngOnDestroy() {
        // 修复SSR错误：TypeError: Cannot read property 'destroy' of undefined
        this.dragInstance && this.dragInstance.destroy();
    }
}
TiDraggableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiDraggable]'
            },] }
];
TiDraggableDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: TiDragService }
];
TiDraggableDirective.propDecorators = {
    tiDraggable: [{ type: Input }],
    tiDragDisabled: [{ type: Input }]
};

class TiDraggableModule {
}
TiDraggableModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiDragServiceModule
                ],
                exports: [TiDraggableDirective, TiDragServiceModule],
                declarations: [TiDraggableDirective]
            },] }
];

class TiModalModule {
}
TiModalModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule,
                    TiDraggableModule,
                    TiIconModule,
                    TiPopupModule,
                    TiOutlineModule,
                    TiRendererModule],
                exports: [TiModalComponent, TiModalNoAnimationComponent,
                    TiBackdropNoAnimationComponent, TiModalHeaderComponent,
                    TiModalFooterComponent, TiModalBodyComponent],
                declarations: [TiModalComponent, TiModalNoAnimationComponent,
                    TiBackdropNoAnimationComponent, TiModalHeaderComponent,
                    TiModalFooterComponent, TiModalBodyComponent, TiBackdropComponent],
                entryComponents: [TiModalComponent, TiModalNoAnimationComponent, TiBackdropNoAnimationComponent, TiBackdropComponent]
            },] }
];

class TiImagepreviewModule {
}
TiImagepreviewModule.decorators = [
    { type: NgModule, args: [{
                imports: [TiModalModule, CommonModule, TiIconModule, TiOutlineModule],
                exports: [TiImagepreviewComponent],
                declarations: [TiImagepreviewComponent]
            },] }
];

/* eslint-disable no-eq-null */
// 下面注释，可以避免编译lib时正则报错。原理未知，副作用未知。
// @dynamic
/**
 * Ip组件
 *
 * Ip组件提供了一种方便的显示和设置IP地址的功能。
 *
 * <example-url>../tiny3demo/#/ip/ip-all</example-url>
 */
class TiIpComponent extends TiFormComponent {
    constructor(hostRef, renderer2) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        /**
         * ip版本号，可以赋值4或6
         */
        this.version = 4;
        /**
         * @ignore
         */
        this.pasteHandle = (event) => {
            if (this.disabled) {
                return;
            }
            event.preventDefault(); // 阻止默认的input原生的粘贴事件（把粘贴板的值粘贴到input框）
            let pasteValue = '';
            if (window['clipboardData'] && window['clipboardData'].getData) { // for IE
                pasteValue = window['clipboardData'].getData('Text');
            }
            else { // For other browser
                try {
                    pasteValue = event.clipboardData.getData('Text');
                }
                catch (err) { }
            }
            const unmaskpaste = this.unmask(this.version, pasteValue);
            if (this.isValidIP(this.version, unmaskpaste)) {
                this.updateValue(unmaskpaste); // 粘贴之后更新值
                this.ipsValues = this.splitToIPArray(this.version, this.model); // 内部的操作手动更新数组
            }
        };
        /**
         * @ignore
         */
        this.blurHandle = (event) => {
            const ipValue = this.generateIPValue(0);
            if (ipValue === '') {
                this.updateValue(ipValue);
            }
            else {
                const fixedVaule = this.blurFixed(this.version, ipValue);
                this.updateValue(this.mask(this.version, fixedVaule));
            }
        };
    }
    static getGlbInfo(ver) {
        return ver === 4 ? TiIpComponent.ipv4 : TiIpComponent.ipv6;
    }
    blurFixed(ver, ip) {
        const arr = this.splitToIPArray(ver, ip);
        for (let i = 0; i < arr.length; i++) {
            if (arr[i] === '') {
                arr[i] = '0';
            }
        }
        return this.joinToIPValue(ver, arr);
    }
    // 组件声明周期钩子--start
    ngOnInit() {
        super.ngOnInit();
        this.init();
    }
    init() {
        // 默认是IPv4
        this.version = parseInt(String(this.version), 10) === TiIpComponent.ipv6Version ?
            TiIpComponent.ipv6Version : TiIpComponent.ipv4Version;
        // 初始化ipValueArray  赋值新的数组
        this.ipsValues = TiIpComponent.getGlbInfo(this.version).ipValueArray.concat();
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        //  处理 聚焦 并使第一段ip获焦(放在这个钩子的原因：在oninit中拿不到 QueryList 返回的结果集)
        const elements = [];
        this.ipInputs.forEach((item) => {
            elements.push(item.nativeElement);
        });
        // 推荐在onInit()时调用setFocusableElems(), 但是ngFor/ngIf中的元素在ngAfterViewInit()才能获取到
        this.setFocusableElems(elements);
    }
    // 组件声明周期钩子--end
    // 实现ControlValueAccessor接口--start
    /**
     * @ignore
     */
    writeValue(value) {
        if (value === '') {
            super.writeValue(value);
            // 对空值做特殊处理,为空时清空IP框
            this.ipsValues = TiIpComponent.getGlbInfo(this.version).ipValueArray.concat();
        }
        else if (value === this.joinToIPValue(this.version, this.ipsValues)) {
            // 和当前IP框的值相同不处理
        }
        else if (this.isValidIP(this.version, value) || this.isInputting(this.version, value)) {
            super.writeValue(this.mask(this.version, value));
            this.ipsValues = this.splitToIPArray(this.version, this.model);
        }
        else {
            // 非法不处理 恢复之前值
            super.writeValue(this.joinToIPValue(this.version, this.ipsValues));
        }
    }
    // 实现ControlValueAccessor接口--end
    // 组件交互方法集合--start
    /**
     * @ignore
     */
    keydown(e, index) {
        const ipInputs = this.ipInputs;
        const keyCode = e.keyCode;
        this.keydownHandle(e, ipInputs['_results'][index], index, this.version);
        // 按下键为左或右键时，不做重新赋值，避免IE浏览器下重新赋值之后光标位置不准确问题
        if (keyCode === TiKeymap.KEY_ARROW_LEFT || keyCode === TiKeymap.KEY_ARROW_RIGHT) {
            return;
        }
    }
    /**
     * @ignore
     */
    input(e, index) {
        // 防止中文输入和非法字符的输入
        this.generateIPValue(index);
    }
    /**
     * @ignore
     */
    change(index) {
        const ipValues = this.generateIPValue(index);
        this.updateValue(ipValues);
    }
    // 组件交互方法集合--end
    // 内部公共方法集合--start
    /**
     * @description  将 ip 数组拼接成ip值
     * @param: ver ip版本
     * @param: arr ip字符串中数字组成的数组
     * @returns
     */
    joinToIPValue(ver, arr) {
        return arr.join(TiIpComponent.getGlbInfo(ver).separator);
    }
    /**
     * @description 将 ip 值分割成ip数组
     * @param: ver ip版本
     * @param: ip ip字符串
     */
    splitToIPArray(ver, ip) {
        const res = ip ? ip.split(TiIpComponent.getGlbInfo(ver).separator) : [];
        return res;
    }
    isInputting(ver, value) {
        const arr = this.splitToIPArray(ver, value);
        return arr.indexOf('') >= 0;
    }
    // 判断当前ip值是否合法
    isValidIP(ver, ip) {
        if (ip === null || ip === undefined) {
            return false;
        }
        const rgx = (ver === TiIpComponent.ipv4Version) ? TiIpComponent.ipv4Reg : TiIpComponent.ipv6Reg;
        return rgx.test(ip);
    }
    /**
     * @description IP需要去除前面的0，例如：,“012.12.23.002”经过该函数处理后变为：“12.12.23.2”；IPv6支持缩略格式
     * @param: ver ip版本
     * @param: ip ip字符串
     * @returns
     */
    mask(ver, ip) {
        const ipInfo = TiIpComponent.getGlbInfo(ver);
        const part = ip.split(ipInfo.separator);
        const partLength = part.length;
        if (ver === 4) {
            for (let i = 0; i < partLength; i++) {
                if (part[i] !== '') {
                    let partNumber = parseInt(part[i], 10);
                    // parseInt(part[i], 10) /= 1;
                    partNumber /= 1; // 将part[j]转化为整数，目的是消除前面的0
                    part[i] = String(partNumber); // 再转化为字符串
                }
            }
        }
        else {
            // IPv6支持缩略格式，即任何由全0组成的1个或多个16位段的单个连续的字符串 都可以用一个双冒号“::”，且“::”只出现一次；例如：2001:d02::14:95
            // 用‘0’补齐缩略格式缺少个数
            while (part.length < 8) {
                let index = part.indexOf('');
                part.splice(index, 0, '0');
            }
            part.forEach((partItem, index) => {
                //  查找是否有1-9和字母，如果没有，替换为0，如果有，去除前面的0
                if (partItem.match(/[1-9a-f]/i)) {
                    part[index] = partItem.replace(/^0{1,3}/i, '');
                }
                else if (partItem !== '0') {
                    part[index] = '0';
                }
            });
        }
        return part.join(ipInfo.separator);
    }
    /**
     * @description 去掉空格后的IP地址；例如“  12.12 .23.2  ”进过该函数处理后返回：“12.12.23.2”
     * @param: ver ip版本
     * @param: ip ip字符串
     */
    unmask(ver, ip) {
        const iPInfo = TiIpComponent.getGlbInfo(ver);
        return ip.replace(iPInfo.placeReg, '');
    }
    /**
     * @description  获取当前ip段输入的值并进行判断，合法时更新到当前ip段输入框内，并拼接返回整体ip值
     * @param: index 当前输入框的下标
     */
    generateIPValue(index) {
        const ipInfo = TiIpComponent.getGlbInfo(this.version);
        const cellArray = this.ipInputs;
        let value = cellArray['_results'][index].nativeElement.value;
        if (ipInfo.ipvCheckReg.test(value)) {
            value = value.replace(ipInfo.ipvCheckReg, '');
        }
        // ipv4下，当前输入框值大于255时，强制转换成255
        if (this.version === TiIpComponent.ipv4Version && value > 255) {
            value = 255;
        }
        for (let i = 0; i < this.ipsValues.length; i++) {
            if (i === index) {
                this.ipsValues[i] = value;
                cellArray['_results'][index].nativeElement.value = value;
            }
        }
        let ipValues;
        ipValues = this.ipsValues.join(ipInfo.separator);
        if (ipValues === ipInfo.label) {
            ipValues = '';
        }
        return ipValues;
    }
    // 更新value值 //TODO: Tiny3考虑去除这个函数，用writeValue代替
    updateValue(newValue) {
        if (newValue === this.model) {
            return;
        }
        // 记录ip的值在value中,方便用户获取
        this.model = newValue;
        this.writeValue(newValue);
    }
    // keydown事件触发时，判断并设置组件光标位置
    keydownHandle(e, thisInput, index, ver) {
        const ipInputsLength = this.ipInputs.length;
        const nextCell = index < ipInputsLength - 1 ?
            this.ipInputs['_results'][index + 1] : undefined;
        const prevCell = index > 0 ? this.ipInputs['_results'][index - 1] : undefined;
        const keyCode = e.keyCode;
        // 键盘码110代表. 190代表 >.---当键盘码为这两种时,跳至下一输入框中,并选中该输入框中的值
        if (keyCode === TiKeymap.KEY_NUMPAD_DECIMAL || keyCode === TiKeymap.KEY_PERIOD) {
            if (!Util.isUndefined(nextCell)) { // 非最后一个输入框时，跳至下一输入框
                nextCell.nativeElement.focus();
                nextCell.nativeElement.select();
            }
            e.preventDefault(); // 不论是否为最后一个输入框,防止默认事件发生,否则输入框中会出现 ...
            return;
        }
        // 光标后移到下一段ip
        if (this.isMoveToNext(e, thisInput, nextCell, ver)) {
            nextCell.nativeElement.focus();
            this.caret(nextCell, 0); // 设置光标位置
        }
        // 光标前移到上一段ip
        if (this.isMoveToPrevous(keyCode, thisInput, prevCell)) {
            this.caret(prevCell, prevCell.nativeElement.value.length); // 设置光标位置
            e.preventDefault(); // 防止默认事件发生,否则输入框中的回退光标位置会有问题
        }
    }
    // 判断当前是否需要将光标移至后一段ip
    isMoveToNext(e, thisInput, nextCell, ver) {
        // 如果下一段ip不存在直接返回false
        if (Util.isUndefined(nextCell)) {
            return false;
        }
        // 如果输入为合法数字,输入框中已有3个值,光标位于输入框末尾,并且存在下一输入框, 则跳至下一输入框
        let isFullToNext;
        if (ver !== TiIpComponent.ipv6Version) {
            isFullToNext = this.checkIpv4MoveToNext(thisInput, e);
        }
        else {
            isFullToNext = this.checkIpv6MoveToNext(thisInput, e);
        }
        // 当为向右键时→,且光标位置在该输入框末尾。则直接跳到下一输入框中
        const keyCode = e.keyCode;
        const isRightToNext = keyCode === TiKeymap.KEY_ARROW_RIGHT
            && this.caret(thisInput)[0] === thisInput.nativeElement.value.length;
        return isFullToNext || isRightToNext;
    }
    // 判断当前是否需要将光标移至前一段ip
    isMoveToPrevous(keyCode, thisInput, prevCell) {
        // 1.当为向左键(37),且光标位置位于输入框起始位置时,则跳至前一输入框中;
        // 2.当为backspace键,且已回删至输入框起始位置 跳至前已输入框中
        // 3.输入框处于选中状态时，按backspace键不跳到前一输入框中
        return !Util.isUndefined(prevCell) &&
            ((keyCode === TiKeymap.KEY_ARROW_LEFT && this.caret(thisInput)[0] === 0) // 按左键
                || (keyCode === TiKeymap.KEY_BACKSPACE && this.caret(thisInput)[0] === 0) // 按后退键并且删除完
                    && (this.caret(thisInput)[0] === this.caret(thisInput)[1])); // 输入框处于选中状态按后退键不跳到前一个输入框
    }
    // 判断当前段ipv4输入框是否已满3,末端是合法字符，且光标位置在此段ip最后
    checkIpv4MoveToNext(thisInput, e) {
        return (thisInput.nativeElement.value.length === 3) && (this.isNumeric(e)
            && (this.caret(thisInput)[0] === 3));
    }
    // 判断当前段ipv6输入框是否已满4未合法字符，且光标位置在此段ip最后
    checkIpv6MoveToNext(thisInput, e) {
        return (thisInput.nativeElement.value.length === 4) && (this.isHexaDecimal(e)
            && (this.caret(thisInput)[0] === 4));
    }
    // 判断输入是否为ipv4合法字符
    isNumeric(e) {
        if (e.shiftKey || e.ctrlKey) {
            return false;
        }
        const code = e.keyCode;
        return (code >= TiKeymap.KEY_0 && code <= TiKeymap.KEY_9) ||
            (code >= TiKeymap.KEY_NUMPAD_0 && code <= TiKeymap.KEY_NUMPAD_9);
    }
    // 判断输入是否为ipv6合法字符
    isHexaDecimal(e) {
        const keyCode = e.keyCode;
        // ctrl键组合其它情况，输入框中不会输入有效字符，返回
        if (e.ctrlKey) {
            return false;
        }
        // 输入有效字符情况：1）a~f 2）有效数字
        const isValidInput = (keyCode >= TiKeymap.KEY_A && keyCode <= TiKeymap.KEY_F)
            || (keyCode >= TiKeymap.KEY_NUMPAD_0 && keyCode <= TiKeymap.KEY_NUMPAD_9)
            || (keyCode >= TiKeymap.KEY_0 && keyCode <= TiKeymap.KEY_9);
        return isValidInput;
    }
    /**
     * @description  获取或设置光标位置
     * @param: ele 光标所在dom
     * @param: s 开始位置
     * @param: e 结束位置
     */
    caret(ele, s, e) {
        const element = ele.nativeElement;
        const setPosition = function (el, start, end) {
            if (el.setSelectionRange) {
                el.focus();
                el.setSelectionRange(start, end);
            }
            else if (el.createTextRange) {
                const range = el.createTextRange();
                range.collapse(true);
                range.moveEnd('character', end);
                range.moveStart('character', start);
                range.select();
            }
        };
        if (s != null && e != null) { // setting range
            return setPosition(element, s, e);
        }
        else if (s != null) { // setting position
            return setPosition(element, s, s);
        }
        // getting
        if (element.createTextRange && document['selection']) {
            const r = document['selection'].createRange().duplicate();
            const end = element.value.lastIndexOf(r.text) + r.text.length;
            r.moveEnd('character', element.value.length);
            const start = (r.text === '') ? element.value.length : element.value.lastIndexOf(r.text);
            return [start, end];
        }
        return [element.selectionStart, element.selectionEnd];
    }
    /**
     * @ignore
     * ngFor遍历的 trackBy函数，防止数据更新导致所有DOM重新渲染
     */
    trackByFn(index, item) {
        return index;
    }
}
// ipv4 配置参数
TiIpComponent.ipv4Version = 4;
// 采用华为自研的ipv4正则表达式
TiIpComponent.ipv4Reg = /^(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))$/i;
TiIpComponent.ipv4 = {
    ipvCheckReg: /[\D]/g,
    label: '...',
    placeReg: /\s/g,
    separator: '.',
    ipValueArray: new Array(4).fill('')
};
// ipv6 配置参数
TiIpComponent.ipv6Version = 6;
// 采用华为自研的ipv6正则表达式
TiIpComponent.ipv6Reg = /^(((([\da-f]{1,4}):){7}([\da-f]{1,4}))|(((([\da-f]{1,4}):){1,7}:)|((([\da-f]{1,4}):){6}:([\da-f]{1,4}))|((([\da-f]{1,4}):){5}:(([\da-f]{1,4}):)?([\da-f]{1,4}))|((([\da-f]{1,4}):){4}:(([\da-f]{1,4}):){0,2}([\da-f]{1,4}))|((([\da-f]{1,4}):){3}:(([\da-f]{1,4}):){0,3}([\da-f]{1,4}))|((([\da-f]{1,4}):){2}:(([\da-f]{1,4}):){0,4}([\da-f]{1,4}))|((([\da-f]{1,4}):){1}:(([\da-f]{1,4}):){0,5}([\da-f]{1,4}))|(::(([\da-f]{1,4}):){0,6}([\da-f]{1,4}))|(::([\da-f]{1,4})?))|(((([\da-f]{1,4}):){6}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){5}:(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){4}:(([\da-f]{1,4}):)?(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){3}:(([\da-f]{1,4}):){0,2}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){2}:(([\da-f]{1,4}):){0,3}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|(([\da-f]{1,4})::(([\da-f]{1,4}):){0,4}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|(::(([\da-f]{1,4}):){0,5}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))))$/i;
TiIpComponent.ipv6 = {
    ipvCheckReg: /[^a-f\d]/ig,
    label: ':::::::',
    placeReg: /\s/g,
    separator: ':',
    ipValueArray: new Array(8).fill('')
};
TiIpComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-ip',
                template: "<ng-container *ngFor=\"let ipsValue of ipsValues; index as i; trackBy: trackByFn\"><!--\r\n --><input #ipInput type=\"text\"\r\n           autocomplete=\"off\"\r\n           [ngClass]=\"version === 4 ? 'ti_input_ip_octet' : 'ti_input_ip_octet_v6'\"\r\n           class=\"ti_input_ip_anchor\"\r\n           [ngModel]=\"ipsValue\"\r\n           [id]=\"appendId(i)\"\r\n           (ngModelChange)=\"change(i)\"\r\n           (keydown)=\"keydown($event, i)\"\r\n           (input)=\"input($event, i)\"\r\n           [disabled]=\"disabled\"\r\n           noborder tiText\r\n           maxlength=\"{{version === 4 ? 3 : 4}}\"/><!--\r\n --><span class=\"ti_input_ip_division\"\r\n          *ngIf=\"i != (ipsValues.length - 1)\">{{version === 4 ? '.' : ':'}}</span><!--\r\n--></ng-container>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiIpComponent)],
                host: {
                    '[class.ti_input_ip_container_ipv4]': 'version !== 6',
                    '[class.ti_input_ip_container_ipv6]': 'version === 6',
                    '(paste)': 'pasteHandle($event)',
                    '(blur)': 'blurHandle($event)'
                },
                styles: ["::ng-deep :root{--ti-ip-division-width:3px}:host.ti_input_ip_container_ipv4{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block;height:var(--ti-input-height);transition:border-color .15s;width:160px}:host.ti_input_ip_container_ipv4.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv4.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv4.ng-invalid.ng-touched:not([tiBlurCheck]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv4.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti_input_ip_anchor{background-color:var(--ti-input-bg-color-error)}:host.ti_input_ip_container_ipv4 .ti_input_ip_anchor{height:calc(var(--ti-input-height) - 2px);padding:0;text-align:center;vertical-align:middle;width:calc((100% - var(--ti-ip-division-width)*3)/4)}:host.ti_input_ip_container_ipv4 .ti_input_ip_division{color:var(--ti-common-color-icon-normal);display:inline-block;font-family:Helvetica,Myriad,Arial,Microsoft Yahei,\"????\",SimSun,Tahoma;font-weight:700;width:var(--ti-ip-division-width)}:host.ti_input_ip_container_ipv4:hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}:host.ti_input_ip_container_ipv4[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ti_input_ip_container_ipv4[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled)}:host.ti_input_ip_container_ipv4[disabled] .ti_input_ip_division,:host.ti_input_ip_container_ipv4[disabled] .ti_input_ip_octet,:host.ti_input_ip_container_ipv4[disabled] .ti_input_ip_octet_v6{color:var(--ti-common-color-icon-disabled);cursor:not-allowed}:host.ti_input_ip_container_ipv6{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block;height:var(--ti-input-height);transition:border-color .15s;width:380px}:host.ti_input_ip_container_ipv6.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv6.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv6.ng-invalid.ng-touched:not([tiBlurCheck]) .ti_input_ip_anchor,:host.ti_input_ip_container_ipv6.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti_input_ip_anchor{background-color:var(--ti-input-bg-color-error)}:host.ti_input_ip_container_ipv6 .ti_input_ip_anchor{height:calc(var(--ti-input-height) - 2px);padding:0;text-align:center;vertical-align:middle;width:calc((100% - var(--ti-ip-division-width)*7 - 1px)/8)}:host.ti_input_ip_container_ipv6 .ti_input_ip_division{color:var(--ti-common-color-icon-normal);display:inline-block;font-family:Helvetica,Myriad,Arial,Microsoft Yahei,\"????\",SimSun,Tahoma;font-weight:700;width:var(--ti-ip-division-width)}:host.ti_input_ip_container_ipv6:hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}:host.ti_input_ip_container_ipv6[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ti_input_ip_container_ipv6[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled)}:host.ti_input_ip_container_ipv6[disabled] .ti_input_ip_division,:host.ti_input_ip_container_ipv6[disabled] .ti_input_ip_octet,:host.ti_input_ip_container_ipv6[disabled] .ti_input_ip_octet_v6{color:var(--ti-common-color-icon-disabled);cursor:not-allowed}"]
            },] }
];
TiIpComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiIpComponent.propDecorators = {
    version: [{ type: Input }],
    ipInputs: [{ type: ViewChildren, args: ['ipInput',] }]
};

class TiIpModule {
}
TiIpModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiTextModule
                ],
                exports: [TiIpComponent],
                declarations: [TiIpComponent]
            },] }
];

/**
 * Ipsection组件，Ip各网段分开处理，各网段有下拉类和输入类两种类型；
 *
 * 9.0.4新增
 *
 * <example-url>../tiny3demo/#/ipsection/ipsection-all</example-url>
 */
class TiIpsectionComponent extends TiFormComponent {
    constructor(hostRef, renderer2, fb) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.fb = fb;
        /**
         * @ignore
         * 存放 input 控件实例数组
         */
        this.controls = [];
        /**
         * @ignore
         * 格式化输入
         */
        this.maskInput = '000';
        /**
         * @ignore
         * 存放各网段 ip 值的数组
         */
        this.ipValues = [];
        this.formGroup = fb.group({});
    }
    /**
     * 将ip值分割为数组
     */
    static splitToIPArray(ipValue) {
        const ipArray = ipValue ? ipValue.replace(/\//, '.').split('.') : [];
        return ipArray;
    }
    /**
     * 将ip数组拼接为ip值
     */
    static joinToIPValue(ipArray) {
        let ipValue = ipArray.join('.');
        if (ipArray.length > 4) {
            ipValue = ipValue.replace(/(.*)\./, '$1/');
        }
        return ipValue;
    }
    ngOnInit() {
        super.ngOnInit();
        // 创建表单控件实例
        for (let i = 0; i < this.configs.length; i++) {
            if (!this.configs[i].options) {
                this.controls[i] = new FormControl();
                this.formGroup.addControl(`input_${i}`, this.controls[i]);
                // input类型网段值更改时触发事件
                this.controls[i].valueChanges.subscribe((value) => {
                    this.updateIpValue(i, value);
                });
            }
        }
    }
    ngAfterViewInit() {
        const itemElems = this.hostRef.nativeElement.getElementsByClassName('ti3-ipsection');
        const focusElements = [];
        // 设置可聚焦元素
        for (let i = 0; i < this.configs.length; i++) {
            if (itemElems[i].firstChild) {
                focusElements.push(itemElems[i].firstChild);
            }
            else {
                this.setAttr(itemElems[i], 'disabled', this.configs[i].disabled || this.disabled);
                focusElements.push(itemElems[i]);
            }
        }
        this.setFocusableElems(focusElements);
    }
    /**
     * @ignore
     * 获取model值，并进行初始化处理
     */
    writeValue(value) {
        super.writeValue(value);
        this.ipValues = TiIpsectionComponent.splitToIPArray(value);
        this.initIpValue();
    }
    /**
     * @ignore
     * 整体失焦触发事件
     */
    onBlur(event) {
        this.formatValue();
    }
    /**
     * @ignore
     * select类型网段值更改时触发事件
     */
    onChange(i, value) {
        this.updateIpValue(i, value);
    }
    /**
     * 初始化ip值
     */
    initIpValue() {
        for (let i = 0; i < this.configs.length; i++) {
            if (this.configs[i].options) {
                // 初始显示默认选中项，若value值在options存在，则显示该值，否则显示下拉配置项第一项
                this.configs[i].selected = this.configs[i].options.find(item => item === this.ipValues[i]) ? this.ipValues[i] : this.configs[i].options[0];
                this.updateIpValue(i, this.configs[i].selected);
            }
            else {
                // 初始设置value，disabled及校验规则
                this.ipValues[i] = this.ipValues[i] ? parseInt(this.ipValues[i], 10).toString() : '';
                this.controls[i].setValue(this.ipValues[i]);
                this.controls[i].setValidators(this.configs[i].validationRules);
                this.configs[i].disabled || this.disabled ? this.controls[i].disable() : this.controls[i].enable();
            }
        }
    }
    /**
     * 初始及失焦处理输入框值，清除Ip网段前面的0
     */
    formatValue() {
        for (let i = 0; i < this.configs.length; i++) {
            if (!this.configs[i].options) {
                this.controls[i].setValue(parseInt(this.controls[i].value, 10).toString());
            }
        }
    }
    /**
     * 更新model值
     */
    updateIpValue(index, value) {
        if (this.ipValues.length <= 0 || this.ipValues[index] === value) {
            return;
        }
        this.ipValues.splice(index, 1, value);
        const ipValue = TiIpsectionComponent.joinToIPValue(this.ipValues);
        this.model = (ipValue === '...' || ipValue === '.../') ? '' : ipValue;
        return ipValue;
    }
}
TiIpsectionComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-ipsection',
                template: "<ng-container *ngFor=\"let config of configs; index as i; let last=last\">\r\n    <ng-container *ngIf=\"!config.options; else selectTemplate\" >\r\n        <form [formGroup]='formGroup' style=\"display:inline-block\">\r\n            <input autocomplete=\"off\"\r\n                [id]=\"appendId('input_' + config.section)\"\r\n                [tiMask]=\"maskInput\"\r\n                class=\"ti3-ipsection ti3-ipsection-input\"\r\n                [ngClass]=\"{'ti3-ipsection-text-blod': config.bold}\"\r\n                formControlName=\"{{'input_' + i}}\"\r\n                tiText [tiValidation]=\"config.validation\"/>\r\n        </form>\r\n    </ng-container>\r\n    <ng-template #selectTemplate>\r\n        <ti-select class=\"ti3-ipsection ti3-ipsection-select\"\r\n                   [id]=\"appendId('select_' + config.section)\"\r\n                   [options]='config.options'\r\n                   [(ngModel)]=\"config.selected\"\r\n                   (ngModelChange)=\"onChange(i, $event)\"\r\n                   [disabled]=\"config.disabled || disabled\">\r\n                   <ng-template let-option>{{option}}</ng-template>\r\n        </ti-select>\r\n    </ng-template>\r\n    <section *ngIf=\"!last\"\r\n              class=\"ti3-ipsection-division\"\r\n              [ngClass]=\"{'ti3-ipsection-dot': i < 3,\r\n                          'ti3-ipsection-maskdivision': i===3,\r\n                          'ti3-ipsection-division-disabled': disabled}\"></section>\r\n</ng-container>\r\n",
                host: {
                    '[class.ti3-ipsection-container]': 'true',
                    '(blur)': 'onBlur($event)'
                },
                providers: [TiFormComponent.getValueAccessor(TiIpsectionComponent)],
                styles: ["::ng-deep :root{--ti-ipsection-dot-size:2px}:host.ti3-ipsection-container{display:inline-block}.ti3-ipsection-input{text-align:center;width:50px}.ti3-ipsection-select{width:70px}.ti3-ipsection-text-blod{font-weight:700}.ti3-ipsection-division{background:var(--ti-common-color-icon-normal);display:inline-block;vertical-align:middle}.ti3-ipsection-dot{-ms-box-sizing:border-box;border-radius:50%;box-sizing:border-box;height:var(--ti-ipsection-dot-size);margin:0 var(--ti-common-space-2x);width:var(--ti-ipsection-dot-size)}.ti3-ipsection-maskdivision{height:1px;transform:rotate(110deg);width:18px}.ti3-ipsection-division-disabled{background:var(--ti-common-color-icon-disabled)}"]
            },] }
];
TiIpsectionComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: FormBuilder }
];
TiIpsectionComponent.propDecorators = {
    configs: [{ type: Input }]
};

/**
 * Select选择下拉组件
 *
 * 支持单选/多选，分组，搜索，懒加载。
 *
 * 单选主要功能为从一个数据集合中选择某一条数据，单选与RadioGroup功能相同，只是视觉呈现不同。
 *
 * 多选主要功能是从一个数据集合中任意选择多条数据，与checkboxGroup功能相同，只是视觉呈现不同。
 *
 * <example-url>../tiny3demo/#/select/select-all</example-url>
 */
class TiSelectComponent extends TiWholeComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * dominator 到drop的距离
         */
        this.dominatorSpace = TiDropComponent.DOMINATOR_SPACE + 'px';
        /**
         * 是否多选
         */
        this.multiple = false;
        /**
         * 多选时, 选中项显示几行
         *
         * 版本 v9.0.4 添加
         */
        this.maxLine = 2;
        /**
         * 选中项文本超出时tip展开方向
         *
         * 9.0.3 新增
         */
        this.selectedTipPosition = 'auto';
        /**
         * 预留文本
         */
        this.placeholder = '';
        // 面板配置
        /**
         * 下拉面板的最大显示宽度，该变量与下拉类组件保持一致
         *
         * 1."justified"(默认): 下拉框的宽度与Select组件的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉选项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于Select组件的宽度)。例如："200px"
         */
        this.panelWidth = 'justified'; // TODO: 确认类型
        /**
         * 无数据时的显示文本
         */
        this.noDataText = '...';
        /**
         * 要显示的字段
         */
        this.labelKey = 'label';
        // 其他配置
        /**
         * 是否显示搜索框
         */
        this.searchable = false;
        /**
         * @ignore
         * 大小样式
         */
        this.size = 'default';
        /**
         * 文字超长显示...，hover时tip弹出方向
         */
        this.tipPosition = 'right';
        /**
         * 单选下拉选择框是否开启清除已选项功能
         *
         * 3.0.8新增
         */
        this.clearable = false;
        /**
         * 多选下拉选择框是否开启全选功能
         *
         * 3.1.2新增
         */
        this.selectAll = false;
        /**
         * 设置是否显示已选项的个数，默认不显示，multiple为true时生效
         *
         * 10.1.0新增
         */
        this.showSelectedNumber = false;
        /**
         * 用户想要打开面板的通知事件，一般用于数据懒加载。使用方式，见懒加载示例
         */
        this.beforeOpen = new EventEmitter();
        // 3.0.2增加select接口
        /**
         * 多选选中/取消选中事件，向外通知option数据，需要自行判断option数据是否选中。
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        /**
         * 当单选下拉选择框开启清除已选项功能时，点击清除按钮时触发
         *
         * 3.0.8新增
         */
        this.clear = new EventEmitter();
        /**
         * @ignore
         * 10.0.2新增
         *
         * 后台搜索，传出搜索框的值
         */
        this.beforeSearch = new EventEmitter();
        this.oldSearchable = null;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        if (this.beforeSearch.observers.length !== 0) {
            this.dropsearchCom.hasBeforeSearchObservers = true;
        }
    }
    /**
     * 兼容旧版：
     * 3.1.2版select只能内嵌一个模板，无命名。
     * 新版可以内嵌四个模板，示例书写要求都命名。
     * 但需要兼容旧版无命名测试用例。
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果item模板为空，那么把第一个出现的无标签（无footer等标签）模板作为item
        if (!this.itemTemplate && this.firstTemplate) {
            const firstTemplateEle = this.firstTemplate.elementRef.nativeElement;
            if (firstTemplateEle !== (this.selectedTemplate && this.selectedTemplate.elementRef.nativeElement)
                && firstTemplateEle !== (this.placeholderTemplate && this.placeholderTemplate.elementRef.nativeElement)
                && firstTemplateEle !== (this.footerTemplate && this.footerTemplate.elementRef.nativeElement)) {
                this.itemTemplate = this.firstTemplate;
            }
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewChecked() {
        // 要支持searchable的动态变更，所以ngAfterViewChecked才能获知搜索框节点。
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.dropsearchCom.getFocusableElems()));
            }
            else {
                this.setFocusableElems(this.dominatorCom.getFocusableElems());
            }
        }
        if (this.pagination && this.pagination.updateFocusableElems) {
            this.setFocusableElems(this.dominatorCom.getFocusableElems()
                .concat(this.dropsearchCom.getFocusableElems()));
            this.pagination.updateFocusableElems = false;
        }
        // 上面设置好focusElems后，调用父类逻辑afterViewChecked才去设置autofocs
        super.ngAfterViewChecked();
    }
    /**
     * 切换面板开合状态
     */
    toggle() {
        if (!this.dropsearchCom.isShow) { // 面板关闭时
            this.wantOpen();
        }
        else { // 面板开时
            this.close();
        }
    }
    /**
     * 打开面板
     */
    open() {
        this.dropsearchCom.show();
    }
    /**
     * 闭合面板
     */
    close() {
        this.dropsearchCom.hide();
    }
    /**
     * @ignore
     * 处理点击Dominator事件
     */
    onClickDominator() {
        if (this.disabled) {
            return;
        }
        this.toggle();
    }
    /**
     * @ignore
     * ti-select键盘事件处理：回车/空格情况下，展开面板
     * @param event 按键事件
     * @returns void
     */
    onKeydown(event) {
        if (this.disabled || this.dropsearchCom.isShow) {
            return;
        }
        const enterKeyCodeArr = [TiKeymap.KEY_SPACE, TiKeymap.KEY_ENTER, TiKeymap.KEY_NUMPAD_ENTER];
        if (enterKeyCodeArr.includes(event.keyCode)) {
            this.wantOpen();
            // 如果响应了按键，那么不再冒泡
            event.stopPropagation();
        }
    }
    /**
     * @ignore
     * 失焦情况下，仅关闭面板，不做聚焦等处理
     */
    onBlur() {
        this.dropsearchCom.hideWithoutFocus();
    }
    /**
     *  点击或者toggle()，触发想要打开面板
     */
    wantOpen() {
        if (this.beforeOpen.observers.length === 0) { // 无beforeOpen懒加载，直接打开
            this.open();
        }
        else { // 有beforeOpen懒加载，发出事件
            this.beforeOpen.emit(this);
        }
    }
    /**
     * @ignore
     * 多选带searchbox场景下，dominator中元素删除时，需要聚焦于searchbox
     */
    onDeleteDominator() {
        if (this.dropsearchCom.isShow) {
            this.dropsearchCom.focus();
        }
    }
    /**
     * @ignore
     * 触发select事件
     */
    onSelect(option) {
        this.select.emit(option);
        if (this.multiple) {
            return;
        }
    }
    /**
     * @ignore
     * 单选点击清除按钮时触发clear事件, 如果下拉中有搜索,则需要聚焦于searchbox。
     */
    onClearDominator() {
        if (this.multiple || !this.clearable) {
            return;
        }
        this.clear.emit();
        if (this.searchable && this.dropsearchCom.isShow) {
            this.dropsearchCom.focus();
        }
    }
    /**
     * @ignore
     */
    onBeforeSearch() {
        this.beforeSearch.emit(this);
    }
    /**
     * @ignore
     * 10.0.2新增
     *
     * 获取可搜索场景下，搜索框的内容
     * @returns 搜索框的内容
     */
    getSearchWord() {
        return this.dropsearchCom.searchWord;
    }
    /**
     * @ignore
     * 10.0.2新增
     *
     * 设置搜索结果
     * @params 业务搜索后的结果，组件不再进行数据处理
     */
    setSearchResult(searchResult) {
        this.dropsearchCom.setSearchResult(searchResult);
    }
}
TiSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-select',
                template: "<ti-dominator\r\n        [dropshow]='dropsearchCom.dropCom.isShow'\r\n        [multiple]=\"multiple\"\r\n        [maxLine]=\"maxLine\"\r\n        [placeholder]='placeholder'\r\n        [selectedTipPosition]='selectedTipPosition'\r\n        [showSelectedNumber]='showSelectedNumber'\r\n        [(ngModel)]=\"modelWhole\"\r\n        [disabled]=\"disabled\"\r\n        [clearable]=\"!multiple && clearable\"\r\n        (click)=\"onClickDominator()\"\r\n        [id]=\"appendId('dominator')\"\r\n        (delete)=\"onDeleteDominator()\"\r\n        (clear)=\"onClearDominator()\">\r\n        <ng-template #selected let-item>\r\n               <ng-container *ngTemplateOutlet=\"selectedTemplate?selectedTemplate:itemTemplate?itemTemplate:defaultItemTemplate; context: {$implicit: item}\"></ng-container>\r\n        </ng-template>\r\n        <ng-template #placeholder *ngIf=\"placeholderTemplate\">\r\n                <ng-container *ngTemplateOutlet=\"placeholderTemplate\"></ng-container>\r\n        </ng-template>\r\n</ti-dominator>\r\n<ti-dropsearch [multiple]=\"multiple\" [searchable]=\"searchable\" [searchKeys]=\"searchKeys\"\r\n        [selectAll]=\"selectAll\" [labelKey]=\"labelKey\" [options]=\"options\"\r\n        [noDataText]=\"noDataText\" [dominatorSpace]=\"dominatorSpace\"\r\n        [(ngModel)]=\"modelWhole\" [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        [panelWidth]=\"panelWidth\" [panelMaxHeight]=\"panelMaxHeight\"\r\n        [size]=\"size\" [tipPosition]=\"tipPosition\" [id]=\"appendId('droplist')\"\r\n        (select)=\"onSelect($event)\"\r\n        (beforeSearch)=\"onBeforeSearch()\" >\r\n        <ng-template #item let-item let-i=index>\r\n               <ng-container *ngTemplateOutlet=\"itemTemplate?itemTemplate:defaultItemTemplate; context: {$implicit: item, index: i}\"></ng-container>\r\n        </ng-template>\r\n        <ng-template #footer>\r\n                <ng-container *ngTemplateOutlet=\"footerTemplate?footerTemplate:defaultFooterTemplate;\"></ng-container>\r\n        </ng-template>\r\n</ti-dropsearch>\r\n\r\n<ng-template #defaultItemTemplate let-item let-i=index><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n\r\n<ng-template #defaultFooterTemplate>\r\n</ng-template>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiSelectComponent)],
                host: {
                    '[class.ti3-select-small]': 'size === "small"',
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}:host{width:200px}:host[noborder],:host[noborder]:hover,:host[noborder][tiFocused]{border-color:var(--ti-input-bg-color)}:host[noborder][disabled]{border-color:var(--ti-input-bg-color-disabled)}:host[dark]{background-color:transparent}:host[dark],:host[dark]:hover,:host[dark][disabled],:host[dark][tiFocused]{border-color:transparent}:host[dark] ::ng-deep .ti3-select-dominator-text{color:var(--ti-common-color-text-white)}:host[dark] ::ng-deep .ti3-select-dominator-dropdown-btn:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--ti-common-color-icon-white);height:0;width:0}", "::ng-deep .ti3-select-small .ti3-select-dominator-text{width:calc(100% - var(--ti-select-small-height) + 2px)!important}::ng-deep .ti3-select-small .ti3-overflow-padding{padding-left:var(--ti-select-small-dominator-text-left-padding)!important;padding-right:0!important}::ng-deep .ti3-select-small .ti3-select-dominator-container{height:var(--ti-select-small-height)!important;line-height:calc(var(--ti-select-small-height) - 2px)!important}::ng-deep .ti3-select-small .ti3-select-dominator-dropdown-btn{width:calc(var(--ti-select-small-height) - 4px)!important}::ng-deep .ti3-select-small .ti3-select-dominator-dropdown-btn:after{right:var(--ti-select-small-triangle-position-right)!important;top:calc((100% - 5px)/2)!important}"]
            },] }
];
TiSelectComponent.propDecorators = {
    dominatorSpace: [{ type: Input }],
    multiple: [{ type: Input }],
    maxLine: [{ type: Input }],
    selectedTipPosition: [{ type: Input }],
    placeholder: [{ type: Input }],
    panelWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    noDataText: [{ type: Input }],
    options: [{ type: Input }],
    labelKey: [{ type: Input }],
    searchKeys: [{ type: Input }],
    searchable: [{ type: Input }],
    size: [{ type: Input }],
    tipPosition: [{ type: Input }],
    clearable: [{ type: Input }],
    selectAll: [{ type: Input }],
    showSelectedNumber: [{ type: Input }],
    beforeOpen: [{ type: Output }],
    select: [{ type: Output }],
    clear: [{ type: Output }],
    beforeSearch: [{ type: Output }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    selectedTemplate: [{ type: ContentChild, args: ['selected', /* TODO: add static flag */ { static: true },] }],
    placeholderTemplate: [{ type: ContentChild, args: ['placeholder', /* TODO: add static flag */ { static: true },] }],
    footerTemplate: [{ type: ContentChild, args: ['footer', /* TODO: add static flag */ { static: true },] }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, /* TODO: add static flag */ { static: true },] }],
    dropsearchCom: [{ type: ViewChild, args: [TiDropsearchComponent, { static: true },] }],
    onKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};

class TiSelectModule {
}
TiSelectModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDominatorModule,
                    TiDropModule,
                    TiDropsearchModule
                ],
                exports: [TiSelectComponent],
                declarations: [TiSelectComponent]
            },] }
];

/**
 * TiMask 格式化数字指令
 *
 * 该指令主要用于输入框中，限制用户只能输入数字，可以通过设置tiMask属性接口设置其数字的格式：身份证，手机号码等形式输入。
 *
 * 输入框中呈现的是格式化后的数字，但是通过ngModel取得的值为纯数字的值，如输入框中呈现的值为'123 456 789'，通过ngModel取得的值为'123456789'
 *
 * <example-url>../tiny3demo/#/maskinput/maskinput-all</example-url>
 */
class TiMaskDirective extends DefaultValueAccessor {
    constructor(renderer, elementRef) {
        // super中第三个参数是DefaultValueAccessor中对文本段落(例如中文)输入的处理的一个标志位,
        // 表示是否为非安卓系统，在PC端此参数为true。后续如果要处理移动端，则可能需要动态根据此参数对
        // 文本段落(例如中文)输入做处理。
        super(renderer, elementRef, true);
        this.renderer = renderer;
        this.elementRef = elementRef;
        /**
         * 设置其数字的格式：身份证，手机号码等形式输入，例如手机号格式：'000 0000 0000'，
         * 其中 '0' 代表数字。
         */
        this.format = '000 0000 0000';
        this.composing = false; // 是否正在拼写拼音
        this.element = this.elementRef.nativeElement;
    }
    // 获取在format范围内的有效字符串
    static getClearValue(value, format) {
        const formatNumLen = format.replace(/[^0]/g, '').length;
        let clearValue = value.replace(/\D/g, '');
        clearValue = clearValue.slice(0, formatNumLen);
        return clearValue;
    }
    static formatValue(value, format) {
        if (!value) {
            return '';
        }
        const clearValue = TiMaskDirective.getClearValue(value, format);
        const clearValueLen = clearValue.length; // value长度
        let valueCharPosOffset = 0; // value字符位置增量
        let valueCharPos; // 循环中的value字符位置
        let newValue = '';
        let formatChar;
        for (let i = 0, len = format.length; i < len; i++) {
            valueCharPos = i - valueCharPosOffset;
            if (valueCharPos >= clearValueLen) { // value内容循环完成情况下,不进行处理
                break;
            }
            formatChar = format[i];
            if (formatChar === TiMaskDirective.NUM_SIGN) { // format字符为数字情况下的处理
                newValue += clearValue[valueCharPos];
            }
            else {
                // format字符非数字情况下的处理,此时value字段中增加format字符
                valueCharPosOffset++;
                newValue += formatChar;
            }
        }
        return newValue;
    }
    // model => view
    /**
     * @ignore
     */
    writeValue(value) {
        // 使用ngModel时，初始赋值第一次传入的value为null
        if (value === null) {
            return;
        }
        // format modelValue
        const formatValue = TiMaskDirective.formatValue(value, this.format);
        // Write formatted modelValue to view
        super.writeValue(formatValue);
        // 格式化后也需要通知修改模型值
        this.modelValue = this.getAntiFormatValue(formatValue);
        if (this.modelValue !== value) {
            if (Util.isUndefined(this.onChangeFn)) {
                // 在reactive-form中使用，初始化赋值调用writeValue时，
                // 此时registerOnChange还未被调用，onChangeFn还未被赋值，
                // 所以要使用setTimeout等onChangeFn被赋值后再调用
                setTimeout(() => {
                    this.onChangeFn(this.modelValue);
                }, 0);
            }
            else {
                this.onChangeFn(this.modelValue);
            }
        }
    }
    /**
     * @ignore
     */
    registerOnChange(fn) { this.onChangeFn = fn; }
    /**
     * @ignore
     * view => model
     */
    handleInput(value) {
        if (!this.composing) {
            // 在parser()中对view值进行格式化处理，再重写view的值；
            this.parser(value);
        }
    }
    /**
     * @ignore
     * 中文输入之前(在输入拼音前)
     */
    handleCompositionStart() {
        // 在IE和FF下中文输入法下，输入拼音时不会触发input事件，
        // 但是在Chrome下，输入拼音时会触发input事件，所以针对Chrome要做特殊处理，
        // 使其在输入拼音时不做格式化处理
        if (TiBrowser.isChrome()) {
            this.composing = true;
        }
    }
    /**
     * @ignore
     * 文本段完成输入或取消输入
     */
    handleCompositionEnd(value) {
        if (TiBrowser.isChrome()) {
            this.composing = false;
            // 在Chrome下compositionend比input执行滞后，
            this.parser(value);
        }
    }
    /**
     * @ignore
     */
    blur() {
        // 此处的onTouched继承于DefaultValueAccessor
        this.onTouched();
    }
    parser(value) {
        const formattedValue = TiMaskDirective.formatValue(value, this.format);
        this.setCtxPos(value, this.format);
        const ctxPos = this.ctxPos;
        // 设置viewValue及光标位置
        if (value !== formattedValue) {
            this.renderer.setProperty(this.element, 'value', formattedValue);
            // 设置光标位置：value非法及输入数字后需要变换位置情况下，需要设置光标位置
            if (this.element === document.activeElement) {
                this.element.setSelectionRange(ctxPos, ctxPos);
            }
        }
        const modelValue = this.getAntiFormatValue(formattedValue);
        if (modelValue !== this.modelValue) {
            this.onChangeFn(modelValue);
            this.modelValue = modelValue;
        }
    }
    // 获取反格式化后的value
    getAntiFormatValue(formattedValue) {
        return formattedValue.replace(/\D/g, '');
    }
    setCtxPos(value, format) {
        // 元素有光标情况下，设置元素光标位置
        this.initCtxPos();
        if (!value) {
            return;
        }
        // value非空情况下的处理
        this.valueCharPosOffset = 0; // value字符位置增量
        const ctxPos = this.ctxPos; // 初始化ctxPos，后续循环中会以此为光标位置作为对比值
        for (let i = 0, len = format.length; i < len; i++) {
            if (i - this.valueCharPosOffset >= value.length) { // value字符循环完成情况下,不进行后续处理
                break;
            }
            this.setCharPos(i, value, format, ctxPos);
        }
    }
    setCharPos(pos, value, format, ctxPos) {
        const valueCharPos = pos - this.valueCharPosOffset; // 循环中的value字符位置
        const valueChar = value[valueCharPos]; // 当前value字符
        const formatChar = format[pos]; // 当前format字符
        if (formatChar === TiMaskDirective.NUM_SIGN) { // format为数字情况下的处理
            this.setPosWithNum(value, valueChar, valueCharPos, ctxPos);
        }
        else { // format非数字情况处理
            this.setPosWithoutNum(valueChar, valueCharPos, formatChar, ctxPos);
        }
    }
    setPosWithNum(value, valueChar, valueCharPos, ctxPos) {
        if (valueChar.match(/\d/)) { // value字符相匹配情况下,不做处理
            return;
        }
        // value字符不匹配情况下,光标前移，直到找到下一个数字为止
        let valueCharNew;
        for (let j = valueCharPos, valueLen = value.length; j < valueLen; j++) {
            valueCharNew = value[j];
            if (valueCharNew.match(/\d/)) { // 找到value字符为数字的情况下，结束循环
                return;
            }
            // 找到value字符非数字情况下，过滤掉该字符，光标前移，value偏移量后移，下次循环跳过该字符的检索
            if (ctxPos && ctxPos >= j + 1) {
                this.ctxPos--;
            }
            this.valueCharPosOffset--;
        }
    }
    setPosWithoutNum(valueChar, valueCharPos, formatChar, ctxPos) {
        // value为数字情况下,value偏移量前移,确保下次循环依然为该value字符
        if (valueChar.match(/\d/)) {
            this.valueCharPosOffset++;
            if (ctxPos && ctxPos >= valueCharPos + 1) {
                this.ctxPos++;
            }
            return;
        }
        // value非数字且不匹配format字符情况下,过滤掉该字符,下次继续循环下个value字符
        if ((valueChar !== formatChar) &&
            (ctxPos && ctxPos >= valueCharPos + 1)) {
            this.ctxPos--;
        }
    }
    initCtxPos() {
        let ctxPositon;
        if (this.element === document.activeElement) {
            ctxPositon = this.element.selectionStart;
        }
        this.ctxPos = ctxPositon;
    }
}
TiMaskDirective.NUM_SIGN = '0';
TiMaskDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiMask]',
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        // tslint:disable-next-line:no-forward-ref
                        useExisting: forwardRef(() => TiMaskDirective),
                        multi: true
                    }
                ],
                host: {
                    '(input)': 'handleInput($event.target.value)',
                    '(compositionstart)': 'handleCompositionStart()',
                    '(compositionend)': 'handleCompositionEnd($event.target.value)',
                    '(blur)': 'blur()'
                }
            },] }
];
TiMaskDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
TiMaskDirective.propDecorators = {
    format: [{ type: Input, args: ['tiMask',] }]
};

class TiMaskModule {
}
TiMaskModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiMaskDirective],
                declarations: [TiMaskDirective]
            },] }
];

/**
 * @ignore
 */
class CheckHandle {
    constructor(validationConf, commonHandle) {
        this.validationConf = validationConf;
        this.commonHandle = commonHandle;
    }
    onStatusChange(ele, formControl) {
    }
    onFocus(ele, formControl) {
    }
    onBlur(ele, formControl) {
    }
    destroy(ele) {
        this.commonHandle.destroyTip(ele);
    }
}

/**
 * @ignore
 */
class TiPendingStateComponent extends TiBaseComponent {
    ngOnInit() {
        this.renderer.addClass(this.validElement, 'ti3-text-input-show-pending');
    }
    ngOnDestroy() {
        if (this.validElement) {
            this.renderer.removeClass(this.validElement, 'ti3-text-input-show-pending');
        }
    }
}
TiPendingStateComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-pending-state',
                template: "<ti-loading class=\"ti3-validation-pending-loading\"></ti-loading>",
                host: {
                    '[class.ti3-validation-pending-container]': 'true'
                },
                styles: [":host.ti3-validation-pending-container{display:inline-block;height:var(--ti-input-height);position:relative;vertical-align:top;width:0}.ti3-validation-pending-loading{left:-22px;position:absolute;top:calc((var(--ti-input-height) - 14px)/2)}::ng-deep [tiText].ti3-text-input-show-clear+.ti3-validation-pending-container .ti3-validation-pending-loading{left:-38px}::ng-deep [tiText].ti3-text-input-show-pending{padding-right:32px!important}::ng-deep [tiText].ti3-text-input-show-pending.ti3-text-input-show-clear{padding-right:48px!important}"]
            },] }
];
TiPendingStateComponent.propDecorators = {
    validElement: [{ type: Input }]
};

/**
 * @ignore
 *
 * 10.1.0新增
 */
class AsyncCheck extends CheckHandle {
    // 处理异步校验错误提示信息
    onStatusChange(ele, formControl) {
        // 清除先前校验信息
        this.commonHandle.clearValidMsg(ele);
        const errors = formControl.control.errors;
        if (!errors) {
            return;
        }
        const ruleKey = Object.keys(errors)[0];
        const ruleErrors = errors[ruleKey];
        // 添加异步校验错误提示信息
        if (typeof ruleErrors === 'object' && Util.isString(ruleErrors.tiAsyncErrorMessage)) {
            this.commonHandle.addValidMsg(ele, this.validationConf, formControl, true);
        }
    }
    // 处理异步校验pending状态时的loading图标
    onAsyncStatusChange(ele, formControl) {
        if (formControl.pending) {
            this.addPendingIcon(ele, formControl);
        }
        else {
            this.clearPendingIcon(ele);
        }
    }
    addPendingIcon(ele, formControl) {
        if (ele.nativeElement.tiPendingStateRef) {
            return;
        }
        const pendingStateRef = this.getPendingStateRef(ele);
        const pendingDom = pendingStateRef.location.nativeElement;
        if (pendingDom === null || pendingDom.childNodes.length === 0) {
            return;
        }
        this.commonHandle._tiRenderer.insertAfter(pendingDom, ele.nativeElement);
        ele.nativeElement.tiPendingStateRef = pendingStateRef;
    }
    clearPendingIcon(ele) {
        const pendingStateRef = ele.nativeElement.tiPendingStateRef;
        if (pendingStateRef) {
            pendingStateRef.destroy();
            ele.nativeElement.tiPendingStateRef = undefined;
        }
    }
    getPendingStateRef(ele) {
        const pendignComponentRef = this.commonHandle._tiPopupService.createCompoentRef({
            componentType: TiPendingStateComponent,
            context: {
                validElement: ele.nativeElement
            }
        });
        return pendignComponentRef;
    }
}

/**
 * @ignore
 */
class ChangeCheck extends AsyncCheck {
    onStatusChange(ele, formControl) {
        super.onStatusChange(ele, formControl);
        this._checkHandle(ele, this.validationConf, formControl);
    }
    onFocus(ele, formControl) {
        this._checkHandle(ele, this.validationConf, formControl);
    }
    onBlur(ele, formControl) {
        // 清除先前校验信息,已失焦情况不做校验提示或tip提示,只边框标红,边框标红在样式类中通过ng-invalid处理
        this.commonHandle.destroyTip(ele);
    }
    // 校验处理函数,该函数覆盖了focus和statusChange状态下的校验处理
    _checkHandle(ele, validationConf, formControl) {
        this.commonHandle.destroyTip(ele); // 清除先前校验信息
        // 已失焦情况不做校验提示或tip提示,只边框标红,边框标红只在样式类中通过ng-invalid处理,JS中无需处理
        if (!this.commonHandle.isFocused(ele)) {
            return;
        }
        // 三种情况只做Tip提示：
        // 1.初次focus且初次focus情况下输入值未发生改变时不进行校验
        //   (初次focus值一旦发生变化且出错情况下,就要改变为错误提示)
        // 2.校验正确
        // 3.是弹窗中autofocus的元素
        // （弹窗中autofocus的元素，在弹窗打开动画结束后会先blur再focus,会使其由untouched变成touched,
        // 但需要使其表现与初次focus一致）
        const errors = formControl.control.errors;
        if ((formControl.pristine && formControl.untouched) || errors === null ||
            ele.nativeElement.querySelector('[tiautofocusinmodal]')) {
            this._addTip(ele, validationConf, validationConf && validationConf.tip);
            return;
        }
        // 其它情况下做错误提示
        this._addValidTip(ele, errors, validationConf);
    }
    // 显示错误提示信息
    _addValidTip(ele, errors, validationConf) {
        const tipContentDom = this.commonHandle.getErrorMsg(errors, validationConf);
        if (tipContentDom === null) { // 无错误信息情况下,不做处理
            return;
        }
        this._addTip(ele, validationConf, tipContentDom);
    }
    // 显示tip提示
    _addTip(ele, validationConf, tipContent) {
        // tip内容无效情况下不做处理
        if (tipContent === '' || Util.isUndefined(tipContent)) {
            return;
        }
        // 添加Tip提示
        this.commonHandle.generateTip(ele, tipContent, validationConf);
    }
}

/**
 * @ignore
 */
class BlurCheck extends CheckHandle {
    onStatusChange(ele, formControl) {
        if (this.commonHandle.isFocused(ele)) { // 获取焦点/正在输入情况下,显示/修改tip提示
            this.addTip(ele, this.validationConf, formControl);
            return;
        }
        // 未输入过且未聚焦的情况下,先清除先前校验信息(存在reset即改变untounced状态情况下清除校验信息)
        if (formControl.untouched) {
            this.commonHandle.clearValidMsg(ele); // 清除先前校验信息
            return;
        }
        // 失焦情况下,根据校验结果,显示/清除错误提示
        this.commonHandle.clearValidMsg(ele); // 清除先前校验信息
        this.commonHandle.addValidMsg(ele, this.validationConf, formControl);
    }
    onFocus(ele, formControl) {
        this.commonHandle.clearValidMsg(ele); // 清除先前错误提示信息
        this.addTip(ele, this.validationConf, formControl);
    }
    onBlur(ele, formControl) {
        this.commonHandle.destroyTip(ele); // 清除先前校验信息
        this.commonHandle.addValidMsg(ele, this.validationConf, formControl);
    }
    addTip(ele, validationConf, formControl) {
        this.commonHandle.destroyTip(ele); // 清除先前tip提示信息
        const tipContent = validationConf && validationConf.tip;
        // tip内容无效情况下不做处理
        if (tipContent === '' || Util.isUndefined(tipContent)) {
            return;
        }
        // 添加Tip提示并缓存
        this.commonHandle.generateTip(ele, tipContent, validationConf);
    }
}

/**
 * @ignore
 */
class TiPwdMsgComponent {
    constructor() {
        this.msgModel = {
            level: -1,
            msgItems: [],
            securityText: '',
            securityStatus: ''
        };
    }
    static _getPwdStrengthLan(key) {
        return TiLocale.getLocaleWords().tiValid.passwordStrength[key];
    }
    // 获取各项规则提示
    static _getMsgItems(msgObj, control) {
        let validStatus;
        if (control.untouched && control.pristine) { // 初次聚焦,未输入情况下，不校验
            validStatus = -1;
        }
        const msgInfoArr = [];
        let msgItem = '';
        for (const key in msgObj) {
            if (msgObj.hasOwnProperty(key)) {
                msgItem = msgObj[key];
                msgInfoArr.push({
                    msg: msgItem,
                    validStatus: TiPwdMsgComponent._getValidStatus(validStatus, key, control)
                });
            }
        }
        return msgInfoArr;
    }
    static _getValidStatus(validStatus, key, control) {
        const errors = control.errors;
        // validStatus已定义情况下，直接返回
        if (!Util.isUndefined(validStatus)) {
            return validStatus;
        }
        // errors中有该条消息，说明校验未通过
        if (errors && !Util.isUndefined(errors[key])) {
            return false;
        }
        // 值为空的情况下，除notEqualPosRev外，其他规则均为错误
        if (control.value === '' && key !== 'notEqualPosRev') {
            return false;
        }
        return true;
    }
    /**
     * 获取密码强度等级
     * @param value 输入值
     * @param validator 校验规则配置
     * @param levelFn 密码等级计算函数
     * @returns  密码强度等级
     */
    static _getLevel(value, validator, levelFn) {
        return levelFn(value, validator);
    }
    ngOnInit() {
        const value = this.control.value;
        // level计算
        let level = -1;
        if (!(value === null || value.length === 0)) { // value值为空情况下,level无效处理
            level = TiPwdMsgComponent._getLevel(value, this.validator, this.levelFn);
        }
        // 设置呈现时需要使用的字段
        this.msgModel = {
            level,
            msgItems: TiPwdMsgComponent._getMsgItems(this.msgItems, this.control),
            securityText: TiPwdMsgComponent._getPwdStrengthLan('securityText'),
            securityStatus: level === -1 ? '' : TiPwdMsgComponent._getPwdStrengthLan('levelDecArr')[level]
        };
    }
}
TiPwdMsgComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-pwd-msg',
                template: "<div class=\"ti3-valid-pwd-tip-container\">\r\n    <div *ngFor = \"let item of msgModel.msgItems;\" class=\"ti3-valid-pwd-tip-item\">\r\n        <span class=\"ti3-valid-pwd-tip-status-null\" *ngIf = \"item.validStatus === -1\"></span>\r\n        <span class=\"ti3-valid-pwd-tip ti3-valid-pwd-tip-success\" *ngIf = \"item.validStatus === true\">\r\n            <ti-icon name=\"alert-success\"></ti-icon>\r\n        </span>\r\n        <span class=\"ti3-valid-pwd-tip ti3-valid-pwd-tip-error\" *ngIf = \"item.validStatus === false\">\r\n            <ti-icon name=\"x-thin\"></ti-icon>\r\n        </span>\r\n        <span class=\"ti3-valid-pwd-tip-msg\">{{item.msg}}</span>\r\n    </div>\r\n    <div class=\"ti3-valid-pwd-level\">\r\n        <span class=\"ti3-valid-pwd-tip-security-text\">{{msgModel.securityText}}</span>\r\n        <div class=\"ti3-valid-pwd-level-bars\" [ngClass]=\"{'ti3-valid-pwd-level-weak': msgModel.level === 0, 'ti3-valid-pwd-level-medium': msgModel.level === 1, 'ti3-valid-pwd-level-strong': msgModel.level === 2}\">\r\n            <span class=\"ti3-valid-pwd-level-bar\" [ngClass]=\"{'active': msgModel.level >= 0}\"></span>\r\n            <span class=\"ti3-valid-pwd-level-bar\" [ngClass]=\"{'active': msgModel.level >= 1}\"></span>\r\n            <span class=\"ti3-valid-pwd-level-bar\" [ngClass]=\"{'active': msgModel.level >= 2}\"></span>\r\n        </div>\r\n            <span class=\"ti3-valid-pwd-tip-security-status\">{{msgModel.securityStatus}}</span>\r\n    </div>\r\n</div>\r\n",
                styles: ["::ng-deep :root{--ti-valid-pwd-circle-size:6px;--ti-valid-pwd-level-bar-height:2px;--ti-valid-pwd-level-bar-item-width:60px;--ti-valid-pwd-level-bar-space:var(--ti-common-space-3x);--ti-valid-pwd-space:var(--ti-common-space-2x);--ti-valid-pwd-status-icon-size:16px;--ti-valid-pwd-status-null-boder-width:1px;--ti-valid-pwd-status-null-color:var(--ti-common-color-line-normal);--ti-valid-pwd-status-null-size:calc(var(--ti-valid-pwd-status-icon-size) - var(--ti-valid-pwd-status-null-boder-width)*2);--ti-valid-pwd-tip-line-height:18px}.ti3-valid-pwd-tip-container{font-size:var(--ti-common-font-size-base);line-height:var(--ti-valid-pwd-tip-line-height)}.ti3-valid-pwd-tip-item{margin-bottom:var(--ti-common-space-3x);*zoom:1}.ti3-valid-pwd-tip-item:after{clear:both;content:\"\";display:table}.ti3-valid-pwd-tip-item:before{content:\"\";display:table}.ti3-valid-pwd-tip-status-null{-ms-box-sizing:content-box;border:var(--ti-valid-pwd-status-null-boder-width) solid hsla(0,0%,100%,.1);border-radius:var(--ti-valid-pwd-status-null-size);box-sizing:content-box;float:left;height:var(--ti-valid-pwd-status-null-size);margin-right:var(--ti-valid-pwd-space);position:relative;top:calc((var(--ti-valid-pwd-tip-line-height) - var(--ti-valid-pwd-status-icon-size))/2);width:var(--ti-valid-pwd-status-null-size)}.ti3-valid-pwd-tip-status-null:after{-ms-box-sizing:border-box;background-color:var(--ti-common-color-icon-darkbg-normal);border-radius:50%;box-sizing:border-box;content:\"\";height:var(--ti-valid-pwd-circle-size);left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:var(--ti-valid-pwd-circle-size)}.ti3-valid-pwd-tip-success{background-color:var(--ti-common-color-success);border-radius:50%;color:var(--ti-common-color-text-gray);float:left;font-size:var(--ti-valid-pwd-status-icon-size);height:var(--ti-valid-pwd-status-icon-size);margin-right:var(--ti-valid-pwd-space);margin-top:calc((var(--ti-valid-pwd-tip-line-height) - var(--ti-valid-pwd-status-icon-size))/2);text-align:center;width:var(--ti-valid-pwd-status-icon-size)}.ti3-valid-pwd-tip-success ti-icon{font-size:12px;line-height:var(--ti-valid-pwd-status-icon-size);vertical-align:top}.ti3-valid-pwd-tip-error{background-color:var(--ti-common-color-error);border-radius:50%;color:var(--ti-common-color-text-gray);float:left;font-size:var(--ti-valid-pwd-status-icon-size);height:var(--ti-valid-pwd-status-icon-size);margin-right:var(--ti-valid-pwd-space);margin-top:calc((var(--ti-valid-pwd-tip-line-height) - var(--ti-valid-pwd-status-icon-size))/2);text-align:center;width:var(--ti-valid-pwd-status-icon-size)}.ti3-valid-pwd-tip-error ti-icon{font-size:12px;line-height:var(--ti-valid-pwd-status-icon-size);vertical-align:top}.ti3-valid-pwd-tip-msg{float:left;width:calc(100% - var(--ti-valid-pwd-status-icon-size) - var(--ti-valid-pwd-space))}.ti3-valid-pwd-level-bars,.ti3-valid-pwd-tip-security-text{float:left;margin-right:var(--ti-common-space-3x)}.ti3-valid-pwd-level-bars{margin-top:calc(var(--ti-valid-pwd-tip-line-height)/2)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-strong .active{background:var(--ti-valid-pwd-level-bar-color-strong-active)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-strong .active:after,.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-strong .active:first-child:before{background-color:var(--ti-valid-pwd-level-bar-color-strong-active)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-medium .active{background:var(--ti-valid-pwd-level-bar-color-medium-active)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-medium .active:after,.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-medium .active:first-child:before{background-color:var(--ti-valid-pwd-level-bar-color-medium-active)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-weak .active{background:var(--ti-valid-pwd-level-bar-color-weak-active)}.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-weak .active:after,.ti3-valid-pwd-level-bars.ti3-valid-pwd-level-weak .active:first-child:before{background-color:var(--ti-valid-pwd-level-bar-color-weak-active)}.ti3-valid-pwd-level-bar{background:var(--ti-valid-pwd-level-bar-color);float:left;height:var(--ti-valid-pwd-level-bar-height);position:relative;width:calc(var(--ti-valid-pwd-level-bar-item-width) + var(--ti-valid-pwd-circle-size))}.ti3-valid-pwd-level-bar:first-child{width:calc(var(--ti-valid-pwd-level-bar-item-width) + var(--ti-valid-pwd-circle-size)*2)}.ti3-valid-pwd-level-bar:first-child:before{left:0}.ti3-valid-pwd-level-bar:after,.ti3-valid-pwd-level-bar:first-child:before{-ms-box-sizing:border-box;background-color:#8a8e99;border-radius:50%;box-sizing:border-box;content:\"\";height:var(--ti-valid-pwd-circle-size);position:absolute;top:calc((var(--ti-valid-pwd-level-bar-height) - var(--ti-valid-pwd-circle-size))/2);width:var(--ti-valid-pwd-circle-size)}.ti3-valid-pwd-level-bar:after{right:0}.ti3-valid-pwd-level{color:var(--ti-tip-text-color);margin-left:calc(var(--ti-valid-pwd-status-icon-size) + var(--ti-valid-pwd-space));margin-top:var(--ti-common-space-4x);*zoom:1}.ti3-valid-pwd-level:after{clear:both;content:\"\";display:table}.ti3-valid-pwd-level:before{content:\"\";display:table}.ti3-valid-pwd-tip-security-status{float:left;height:20px}.ti3-valid-pwd-level-circle{-ms-box-sizing:border-box;background-color:#8a8e99;border-radius:50%;box-sizing:border-box;content:\"\";height:var(--ti-valid-pwd-circle-size);position:absolute;top:calc((var(--ti-valid-pwd-level-bar-height) - var(--ti-valid-pwd-circle-size))/2);width:var(--ti-valid-pwd-circle-size)}"]
            },] }
];
TiPwdMsgComponent.propDecorators = {
    control: [{ type: Input }],
    msgItems: [{ type: Input }],
    validator: [{ type: Input }],
    levelFn: [{ type: Input }]
};

/**
 * @ignore
 */
class TiPwdConfig {
    // /**
    //  * 计算密码熵值,具体的计算密码熵值的算法如下：
    //  * 1、第一个字符为4bits
    //  * 2、2-8个字符，每一个字符为2bits
    //  * 3、9-20个字符之间，每一个字符为1.5bits
    //  * 4、21个字符之后，每一个字符为1bit
    //  * 5、如果密码中同时存在大写字母和特殊字符，则熵值+6
    //  * @param {String} str 密码字串
    //  * @param {Number} minLen 密码最小长度
    //  * @param {Number} minType 密码最小组合种类
    //  * @returns {Number} level 密码等级
    //  */
    static pwdLevelFn(value, validator) {
        const validatorParam = getValidatorParam();
        const minCharLen = validatorParam.minCharLen;
        const minCharTypeNum = validatorParam.minCharTypeNum;
        const charTypeRegObj = validatorParam.charTypeRegObj;
        // 根据字符个数初步计算熵值
        const len = value.length;
        let pwdScore = 0;
        if (len >= 21) {
            pwdScore = (len - 21) + 1.5 * 12 + 2 * 7 + 4;
        }
        else if (len >= 9 && len < 21) {
            pwdScore = (len - 9 + 1) * 1.5 + 2 * 7 + 4;
        }
        else if (len >= 2 && len < 9) {
            pwdScore = (len - 2 + 1) * 2 + 4;
        }
        else if (len >= 1 && len < 2) {
            pwdScore = 4;
        }
        // 同时存在大写字母和特殊字符，熵值+6
        if (charTypeRegObj.upperCharReg &&
            charTypeRegObj.upperCharReg.test(value) &&
            charTypeRegObj.specialCharReg.test(value)) {
            pwdScore += 6;
            // 重置正则表达式的lastIndex属性:只有正则表达式使用了表示全局检索的 "g" 标志时，该属性才会起作用，
            // 当前正则匹配到字串后，下次使用同样的正则匹配该字串时，正则检查位置会发生变化
            charTypeRegObj.upperCharReg.lastIndex = 0;
            charTypeRegObj.specialCharReg.lastIndex = 0;
        }
        // 根据熵值计算等级
        return countLevel(pwdScore);
        function getValidatorParam() {
            const params = validator.params;
            // 默认值设定
            let minCharLength = 0;
            let minCharTypeNumber = 0;
            let charTypeRegObject = {
                specialCharReg: /[~`!\?,.:;\-_'"\(\)\{\}\[\]\/<>@#\$%\^&\*\+\|\\=\s]/,
                lowerCharReg: /[a-z]+/,
                upperCharReg: /[A-Z]+/,
                digitsCharReg: /[0-9]+/
            };
            // 通过rangeSize规则获取最小长度
            const rangeSizeParams = params.rangeSize;
            if (!Util.isUndefined(rangeSizeParams)) {
                minCharLength = parseInt(rangeSizeParams[0], 10) || 0;
            }
            // 通过minCharType规则获取最小字符类型及其正则
            const minCharTypeParams = params.minCharType;
            if (!Util.isUndefined(minCharTypeParams)) {
                minCharTypeNumber = parseInt(minCharTypeParams[0], 10) || 0;
                charTypeRegObject = minCharTypeParams[1] || charTypeRegObject;
            }
            // 返回对象值
            return {
                minCharLen: minCharLength,
                minCharTypeNum: minCharTypeNumber,
                charTypeRegObj: charTypeRegObject
            };
        }
        /**
         * 计算密码等级
         * 低： 0~25.5（ 小于等于25 .5）
         * 中： 25.5~30(大于25 .5 小于等于30)
         * 高： 30~（大于30）
         * @param score 密码分数
         * @returns 密码等级
         */
        function countLevel(score) {
            let level = 0;
            if (score > 30) {
                level = 2;
            }
            else if (score > 25.5 && score <= 30) {
                level = 1;
            }
            else if (score >= 0 && score <= 25.5) {
                level = 0;
            }
            level = levelHandle(minCharLen, minCharTypeNum, level);
            return level;
        }
        // 密码降级处理
        function levelHandle(psdLen, psdType, level) {
            const type = getCharType(value);
            let pwdLevel = level;
            if (level > 0) {
                if ((psdLen && len < psdLen) || (psdType && type < psdType)) {
                    pwdLevel = level - 1;
                }
            }
            return pwdLevel;
        }
        // 获取当前密码字符种类
        function getCharType(str) {
            let typeNum = 0;
            for (const key in charTypeRegObj) {
                if (charTypeRegObj.hasOwnProperty(key)) {
                    const regExp = charTypeRegObj[key];
                    if (regExp.test(str)) {
                        typeNum++;
                        regExp.lastIndex = 0;
                    }
                }
            }
            return typeNum;
        }
    }
}
TiPwdConfig.pwdTipPostion = 'right';
TiPwdConfig.pwdTipMaxWidth = '440px';
// pwd校验规则
TiPwdConfig.pwdCharTypeRegObj = {
    // specialCharReg: /[~`!\?,.:;\-_'"\(\)\{\}\[\]\/<>@#\$%\^&\*\+\|\\=\s]/,
    // https://www.bejson.com/zhuanyi/ Json转义工具有错，单引号未转义
    specialCharReg: new RegExp('[~`!\\?,.:;\\-_\'\"\\(\\)\\{\\}\\[\\]\\/<>@#\\$%\\^&\\*\\+\\|\\\\=\\s]'),
    lowerCharReg: new RegExp('[a-z]+'),
    upperCharReg: new RegExp('[A-Z]+'),
    digitsCharReg: new RegExp('[0-9]+')
};
TiPwdConfig.pwdValidator = {
    rule: 'password',
    params: {
        rangeSize: [6, 32],
        minCharType: [2] // 该校验方法支持两个参数传递,第二个参数为charTypeRegObj,不传递第二个参数情况下,代表使用该配置中的默认值
    },
    message: {
        rangeSize: '',
        minCharType: '',
        notEqualPosRev: ''
    }
};

// 定义组件默认配置参数
/**
 * @ignore
 */
class TiValidationDefaultConfig extends TiPwdConfig {
}
// 默认校验方式
TiValidationDefaultConfig.type = 'change';
TiValidationDefaultConfig.tipPosition = 'right';

/**
 * @ignore
 */
class PwdCheck extends BlurCheck {
    constructor(config, common) {
        super(config, common);
        this.config = config;
        this.common = common;
        const pwdConfig = this.config && this.config.passwordConfig;
        // 设置参数，用于规则提示组件数据组装
        this._setValidator(pwdConfig);
        this._setMsgItems();
        this._setLevelFn(pwdConfig);
    }
    onFocus(ele, formControl) {
        // 由于密码组件需要依赖于其他输入框，因此在focus时需要更新其状态
        formControl.control.updateValueAndValidity();
        super.onFocus(ele, formControl);
    }
    // 设置validator params和msg
    _setValidator(pwdConfig) {
        let pwdValidator = TiValidationDefaultConfig.pwdValidator;
        if (pwdConfig && pwdConfig.validator) { // validator定义情况下,处理validator
            const pwdValidatorConfig = pwdConfig.validator;
            if (Util.isUndefined(pwdValidatorConfig.rule) ||
                pwdValidatorConfig.rule === pwdValidator.rule) { // 依然使用默认规则情况下,只做参数合并
                pwdValidator = {
                    params: Object.assign(Object.assign({}, pwdValidator.params), pwdValidatorConfig.params),
                    message: Object.assign(Object.assign({}, pwdValidator.message), pwdValidatorConfig.message)
                };
            }
            else {
                pwdValidator = {
                    params: pwdValidatorConfig.params,
                    message: pwdValidatorConfig.message
                };
            }
        }
        this.validator = pwdValidator;
    }
    // 设置msgItems,msgItems数据格式为:{ruleKey: msgStr,...}
    // 其中msgStr为格式化后的页面可显示字串
    _setMsgItems() {
        const validatorConfig = this.validator;
        const msgConfig = validatorConfig.message;
        const paramsConfig = validatorConfig.params;
        let msgStr;
        const msgItems = {};
        // msgConfig中定义的规则提示才会在页面中显示
        for (const key in msgConfig) {
            if (msgConfig.hasOwnProperty(key)) {
                // 规则提示优先从config中读取,如果读取到的是无效字串,则从国际化默认配置中读取
                msgStr = msgConfig[key] || this.common.getMsg(key);
                // 如果对应的规则有参数的情况下,则根据参数做字串格式化
                if (paramsConfig && paramsConfig.hasOwnProperty(key)) {
                    msgStr = Util.formatEntry(msgStr, paramsConfig[key]);
                }
                msgItems[key] = msgStr;
            }
        }
        this.msgItems = msgItems;
    }
    // 设置levelFn:levelFn支持业务自定义
    _setLevelFn(pwdConfig) {
        let levelFn = TiValidationDefaultConfig.pwdLevelFn;
        if (pwdConfig && Util.isFunction(pwdConfig.levelFn)) {
            levelFn = pwdConfig.levelFn;
        }
        this.levelFn = levelFn;
    }
    addTip(ele, validationConf, formControl) {
        this.commonHandle.destroyTip(ele); // 清除先前提示信息
        const inputsObj = {
            msgItems: this.msgItems,
            validator: this.validator,
            control: formControl,
            levelFn: this.levelFn
        };
        // tip默认值设置
        const configAssigned = Object.assign({ tipPosition: TiValidationDefaultConfig.pwdTipPostion, tipMaxWidth: TiValidationDefaultConfig.pwdTipMaxWidth }, validationConf);
        this.common.generateTip(ele, TiPwdMsgComponent, configAssigned, inputsObj);
    }
}

/**
 * @ignore
 */
class TiErrorMsgComponent extends TiBaseComponent {
}
TiErrorMsgComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-error-msg',
                template: `
        <span class="ti3-error-icon-bg">
            <span class='ti3-error-icon ti3-icon ti3-icon-alert-warn'></span>
        </span>
        <span class="ti3-validate-text" [innerHTML]="errorMessage"></span>
    `,
                encapsulation: ViewEncapsulation.None,
                host: {
                    '[class.ti3-unifyvalid-error-container]': 'isAppendBody',
                    '[class.ti3-unifyvalid-tip-error-container]': 'true'
                },
                styles: [".ti3-error-icon-bg{background-color:var(--ti-valid-error-color);border-radius:50%;flex-shrink:0;height:16px;margin-right:var(--ti-common-space-2x);text-align:center;width:16px}.ti3-error-icon{color:var(--ti-common-color-text-white);font-size:var(--ti-common-font-size-base)}.ti3-unifyvalid-error-container{color:var(--ti-valid-error-color);display:block;margin-top:var(--ti-common-space-2x)}.ti3-unifyvalid-tip-error-container{align-content:center;display:flex}.ti3-tooltip-content .ti3-error-icon-bg{line-height:16px;margin-top:1px}"]
            },] }
];
TiErrorMsgComponent.propDecorators = {
    errorMessage: [{ type: Input }],
    isAppendBody: [{ type: Input }]
};

// 命名含有Service的Module，都不是对外暴露的Service，是内部使用。外部使用此Service，导入TiDragModule即可
/**
 * @ignore
 */
class CommonServiceModule {
}
CommonServiceModule.decorators = [
    { type: NgModule, args: [{},] }
];

/**
 * @ignore
 */
class CommonService {
    constructor(_renderer, _tiRenderer, _tipService, _tiPopupService) {
        this._renderer = _renderer;
        this._tiRenderer = _tiRenderer;
        this._tipService = _tipService;
        this._tiPopupService = _tiPopupService;
    }
    // 获取错误信息源字串
    static _getSourceStr(ruleKey, ruleErrors, validationConf, isAsync) {
        // 优先使用tiValidation中的规则项配置errorMsg
        const errMsgConf = validationConf && validationConf.errorMessage;
        if (!Util.isUndefined(errMsgConf) && Util.isString(errMsgConf[ruleKey])) {
            return errMsgConf[ruleKey];
        }
        if (typeof ruleErrors === 'object') {
            // 获取自定义校验规则中的 tiErrorMsg
            if (!isAsync && Util.isString(ruleErrors.tiErrorMessage)) {
                return ruleErrors.tiErrorMessage;
            }
            // 获取自定义异步校验规则中的 tiAsyncErrorMessage
            if (isAsync && Util.isString(ruleErrors.tiAsyncErrorMessage)) {
                return ruleErrors.tiAsyncErrorMessage;
            }
        }
        // 获取到的tiValidation errorMsg无效情况下,使用默认规则提示
        return TiLocale.getLocaleWords().tiValid.errorMsg[ruleKey] || '';
    }
    // 获取错误提示字符串，思路是：
    // 1.先获取错误信息源字串（可能带params标识{0}/{1}等）;
    // 2.将获取的源字串中的参数替换为真实数据
    static _getErrorStr(errors, validationConf, isAsync) {
        const ruleKey = Object.keys(errors)[0];
        const ruleErrors = errors[ruleKey];
        const msgStr = CommonService._getSourceStr(ruleKey, ruleErrors, validationConf, isAsync);
        // 获取错误信息参数,无参数情况下,不需做格式匹配直接返回
        // errors格式示例：{required:true,{'maxlength': {'requiredLength': maxLength, 'actualLength': length}}}
        if ((typeof ruleErrors) !== 'object') {
            return msgStr;
        }
        const params = Object.values(ruleErrors); // 此处对错误信息定义有要求：要求错误返回对象与词条中的参数次序与一致
        return Util.formatEntry(msgStr, params);
    }
    isFocused(ele) {
        return ele.nativeElement.attributes.tiFocused !== undefined;
    }
    // 获取密码校验中校验规则信息
    getMsg(ruleKey, params) {
        const messageStr = TiLocale.getLocaleWords().tiValid.message[ruleKey];
        return Util.formatEntry(messageStr, params);
    }
    // 获取错误提示信息DOM文本，此处TiErrorMsgComponent组件处理的不仅是提示信息，还包括错误时的组件边框变红样式加载
    getErrorMsg(errors, validationConf, isAppendBody = false, isAsync) {
        const errorMsg = CommonService._getErrorStr(errors, validationConf, isAsync);
        if (!errorMsg) {
            return null;
        }
        const errorMsgComponentRef = this._tiPopupService.createCompoentRef({
            componentType: TiErrorMsgComponent,
            context: {
                errorMessage: errorMsg,
                isAppendBody
            }
        });
        return errorMsgComponentRef.location.nativeElement;
    }
    // 调用ti-Tip组件生成Tip提示,该公共方法中同时传递了tip的位置信息等
    generateTip(ele, tipContent, validationConf, context) {
        const tipInstance = this._tipService.create(ele.nativeElement, {
            position: validationConf.tipPosition || TiValidationDefaultConfig.tipPosition,
            maxWidth: validationConf.tipMaxWidth
        });
        tipInstance.show(tipContent, context);
        ele.nativeElement.tiValidTip = tipInstance;
        return tipInstance;
    }
    // 销毁Tip提示
    destroyTip(ele) {
        const tipEle = ele.nativeElement.tiValidTip;
        if (!Util.isUndefined(tipEle)) {
            tipEle.hide();
        }
    }
    // 根据errors结果生成可占位的错误提示信息(blurCheck和pwdCheck中使用)
    addValidMsg(ele, validationConf, formControl, isAsync) {
        const errors = formControl.control.errors;
        // 校验正确情况下不做处理
        if (errors === null) {
            return;
        }
        const errorDom = this.getErrorMsg(errors, validationConf, true, isAsync);
        if (errorDom === null || errorDom.childNodes.length === 0) {
            return;
        }
        // 添加错误信息
        if (validationConf && validationConf.errorMessageWrapper) {
            this._renderer.appendChild(validationConf.errorMessageWrapper, errorDom);
        }
        else if (ele.nativeElement.hasAttribute('tiTextarea')) {
            this._tiRenderer.insertAfter(errorDom, this._renderer.parentNode(ele.nativeElement));
        }
        else {
            this._tiRenderer.insertAfter(errorDom, ele.nativeElement);
        }
        ele.nativeElement.tiErrorMessage = errorDom;
    }
    // 销毁可占位的错误提示信息(blurCheck和pwdCheck中使用)
    clearValidMsg(ele) {
        const errMsgDom = ele.nativeElement.tiErrorMessage;
        if (!Util.isUndefined(errMsgDom)) {
            this._renderer.removeChild(errMsgDom.parentNode, errMsgDom);
        }
    }
}
CommonService.ɵprov = ɵɵdefineInjectable({ factory: function CommonService_Factory() { return new CommonService(ɵɵinject(Renderer2), ɵɵinject(TiRenderer), ɵɵinject(TiTipService), ɵɵinject(TiPopupService)); }, token: CommonService, providedIn: CommonServiceModule });
CommonService.decorators = [
    { type: Injectable, args: [{
                providedIn: CommonServiceModule
            },] }
];
CommonService.ctorParameters = () => [
    { type: Renderer2 },
    { type: TiRenderer },
    { type: TiTipService },
    { type: TiPopupService }
];

// 命名含有Service的Module，都不是对外暴露的Service，是内部使用。外部使用此Service，导入TiDragModule即可
/**
 * @ignore
 */
class CheckStyleModule {
}
CheckStyleModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonServiceModule
                ]
            },] }
];

// 该功能类用于根据校验方式定义校验实体执行函数
/**
 * @ignore
 */
class CheckStyleService {
    constructor(commonService) {
        this.commonService = commonService;
    }
    createHandler(type, config) {
        let resultType = type;
        // 设置checkStyle默认值
        if (Util.isUndefined(type)) {
            resultType = TiValidationDefaultConfig.type;
            // 设置passwordConfig情况下，type默认为'password'
            if (!Util.isUndefined(config.passwordConfig)) {
                resultType = 'password';
            }
        }
        // 根据不同的配置，设置校验方式执行函数
        let handle;
        switch (resultType) {
            case 'blur':
                handle = new BlurCheck(config, this.commonService);
                break;
            case 'password':
                handle = new PwdCheck(config, this.commonService);
                break;
            default: // 定义为'change'及其他无效方式,均采用change校验方式
                handle = new ChangeCheck(config, this.commonService);
        }
        return handle;
    }
}
CheckStyleService.ɵprov = ɵɵdefineInjectable({ factory: function CheckStyleService_Factory() { return new CheckStyleService(ɵɵinject(CommonService)); }, token: CheckStyleService, providedIn: CheckStyleModule });
CheckStyleService.decorators = [
    { type: Injectable, args: [{
                providedIn: CheckStyleModule
            },] }
];
CheckStyleService.ctorParameters = () => [
    { type: CommonService }
];

/**
 * Tiny校验是基于Angular提供的表单校验进行的封装，在使用Tiny组件前，请先了解[Angular表单校验]{@link https://angular.io/guide/form-validation}
 *
 * 组件支持的校验规则及方法见 [TiValidators]{@link ../classes/TiValidators.html}
 *
 * <example-url>../tiny3demo/#/validation/validation-all</example-url>
 */
class TiValidationDirective {
    constructor(formControl, checkStyleFactory, element, rendererFactory) {
        this.formControl = formControl;
        this.checkStyleFactory = checkStyleFactory;
        this.element = element;
        this.eleNative = this.element.nativeElement;
        /* tslint:disable:no-null-keyword */
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    ngOnInit() {
        // 初始化handleFn,用于处理tiValidation指令声明但未定义值场景
        this._setHandleFn();
        // 订阅onStatusChange事件,传递校验时机
        this.formStatusSubscription = this.formControl.statusChanges.subscribe(() => {
            this._validationHandleFn.onStatusChange(this.element, this.formControl);
        });
        // 订阅onStatusChange事件来特别处理异步校验pending状态的loading图标
        if (this.formControl.control.asyncValidator) {
            this.asyncFormStatusSubscription = this.formControl.statusChanges
                .pipe(
            // 由于异步校验有防抖处理(输入停顿后再进行异步校验)，所以需要在异步校验开始时才能出现loading图标
            debounce(() => timer(Number(this.formControl.pending) * TiValidationDirective.ASYNC_DEBOUNCE_TIME)))
                .subscribe(() => {
                if (this._validationHandleFn.onAsyncStatusChange) {
                    this._validationHandleFn.onAsyncStatusChange(this.element, this.formControl);
                }
            });
        }
    }
    ngOnChanges(changes) {
        if (changes['tiValidation'] && !changes['tiValidation'].firstChange) { // validation动态修改支持,此处根据validation重新创建校验实体方法函数
            this._setHandleFn();
        }
    }
    ngOnDestroy() {
        // 宿主元素销毁时，销毁其附属tip
        this._validationHandleFn.destroy(this.element);
        // 取消formControl中statusChanges的订阅
        this.formStatusSubscription.unsubscribe();
        if (this.asyncFormStatusSubscription) {
            this.asyncFormStatusSubscription.unsubscribe();
        }
    }
    /**
     * @ignore
     */
    onFocus() {
        this._markAsFocus();
        this._validationHandleFn.onFocus(this.element, this.formControl);
    }
    /**
     * @ignore
     */
    onBlur() {
        this._markAsBlur();
        this._validationHandleFn.onBlur(this.element, this.formControl);
    }
    _setHandleFn() {
        // 将errorMessageWrapper和tiValidation属性合并，方便后续处理
        const validationConfig = Object.assign(Object.assign({}, this.tiValidation), { errorMessageWrapper: this.errorMessageWrapper });
        this._validationHandleFn = this.checkStyleFactory.
            createHandler(this.tiValidation && this.tiValidation.type, validationConfig);
        // 失焦校验时给宿主元素添加tiBlurCheck属性标识
        if (this.tiValidation && this.tiValidation.type === 'blur') {
            this.renderer.setAttribute(this.eleNative, 'tiBlurCheck', '');
        }
    }
    // 设置focus状态标志,标志包括两部分(如下markAsBlur逻辑类似)：
    // 1.样式类,用于根据focus/blur状态设置CSS中表单边框颜色;
    // 2.标志位,用于根据focus/blur判断是否显示提示信息
    _markAsFocus() {
        this.renderer.setAttribute(this.eleNative, 'tiFocused', 'tiFocused');
    }
    _markAsBlur() {
        this.renderer.removeAttribute(this.eleNative, 'tiFocused');
    }
}
TiValidationDirective.ASYNC_DEBOUNCE_TIME = 500; // 这个数值跟tiny2的异步校验一致
TiValidationDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiValidation]',
                // 声明该组件定义时需要用到的服务
                providers: [CheckStyleService, CommonService],
                host: {
                    '(focus)': 'onFocus()',
                    '(blur)': 'onBlur()'
                }
            },] }
];
TiValidationDirective.ctorParameters = () => [
    { type: NgControl },
    { type: CheckStyleService },
    { type: ElementRef },
    { type: RendererFactory2 }
];
TiValidationDirective.propDecorators = {
    tiValidation: [{ type: Input }],
    errorMessageWrapper: [{ type: Input }]
};

/* eslint-disable no-eq-null */
// 下面注释，可以避免编译lib时正则报错。原理未知，副作用未知。
// @dynamic
/**
 * Tiny封装的常用校验规则及校验方法
 *
 * ### 规则使用
 * **提供了两种使用方式：**
 *
 * 1.静态方法：通过TiValidators.XXX（规则名）在JS中定义
 *
 * 2.指令方式：对应规则的指令名为tiXXX(规则名首字母大写)，如required规则的指令名为 tiRequired
 *
 * **支持的校验规则如下：**
 *
 * | 规则名称    |  配置参数意义/类型   |  规则描述  |
 * | --------   | :-----   | :---- |
 * | required   | 无       |  为空校验    |
 * | maxLength    | 最大字符长度/number      |  字符长度最大值校验    |
 * | minLength    | 最小字符长度/number      |   字符长度最小值校验    |
 * | rangeSize    | 最小长度限制/number <br/> 最大长度限制/number      |   字符长度大小区间校验    |
 * | maxValue    | 最大数值/number      |  数字最大数值校验    |
 * | minValue    | 最小数值/number      |   数字最小数值校验    |
 * | rangeValue    | 最小数值限制/number <br/> 最大数值限制/number    |   数字大小区间校验    |
 * | regExp   | 正则表达式参数/RegExp|string（不包括正则表达式头尾标识符'^(?:'、')$'）       |  正则校验    |
 * | email    | 无      |  邮箱校验    |
 * | contains    | 包含的内容/(string/number)     |   包含校验    |
 * | notContains    | 不包含的内容/(string/number)      |   不包含校验    |
 * | equal   | 相等的内容/(string/number)     |  相等校验    |
 * | notEqual    | 不相等的内容/(string/number)    |  不相等校验    |
 * | notScript    | 无      |   包含script标签校验    |
 * | port    |  无     |   端口号校验，范围为0~65535    |
 * | date    | 无      |   日期类型校验    |
 * | url    |  无     |   url校验    |
 * | integer    | 无      |   整数校验    |
 * | number    |  无     |   数字校验 |
 * | digits    | 无      |   正整数校验    |
 * | ipv4    |  无     |   ipv4校验    |
 * | ipv6    |  无     |   ipv6校验    |
 * | minCharType | 1. 符合要求的字符种类/number;<br/>2. 字符集对象类型（可选）/{string:RegExp}。<br/>默认的字符种类分别为：大写字母、小写字母、数字、特殊字符`~!@#$%^&*()-_=+\\\|[{}];:\'\",<.>/?  和空格 | 符合最小字符种类校验，默认情况为至少包含2种字符类型`。  |
 * | notEqualPosRev    |  需要比对的表单formControl对象获取函数/ () => AbstractControl     |   不能和表单对象的正序或倒序相同    |
 * | password    | 密码校验各项规则参数/对象形式 |   密码校验   |
 *
 *
 *  **password规则的参数类型**
 *
 *    {
 *        rangeSize?: [number, number],
 *        minCharType?: [bumber, {
 *            digitsCharReg: RegExp,
 *            specialCharReg: RegExp,
 *            lowerCharReg: RegExp,
 *            upperCharReg: RegExp}],
 *        notEqualPosRev: () => AbstractControl
 *    }
 */
class TiValidators {
    static isEmptyInputValue(value) {
        // we don't check for string here so it also works with arrays
        // tslint:disable-next-line:no-null-keyword
        return value == null || value.length === 0;
    }
    /**
     * @ignore
     */
    static required(control) {
        return Validators.required(control);
    }
    /**
     * @ignore
     */
    static maxLength(maxLength) {
        return (control) => {
            const length = control.value ? control.value.length : 0;
            return length > maxLength ?
                { maxLength: { requiredLength: maxLength, actualLength: length } } :
                null;
        };
    }
    /**
     * @ignore
     */
    static minLength(minLength) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value)) {
                return null; // don't validate empty values to allow optional controls
            }
            const length = control.value ? control.value.length : 0;
            return length < minLength ?
                { minLength: { requiredLength: minLength, actualLength: length } } :
                null;
        };
    }
    /**
     * @ignore
     */
    static rangeSize(minLength, maxLength) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value)) {
                return null; // don't validate empty values to allow optional controls
            }
            const length = control.value ? control.value.length : 0;
            return length > maxLength || length < minLength ?
                { rangeSize: { requiredMinLength: minLength, requiredMaxLength: maxLength, actualLength: length } } :
                null;
        };
    }
    /**
     * @ignore
     */
    static maxValue(max) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(max)) {
                return null; // don't validate empty values to allow optional controls
            }
            const value = parseFloat(control.value);
            // Controls with NaN values after parsing should be treated as not having a
            // maximum, per the HTML forms spec: https://www.w3.org/TR/html5/forms.html#attr-input-max
            return !isNaN(value) && value > max ? { maxValue: { requiredMaxValue: max, actual: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static minValue(min) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(min)) {
                return null; // don't validate empty values to allow optional controls
            }
            const value = parseFloat(control.value);
            // Controls with NaN values after parsing should be treated as not having a
            // maximum, per the HTML forms spec: https://www.w3.org/TR/html5/forms.html#attr-input-max
            return !isNaN(value) && value < min ? { minValue: { requiredMinValue: min, actual: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static rangeValue(min, max) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(min) || TiValidators.isEmptyInputValue(max)) {
                return null; // don't validate empty values to allow optional controls
            }
            const value = parseFloat(control.value);
            // Controls with NaN values after parsing should be treated as not having a
            // maximum, per the HTML forms spec: https://www.w3.org/TR/html5/forms.html#attr-input-max
            return !isNaN(value) && (value < min || value > max) ? { rangeValue: { requiredMinValue: min,
                    requiredMaxValue: max, actual: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static regExp(pattern) {
        if (!pattern) {
            return Validators.nullValidator;
        }
        let regex;
        let regexStr;
        if (typeof pattern === 'string') {
            regexStr = '';
            if (pattern.charAt(0) !== '^') {
                regexStr += '^';
            }
            regexStr += pattern;
            if (pattern.charAt(pattern.length - 1) !== '$') {
                regexStr += '$';
            }
            regex = new RegExp(regexStr);
        }
        else {
            regexStr = pattern.toString();
            regex = pattern;
        }
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value)) {
                return null; // don't validate empty values to allow optional controls
            }
            const value = control.value;
            return regex.test(value) ? null : { regExp: { requiredPattern: regexStr, actualValue: value } };
        };
    }
    /**
     * @ignore
     */
    static email(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.EMAIL_REGEXP.test(control.value) ? null : { email: true };
    }
    /**
     * @ignore
     */
    static contains(contain) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(contain)) {
                return null; // don't validate empty values to allow optional controls
            }
            return control.value.indexOf(contain) === -1 ?
                { contains: { requiredContains: contain, actualValue: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static notContains(contain) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(contain)) {
                return null; // don't validate empty values to allow optional controls
            }
            return control.value.indexOf(contain) !== -1 ?
                { notContains: { requiredNotContains: contain, actualValue: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static equal(equal) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(equal)) {
                return null; // don't validate empty values to allow optional controls
            }
            return control.value !== equal ?
                { equal: { requiredEqual: equal, actualValue: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static notEqual(equal) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(equal)) {
                return null; // don't validate empty values to allow optional controls
            }
            return control.value === equal ?
                { notEqual: { requiredNotEqual: equal, actualValue: control.value } } : null;
        };
    }
    /**
     * @ignore
     */
    static notScript(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.SCRIPT_REGEXP.test(control.value) ? { notScript: true } : null;
    }
    /**
     * @ignore
     */
    static port(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.DIGITS_REGEXP.test(control.value) && (control.value >= TiValidators.PORT_RANGE[0]) &&
            (control.value <= TiValidators.PORT_RANGE[1]) ?
            null : { port: { min: TiValidators.PORT_RANGE[0], max: TiValidators.PORT_RANGE[1] } };
    }
    /**
     * @ignore
     */
    static date(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return !/Invalid|NaN/.test(new Date(control.value).toString()) ?
            null : { date: true };
    }
    /**
     * @ignore
     */
    static url(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.URL_REGEXP.test(control.value) ?
            null : { url: true };
    }
    /**
     * @ignore
     */
    static integer(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.INTEGER_REGEXP.test(control.value) ?
            null : { integer: true };
    }
    /**
     * @ignore
     */
    static number(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.NUMBER_REGEXP.test(control.value) ?
            null : { number: true };
    }
    /**
     * @ignore
     */
    static digits(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.DIGITS_REGEXP.test(control.value) ?
            null : { digits: true };
    }
    /**
     * @ignore
     */
    static ipv4(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.IPV4_REGEXP.test(control.value) ?
            null : { ipv4: true };
    }
    /**
     * @ignore
     */
    static ipv6(control) {
        if (TiValidators.isEmptyInputValue(control.value)) {
            return null; // don't validate empty values to allow optional controls
        }
        return TiValidators.IPV6_REGEXP.test(control.value) ?
            null : { ipv6: true };
    }
    /**
     * @ignore
     * 密码字符类型最小种类校验
     * 用于密码校验，其规则如下：
     * 口令必须包含且只能包含如下至少两种字符的组合:
     * －至少一个小写字母；
     * －至少一个大写字母；
     * －至少一个数字；
     * －至少一个特殊字符：`~!@#$%^&*()-_=+\|[{}];:'",<.>/?和空格
     * @param  num 字符类型最小个数
     * @param  charTypeRegObj 字符类型校验正则表达式，涉及到强度计算，参考defaults中定义
     */
    static minCharType(num, charTypeRegObj) {
        /**
         * 正则表达式转为字符串并首尾去除“/”符号，为添加g修饰符做准备
         */
        function regExpToString(regExp) {
            if (typeof regExp !== 'object') {
                return '';
            }
            const regExpStr = String(regExp);
            return regExpStr.substring(1, regExpStr.length - 1);
        }
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || TiValidators.isEmptyInputValue(num) || num === 0) {
                return null; // don't validate empty values to allow optional controls
            }
            // 各类字符校验正则表达式集合,默认使用pwdConfig中的默认配置
            const charRegObj = typeof charTypeRegObj === 'object' ? charTypeRegObj :
                TiPwdConfig.pwdCharTypeRegObj;
            // 校验输入是否符合单条校验字符规则，并记录符合的单条规则个数
            let checkValidNum = 0; // 校验通过结果个数
            let checkResult; // 校验结果临时变量
            let replacedValue = control.value; // 正则替换后的value值
            for (const key in charRegObj) {
                if (charRegObj.hasOwnProperty(key)) {
                    const regExp = charRegObj[key];
                    checkResult = regExp.test(control.value);
                    if (checkResult) {
                        checkValidNum++;
                        // 使用全局替换方式，用于替换字串中所有符合正则规则的字符
                        replacedValue = regExp.global
                            ? replacedValue.replace(regExp, '')
                            : replacedValue.replace(new RegExp(regExpToString(regExp), 'g'), '');
                    }
                }
            }
            // 替换后的值非空情况:代表值中存在非法字符
            return replacedValue.length > 0 || checkValidNum < num ?
                { minCharType: true } : null;
        };
    }
    /**
     * @ignore
     * 用于密码校验：密码不能和用户名或其倒序相同
     * @param  getControlFn 获取对比的表单元素formControl函数
     */
    static notEqualPosRev(getControlFn) {
        return (control) => {
            if (TiValidators.isEmptyInputValue(control.value) || Util.isUndefined(getControlFn && getControlFn())) {
                return null; // don't validate empty values to allow optional controls
            }
            const value = control.value;
            const refreValue = getControlFn().value;
            // 使用如下方式会出现卡顿的情况：
            // 对比formControl value修改时，需要同步修改该表单的状态，否则会存在下次focus该元素或表单整体校验时
            // 该元素校验结果依然是上次的结果
            // getControlFn().valueChanges.subscribe(() => {
            //   control.updateValueAndValidity();
            // });
            return (value.toLowerCase() !== refreValue.split('')
                .reverse()
                .join('')
                .toLowerCase()) &&
                (value.toLowerCase() !== refreValue.toLowerCase()) ?
                null : { notEqualPosRev: true };
        };
    }
    /**
     * @ignore
     * 密码校验规则
     * @param pValue 规则参数:{ruleKey: param}
     */
    static password(pValue) {
        const rangeSizeParamArr = pValue.rangeSize || TiPwdConfig.pwdValidator.params.rangeSize;
        const minCharTypeParamArr = pValue.minCharType || TiPwdConfig.pwdValidator.params.minCharType;
        if (Util.isUndefined(minCharTypeParamArr[1])) {
            minCharTypeParamArr[1] = TiPwdConfig.pwdCharTypeRegObj;
        }
        const validatorComposeArr = [TiValidators.required,
            TiValidators.rangeSize(rangeSizeParamArr[0], rangeSizeParamArr[1]),
            TiValidators.minCharType(minCharTypeParamArr[0], minCharTypeParamArr[1]),
            TiValidators.notEqualPosRev(pValue.notEqualPosRev)];
        // 由于错误提示为password专有提示,需要自定义password error,而compose方法不能自定义,因此此处未使用compose
        // 此外,各子规则的错误依然需要保留,用于规则提示信息
        return (control) => {
            return _mergeErrorsPwd(_executeValidators(control, validatorComposeArr));
        };
        function _executeValidators(control, validators) {
            return validators.map((v) => v(control));
        }
        function _mergeErrorsPwd(arrayOfErrors) {
            const res = arrayOfErrors.reduce((resource, errors) => {
                return errors != null ? Object.assign(Object.assign({}, resource), errors) : resource;
            }, {});
            return Object.keys(res).length === 0 ? null : Object.assign({ password: true }, res);
        }
    }
    // 该方法用于整体校验:由于表单未foucs时,即使错误也不会显示红框,
    // 而整体校验时需要将错误的表单边框标红显示,因此需要显示调用整体校验方法
    /**
     * 该方法用于整体校验
     *
     * 参数form：需要校验的表单族
     *
     * 参数updateValueAndValidityConfig：可选，check方法内部使用的校验方法是AbstractControl的updateValueAndValidity方法，此处将方法参数开放给开发者，参数意义具体可参考https://angular.io/api/forms/AbstractControl#updatevalueandvalidity
     *
     * 返回：表单错误信息
     */
    static check(form, updateValueAndValidityConfig) {
        let errors = {};
        if (form.errors) {
            errors = Object.assign(Object.assign({}, errors), form.errors);
        }
        for (const key in form.controls) {
            if (form.controls.hasOwnProperty(key)) {
                const control = form.controls[key];
                if (control.controls) { // 嵌套的FormArray,FormGroup
                    const checkedErrors = TiValidators.check(control, updateValueAndValidityConfig);
                    if (checkedErrors !== null) {
                        errors[key] = checkedErrors;
                    }
                }
                else {
                    control.markAsTouched();
                    // 由于表单间可能有关联关系（如密码校验的notEqualPosRev，该关联关系需要对单个表单元素再次校验
                    control.updateValueAndValidity(updateValueAndValidityConfig);
                    // 读取errors信息
                    if (control.errors !== null) {
                        errors[key] = control.errors;
                    }
                }
            }
        }
        // 无errors信息时，设置为null，方便业务处理
        if (JSON.stringify(errors) === '{}') {
            errors = null;
        }
        return errors;
    }
}
/* tslint:disable:max-line-length */
TiValidators.EMAIL_REGEXP = /^((([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/;
TiValidators.SCRIPT_REGEXP = /<+\/?[Ss][Cc][Rr][Ii][Pp][Tt] *.*>*/;
TiValidators.DIGITS_REGEXP = /^\d+$/;
TiValidators.PORT_RANGE = [0, 65535];
// URL规则，其中IPv4部分，采用了下面华为自研的ipv4正则表达式
TiValidators.URL_REGEXP = /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;
TiValidators.INTEGER_REGEXP = /^-?\d+$/;
TiValidators.NUMBER_REGEXP = /^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;
// 采用华为自研的ipv4正则表达式
TiValidators.IPV4_REGEXP = /^(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))$/i;
// 采用华为自研的ipv6正则表达式
TiValidators.IPV6_REGEXP = /^(((([\da-f]{1,4}):){7}([\da-f]{1,4}))|(((([\da-f]{1,4}):){1,7}:)|((([\da-f]{1,4}):){6}:([\da-f]{1,4}))|((([\da-f]{1,4}):){5}:(([\da-f]{1,4}):)?([\da-f]{1,4}))|((([\da-f]{1,4}):){4}:(([\da-f]{1,4}):){0,2}([\da-f]{1,4}))|((([\da-f]{1,4}):){3}:(([\da-f]{1,4}):){0,3}([\da-f]{1,4}))|((([\da-f]{1,4}):){2}:(([\da-f]{1,4}):){0,4}([\da-f]{1,4}))|((([\da-f]{1,4}):){1}:(([\da-f]{1,4}):){0,5}([\da-f]{1,4}))|(::(([\da-f]{1,4}):){0,6}([\da-f]{1,4}))|(::([\da-f]{1,4})?))|(((([\da-f]{1,4}):){6}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){5}:(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){4}:(([\da-f]{1,4}):)?(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){3}:(([\da-f]{1,4}):){0,2}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|((([\da-f]{1,4}):){2}:(([\da-f]{1,4}):){0,3}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|(([\da-f]{1,4})::(([\da-f]{1,4}):){0,4}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))|(::(([\da-f]{1,4}):){0,5}(((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5]))\.){3}((1?[1-9]?\d)|(10\d)|(2[0-4]\d)|(25[0-5])))))$/i;

// 下面注释，是为了避免lib编译错误。具体原理未知，副作用未知。
// @dynamic
/**
 * @ignore
 */
class BaseValidator {
    constructor() {
        this.enabled = true; // 无需传参的校验规则是否开启校验
        this._validator = Validators.nullValidator;
    }
    /**
     * 获取各directive中的参数配置
     * @param validatorClass 校验实现类
     * @param name 校验指令名：由于该方法在类外部调用，无法使用BaseValidator中的参数，因此需要传入
     */
    static getDirectiveConfig(validatorClass, name) {
        return {
            selector: `[${name}][formControlName],[${name}][formControl],[${name}][ngModel]`,
            providers: [{
                    provide: NG_VALIDATORS,
                    /* tslint:disable:no-forward-ref */
                    useExisting: forwardRef(() => validatorClass),
                    multi: true
                }]
        };
    }
    static getValidatorStr(name) {
        return name.replace(new RegExp('ti'), '')
            .replace(new RegExp('^\\S'), (s) => {
            return s.toLowerCase();
        });
    }
    ngOnChanges(changes) {
        if (changes['baseValue'] || changes['enabled']) {
            this._createValidator();
            if (this._onChange) {
                this._onChange();
            }
        }
    }
    validate(c) {
        return (this.enabled === false || this.enabled === 'false') ? null : this._validator(c);
    }
    registerOnValidatorChange(fn) {
        this._onChange = fn;
    }
    _createValidator() {
        const validatorStr = this.validatorStr;
        const validatorParam = this.baseValue;
        /* tslint:disable:prefer-conditional-expression */
        if (Util.isArray(validatorParam)) {
            /* tslint:disable:no-null-keyword */
            this._validator = TiValidators[validatorStr].apply(null, validatorParam);
        }
        else if (!Util.isUndefined(validatorParam)) {
            this._validator = TiValidators[validatorStr](validatorParam);
        }
        else {
            this._validator = TiValidators[validatorStr];
        }
    }
}
BaseValidator.decorators = [
    { type: Directive, args: [{ selector: '[BaseValidator]' },] }
];

// @Directive(BaseValidator.getDirectiveConfig(MaxLengthValidatorDirective, MaxLengthValidatorDirective.NAME))
class MaxLengthValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(MaxLengthValidatorDirective.NAME);
    }
}
MaxLengthValidatorDirective.NAME = 'tiMaxLength';
MaxLengthValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiMaxLength][formControlName],[tiMaxLength][formControl],[tiMaxLength][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => MaxLengthValidatorDirective),
                        multi: true
                    }]
            },] }
];
MaxLengthValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [MaxLengthValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(RangeSizeValidatorDirective, RangeSizeValidatorDirective.NAME))
class RangeSizeValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(RangeSizeValidatorDirective.NAME);
    }
}
RangeSizeValidatorDirective.NAME = 'tiRangeSize';
RangeSizeValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiRangeSize][formControlName],[tiRangeSize][formControl],[tiRangeSize][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => RangeSizeValidatorDirective),
                        multi: true
                    }]
            },] }
];
RangeSizeValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [RangeSizeValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(RangeValueValidatorDirective, RangeValueValidatorDirective.NAME))
class RangeValueValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(RangeValueValidatorDirective.NAME);
    }
}
RangeValueValidatorDirective.NAME = 'tiRangeValue';
RangeValueValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiRangeValue][formControlName],[tiRangeValue][formControl],[tiRangeValue][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => RangeValueValidatorDirective),
                        multi: true
                    }]
            },] }
];
RangeValueValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [RangeValueValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(MinLengthValidatorDirective, MinLengthValidatorDirective.NAME))
class MinLengthValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(MinLengthValidatorDirective.NAME);
    }
}
MinLengthValidatorDirective.NAME = 'tiMinLength';
MinLengthValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiMinLength][formControlName],[tiMinLength][formControl],[tiMinLength][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => MinLengthValidatorDirective),
                        multi: true
                    }]
            },] }
];
MinLengthValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [MinLengthValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(EmailValidatorDirective, EmailValidatorDirective.NAME))
class EmailValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(EmailValidatorDirective.NAME);
    }
}
EmailValidatorDirective.NAME = 'tiEmail';
EmailValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiEmail][formControlName],[tiEmail][formControl],[tiEmail][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => EmailValidatorDirective),
                        multi: true
                    }]
            },] }
];
EmailValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [EmailValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(NotScriptValidatorDirective, NotScriptValidatorDirective.NAME))
class NotScriptValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(NotScriptValidatorDirective.NAME);
    }
}
NotScriptValidatorDirective.NAME = 'tiNotScript';
NotScriptValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiNotScript][formControlName],[tiNotScript][formControl],[tiNotScript][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => NotScriptValidatorDirective),
                        multi: true
                    }]
            },] }
];
NotScriptValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [NotScriptValidatorDirective.NAME,] }]
};

// tslint:disable-next-line: ordered-imports
// @Directive(BaseValidator.getDirectiveConfig(ContainsValidatorDirective, ContainsValidatorDirective.NAME))
class ContainsValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(ContainsValidatorDirective.NAME);
    }
}
ContainsValidatorDirective.NAME = 'tiContains';
ContainsValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiContains][formControlName],[tiContains][formControl],[tiContains][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => ContainsValidatorDirective),
                        multi: true
                    }]
            },] }
];
ContainsValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [ContainsValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(NotContainsValidatorDirective, NotContainsValidatorDirective.NAME))
class NotContainsValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(NotContainsValidatorDirective.NAME);
    }
}
NotContainsValidatorDirective.NAME = 'tiNotContains';
NotContainsValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiNotContains][formControlName],[tiNotContains][formControl],[tiNotContains][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => NotContainsValidatorDirective),
                        multi: true
                    }]
            },] }
];
NotContainsValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [NotContainsValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(DateValidatorDirective, DateValidatorDirective.NAME))
class DateValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(DateValidatorDirective.NAME);
    }
}
DateValidatorDirective.NAME = 'tiDate';
DateValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiDate][formControlName],[tiDate][formControl],[tiDate][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => DateValidatorDirective),
                        multi: true
                    }]
            },] }
];
DateValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [DateValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(DigitsValidatorDirective, DigitsValidatorDirective.NAME))
class DigitsValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(DigitsValidatorDirective.NAME);
    }
}
DigitsValidatorDirective.NAME = 'tiDigits';
DigitsValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiDigits][formControlName],[tiDigits][formControl],[tiDigits][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => DigitsValidatorDirective),
                        multi: true
                    }]
            },] }
];
DigitsValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [DigitsValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(EqualValidatorDirective, EqualValidatorDirective.NAME))
class EqualValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(EqualValidatorDirective.NAME);
    }
}
EqualValidatorDirective.NAME = 'tiEqual';
EqualValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiEqual][formControlName],[tiEqual][formControl],[tiEqual][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => EqualValidatorDirective),
                        multi: true
                    }]
            },] }
];
EqualValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [EqualValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(Ipv4ValidatorDirective, Ipv4ValidatorDirective.NAME))
class Ipv4ValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(Ipv4ValidatorDirective.NAME);
    }
}
Ipv4ValidatorDirective.NAME = 'tiIpv4';
Ipv4ValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiIpv4][formControlName],[tiIpv4][formControl],[tiIpv4][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => Ipv4ValidatorDirective),
                        multi: true
                    }]
            },] }
];
Ipv4ValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [Ipv4ValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(Ipv6ValidatorDirective, Ipv6ValidatorDirective.NAME))
class Ipv6ValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(Ipv6ValidatorDirective.NAME);
    }
}
Ipv6ValidatorDirective.NAME = 'tiIpv6';
Ipv6ValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiIpv6][formControlName],[tiIpv6][formControl],[tiIpv6][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => Ipv6ValidatorDirective),
                        multi: true
                    }]
            },] }
];
Ipv6ValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [Ipv6ValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(MaxValueValidatorDirective, MaxValueValidatorDirective.NAME))
class MaxValueValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(MaxValueValidatorDirective.NAME);
    }
}
MaxValueValidatorDirective.NAME = 'tiMaxValue';
MaxValueValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiMaxValue][formControlName],[tiMaxValue][formControl],[tiMaxValue][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => MaxValueValidatorDirective),
                        multi: true
                    }]
            },] }
];
MaxValueValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [MaxValueValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(IntegerValidatorDirective, IntegerValidatorDirective.NAME))
class IntegerValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(IntegerValidatorDirective.NAME);
    }
}
IntegerValidatorDirective.NAME = 'tiInteger';
IntegerValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiInteger][formControlName],[tiInteger][formControl],[tiInteger][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => IntegerValidatorDirective),
                        multi: true
                    }]
            },] }
];
IntegerValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [IntegerValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(MinValueValidatorDirective, MinValueValidatorDirective.NAME))
class MinValueValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(MinValueValidatorDirective.NAME);
    }
}
MinValueValidatorDirective.NAME = 'tiMinValue';
MinValueValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiMinValue][formControlName],[tiMinValue][formControl],[tiMinValue][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => MinValueValidatorDirective),
                        multi: true
                    }]
            },] }
];
MinValueValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [MinValueValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(NotEqualValidatorDirective, NotEqualValidatorDirective.NAME))
class NotEqualValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(NotEqualValidatorDirective.NAME);
    }
}
NotEqualValidatorDirective.NAME = 'tiNotEqual';
NotEqualValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiNotEqual][formControlName],[tiNotEqual][formControl],[tiNotEqual][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => NotEqualValidatorDirective),
                        multi: true
                    }]
            },] }
];
NotEqualValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [NotEqualValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(NumberValidatorDirective, NumberValidatorDirective.NAME))
class NumberValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(NumberValidatorDirective.NAME);
    }
}
NumberValidatorDirective.NAME = 'tiNumber';
NumberValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiNumber][formControlName],[tiNumber][formControl],[tiNumber][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => NumberValidatorDirective),
                        multi: true
                    }]
            },] }
];
NumberValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [NumberValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(PasswordValidatorDirective, PasswordValidatorDirective.NAME))
class PasswordValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(PasswordValidatorDirective.NAME);
    }
}
PasswordValidatorDirective.NAME = 'tiPassword';
PasswordValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiPassword][formControlName],[tiPassword][formControl],[tiPassword][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => PasswordValidatorDirective),
                        multi: true
                    }]
            },] }
];
PasswordValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [PasswordValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(PortValidatorDirective, PortValidatorDirective.NAME))
class PortValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(PortValidatorDirective.NAME);
    }
}
PortValidatorDirective.NAME = 'tiPort';
PortValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiPort][formControlName],[tiPort][formControl],[tiPort][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => PortValidatorDirective),
                        multi: true
                    }]
            },] }
];
PortValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [PortValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(RegExpValidatorDirective, RegExpValidatorDirective.NAME))
class RegExpValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(RegExpValidatorDirective.NAME);
    }
}
RegExpValidatorDirective.NAME = 'tiRegExp';
RegExpValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiRegExp][formControlName],[tiRegExp][formControl],[tiRegExp][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => RegExpValidatorDirective),
                        multi: true
                    }]
            },] }
];
RegExpValidatorDirective.propDecorators = {
    baseValue: [{ type: Input, args: [RegExpValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(UrlValidatorDirective, UrlValidatorDirective.NAME))
// @Directive(BaseValidator.getDirectiveConfig(RequiredValidatorDirective, RequiredValidatorDirective.NAME))
class UrlValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(UrlValidatorDirective.NAME);
    }
}
UrlValidatorDirective.NAME = 'tiUrl';
UrlValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiUrl][formControlName],[tiUrl][formControl],[tiUrl][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => UrlValidatorDirective),
                        multi: true
                    }]
            },] }
];
UrlValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [UrlValidatorDirective.NAME,] }]
};

// @Directive(BaseValidator.getDirectiveConfig(RequiredValidatorDirective, RequiredValidatorDirective.NAME))
class RequiredValidatorDirective extends BaseValidator {
    constructor() {
        super(...arguments);
        this.validatorStr = BaseValidator.getValidatorStr(RequiredValidatorDirective.NAME);
    }
}
RequiredValidatorDirective.NAME = 'tiRequired';
RequiredValidatorDirective.decorators = [
    { type: Directive, args: [{
                selector: `[tiRequired][formControlName],[tiRequired][formControl],[tiRequired][ngModel]`,
                providers: [{
                        provide: NG_VALIDATORS,
                        // tslint:disable-next-line: no-forward-ref
                        useExisting: forwardRef(() => RequiredValidatorDirective),
                        multi: true
                    }]
            },] }
];
RequiredValidatorDirective.propDecorators = {
    enabled: [{ type: Input, args: [RequiredValidatorDirective.NAME,] }]
};

class TiValidationModule {
}
TiValidationModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiRendererModule,
                    TiTipModule,
                    TiLoadingModule
                ],
                // 下面必须写两遍，因为生产环境不允许编译之前执行函数。
                exports: [
                    BaseValidator,
                    TiErrorMsgComponent,
                    TiPendingStateComponent,
                    TiValidationDirective,
                    MaxLengthValidatorDirective, RangeSizeValidatorDirective, RangeValueValidatorDirective, MinLengthValidatorDirective,
                    EmailValidatorDirective, NotScriptValidatorDirective, ContainsValidatorDirective, NotContainsValidatorDirective,
                    DateValidatorDirective, DigitsValidatorDirective, EqualValidatorDirective, Ipv4ValidatorDirective, Ipv6ValidatorDirective,
                    MaxValueValidatorDirective, IntegerValidatorDirective,
                    MinValueValidatorDirective, NotEqualValidatorDirective, NumberValidatorDirective, PasswordValidatorDirective,
                    PortValidatorDirective, RegExpValidatorDirective, UrlValidatorDirective, RequiredValidatorDirective
                ],
                declarations: [
                    BaseValidator,
                    TiValidationDirective, TiPwdMsgComponent, TiPendingStateComponent, TiErrorMsgComponent,
                    MaxLengthValidatorDirective, RangeSizeValidatorDirective, RangeValueValidatorDirective, MinLengthValidatorDirective,
                    EmailValidatorDirective, NotScriptValidatorDirective, ContainsValidatorDirective, NotContainsValidatorDirective,
                    DateValidatorDirective, DigitsValidatorDirective, EqualValidatorDirective, Ipv4ValidatorDirective, Ipv6ValidatorDirective,
                    MaxValueValidatorDirective, IntegerValidatorDirective,
                    MinValueValidatorDirective, NotEqualValidatorDirective, NumberValidatorDirective, PasswordValidatorDirective,
                    PortValidatorDirective, RegExpValidatorDirective, UrlValidatorDirective, RequiredValidatorDirective
                ],
                entryComponents: [TiPwdMsgComponent, TiErrorMsgComponent, TiPendingStateComponent]
            },] }
];

class TiIpsectionModule {
}
TiIpsectionModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiMaskModule,
                    TiSelectModule,
                    TiTextModule,
                    ReactiveFormsModule,
                    TiValidationModule
                ],
                exports: [TiIpsectionComponent],
                declarations: [TiIpsectionComponent]
            },] }
];

/**
 * TiLeftmenu组件提供了一种方便灵活实现页面布局左侧菜单的方式，支持两级菜单。
 *
 * 其内部包含5个组件:
 *
 * TiLeftmenu : 左侧菜单最外层的指令；
 *
 * TiLeftmenuGroup: 菜单分组指令；
 *
 * TileftmenuGroupItem：分组文本内容指令；
 *
 * TiLeftmenuHead : 菜单头部内容指令；
 *
 * TiLeftmenuLevel1 ：一级菜单指令；
 *
 * TiLeftmenuItem ：一级菜单文本内容指令；
 *
 * TiLeftmenuLevel2 ：二级菜单指令。
 *
 * <example-url>../tiny3demo/#/leftmenu/leftmenu-all</example-url>
 */
class TiLeftmenuComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, router, activeRoute, tiRenderer, zone, document) {
        super(elementRef, renderer2);
        this.renderer2 = renderer2;
        this.router = router;
        this.activeRoute = activeRoute;
        this.tiRenderer = tiRenderer;
        this.zone = zone;
        this.document = document;
        /**
         * 激活菜单项改变时向外通知
         */
        this.activeChange = new EventEmitter();
        /**
         * 控制右侧内容区的刷新
         *
         * 注意：当重复点击当前激活菜单项时，需要刷新右侧内容区，为了实现此功能设置了该接口；
         * 该接口是双向绑定的，当重复点击当前激活菜单项时，reloadState的值会经历 true(上次的值) -> false -> true
         * 的变化过程，开发者给改接口与其右侧区域容器上ngIf接口绑定的是同一个变量，所以ngIf的值也会经历同样的变化，
         * 从而做到右侧内容区的刷新。
         */
        this.reloadState = true;
        /**
         * 右侧内容区是否需要刷新的状态值改变时向外通知
         */
        this.reloadStateChange = new EventEmitter();
        // routable接口在3.0.3版本起对外隐藏，10.0.1重新开放
        /**
         * 10.0.1新增
         *
         * 设置是否使用路由来控制菜单对应内容显示/隐藏，默认使用路由。
         */
        this.routable = true;
        /**
         * 是否开启左侧菜单面板可折叠功能，默认开启。
         */
        this.toggleable = true;
        /**
         * 左侧菜单面板是否为收起状态，用于设置面板收起/展开状态，默认展开。
         */
        this.collapsed = false;
        /**
         * 左侧菜单面板收起/展开状态改变时向外通知
         */
        this.collapsedChange = new EventEmitter();
        /**
         * @ignore
         * tiLeftmenu中包含的 TiLeftmenuLevel1Component 实例集合
         */
        this.level1Items = [];
        /**
         * @ignore
         */
        this.resolvedPromise = Promise.resolve(null);
        /**
         * 标志量，是否为url改变(需要去改变active)
         */
        this.isUrlChange = false;
    }
    // 判断item的router是否是父路由下默认激活的子路由（即子路由与父路由路径一致）
    static isDefaultActiveChildRoute(item) {
        // 默认激活的子路由的router可设为[]或['']
        return !item.router || item.router.length === 0 || item.router[0] === '';
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始时右侧内容区默认显示，需使外部用户的reloadState值为true。
        // 双向绑定数据时，对初始传入的值立即修改并传出时会报错，
        // 此处参考ngModel源码setValue的处理，使用promise延后执行时序
        this.resolvedPromise.then(() => {
            this.reloadStateChange.emit(true);
        });
        this.scrollWidth = this.getScrollbarSize('Y');
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        if (!this.routable) {
            return;
        }
        // 直接输入url(刷新页面)改变状态时，leftmenu能同步修改激活状态
        const urlActiveItem = this.getActiveItemByUrl(this.level1Items);
        if (urlActiveItem) {
            // 双向绑定数据时，对初始传入的值立即修改并传出时会报错，
            // 此处参考ngModel源码setValue的处理，使用promise延后执行时序
            this.resolvedPromise.then(() => {
                if (urlActiveItem !== this.active) {
                    this.isUrlChange = true;
                    this.active = urlActiveItem;
                    this.activeChange.emit(this.active);
                }
            });
        }
        else {
            this.link();
        }
        // 从非leftMenu处跳转改变状态时，leftmenu能同步修改激活状态
        this.navigationSubscription = this.router.events.subscribe((evt) => {
            if (evt instanceof NavigationEnd) {
                const newActiveItem = this.getActiveItemByUrl(this.level1Items);
                if (newActiveItem && newActiveItem !== this.active) {
                    this.active = newActiveItem;
                    this.activeChange.emit(this.active);
                    this.isUrlChange = true;
                }
            }
        });
        this.panelContainer = this.nativeElement.querySelector('.ti3-leftmenu-panel-container');
        const headElement = this.nativeElement.querySelector('.ti3-leftmenu-head');
        let headCloneElement;
        this.zone.runOutsideAngular(() => {
            this.renderer2.listen(this.panelContainer, 'scroll', () => {
                const scrollTop = this.panelContainer.scrollTop;
                if (scrollTop > 0) {
                    if (!headCloneElement) {
                        headCloneElement = headElement.cloneNode(true);
                        this.renderer2.addClass(headCloneElement, 'ti3-leftmenu-head-clone');
                        this.renderer2.setStyle(headCloneElement, 'width', `calc(100% - ${this.scrollWidth}px)`);
                        this.nativeElement.appendChild(headCloneElement);
                    }
                }
                else if (headCloneElement) {
                    this.nativeElement.removeChild(headCloneElement);
                    headCloneElement = undefined;
                }
            });
        });
    }
    ngOnChanges(changes) {
        const activeObj = changes['active'];
        if (activeObj && !activeObj.firstChange) {
            for (const level1Item of this.level1Items) {
                level1Item.setShowChildren();
                level1Item.setActiveState();
            }
            if (this.routable && !this.isUrlChange) {
                this.link();
            }
            this.isUrlChange = false;
        }
    }
    ngOnDestroy() {
        if (this.navigationSubscription) {
            this.navigationSubscription.unsubscribe();
        }
    }
    /**
     * @ignore
     * 模板中使用
     */
    toggleClickFn() {
        this.collapsed = !this.collapsed;
        this.collapsedChange.emit(this.collapsed);
    }
    getActiveItemByUrl(arr) {
        let resultItem;
        for (const component of arr) {
            if (this.isActived(component.item)) {
                resultItem = component.item;
                if (TiLeftmenuComponent.isDefaultActiveChildRoute(component.item)) {
                    continue;
                }
                else {
                    return resultItem;
                }
            }
            if (component.children && component.children.length > 0) {
                const result = this.getActiveItemByUrl(component.children);
                if (result) {
                    return result;
                }
            }
        }
        return resultItem;
    }
    isActived(item) {
        const relativeRoute = this.getRelativeRoute(item.routerExtras);
        if (this.isMatchCurrentUrl(item.router, relativeRoute)) {
            return true;
        }
        if (Util.isArray(item.routerList) && item.routerList.length > 0) {
            for (const router of item.routerList) {
                if (this.isMatchCurrentUrl(router, relativeRoute)) {
                    return true;
                }
            }
        }
        return false;
    }
    isMatchCurrentUrl(router, relativeRoute) {
        if (!Util.isArray(router)) {
            return false;
        }
        const itemUrlTree = this.router.createUrlTree(router, relativeRoute);
        return this.router.isActive(itemUrlTree, false);
    }
    link() {
        if (this.active) {
            this.navigate(this.active);
        }
    }
    /**
     * @ignore
     */
    navigate(item) {
        if (TiLeftmenuComponent.isDefaultActiveChildRoute(item)) {
            //  routeConfig 可能为null
            if (!this.activeRoute.routeConfig) {
                return;
            }
            const path = this.activeRoute.routeConfig.path;
            const url = this.router.routerState.snapshot.url;
            const rootUrl = url.split(path)[0];
            // 绝对路径跳转
            this.router.navigate([rootUrl + path], item.routerExtras);
        }
        else {
            this.router.navigate(item.router, this.getNavigationExtras(item.routerExtras));
        }
    }
    /**
     * @ignore
     * 点击当前选中项时，触发内容区重载
     * @param item 当前点击项
     */
    triggerReload(item) {
        // 使reloadState由false变为true,配合内容区的ngIf做到内容区的重载
        this.reloadStateChange.emit(false);
        setTimeout(() => {
            this.reloadStateChange.emit(true);
            // 如果当前路由就是item.router对应路由，则此导航不作用(路由相同)；
            // 如果当前路由是item.routerList中的路由，则需要跳转到item.router对应路由
            this.navigate(item);
        }, 0);
    }
    getNavigationExtras(routerExtras) {
        return Object.assign({ relativeTo: this.activeRoute }, routerExtras);
    }
    getRelativeRoute(routerExtras) {
        if (!routerExtras || !routerExtras['relativeTo']) {
            return { relativeTo: this.activeRoute };
        }
        return { relativeTo: routerExtras['relativeTo'] };
    }
    /**
 * 得到浏览器滚动条的宽度和高度
 * 代表滚动条的方向，取值为X or Y
 */
    getScrollbarSize(direction) {
        const outerDiv = this.renderer.createElement('div');
        const innerDiv = this.renderer.createElement('div');
        this.renderer.setStyle(innerDiv, 'width', '100%');
        this.renderer.setStyle(innerDiv, 'height', '100%');
        this.renderer.appendChild(outerDiv, innerDiv);
        this.tiRenderer.setStyles(outerDiv, {
            position: 'absolute',
            top: '-9999px',
            left: '-9999px',
            width: '100px',
            height: '100px',
            overflow: 'hidden'
        });
        this.renderer.appendChild(this.document.body, outerDiv);
        const field = direction === 'X' ? 'height' : 'width';
        const noScrollSize = typeof innerDiv.getBoundingClientRect === 'function' ? innerDiv.getBoundingClientRect()[field] : 0;
        this.renderer.setStyle(outerDiv, 'overflow', 'scroll');
        const withScrollSize = typeof innerDiv.getBoundingClientRect === 'function' ? innerDiv.getBoundingClientRect()[field] : 0;
        this.document.body.removeChild(outerDiv);
        return parseFloat((noScrollSize - withScrollSize).toFixed(1));
    }
}
TiLeftmenuComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu',
                template: "<div  class=\"ti3-leftmenu-panel-container\">\r\n    <div class=\"ti3-leftmenu-panel\">\r\n        <ng-content></ng-content>\r\n    </div>\r\n</div>\r\n<ng-content *ngIf='!collapsed' select=\"ti-leftmenu-foot\"></ng-content>\r\n<div class=\"ti3-leftmenu-toggle\"\r\n     *ngIf=\"toggleable\"\r\n     [ngClass]=\"{'ti3-leftmenu-toggle-show' : !collapsed,\r\n                 'ti3-leftmenu-toggle-hide' : collapsed }\"\r\n    [tabindex]=\"0\"\r\n    tiOutline\r\n    (keydown.enter)=\"toggleClickFn()\"\r\n    (click)=\"toggleClickFn()\"\r\n    [id]=\"appendId('toggle')\">\r\n</div>\r\n",
                host: {
                    '[class.ti3-leftmenu-container]': 'true',
                    '[class.ti3-leftmenu-hide]': 'collapsed'
                },
                encapsulation: ViewEncapsulation.None,
                styles: [":root{--ti-leftmenu-level2-left-line:30px;--ti-leftmenu-toggle-width:12px}.ti3-leftmenu-container{background-color:var(--ti-leftmenu-container-bg-color);bottom:0;box-shadow:var(--ti-common-shadow-1-right);display:block;left:0;position:fixed;top:0;width:var(--ti-leftmenu-width);z-index:990}.ti3-leftmenu-container.ti3-leftmenu-hide{width:0!important}.ti3-leftmenu-container.ti3-leftmenu-hide .ti3-leftmenu-panel-container{height:0!important}.ti3-leftmenu-container.ti3-leftmenu-hide .ti3-leftmenu-foot,.ti3-leftmenu-container.ti3-leftmenu-hide .ti3-leftmenu-head{margin:0;padding:0}.ti3-leftmenu-panel-container{overflow-x:hidden;overflow-y:auto}.ti3-leftmenu-panel,.ti3-leftmenu-panel-container{-ms-box-sizing:border-box;bottom:0;box-sizing:border-box;left:0;position:absolute;top:0;width:100%}.ti3-leftmenu-panel{color:var(--ti-common-color-text-secondary);font-size:var(--ti-leftmenu-font-size);overflow-x:visible;overflow-y:visible;padding:0 2px}.ti3-leftmenu-toggle{background-color:var(--ti-leftmenu-container-bg-color);border-radius:0 var(--ti-leftmenu-toggle-width) var(--ti-leftmenu-toggle-width) 0;cursor:pointer;height:80px;position:absolute;top:50%;transform:translateY(-50%);width:var(--ti-leftmenu-toggle-width)}.ti3-leftmenu-toggle:after{border-left:calc(var(--ti-leftmenu-angle-normal-width)/2) solid transparent;border-right:calc(var(--ti-leftmenu-angle-normal-width)/2) solid transparent;border-top:var(--ti-leftmenu-angle-normal-height) solid var(--ti-leftmenu-icon-color-nomal);content:\"\";display:block;height:0;left:calc(50% - var(--ti-leftmenu-angle-normal-width)/2);position:relative;top:calc(50% - var(--ti-leftmenu-angle-normal-height)/2);transform:rotate(90deg);width:0}.ti3-leftmenu-toggle.ti3-leftmenu-toggle-show{left:auto;right:calc(-1*var(--ti-leftmenu-toggle-width))}.ti3-leftmenu-toggle.ti3-leftmenu-toggle-hide{left:0;right:auto}.ti3-leftmenu-toggle.ti3-leftmenu-toggle-hide:after{transform:rotate(270deg)}.ti3-leftmenu-head{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-leftmenu-head-text-color);display:block;font-size:var(--ti-leftmenu-head-font-size);line-height:20px;margin-bottom:10px;overflow:hidden;padding:var(--ti-leftmenu-head-padding);text-align:var(--ti-leftment-leftmenu-head-text-align)}.ti3-leftmenu-head:after{border-bottom:1px solid var(--ti-leftmenu-head-line-dividing-color);bottom:-20px;content:\"\";display:block;position:relative;width:100%}.ti3-leftmenu-head-clone{background:var(--ti-leftmenu-container-bg-color);left:0;position:absolute;top:0;z-index:3}.ti3-leftmenu-level1{display:block;margin:0;padding:0}.ti3-leftmenu-level1+.ti3-leftmenu-group-container:before{border:1px dashed var(--ti-common-color-line-dividing);bottom:auto;content:\"\";left:var(--ti-leftmenu-group-padding-left);position:absolute;top:-2px;width:calc(100% - var(--ti-leftmenu-group-padding-left) - var(--ti-leftmenu-group-padding-right))}.ti3-leftmenu-level1-dividing{position:relative}.ti3-leftmenu-level1-dividing:after{border:1px dashed var(--ti-common-color-line-dividing);bottom:0;content:\"\";left:var(--ti-leftmenu-group-padding-left);position:absolute;top:auto;width:calc(100% - var(--ti-leftmenu-group-padding-left) - var(--ti-leftmenu-group-padding-right))}.ti3-leftmenu-level2-container{position:relative}.ti3-leftmenu-level2-container:after{border:1px solid var(--ti-common-color-line-dividing);bottom:var(--ti-common-space-10);content:\"\";display:block;left:var(--ti-leftmenu-level2-left-line);position:absolute;top:var(--ti-common-space-10)}.ti3-leftmenu-level1-item{-ms-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:block;line-height:var(--ti-common-line-height-number);position:relative}.ti3-leftmenu-level1-item .ti3-leftmenu-triangle.ti3-leftmenu-triangle-down{transform:rotate(0)}.ti3-leftmenu-level1-item .ti3-leftmenu-triangle.ti3-leftmenu-triangle-up{transform:rotate(180deg)}.ti3-leftmenu-level1-item:hover{background-color:var(--ti-leftmenu-item-bg-color-hover);color:var(--ti-leftmenu-item-text-color-hover)}.ti3-leftmenu-level1-item:hover .ti3-leftmenu-triangle.ti3-leftmenu-triangle-down,.ti3-leftmenu-level1-item:hover .ti3-leftmenu-triangle.ti3-leftmenu-triangle-up{border-top-color:var(--ti-leftmenu-icon-color-hover)}.ti3-leftmenu-level1-item.ti3-leftmenu-level1-active-item{color:var(--ti-leftmenu-item-selected-text-color)}.ti3-leftmenu-level1-active-item,.ti3-leftmenu-level2-active{position:relative}.ti3-leftmenu-level1-active-item .ti3-leftmenu-triangle.ti3-leftmenu-triangle-down,.ti3-leftmenu-level2-active .ti3-leftmenu-triangle.ti3-leftmenu-triangle-down{border-top-color:var(--ti-leftmenu-icon-color-hover)}.ti3-leftmenu-level1-active-item:before,.ti3-leftmenu-level2-active:before{background:var(--ti-leftmenu-item-selected-border-left-color);bottom:var(--ti-common-space-10);content:\"\";position:absolute;top:var(--ti-common-space-10);width:var(--ti-leftmenu-border-left-width);z-index:1}.ti3-leftmenu-level1-active-item:before{left:var(--ti-common-space-10)}.ti3-leftmenu-level2-active:before{left:var(--ti-leftmenu-level2-left-line)}.ti3-leftmenu-level1-label{display:block;padding:var(--ti-leftmenu-level1-label-padding)}.ti3-leftmenu-level1-state-icon{font-size:12px;position:absolute;right:9px;top:calc(50% - 11px)}.ti3-leftmenu-level2{-ms-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:block;line-height:var(--ti-common-line-height-number);padding:var(--ti-leftmenu-second-level-padding);position:relative}.ti3-leftmenu-level2:hover{background-color:var(--ti-leftmenu-item-bg-color-hover);color:var(--ti-leftmenu-item-text-color-hover)}.ti3-leftmenu-level2.ti3-leftmenu-level2-active{color:var(--ti-leftmenu-item-selected-text-color)}.ti3-leftmenu-triangle{border-left:calc(var(--ti-leftmenu-angle-normal-width)/2) solid transparent;border-right:calc(var(--ti-leftmenu-angle-normal-width)/2) solid transparent;border-top:var(--ti-leftmenu-angle-normal-height) solid var(--ti-leftmenu-icon-color-nomal);content:\"\";height:0;position:absolute;right:14px;top:calc(50% - var(--ti-leftmenu-angle-normal-height)/2);width:0}.ti3-leftmenu-href{font-size:16px;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.ti3-leftmenu-logo{height:60px}.ti3-leftmenu-logo .ti3-leftmenu-logo-ficon{color:var(--ti-leftmenu-head-text-color);font-size:60px;line-height:60px;vertical-align:middle}.ti3-leftmenu-item-group:after{border-top:1px dashed var(--ti-common-color-line-dividing);content:\"\";display:block;margin:var(--ti-common-space-10) var(--ti-leftmenu-group-padding-right) var(--ti-common-space-10) var(--ti-leftmenu-group-padding-left)}.ti3-leftmenu-content{background:#fff;bottom:0;left:240px;overflow:auto;position:absolute;right:0;top:0}.ti3-leftmenu-group-container{display:block;position:relative}.ti3-leftmenu-group-container:after{border:1px dashed var(--ti-common-color-line-dividing);bottom:0;content:\"\";left:var(--ti-leftmenu-group-padding-left);position:absolute;top:auto;width:calc(100% - var(--ti-leftmenu-group-padding-left) - var(--ti-leftmenu-group-padding-right))}.ti3-leftmenu-group-container:last-child:after{display:none}.ti3-leftmenu-group-wrapper{color:var(--ti-common-color-text-weaken);cursor:pointer;line-height:var(--ti-common-line-height-number);padding:var(--ti-leftmenu-group-padding-top) var(--ti-leftmenu-group-padding-right) var(--ti-leftmenu-group-padding-bottom) var(--ti-leftmenu-group-padding-left);position:relative}.ti3-leftmenu-group-wrapper .ti3-leftmenu-triangle-down{transform:rotate(0)}.ti3-leftmenu-group-wrapper .ti3-leftmenu-triangle-up{display:none}.ti3-leftmenu-group-wrapper:hover{background:var(--ti-leftmenu-item-bg-color-hover);color:var(--ti-leftmenu-item-text-color-hover)}.ti3-leftmenu-group-wrapper:hover .ti3-leftmenu-triangle-down{border-top-color:var(--ti-leftmenu-icon-color-hover)}.ti3-leftmenu-group-wrapper:hover .ti3-leftmenu-triangle-up{border-top-color:var(--ti-leftmenu-icon-color-hover);display:block;transform:rotate(180deg)}.ti3-leftmenu-group-active{color:var(--ti-leftmenu-item-text-color-hover)}.ti3-leftmenu-group-active .ti3-leftmenu-triangle-down{border-top-color:var(--ti-leftmenu-icon-color-hover)}.ti3-leftmenu-group-active:before{background:var(--ti-leftmenu-icon-color-hover);content:\"\";height:calc(100% - var(--ti-leftmenu-group-padding-top) - var(--ti-leftmenu-group-padding-bottom));left:10px;position:absolute;top:var(--ti-leftmenu-group-padding-top);width:2px}.ti3-leftmenu-foot{-ms-box-sizing:border-box;background:var(--ti-leftmenu-container-bg-color);bottom:0;box-sizing:border-box;color:var(--ti-leftmenu-foot-text-color);line-height:var(--ti-common-line-height-number);overflow:hidden;padding:var(--ti-leftmenu-foot-padding-top) 0 var(--ti-leftmenu-foot-padding-bottom) var(--ti-leftmenu-foot-padding-left);position:absolute;stroke-width:var(--ti-leftmenu-foot-space-right);text-align:var(--ti-leftment-leftmenu-head-text-align);z-index:3}.ti3-leftmenu-foot:hover{color:var(--ti-leftmenu-foot-text-color-hover);cursor:pointer}.ti3-leftmenu-foot:before{border-bottom:1px solid var(--ti-common-color-line-dividing);content:\"\";display:block;left:0;position:relative;top:calc(-1*var(--ti-leftmenu-foot-padding-top))}"]
            },] }
];
TiLeftmenuComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: Router, decorators: [{ type: Optional }] },
    { type: ActivatedRoute, decorators: [{ type: Optional }] },
    { type: TiRenderer },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiLeftmenuComponent.propDecorators = {
    active: [{ type: Input }],
    activeChange: [{ type: Output }],
    reloadState: [{ type: Input }],
    reloadStateChange: [{ type: Output }],
    routable: [{ type: Input }],
    toggleable: [{ type: Input }],
    collapsed: [{ type: Input }],
    collapsedChange: [{ type: Output }]
};

/**
 * TiLeftmenuHead是菜单头部组件，其包裹的元素会作为leftmenu的菜单头部
 */
class TiLeftmenuHeadComponent {
}
TiLeftmenuHeadComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-head',
                template: "<ng-content></ng-content>\r\n",
                host: {
                    '[class.ti3-leftmenu-head]': 'true'
                }
            },] }
];

/**
 * TiLeftmenuGroupItem 是分组菜单文本内容组件，嵌在 TiLeftmenuGroupComponent组件中使用，其包裹的元素会作为 leftmenu 的分组菜单项内容显示
 *
 * 3.1.3新增
 *
 */
class TiLeftmenuGroupItemComponent {
}
TiLeftmenuGroupItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-group-item',
                template: "<ng-content></ng-content>"
            },] }
];

/**
 * TiLeftmenuGroup 是分组菜单组件，嵌在 TiLeftmenu组件中使用。
 *
 * 3.1.3新增
 *
 */
class TiLeftmenuGroupComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 设置当前分组菜单项是否展开
         */
        this.expanded = false;
        /**
         * @ignore
         * 当前TiLeftmenuGroup下的所有TiLeftmenuLevel1的集合
         */
        this.children = [];
    }
    /**
     * @ignore
     * 在模板中使用，实现分组的展开与收起
     */
    clickGroup() {
        this.expanded = !this.expanded;
    }
    /**
     * @ignore
     * 在模板中使用，当前分组中的子项是否有激活项
     */
    hasActivedChild() {
        if (!this.children || this.children.length <= 0) {
            return false;
        }
        for (const level1 of this.children) {
            if (level1.isActived || level1.hasActivedChildren()) {
                return true;
            }
        }
        return false;
    }
}
TiLeftmenuGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-group',
                template: "<div class=\"ti3-leftmenu-group-wrapper\"\r\n    [ngClass]=\"{'ti3-leftmenu-group-active': !expanded && hasActivedChild()}\"\r\n    [tabindex]=\"0\"\r\n    tiOutline\r\n    (click)=\"clickGroup()\"\r\n    (keydown.enter)=\"clickGroup()\"\r\n    [id]=\"appendId('leftmenu_group')\">\r\n    <ng-content select='ti-leftmenu-group-item'></ng-content>\r\n    <span class=\"ti3-leftmenu-triangle\" [ngClass]=\"{'ti3-leftmenu-triangle-down' : !expanded ,\r\n    'ti3-leftmenu-triangle-up' : expanded}\"></span>\r\n</div>\r\n<div [hidden]=\"!expanded\">\r\n    <ng-content></ng-content>\r\n</div>",
                host: {
                    '[class.ti3-leftmenu-group-container]': 'true'
                }
            },] }
];
TiLeftmenuGroupComponent.propDecorators = {
    expanded: [{ type: Input }]
};

/**
 * TiLeftmenuItem 是一级菜单文本内容组件，嵌在 TiLeftmenuLevel1Component组件中使用，其包裹的元素会作为 leftmenu 的一级菜单的菜单项内容显示
 */
class TiLeftmenuItemComponent {
    constructor(elementRef) {
        this.element = elementRef.nativeElement;
    }
}
TiLeftmenuItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-item',
                template: "<ng-content></ng-content>",
                host: {
                    '[class.ti3-leftmenu-level1-label]': 'true'
                }
            },] }
];
TiLeftmenuItemComponent.ctorParameters = () => [
    { type: ElementRef }
];

/**
 * TiLeftmenuLevel1Component 是一级菜单组件，嵌在 TiLeftmenu 中使用
 *
 */
class TiLeftmenuLevel1Component extends TiBaseComponent {
    constructor(leftmenu, elementRef, renderer2, changeRef, leftmenuGroup, domSanitizer) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.changeRef = changeRef;
        this.leftmenuGroup = leftmenuGroup;
        this.domSanitizer = domSanitizer;
        /**
         * @ignore
         * 当前 TiLeftmenuLevel1下所有的 TiLeftmenuLevel2 的集合
         */
        this.children = [];
        /**
         * @ignore
         * 模板中使用，二级菜单是否展开
         */
        this.showChildren = false;
        /**
         * @ignore
         * 模板中使用，是否是激活状态
         */
        this.isActived = false;
        this.element = this.elementRef.nativeElement;
        this.leftmenu = leftmenu;
    }
    ngOnInit() {
        if (this.leftmenuGroup) {
            this.leftmenuGroup.children.push(this);
        }
    }
    ngAfterViewInit() {
        this.setShowChildren();
        this.setActiveState();
        this.leftmenu.level1Items.push(this);
        this.changeRef.detectChanges();
    }
    ngOnDestroy() {
        const index = this.leftmenu.level1Items.indexOf(this);
        if (this.leftmenuGroup) {
            const groupIndex = this.leftmenuGroup.children.indexOf(this);
            if (groupIndex !== -1) {
                this.leftmenuGroup.children.splice(groupIndex, 1);
            }
        }
        if (index !== -1) {
            this.leftmenu.level1Items.splice(index, 1);
        }
    }
    /**
     * @ignore
     * 模板中使用，点击一级菜单项时调用
     */
    selectFn() {
        if (this.item.href) {
            this.openHref(this.item.href);
            this.element.querySelector('.ti3-leftmenu-level1-item')
                .blur();
            return;
        }
        const oldactive = this.leftmenu.active;
        if (this.hasChildren()) {
            this.showChildren = !this.showChildren;
            this.isActived = !this.showChildren && this.hasActivedChildren();
            if (this.showChildren) {
                for (const level1Items of this.leftmenu.level1Items) {
                    if (level1Items === this) {
                        continue;
                    }
                    if (level1Items.showChildren) {
                        level1Items.showChildren = false;
                        if (level1Items.hasActivedChildren()) {
                            level1Items.isActived = true;
                        }
                        break;
                    }
                }
            }
        }
        else {
            if (this.leftmenu.routable) {
                // 点击当前已经激活的item时，刷新对应路由
                if (this.item === oldactive) {
                    this.leftmenu.triggerReload(this.item);
                }
                else {
                    // 点击其他项需要进行跳转，来触发路由守卫，实际是否跳转取决于路由守卫返回值。
                    this.leftmenu.navigate(this.item);
                }
            }
            else {
                if (this.item !== oldactive) {
                    this.leftmenu.active = this.item;
                    this.leftmenu.activeChange.emit(this.item);
                    this.isActived = true;
                }
            }
        }
    }
    /**
     * @ignore
     * 在 TiLeftmenuComponent.ts 中调用了
     */
    setShowChildren() {
        // 初始化时，子菜单中有当前选中状态时，显示子菜单
        this.showChildren = this.hasActivedChildren();
    }
    /**
     * @ignore
     * 在模板上使用
     */
    hasChildren() {
        return this.children && this.children.length > 0;
    }
    /**
     * @ignore
     * 在模板上使用
     */
    hasActivedChildren() {
        if (!this.hasChildren()) {
            return false;
        }
        const result = this.children.filter((level2) => {
            return level2.item === this.leftmenu.active;
        });
        return result.length > 0;
    }
    /**
     * @ignore
     * 设置当前菜单是否处于激活状态，下边两种情况下将当前菜单设置为激活状态：
     *
     * 有子菜单时，当子菜单有有激活状态项并且子菜单关闭状态情况下；
     *
     * 没有子菜单时，当前菜单就是激活菜单项。
     */
    setActiveState() {
        this.isActived = (this.hasActivedChildren() && !this.showChildren)
            || this.item === this.leftmenu.active;
    }
    /**
     * @ignore
     */
    onStateIconClick() {
        Util.trigger(this.leftmenuItem.element, 'click');
    }
    /**
     * @ignore
     * 如果有链接，跳转新页面
     */
    openHref(href) {
        const newTab = window.open(this.domSanitizer.sanitize(SecurityContext.URL, href), '_blank');
        // IE 下有时 newTab 不存在
        if (newTab) {
            newTab.opener = null;
        }
    }
}
TiLeftmenuLevel1Component.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-level1',
                template: "<div [ngClass]=\"{'ti3-leftmenu-level1-active-item' : isActived ,\r\n                 'ti3-leftmenu-level1-open-item' : showChildren}\"\r\n     class=\"ti3-leftmenu-level1-item\"\r\n     tabindex=\"0\"\r\n     tiOutline\r\n     (click)=\"selectFn()\"\r\n     (keyup.enter)=\"selectFn()\"\r\n     [id]=\"appendId('leftmenu_level1')\">\r\n\r\n        <ng-content select=\"ti-leftmenu-item\"></ng-content>\r\n        <!-- \u5C0F\u4E09\u89D2 -->\r\n        <span class=\"ti3-leftmenu-triangle\"\r\n              [ngClass]=\"{'ti3-leftmenu-triangle-up' : showChildren,\r\n                          'ti3-leftmenu-triangle-down' : !showChildren}\"\r\n              *ngIf=\"hasChildren() && !item.href\"\r\n              (click)=\"onStateIconClick()\"></span>\r\n        <!-- \u94FE\u63A5\u56FE\u6807 -->\r\n        <span *ngIf=\"item.href\" class=\"ti3-icon-action-binding ti3-icon ti3-leftmenu-href\"></span>\r\n</div>\r\n<div [hidden]=\"!showChildren\" [ngClass]=\"{'ti3-leftmenu-level2-container': showChildren}\">\r\n    <ng-content></ng-content>\r\n</div>\r\n",
                host: {
                    '[class.ti3-leftmenu-level1]': 'true',
                    '[class.ti3-leftmenu-level1-dividing]': 'item.showDividingLine'
                }
            },] }
];
TiLeftmenuLevel1Component.ctorParameters = () => [
    { type: TiLeftmenuComponent },
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: TiLeftmenuGroupComponent, decorators: [{ type: Optional }] },
    { type: DomSanitizer }
];
TiLeftmenuLevel1Component.propDecorators = {
    item: [{ type: Input }],
    leftmenuItem: [{ type: ContentChild, args: [TiLeftmenuItemComponent, /* TODO: add static flag */ { static: true },] }]
};

/**
 * TiLeftmenuLevel2Component 是二级菜单组件，嵌在 TiLeftmenuLevel1 中使用
 */
class TiLeftmenuLevel2Component extends TiBaseComponent {
    constructor(elementRef, renderer2, leftmenu, level1, zone) {
        super(elementRef, renderer2);
        this.level1 = level1;
        this.zone = zone;
        this.leftmenu = leftmenu;
        this.level2Ele = elementRef;
        this.renderer = renderer2;
    }
    ngOnInit() {
        this.level1.children.push(this);
    }
    ngAfterViewInit() {
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(this.level2Ele.nativeElement, 'mousedown', () => {
                this.renderer.setStyle(this.level2Ele.nativeElement, 'outline', 'none');
            });
            this.renderer.listen(this.level2Ele.nativeElement, 'blur', () => {
                this.renderer.setStyle(this.level2Ele.nativeElement, 'outline', '');
            });
        });
    }
    /**
     * @ignore
     * 模板中使用，点击二级菜单项时调用
     */
    selectFn() {
        if (this.item.href) {
            this.level1.openHref(this.item.href);
            this.level2Ele.nativeElement.blur(); // 为了没有outline。
            return;
        }
        if (this.leftmenu.routable) {
            // 点击当前已经激活的item时，刷新对应路由
            if (this.leftmenu.active === this.item) {
                this.leftmenu.triggerReload(this.item);
            }
            else {
                // 点击其他项需要进行跳转，来触发路由守卫，实际是否跳转取决于路由守卫返回值。
                this.leftmenu.navigate(this.item);
            }
        }
        else {
            if (this.leftmenu.active !== this.item) {
                this.leftmenu.active = this.item;
                this.leftmenu.activeChange.emit(this.item);
            }
        }
    }
    ngOnDestroy() {
        const index = this.level1.children.indexOf(this);
        if (index !== -1) {
            this.level1.children.splice(index, 1);
        }
    }
}
TiLeftmenuLevel2Component.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-level2',
                template: "<ng-content></ng-content>\r\n<!-- \u94FE\u63A5\u56FE\u6807 -->\r\n<span *ngIf=\"item.href\" class=\"ti3-icon-action-binding ti3-icon ti3-leftmenu-href\"></span>\r\n",
                host: {
                    '[class.ti3-leftmenu-level2]': 'true',
                    '[class.ti3-leftmenu-level2-active]': 'this.item === this.leftmenu.active',
                    '[attr.tabindex]': '0',
                    '[id]': 'appendId("leftmenu_level2")',
                    '(click)': 'selectFn()',
                    '(keyup.enter)': 'selectFn()'
                }
            },] }
];
TiLeftmenuLevel2Component.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiLeftmenuComponent },
    { type: TiLeftmenuLevel1Component },
    { type: NgZone }
];
TiLeftmenuLevel2Component.propDecorators = {
    item: [{ type: Input }]
};

class TiLeftmenuFootComponent {
    constructor(renderer2, elementRef, tiLeftmenu) {
        this.renderer2 = renderer2;
        this.elementRef = elementRef;
        this.tiLeftmenu = tiLeftmenu;
    }
    ngAfterViewInit() {
        const templateDom = this.renderer2.createElement('div');
        const panelDom = this.tiLeftmenu.nativeElement.querySelector('.ti3-leftmenu-panel');
        const hostElement = this.elementRef.nativeElement;
        // 修复SSR错误：ERROR ReferenceError: getComputedStyle is not defined
        const spaceRight = typeof getComputedStyle === 'function' ? getComputedStyle(hostElement).getPropertyValue('stroke-width') : '0';
        this.renderer2.setStyle(templateDom, 'height', hostElement.offsetHeight + 'px');
        this.renderer2.appendChild(panelDom, templateDom);
        this.renderer2.setStyle(hostElement, 'width', `calc(100% - ${this.tiLeftmenu.scrollWidth}px)`);
        this.renderer2.setStyle(hostElement, 'marginRight', `${this.tiLeftmenu.scrollWidth}px`);
        this.renderer2.setStyle(hostElement, 'paddingRight', `calc(${spaceRight} - ${this.tiLeftmenu.scrollWidth}px)`);
    }
}
TiLeftmenuFootComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-foot',
                template: "<ng-content></ng-content>",
                host: {
                    '[class.ti3-leftmenu-foot]': 'true'
                }
            },] }
];
TiLeftmenuFootComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: TiLeftmenuComponent }
];

class TiLeftmenuModule {
}
TiLeftmenuModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiRendererModule,
                    TiOutlineModule
                ],
                exports: [TiLeftmenuComponent,
                    TiLeftmenuHeadComponent,
                    TiLeftmenuLevel1Component,
                    TiLeftmenuItemComponent,
                    TiLeftmenuLevel2Component,
                    TiLeftmenuGroupComponent,
                    TiLeftmenuGroupItemComponent,
                    TiLeftmenuFootComponent],
                declarations: [TiLeftmenuComponent,
                    TiLeftmenuHeadComponent,
                    TiLeftmenuLevel1Component,
                    TiLeftmenuItemComponent,
                    TiLeftmenuLevel2Component,
                    TiLeftmenuGroupComponent,
                    TiLeftmenuGroupItemComponent,
                    TiLeftmenuFootComponent]
            },] }
];

/**
 * @ignore
 */
class TiTableFixedHeadServiceModule {
}
TiTableFixedHeadServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: []
            },] }
];

/**
 * @ignore
 * 提供表头锁定功能
 */
class TiTableFixedHeadService {
    constructor(rendererFactory, tiRenderer) {
        this.tiRenderer = tiRenderer;
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    getTheadContainer(hostEle) {
        return this.tiRenderer.findChildrenByClassName(hostEle, 'ti3-table-fixed-head')[0];
    }
    getTbodyContainer(theadContainer) {
        const tbodyContainer = theadContainer.nextElementSibling;
        if (tbodyContainer && this.tiRenderer.hasClass(tbodyContainer, 'ti3-table-container')) {
            return tbodyContainer;
        }
        return;
    }
    processOverflowY(theadContainer, tbodyContainer, tableCom) {
        const headTable = theadContainer.children[0];
        const scrollBarWidth = this.getScrollBarWidth('Y');
        const isOverflowedY = this.overflowedResult(tbodyContainer, 'Y');
        const isOverflowedX = this.overflowedResult(tbodyContainer, 'X');
        // 根据表体的宽度来设置表头的宽度
        if (isOverflowedY && !isOverflowedX) {
            this.renderer.setStyle(headTable, 'width', `calc(100% - ${scrollBarWidth}px)`);
        }
        else {
            this.renderer.setStyle(headTable, 'width', '100%');
        }
        const fixheadFiller = this.tiRenderer.findChildrenByClassName(theadContainer, 'ti3-table-fixed-head-filler')[0];
        // 1px为经验值，避免计算的误差导致填充块和表头之间有一点空白间隔
        const fillerWidth = scrollBarWidth + 1;
        // 根据Y轴是否有滚动条来控制表头右侧的填充块的有无
        if (isOverflowedY) {
            if (tableCom.fixedColumnInfo.thFixedRight) {
                this.renderer.setStyle(tableCom.fixedColumnInfo.thFixedRight, 'right', `${scrollBarWidth}px`);
            }
            if (fixheadFiller) {
                this.renderer.setStyle(fixheadFiller, 'width', fillerWidth + 'px');
                return;
            }
            const headerFiller = document.createElement('div');
            this.renderer.addClass(headerFiller, 'ti3-table-fixed-head-filler');
            this.renderer.setStyle(headerFiller, 'width', fillerWidth + 'px');
            theadContainer.appendChild(headerFiller);
        }
        else if (fixheadFiller) {
            this.renderer.removeChild(theadContainer, fixheadFiller);
            if (tableCom.fixedColumnInfo.thFixedRight) {
                this.renderer.setStyle(tableCom.fixedColumnInfo.thFixedRight, 'right', 0);
            }
        }
    }
    removeTbodyContainerBorderBottom(tbodyContainer, displayedData) {
        const tbody = tbodyContainer.children[0].children[1];
        const hasNodataTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata').length > 0;
        const hasNodataGuideTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata-guide').length > 0;
        const hasLoadfailTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-loadfail').length > 0;
        const hasNodataSimpleTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata-simple').length > 0;
        // 判断是否包含表格无数据，有图片是大间距，其他场景全部为单行文字样式，包括以下四种情况；
        // 1、表格无数据：ti-table-nodata（有图片）；
        // 2、查询内容为空，提示用户'购买商品'：ti-table-nodata-guide；
        // 3、加载不成功，提示'重新加载'：ti-table-loadfail。
        // 4. 表格无数据：ti-table-nodata-simple，只有文字提示（无图片）
        const noBorderTerm = hasNodataTbody || hasNodataGuideTbody || hasLoadfailTbody || hasNodataSimpleTbody;
        if (displayedData.length === 0 && noBorderTerm) {
            this.renderer.setStyle(tbodyContainer, 'border-bottom', 'none');
        }
        else {
            this.renderer.setStyle(tbodyContainer, 'border-bottom', '');
        }
    }
    // 由于用scrollHeight计算在IE和火狐下偶尔有1px的误差，
    // 所以此处直接获取表格更准确的高度和容器的clientHeight作对比
    overflowedResult(tbodyContainer, direction, isNum) {
        let containerSize = 0;
        let tbodySize = 0;
        const tbodyTable = tbodyContainer.children[0];
        if (direction === 'X') {
            containerSize = tbodyContainer.clientWidth;
            // 修复SSR错误：ERROR TypeError: tbodyTable.getBoundingClientRect is not a function
            if (typeof tbodyTable.getBoundingClientRect !== 'function') {
                return;
            }
            tbodySize = this.numRound(tbodyTable.getBoundingClientRect().width, 0);
        }
        else {
            containerSize = tbodyContainer.clientHeight;
            // 修复SSR错误：ERROR TypeError: tbodyTable.getBoundingClientRect is not a function
            if (typeof tbodyTable.getBoundingClientRect !== 'function') {
                return;
            }
            tbodySize = this.numRound(tbodyTable.getBoundingClientRect().height, 0);
        }
        // 若isNum为true，返回差值，否则返回布尔值
        return isNum ? (tbodySize - containerSize) : (tbodySize > containerSize);
    }
    processYScrollStateChange(colsResizableDire) {
        const options = colsResizableDire.resizableOpts;
        // 主要处理 columns 初始异步的场景
        if (!options.ths || options.ths.length === 0) {
            return;
        }
        const tbodyContainer = colsResizableDire.tableCom.tbodyContainer;
        const theadContainer = colsResizableDire.tableCom.theadContainer;
        const newYScrollState = this.overflowedResult(tbodyContainer, 'Y');
        if (newYScrollState === options.yScrollState) {
            this.processOverflowY(theadContainer, tbodyContainer, colsResizableDire.tableCom);
            return;
        }
        const newXScrollState = this.overflowedResult(tbodyContainer, 'X');
        let lastColIndex = options.ths.length - 1;
        let lastTh = options.ths[lastColIndex];
        let lastThWidth = options.storedSizes[lastColIndex];
        const scrollBarWidth = this.getScrollBarWidth('Y');
        // 纵向滚动条由无到有
        if (newYScrollState) {
            if (newXScrollState && newXScrollState === options.xScrollState) {
                options.storeTableWidthChange += scrollBarWidth;
            }
            else {
                // 第一次纵向滚动条状态发生变化要减小表格宽度时，去减小非特殊列中宽度最大的一列的宽度
                // 这样处理是为了避免最后一列的宽度变小
                if (colsResizableDire.isfirstYScrollStateChange) {
                    lastTh = this.getMaxWidthTh(colsResizableDire);
                    if (lastTh) {
                        lastColIndex = parseInt(lastTh.getAttribute('ti-visible-index'), 10);
                        lastThWidth = options.storedSizes[lastColIndex];
                    }
                }
                options.storedSizes[lastColIndex] = lastThWidth - scrollBarWidth;
            }
            // 纵向滚动条由有到无
        }
        else {
            if (newXScrollState === options.xScrollState) {
                if (newXScrollState) {
                    options.storeTableWidthChange -= scrollBarWidth;
                }
                else {
                    options.storedSizes[lastColIndex] = lastThWidth + scrollBarWidth;
                }
            }
            else if (!newXScrollState) {
                options.storedSizes[lastColIndex] = lastThWidth + (scrollBarWidth -
                    options.storeTableWidthChange);
                options.storeTableWidthChange = 0;
            }
        }
        if (lastTh) {
            colsResizableDire.setWidth(lastTh, options.storedSizes[lastColIndex]);
            colsResizableDire.setWidth(options.secondThs[lastColIndex], options.storedSizes[lastColIndex]);
        }
        this.processOverflowY(theadContainer, tbodyContainer, colsResizableDire.tableCom);
        colsResizableDire.isfirstYScrollStateChange = false;
        options.xScrollState = this.overflowedResult(tbodyContainer, 'X');
        options.yScrollState = this.overflowedResult(tbodyContainer, 'Y');
        // 纵向滚动条状态改变时可能会引起列宽改变和横向滚动条状态改变，所以要处理列固定
        if (colsResizableDire.tableCom.fixedColumnInfo.hasFixedColumn) {
            colsResizableDire.tableCom.processFixedColumn();
        }
    }
    getMaxWidthTh(colsResizableDire) {
        const options = colsResizableDire.resizableOpts;
        colsResizableDire.updateStoredSizes();
        const ths = options.ths.filter((th) => {
            // 排除最后一列和不可拖动的列
            return !th.hasAttribute(colsResizableDire.notResizableAttr) && !colsResizableDire.isLastColumn(th);
        });
        // 按列宽从小到大排序
        const sortedThs = ths.sort((a, b) => {
            const indexA = parseInt(a.getAttribute('ti-visible-index'), 10);
            const indexB = parseInt(b.getAttribute('ti-visible-index'), 10);
            return options.storedSizes[indexA] - options.storedSizes[indexB];
        });
        // 返回宽度最大的列
        return sortedThs[sortedThs.length - 1];
    }
    // 处理在列拖动过程中横向滚动条的出现引起纵向滚动条出现时的账本(storeColsWidthChange)的变化
    handleYOverflowedWithX(resizableOpts, tbodyContainer) {
        const newYScrollState = this.overflowedResult(tbodyContainer, 'Y');
        if (newYScrollState === resizableOpts.yScrollState) {
            return;
        }
        const scrollBarWidth = this.getScrollBarWidth('Y');
        const newXScrollState = this.overflowedResult(tbodyContainer, 'X');
        if (newYScrollState) {
            resizableOpts.storeTableWidthChange += scrollBarWidth;
            resizableOpts.isYOverflowedWithX = true;
        }
        resizableOpts.xScrollState = newXScrollState;
        resizableOpts.yScrollState = newYScrollState;
    }
    handleYNotOverflowedWithX(resizableOpts, tbodyContainer) {
        const scrollBarWidthX = this.getScrollBarWidth('X');
        const scrollBarWidthY = this.getScrollBarWidth('Y');
        const overflowedHeight = this.overflowedResult(tbodyContainer, 'Y', true);
        const overflowedWidth = this.overflowedResult(tbodyContainer, 'X', true);
        // 当列拖动横向滚动条出现导致纵向滚动条出现后，再缩小列宽时，由于无法准确获得横向滚动条消失的时刻去对表格
        // 宽度做补偿，所以当表格列宽到达容器边界附近时，用临时将overflow-x设为hidden的方式使横向滚动条消失。
        if (resizableOpts.isYOverflowedWithX && overflowedHeight > 0 && overflowedHeight <= scrollBarWidthX &&
            overflowedWidth > 0 && overflowedWidth <= scrollBarWidthY) {
            this.renderer.setStyle(tbodyContainer, 'overflow-x', 'hidden');
            // 对账本(storeTableWidthChange)清零
            resizableOpts.storeTableWidthChange = 0;
            resizableOpts.isYOverflowedWithX = false;
            setTimeout(() => {
                this.renderer.setStyle(tbodyContainer, 'overflow-x', 'auto');
            }, 0);
        }
    }
    // 获取滚动条宽度
    getScrollBarWidth(direction) {
        const temporaryDiv = document.createElement('div');
        this.tiRenderer.setStyles(temporaryDiv, {
            position: 'absolute',
            top: '-9999px',
            left: '-9999px',
            width: '100px',
            height: '100px',
            overflow: 'hidden'
        });
        const nestDiv = document.createElement('div');
        this.tiRenderer.setStyles(nestDiv, { width: '100%', height: '100%' });
        temporaryDiv.appendChild(nestDiv);
        document.body.appendChild(temporaryDiv);
        const noScrollWidth = nestDiv.getBoundingClientRect().width;
        const noScrollHeight = nestDiv.getBoundingClientRect().height;
        this.renderer.setStyle(temporaryDiv, 'overflow', 'scroll');
        const scrollWidth = nestDiv.getBoundingClientRect().width;
        const scrollHeight = nestDiv.getBoundingClientRect().height;
        this.renderer.removeChild(document.body, temporaryDiv);
        const scrollBarWidthX = this.numRound(noScrollHeight - scrollHeight, 1);
        const scrollBarWidthY = this.numRound(noScrollWidth - scrollWidth, 1);
        return direction === 'X' ? scrollBarWidthX : scrollBarWidthY;
    }
    // 对浮点数四舍五入保留指定小数位数的数字
    numRound(num, decimal) {
        return parseFloat(num.toFixed(decimal));
    }
}
TiTableFixedHeadService.ɵprov = ɵɵdefineInjectable({ factory: function TiTableFixedHeadService_Factory() { return new TiTableFixedHeadService(ɵɵinject(RendererFactory2), ɵɵinject(TiRenderer)); }, token: TiTableFixedHeadService, providedIn: TiTableFixedHeadServiceModule });
TiTableFixedHeadService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiTableFixedHeadServiceModule
            },] }
];
TiTableFixedHeadService.ctorParameters = () => [
    { type: RendererFactory2 },
    { type: TiRenderer }
];

/**
 * TiTable 表格组件
 *
 * 支持以表格的形式展示多条数据
 *
 * 支持前后台分页、搜索、排序、详情展开、列拖动（调整列宽）、控制列动态隐藏/显示、行复选、行单选、
 * 表格单元格(th, td)智能tip、树表、列文本对齐方式、表头固定等功能
 *
 * <example-url>../tiny3demo/#/table/table-all</example-url>
 */
class TiTableComponent extends TiBaseComponent {
    constructor(iterableDiffers, elementRef, fixedHeadService, renderer, zone, tiRenderer) {
        super(elementRef, renderer);
        this.iterableDiffers = iterableDiffers;
        this.fixedHeadService = fixedHeadService;
        this.zone = zone;
        this.tiRenderer = tiRenderer;
        /**
         * 设置表格源数据及其处理数据状态
         *
         * data: 表格源数据。一般情况下，前台分页时传入表格全部数据，后台分页时传入当前页数据。
         *
         * state: 用来标识传入的表格源数据是否已经经过排序(sorted)、过滤(searched)、分页(paginated)等处理。
         *
         * 应用举例：后台分页场景下，传入的data为当前页数据（即已经进行了分页），因此应将paginated设置为true；
         *          如果传入的数据已经进行了排序（如后台排序场景），则应将sorted设置为true。
         */
        this.srcData = TiTableComponent.DEFAULT_SRC_DATA;
        /**
         * 表格记忆各项开关配置
         * 10.0.4 新增
         */
        this.storageConfig = {
            sort: true,
            pagination: true,
            colsWidth: true,
        };
        /**
         * 表格实时呈现的数据改变时向外通知
         */
        this.displayedDataChange = new EventEmitter();
        /**
         * 设置表格的各列信息。开发者可以使用该接口的值在 thead>tr>th 中完成对表头内容的设置；
         *
         * 控件内部根据columns设置完成必要的逻辑处理。 建议对columns数组中的对象设置如下属性：
         *
         * title: 表头列文本内容。当某一列的title为空字符串时，当前列一直在表格中显示，但是不出现在控制列动态
         *         隐藏/显示 设置面板中，例如单选列、多选列、详情展开图标列;
         *
         * width: 设置列宽，支持百分比和px值;
         *
         * show: 此属性只有在表格具有列动态 显示/隐藏 功能时才需要设置，show可以分别设置如下值：
         *
         *       true： 表示该列默认显示，用户可以通过面板操作切换其 显示/隐藏 状态。
         *
         *       false : 表示该列默认隐藏，用户可以通过面板操作切换其 显示/隐藏 状态。
         *
         *       undefined : 表示该列不具备动态 显示/隐藏 功能，固定显示。
         *
         *       注意：设置show属性值时，title为空字符串时，该列固定显示，但不出现在列操作面板中。
         */
        this.columns = [];
        /**
         * 设置表格搜索功能的需被检索的字符串的集合。
         *
         * 此接口需配合searchKeys使用。
         *
         *  1. searchWords长度为1时，在searchKeys指定的字段下搜索searchWords[0]指定的字符串,
         *     在指定字段中的任一字段中搜索到时即满足条件(并集)。如：searchWords: ['b'],
         *     searchKeys: ['firstName', 'lastName']，则在firstName字段包含‘b’，
         *     或在lastName字段包含‘b’时本行数据即满足搜索条件;
         *
         * 2. searchWords长度大于1且searchKeys与searchWords长度相等时，在searchKeys指定的字段下搜索searchWords对应(按顺序)元素指定的字符串,
         *    在指定字段中的所有字段搜索到对应字符串时才满足条件(交集)。如：searchWords: ['b', '18'],
         *    searchKeys: ['firstName', 'age']，则在firstName字段包含‘b’且
         *    在age字段包含‘18’时本行数据才满足搜索条件。
         */
        this.searchWords = null;
        /**
         * 为表格搜索功能指定搜索的字段范围。
         *
         * 此接口需配合searchWords使用。
         */
        this.searchKeys = null; // 是否使用null
        /**
         * 有详情功能时，设置组件是否开启当前页只显示一行详情的功能。
         *
         * 设置为true，表示表格中当前页只展示一行的详情，不设置或设为false时，可展开多行的详情。
         */
        this.closeOtherDetails = false;
        /**
         * 当表格数据状态变化时向外通知
         *
         * 1.功能描述：
         *
         * 状态变化指的是表格的排序、搜索、分页参数发生了变化，触发变化的原因可能是用户操作，也可能是开发者设置。
         * 该回调为后台分页、后台排序和后台过滤提供了处理时机，例如，用户点击第2页时，由于页码的变化，必定会触发本回调函数，
         * 进而开发者可以在该回调中向后台发请求获取第2页的数据，并赋给表格。
         *
         * 注意事项：初始化时不会触发该回调，只有表格状态动态改变时才会触发该回调，所以需要用户自己在初始时向后端发送请求获取表格初始化数据。
         *
         * 2.函数入参：TiTableComponent 组件实例
         *
         */
        this.stateUpdate = new EventEmitter();
        this.promise = Promise.resolve(null);
        /**
         * @ignore 判断是否使用了ti-head-sort组件
         */
        this.enableSort = false;
        /**
         * @ignore
         */
        this.paginationSubject = new Subject();
        /**
         * @ignore
         */
        this.viewInitSubject = new Subject();
        /**
        * @ignore
        */
        this.containerScrollXChangeSubject = new Subject();
        /**
         * @ignore
         */
        this.thResizeSubject = new Subject();
        /**
         * @ignore
         */
        this.updateFixedThLeftSubject = new Subject();
        /**
         * @ignore
         */
        this.updateFixedTdLeftSubject = new Subject();
        /**
         * @ignore
         */
        this.updateColumnsSubject = new Subject();
        /**
         * @ignore
         * 其中包含了sort、search、pagination三个属性，每个属性都描述了当前表格数据的参数状态:
         *
         * sort：object类型，包含了sortKey（类型为string，进行排序的数据属性）、asc（类型为Boolean，是否为升序）属性；
         *
         * search: object类型，包含了searchWords（类型为array<string>，搜索字符串集合）、searchKeys（类型为Array，搜索指定的字段范围）属性；
         *
         * pagination: object类型，包含了currentPage（类型number，表示当前页）、itemsPerPage（类型为Number，每页显示条数）属性。
         */
        this.dataState = {
            search: { searchWords: null, searchKeys: null },
            sort: { sortKey: '', asc: null },
            pagination: { currentPage: -1, itemsPerPage: -1 }
        };
        this.isDataStateChange = false;
        this.oldSearchWords = null;
        this.oldSearchKeys = null;
        this.oldPagination = { currentPage: -1, itemsPerPage: -1 };
        this.oldSort = { sortKey: '', asc: null };
        this.searchedResult = [];
        /**
         * @ignore
         * 表格是否为表头锁定
         */
        this.isFixedHead = false;
        this.oldTbodyHeight = 0;
        /**
         * @ignore
         */
        this.fixedColumnInfo = {};
        this.compareTo = (v1, v2) => {
            let result = 0;
            if (Util.isFunction(this.customCompareFn)) {
                result = this.customCompareFn(v1.value, v2.value, this.dataState.sort.sortKey);
            }
            else {
                result = TiTableComponent.doCompare(v1.predicateValueObj, v2.predicateValueObj);
                if (result === 0) {
                    result = v1.index - v2.index;
                }
            }
            return result;
        };
        this.hostEle = elementRef.nativeElement;
    }
    /**
     * 测试某一字串(testStr)中是否存在子串(key)
     * @param testStr 待检索的字符串或数值
     * @param key 检索的子串
     */
    static isMatched(testStr, keywords) {
        return (Util.isString(testStr) || Util.isNumber(testStr)) ?
            (String(testStr)).toLowerCase()
                .indexOf(keywords.toLowerCase()) >= 0 : false;
    }
    static searchByOneWord(src, searchWords, searchKeys) {
        const output = [];
        src.forEach((item) => {
            if (searchKeys && searchKeys.length > 0) {
                for (const key of searchKeys) {
                    if (TiTableComponent.isMatched(item[key], searchWords[0])) {
                        output.push(item);
                        break;
                    }
                }
            }
            else {
                for (const key in item) {
                    if (TiTableComponent.isMatched(item[key], searchWords[0])) {
                        output.push(item);
                        break;
                    }
                }
            }
        });
        return output;
    }
    static searchByMoreThanOneWord(src, searchWords, searchKeys) {
        const output = [];
        src.forEach((item) => {
            let isMatched = true;
            for (let i = 0; i < searchKeys.length; i++) {
                if (!TiTableComponent.isMatched(item[searchKeys[i]], searchWords[i])) {
                    isMatched = false;
                    break;
                }
            }
            if (isMatched) {
                output.push(item);
            }
        });
        return output;
    }
    static getSearchedData(inputData, searchWords, searchKeys) {
        let outData = [];
        if (searchWords && searchWords.length === 1) {
            outData = TiTableComponent.searchByOneWord(inputData, searchWords, searchKeys);
        }
        else if (searchWords && searchWords.length > 1 && searchKeys &&
            searchKeys.length === searchWords.length) {
            outData = TiTableComponent.searchByMoreThanOneWord(inputData, searchWords, searchKeys);
        }
        return outData;
    }
    static doCompare(a, b) {
        let result = 0;
        if (a.type === b.type) {
            if (a.value !== b.value) {
                result = a.value < b.value ? -1 : 1;
            }
        }
        else {
            result = a.type < b.type ? -1 : 1;
        }
        return result;
    }
    static getPredicateValue(value, predicate) {
        if (!Util.isEmptyString(predicate) && value.hasOwnProperty(predicate)) {
            return value[predicate];
        }
        return value;
    }
    static getPredicateValueObj(value, index) {
        let resultVal = value;
        if (value === null) {
            resultVal = 'null';
        }
        else if (Util.isString(value)) {
            resultVal = value.toLowerCase();
        }
        else if (Util.isArray(value)) {
            resultVal = value.toString();
        }
        else if (typeof value === 'object') {
            resultVal = index;
        }
        else if (Util.isFunction(value)) {
            const resultValue = value();
            return TiTableComponent.getPredicateValueObj(resultValue, index);
        }
        const type = typeof resultVal;
        return { value: resultVal, type };
    }
    static safeCopy(data) {
        return data ? [].concat(data) : [];
    }
    static isValueEqual(n, o) {
        if (!(n instanceof Object) || !(o instanceof Object)) {
            return n === o;
        }
        if (Util.isArray(n) && Util.isArray(o)) {
            if (n.length !== o.length) {
                return false;
            }
            else {
                for (let i = 0; i < o.length; i++) {
                    if (n[i] !== o[i]) {
                        return false;
                    }
                }
            }
            return true;
        }
        if (Object.keys(n).length !== Object.keys(o).length) {
            return false;
        }
        else {
            for (const key in n) {
                if (!o.hasOwnProperty(key) || n[key] !== o[key]) {
                    return false;
                }
            }
        }
        return true;
    }
    ngOnInit() {
        super.ngOnInit();
        if (!this.srcData) {
            this.srcData = TiTableComponent.DEFAULT_SRC_DATA;
        }
        if (!this.srcData.data) {
            this.srcData.data = [];
        }
        this.srcDataDiffer = this.iterableDiffers.find(this.srcData.data)
            .create();
        if (this.searchWords !== null) {
            this.oldSearchWords = TiTableComponent.safeCopy(this.searchWords);
            this.dataState.search.searchWords = this.searchWords;
        }
        if (this.searchKeys !== null) {
            this.oldSearchKeys = TiTableComponent.safeCopy(this.searchKeys);
            this.dataState.search.searchKeys = this.searchKeys;
        }
        // 表格记忆
        if (this.storageId) {
            this.initStorageDataState();
        }
    }
    ngAfterViewInit() {
        this.initFixedHead();
        if (this.fixedColumnInfo.hasFixedColumn) {
            this.addFixedColumnBehavior();
        }
        this.viewInitSubject.next();
        if (this.storageId) {
            // 在ngOnDestroy 无法保存，所有使用beforeunload
            // 为什么不用unload? beforeunload 兼容比unload效果好
            // 参考：https://sinaad.github.io/xfe/2016/06/29/beforeunlod-vs-unload/
            // 修复SSR报错：ERROR ReferenceError: window is not defined
            if (typeof window === 'undefined') {
                return;
            }
            this.unlistenWindowBeforeunload = this.renderer.listen(window, 'beforeunload', () => {
                this.updateStorageDataState();
            });
        }
    }
    // 为了确保表格内嵌组件(比如tiHeadSort,tiPagination等)的数据变化在表格组件中能监听到，排序、搜索、分页
    // 的相关数据监听需要放在表格组件的AfterViewChecked周期中。因为表格组件的AfterViewChecked生命周期晚于
    // 内嵌组件(比如tiHeadSort,tiPagination等)的各个checked生命周期。
    // tslint:disable-next-line:cyclomatic-complexity
    // eslint-disable-next-line complexity
    ngAfterViewChecked() {
        // 监听srcData.data的变化
        const dataArr = this.srcData && this.srcData.data ? this.srcData.data : [];
        const srcDataDiffer = this.srcDataDiffer.diff(dataArr);
        if (srcDataDiffer) {
            this.updateSafeCopy();
            this.data2displayed();
        }
        // 监听search相关接口值变化
        if (this.searchWords !== null &&
            !TiTableComponent.isValueEqual(this.searchWords, this.oldSearchWords)) {
            this.oldSearchWords = TiTableComponent.safeCopy(this.searchWords);
            this.isDataStateChange = true;
            this.triggerEvent = 'search';
            this.dataState.search.searchWords = this.searchWords;
            // 搜索时，如果使用分页时，把用于表格内部计算分页的当前页码置为1
            if (this.dataState.pagination.itemsPerPage !== -1 && this.dataState.pagination.currentPage !== 1) {
                this.dataState.pagination.currentPage = 1;
                // 使用Promise是为了解决使用stateUpdate接口做后台分页+后台搜索时，
                // 分页组件ExpressionChangedAfterItHasBeenCheckedError报错问题。
                // 此处不能使用setTimeout来解决，使用setTimeout会导致stateUpdate多次执行。
                this.promise.then(() => {
                    this.paginationSubject.next({ currentPage: 1 });
                });
            }
        }
        if (this.searchKeys !== null && this.searchWords.length > 0 &&
            !TiTableComponent.isValueEqual(this.searchKeys, this.oldSearchKeys)) {
            this.oldSearchKeys = TiTableComponent.safeCopy(this.searchKeys);
            this.isDataStateChange = true;
            this.triggerEvent = 'search';
            this.dataState.search.searchKeys = this.searchKeys;
            // 搜索时，如果使用分页时，把用于表格内部计算分页的当前页码置为1
            if (this.dataState.pagination.itemsPerPage !== -1 && this.dataState.pagination.currentPage !== 1) {
                this.dataState.pagination.currentPage = 1;
                this.promise.then(() => {
                    this.paginationSubject.next({ currentPage: 1 });
                });
            }
        }
        if (!TiTableComponent.isValueEqual(this.dataState.sort, this.oldSort)) {
            this.oldSort = Object.assign({}, this.dataState.sort);
            this.isDataStateChange = true;
            this.triggerEvent = 'sort';
        }
        if (this.dataState.pagination.currentPage !== -1 &&
            this.dataState.pagination.itemsPerPage !== -1 &&
            !TiTableComponent.isValueEqual(this.dataState.pagination, this.oldPagination)) {
            this.oldPagination = Object.assign({}, this.dataState.pagination);
            this.isDataStateChange = true;
            this.triggerEvent = 'pagination';
        }
        if (this.isDataStateChange) {
            this.updateTable();
            this.isDataStateChange = false;
        }
        if (this.isFixedHead && this.getTbodyHeight() !== this.oldTbodyHeight) {
            // 有些场景下(例如，两页显示数据条数相同，从其中一页跳到另一页时)获取高度不准确，
            // 所以此处添加setTimeout
            setTimeout(() => {
                if (this.hostEle.hasAttribute('tiColsResizable') && this.processYScrollStateChangeWithColsResizable) {
                    this.processYScrollStateChangeWithColsResizable();
                }
                else {
                    this.fixedHeadService.processOverflowY(this.theadContainer, this.tbodyContainer, this);
                }
                this.fixedHeadService.removeTbodyContainerBorderBottom(this.tbodyContainer, this.displayedData);
            }, 0);
            this.oldTbodyHeight = this.getTbodyHeight();
        }
        // 表格容器宽度改变时，列宽和横向滚动条状态都可能发生改变，这时需要处理表格列固定
        if (this.fixedColumnInfo.hasFixedColumn) {
            const containerWidth = this.fixedColumnInfo.container.clientWidth;
            if (containerWidth !== this.fixedColumnInfo.containerWidth) {
                this.fixedColumnInfo.containerWidth = containerWidth;
                this.processFixedColumn();
            }
        }
    }
    ngOnDestroy() {
        if (this.isFixedHead && this.unlistenFixedHeadWindowResize) {
            this.unlistenFixedHeadWindowResize();
        }
        if (this.unlistenFixedColumnWindowResize) {
            this.unlistenFixedColumnWindowResize();
        }
        if (this.storageId) {
            // 路由跳转时，页面没有刷新，beforeunload监听不生效，所以要更新一次记忆数据。
            this.updateStorageDataState();
            // 修复SSR错误：TypeError: this.unlistenWindowBeforeunload is not a function
            (typeof this.unlistenWindowBeforeunload === 'function') && this.unlistenWindowBeforeunload();
        }
    }
    // 初始化表格记忆
    initStorageDataState() {
        // 修复SSR报错：ERROR ReferenceError: window is not defined
        if (typeof window === 'undefined') {
            return;
        }
        // 缓存在sessionStorage中的数据
        let sessionStorageState = window.sessionStorage.getItem(this.storageId);
        // 缓存在localStorage 中的数据
        let localStorageState = window.localStorage.getItem(this.storageId);
        // 版本发布后，用户第一次访问时，sessionStorageState、localStorageState是null
        this.sessionStorageState = sessionStorageState ? JSON.parse(sessionStorageState) : {};
        this.localStorageState = localStorageState ? JSON.parse(localStorageState) : {};
    }
    // 更新本地存储中的
    updateStorageDataState() {
        const localStorageState = Object.assign({}, this.localStorageState);
        const sessionStorageState = Object.assign({}, this.sessionStorageState);
        // 排序
        if (this.storageConfig.sort && this.dataState.sort.sortKey) {
            sessionStorageState['sort'] = this.dataState.sort;
        }
        // 表格分页
        // tslint:disable-next-line: max-line-length
        if ((this.storageConfig.pagination === true || (this.storageConfig.pagination && this.storageConfig.pagination['itemsPerPage'] === true)) &&
            this.dataState.pagination.itemsPerPage !== -1) {
            // 每页条数
            localStorageState['itemsPerPage'] = this.dataState.pagination.itemsPerPage;
        }
        // 表格分页
        // tslint:disable-next-line: max-line-length
        if ((this.storageConfig.pagination === true || (this.storageConfig.pagination && this.storageConfig.pagination['currentPage'] === true)) &&
            this.dataState.pagination.currentPage !== -1) {
            // 当前页
            sessionStorageState['currentPage'] = this.dataState.pagination.currentPage;
        }
        if (this.dataState.search.searchKeys) {
            localStorageState['searchKeys'] = this.dataState.search.searchKeys;
        }
        if (this.dataState.search.searchWords) {
            localStorageState['searchWords'] = this.dataState.search.searchWords;
        }
        if (Object.keys(sessionStorageState).length > 0) {
            // 修复：SSR报错：ReferenceError: window is not defined
            (typeof window !== 'undefined') && window.sessionStorage.setItem(this.storageId, JSON.stringify(sessionStorageState));
        }
        if (Object.keys(localStorageState).length > 0) {
            (typeof window !== 'undefined') && window.localStorage.setItem(this.storageId, JSON.stringify(localStorageState));
        }
    }
    /**
     * @ignore
     */
    updatePagination(currentPage, itemsPerPage) {
        if (this.oldPagination.currentPage === -1 &&
            this.oldPagination.itemsPerPage === -1) {
            this.oldPagination = {
                currentPage,
                itemsPerPage
            };
        }
        this.dataState.pagination.currentPage = currentPage;
        this.dataState.pagination.itemsPerPage = itemsPerPage;
    }
    /**
     * @ignore
     * 排序状态更新及处理
     *
     * @param sortKey - 进行排序的数据属性（如对数据的name属性值进行排序，则传入"name"）
     * @param reverse - 是否为降序，true表示降序，false表示升序，null表示无序
     * @param isDefaultSort - 是否为默认排序
     */
    updateSort(sortKey, reverse, isDefaultSort, compareFn) {
        if (isDefaultSort) {
            this.oldSort = {
                sortKey,
                asc: !reverse
            };
        }
        this.dataState.sort.sortKey = sortKey;
        this.dataState.sort.asc = Util.isNull(reverse) ? reverse : !reverse;
        this.customCompareFn = compareFn;
    }
    /**
     * 获取表格当前的数据状态(sort、search、pagination)
     * @return TiTableDataState
     */
    getDataState() {
        return this.dataState;
    }
    /**
     * 获取当前触发 stateUpdate 的事件(即引起表格数据状态改变的起因事件)
     * @return 有"search", "sort", "pagination"这三个值
     */
    getTriggerEvent() {
        return this.triggerEvent;
    }
    /**
     * 如果使用到了表格组件搜索功能，可通过此方法获取到搜索的数据结果。
     * @return 搜索到的数据集合
     *
     * 3.0.9新增
     */
    getSearchedResult() {
        return this.searchedResult;
    }
    updateTable() {
        if (this.isFrontPagination() || this.isFrontSort() || this.isFrontSearch()) {
            this.data2displayed();
        }
        // 延时的目的是防止stateUpdate 回调中同步修改数据时报错。
        this.promise.then(() => {
            this.stateUpdate.emit(this);
        });
    }
    /**
     * 根据数据状态(search,sort,pagination)处理数据
     */
    dataProcessor(data) {
        let output = data;
        // 如果存在过滤条件且开发者传递的源数据尚未进行过滤处理，则进行前台过滤处理
        if (this.isFrontSearch()) {
            output = TiTableComponent.getSearchedData(output, this.searchWords, this.searchKeys);
            this.searchedResult = [].concat(output);
            const totalNumber = output.length;
            // 如果存在分页且开发者传递的源数据尚未进行分页处理，即进行前台分页,
            if (this.isFrontPagination()) {
                this.promise.then(() => {
                    this.paginationSubject.next({ totalNumber });
                });
            }
        }
        // 如果存在排序且开发者传递的源数据尚未进行排序处理，则进行前台排序处理（字典排序）
        if (this.isFrontSort()) {
            output = this.getSortedData(output, this.dataState.sort.sortKey, this.dataState.sort.asc);
        }
        // 存在分页且开发者传递的源数据尚未进行分页处理，则进行前台分页
        if (this.isFrontPagination()) {
            const pagination = this.dataState.pagination;
            const start = (pagination.currentPage - 1) * pagination.itemsPerPage;
            output = output.slice(start, start + parseInt(pagination.itemsPerPage.toString(), 10));
        }
        return output;
    }
    /**
     * data => displayedData，处理分3步：
     * 1. 复制data数据
     * 2. 根据 分页、过滤、排序 处理数据
     * 3. 通过displayedDataChange 事件更新到displayedData
     */
    data2displayed() {
        // 复制源数据
        let output = TiTableComponent.safeCopy(this.data);
        // 处理数据
        output = this.dataProcessor(output);
        // 更新到displayedData
        this.promise.then(() => {
            // 同步修改内部数据
            this.displayedData = output;
            this.displayedDataChange.emit(output);
        });
    }
    isFrontSearch() {
        const srcState = this.getSrcState();
        return (this.searchWords && this.searchWords.length > 0) && (!srcState || !srcState.searched);
    }
    isFrontSort() {
        const srcState = this.getSrcState();
        return this.enableSort && (!srcState || !srcState.sorted);
    }
    isFrontPagination() {
        const srcState = this.getSrcState();
        const pagination = this.dataState.pagination;
        return (pagination.currentPage !== -1 && pagination.itemsPerPage !== -1 && (!srcState || !srcState.paginated));
    }
    getSortedData(data, predicate, asc) {
        let resultArr = [];
        if (!Util.isArray(data)) {
            return resultArr;
        }
        // 无序状态
        if (!predicate || asc === null) {
            return data;
        }
        const compareArr = data.map((value, index) => {
            const predicateValue = TiTableComponent.getPredicateValue(value, predicate);
            return {
                value,
                index,
                predicateValueObj: TiTableComponent.getPredicateValueObj(predicateValue, index)
            };
        });
        compareArr.sort(this.compareTo);
        resultArr = compareArr.map((item) => {
            return item.value;
        });
        if (!asc) {
            resultArr.reverse();
        }
        return resultArr;
    }
    updateSafeCopy() {
        this.data = TiTableComponent.safeCopy(this.srcData && this.srcData.data ?
            this.srcData.data : []);
    }
    getSrcState() {
        return this.srcData && this.srcData.state ? this.srcData.state : undefined;
    }
    /**
     * @ignore
     */
    closeOtherDetailsFn(currentRow) {
        this.displayedData.forEach((row) => {
            if (row !== currentRow && row['showDetails']) {
                this.promise.then(() => {
                    row['showDetails'] = false;
                });
            }
        });
    }
    initFixedHead() {
        this.theadContainer = this.fixedHeadService.getTheadContainer(this.hostEle);
        if (!this.theadContainer) {
            return;
        }
        this.tbodyContainer = this.fixedHeadService.getTbodyContainer(this.theadContainer);
        this.isFixedHead = !Util.isUndefined(this.theadContainer) && !Util.isUndefined(this.tbodyContainer);
        if (this.isFixedHead) {
            this.renderer.listen(this.tbodyContainer, 'scroll', () => {
                const scrollLeft = this.tbodyContainer.scrollLeft;
                this.renderer.setStyle(this.theadContainer.children[0], 'marginLeft', -scrollLeft + 'px');
                Util.trigger(document, 'tiScroll');
            });
            this.unlistenFixedHeadWindowResize = this.renderer.listen('window', 'resize', () => {
                this.fixedHeadService.processOverflowY(this.theadContainer, this.tbodyContainer, this);
            });
        }
    }
    getTbodyHeight() {
        // 修复SSR报错：ERROR TypeError: this.tbodyContainer.children[0].getBoundingClientRect is not a function
        if (typeof this.tbodyContainer.children[0].getBoundingClientRect !== 'function') {
            return 0;
        }
        return this.fixedHeadService.numRound(this.tbodyContainer.children[0].getBoundingClientRect().height, 0);
    }
    addFixedColumnBehavior() {
        const container = this.tiRenderer.findChildrenByClassName(this.hostEle, 'ti3-table-container')[0];
        if (!container) {
            return;
        }
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(container, 'scroll', () => {
                const scrollLeft = container.scrollLeft;
                const isRightColumnFloat = scrollLeft + container.clientWidth < container.scrollWidth;
                this.containerScrollXChangeSubject.next({
                    scrollLeft,
                    isRightColumnFloat
                });
            });
            this.unlistenFixedColumnWindowResize = this.renderer.listen('window', 'resize', () => {
                const containerWidth = this.fixedColumnInfo.container.clientWidth;
                if (containerWidth !== this.fixedColumnInfo.containerWidth) {
                    this.fixedColumnInfo.containerWidth = containerWidth;
                    this.processFixedColumn();
                }
            });
        });
    }
    /**
     * @ignore
     */
    processFixedColumn() {
        const scrollLeft = this.fixedColumnInfo.container.scrollLeft;
        const isRightColumnFloat = scrollLeft + this.fixedColumnInfo.container.clientWidth < this.fixedColumnInfo.container.scrollWidth;
        this.containerScrollXChangeSubject.next({
            scrollLeft,
            isRightColumnFloat
        });
        this.updateFixedThLeftSubject.next();
        this.updateFixedTdLeftSubject.next();
    }
}
TiTableComponent.DEFAULT_SRC_DATA = {
    data: [],
    state: {
        searched: false,
        sorted: false,
        paginated: false
    }
};
TiTableComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-table',
                template: "<ng-content></ng-content>",
                encapsulation: ViewEncapsulation.None,
                host: {
                    '[class.ti3-table]': 'true'
                },
                styles: [".ti3-table-soldout{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:ti3Font!important;font-style:normal;font-variant:normal;font-weight:400;speak:none;text-rendering:auto;text-transform:none}.ti3-table-soldout:before{content:\"\\e92c\"}:root{--ti-table-box-model:border-box;--ti-table-cols-toggle-horizontal-padding:var(--ti-common-space-10);--ti-table-cols-toggle-searchbox-bottom-padding:var(--ti-common-space-base);--ti-table-cols-toggle-searchbox-top-padding:var(--ti-common-space-10);--ti-table-cols-toggle-vertical-padding:var(--ti-common-space-base);--ti-table-nodata-lead-icon-padding:var(--ti-common-space-5x);--ti-table-th-horizontal-padding:var(--ti-common-space-10)}.ti3-table{display:block}.table-nodata-a a{color:var(--ti-table-tr-bg-color-nodata-color);text-decoration:none}.table-nodata-a a:hover{color:var(--ti-table-tr-bg-color-nodata-color-hover);cursor:pointer;text-decoration:underline}.ti3-table>.ti3-resize-wrapper>table,.ti3-table>.ti3-table-container>table,.ti3-table>.ti3-table-fixed-head>table,.ti3-table>table{-ms-box-sizing:var(--ti-table-box-model);border-collapse:separate;border-spacing:0;border-width:0;box-sizing:var(--ti-table-box-model);empty-cells:show;margin-bottom:0;table-layout:fixed;width:100%}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th,.ti3-table>.ti3-table-container>table>thead>tr>th,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th,.ti3-table>table>thead>tr>th{-ms-box-sizing:var(--ti-table-box-model);background-color:var(--ti-table-th-bg-color);border-bottom:1px solid var(--ti-table-border-bottom-color);border-left:none;box-sizing:var(--ti-table-box-model);color:var(--ti-table-th-text-color);cursor:default;font-weight:var(--ti-table-th-text-font-weight);height:var(--ti-table-th-height);line-height:calc(var(--ti-table-th-height) - 1px);outline:0;overflow:hidden;padding:0;padding-left:var(--ti-table-th-horizontal-padding);padding-right:var(--ti-table-th-horizontal-padding);position:relative;text-align:left;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th:not(:last-child):after,.ti3-table>.ti3-table-container>table>thead>tr>th:not(:last-child):after,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th:not(:last-child):after,.ti3-table>table>thead>tr>th:not(:last-child):after{background:var(--ti-table-th-spacing-line-color);color:transparent;content:\"\";height:100%;position:absolute;right:0;top:0;width:1px}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[checkbox-column],.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[radio-column],.ti3-table>.ti3-table-container>table>thead>tr>th[checkbox-column],.ti3-table>.ti3-table-container>table>thead>tr>th[radio-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[radio-column],.ti3-table>table>thead>tr>th[checkbox-column],.ti3-table>table>thead>tr>th[radio-column]{font-size:0;overflow:visible;padding-right:var(--ti-table-column-icon-right-space);width:var(--ti-table-column-select-icon-width)!important}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[checkbox-column]:after,.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[radio-column]:after,.ti3-table>.ti3-table-container>table>thead>tr>th[checkbox-column]:after,.ti3-table>.ti3-table-container>table>thead>tr>th[radio-column]:after,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[checkbox-column]:after,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[radio-column]:after,.ti3-table>table>thead>tr>th[checkbox-column]:after,.ti3-table>table>thead>tr>th[radio-column]:after{width:0}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[checkbox-column],.ti3-table>.ti3-table-container>table>thead>tr>th[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[checkbox-column],.ti3-table>table>thead>tr>th[checkbox-column]{cursor:pointer}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th.ti3-disabled-cell,.ti3-table>.ti3-table-container>table>thead>tr>th.ti3-disabled-cell,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th.ti3-disabled-cell,.ti3-table>table>thead>tr>th.ti3-disabled-cell{cursor:not-allowed}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[details-icon-column],.ti3-table>.ti3-table-container>table>thead>tr>th[details-icon-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[details-icon-column],.ti3-table>table>thead>tr>th[details-icon-column]{overflow:visible;padding-right:var(--ti-table-column-icon-right-space);width:var(--ti-table-column-icon-width)!important}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th[details-icon-column]:after,.ti3-table>.ti3-table-container>table>thead>tr>th[details-icon-column]:after,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th[details-icon-column]:after,.ti3-table>table>thead>tr>th[details-icon-column]:after{width:0}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th:first-child[checkbox-column],.ti3-table>.ti3-resize-wrapper>table>thead>tr>th:first-child[radio-column],.ti3-table>.ti3-table-container>table>thead>tr>th:first-child[checkbox-column],.ti3-table>.ti3-table-container>table>thead>tr>th:first-child[radio-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th:first-child[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>thead>tr>th:first-child[radio-column],.ti3-table>table>thead>tr>th:first-child[checkbox-column],.ti3-table>table>thead>tr>th:first-child[radio-column]{padding-left:var(--ti-table-column-icon-left-space)!important;width:var(--ti-table-column-icon-width)!important}.ti3-table>.ti3-resize-wrapper>table>tbody>tr,.ti3-table>.ti3-table-container>table>tbody>tr,.ti3-table>.ti3-table-fixed-head>table>tbody>tr,.ti3-table>table>tbody>tr{background-color:var(--ti-table-tr-bg-color);border-spacing:0;transition:background-color .15s var(--ti-timing-function-default)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr:hover .cti-rename-edit,.ti3-table>.ti3-table-container>table>tbody>tr:hover .cti-rename-edit,.ti3-table>.ti3-table-fixed-head>table>tbody>tr:hover .cti-rename-edit,.ti3-table>table>tbody>tr:hover .cti-rename-edit{visibility:visible}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-selected-tr,.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-selected-tr:hover,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-selected-tr,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-selected-tr:hover,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-selected-tr,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-selected-tr:hover,.ti3-table>table>tbody>tr.ti3-selected-tr,.ti3-table>table>tbody>tr.ti3-selected-tr:hover{background-color:var(--ti-table-tr-bg-color-selected)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-disabled-tr,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-disabled-tr,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-disabled-tr,.ti3-table>table>tbody>tr.ti3-disabled-tr{background-color:var(--ti-table-tr-bg-color-disabled)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-disabled-tr>td,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-disabled-tr>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-disabled-tr>td,.ti3-table>table>tbody>tr.ti3-disabled-tr>td{color:var(--ti-table-tr-text-color-disabled)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-disabled-tr>td[checkbox-column],.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-disabled-tr>td[radio-column],.ti3-table>.ti3-table-container>table>tbody>tr.ti3-disabled-tr>td[checkbox-column],.ti3-table>.ti3-table-container>table>tbody>tr.ti3-disabled-tr>td[radio-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-disabled-tr>td[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-disabled-tr>td[radio-column],.ti3-table>table>tbody>tr.ti3-disabled-tr>td[checkbox-column],.ti3-table>table>tbody>tr.ti3-disabled-tr>td[radio-column]{cursor:not-allowed}.ti3-table>.ti3-resize-wrapper>table>tbody>tr:not(.ti3-details-tr):not(.ti3-disabled-tr):not(.ti3-table-nodata):not(.ti3-table-nodata-simple):not(.ti3-table-loadfail):not(.ti3-table-nodata-guide):not(.ti3-selected-tr):hover,.ti3-table>.ti3-table-container>table>tbody>tr:not(.ti3-details-tr):not(.ti3-disabled-tr):not(.ti3-table-nodata):not(.ti3-table-nodata-simple):not(.ti3-table-loadfail):not(.ti3-table-nodata-guide):not(.ti3-selected-tr):hover,.ti3-table>.ti3-table-fixed-head>table>tbody>tr:not(.ti3-details-tr):not(.ti3-disabled-tr):not(.ti3-table-nodata):not(.ti3-table-nodata-simple):not(.ti3-table-loadfail):not(.ti3-table-nodata-guide):not(.ti3-selected-tr):hover,.ti3-table>table>tbody>tr:not(.ti3-details-tr):not(.ti3-disabled-tr):not(.ti3-table-nodata):not(.ti3-table-nodata-simple):not(.ti3-table-loadfail):not(.ti3-table-nodata-guide):not(.ti3-selected-tr):hover{background-color:var(--ti-table-tr-bg-color-hover);transition:background-color .2s var(--ti-timing-function-default)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td,.ti3-table>.ti3-table-container>table>tbody>tr>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td,.ti3-table>table>tbody>tr>td{-ms-box-sizing:var(--ti-table-box-model);border-bottom:1px solid var(--ti-table-border-bottom-color);border-left:none;border-top:none;box-sizing:var(--ti-table-box-model);color:var(--ti-table-td-text-color);line-height:var(--ti-table-td-line-height);overflow:hidden;padding:var(--ti-table-td-padding);text-align:left;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td[checkbox-column],.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td[radio-column],.ti3-table>.ti3-table-container>table>tbody>tr>td[checkbox-column],.ti3-table>.ti3-table-container>table>tbody>tr>td[radio-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td[radio-column],.ti3-table>table>tbody>tr>td[checkbox-column],.ti3-table>table>tbody>tr>td[radio-column]{cursor:pointer;font-size:0;overflow:visible;padding-right:var(--ti-table-column-icon-right-space)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td.ti3-disabled-cell,.ti3-table>.ti3-table-container>table>tbody>tr>td.ti3-disabled-cell,.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td.ti3-disabled-cell,.ti3-table>table>tbody>tr>td.ti3-disabled-cell{cursor:not-allowed}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td[details-icon-column],.ti3-table>.ti3-table-container>table>tbody>tr>td[details-icon-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td[details-icon-column],.ti3-table>table>tbody>tr>td[details-icon-column]{overflow:visible;padding-left:var(--ti-table-column-icon-left-space);padding-right:var(--ti-table-column-icon-right-space)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td:first-child[checkbox-column],.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td:first-child[radio-column],.ti3-table>.ti3-table-container>table>tbody>tr>td:first-child[checkbox-column],.ti3-table>.ti3-table-container>table>tbody>tr>td:first-child[radio-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td:first-child[checkbox-column],.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td:first-child[radio-column],.ti3-table>table>tbody>tr>td:first-child[checkbox-column],.ti3-table>table>tbody>tr>td:first-child[radio-column]{padding-left:var(--ti-table-column-icon-left-space)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata,.ti3-table>table>tbody>tr.ti3-table-nodata{background-color:var(--ti-table-tr-bg-color-nodata)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata>td,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata>td,.ti3-table>table>tbody>tr.ti3-table-nodata>td{background:var(--ti-table-nodata-td-bg-img-url) 50% var(--ti-table-nodata-lead-icon-padding) no-repeat;border-bottom:none;color:var(--ti-table-nodata-td-color);font-size:var(--ti-table-nodata-td-font-size);height:var(--ti-table-nodata-height);line-height:20px;overflow:visible!important;padding:calc(var(--ti-table-nodata-lead-icon-height) + var(--ti-table-nodata-lead-icon-padding)*2) 0 0 0;position:relative;text-align:center;vertical-align:top}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail,.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-loadfail,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide,.ti3-table>table>tbody>tr.ti3-table-loadfail,.ti3-table>table>tbody>tr.ti3-table-nodata-guide{background-color:var(--ti-table-tr-bg-color-nodata)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td,.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table>table>tbody>tr.ti3-table-loadfail>td,.ti3-table>table>tbody>tr.ti3-table-nodata-guide>td{background:none;border-bottom:none;color:var(--ti-table-nodata-td-color);font-size:var(--ti-table-nodata-td-font-size);line-height:20px;overflow:visible!important;padding:var(--ti-common-space-5x) 0;position:relative;text-align:center;vertical-align:top}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table>table>tbody>tr.ti3-table-nodata-guide>td a{color:var(--ti-table-tr-bg-color-nodata-color);text-decoration:none}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table>table>tbody>tr.ti3-table-nodata-guide>td a:hover{color:var(--ti-table-tr-bg-color-nodata-color-hover);cursor:pointer;text-decoration:underline}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-simple,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-simple,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-simple,.ti3-table>table>tbody>tr.ti3-table-nodata-simple{background-color:var(--ti-table-tr-bg-color-nodata)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-simple>td,.ti3-table>.ti3-table-container>table>tbody>tr.ti3-table-nodata-simple>td,.ti3-table>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-simple>td,.ti3-table>table>tbody>tr.ti3-table-nodata-simple>td{background:none;border-bottom:none;color:var(--ti-table-nodata-td-color);font-size:var(--ti-table-nodata-td-font-size);line-height:20px;overflow:visible!important;padding:var(--ti-common-space-5x) 0;position:relative;text-align:center;vertical-align:top}.ti3-table-small>.ti3-resize-wrapper>table>thead>tr>th,.ti3-table-small>.ti3-table-container>table>thead>tr>th,.ti3-table-small>.ti3-table-fixed-head>table>thead>tr>th,.ti3-table-small>table>thead>tr>th{height:var(--ti-table-small-th-height);line-height:var(--ti-table-small-th-height)}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr>td,.ti3-table-small>.ti3-table-container>table>tbody>tr>td,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr>td,.ti3-table-small>table>tbody>tr>td{height:var(--ti-table-small-td-height);line-height:calc(var(--ti-table-small-td-height) - var(--ti-table-small-td-vertical-padding)*2);padding:var(--ti-table-small-td-vertical-padding) var(--ti-table-small-td-horizontal-padding)}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-details-tr>td,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-details-tr>td,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-details-tr>td,.ti3-table-small>table>tbody>tr.ti3-details-tr>td{padding:var(--ti-table-small-details-padding)}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata>td,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-nodata>td,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata>td,.ti3-table-small>table>tbody>tr.ti3-table-nodata>td{background:var(--ti-table-nodata-td-bg-img-url) 50% var(--ti-table-nodata-lead-icon-padding) no-repeat;height:var(--ti-table-small-nodata-height);padding:calc(var(--ti-table-nodata-lead-icon-height) + var(--ti-table-nodata-lead-icon-padding)*2) 0 0 0;vertical-align:top}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td,.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-small>table>tbody>tr.ti3-table-loadfail>td,.ti3-table-small>table>tbody>tr.ti3-table-nodata-guide>td{background:none;vertical-align:top}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-small>table>tbody>tr.ti3-table-loadfail>td a,.ti3-table-small>table>tbody>tr.ti3-table-nodata-guide>td a{color:var(--ti-table-tr-bg-color-nodata-color);text-decoration:none}.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table-small>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table-small>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table-small>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-small>table>tbody>tr.ti3-table-loadfail>td a:hover,.ti3-table-small>table>tbody>tr.ti3-table-nodata-guide>td a:hover{color:var(--ti-table-tr-bg-color-nodata-color-hover);cursor:pointer;text-decoration:underline}.ti3-table-nest>.ti3-resize-wrapper>table>thead>tr>th,.ti3-table-nest>.ti3-table-container>table>thead>tr>th,.ti3-table-nest>.ti3-table-fixed-head>table>thead>tr>th,.ti3-table-nest>table>thead>tr>th{height:var(--ti-table-nest-th-height);line-height:var(--ti-table-nest-th-height)}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata>td,.ti3-table-nest>table>tbody>tr.ti3-table-nodata>td{background:var(--ti-table-nodata-td-bg-img-url) 50% var(--ti-table-nodata-lead-icon-padding) no-repeat;height:var(--ti-table-small-nodata-height);padding:calc(var(--ti-table-nodata-lead-icon-height) + var(--ti-table-nodata-lead-icon-padding)*2) 0 0 0;vertical-align:top}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td{background:none;vertical-align:top}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a{color:var(--ti-table-tr-bg-color-nodata-color);text-decoration:none}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-table-nodata-guide>td a:hover,.ti3-table-nest>table>tbody>tr.ti3-table-loadfail .ti3-table-nest>table>tbody>tr.ti3-table-nodata-guide>td a:hover{color:var(--ti-table-tr-bg-color-nodata-color-hover);cursor:pointer;text-decoration:underline}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr>td,.ti3-table-nest>table>tbody>tr>td{border-bottom:1px solid var(--ti-table-nest-td-border-bottom-color);height:var(--ti-table-nest-td-height);line-height:calc(var(--ti-table-nest-td-height) - var(--ti-table-small-td-vertical-padding)*2);padding:var(--ti-table-small-td-vertical-padding) var(--ti-table-small-td-horizontal-padding)}.ti3-table-nest>.ti3-resize-wrapper>table>tbody>tr.ti3-details-tr>td,.ti3-table-nest>.ti3-table-container>table>tbody>tr.ti3-details-tr>td,.ti3-table-nest>.ti3-table-fixed-head>table>tbody>tr.ti3-details-tr>td,.ti3-table-nest>table>tbody>tr.ti3-details-tr>td{padding:var(--ti-table-small-details-padding)}.ti3-resize-wrapper{min-height:0;overflow-x:auto}.ti3-unselectable{-ms-user-select:none;-webkit-user-select:none;user-select:none}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th.col-resize-active,.ti3-table>.ti3-table-container>table>thead>tr>th.col-resize-active,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th.col-resize-active,.ti3-table>table>thead>tr>th.col-resize-active{cursor:col-resize!important}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th.col-resize-active:after,.ti3-table>.ti3-table-container>table>thead>tr>th.col-resize-active:after,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th.col-resize-active:after,.ti3-table>table>thead>tr>th.col-resize-active:after{background:transparent;border-right:var(--ti-table-col-resize-line);bottom:0;content:\"\";height:100%;position:absolute;right:0;top:0;width:2px}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td.col-resize-active,.ti3-table>.ti3-table-container>table>tbody>tr>td.col-resize-active,.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td.col-resize-active,.ti3-table>table>tbody>tr>td.col-resize-active{position:relative}.ti3-table>.ti3-resize-wrapper>table>tbody>tr:not(.ti3-table-nodata)>td.col-resize-active:after,.ti3-table>.ti3-table-container>table>tbody>tr:not(.ti3-table-nodata)>td.col-resize-active:after,.ti3-table>.ti3-table-fixed-head>table>tbody>tr:not(.ti3-table-nodata)>td.col-resize-active:after,.ti3-table>table>tbody>tr:not(.ti3-table-nodata)>td.col-resize-active:after{border-right:var(--ti-table-col-resize-line);bottom:0;content:\"\";height:100%;position:absolute;right:0;top:0;width:2px}.ti3-cols-toggle-container{display:inline-block}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container{background:var(--ti-button-default-normal-bg-color);border:1px solid var(--ti-table-cols-toggle-menu-border-color);border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-table-cols-toggle-menu-size);line-height:var(--ti-table-cols-toggle-menu-line-height);position:relative;text-align:center;width:var(--ti-table-cols-toggle-menu-size)}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container .ti3-cols-toggle-menu{color:var(--ti-table-cols-toggle-menu-color);font-size:var(--ti-table-cols-toggle-menu-font-size)}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container:focus,.ti3-cols-toggle-container .ti3-cols-toggle-menu-container:hover{background-color:var(--ti-button-default-bg-color-hover)}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container:focus .ti3-cols-toggle-menu,.ti3-cols-toggle-container .ti3-cols-toggle-menu-container:hover .ti3-cols-toggle-menu{color:var(--ti-table-cols-toggle-menu-color-hover)}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container.ti3-cols-toggle-menu-disabled{border-color:var(--ti-table-cols-toggle-menu-border-color-disabled);cursor:not-allowed}.ti3-cols-toggle-container .ti3-cols-toggle-menu-container.ti3-cols-toggle-menu-disabled .ti3-cols-toggle-menu{color:var(--ti-table-cols-toggle-menu-color-disabled)}.ti3-cols-toggle-container[tiFocused] .ti3-cols-toggle-menu-container:not(.ti3-cols-toggle-menu-disabled) .ti3-cols-toggle-menu{color:var(--ti-table-cols-toggle-menu-color-hover)}.ti3-cols-toggle-container .ti3-cols-toggle-drop-container{display:inline-block}.ti3-cols-toggle-drop{border-radius:var(--ti-table-cols-toggle-dropdown-border-radius);box-shadow:var(--ti-table-cols-toggle-dropdown-box-shadow);max-width:300px!important;min-width:200px!important}.ti3-cols-toggle-drop>.ti3-cols-toggle-searchbox-wrap{-ms-box-sizing:border-box;box-sizing:border-box;padding:var(--ti-table-cols-toggle-searchbox-top-padding) var(--ti-table-cols-toggle-horizontal-padding) var(--ti-table-cols-toggle-searchbox-bottom-padding)!important}.ti3-cols-toggle-drop>.ti3-cols-toggle-searchbox-wrap .ti3-cols-toggle-searchbox{width:100%!important}.ti3-cols-toggle-drop .ti3-overflow-padding{padding:0 var(--ti-table-cols-toggle-horizontal-padding)!important}.ti3-cols-toggle-drop .ti3-dropdown-no-data{padding-left:var(--ti-table-cols-toggle-horizontal-padding)!important}.ti3-cols-toggle-drop .ti3-dropdown-option-hover{color:var(--ti-common-color-text-primary)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container,.ti3-table>table>thead>tr>th>.ti3-sort-container{cursor:pointer;display:inline-block;outline-offset:-1px}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container .ti3-sort,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container .ti3-sort,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container .ti3-sort,.ti3-table>table>thead>tr>th>.ti3-sort-container .ti3-sort{cursor:pointer;display:inline-block;font-size:16px;height:16px;line-height:16px;margin-left:8px;vertical-align:middle;width:16px}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container .ti3-sort:hover,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container .ti3-sort:hover,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container .ti3-sort:hover,.ti3-table>table>thead>tr>th>.ti3-sort-container .ti3-sort:hover{color:var(--ti-table-sort-color-hover)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container .ti3-sort:before,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container .ti3-sort:before,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container .ti3-sort:before,.ti3-table>table>thead>tr>th>.ti3-sort-container .ti3-sort:before{content:\"\\e917\";display:inline-block;height:16px;line-height:16px;width:16px}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort{color:var(--ti-table-sort-icon-color-active)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:hover,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:hover,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:hover,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:hover{color:var(--ti-table-sort-color-hover)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:before,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:before,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:before,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-ascent .ti3-sort:before{content:\"\\e92e\"}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort{color:var(--ti-table-sort-icon-color-active)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:hover,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:hover,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:hover,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:hover{color:var(--ti-table-sort-color-hover)}.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:before,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:before,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:before,.ti3-table>table>thead>tr>th>.ti3-sort-container.ti3-sort-descent .ti3-sort:before{content:\"\\e92f\"}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>.ti3-table-container>table>tbody>tr>td>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>table>tbody>tr>td>.ti3-cell-text-container>.ti3-cell-text,.ti3-table>table>thead>tr>th>.ti3-cell-text-container>.ti3-cell-text{display:inline-block;vertical-align:top}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td>.ti3-cell-icons-container,.ti3-table>.ti3-resize-wrapper>table>thead>tr>th>.ti3-cell-icons-container,.ti3-table>.ti3-table-container>table>tbody>tr>td>.ti3-cell-icons-container,.ti3-table>.ti3-table-container>table>thead>tr>th>.ti3-cell-icons-container,.ti3-table>.ti3-table-fixed-head>table>tbody>tr>td>.ti3-cell-icons-container,.ti3-table>.ti3-table-fixed-head>table>thead>tr>th>.ti3-cell-icons-container,.ti3-table>table>tbody>tr>td>.ti3-cell-icons-container,.ti3-table>table>thead>tr>th>.ti3-cell-icons-container{display:inline-block}.ti3-table>.ti3-resize-wrapper>table>tbody>.ti3-details-tr,.ti3-table>.ti3-table-container>table>tbody>.ti3-details-tr,.ti3-table>table>tbody>.ti3-details-tr{background:var(--ti-table-details-bg-color)}.ti3-table>.ti3-resize-wrapper>table>tbody>.ti3-details-tr>td,.ti3-table>.ti3-table-container>table>tbody>.ti3-details-tr>td,.ti3-table>table>tbody>.ti3-details-tr>td{border-bottom:1px solid var(--ti-table-border-bottom-color);padding:var(--ti-table-details-padding);white-space:normal}.ti3-table>.ti3-resize-wrapper>table>tbody>.ti3-details-tr>td>.ti3-table-detail-container,.ti3-table>.ti3-table-container>table>tbody>.ti3-details-tr>td>.ti3-table-detail-container,.ti3-table>table>tbody>.ti3-details-tr>td>.ti3-table-detail-container{background-color:var(--ti-common-color-bg-white-normal);padding:var(--ti-common-space-5x)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-toggle-details,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-toggle-details,.ti3-table>table>tbody>tr>td .ti3-toggle-details{color:var(--ti-table-details-icon-color);cursor:pointer}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-toggle-details .ti3-icon,.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-toggle-details .ti3-icon,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout,.ti3-table>table>tbody>tr>td .ti3-toggle-details .ti3-icon,.ti3-table>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout{font-size:15px;vertical-align:middle}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-toggle-details .ti3-icon:hover,.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout:hover,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-toggle-details .ti3-icon:hover,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout:hover,.ti3-table>table>tbody>tr>td .ti3-toggle-details .ti3-icon:hover,.ti3-table>table>tbody>tr>td .ti3-toggle-details .ti3-table-soldout:hover{color:var(--ti-table-details-icon-color-hover)}.ti3-icon-angle-transform-up-thin{display:inline-block;transform:rotate(-90deg)}.ti3-icon-angle-transform-down-thin{display:inline-block;transform:rotate(90deg)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree,.ti3-table>table>tbody>tr>td .ti3-table-tree{cursor:pointer}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square,.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square{font-size:var(--ti-table-tree-square-icon-font-size);line-height:18px;margin-right:var(--ti-table-tree-square-right-space);vertical-align:bottom}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square{color:var(--ti-table-tree-minus-square-color)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square{color:var(--ti-table-tree-plus-square-color)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:hover,.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:hover,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:hover,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:hover,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:hover,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:hover{color:var(--ti-table-tree-minus-square-color-hover)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:active,.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:active,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:active,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:active,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-minus-square:active,.ti3-table>table>tbody>tr>td .ti3-table-tree .ti3-icon-plus-square:active{background:var(--ti-table-tree-square-bg);color:var(--ti-table-tree-minus-square-color)}.ti3-table>.ti3-resize-wrapper>table>tbody>tr>td .ti3-table-tree-no-leaf,.ti3-table>.ti3-table-container>table>tbody>tr>td .ti3-table-tree-no-leaf,.ti3-table>table>tbody>tr>td .ti3-table-tree-no-leaf{margin-left:calc(var(--ti-table-tree-square-icon-font-size) + var(--ti-table-tree-square-right-space))}.ti3-table-cell-clone{-ms-box-sizing:var(--ti-table-box-model);box-sizing:var(--ti-table-box-model);overflow:visible!important;position:absolute!important;visibility:hidden!important;width:auto!important}.ti3-table>.ti3-table-fixed-head{overflow:hidden;position:relative}.ti3-table>.ti3-table-fixed-head>table{margin-left:0}.ti3-table>.ti3-table-fixed-head>.ti3-table-fixed-head-filler{background-color:var(--ti-table-th-bg-color);bottom:0;height:100%;position:absolute;right:0;top:0}.ti3-table>.ti3-table-fixed-head+.ti3-table-container{border-bottom:1px solid var(--ti-table-border-bottom-color)}.ti3-table>.ti3-table-fixed-head+.ti3-table-container>table>thead>tr>th{height:0}.ti3-table>.ti3-table-fixed-head+.ti3-table-container>table>tbody>tr:last-child>td{border-bottom:none!important}.ti3-table>.ti3-table-container{overflow:auto}.ti3-table-column-fixed-left{background-color:inherit;left:0;position:sticky!important;z-index:1}.ti3-table-column-fixed-left.ti3-table-floating-fixed-column{box-shadow:5px 0 5px 0 rgba(0,0,0,.1)}.ti3-table-column-fixed-right{background-color:inherit;position:sticky!important;right:0;z-index:1}.ti3-table-column-fixed-right.ti3-table-floating-fixed-column{box-shadow:-5px 0 5px 0 rgba(0,0,0,.1)}.ti3-table-row-disable{color:#999}.ti3-table-soldout{background:#999;color:#fff;display:inline-block;font-size:12px;height:16px;line-height:16px;text-align:center;width:16px}.ti3-table-row-message,.ti3-table-row-message-new,.ti3-table-row-message-recommended,.ti3-table-row-message-soldout{color:#fff;display:inline-block;font-size:12px;height:16px;line-height:16px;margin-left:5px;padding:0 4px;text-align:center}.ti3-table-row-message-soldout{background:#999}.ti3-table-row-message-new{background:#e41f2b}.ti3-table-row-message-recommended{background:#f57f06}@keyframes ti3-table-tr-entrance-keyframes{0%{transform:scaleX(.98);transform-origin:right center}to{transform:scaleX(1);transform-origin:right center}}.ti3-table:not([ti-table-tr-no-animate]) tbody tr:not(.ti3-details-tr).ng-enter{animation:ti3-table-tr-entrance-keyframes .3s cubic-bezier(.4,0,.2,1),ti3-fade-in-keyframes .3s cubic-bezier(.4,0,.2,1)}.ti3-table:not([ti-table-tr-no-animate]) tbody tr.ng-enter-stagger{animation-delay:.01s}@keyframes ti3-details-tr-open-keyframes{0%{transform:scaleY(0);transform-origin:top center}to{transform:scaleY(1);transform-origin:top center}}.ti3-details-tr.ng-enter{animation:ti3-details-tr-open-keyframes .15s cubic-bezier(.4,0,.2,1) forwards,ti3-fade-in-keyframes .15s cubic-bezier(.4,0,.2,1) forwards}"]
            },] }
];
TiTableComponent.ctorParameters = () => [
    { type: IterableDiffers },
    { type: ElementRef },
    { type: TiTableFixedHeadService },
    { type: Renderer2 },
    { type: NgZone },
    { type: TiRenderer }
];
TiTableComponent.propDecorators = {
    srcData: [{ type: Input }],
    displayedData: [{ type: Input }],
    storageId: [{ type: Input }],
    storageConfig: [{ type: Input }],
    displayedDataChange: [{ type: Output }],
    columns: [{ type: Input }],
    searchWords: [{ type: Input }],
    searchKeys: [{ type: Input }],
    closeOtherDetails: [{ type: Input }],
    stateUpdate: [{ type: Output }]
};

/**
 * @ignore
 * TiHeadFilterDrop 表头过滤漏斗组件的下拉框选择组件
 */
class TiHeadFilterDropComponent extends TiDropsearchComponent {
    constructor() {
        super(...arguments);
        this.dominatorSpace = TiHeadFilterDropComponent.DOMINATOR_SPACE + 'px';
        this.heightExcludeContent = 10; // 上下边框为2，上下padding为8
        this.buttonHeight = 45; // 确定、取消按钮高度
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 重新设置headfilterdrop的heightExcludeList
        if (changes['searchable']) {
            if (changes['searchable'].currentValue) {
                this.heightExcludeList = this.multiple ? this.heightExcludeContent + this.buttonHeight + TiDropsearchComponent.SEARCHBOX_EXCLUDE_HEIGHT
                    : this.heightExcludeContent + TiDropsearchComponent.SEARCHBOX_EXCLUDE_HEIGHT;
            }
            else {
                this.heightExcludeList = this.multiple ? this.heightExcludeContent + this.buttonHeight : this.heightExcludeContent;
            }
        }
    }
    writeValue(model) {
        super.writeValue(model);
        // 初始化selected选中项
        if (this.multiple) {
            this.selected = [...model ? model : []];
        }
        else {
            this.selected = model ? model : '';
        }
    }
    onSelect(option) {
        // 多选时不处理onSelect事件（在点击确定按钮时触发）
        if (this.multiple) {
            return;
        }
        super.onSelect(option);
        this.model = option;
    }
    hide() {
        // 处理问题：IE 下有搜索框时，在下拉中选择完收起后漏斗图标由于聚焦而有了虚线框
        if (TiBrowser.isIE() && this.searchable) {
            this.render.setStyle(this.dominatorElem, 'outlineStyle', 'none');
            super.hide();
        }
        else {
            super.hide();
        }
        // 还原selected选中项
        if (this.multiple) {
            this.selected = [...this.model ? this.model : []];
        }
    }
    hideWithoutFocus() {
        super.hideWithoutFocus();
        // 还原selected选中项
        if (this.multiple) {
            this.selected = [...this.model ? this.model : []];
        }
    }
    // 按钮面板鼠标按下事件（解决因点击按钮面板导致整个下拉面板隐藏的问题）
    btnContainerMousedown(event) {
        event.preventDefault();
    }
    // 确定按钮
    okClick() {
        // 选中值发生改变时对model值做处理
        if (JSON.stringify(this.selected) !== JSON.stringify(this.model ? this.model : [])) {
            this.model = [...this.selected];
        }
        // 触发onSelect事件
        this.select.emit(this.model);
        this.hide();
    }
    // 取消按钮
    cancelClick() {
        // 还原selected选中项
        this.selected = [...this.model ? this.model : []];
        this.hide();
    }
}
TiHeadFilterDropComponent.DOMINATOR_SPACE = 6;
TiHeadFilterDropComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-head-filter-drop',
                template: "<ti-drop  class=\"ti3-head-filter-drop\"\r\n          [dominatorElem]=\"dominatorElem\"\r\n          [panelWidth]='panelWidth'\r\n          [panelAlign]='panelAlign'\r\n          [dominatorSpace]=\"dominatorSpace\">\r\n    <div *ngIf=\"searchable\">\r\n        <ti-searchbox-notsearch #searchboxCom noBorder\r\n            [placeholder]=\"placeholder\"\r\n            [(ngModel)]=\"searchWord\"\r\n            (ngModelChange)=\"searchWordChange($event)\"\r\n            [id]=\"appendId('searchbox')\">\r\n        </ti-searchbox-notsearch>\r\n    </div>\r\n    <ti-list [multiple]=\"multiple\"\r\n        [selectAll]=\"selectAll\"\r\n        [options]=\"((type !== 'suggestion' && searchable) || type === 'suggestion')?searchResult:options\"\r\n        [(ngModel)]=\"selected\"\r\n        [labelKey]=\"labelKey\"\r\n        [noDataText]=\"noDataText\"\r\n        style=\"display:block;\"\r\n        (select)=\"onSelect($event)\"\r\n        [id]=\"appendId('list')\">\r\n    </ti-list>\r\n    <section *ngIf=\"multiple\" (mousedown)=\"btnContainerMousedown($event)\">\r\n        <section class=\"ti3-head-filter-drop-button-container\">\r\n            <button type=\"button\"\r\n                tiButton\r\n                size=\"small\"\r\n                class=\"ti3-head-filter-drop-button-ok\"\r\n                (click)=\"okClick()\"\r\n                [id]=\"appendId('ok')\">{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n            <button type=\"button\"\r\n                tiButton\r\n                size=\"small\"\r\n                (click)=\"cancelClick()\"\r\n                [id]=\"appendId('cancel')\">{{ 'tiCommon.cancelBtn' | tiTranslate }}</button>\r\n        </section>\r\n    </section>\r\n</ti-drop>",
                providers: [TiFormComponent.getValueAccessor(TiHeadFilterDropComponent)],
                styles: [".ti3-head-filter-drop ti-searchbox-notsearch{width:100%}.ti3-head-filter-drop-button-container{border-top:1px solid var(--ti-common-color-line-dividing);margin:0 var(--ti-common-space-10);padding:var(--ti-common-space-10) 0}.ti3-head-filter-drop-button-ok{margin-right:var(--ti-common-space-2x)}"]
            },] }
];

// 下面注释，可以避免编译lib时正则报错。原理未知，副作用未知。
// @dynamic
/**
 * TiHeadFilter 表头过滤(漏斗)组件， 嵌在表头的 th 中使用。
 *
 * ti-head-filter 用来显示过滤操作漏斗图标，点击其可打开下拉框，选中下拉框中的选项时，
 * 可在提供的 select 事件中做对应的表格数据过滤处理。
 *
 * ### 接口说明
 * **Inputs：**
 *
 * |     名称    |  类型   | 默认值   | 功能描述  |
 * | --------   | :-----   | :---- | :---- |
 * | options   | array  | [] | 所有过滤项 |
 * | ngModel   | object  | false | 可设置和获取 headfilter下拉选中值 |
 * | labelKey   |  string  | 'label' | 下拉面板中要显示的字段, 10.0.2版本新增 |
 * | panelMaxHeight   |  string  | 最大显示8条数据 | 下下拉面板的最大显示高度，溢出时则出滚动条。 |
 * | id   | string  | undefined | HTML属性id，自动化测试要求必须给id赋值 |
 * | select   | function  | 无 | 下拉面板选中事件，向外通知选中数据 |
 * | multiple   |  boolean  | false | 下拉面板是否为多选 |
 * | selectAll   |  boolean  | false | 下拉面板是否显示全选框 |
 * | panelAlign   |  string  | 'left' | 下拉面板展开对齐方式，9.0.4版本新增 |
 * | searchable   |  boolean  | false | 是否开启搜索功能，10.0.2版本新增 |
 * | panelWidth   |  'auto' 或 string  | 'auto' | 设置下拉面板的宽度，"auto"表示下拉框的宽度根据下拉选项的内容自动撑开，也可设置固定的下拉框宽度(不小于过滤图标的宽度)，例如："200px", 10.0.2版本新增 |
 * | noDataText   |  string  | '...' | 无数据时的显示文本。10.0.3版本新增 |
 *
 * <p><span style="color: red">以下说明不可用，不做参考。</span>该组件只有以上5个Input接口和1个Output接口
 * 可用，其余方法、Input、输出等(继承于TiSelectComponent,是供select的内部使用的)都不可用</p>
 */
class TiHeadFilterComponent extends TiSelectComponent {
    constructor() {
        super(...arguments);
        /**
         * 面板对齐方式
         *
         * 9.0.4新增
         */
        this.panelAlign = 'left';
        // 由于headfilter与select中的panelWidth的默认值和类型不一样，所以这里重定义panelWidth接口
        /**
         * 下拉面板的最大显示宽度，该变量与下拉类组件保持一致
         *
         * 1."auto": 下拉框的宽度根据下拉选项的内容自动撑开；
         *
         * 2.表示宽度的字符串: 设置固定的下拉框宽度(不小于Select组件的宽度)。例如："200px"
         *
         * 10.0.2版本新增，默认为'auto'，10.1.2起<b>搜索场景下</b>默认值修改为“180px”，
         */
        // 置为undefined是为了覆盖父类的panelWidth值
        this.panelWidth = undefined;
    }
    ngAfterViewChecked() {
        // 这里不能调用父类方法，因为Select父类对dominator处理，空指针报错。
        // TODO: 看是否能够不继承select
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems([this.filterIconEleRef.nativeElement]
                    .concat(this.dropsearchCom.getFocusableElems()));
            }
            else {
                this.setFocusableElems([this.filterIconEleRef.nativeElement]);
            }
        }
    }
    /**
     * @ignore
     * 失焦情况下，仅关闭面板，不做聚焦等处理
     */
    onBlur() {
        super.onBlur();
        if (TiBrowser.isIE() && this.searchable) {
            if (getComputedStyle(this.filterIconEleRef.nativeElement).outlineStyle === 'none') {
                this.renderer.setStyle(this.filterIconEleRef.nativeElement, 'outlineStyle', '');
            }
        }
    }
}
TiHeadFilterComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-head-filter',
                template: "<a #filterIcon\r\n     href=\"javascript:void(0)\"\r\n     oncontextmenu=\"return false\"\r\n     class=\"ti3-icon ti3-icon-filter ti3-head-filter-icon\"\r\n     (click)=\"onClickDominator()\"\r\n     (keydown)=\"onKeydown($event)\"\r\n     [id]=\"appendId('head-filter')\">\r\n</a>\r\n<ti-head-filter-drop [dominatorElem]=\"filterIconEleRef.nativeElement\"\r\n                     [(ngModel)]=\"model\"\r\n                     [panelWidth]=\"panelWidth?panelWidth:searchable?'180px':'auto'\"\r\n                     [panelAlign]='panelAlign'\r\n                     [searchable]=\"searchable\"\r\n                     [options]=\"options\"\r\n                     [multiple]=\"multiple\"\r\n                     [selectAll]=\"selectAll\"\r\n                     [panelMaxHeight]=\"panelMaxHeight\"\r\n                     [labelKey]=\"labelKey\"\r\n                     [noDataText]=\"noDataText\"\r\n                     (select)=\"onSelect($event)\"\r\n                     [id]=\"appendId('headfilter_drop')\"></ti-head-filter-drop>",
                providers: [TiFormComponent.getValueAccessor(TiHeadFilterComponent)],
                host: {
                    '[class.ti3-head-filter-container]': 'true',
                    '(blur)': 'onBlur()'
                },
                styles: [":host.ti3-head-filter-container{display:inline-block;line-height:16px;padding-left:5px;vertical-align:middle;width:16px}:host.ti3-head-filter-container .ti3-head-filter-icon{color:var(--ti-table-details-icon-color);cursor:pointer;font-size:16px;text-decoration:none}:host.ti3-head-filter-container .ti3-head-filter-icon:hover{color:var(--ti-table-details-icon-color-hover)}:host.ti3-head-filter-container.ti3-head-filtered .ti3-head-filter-icon{color:var(--ti-head-filter-filtered-color)}"]
            },] }
];
TiHeadFilterComponent.propDecorators = {
    panelAlign: [{ type: Input }],
    panelWidth: [{ type: Input }],
    filterIconEleRef: [{ type: ViewChild, args: ['filterIcon', { static: true },] }],
    dropsearchCom: [{ type: ViewChild, args: [TiHeadFilterDropComponent, { static: true },] }]
};

/**
 * TiHeadSort 表头排序(上下箭头)组件
 *
 * 嵌在表头的th中使用，点击该组件时表格数据按该列的排序规则进行升序/降序排序
 *
 * 组件有默认的排序规则，也可支持自定义排序规则
 */
class TiHeadSortComponent {
    constructor(elementRef, table) {
        this.elementRef = elementRef;
        /**
         * 指定初始时在对应 sortKey下是否为升序排序。默认值为null, 表示无序(不升序也不降序)
         */
        this.asc = null;
        /**
         * @ignore
         */
        this.clickNum = 0;
        this.hostElement = this.elementRef.nativeElement;
        this.table = table;
    }
    ngOnInit() {
        // 更新TiTableComponent的enableSort，表示启用了排序。
        this.table.enableSort = true;
        // 修复SSR报错：ERROR TypeError: Cannot read property 'sort' of undefined
        // 表格记忆
        if (this.table.storageId && this.table.storageConfig && this.table.storageConfig.sort && this.table.sessionStorageState && this.table.sessionStorageState.sort) {
            if (this.sortKey === this.table.sessionStorageState.sort.sortKey) {
                this.asc = this.table.sessionStorageState.sort.asc;
            }
            else {
                this.asc = null;
            }
        }
        if (this.asc !== null) {
            this.clickNum = this.asc ? 0 : 1;
            // 如果有默认排序，即排序的初始化，将排序初始化的各个值赋给 tiTable 的 tableState 对应的 sort 属性
            this.sort(true);
        }
    }
    ngDoCheck() {
        if (this.table.dataState.sort.sortKey !== this.sortKey) {
            this.clickNum = 0;
        }
    }
    /**
     * @ignore
     */
    onClick() {
        if (!this.sortKey) {
            return;
        }
        this.sort(false);
    }
    sort(isDefaultSort) {
        this.clickNum++;
        // this.clickNum整除3余2表示降序，余1表示升序，余0表示无序
        const isDesc = this.clickNum % 3 === 2 ? true : this.clickNum % 3 === 1 ? false : null;
        this.table.updateSort(this.sortKey, isDesc, isDefaultSort, this.compareFn);
    }
}
TiHeadSortComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-head-sort',
                template: "<span tiOutline class=\"ti3-sort ti3-icon\" [attr.tabindex] = '0' (keydown.enter) = 'onClick()'></span>",
                host: {
                    '[class.ti3-sort-container]': 'true',
                    '[class.ti3-sort-ascent]': 'sortKey === table.dataState.sort.sortKey && clickNum % 3 === 1',
                    '[class.ti3-sort-descent]': 'sortKey === table.dataState.sort.sortKey && clickNum % 3 === 2',
                    '(click)': 'onClick()'
                }
            },] }
];
TiHeadSortComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: TiTableComponent }
];
TiHeadSortComponent.propDecorators = {
    sortKey: [{ type: Input }],
    asc: [{ type: Input }],
    compareFn: [{ type: Input }]
};

/**
 * TiDetailsIcon 详情展开图标组件
 *
 * ti-details-icon 用来显示详情展开图标，其嵌在详情展开列的 td 标签中；
 * 点击该图标，对应详情行在展开/收起两个状态之间切换。
 */
class TiDetailsIconComponent {
    constructor(table, elementRef, renderer) {
        this.table = table;
        this.elementRef = elementRef;
        this.renderer = renderer;
        /**
         * 点击详情展开图标时触发此接口函数，其中showDetails属性控制其是否展开；
         *
         * 一旦使用此接口，就由开发者决定其是否要展开或收起。
         */
        this.beforeToggle = new EventEmitter();
        this.oldShowDetails = false;
        this.element = this.elementRef.nativeElement;
    }
    ngOnInit() {
        this.row = Util.isUndefined(this.row) ? {} : this.row;
        this.row.showDetails = Util.isUndefined(this.row.showDetails) ? false : this.row.showDetails;
        // 给当前行添加样式类标记
        const parentTr = this.renderer.parentNode(this.renderer.parentNode(this.element));
        this.renderer.addClass(parentTr, TiDetailsIconComponent.TABLE_ClASS_DETAIL_BASE);
    }
    ngDoCheck() {
        // 如果需要关闭其它行的详情(即只能展开一行的详情)时，需要监听showDetails
        if (this.table.closeOtherDetails && this.row.showDetails !== this.oldShowDetails) {
            this.oldShowDetails = this.row.showDetails;
            if (this.row.showDetails) {
                // 当打开当前行的详情时，关闭其他行的详情
                this.table.closeOtherDetailsFn(this.row);
            }
        }
    }
    /**
     * @ignore
     */
    onClick() {
        if (this.beforeToggle.observers.length > 0) {
            this.beforeToggle.emit(this.row);
        }
        else {
            this.row.showDetails = !this.row.showDetails;
        }
        // 为了解决 codeclub #1720
        // 在chrome浏览器下，滚动条滚到底部后，这时页面内容高度变小，滚动条保留在底部(正常的现象),
        // 之后页面内容高度再变大时，滚动条依然保留在底部。
        // 这导致了当页面滚动条拖动到底部后，将表格的pagesize由大变小(如20条修改为10条)，再去点击某一行详情展开时，
        // 视觉上详情行是向上展开的，其原因是滚动条一直停留在底部；这时，只要稍微手动触发滚动条滚动，详情正常展开
        // 注意：此问题只修复了在body上出滚动条的表格的详情展开问题。
        if (TiBrowser.isChrome()) {
            const scrollTop = Math.ceil(document.documentElement.scrollTop);
            // 窗口可视区域高度
            const height = document.documentElement.clientHeight;
            const scrollHeight = document.body.scrollHeight;
            if (scrollTop > 0 && scrollTop + height >= scrollHeight) {
                document.body.scrollTop = scrollTop - 0.5;
                document.body.scrollTop = scrollTop + 0.5;
            }
        }
    }
}
/**
 * @ignore
 * 表格详情中，非详情行标记样式类
 */
TiDetailsIconComponent.TABLE_ClASS_DETAIL_BASE = 'ti3-table-detail-icon-tr';
TiDetailsIconComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-details-icon',
                template: "<a href=\"javascript:void(0)\" oncontextmenu=\"return false\" class=\"ti3-toggle-details\">\r\n    <i style=\"line-height: 18px;\" class=\"ti3-icon ti3-icon-angle-right\"\r\n       [ngClass]=\"{'ti3-icon-angle-transform-down-thin': !row.showDetails,'ti3-icon-angle-transform-up-thin': row.showDetails}\"></i>\r\n</a>",
                host: {
                    '(click)': 'onClick()'
                }
            },] }
];
TiDetailsIconComponent.ctorParameters = () => [
    { type: TiTableComponent },
    { type: ElementRef },
    { type: Renderer2 }
];
TiDetailsIconComponent.propDecorators = {
    row: [{ type: Input }],
    index: [{ type: Input }],
    beforeToggle: [{ type: Output }]
};

/**
 * TiDetailsTr 详情行结构指令
 *
 * 使用时需要在其前面加 * 语法糖，传入当前行数据；
 * 其内部根据row.showDetails的值来控制详情行是否显示，功能类似于ngIf。
 */
class TiDetailsTrDirective {
    constructor(templateRef, viewContainerRef, renderer, table) {
        this.templateRef = templateRef;
        this.viewContainerRef = viewContainerRef;
        this.renderer = renderer;
        this.table = table;
    }
    ngDoCheck() {
        if (this.row.showDetails !== this.oldShowDetails) {
            this.updateView();
            this.oldShowDetails = this.row.showDetails;
        }
    }
    updateView() {
        if (this.row.showDetails) {
            // 上下文参数是否需要传递
            this.viewContainerRef.createEmbeddedView(this.templateRef);
            // 结构指令的宿主元素是一个 comment(注释) 的Node节点，
            // 生成节点元素插入DOM中的位置跟angularCompilerOptions.enableIvy 配置有关，true时在宿主元素之前，false时在宿主元素之后，
            // 而 ng9开始angularCompilerOptions.enableIvy 默认为true,但一些项目为兼容性，强制设置为了false，所以要做一下兼容处理
            let detailTr;
            const nativeElement = this.templateRef.elementRef.nativeElement;
            if (nativeElement.previousSibling && nativeElement.previousSibling.classList &&
                nativeElement.previousSibling.classList.contains(TiDetailsIconComponent.TABLE_ClASS_DETAIL_BASE)) {
                detailTr = nativeElement.nextSibling;
            }
            else {
                detailTr = nativeElement.previousSibling;
            }
            this.renderer.addClass(detailTr, 'ti3-details-tr');
        }
        else {
            this.viewContainerRef.clear();
            //  TODO: 方案是否可优化
            // 表头锁定时，展开时可在table的AfterViewChecked中获取到表格变化后的高度，
            // 但是收起时，在table的AfterViewChecked中获取不到表格变化后的高度，不能及时处理滚动条的变化
            // 所以此处使用setTimeout使其延时触发table的AfterViewChecked，使其能够处理由高度变化引起的滚动条状态的改变
            // 注：使用ngIf指令也是如此效果
            if (this.table.isFixedHead) {
                setTimeout(() => { }, 0);
            }
        }
    }
}
TiDetailsTrDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiDetailsTr]'
            },] }
];
TiDetailsTrDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: Renderer2 },
    { type: TiTableComponent }
];
TiDetailsTrDirective.propDecorators = {
    row: [{ type: Input, args: ['tiDetailsTr',] }]
};

/**
 * TiColspan 表格跨列数colspan 计算，
 *
 * 根据表头第一行tr中th的数目，同步colspan数。
 *
 * 主要配合表格详情展开功能使用，用于表格详情展示行的的列合并。
 *
 */
class TiColspanDirective {
    constructor(table, renderer, elementRef) {
        this.table = table;
        this.renderer = renderer;
        this.elementRef = elementRef;
    }
    ngAfterViewInit() {
        // 获取thead中第一行tr
        const tableFirstTr = this.table.nativeElement.querySelector('table>thead>tr');
        if (!tableFirstTr) {
            return;
        }
        // 初始化设置一次colspan
        this.renderer.setAttribute(this.elementRef.nativeElement, 'colspan', String(tableFirstTr.children.length));
        // 修复SSR报错：ERROR ReferenceError: MutationObserver is not defined
        if (typeof MutationObserver === 'undefined') {
            return;
        }
        this.firstTrObserver = new MutationObserver((mutationsList) => {
            for (let mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    this.renderer.setAttribute(this.elementRef.nativeElement, 'colspan', String(tableFirstTr.children.length));
                }
            }
        });
        // 只需要处理tr中th的增删，所以只配置 childList为true,
        this.firstTrObserver.observe(tableFirstTr, { childList: true, });
    }
    ngOnDestroy() {
        if (this.firstTrObserver) {
            this.firstTrObserver.disconnect();
        }
    }
}
TiColspanDirective.decorators = [
    { type: Directive, args: [{
                selector: 'td[tiColspan]'
            },] }
];
TiColspanDirective.ctorParameters = () => [
    { type: TiTableComponent },
    { type: Renderer2 },
    { type: ElementRef }
];

/**
 * @ignore
 * TiColsToggleDrop 控制列动态隐藏/显示的下拉组件
 *
 */
class TiColsToggleDropComponent extends TiDropsearchComponent {
    constructor(iterableDiffers, elementRef, renderer2, zone, table) {
        super(renderer2, elementRef, zone);
        this.iterableDiffers = iterableDiffers;
        this.table = table;
        this.dominatorSpace = TiColsToggleDropComponent.DOMINATOR_SPACE + 'px';
        this.columns = [];
        this.listLabelKey = 'title';
        this.optionsChangeInner = false;
        this.isDisabledFn = (item) => {
            return item.disabled === true || (item.show === undefined && item !== this.listCom.optionSelectAll);
        };
    }
    static trackByFn(index, item) {
        // 表格记忆show属性也需要跟踪
        return item.title + item.show;
    }
    ngOnInit() {
        super.ngOnInit();
        this.multiple = true; // 设置为多选。
        this.heightExcludeList = this.searchable ? TiColsToggleDropComponent.DROP_VERTICAL_PADDING +
            TiColsToggleDropComponent.SEARCHBOX_AREA_HEIGHT : TiColsToggleDropComponent.DROP_VERTICAL_PADDING;
        this.defaultListMaxHeight = this.searchable ? TiColsToggleDropComponent.LIST_WITH_SEARCHBOX_MAX_HEIGHT :
            TiColsToggleDropComponent.DEFAULT_LIST_MAX_HEIGHT;
        this.searchKeys = ['title'];
        this.columnsDiffer = this.iterableDiffers.find(this.options)
            .create(TiColsToggleDropComponent.trackByFn);
    }
    ngDoCheck() {
        super.ngDoCheck();
        const columnsDiffer = this.columnsDiffer.diff(this.options);
        if (columnsDiffer) {
            if (this.optionsChangeInner) {
                this.optionsChangeInner = false;
            }
            else {
                this.selectedColumns = this.options.filter((column) => {
                    return column.show === true || column.show === undefined;
                });
                this.columns = this.options.concat(); // 强制变化，不然colums.push的列不能出现在列表中，与自定义的noempty有关
            }
            // columns变化需要处理列固定
            if (this.table.fixedColumnInfo.hasFixedColumn) {
                // 需要延迟处理，columns变化时，组件渲染还未完成。
                // 但如果在ngAfterViewChecked处理，太频繁，影响性能。
                setTimeout(() => {
                    // 处理左侧列固定
                    this.table.updateFixedThLeftSubject.next();
                    this.table.updateFixedTdLeftSubject.next();
                    // 处理右侧列固定
                    const scrollLeft = this.table.fixedColumnInfo.container.scrollLeft;
                    const isRightColumnFloat = scrollLeft + this.table.fixedColumnInfo.container.clientWidth < this.table.fixedColumnInfo.container.scrollWidth;
                    this.table.containerScrollXChangeSubject.next({
                        scrollLeft,
                        isRightColumnFloat
                    });
                }, 0);
            }
        }
    }
    onSelect(option) {
        if (option === this.listCom.optionSelectAll) {
            this.options.forEach((item) => {
                if (!this.isDisabledFn(item)) {
                    item.show = this.selectedColumns.includes(item);
                }
            });
        }
        else {
            option.show = this.selectedColumns.includes(option);
        }
        this.optionsChangeInner = true;
        // 需要在父类select.emit之前，更改option内容
        super.onSelect(option);
        // TODO: 没有处理，用户主动改变绑定变量selectedColumns。应该在docheck里监听selectedColumns（this.model）
    }
    // 鼠标点击到搜索框外围的空白，会失焦导致面板关闭
    // 此处做特殊处理,当点击空白时通过阻止默认事件的方式处理
    onMousedownSearchBoxOuter(event) {
        if (event.target.tagName === 'INPUT') {
            return;
        }
        event.preventDefault();
    }
}
TiColsToggleDropComponent.DOMINATOR_SPACE = 4;
TiColsToggleDropComponent.DEFAULT_LIST_MAX_HEIGHT = 30 * 8 + 8;
TiColsToggleDropComponent.LIST_WITH_SEARCHBOX_MAX_HEIGHT = 30 * 7;
TiColsToggleDropComponent.SEARCHBOX_AREA_HEIGHT = 28 + 6 + 4; // 搜索框所占区域高度
TiColsToggleDropComponent.DROP_VERTICAL_PADDING = 4 + 4;
TiColsToggleDropComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-cols-toggle-drop',
                template: "<ti-drop class=\"ti3-cols-toggle-drop\"\r\n         [dominatorElem]=\"dominatorElem\"\r\n         [panelWidth]=\"panelWidth\"\r\n         [dominatorSpace]=\"dominatorSpace\"\r\n         panelAlign=\"right\"\r\n         (mousedown)=\"onMousedownSearchBoxOuter($event)\">\r\n    <div *ngIf=\"searchable\"\r\n         class=\"ti3-cols-toggle-searchbox-wrap\"\r\n         (mousedown)=\"onMousedownSearchBoxOuter($event)\">\r\n        <ti-searchbox-notsearch class=\"ti3-cols-toggle-searchbox\"\r\n                                [(ngModel)]=\"searchWord\"\r\n                                (ngModelChange)=\"searchWordChange($event)\"\r\n                                [id]=\"appendId('searchbox')\"></ti-searchbox-notsearch>\r\n    </div>\r\n    <ti-list [multiple]='multiple'\r\n             [options]='(searchable ? searchResult : columns) | tiColumns'\r\n             [labelKey]='listLabelKey'\r\n             [selectAll]='selectAll'\r\n             [(ngModel)]=\"selectedColumns\"\r\n             (select)=\"onSelect($event)\"\r\n             [isDisabledFn]=\"isDisabledFn\"\r\n             [noDataText]=\"noDataText\"\r\n             [id]=\"appendId('list')\"\r\n             tipPosition=\"left\"\r\n             style=\"display: block;\">\r\n    </ti-list>\r\n</ti-drop>",
                host: {
                    '[class.ti3-cols-toggle-drop-container]': 'true'
                }
            },] }
];
TiColsToggleDropComponent.ctorParameters = () => [
    { type: IterableDiffers },
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone },
    { type: TiTableComponent }
];

// 下面注释，可以避免编译lib时正则报错。原理未知，副作用未知。
// @dynamic
/**
 * TiColsToggle 控制列动态隐藏/显示的组件
 *
 * ti-cols-toggle 用来显示列操作按钮，点击该按钮可在打开的下拉中设置各列的隐藏/显示；
 * 在 ti-table 标签内，开发者可灵活设置其位置。
 *
 * TiTable 上的 columns 接口传入值各项(列)的 show 和 title 属性值影响着各列的隐藏/显示状
 * 态,具体可参考 TiTableComponen t组件的 columns 输入接口说明。
 *
 * 开发者必须给需要动态显示/隐藏的列(th，td)使用 ngIf, 利用 ngIf 和 tiTable 上的 columns
 * 接口值中每列的show的值来控制当前列的显示或隐藏。
 *
 * ### 接口说明
 * **Inputs：**
 *
 * |     名称    |  类型   | 默认值   | 功能描述  |
 * | --------   | :-----   | :---- | :---- |
 * |  disabled   | boolean  | false | 设置列操作按钮是否禁用 |
 * | searchable   | boolean  | false | 是否显示搜索框 |
 * | selectAll   | boolean  | false | 是否开启全选功能。3.1.2新增 |
 * | panelWidth   |  string  | 'justified' | 下拉面板的宽度，可选值为'justified'(默认), 'auto'或自定义宽度，但宽度不能小于select面板的宽度 |
 * | noDataText   |  string  | '...' | 无数据时的显示文本。10.0.3版本新增 |
 * | select   | EventEmitter<TiTableColumns>  | 无 | 选中/取消选中事件，向外通知当前项数据，需要自行判断当前项是否选中。Tiny3.1.2 版本新增 |
 * | focus   | HTML事件  | 无 | 聚焦事件 |
 * | blur   | HTML事件  | 无 | 失焦事件 |
 *
 * <p><span style="color: red">以下说明不可用，不做参考。</span>该组件只有以上disabled、searchable、panelWidth、selectAll 这四个Input接口
 * 和foucs、blur、select 这三个事件接口可用，其余方法、Input、输出等(继承于TiSelectComponent,是供select的内部使用的)都不可用</p>
 */
class TiColsToggleComponent extends TiSelectComponent {
    constructor(table, elementRef, renderer2) {
        super(elementRef, renderer2);
        /**
         * 设置tip提示内容，默认文本'自定义列表项'（国际化）
         *
         * 10.0.3新增
         */
        this.tipContent = TiLocale.getLocaleWords().tiTable.colsToggleTip;
        /**
         * 设置tip提示方向
         *
         * 10.0.3新增
         */
        this.tipPosition = 'top';
        // 标记是否需要更新聚焦元素
        this.shouldUpdateFocusableElems = false;
        this.table = table;
    }
    ngOnInit() {
        // 兼容使用tiTip指令实现的tip提示
        this.tipContent = this.tiTip ? '' : this.tipContent;
        this.tipPosition = this.tiTip ? undefined : this.tipPosition;
        this.setDropPanelWidth();
        super.ngOnInit();
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.updateFocusableElems();
        // TODO：严格来说，不应该继承自Select，Select中有对dominator的处理。看有没有更好实现方式。
    }
    ngAfterViewChecked() {
        // 这里不能调用父类方法，因为Select父类对dominator处理，空指针报错。
        // TODO: 看是否能够不继承select
        if (this.shouldUpdateFocusableElems) {
            this.shouldUpdateFocusableElems = false;
            this.updateFocusableElems();
        }
    }
    ngOnChanges(changes) {
        if (changes['searchable'] && !changes['searchable'].firstChange) {
            // searchable 参数变更后，dropSearch 组件中会重新获取搜索输入框元素，this.dropsearchCom.getFocusableElems() 方法获取的搜索框元素失效。
            // 由于dropSearch在ngAfterViewChecked中变更聚焦元素，时机比ngOnChanges晚，但比组件的ngAfterViewChecked早，
            // 所以用shouldUpdateFocusableElems变量标记是否需要更新聚焦元素，之后在ngAfterViewChecked中处理
            this.shouldUpdateFocusableElems = true;
        }
    }
    /**
     * @ignore
     * 在失焦时，通知更新了表格的列数据，用于表格记忆上传列显示数据
     */
    onBlur() {
        super.onBlur();
        // 表格记忆通知列切换变化
        if (this.table.storageId) {
            this.table.updateColumnsSubject.next();
        }
    }
    // 更新可聚焦元素
    updateFocusableElems() {
        if (this.searchable) {
            // 推荐在onInit()时调用setFocusableElems(), 但是ngFor/ngIf中的元素在ngAfterViewInit()才能获取到
            this.setFocusableElems([this.toggleMenuEleRef.nativeElement].concat(this.dropsearchCom.getFocusableElems()));
        }
        else {
            this.setFocusableElems([this.toggleMenuEleRef.nativeElement]);
        }
    }
    setDropPanelWidth() {
        const panelWidthNum = parseInt(this.panelWidth, 10);
        //  if (!Util.isNumber()) {
        //      this.panelWidth = TiColsToggleComponent.DEFAULT_PANEL_WIDTH + 'px';
        //      return;
        //  }
        if (panelWidthNum > TiColsToggleComponent.MAX_PANEL_WIDTH) {
            this.panelWidth = `${TiColsToggleComponent.MAX_PANEL_WIDTH}px`;
            return;
        }
        if (panelWidthNum < TiColsToggleComponent.MIN_PANEL_WIDTH) {
            this.panelWidth = `${TiColsToggleComponent.MIN_PANEL_WIDTH}px`;
        }
    }
}
TiColsToggleComponent.DEFAULT_PANEL_WIDTH = 250;
TiColsToggleComponent.MAX_PANEL_WIDTH = 300;
TiColsToggleComponent.MIN_PANEL_WIDTH = 200;
TiColsToggleComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-cols-toggle',
                template: "<div #toggleMenu\r\n     tiOutline\r\n     class=\"ti3-cols-toggle-menu-container\"\r\n     tabindex=\"{{disabled ? -1 : 0}}\"\r\n     (click)=\"onClickDominator()\"\r\n     (keydown)=\"onKeydown($event)\"\r\n     [id]=\"appendId('cols-toggle-menu')\"\r\n     [ngClass]=\"{'ti3-cols-toggle-menu-disabled': disabled}\">\r\n    <div class=\"ti3-icon ti3-icon-config ti3-cols-toggle-menu\" [tiTip]=\"tipContent\" [tiTipPosition]=\"tipPosition\"></div>\r\n</div>\r\n<ti-cols-toggle-drop [dominatorElem]=\"toggleMenuEleRef.nativeElement\"\r\n                     [panelWidth]=\"panelWidth\"\r\n                     [searchable]=\"searchable\"\r\n                     [options]=\"table.columns\"\r\n                     [selectAll]=\"selectAll\"\r\n                     [noDataText]=\"noDataText\"\r\n                     (select)=\"onSelect($event)\"\r\n                     [id]=\"appendId('colstoggle_drop')\"></ti-cols-toggle-drop>\r\n\r\n",
                host: {
                    '[class.ti3-cols-toggle-container]': 'true',
                    '(blur)': 'onBlur()'
                }
            },] }
];
TiColsToggleComponent.ctorParameters = () => [
    { type: TiTableComponent },
    { type: ElementRef },
    { type: Renderer2 }
];
TiColsToggleComponent.propDecorators = {
    tiTip: [{ type: Input }],
    tipContent: [{ type: Input }],
    tipPosition: [{ type: Input }],
    toggleMenuEleRef: [{ type: ViewChild, args: ['toggleMenu', { static: true },] }],
    dropsearchCom: [{ type: ViewChild, args: [TiColsToggleDropComponent, { static: true },] }]
};

/**
 * TiColsResizable 表格列拖动指令
 *
 * 支持拖动表格列来调整各列宽度。
 *
 * 在ti-table标签上加了tiColsResizable属性，则表格自动具有列拖动功能；
 * 同时还需要对table元素包裹父容器div，并对父容器设置 ti3-resize-wrapper样式类。
 */
class TiColsResizableDirective {
    constructor(tableCom, renderer, elementRef, zone, tiRenderer, iterableDiffers, fixedHeadService, document) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.zone = zone;
        this.tiRenderer = tiRenderer;
        this.iterableDiffers = iterableDiffers;
        this.fixedHeadService = fixedHeadService;
        this.document = document;
        /**
         * @ignore
         */
        this.notResizableAttr = 'not-resizable';
        /**
         * @ignore
         */
        this.resizableOpts = {
            table: null,
            ths: null,
            wrap: null,
            mouseXPosition: 0,
            target: null,
            storedSizes: [],
            storedSortEleSizes: [],
            storeTableWidthChange: 0,
            isYOverflowedWithX: false
        }; // 初始化列拖动属性的配置项
        this.isDragStart = false;
        this.isColumnsInit = true;
        /**
         * @ignore
         */
        this.isfirstYScrollStateChange = true;
        /**
         * @ignore
         * 将当前表格各列的宽度更新到到resizableOpts.storedSizes中
         */
        this.updateStoredSizes = () => {
            this.resizableOpts.storedSizes = [];
            this.resizableOpts.ths.forEach((th, index) => {
                this.tiRenderer.setAttributes(th, { 'ti-visible-index': index });
                this.resizableOpts.storedSizes[index] = TiColsResizableDirective.getWidth(th);
            });
            // 更新表格记忆
            if (this.tableCom.storageId && this.tableCom.storageConfig.colsWidth) {
                this.tableCom.localStorageState['colsWidth'] = this.resizableOpts.storedSizes;
            }
        };
        /**
         * @ignore
         */
        this.setWidth = (element, width) => {
            this.renderer.setStyle(element, 'width', width + 'px');
        };
        this.hostEle = this.elementRef.nativeElement;
        this.tableCom = tableCom;
    }
    static getThs(table) {
        return Array.from(table.children[0].children[0].children);
    }
    static getWidth(element) {
        return parseFloat(element.getBoundingClientRect().width
            .toFixed(1));
    }
    static trackByFn(index, item) {
        return item.show;
    }
    ngOnInit() {
        this.subscription = this.tableCom.viewInitSubject.subscribe(() => {
            this.processColsResizable();
            this.isColumnsInit = false; // 主要处理 columns 初始为空，异步的场景
            // 表格记忆
            // 版本更新后用户第一次访问，localStorageState['colsWidth']不存在
            // 修复SSR错误：ERROR TypeError: Cannot read property 'colsWidth' of undefined 
            if (this.tableCom.storageId && this.tableCom.storageConfig && this.tableCom.storageConfig.colsWidth
                && this.tableCom.localStorageState && this.tableCom.localStorageState['colsWidth']) {
                this.initStorageColsWidth();
            }
        });
        this.columsDiffer = this.iterableDiffers.find(this.tableCom.columns)
            .create(TiColsResizableDirective.trackByFn);
    }
    ngDoCheck() {
        const columsDiffer = this.columsDiffer.diff(this.tableCom.columns);
        if (columsDiffer) {
            if (this.isColumnsInit) {
                this.isColumnsInit = false;
                return;
            }
            this.zone.runOutsideAngular(() => {
                setTimeout(() => {
                    this.setDefaultWidth();
                }, 0);
            });
        }
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
        if (this.documentMouseMoveListener) {
            this.documentMouseMoveListener();
        }
        if (this.documentMouseUpListener) {
            this.documentMouseUpListener();
        }
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    processColsResizable() {
        this.setTableWidthChange();
        const table = this.resizableOpts.table = this.getTable();
        const thead = table.children[0];
        if (this.tableCom.isFixedHead) {
            this.resizableOpts.secondTable = this.getSecondTable();
            this.resizableOpts.xScrollState = this.overflowedX();
            this.resizableOpts.yScrollState = this.overflowedY();
            this.resizableOpts.ths = TiColsResizableDirective.getThs(table);
            this.resizableOpts.secondThs = TiColsResizableDirective.getThs(this.resizableOpts.secondTable);
            this.tableCom.processYScrollStateChangeWithColsResizable = () => {
                this.fixedHeadService.processYScrollStateChange(this);
            };
        }
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(thead, 'mousemove', (event) => {
                const currentTh = event.target;
                if (currentTh['nodeName'] !== 'TH') {
                    return;
                }
                // 获取当前th距页面文档的left值
                const left = currentTh['getBoundingClientRect']().left + this.document.documentElement.scrollLeft;
                const thWidth = currentTh['getBoundingClientRect']().width;
                // 判断光标是否落在th的右边缘
                const isOnColBorder = Math.abs(event.pageX - Math.round(left + thWidth)) <=
                    TiColsResizableDirective.COL_BORDER_RANGE;
                if (isOnColBorder) {
                    if (event.target['hasAttribute'](this.notResizableAttr) ||
                        this.isLastColumn(currentTh)) {
                        return;
                    }
                    this.createDividingLine(currentTh);
                }
                else {
                    this.removeDividingLine();
                }
            });
            this.renderer.listen(thead, 'mouseleave', () => {
                this.removeDividingLine();
            });
            this.renderer.listen(thead, 'mousedown', (event) => {
                const currentTh = event.target;
                if (this.tiRenderer.hasClass(currentTh, 'col-resize-active')) {
                    this.isDragStart = true;
                    // 鼠标点击的当前列
                    this.resizableOpts.target = currentTh;
                    // 更新光标位置
                    this.resizableOpts.mouseXPosition = event.pageX;
                    // 在拖动前获取当前表格最新的列信息、宽度，很关键，使得设置宽度与样式实际宽度一直
                    this.updateTableInfo();
                    // 给页面设置不可选样式，避免拖动时页面或表格内部出现被选中的蓝色区域
                    this.toggleTextSelection(true);
                }
                if (this.tableCom.isFixedHead) {
                    this.resizableOpts.xScrollState = this.overflowedX();
                    this.resizableOpts.yScrollState = this.overflowedY();
                }
            });
            const tableContainer = this.tiRenderer.findChildrenByClassName(this.hostEle, 'ti3-resize-wrapper')[0];
            if (!this.tiRenderer.hasClass(tableContainer, 'ti3-table-container')) {
                this.renderer.listen(tableContainer, 'scroll', () => {
                    Util.trigger(this.document, 'tiScroll');
                });
            }
            this.documentMouseMoveListener = this.renderer.listen(this.document, 'mousemove', (event) => {
                // 列拖动的动作应该是先mousedown，然后mousemove，因此先判断是否已经触发了mousedown
                if (!this.isDragStart || this.resizableOpts.mouseXPosition === 0 || !this.resizableOpts.target) {
                    return;
                }
                this.mouseMove(event);
            });
            this.documentMouseUpListener = this.renderer.listen(this.document, 'mouseup', (event) => {
                if (!this.isDragStart) {
                    return;
                }
                this.toggleTextSelection(false); // 恢复页面可选样式
                this.stopResize(); // 保存最新宽度到浏览器中
                this.isDragStart = false;
            });
            // 修复SSR报错：ERROR ReferenceError: window is not defined
            if (typeof window === 'undefined') {
                return;
            }
            this.windowResizeListener = this.renderer.listen(window, 'resize', () => {
                this.setTableWidthChange();
            });
        });
    }
    mouseMove(event) {
        const options = this.resizableOpts;
        const lastColIndex = options.ths.length - 1;
        const curColIndex = parseInt(options.target.getAttribute('ti-visible-index'), 10);
        const colWidth = options.storedSizes[curColIndex];
        const leftEdge = parseFloat((event.pageX - options.mouseXPosition).toFixed(1));
        const minWidth = this.getColMinWidth(options.target);
        // 当拖拽方向为列宽度减小的方向且列宽已达到文本区最小宽度时阻止拖动
        if ((leftEdge >= 0) || (colWidth + leftEdge > Math.ceil(minWidth))) {
            // 更新拖动列宽度
            options.storedSizes[curColIndex] += leftEdge;
            this.setWidth(options.target, options.storedSizes[curColIndex]);
            // 对最后一列的列宽的整体处理方案：
            // 如果更新拖动列宽度后的表格的总宽度小于表格初始宽度，则将宽度差补偿到最后一列;
            // 如果更新拖动列宽度后的表格的总宽度大于表格初始宽度，且之前最后一列列宽有补偿时，
            // 将最后一列的补偿先抵消掉，然后有超出时再出滚动条
            // s: storeTableWidthChange(此次拖动前各列拖动值的累计和)
            // b: 此次拖动前给末列的补偿值
            // l: leftEdge(此次拖动的距离)
            //   s      l        s + l       b       此次拖动后对末列宽的设置
            //  -5     -1       -6 < 0      +5          +1(-leftEdge)
            //  -5     +3       -2 < 0      +5          -3(-leftEdge)
            //  +5     -8       -3 < 0       0          +3(-(storeColsWidthChange+leftEdge))
            //  -5     +8        3 > 0      +5          -5(+storeColsWidthChange)
            //  +5     +3        8 > 0       0          +0(不做处理)
            //  +5     -3        2 > 0       0          +0(不做处理)
            if (leftEdge + options.storeTableWidthChange < 0) {
                if (options.storeTableWidthChange < 0) {
                    options.storedSizes[lastColIndex] -= leftEdge;
                }
                else {
                    options.storedSizes[lastColIndex] -= (leftEdge + options.storeTableWidthChange);
                }
            }
            else {
                if (options.storeTableWidthChange < 0) {
                    options.storedSizes[lastColIndex] += options.storeTableWidthChange;
                }
            }
            this.setWidth(options.ths[lastColIndex], options.storedSizes[lastColIndex]);
            // 更新各列拖动相对值的累计和
            options.storeTableWidthChange += leftEdge;
            // 表头锁定
            if (this.tableCom.isFixedHead) {
                // 更新第二个表格（bodyTable）中的当前列和最后一列的宽度
                this.setWidth(options.secondThs[curColIndex], options.storedSizes[curColIndex]);
                this.setWidth(options.secondThs[options.secondThs.length - 1], options.storedSizes[lastColIndex]);
                this.fixedHeadService.handleYNotOverflowedWithX(this.resizableOpts, this.tableCom.tbodyContainer);
                // 当横向滚动条出现导致纵向滚动条出现时对账本做处理
                this.fixedHeadService.handleYOverflowedWithX(this.resizableOpts, this.tableCom.tbodyContainer);
                // 纵向滚动条状态变化时对固定的表头右边填充块的处理
                this.fixedHeadService.processOverflowY(this.tableCom.theadContainer, this.tableCom.tbodyContainer, this.tableCom);
            }
            if (this.tableCom.fixedColumnInfo.hasFixedColumn) {
                this.tableCom.thResizeSubject.next({
                    th: options.target,
                    leftEdge,
                    resizableOpts: this.resizableOpts
                });
                const container = this.tableCom.fixedColumnInfo.container;
                if (container) {
                    const scrollLeft = container.scrollLeft;
                    const isRightColumnFloat = scrollLeft + container.clientWidth < container.scrollWidth;
                    this.tableCom.containerScrollXChangeSubject.next({
                        scrollLeft,
                        isRightColumnFloat
                    });
                }
            }
        }
        // 更新光标位置
        options.mouseXPosition = event.pageX;
    }
    getColMinWidth(thElement) {
        // 此处的值是'...'所占宽度，文本区的宽度最小为省略号所占宽度；当容器宽度小于此值时，文本会完全显示，但超出部分会直接被截断。
        // Chrome 和 IE下省略号'...'所占宽度大概为10px;
        // Firefox 下不会出现只有'...'的情况，最小为：一个字符 + '...',其所占宽度大概为28px(中文字符下)；
        // 此处为保证三个浏览器都表现正常，取值29(28 + 1, 1为矫正偏差值)。
        let minWidth = 29;
        minWidth += parseFloat(window.getComputedStyle(thElement).paddingLeft) +
            parseFloat(window.getComputedStyle(thElement).paddingRight);
        const sortEle = this.tiRenderer.findChildrenByClassName(thElement, 'ti3-sort-container')[0];
        const iconsEle = this.tiRenderer.findChildrenByClassName(thElement, 'ti3-cell-icons-container')[0];
        const headFilterEle = this.tiRenderer.findChildrenByClassName(thElement, 'ti3-head-filter-container')[0];
        if (sortEle) {
            const sortWidth = parseFloat(sortEle.getBoundingClientRect().width
                .toFixed(1));
            minWidth += sortWidth;
        }
        if (iconsEle) {
            const filterWidth = parseFloat(iconsEle.getBoundingClientRect().width
                .toFixed(1));
            minWidth += filterWidth;
        }
        if (headFilterEle) {
            const headFilterWidth = parseFloat(headFilterEle.getBoundingClientRect().width
                .toFixed(1));
            minWidth += headFilterWidth;
        }
        return minWidth;
    }
    setTableWidthChange() {
        const tableContainer = this.tiRenderer.findChildrenByClassName(this.hostEle, 'ti3-resize-wrapper')[0];
        // 表格容器自身宽度（不包括Y方向滚动条的宽度）
        const clientWidth = tableContainer ? tableContainer['clientWidth'] : 0;
        // 表格容器实际内容区域宽度
        const scrollWidth = tableContainer ? tableContainer['scrollWidth'] : 0;
        // resizableOpts.storeColsWidthChange为各列拖动相对值的累计和
        // 将表格内容溢出部分的宽度赋给各列拖动相对值的累计和
        this.resizableOpts.storeTableWidthChange = scrollWidth - clientWidth;
    }
    stopResize() {
        this.updateStoredSizes();
        this.resizableOpts.mouseXPosition = 0;
        this.resizableOpts.target = null;
        if (this.tableCom.isFixedHead) {
            this.resizableOpts.xScrollState = this.overflowedX();
            this.resizableOpts.yScrollState = this.overflowedY();
        }
    }
    getTable() {
        // 用户给table元素加父容器，通过父容器设置overflow属性
        const tableContainerClassName = this.tableCom.isFixedHead ? 'ti3-table-fixed-head' : 'ti3-resize-wrapper';
        const tableContainer = this.tiRenderer.findChildrenByClassName(this.hostEle, tableContainerClassName)[0];
        const table = tableContainer.children[0].nodeName === 'TABLE' ? tableContainer.children[0] : null;
        return table;
    }
    /**
     * @ignore
     */
    isLastColumn(th) {
        const parentElement = th.parentElement;
        if (!parentElement) {
            return true;
        }
        const ths = th.parentElement.children;
        const index = Array.from(ths)
            .indexOf(th);
        return index === ths.length - 1;
    }
    // 当光标移到感应区时，出现拖动分割线
    createDividingLine(th) {
        this.renderer.addClass(th, 'col-resize-active');
        const index = Array.from(th.parentElement.children)
            .indexOf(th);
        const bodyTable = this.tableCom.isFixedHead ? this.resizableOpts.secondTable : this.resizableOpts.table;
        // 防止不存在tbody的场景报错
        if (!bodyTable.children[1]) {
            return;
        }
        const trs = Array.from(bodyTable.children[1].children)
            .filter((tr) => {
            return this.needDividingLine(tr);
        });
        trs.forEach((tr) => {
            // 分组场景index 大于tr.children.length
            if (!tr.children[index]) {
                return;
            }
            this.renderer.addClass(tr.children[index], 'col-resize-active');
        });
    }
    // 当光标离开感应区时，拖动分割线消失
    removeDividingLine() {
        const bodyTable = this.tableCom.isFixedHead ? this.resizableOpts.secondTable : this.resizableOpts.table;
        const ths = Array.from(this.resizableOpts.table.children[0].children[0].children);
        ths.forEach((th) => {
            this.renderer.removeClass(th, 'col-resize-active');
        });
        // 防止不存在tbody的场景报错
        if (!bodyTable.children[1]) {
            return;
        }
        const trs = Array.from(bodyTable.children[1].children);
        trs.forEach((tr) => {
            if (!this.needDividingLine(tr)) {
                return;
            }
            Array.from(tr.children)
                .forEach((td) => {
                this.renderer.removeClass(td, 'col-resize-active');
            });
        });
    }
    updateTableInfo() {
        this.resizableOpts.ths = TiColsResizableDirective.getThs(this.resizableOpts.table);
        this.updateStoredSizes(); // 保存最新宽度
        this.setComputedWidth(); // 设置最新宽度
    }
    initStorageColsWidth() {
        this.resizableOpts.ths = TiColsResizableDirective.getThs(this.resizableOpts.table);
        this.resizableOpts.storedSizes = this.tableCom.localStorageState['colsWidth'];
        this.setComputedWidth();
        // 各列宽度设置后，可能出现滚动条，所以要计算一次 storeTableWidthChange的值
        this.setTableWidthChange();
    }
    setComputedWidth() {
        if (this.resizableOpts.table && this.resizableOpts.ths && this.resizableOpts.ths.length) {
            this.resizableOpts.ths.forEach((th, index) => {
                this.setWidth(th, this.resizableOpts.storedSizes[index]);
                // 表头锁定
                if (this.tableCom.isFixedHead) {
                    this.resizableOpts.secondThs = TiColsResizableDirective.getThs(this.resizableOpts.secondTable);
                    this.setWidth(this.resizableOpts.secondThs[index], this.resizableOpts.storedSizes[index]);
                }
            });
        }
    }
    // 将表格宽度设置为默认宽度
    setDefaultWidth() {
        const ths = this.resizableOpts.ths = TiColsResizableDirective.getThs(this.resizableOpts.table);
        // 列隐藏或显示后，将各列宽设置为初始用户设置的列宽
        ths.forEach((th) => {
            const width = th.getAttribute('width') ? th.getAttribute('width') : '';
            // 注意：设置列宽的方式有多种，此处统一默认以width属性设置的宽为准
            this.renderer.setStyle(th, 'width', width);
        });
        // 表头锁定
        if (this.tableCom.isFixedHead) {
            const secondTable = this.getSecondTable();
            const secondThs = TiColsResizableDirective.getThs(secondTable);
            this.resizableOpts.secondThs = secondThs;
            this.resizableOpts.xScrollState = this.overflowedX();
            this.resizableOpts.yScrollState = this.overflowedY();
            secondThs.forEach((th) => {
                const width = th.getAttribute('width') ? th.getAttribute('width') : '';
                // 注意：设置列宽的方式有多种，此处统一默认以width属性设置的宽为准
                this.renderer.setStyle(th, 'width', width);
            });
            this.fixedHeadService.processYScrollStateChange(this);
        }
        this.setTableWidthChange();
    }
    // 当列拖动进行时去掉文字可选样式(user-select: none)
    toggleTextSelection(toggle) {
        const body = this.document.body;
        if (toggle) {
            this.renderer.addClass(body, 'ti3-unselectable');
            this.renderer.setAttribute(body, 'unselectable', 'on');
        }
        else {
            this.renderer.removeClass(body, 'ti3-unselectable');
            body.removeAttribute('unselectable');
        }
    }
    needDividingLine(tr) {
        if (!tr) {
            return false;
        }
        const classes = ['ti3-details-tr', 'ti3-table-nodata', 'ti3-table-loadfail',
            'ti3-table-nodata-guide', 'ti3-table-nodata-simple'];
        for (const className of classes) {
            if (this.tiRenderer.hasClass(tr, className)) {
                return false;
            }
        }
        return true;
    }
    // 供表头锁定使用
    getSecondTable() {
        const secondTableContainer = this.tiRenderer.findChildrenByClassName(this.hostEle, 'ti3-resize-wrapper')[0];
        return secondTableContainer ? secondTableContainer.children[0] : null;
    }
    overflowedX(isNum) {
        return this.fixedHeadService.overflowedResult(this.tableCom.tbodyContainer, 'X', isNum);
    }
    overflowedY(isNum) {
        return this.fixedHeadService.overflowedResult(this.tableCom.tbodyContainer, 'Y', isNum);
    }
}
/**
 * @ignore
 */
TiColsResizableDirective.UNSELECTABLE_CLASS = 'ti3-unselectable';
/**
 * @ignore
 * 移到表头能够显示拖动线的感应范围
 */
TiColsResizableDirective.COL_BORDER_RANGE = 10;
TiColsResizableDirective.decorators = [
    { type: Directive, args: [{
                selector: 'ti-table[tiColsResizable]'
            },] }
];
TiColsResizableDirective.ctorParameters = () => [
    { type: TiTableComponent },
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone },
    { type: TiRenderer },
    { type: IterableDiffers },
    { type: TiTableFixedHeadService },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];

/**
 * TiCellText 表格单元格中放置文本的容器组件
 *
 * 提供文本溢出时出省略号...,且hover时出tip的功能。
 *
 * 配合TiCellText组件使用可使表格单元格中内容显示不下时，文本出省略号...,
 * 而文本后的放在TiCellIcons图标始终可以显示出来
 *
 */
class TiCellTextComponent {
    constructor(renderer, elementRef, tiRenderer) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.tiRenderer = tiRenderer;
    }
    ngAfterViewInit() {
        setTimeout(() => {
            this.setMaxWidth();
        }, 0);
    }
    setMaxWidth() {
        let otherWidth = 0;
        const parent = this.renderer.parentNode(this.elementRef.nativeElement);
        const iconsContainer = this.tiRenderer.findChildrenByClassName(parent, 'ti3-cell-icons-container')[0];
        const sortContainer = this.tiRenderer.findChildrenByClassName(parent, 'ti3-sort-container')[0];
        const headFilterContainer = this.tiRenderer.findChildrenByClassName(parent, 'ti3-head-filter-container')[0];
        const renameContainer = this.tiRenderer.findChildrenByTagName(parent, 'TP-RENAME')[0];
        // 修复SSR报错：ERROR TypeError: sortContainer.getBoundingClientRect is not a function
        if (typeof parent.getBoundingClientRect !== 'function') {
            return;
        }
        // 修复SSR报错：ERROR TypeError: Cannot read property 'getBoundingClientRect' of undefined
        if (iconsContainer) {
            const iconsContainerWidth = parseFloat(iconsContainer.getBoundingClientRect().width
                .toFixed(1));
            otherWidth += iconsContainerWidth;
        }
        if (sortContainer) {
            const sortContainerWidth = parseFloat(sortContainer.getBoundingClientRect().width
                .toFixed(1));
            otherWidth += sortContainerWidth;
        }
        if (headFilterContainer) {
            const headFilterContainerWidth = parseFloat(headFilterContainer.getBoundingClientRect().width
                .toFixed(1));
            otherWidth += headFilterContainerWidth;
        }
        if (renameContainer) {
            const renameContainerWidth = parseFloat(renameContainer.getBoundingClientRect().width
                .toFixed(1));
            otherWidth += renameContainerWidth;
        }
        this.renderer.setStyle(this.cellTextEle.nativeElement, 'max-width', `calc(100% - ${otherWidth}px)`);
    }
}
TiCellTextComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-cell-text',
                template: "<span #text class=\"ti3-cell-text\" tiOverflow [tiTipContent]=\"tipContent\" [tiTipPosition]=\"tipPosition\">\r\n    <ng-content></ng-content>\r\n</span>",
                host: {
                    '[class.ti3-cell-text-container]': 'true'
                }
            },] }
];
TiCellTextComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: TiRenderer }
];
TiCellTextComponent.propDecorators = {
    tipContent: [{ type: Input }],
    tipPosition: [{ type: Input }],
    cellTextEle: [{ type: ViewChild, args: ['text', { static: true },] }]
};

/**
 * TiCellIcons 表格单元格中放置图标的容器组件
 *
 * 配合TiCellText组件使用可使表格单元格中内容显示不下时，文本出省略号...,
 * 而文本后的放在TiCellIcons图标始终可以显示出来
 *
 */
class TiCellIconsComponent {
}
TiCellIconsComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-cell-icons',
                template: "<ng-content></ng-content>",
                host: {
                    '[class.ti3-cell-icons-container]': 'true'
                }
            },] }
];

/**
 * @ignore
 * TiColumnsPipe 过滤掉columns中的title为空的数据项
 *
 */
class TiColumnsPipe {
    transform(value) {
        return value.filter((item) => !Util.isEmptyString(item.title));
    }
}
TiColumnsPipe.decorators = [
    { type: Pipe, args: [{ name: 'tiColumns' },] }
];

/**
 * tiColumnFixed 表格列固定(IE和Edge浏览器不支持)
 *
 * 适用场景：对于列数很多的表格，可以固定前后列，横向滚动查看其它数据。
 *
 * 规范：左侧支持最多3列固定(3列不包含单选/复选框所在列)，右侧支持最多1列固定。横向滚动条贯穿左右，与表格最左和最右对齐。
 * 表格下展场景不需要支持列固定。
 *
 * 9.0.4新增
 */
class TiColumnFixedDirective {
    constructor(renderer, elementRef, tiRenderer, tableCom, zone) {
        this.renderer = renderer;
        this.tiRenderer = tiRenderer;
        this.tableCom = tableCom;
        this.zone = zone;
        this.columnFixedLeftLast = false;
        this.floatingFixedColumn = false;
        this.firstAfterViewChecked = true;
        this.element = elementRef.nativeElement;
    }
    ngOnInit() {
        // IE 不支持粘性定位position: sticky，使用其他定位方式有闪动，目前无法解决； EDGE 固定列边框不显示， 表头固定时拖动横向滚动条表头横向平移不及时
        this.notSupportBrowser = TiBrowser.isIE() || TiBrowser.isEdge();
        if (this.notSupportBrowser || !this.type) {
            return;
        }
        if (!this.tableCom.fixedColumnInfo.container) {
            const container = this.tiRenderer.findChildrenByClassName(this.tableCom.hostEle, 'ti3-table-container')[0];
            if (!container) {
                return;
            }
            this.tableCom.fixedColumnInfo.container = container;
        }
        this.tableCom.fixedColumnInfo.hasFixedColumn = true;
        this.tagName = this.element.tagName;
        if (this.type === 'right' && this.tagName === 'TH') {
            // 表头固定需要此参数
            this.tableCom.fixedColumnInfo.thFixedRight = this.element;
        }
        this.addBehavior();
    }
    ngAfterViewChecked() {
        if (this.notSupportBrowser || !this.type || !this.firstAfterViewChecked) {
            return;
        }
        this.firstAfterViewChecked = false;
        this.init();
    }
    ngOnDestroy() {
        if (this.containerScrollXChangeSubscription) {
            this.containerScrollXChangeSubscription.unsubscribe();
        }
        if (this.thResizeSubscription) {
            this.thResizeSubscription.unsubscribe();
        }
        if (this.updateFixedThLeftSubscription) {
            this.updateFixedThLeftSubscription.unsubscribe();
        }
        if (this.updateFixedTdLeftSubscription) {
            this.updateFixedTdLeftSubscription.unsubscribe();
        }
    }
    init() {
        if (this.type === 'left') {
            if (this.tagName === 'TH') {
                this.processTh();
            }
            else {
                this.processTd();
            }
        }
        if (this.tagName === 'TH') {
            this.zone.runOutsideAngular(() => {
                // 表头初始时容器的滚动状态还未初始完成
                setTimeout(() => {
                    const scrollLeft = this.tableCom.fixedColumnInfo.container.scrollLeft;
                    const isRightColumnFloat = scrollLeft + this.tableCom.fixedColumnInfo.container.clientWidth < this.tableCom.fixedColumnInfo.container.scrollWidth;
                    this.tableCom.containerScrollXChangeSubject.next({
                        scrollLeft,
                        isRightColumnFloat
                    });
                }, 0);
            });
        }
        else {
            const scrollLeft = this.tableCom.fixedColumnInfo.container.scrollLeft;
            const isRightColumnFloat = scrollLeft + this.tableCom.fixedColumnInfo.container.clientWidth < this.tableCom.fixedColumnInfo.container.scrollWidth;
            this.tableCom.containerScrollXChangeSubject.next({
                scrollLeft,
                isRightColumnFloat
            });
        }
    }
    addBehavior() {
        // 处理左右固定的最后一列是否有阴影(看起来有浮动效果)
        this.containerScrollXChangeSubscription = this.tableCom.containerScrollXChangeSubject.subscribe((scrollInfo) => {
            if (this.type === 'right' && scrollInfo.isRightColumnFloat !== this.floatingFixedColumn) {
                this.processLastFixedColumn(this.element, scrollInfo.isRightColumnFloat);
            }
            if (this.type === 'left' && this.columnFixedLeftLast && (scrollInfo.scrollLeft > 0) !== this.floatingFixedColumn) {
                this.processLastFixedColumn(this.element, scrollInfo.scrollLeft > 0);
            }
        });
        // 处理左侧固定的列的left值(左侧可多列固定)
        if (this.type === 'left' && this.tagName === 'TH') {
            this.thResizeSubscription = this.tableCom.thResizeSubject.subscribe((thResizeInfo) => {
                const th = thResizeInfo.th;
                if (th !== this.element) {
                    return;
                }
                const nextSibling = th.nextElementSibling;
                if (nextSibling && this.tiRenderer.hasClass(nextSibling, 'ti3-table-column-fixed-left')) {
                    const siblings = th.parentElement.children;
                    const index = Array.from(siblings)
                        .indexOf(th);
                    const changeColumnsIndex = [];
                    for (let i = index + 1; i < siblings.length; i++) {
                        if (!siblings[i] || !this.tiRenderer.hasClass(siblings[i], 'ti3-table-column-fixed-left')) {
                            break;
                        }
                        changeColumnsIndex.push(i);
                        this.tableCom.fixedColumnInfo.fixedColumnLeftValues[i] += thResizeInfo.leftEdge;
                        this.renderer.setStyle(siblings[i], 'left', `${this.tableCom.fixedColumnInfo.fixedColumnLeftValues[i]}px`);
                    }
                    const bodyTable = this.tableCom.isFixedHead ? thResizeInfo.resizableOpts.secondTable : thResizeInfo.resizableOpts.table;
                    const trs = Array.from(bodyTable.children[1].children)
                        .filter((tr) => {
                        return this.needFixedColumnTr(tr);
                    });
                    trs.forEach((tr) => {
                        changeColumnsIndex.forEach((columnIndex) => {
                            this.renderer.setStyle(tr.children[columnIndex], 'left', `${this.tableCom.fixedColumnInfo.fixedColumnLeftValues[columnIndex]}px`);
                        });
                    });
                }
            });
            this.updateFixedThLeftSubscription = this.tableCom.updateFixedThLeftSubject.subscribe(() => {
                this.processTh();
            });
        }
        if (this.type === 'left' && this.tagName === 'TD') {
            this.updateFixedTdLeftSubscription = this.tableCom.updateFixedTdLeftSubject.subscribe(() => {
                this.processTd();
            });
        }
    }
    processTd() {
        const siblings = this.element.parentElement.children;
        const index = Array.from(siblings)
            .indexOf(this.element);
        // 进行判空处理，因为有可能是td元素先出现。
        // TODO: 考虑下processTd和processTd是否可以使用相同的处理方式。
        if (this.tableCom.fixedColumnInfo.fixedColumnLeftValues && this.tableCom.fixedColumnInfo.fixedColumnLeftValues.length &&
            this.tableCom.fixedColumnInfo.fixedColumnLeftValues[index] !== this.tdLeft) {
            this.tdLeft = this.tableCom.fixedColumnInfo.fixedColumnLeftValues[index];
            this.renderer.setStyle(this.element, 'left', `${this.tdLeft}px`);
        }
        if (index === this.tableCom.fixedColumnInfo.columnFixedLeftLastIndex) {
            this.columnFixedLeftLast = true;
        }
    }
    processTh() {
        const siblings = this.element.parentElement.children;
        let left = 0;
        this.tableCom.fixedColumnInfo.fixedColumnLeftValues = [];
        // tslint:disable-next-line:prefer-for-of
        for (let i = 0; i < siblings.length; i++) {
            const current = siblings[i];
            if (this.tableCom.fixedColumnInfo.fixedColumnLeftValues[i] !== left) {
                this.tableCom.fixedColumnInfo.fixedColumnLeftValues[i] = left;
                this.renderer.setStyle(current, 'left', `${left}px`);
            }
            // offsetWidth 包括边框
            left += current.offsetWidth;
            const nextSibling = siblings[i + 1];
            if (nextSibling && !this.tiRenderer.hasClass(nextSibling, 'ti3-table-column-fixed-left')) {
                this.columnFixedLeftLast = true;
                this.tableCom.fixedColumnInfo.columnFixedLeftLastIndex = i;
                break;
            }
            else {
                this.columnFixedLeftLast = false;
            }
        }
    }
    processLastFixedColumn(ele, add) {
        if (add) {
            this.floatingFixedColumn = true;
            this.renderer.addClass(ele, 'ti3-table-floating-fixed-column');
        }
        else {
            this.floatingFixedColumn = false;
            this.renderer.removeClass(ele, 'ti3-table-floating-fixed-column');
        }
    }
    needFixedColumnTr(tr) {
        if (!tr) {
            return false;
        }
        const classes = ['ti3-details-tr', 'ti3-table-nodata', 'ti3-table-loadfail',
            'ti3-table-nodata-guide', 'ti3-table-nodata-simple'];
        for (const className of classes) {
            if (this.tiRenderer.hasClass(tr, className)) {
                return false;
            }
        }
        return true;
    }
}
TiColumnFixedDirective.decorators = [
    { type: Directive, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'th[tiColumnFixed], td[tiColumnFixed]',
                host: {
                    '[class.ti3-table-column-fixed-right]': "!notSupportBrowser && type === 'right'",
                    '[class.ti3-table-column-fixed-left]': "!notSupportBrowser && type === 'left'"
                }
            },] }
];
TiColumnFixedDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: TiRenderer },
    { type: TiTableComponent },
    { type: NgZone }
];
TiColumnFixedDirective.propDecorators = {
    type: [{ type: Input, args: ['tiColumnFixed',] }]
};

/**
 * 10.1.2版本新增
 * 根据规范：“单/复选框”关联表格使用时，为了提升选中效率，点击热区为“单/复选框”按钮所在单元格，点击即可选中。
 */
class TiColClickDirective {
    constructor(renderer, elementRef) {
        this.renderer = renderer;
        this.elementRef = elementRef;
    }
    ngAfterViewInit() {
        this.renderer.listen(this.elementRef.nativeElement, 'click', (event) => {
            const inputEle = this.elementRef.nativeElement.querySelector('input');
            const checkboxLabelEle = this.elementRef.nativeElement.querySelector('.ti3-checkbox');
            const radioLabelEle = this.elementRef.nativeElement.querySelector('.ti3-radio');
            // 点击单/复选空白区域时，触发input点击事件
            // 表格和单/复选联用时，checkboxLabelEle和radioLabelEle不会同时出现，所以需要分别进行判断
            // inputEle和checkboxLabelEle/radioLabelEle是兄弟元素
            // event.target !== inputEle阻止在firefox下因为inputEle.click()产生的冒泡循环
            if (event.target !== inputEle &&
                ((checkboxLabelEle && !(event.target === checkboxLabelEle || checkboxLabelEle.contains(event.target))) ||
                    (radioLabelEle && !(event.target === radioLabelEle || radioLabelEle.contains(event.target))))) {
                inputEle.click();
            }
        });
    }
}
TiColClickDirective.decorators = [
    { type: Directive, args: [{
                selector: 'td[checkbox-column], th[checkbox-column], td[radio-column]'
            },] }
];
TiColClickDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];

class TiTableModule {
}
TiTableModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiButtonModule,
                    TiIconModule,
                    TiListModule,
                    TiSearchboxModule,
                    TiDropModule,
                    TiOverflowModule,
                    TiTableFixedHeadServiceModule,
                    TiLocaleModule,
                    TiRendererModule,
                    TiTipModule,
                    TiOutlineModule
                ],
                exports: [
                    TiTableComponent,
                    TiHeadFilterComponent,
                    TiHeadSortComponent,
                    TiDetailsIconComponent,
                    TiDetailsTrDirective,
                    TiColspanDirective,
                    TiColsToggleComponent,
                    TiColsResizableDirective,
                    TiCellTextComponent,
                    TiCellIconsComponent,
                    TiColumnFixedDirective,
                    TiColClickDirective
                ],
                declarations: [
                    TiTableComponent,
                    TiHeadFilterComponent,
                    TiHeadFilterDropComponent,
                    TiHeadSortComponent,
                    TiDetailsIconComponent,
                    TiDetailsTrDirective,
                    TiColspanDirective,
                    TiColsToggleComponent,
                    TiColsToggleDropComponent,
                    TiColsResizableDirective,
                    TiCellTextComponent,
                    TiCellIconsComponent,
                    TiColumnsPipe,
                    TiColumnFixedDirective,
                    TiColClickDirective
                ]
            },] }
];

/**
 * Pagination分页组件
 *
 * 分页组件一般情况下与表格组件配合使用，实现对表格数据的分页显示。
 *
 * <example-url>../tiny3demo/#/pagination/pagination-all</example-url>
 */
class TiPaginationComponent extends TiFormComponent {
    constructor(render, hostRef, table, select) {
        super(hostRef, render);
        this.render = render;
        this.hostRef = hostRef;
        this.table = table;
        this.select = select;
        /**
         * 设置组件的类型：三种类型default(默认)、simple、mini
         */
        this.type = 'default';
        /**
         * 组件内部改变总条数时会触发该事件，向外通知当前总条数。
         */
        this.totalNumberChange = new EventEmitter();
        /**
         * 设置当前页码
         */
        this.currentPage = 1;
        /**
         * 组件内部改变当前页码时会触发该事件，向外通知当前页码数。
         */
        this.currentPageChange = new EventEmitter();
        /**
         * 设置是否总条数的显示与隐藏
         */
        this.showTotalNumber = true;
        /**
         * 设置是否显示页码跳转按钮（默认不显示)
         */
        this.showGotoLink = false;
        /**
         * 组件是否开启自动隐藏功能。开启后，当总条数totalNumber小于每页显示条数选项列表中的最小值时，隐藏分页
         */
        this.autoHide = false;
        /**
         * 组件是否禁用状态
         */
        this.disabled = false;
        /**
         * 设置最后一页的显示与隐藏（一般数据量比较大的场景隐藏最后一页）：默认显示
         */
        this.showLastPage = true;
        /**
         * 当操作选择框改变每页显示条数时会触发该事件，向外通知当前页码、每页显示条数和总条数。
         */
        this.pageNumChange = new EventEmitter();
        /**
         * 当操作选择框改变每页显示条数或操作页码改变当前页码时会触发该事件，向外通知当前页码、每页显示条数和总条数。
         */
        this.pageUpdate = new EventEmitter();
        /**
         * @ignore
         */
        this.mini = undefined;
        /**
         * @ignore
         * 用户输入即将跳转的页码
         */
        this.gotoPage = {};
        this.hidePage = false;
        this.defaultPageSize = {
            options: [10, 20, 50],
            size: 10,
            width: '60px',
            hide: false // 设置是否在页面上隐藏每页显示条数选项：下拉列表
        };
    }
    /**
     * @description 创建每一个页码对应的数据
     * @params key 页码显示，为数字或者是"···"
     * @params isActive 是否为当前激活页
     */
    static makePage(key, isActive) {
        return {
            key,
            active: isActive
        };
    }
    ngOnInit() {
        super.ngOnInit();
        // 组件对外各个接口的初始化处理
        this.initData();
        this.renderPage();
        if (this.isWithTable()) {
            this.subscription = this.table.paginationSubject.subscribe((value) => {
                if (!Util.isUndefined(value.totalNumber) && value.totalNumber !== this.totalNumber) {
                    this.totalNumber = value.totalNumber;
                    this.verifyCurrentPage(this.itemsPerPage.selected, true);
                    this.totalNumberChange.emit(this.totalNumber);
                }
                if (!Util.isUndefined(value.currentPage) && value.currentPage !== this.currentPage) {
                    this.currentPage = value.currentPage;
                    this.currentPageChange.emit(this.currentPage);
                }
            });
            // 表格记忆
            this.updateFromStorage();
        }
        // select下拉面板（dropsearch）中使用分页
        if (this.select) {
            this.select.pagination = this;
            this.select.dropsearchCom.pagination = this;
        }
    }
    ngOnChanges(changes) {
        const currentPageObj = changes['currentPage'];
        const totalNumberObj = changes['totalNumber'];
        if ((currentPageObj && !currentPageObj.firstChange) || (totalNumberObj && !totalNumberObj.firstChange)) {
            this.verifyCurrentPage(this.itemsPerPage.selected, true);
        }
    }
    ngDoCheck() {
        // 监听开发者设置的pageSize.size的改变
        if (!Util.isUndefined(this.pageSize) && this.pageSize.size !== this.oldSize) {
            const index = this.itemsPerPage.options.indexOf(this.pageSize.size);
            if (index !== -1) {
                this.itemsPerPage.selected = this.itemsPerPage.options[index];
                this.verifyCurrentPage(this.itemsPerPage.selected, true);
                this.oldSize = this.pageSize.size;
            }
        }
        if (this.oldTotalNumber !== this.totalNumber || this.itemsPerPage.selected !== this.oldSelected ||
            this.oldCurrentPage !== this.currentPage) {
            this.renderPage();
            this.oldTotalNumber = this.totalNumber;
            this.oldSelected = this.itemsPerPage.selected;
            this.oldCurrentPage = this.currentPage;
            this.updateFocusableElems = true; // select使用过这个变量后，会重置为false
        }
    }
    ngAfterViewChecked() {
        // select中使用的分页为default类型且不带左边select，所以此处限定type === 'default'
        if (this.type === 'default' && this.updateFocusableElems) {
            // 修复SSR报错：ERROR TypeError: this.nativeElement.querySelectorAll(...) is not a function or its return value is not iterable
            // this.setFocusableElems([...(this.nativeElement as HTMLElement).querySelectorAll('a')]);
            this.setFocusableElems(Array.prototype.slice.call(this.nativeElement.querySelectorAll('a')));
        }
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    // 数据初始化
    initData() {
        // 总条数数字国际化处理，拼接成 ---> 总条数: 条数
        this.setTotalNumberFormat();
        // 初始化获取itemsPerPage：select组件所需的属性
        this.itemsPerPage = this.getFormatedSize();
        this.verifyCurrentPage(this.itemsPerPage.selected, true);
        this.oldCurrentPage = this.currentPage;
        this.oldTotalNumber = this.totalNumber;
        this.oldSize = this.itemsPerPage.selected;
        this.oldSelected = this.itemsPerPage.selected;
    }
    // 是否有表格当前页记忆
    isStorageCurrentPage() {
        // tslint:disable-next-line: max-line-length
        return this.table.storageId && (this.table.storageConfig.pagination === true || (this.table.storageConfig.pagination && this.table.storageConfig.pagination['currentPage'] === true));
    }
    // 是否有表格每页个数记忆
    isStorageItemsPerPage() {
        // tslint:disable-next-line: max-line-length
        return this.table.storageId && (this.table.storageConfig.pagination === true || (this.table.storageConfig.pagination && this.table.storageConfig.pagination['itemsPerPage'] === true));
    }
    // 处理表格记忆
    updateFromStorage() {
        // 修复SSR报错：ERROR TypeError: Cannot read property 'currentPage' of undefined
        // 当前页
        if (this.isStorageCurrentPage()) {
            const currentPage = this.table.sessionStorageState && this.table.sessionStorageState.currentPage;
            if (currentPage > 0) {
                Promise.resolve(currentPage).then(() => {
                    this.currentPage = currentPage;
                    this.currentPageChange.emit(currentPage);
                });
            }
        }
        // 修复SSR错误：ERROR TypeError: Cannot read property 'itemsPerPage' of undefined
        // 每页条数
        if (this.isStorageItemsPerPage()) {
            const itemsPerPage = this.table.localStorageState && this.table.localStorageState.itemsPerPage;
            if (itemsPerPage > 0) {
                Promise.resolve(itemsPerPage).then(() => {
                    this.pageSize.size = itemsPerPage;
                    const pagination = {
                        currentPage: this.currentPage,
                        size: itemsPerPage,
                        totalNumber: this.totalNumber
                    };
                    this.pageNumChange.emit(pagination);
                });
            }
        }
    }
    /**
     * 根据接口配置来渲染页面
     */
    renderPage() {
        if (this.type === 'mini') {
            this.configMini();
        }
        else {
            // goto页码与当前页码保持一致
            this.gotoPage = {
                page: this.currentPage
            };
            // 页码列表
            this.pages = this.getPages();
        }
        // 用户开启自动隐藏功能且无需显示分页(若总条数 =< 最小的每页显示条数)时，则不需要显示分页时，隐藏分页
        // 初始化totalNumber undefined
        this.hidePage = this.autoHide &&
            (Util.isUndefined(this.totalNumber) || Math.min.apply(null, this.itemsPerPage.options) >= this.totalNumber);
        if (this.hidePage) {
            this.render.setStyle(this.hostRef.nativeElement, 'display', 'none');
        }
        else {
            this.render.setStyle(this.hostRef.nativeElement, 'display', 'inline-block');
        }
        // 若分页与ti-table配合使用，则当分页更新时，触发ti-table的updatePagination
        // 进而触发表格更新回调
        if (this.isWithTable()) {
            this.table.updatePagination(this.currentPage, this.itemsPerPage.selected);
        }
    }
    /**
     * @ignore
     * 对总页数进行数字国际化处理
     */
    setTotalNumberFormat() {
        // 数字国际化格式：整数位保留最小位数.小数位保留最小位数-小数位最大保留位置
        const formatTotalNumber = Util.isUndefined(this.totalNumber) ? '0' : TiLocaleFormat.formatNumber(this.totalNumber, '1.0-0');
        return TiLocale.getLocaleWords().tiPagination['totalLabel'] + formatTotalNumber;
    }
    getFormatedSize() {
        const sizeConfig = Object.assign(Object.assign({}, this.defaultPageSize), this.pageSize);
        let index = sizeConfig.options.indexOf(sizeConfig.size);
        if (index === -1) {
            index = 0;
            this.syncPageSize(sizeConfig.options[index]);
        }
        return {
            selected: sizeConfig.options[index],
            options: sizeConfig.options,
            hide: sizeConfig.hide,
            style: {
                width: sizeConfig.width // 宽度设置
            }
        };
    }
    /**
     * 同步变化开发者的pageSize数据
     */
    syncPageSize(pageSizeNum) {
        if (this.pageSize instanceof Object) {
            this.pageSize.size = pageSizeNum;
        }
    }
    /**
     * @ignore
     * 当前页码是否为最小页码
     */
    noPrevious() {
        return this.currentPage === TiPaginationComponent.MIN_PAGE;
    }
    /**
     * @ignore
     * 当前页码是否为最大页码
     */
    noNext() {
        return this.currentPage === this.totalPageNum;
    }
    /**
     * @ignore
     * 当前页码是否为'···' 不可被聚焦
     */
    isEllipse(page) {
        return page.key === '···';
    }
    /**
     * @ignore
     * 操作pageSize选择框,每页显示条数改变时触发
     */
    onSizeChange(pageSizeNum) {
        this.syncPageSize(pageSizeNum);
        this.verifyCurrentPage(pageSizeNum, false);
        const pagination = {
            currentPage: this.currentPage,
            size: pageSizeNum,
            totalNumber: this.totalNumber
        };
        this.pageNumChange.emit(pagination);
        this.pageUpdate.emit(pagination);
    }
    // 通过操作选择某一页
    selectPage(page, evt) {
        // tiny2中此处阻止a标签浏览器默认事件
        if (!Util.isUndefined(evt)) {
            evt.preventDefault();
        }
        if (this.disabled) {
            return;
        }
        const selectedPage = parseInt(page, 10);
        if (selectedPage !== this.currentPage) {
            this.currentPage = selectedPage;
            this.currentPageChange.emit(this.currentPage);
            this.pageUpdate.emit({
                currentPage: this.currentPage,
                size: this.itemsPerPage.selected,
                totalNumber: this.totalNumber
            });
        }
    }
    /**
     * 计算总页数
     */
    calculateTotalPages(pageSizeNum) {
        const totalPages = Math.ceil(this.totalNumber / pageSizeNum);
        return Math.max(totalPages || 0, 1); // 当totalPages是undefined时，取0
    }
    /**
     * 组装mini类型时模板需要的数据
     */
    configMini() {
        const options = [];
        for (let i = 1; i <= this.totalPageNum; i++) {
            options.push({
                id: `${i}`,
                label: `${i}/${this.totalPageNum}`
            });
        }
        this.itemsMini = {
            options,
            selected: options[this.currentPage - 1],
            change: (option) => {
                this.selectPage(option.id);
            }
        };
    }
    /**
     * @description 根据每页显示条数及数据总条数获取页码列表
     */
    getPages() {
        const startAndEndPage = this.getInterval(); // 获得显示的起始和结束页
        const startPagNum = startAndEndPage[0];
        const endPagNum = startAndEndPage[1];
        const pages = [];
        const restPageNum = this.totalPageNum - this.currentPage; // 剩余页数
        // 只有1页的情况
        if (this.totalPageNum === 1) {
            pages.push(TiPaginationComponent.makePage(1, true));
            return pages;
        }
        // 当总页数大于8，并且中间连续按钮的起始位置没有和第1页相连时，创建第1页按钮和省略号
        if (startPagNum > 2 && this.totalPageNum > 8) {
            pages.push(TiPaginationComponent.makePage(1, this.currentPage === 1));
            pages.push(TiPaginationComponent.makePage('···', false));
        }
        // 创建中间页按钮
        for (let i = startPagNum; i <= endPagNum; i++) {
            pages.push(TiPaginationComponent.makePage(i, this.currentPage === i));
        }
        // 当总页数大于8，并且中间连续按钮的结束位置没有和最后一页按钮相连时，创建省略号
        // 当总页数大于8，并且最后一页隐藏且不是后四页时，创建省略号
        if (this.totalPageNum > 8 && (this.showLastPage && endPagNum < (this.totalPageNum - 1) ||
            !this.showLastPage && restPageNum > 3)) {
            pages.push(TiPaginationComponent.makePage('···', false));
        }
        // 最后一页隐藏：如果中间连续按钮的结束位置为总页数的前一页且当前页是后四页时，创建最后一页
        // 最后一页不隐藏：如果中间连续按钮的结束位置，不是最后一页按钮时，创建最后一页按钮
        if ((!this.showLastPage && endPagNum === this.totalPageNum - 1 && restPageNum <= 3) ||
            (this.showLastPage && endPagNum < this.totalPageNum)) {
            pages.push(TiPaginationComponent.makePage(this.totalPageNum, this.currentPage === this.totalPageNum));
        }
        return pages;
    }
    /**
     * @description 根据当前页码和要显示的数目，计算分页链接的起始页
     */
    getInterval() {
        let start;
        let end;
        // 1.根据Agile规范：页数小于等于8，起、始按钮值分别设为1和最大页数：1 - 总数
        if (this.totalPageNum <= 8) {
            start = 1;
            end = this.totalPageNum;
            return [start, end];
        }
        // 2.总页数大于8，当前项为前三页：1 - 5 / 1 - 6
        if (this.currentPage <= 3) {
            start = 1;
            end = 5;
            if (!this.showLastPage) {
                end = 6;
            }
            return [start, end];
        }
        // 3.总页数大于8，当前项是后4页：总数-4 - 总数
        if (this.currentPage > this.totalPageNum - 3) {
            start = this.totalPageNum - 4;
            end = this.totalPageNum;
            return [start, end];
        }
        // 4.总页数大于8，当前项不在前三页，后三页：显示中间4个按钮
        start = this.currentPage - 1;
        end = this.currentPage + 2;
        // 一般数据量比较大的场景隐藏最后一页时，显示中间5个按钮
        if (!this.showLastPage) {
            end = this.currentPage + 3;
        }
        return [start, end];
    }
    /**
     * 设置合法的新页码
     */
    verifyCurrentPage(pageSizeNum, triggerPageUpdate) {
        this.totalPageNum = this.calculateTotalPages(pageSizeNum);
        if (this.currentPage > this.totalPageNum || this.currentPage < TiPaginationComponent.MIN_PAGE) {
            this.currentPage = this.currentPage > this.totalPageNum ? this.totalPageNum : TiPaginationComponent.MIN_PAGE;
            if (triggerPageUpdate) {
                this.pageUpdate.emit({
                    currentPage: this.currentPage,
                    size: pageSizeNum,
                    totalNumber: this.totalNumber
                });
                Promise.resolve(undefined)
                    .then(() => {
                    this.currentPageChange.emit(this.currentPage);
                });
            }
            else {
                this.currentPageChange.emit(this.currentPage);
            }
        }
    }
    /**
     * @ignore
     * 输入跳转页码enter快捷键处理
     */
    enterPageHandler(e) {
        this.gotoPageHandler(e);
    }
    /**
     * @ignore
     * 根据要跳转的页码，同步修改当前页码
     */
    gotoPageHandler(event) {
        // 当输入值为不合法时处理
        if (this.gotoPage.page < TiPaginationComponent.MIN_PAGE || this.gotoPage.page > this.totalPageNum) {
            this.gotoPage.page = this.currentPage;
            return;
        }
        if (this.gotoPage.page !== this.currentPage) {
            this.currentPage = this.gotoPage.page;
            this.currentPageChange.emit(this.currentPage);
            this.pageUpdate.emit({
                currentPage: this.currentPage,
                size: this.itemsPerPage.selected,
                totalNumber: this.totalNumber
            });
        }
    }
    /**
     * @ignore
     * 上一页按钮的点击事件
     */
    onPrevClick(event) {
        return !this.noPrevious() && this.selectPage(this.currentPage - 1, event);
    }
    /**
     * @ignore
     * 页码点击事件
     */
    onPageClick(page, event) {
        return !this.isEllipse(page) && this.selectPage(page.key, event);
    }
    /**
     * @ignore
     * 下一页按钮的点击事件
     */
    onNextClick(event) {
        return !this.noNext() && this.selectPage(this.currentPage + 1, event);
    }
    /**
     * @ignore
     * input输入框modelchange事件
     */
    ngModelChange(value) {
        if (value === '') {
            this.gotoPage.page = '';
            return;
        }
        const newPage = parseInt(value, 10);
        if (isNaN(newPage)) {
            this.render.setProperty(this.inputRef.nativeElement, 'value', this.gotoPage.page);
            return;
        }
        this.gotoPage.page = newPage;
        this.render.setProperty(this.inputRef.nativeElement, 'value', this.gotoPage.page);
    }
    /**
     * @ignore
     */
    trackByFn(index, item) {
        return item.key;
    }
    isWithTable() {
        return this.table && this.render.parentNode(this.nativeElement).tagName === 'TI-TABLE';
    }
}
TiPaginationComponent.MIN_PAGE = 1;
TiPaginationComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-pagination',
                template: "<ng-container *ngIf=\"type !== 'mini' else mini\">\r\n    <!-- 1.select\u4E0B\u62C9\u7EC4\u4EF6 -->\r\n    <ti-select\r\n            class=\"ti3-page-size-option\"\r\n            size=\"small\"\r\n            [id]=\"appendId('select')\"\r\n            [options]='itemsPerPage.options'\r\n            *ngIf=\"itemsPerPage.hide !== true\"\r\n            [disabled]='disabled'\r\n            [ngStyle]='itemsPerPage.style'\r\n            (ngModelChange)=\"onSizeChange($event)\"\r\n            [(ngModel)]=\"itemsPerPage.selected\">\r\n            <ng-template let-item>{{item}}</ng-template>\r\n    </ti-select>\r\n    <!-- 2.\u603B\u6761\u6570 -->\r\n    <label class=\"ti3-pag-total-items\"\r\n            [ngClass]=\"{'ti3-pag-total-disable': disabled}\"\r\n            *ngIf=\"showTotalNumber\"\r\n            [id]=\"appendId('total_items')\">{{setTotalNumberFormat()}}</label>\r\n    <!-- 3.\u9875\u7801-->\r\n    <div class=\"ti3-pag-pages\" [ngClass]=\"{'ti3-pag-pages-disable': disabled}\">\r\n        <a href=\"javascript:void(0);\"\r\n            oncontextmenu=\"return false\"\r\n            class=\"ti3-pag-prev\"\r\n            [id]=\"appendId('prev_page')\"\r\n            [ngClass]=\"{disabled: noPrevious() || disabled}\"\r\n            [attr.title]=\"noPrevious() ? '' : 'tiPagination.prevTitle' | tiTranslate\"\r\n            [attr.tabindex]=\"(noPrevious() || disabled) ? -1 : ''\"\r\n            (click)=\"onPrevClick($event)\"> <i class=\"ti3-icon ti3-icon-angle-left\"></i> </a>\r\n        <ng-container *ngFor=\"let page of pages; trackBy: trackByFn\">\r\n            <a href=\"javascript:void(0);\"\r\n            oncontextmenu=\"return false\"\r\n            class=\"ti3-pag-page\"\r\n            *ngIf=\"page.active || type !== 'simple'\"\r\n            [id]=\"type !== 'simple' ? appendId('go_') + page.key : 0\"\r\n            [attr.tabindex]=\"(disabled || isEllipse(page) || type === 'simple') ? -1 : ''\"\r\n            tiOutline\r\n            [class.active]=\"page.active && type !== 'simple'\"\r\n            [class.simple]=\"type === 'simple'\"\r\n            [class.ellipse]=\"isEllipse(page)\"\r\n            [class.ti3-page-disable]=\"disabled\"\r\n            (click)=\"onPageClick(page, $event)\">{{page.key}}</a>\r\n        </ng-container>\r\n        <a href=\"javascript:void(0);\"\r\n            oncontextmenu=\"return false\"\r\n            class=\"ti3-pag-next\"\r\n            [id]=\"appendId('next_page')\"\r\n            [ngClass]=\"{disabled: noNext() || disabled}\"\r\n            [attr.title]=\"noNext() ? '' : 'tiPagination.nextTitle' | tiTranslate\"\r\n            [attr.tabindex]=\"(noNext() || disabled) ? -1 : ''\"\r\n            (click)=\"onNextClick($event)\"> <i class=\"ti3-icon ti3-icon-angle-right\"></i> </a>\r\n    </div>\r\n    <!-- 4.\u8DF3\u8F6C\u6309\u94AE -->\r\n    <div class=\"ti3-pag-goto\" *ngIf=\"type === 'default' && showGotoLink === true\"\r\n        [ngClass]=\"{'ti3-pag-goto-disable': disabled}\">\r\n        <span class=\"ti3-pag-goto-text\">{{ 'tiPagination.gotoLabel' | tiTranslate }}</span>\r\n        <input #input\r\n                class=\"ti3-pag-goto-input\"\r\n                tiText\r\n                type=\"text\"\r\n                [ngModel]=\"gotoPage.page\"\r\n                [disabled]=\"disabled\"\r\n                (ngModelChange)=\"ngModelChange($event)\"\r\n                (keydown.enter)=\"enterPageHandler($event)\"\r\n                [id]=\"appendId('input')\">\r\n        <a class=\"ti3-pag-goto-icon-container\"\r\n            (click)=\"gotoPageHandler($event)\"\r\n            [id]=\"appendId('go')\"> <div class=\"ti3-pag-goto-icon\"></div> </a>\r\n    </div>\r\n</ng-container>\r\n<ng-template #mini>\r\n    <div class=\"ti3-pag-mini-pages\">\r\n            <!-- 1.\u603B\u6761\u6570 -->\r\n        <label class=\"ti3-pag-total-items\"\r\n                [ngClass]=\"{'ti3-pag-total-disable': disabled}\"\r\n                *ngIf=\"showTotalNumber\"\r\n                [id]=\"appendId('total_items')\">{{setTotalNumberFormat()}}</label>\r\n        <!-- 2.\u4E0A\u4E00\u9875 -->\r\n        <a href=\"javascript:void(0);\"\r\n            oncontextmenu=\"return false\"\r\n            class=\"ti3-pag-prev\"\r\n            [id]=\"appendId('mini_prev_page')\"\r\n            [ngClass]=\"{disabled: noPrevious() || disabled}\"\r\n            [attr.title]=\"noPrevious() ? '' : 'tiPagination.prevTitle' | tiTranslate\"\r\n            [attr.tabindex]=\"(noPrevious() || disabled) ? -1 : ''\"\r\n            (click)=\"onPrevClick($event)\"> <i class=\"ti3-icon ti3-icon-angle-left\"></i> </a>\r\n        <!-- 3.\u4E0B\u62C9\u6846 -->\r\n        <ti-select\r\n                size=\"small\"\r\n                class=\"ti3-page-mini-option\"\r\n                [options]=\"itemsMini.options\"\r\n                [id]=\"appendId('mini_select')\"\r\n                [(ngModel)]=\"itemsMini.selected\"\r\n                [disabled]='disabled'\r\n                (ngModelChange)=\"itemsMini.change($event)\">\r\n        </ti-select>\r\n        <!-- 4.\u4E0B\u4E00\u9875 -->\r\n        <a href=\"javascript:void(0);\"\r\n            oncontextmenu=\"return false\"\r\n            class=\"ti3-pag-next\"\r\n            [id]=\"appendId('mini_next_page')\"\r\n            [ngClass]=\"{disabled: noNext() || disabled}\"\r\n            [attr.title]=\"noNext() ? '' : 'tiPagination.nextTitle' | tiTranslate\"\r\n            [attr.tabindex]=\"(noNext() || disabled) ? -1 : ''\"\r\n            (click)=\"onNextClick($event)\"> <i class=\"ti3-icon ti3-icon-angle-right\"></i> </a>\r\n    </div>\r\n</ng-template>\r\n",
                host: {
                    '[class.ti3-page-container]': 'true',
                    '[class.ti3-pag-container-disable]': 'this.disabled',
                    '[attr.unselectable]': '"on"'
                },
                styles: ["::ng-deep :root{--ti-pagination-box-model:border-box;--ti-pagination-mini-select-margin:0 var(--ti-common-space-2x);--ti-pagination-page-padding-horizon:6px;--ti-pagination-page-space:var(--ti-common-space-base);--ti-pagination-total-item-pages-space:var(--ti-common-space-4x)}::ng-deep .ti3-table>.ti3-page-container{margin-top:var(--ti-pagination-margin-top-table)}:host.ti3-page-container{display:inline-block}:host.ti3-page-container .ti3-pag-container{-ms-user-select:none;-webkit-user-select:none;display:inline-block;float:left;line-height:normal;user-select:none}:host.ti3-page-container .ti3-pag-total-items{color:var(--ti-pagination-text-color);float:left;font-weight:400;height:var(--ti-pagination-height);line-height:var(--ti-pagination-height);margin:0 var(--ti-pagination-total-item-pages-space);vertical-align:middle}:host.ti3-page-container .ti3-pag-pages{float:left;height:var(--ti-pagination-height)}:host.ti3-page-container .ti3-pag-pages>.ti3-pag-prev{margin-right:var(--ti-pagination-page-space)}:host.ti3-page-container .ti3-pag-next,:host.ti3-page-container .ti3-pag-page,:host.ti3-page-container .ti3-pag-prev{-ms-box-sizing:var(--ti-pagination-box-model);border-radius:var(--ti-pagination-border-radius);box-sizing:var(--ti-pagination-box-model);cursor:pointer;display:inline-block;height:var(--ti-pagination-height);line-height:var(--ti-pagination-height);text-align:center;text-decoration:none;vertical-align:middle}:host.ti3-page-container .ti3-pag-next:hover,:host.ti3-page-container .ti3-pag-page:hover,:host.ti3-page-container .ti3-pag-prev:hover{text-decoration:none}:host.ti3-page-container .ti3-pag-page{color:var(--ti-pagination-text-color);margin-right:var(--ti-pagination-page-space);padding:0 var(--ti-pagination-page-padding-horizon)}:host.ti3-page-container .ti3-pag-page.active{background-color:var(--ti-pagination-bg-color-active);color:var(--ti-pagination-text-color-active)}:host.ti3-page-container .ti3-pag-page.ellipse{background:transparent;border:none;cursor:default;outline:none}:host.ti3-page-container .ti3-pag-page:not(.ellipse):hover{background-color:var(--ti-pagination-bg-color-hover);color:var(--ti-pagination-text-color-hover)}:host.ti3-page-container .ti3-pag-page.active:hover,:host.ti3-page-container .ti3-pag-page.simple:hover{background-color:var(--ti-pagination-bg-color-active-hover);color:var(--ti-pagination-text-color-active-hover)}:host.ti3-page-container .ti3-pag-page:not(.ellipse):active{background-color:var(--ti-pagination-bg-color-press);color:var(--ti-pagination-text-color-active-active)}:host.ti3-page-container .ti3-pag-pages-disable .ti3-page-disable{background-color:var(--ti-pagination-bg-color);color:var(--ti-pagination-text-color-disabled);cursor:not-allowed!important;outline:none}:host.ti3-page-container .ti3-pag-pages-disable .ti3-page-disable:hover{background-color:var(--ti-pagination-bg-color);color:var(--ti-pagination-text-color-disabled)!important}:host.ti3-page-container .ti3-pag-next,:host.ti3-page-container .ti3-pag-prev{color:var(--ti-pagination-prev-next-color);height:var(--ti-pagination-prev-next-width);line-height:var(--ti-pagination-prev-next-width);width:var(--ti-pagination-prev-next-width)}:host.ti3-page-container .ti3-pag-next.disabled,:host.ti3-page-container .ti3-pag-prev.disabled{background-color:var(--ti-pagination-bg-color-disabled);color:var(--ti-pagination-text-color-disabled);cursor:not-allowed;outline:none}:host.ti3-page-container .ti3-pag-next.disabled>.ti3-icon-angle-left,:host.ti3-page-container .ti3-pag-next.disabled>.ti3-icon-angle-right,:host.ti3-page-container .ti3-pag-prev.disabled>.ti3-icon-angle-left,:host.ti3-page-container .ti3-pag-prev.disabled>.ti3-icon-angle-right{color:var(--ti-pagination-icon-color-disabled)}:host.ti3-page-container .ti3-pag-next:not(.disabled):hover,:host.ti3-page-container .ti3-pag-prev:not(.disabled):hover{background-color:var(--ti-pagination-bg-color-hover);color:var(--ti-pagination-text-color-hover)}:host.ti3-page-container .ti3-pag-next:not(.disabled):active,:host.ti3-page-container .ti3-pag-prev:not(.disabled):active{background-color:var(--ti-pagination-button-bg-active);color:var(--ti-pagination-prev-next-color-active)}:host.ti3-page-container .ti3-pag-mini-pages .ti3-pag-next,:host.ti3-page-container .ti3-pag-mini-pages .ti3-pag-prev,:host.ti3-page-container .ti3-page-mini-option,:host.ti3-page-container .ti3-page-size-option{float:left}:host.ti3-page-container .ti3-pag-mini-pages .ti3-page-mini-option{float:left;margin:var(--ti-pagination-mini-select-margin);width:60px}:host.ti3-page-container .ti3-pag-mini-pages .ti3-pag-total-items{margin-left:0}:host.ti3-page-container .ti3-pag-container-disable{cursor:not-allowed}:host.ti3-page-container .ti3-pag-total-disable{color:var(--ti-pagination-total-disable);cursor:not-allowed}:host.ti3-page-container .ti3-pag-goto,:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-text{display:inline-block;float:left;height:var(--ti-pagination-height)}:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-text{color:var(--ti-pagination-text-color);line-height:var(--ti-pagination-height);margin:0 15px;vertical-align:middle}:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-input{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-pagination-border-color);border-radius:2px!important;box-sizing:border-box;color:var(--ti-pagination-goto-input-color);float:left;height:var(--ti-pagination-height);outline:none;padding:0 5px;vertical-align:middle;width:var(--ti-pagination-goto-input-width)}:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-input:focus{border:1px solid var(--ti-input-border-color-focus)}:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-icon-container{-ms-box-sizing:var(--ti-pagination-box-model);background-color:var(--ti-pagination-bg-color);border:1px solid var(--ti-pagination-border-color);border-radius:3px;box-sizing:var(--ti-pagination-box-model);cursor:pointer;display:inline-block;height:var(--ti-pagination-height);margin-left:15px;text-decoration:none;vertical-align:middle;width:var(--ti-pagination-height)}:host.ti3-page-container .ti3-pag-goto .ti3-pag-goto-icon-container .ti3-pag-goto-icon{border-bottom:6px solid transparent;border-left:6px solid var(--ti-pagination-goto-icon-color);border-top:7px solid transparent;height:0;margin:5px 38%;width:0}:host.ti3-page-container .ti3-pag-goto-disable{color:var(--ti-pagination-total-disable);cursor:not-allowed}:host.ti3-page-container .ti3-pag-goto-disable .ti3-pag-goto-icon{border-left:6px solid #999!important;cursor:not-allowed}", "::ng-deep :root{--ti-text-clear-width:26px;--ti-text-password-width:36px}:host[tiText]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);flood-color:var(--ti-input-clear-color);font-size:var(--ti-input-font-size);height:var(--ti-input-height);lighting-color:var(--ti-input-clear-color-hover);line-height:normal;outline:none;padding:0 var(--ti-input-padding-horizontal);stop-color:var(--ti-input-clear-color-disabled);vertical-align:middle}:host[tiText].ti3-text-input-show-icon{background-repeat:no-repeat;background-size:16px}:host[tiText].ti3-text-input-show-clear{background-position:center right 5px;padding-right:var(--ti-text-clear-width)!important}:host[tiText].ti3-text-input-show-password{background-position:center right 10px;padding-right:var(--ti-text-password-width)!important}:host[tiText].ti3-text-input-noborder{border:0;box-shadow:none;outline:0}:host[tiText]:not([disabled]):not([noborder]).ti3-text-input-show-icon.ti3-text-clear-active:hover{cursor:pointer}:host[tiText]:not([disabled]):not([noborder]):hover{border:1px solid var(--ti-input-border-color-hover)}:host[tiText]:not([disabled]):not([noborder]):focus{border:1px solid var(--ti-input-border-color-focus)}:host[tiText][disabled]:disabled{background-color:var(--ti-input-bg-color-disabled);border:1px solid var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}:host[tiText][disabled]:disabled.ti3-text-input-noborder{border:0}.ti3-password-hack-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}:host[tiText]{transition:border-color .15s}:host[tiText].ti3-text-input-show-icon:focus{transition:transform .15s cubic-bezier(.4,0,.2,1),font-size .15s cubic-bezier(.4,0,.2,1)}:host[tiText]:hover:not(:focus){transition:border-color .2s}"]
            },] }
];
TiPaginationComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: TiTableComponent, decorators: [{ type: Optional }] },
    { type: TiSelectComponent, decorators: [{ type: Optional }] }
];
TiPaginationComponent.propDecorators = {
    type: [{ type: Input }],
    totalNumber: [{ type: Input }],
    totalNumberChange: [{ type: Output }],
    currentPage: [{ type: Input }],
    currentPageChange: [{ type: Output }],
    pageSize: [{ type: Input }],
    showTotalNumber: [{ type: Input }],
    showGotoLink: [{ type: Input }],
    autoHide: [{ type: Input }],
    disabled: [{ type: Input }],
    showLastPage: [{ type: Input }],
    pageNumChange: [{ type: Output }],
    pageUpdate: [{ type: Output }],
    mini: [{ type: ViewChild, args: ['mini', { static: true },] }],
    inputRef: [{ type: ViewChild, args: ['input',] }]
};

class TiPaginationModule {
}
TiPaginationModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiIconModule,
                    TiSelectModule,
                    TiTextModule,
                    TiLocaleModule,
                    TiOutlineModule
                ],
                exports: [TiPaginationComponent],
                declarations: [TiPaginationComponent]
            },] }
];

/**
 * 进度条组件
 *
 * <example-url>../tiny3demo/#/progressbar/progressbar-all</example-url>
 */
class TiProgressbarComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         *  设置当前值，当前值/最大值即为进度值
         */
        this.value = 0;
        /**
         *  设置最大值，当前值/最大值即为进度值
         */
        this.max = 100;
        /**
         *  设置进度条在不同当前值下对应的样式，包括动画效果
         */
        this.progressClass = '';
        /**
         *  设置进度条是否开启动画效果
         */
        this.animation = true;
    }
    // 设置合法的数值
    static verifyNum(newVal, defaultValue) {
        return isNaN(parseFloat(newVal)) ? defaultValue : newVal;
    }
    ngOnInit() {
        super.ngOnInit();
        this.max = TiProgressbarComponent.verifyNum(this.max, this.max);
        this.value = TiProgressbarComponent.verifyNum(this.value, this.value);
        this.calcPercentage();
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        // 当前值更新，重新计算进度
        this.setChanges(changes, 'value');
        // 当最大值更新，重新计算进度
        this.setChanges(changes, 'max');
    }
    /**
     * @description 处理用户输入的改变
     * @param: changes 改变的对象
     * @param: changeKey 那个属性改变
     */
    setChanges(changes, changeKey) {
        if (changes[changeKey] && !changes[changeKey].isFirstChange()) {
            const oldVal = changes[changeKey].previousValue;
            const newVal = changes[changeKey].currentValue;
            const _newValue = TiProgressbarComponent.verifyNum(newVal, oldVal);
            this[changeKey] = _newValue;
            this.calcPercentage();
        }
    }
    // 计算当前进度百分比
    calcPercentage() {
        // 如果开发者设置数据不合理，则进度置0
        if (this.max === 0) {
            this.percent = 0;
            return;
        }
        this.percent = Number((this.value * 100 / this.max).toFixed(2));
        if (this.percent > 100) {
            this.percent = 100;
        }
        if (this.percent < 0) {
            this.percent = 0;
        }
    }
}
TiProgressbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-progressbar',
                template: "<div class=\"ti3-progress-bar\" [ngStyle]=\"{'width': percent + '%'}\" [ngClass]=\"progressClass\"\r\n[class.ti3-progress-no-animation]=\"!animation\">\r\n</div>\r\n<div class=\"ti3-progress-label\" [id]=\"appendId('label')\">\r\n\t<ng-content></ng-content>\r\n</div>",
                host: {
                    '[class.ti3-progress]': 'true'
                },
                styles: [":host.ti3-progress{-ms-box-sizing:border-box;background-color:var(--ti-progressbar-progress-bg-color);box-sizing:border-box;display:inline-block;height:var(--ti-progressbar-height);margin-bottom:0;overflow:visible;position:relative;vertical-align:middle;width:100%}.ti3-progress-bar{background-color:var(--ti-progressbar-bg-color);bottom:0;transition:width .6s ease;width:0}.ti3-progress-bar,.ti3-progress-label{-ms-box-sizing:border-box;box-sizing:border-box;left:0;position:absolute;top:0}.ti3-progress-label{background:transparent;color:var(--ti-progressbar-progress-label-color);display:none;height:100%;text-align:center;vertical-align:middle;white-space:nowrap;width:100%}.ti3-progress-label:after{content:\"\";display:inline-block;height:100%;vertical-align:middle;width:0}.ti3-progress-bar.ti3-progress-no-animation{animation:none!important;transition:none!important}"]
            },] }
];
TiProgressbarComponent.propDecorators = {
    value: [{ type: Input }],
    max: [{ type: Input }],
    progressClass: [{ type: Input }],
    animation: [{ type: Input }]
};

class TiProgressbarModule {
}
TiProgressbarModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiProgressbarComponent],
                declarations: [TiProgressbarComponent]
            },] }
];

/**
 * @ignore
 */
class TiProgresspieComponent {
    constructor(hostEle) {
        this.hostEle = hostEle;
        this.defaultConfig = {
            value: 0,
            maxValue: 100,
            color: '#3dcca6',
            lineWidth: 2
        };
        this.value = this.defaultConfig.value;
        this.maxValue = this.defaultConfig.maxValue;
        this.nativeElement = this.hostEle.nativeElement;
    }
    ngOnChanges(changes) {
        // value和maxValue的动态修改均需要重绘进度呈现
        if ((changes.value && !changes.value.isFirstChange()) ||
            (changes.maxValue && !changes.maxValue.isFirstChange())) {
            this.draw();
        }
    }
    ngAfterViewInit() {
        this.canvasElement = this.canvasEle.nativeElement;
        // 修复SSR错误：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return;
        }
        this.canvasElement.width = parseFloat(getComputedStyle(this.nativeElement).width);
        this.canvasElement.height = parseFloat(getComputedStyle(this.nativeElement).height);
        this.draw();
    }
    draw() {
        this.calcPercent();
        this.drawProgressPie();
    }
    // 计算百分比，外部需要保证maxVlue和value均为数字类型
    calcPercent() {
        // 计算percent值
        if (this.maxValue === 0) {
            this.percent = 0;
            return;
        }
        let percent = this.value / this.maxValue;
        if (isNaN(percent)) {
            this.percent = 0;
            return;
        }
        if (percent > 1) {
            percent = 1;
        }
        if (percent < 0) {
            percent = 0;
        }
        this.percent = percent;
    }
    drawProgressPie() {
        const canvas = this.canvasElement;
        const ctx = canvas.getContext('2d');
        // 清除先前画布内容
        const width = canvas.width;
        const height = canvas.height;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 圆半径及起始点计算
        const d = Math.min(width, height);
        const cx = width / 2;
        const cy = height / 2;
        const lineWidth = this.defaultConfig.lineWidth;
        const r = d / 2 - lineWidth;
        const startPoint = -Math.PI / 2;
        // 笔触样式设置
        const color = this.defaultConfig.color;
        ctx.fillStyle = color;
        ctx.strokeStyle = color;
        ctx.lineWidth = lineWidth;
        // 画外圆
        ctx.beginPath();
        ctx.arc(cx, cy, r, startPoint, startPoint + Math.PI * 2);
        ctx.stroke();
        // 画扇形
        const endPoint = startPoint + Math.PI * this.percent * 2;
        ctx.beginPath();
        ctx.moveTo(cx, cy); // 移动至圆心
        ctx.arc(cx, cy, r, startPoint, endPoint); // 从外边上的点画曲线
        ctx.lineTo(cx, cy); // 从圆心画直线到计算好的圆外上的点
        ctx.fill();
        if (this.percent === 0) { // 为0的情况下，绘制圆心值边缘竖线
            ctx.stroke();
        }
        ctx.closePath();
    }
}
TiProgresspieComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-progresspie',
                template: '<canvas #canvas></canvas>'
            },] }
];
TiProgresspieComponent.ctorParameters = () => [
    { type: ElementRef }
];
TiProgresspieComponent.propDecorators = {
    value: [{ type: Input }],
    maxValue: [{ type: Input }],
    canvasEle: [{ type: ViewChild, args: ['canvas', { static: true },] }]
};

/**
 * @ignore
 */
class TiProgresspieModule {
}
TiProgresspieModule.decorators = [
    { type: NgModule, args: [{
                exports: [TiProgresspieComponent],
                declarations: [TiProgresspieComponent]
            },] }
];

/**
 * radio单选框组件
 *
 * radio组件完全基于原生input实现，但是需要在input中添加TinyUI提供的tiRadio属性
 *
 * <example-url>../tiny3demo/#/radio/radio-all</example-url>
 */
class TiRadioComponent extends TiRadioBaseComponent {
    /**
     *  @ignore
     */
    canChange() {
        return !this.nativeElement.checked;
    }
}
TiRadioComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiRadio]',
                template: "<label #labelRef class='ti3-radio' for={{id}} [id]=\"appendId('radio')\">\r\n    <!-- span\u6807\u7B7E\u4E0D\u80FD\u8BBE\u7F6Efor\u5C5E\u6027\uFF0C\u4F1A\u62A5\u9519\uFF0C\u56E0\u4E3Afor\u4E0D\u662Fspan\u6807\u7B7E\u7684\u539F\u6709\u5C5E\u6027 -->\r\n    <!-- \u517C\u5BB9IE11\u6DFB\u52A0spacebar\u4E8B\u4EF6 -->\r\n    <span #proxyRef class='ti3-radio-skin' tiOutline\r\n        (keydown.spacebar)=\"onSpaceKeydown($event)\"  (keyup.spacebar)=\"onSpaceKeyup($event)\"\r\n        (keydown.space)=\"onSpaceKeydown($event)\"  (keyup.space)=\"onSpaceKeyup($event)\"></span>\r\n    <span class='ti3-radio-label' [id]=\"appendId('label')\">{{label}}</span>\r\n</label>",
                encapsulation: ViewEncapsulation.None // 设置组件的试图包装选项：三个值Emulated(默认值)，Native，None
                ,
                styles: [":root{--ti-radio-dark-checked-active-color:var(--ti-common-color-text-link-darkbg);--ti-radio-dark-text-color:var(--ti-common-color-text-darkbg);--ti-radio-label-padding-left:8px;--ti-radio-mark-offset:calc((var(--ti-checkbox-size) - var(--ti-radio-mark-size) - 2px)/2)}input[type=radio][tiRadio]{display:none!important}input[type=radio][tiRadio]+.ti3-radio{-ms-user-select:none;-webkit-user-select:none;line-height:1em;user-select:none}input[type=radio][tiRadio]+.ti3-radio,input[type=radio][tiRadio]+.ti3-radio .ti3-radio-skin{-ms-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:inline-block;font-weight:400;margin-bottom:0;vertical-align:middle}input[type=radio][tiRadio]+.ti3-radio .ti3-radio-skin{border:1px solid var(--ti-radio-border-color);border-radius:50%;height:var(--ti-checkbox-size);margin-right:var(--ti-radio-label-padding-left);position:relative;transition:background-color .15s,border-color .15s;width:var(--ti-checkbox-size)}input[type=radio][tiRadio]+.ti3-radio .ti3-radio-skin:after{-ms-box-sizing:border-box;border-radius:50%;box-sizing:border-box;content:\"\";height:var(--ti-radio-mark-size);left:var(--ti-radio-mark-offset);opacity:0;position:absolute;top:var(--ti-radio-mark-offset);width:var(--ti-radio-mark-size)}input[type=radio][tiRadio]+.ti3-radio .ti3-radio-label{color:var(--ti-radio-label-color);cursor:pointer;font-weight:400;margin-bottom:0;vertical-align:middle}input[type=radio][tiRadio]:not(:disabled):not(:checked)+.ti3-radio .ti3-radio-skin{border-color:var(--ti-radio-border-color)}input[type=radio][tiRadio]:not(:disabled):not(:checked)+.ti3-radio .ti3-radio-skin:after{background-color:var(--ti-radio-bg-color-checked);opacity:0;transform:translateY(-7px) scale(0);transition:opacity .15s ease-out,transform .15s}input[type=radio][tiRadio]:not(:disabled):not(:checked)+.ti3-radio .ti3-radio-skin:focus{border-color:var(--ti-radio-border-color-hover)}input[type=radio][tiRadio]:not(:disabled):not(:checked)+.ti3-radio .ti3-radio-skin:hover{border-color:var(--ti-radio-border-color-hover);transition:border-color .2s var(--ti-timing-function-default)}input[type=radio][tiRadio]:not(:disabled):not(:checked)+.ti3-radio .ti3-radio-skin:active{border-color:var(--ti-radio-border-color-active)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin{border-color:var(--ti-radio-border-color-checked)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:after{background-color:var(--ti-radio-bg-color-checked);opacity:1;transform:translate(0) scale(1);transition:opacity .2s ease-out,transform .2s}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:focus,input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:hover{border-color:var(--ti-radio-bg-color-checked-hover)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:focus:after,input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:hover:after{background-color:var(--ti-radio-bg-color-checked-hover)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:hover{transition:background-color .2s var(--ti-timing-function-default),border-color .2s var(--ti-timing-function-default),content .2s var(--ti-timing-function-default)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:active{border-color:var(--ti-radio-border-color-checked-active)}input[type=radio][tiRadio]:not(:disabled):checked+.ti3-radio .ti3-radio-skin:active:after{background-color:var(--ti-radio-border-color-checked-active)}input[type=radio][tiRadio]:disabled+.ti3-radio{cursor:not-allowed}input[type=radio][tiRadio]:disabled+.ti3-radio .ti3-radio-skin{background-color:var(--ti-radio-bg-color-disabled);border-color:var(--ti-radio-border-color-disabled);cursor:not-allowed}input[type=radio][tiRadio]:disabled+.ti3-radio .ti3-radio-label{color:var(--ti-radio-label-color-disabled);cursor:not-allowed}input[type=radio][tiRadio]:disabled:checked+.ti3-radio .ti3-radio-skin:after{background-color:var(--ti-radio-mark-color-disabled);cursor:not-allowed;opacity:1}input[type=radio][tiRadio].ng-hide+.ti3-radio{display:none!important}input[type=radio][tiRadio][dark]+.ti3-radio .ti3-radio-label{color:var(--ti-radio-dark-text-color)}input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin{border-color:var(--ti-common-color-icon-darkbg-active)}input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:after{background-color:var(--ti-common-color-icon-darkbg-active)}input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:active,input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:focus,input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:hover{border-color:var(--ti-radio-dark-checked-active-color)}input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:active:after,input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:focus:after,input[type=radio][tiRadio][dark]:checked:not(:disabled)+.ti3-radio .ti3-radio-skin:hover:after{background-color:var(--ti-radio-dark-checked-active-color)}input[type=radio][tiRadio][dark]:not(:checked):not(:disabled)+.ti3-radio .ti3-radio-skin{border-color:var(--ti-common-color-icon-disabled)}input[type=radio][tiRadio][dark]:not(:checked):not(:disabled)+.ti3-radio .ti3-radio-skin:active,input[type=radio][tiRadio][dark]:not(:checked):not(:disabled)+.ti3-radio .ti3-radio-skin:focus,input[type=radio][tiRadio][dark]:not(:checked):not(:disabled)+.ti3-radio .ti3-radio-skin:hover{border-color:var(--ti-common-color-icon-darkbg-active)}input[type=radio][tiRadio][dark]:disabled+.ti3-radio .ti3-radio-skin{background-color:var(--ti-common-color-icon-disabled);border-color:var(--ti-common-color-bg-dark-disabled)}input[type=radio][tiRadio][dark]:disabled+.ti3-radio .ti3-radio-skin:after{background-color:var(--ti-common-color-bg-dark-disabled)}"]
            },] }
];

class TiRadioModule {
}
TiRadioModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiOutlineModule
                ],
                exports: [TiRadioComponent],
                declarations: [TiRadioComponent]
            },] }
];

/**
 * tiScrollָ�����ڴ���document�ϵ�tiScroll�¼���
 *
 * 10.0.2����
 */
class TiScrollDirective {
    constructor(hostEleRef, renderer2) {
        this.hostEleRef = hostEleRef;
        this.renderer2 = renderer2;
        this.hostEle = this.hostEleRef.nativeElement;
        this.renderer2.listen(this.hostEle, 'scroll', () => {
            Util.trigger(document, 'tiScroll');
        });
    }
}
TiScrollDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiScroll]'
            },] }
];
TiScrollDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];

class TiScrollModule {
}
TiScrollModule.decorators = [
    { type: NgModule, args: [{
                imports: [],
                exports: [TiScrollDirective],
                declarations: [TiScrollDirective]
            },] }
];

/**
 * Slider滑块组件
 *
 * 滑块组件，通过操作组件选择指示范围
 *
 * <example-url>../tiny3demo/#/slider/slider-all</example-url>
 */
class TiSliderComponent extends TiFormComponent {
    constructor(tiRenderer, iterableDiffers, hostRef, renderer2, changeDetectorRef, domSanitizer) {
        super(hostRef, renderer2);
        this.tiRenderer = tiRenderer;
        this.iterableDiffers = iterableDiffers;
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.changeDetectorRef = changeDetectorRef;
        this.domSanitizer = domSanitizer;
        /**
         * 最小范围值
         */
        this.min = 0;
        /**
         * 最大范围值
         */
        this.max = 10;
        /**
         * 滑动步长，滑块每次跳变的步长（若要实现只在刻度上跳变的效果，step需严格和刻度间距一致）
         */
        this.step = 1;
        /**
         * 设置滑块的tip显示方式：取值"always"，"auto"（默认值）
         *
         * always：tip一直显示
         *
         * auto：鼠标移到滑块上出tip
         */
        this.tipMode = 'auto';
        /**
         * 滑块停止后值发生改变时触发的事件
         *
         * 3.1.0新增
         */
        this.changeStop = new EventEmitter();
        this.isDouble = false; // 判断是否是双滑块，默认是单滑块 false
        this.isTipAutoShow = true; // 判断tip提示是否是自动显示（鼠标操作才显示）,默认true
        // 实现ControlValueAccessor接口--end
        // 组件交互方法集合--start
        /**
         * @ignore
         * Tiny3中不存在下面的问题，用click和mousedown事件都可以（统一使用mousedown事件）
         * 使用mousedown替代click，用于防止拖拽过程中触发click事件导致的滑块滑动
         * 问题场景：min滑块拖动与max滑块重合后，鼠标继续向右移动，此时鼠标抬起，触发click事件，导致max发生移动
         */
        this.hostMousedownEvent = (event) => {
            // 灰化状态或点击pointer时不做处理
            if (this.disabled || this.tiRenderer.hasClass(event.target, 'ti3-slider-pointer')
                || this.tiRenderer.hasClass(event.target, 'ti3-slider-tip')) {
                return;
            }
            this.stepSliderFromClick(event);
        };
        /**
         * @description: 滑块元素的mouseover事件处理函数
         */
        this.tipMouseoverHandle = (event) => {
            if (this.disabled) {
                return;
            }
            this.show(event.target.querySelector('.ti3-slider-tip'));
        };
        /**
         * @description: 滑块元素的mouseleave事件处理函数
         */
        this.tipMouseleaveHandle = (event) => {
            if (this.disabled) {
                return;
            }
            this.hide(event.target.querySelector('.ti3-slider-tip'));
        };
        /**
         * @description: 宿主元素的mousedown事件处理函数
         */
        this.stepSliderFromClick = (event) => {
            const firstTickX = this.trackELe.getBoundingClientRect().left + this.pointerMaxEleWidth / 2;
            const oldModel = this.model;
            let pointerX = event.clientX - firstTickX;
            pointerX = TiSliderComponent.limitValue(pointerX, 0, this.getBarWidth());
            let value = this.positionToValue(pointerX); // 获取value绝对比例值，用于确定滑块移动位置
            // 确定滑动哪个滑块
            let pointer = this.pointerMaxEle;
            if (this.isDouble) {
                const valueMin = TiSliderComponent.splitValueToArray(this.model).valueMin;
                const valueMax = TiSliderComponent.splitValueToArray(this.model).valueMax;
                // 以value中间值为界，在最小值及中间值之间=》左滑块移动；否则=》右滑块移动
                const midValue = (valueMax + valueMin) / 2;
                if ((value >= this.min) && (value < midValue)) {
                    pointer = this.pointerMinEle;
                    this.isMinPointerActive = true;
                }
                else {
                    this.isMinPointerActive = false;
                }
            }
            value = this.getStepValue(value);
            this.setValue(value); // 向外部通知value值
            this.valueToPosition(value, pointer); // 跳至value对应的坐标位置（与step对应）
            if (this.model !== oldModel) {
                this.changeStop.emit(this.model);
            }
        };
        /**
         * @description 拖拽开始执行的事件
         * @param: ui 拖拽助手 {helper：表示被拖拽的助手（helper）, position: 助手（helper）的当前 CSS 位置}
         */
        this.dragStartHandle = (ui) => {
            this.dragStartModel = this.model;
            if (this.isDouble) {
                this.isMinPointerActive = !this.tiRenderer.hasClass(ui.helper, 'ti3-slider-pointer-max');
            }
        };
        /**
         * @description 根据拖拽位置更新value值并改变位置呈现
         * @param: ui 拖拽助手 {helper：表示被拖拽的助手（helper）, position: 助手（helper）的当前 CSS 位置}
         */
        this.dragHandle = (ui) => {
            // 设置value值
            const value = this.dragCommonHandle(ui);
            this.setValue(value); // 向外部通知value值
            // 设置tip提示
            if (this.isTipAutoShow) { // 拖拽过程中显示tip提示
                this.show(ui.helper.querySelector('.ti3-slider-tip'));
            }
            this.setTip(ui.helper.querySelector('.ti3-slider-tip'), value); // 设置tip提示值及位置
        };
        /**
         * @description: 鼠标弹起之后：根据拖拽位置跳至step对应的值并设置slider
         * @param: ui 拖拽助手 {helper：表示被拖拽的助手（helper）, position: 助手（helper）的当前 CSS 位置}
         */
        this.dragStopHandle = (ui) => {
            // 设置value值
            const value = this.dragCommonHandle(ui);
            if (this.isTipAutoShow) { // 拖拽停止隐藏tip提示
                this.hide(ui.helper.querySelector('.ti3-slider-tip'));
            }
            this.valueToPosition(value, ui.helper); // 跳至value对应的坐标位置
            if (this.model !== this.dragStartModel) {
                this.changeStop.emit(this.model);
            }
        };
    }
    /**
     * @description: 将value值处理成数组
     * @param: value 需要切割的数组
     */
    static splitValueToArray(value) {
        const arr = (`${value}`).split(';'); // value为number时强转为字符串
        return {
            valueMin: parseFloat(arr[0]),
            valueMax: arr[1] && parseFloat(arr[1])
        };
    }
    /**
     * @description: value值是否超限制
     * @param: value: 判断的value值
     * @param: minValue: 最大值
     * @param: maxValue: 最小值
     */
    static isLimitExceed(value, minValue, maxValue) {
        return value < minValue || value > maxValue;
    }
    /**
     * @description: 当this.scales为函数情况下，转换为ticks数组
     * @param: scaleFormat 被转换的函数
     * @param: minValue 刻度限制的最大值
     * @param: maxValue 刻度限制的最小值
     * @param: step 刻度步长
     */
    static translateScales(scaleFormat, minValue, maxValue, step) {
        const valueLen = (maxValue - minValue) / step;
        const tickArray = [];
        for (let i = 0; i <= valueLen; i++) {
            const stepNValue = step * i + minValue;
            const formatRet = scaleFormat(stepNValue, minValue, maxValue);
            if (Util.isUndefined(formatRet) || Util.isNull(formatRet)) {
                // 为undefined或null情况下，不打点不显示label
                /* tslint:disable:no-null-keyword */
                tickArray.push(null);
            }
            else {
                // 包含为""（打点不显示label）和非""情况（打点且显示label）
                tickArray.push(formatRet);
            }
        }
        return tickArray;
    }
    /**
     * @description: 在范围内限制value数值
     * @param: value 校验的value值
     * @param: min 最小值
     * @param: max 最大值
     * @return: 有效value值
     */
    static limitValue(value, min, max) {
        // fossid整改，采用一种不撞车写法，可读性差一点。
        // 小于min取min，大于max取max，其他不变。
        const res = value < min ? min :
            value > max ? max : value;
        return res;
    }
    /**
     * @description: 将样式数值转化为calc形式的css样式（设置为百分比形式，确保缩放的支持）
     * @param: percent calc百分比
     * @param: subValue calc减去值
     */
    static parseToCalcStyle(percent, subValue) {
        if (Number.isNaN(subValue) || Util.isUndefined(subValue)) {
            return `calc(${percent * 100}%)`;
        }
        return `calc(${percent * 100}% - ${subValue}px)`; // calc中运算符合2边一定要空格
    }
    onResize() {
        this.updateValuePosition(this.model);
    }
    // 组件声明周期钩子--start
    ngOnInit() {
        super.ngOnInit();
        this.initDom();
        this.initVars();
    }
    /**
     * @ignore
     */
    initDom() {
        this.trackELe = this.trackRef.nativeElement;
        this.selectionEle = this.selectionRef.nativeElement;
        this.pointerMinEle = this.pointerMinRef.nativeElement;
        this.pointerMaxEle = this.pointerMaxRef.nativeElement;
        this.tipMinEle = this.tipMinRef.nativeElement;
        this.tipMaxEle = this.tipMaxRef.nativeElement;
    }
    /**
     * @ignore
     */
    initVars() {
        this.step = Number.isNaN(parseFloat(`${this.step}`)) ? 1 : parseFloat(`${this.step}`);
        this.setMinMax();
        // ratios中最大的小数位数
        this.decimalDigit = this.getDecimalDigit();
        // 处理用戶未设置scales或者scales為function情況
        if (!this.scales || !Array.isArray(this.scales)) {
            this.setScales();
        }
        this.setTipConfig();
        // 给tip添加事件（tipMode是 'auto'的场景）
        this.addTipEvent();
        this.dragOptions = {
            axis: 'x',
            start: this.dragStartHandle,
            drag: this.dragHandle,
            stop: this.dragStopHandle
        };
    }
    ngOnChanges(changes) {
        if (changes['scales'] && !changes['scales'].firstChange && !Array.isArray(this.scales)) {
            this.setScales();
            this.updateValuePosition(this.model);
        }
        // 监听最大值最小值变化
        if ((changes['min'] && !changes['min'].firstChange) || (changes['max'] && !changes['max'].firstChange)) {
            this.setMinMax();
        }
    }
    ngAfterViewInit() {
        this.pointerMaxEleWidth = this.pointerMaxEle.offsetWidth;
        this.isVisibleInit = this.pointerMaxEleWidth !== 0;
        this.changeDetectorRef.detectChanges();
    }
    ngAfterViewChecked() {
        // 监听滑块的宽度：处理组件从隐藏到显示定位问题
        if (!this.isVisibleInit) {
            const pointerMaxWidth = this.pointerMaxEle.offsetWidth;
            if (pointerMaxWidth !== 0) {
                this.isVisibleInit = true;
                this.pointerMaxEleWidth = pointerMaxWidth;
                this.updateValuePosition(this.model);
                this.changeDetectorRef.detectChanges();
            }
        }
    }
    ngDoCheck() {
        if (!Array.isArray(this.scales)) {
            return;
        }
        if (!this.scalesDiffer) {
            this.scalesDiffer = this.iterableDiffers.find(this.scales)
                .create();
        }
        const scalesDiffer = this.scalesDiffer.diff(this.scales);
        if (scalesDiffer) {
            this.setScales();
            // 初始化的updateValuePosition在writeValue中执行（writeValue迟于docheck执行）
            if (!Util.isUndefined(this.model)) {
                this.updateValuePosition(this.model);
            }
        }
    }
    // 组件声明周期钩子--end
    // 实现ControlValueAccessor接口
    /**
     * @ignore
     */
    writeValue(value) {
        // TODO: 接口设计重新调整
        // ngModel => value: string | number; // 滑块对应的value值 exp： 单滑块: 15 OR '15' 双滑块 '15;34';
        super.writeValue(value);
        if (!Util.isNull(value) && !Util.isUndefined(value)) {
            // 1.判断是否是双滑块
            this.isDouble = !Util.isUndefined(TiSliderComponent.splitValueToArray(value).valueMax); // 根据value形式确定单滑块/双滑块
            if (Util.isUndefined(this.onModelChange)) {
                // 在reactive-form中使用，初始化赋值调用writeValue时，
                // 此时registerOnChange还未被调用，onChangeFn还未被赋值，
                // 所以要使用promise(异步)等onChangeFn被赋值后再调用
                Promise.resolve(undefined)
                    .then(() => {
                    this.writeValueHandle(value);
                });
            }
            else {
                this.writeValueHandle(value);
            }
        }
    }
    writeValueHandle(value) {
        if (this.isDouble) {
            this.show(this.pointerMinEle);
        }
        else {
            this.hide(this.pointerMinEle);
        }
        // 赋值操作 && 更新位置
        this.updateValuePosition(value);
    }
    /**
     * @description: 添加tip的事件监听
     */
    addTipEvent() {
        if (this.isTipAutoShow) {
            this.renderer2.listen(this.pointerMaxEle, 'mouseover', this.tipMouseoverHandle);
            this.renderer2.listen(this.pointerMinEle, 'mouseover', this.tipMouseoverHandle);
            this.renderer2.listen(this.pointerMaxEle, 'mouseleave', this.tipMouseleaveHandle);
            this.renderer2.listen(this.pointerMinEle, 'mouseleave', this.tipMouseleaveHandle);
        }
    }
    // 组件交互方法集合--end
    // 内部公共方法集合--start
    /**
     * @description: 拖拽公共处理
     * @param: ui 拖拽助手 {helper：表示被拖拽的助手（helper）, position: 助手（helper）的当前 CSS 位置}
     */
    dragCommonHandle(ui) {
        const pointerX = this.limitDragPosition(ui); // 限制指针在合理的位置范围内
        const value = this.positionToStepValue(pointerX); // 获取当前位置对应的value值
        return value;
    }
    /**
     * @description: 限制滑块移动位置并设置对应的选择区域宽度
     * @param: pointerX 鼠标点击位置（x方向）
     */
    limitDragPosition(ui) {
        let pointerX = ui.position.left; // 当前滑块中心距离tick第一个坐标位置
        const barWidth = this.getBarWidth();
        let pointerWidthHalf = this.pointerMaxEleWidth / 2;
        let pointerMinLeft;
        let pointerMaxLeft;
        if (this.isDouble) {
            if (!this.isMinPointerActive) { // max对应滑块情况的处理
                pointerMinLeft = parseFloat(getComputedStyle(this.pointerMinEle).left);
                pointerX = TiSliderComponent.limitValue(pointerX, pointerMinLeft, barWidth); // 限制滑块在最小和右边界之间
                pointerMaxLeft = pointerX;
            }
            else {
                pointerMaxLeft = parseFloat(getComputedStyle(this.pointerMaxEle).left);
                pointerX = TiSliderComponent.limitValue(pointerX, 0, pointerMaxLeft); // 限制滑块在左边界和最大之间
                pointerMinLeft = pointerX;
            }
            const styles = {
                width: `${pointerMaxLeft - pointerMinLeft}px`,
                left: `${pointerMinLeft + pointerWidthHalf}px`
            };
            this.tiRenderer.setStyles(this.selectionEle, styles);
        }
        else {
            pointerX = TiSliderComponent.limitValue(pointerX, 0, barWidth);
            this.renderer2.setStyle(this.selectionEle, 'width', `${pointerX + pointerWidthHalf}px`);
        }
        ui.position.left = pointerX; // 限制滑块的位置显示
        return pointerX;
    }
    /**
     * @description: 根据滑块位置获取value值(和step对应) (拖拽公共函数中用)
     * @param: pointerX 鼠标点击位置（x方向）
     */
    positionToStepValue(pointerX) {
        const value = this.positionToValue(pointerX); // 获取指针对应的value绝对比例值(和step无关)
        return this.getStepValue(value); // 转化value为与step对应的值;
    }
    /**
     * @description: 获取位置对应的value值
     * @param: pointerX 鼠标点击位置（x方向）
     */
    positionToValue(pointerX) {
        const barWidth = this.getBarWidth();
        const percent = pointerX / barWidth;
        if (!Util.isUndefined(this.ratios)) {
            return this.unequalPositionToValue(pointerX, barWidth, percent);
        }
        return this.min + percent * (this.max - this.min);
    }
    /**
     * @description: 设置组件的model值，用于向外通知
     * @param: value 当前指针的值
     */
    setValue(value) {
        if (this.isDouble) {
            const valueMin = TiSliderComponent.splitValueToArray(this.model).valueMin;
            const valueMax = TiSliderComponent.splitValueToArray(this.model).valueMax;
            if (!this.isMinPointerActive && value !== valueMax) {
                this.model = `${valueMin};${value}`;
            }
            else if (this.isMinPointerActive && value !== valueMin) {
                this.model = `${value};${valueMax}`;
            }
        }
        else {
            if (value !== this.model) {
                this.model = value;
            }
        }
    }
    /**
     * @description: 获取对应的step值(根据step修正value值)
     * @param: value 当前点击的绝对值
     */
    getStepValue(value) {
        const min = this.min;
        const step = this.step;
        let stepValue;
        const stepN = Math.round((value - min) / step); // value值变化几个步长
        if (step.toString()
            .indexOf('.') !== -1) {
            const n = step.toString()
                .split('.').length;
            stepValue = parseFloat((min + stepN * step).toFixed(n));
        }
        else {
            stepValue = min + stepN * step;
        }
        return TiSliderComponent.limitValue(stepValue, min, this.max);
    }
    /**
     * @description: 在不等分条件下获取位置对应的value值
     * @param: pointerX 鼠标点击位置（x方向）
     * @param: barWidth 指针宽度
     * @param: percent pointerX占滑动轴百分比
     */
    unequalPositionToValue(pointerX, barWidth, percent) {
        let limitWidth = 0; // 每一段的宽度
        let selectLength = 0; // 已被选中区域段的宽度
        let ratiosWidth = 0; // 已被选中区域段长度和占总长的比例
        const c = this.decimalDigit;
        const ticksLen = this.ticksArr.length;
        for (let i = 0; i < ticksLen - 1; i++) {
            limitWidth = barWidth * this.ratios[i];
            if (i === 0) {
                selectLength = 0;
                ratiosWidth = 0;
            }
            else {
                ratiosWidth = Number((ratiosWidth + this.ratios[i - 1]).toFixed(c));
                selectLength = barWidth * ratiosWidth;
            }
            const pointerWidth = pointerX - selectLength;
            if (percent <= Number((ratiosWidth + this.ratios[i]).toFixed(c))
                && percent >= ratiosWidth) {
                return this.ticksArr[i] + (pointerWidth / limitWidth) * (this.ticksArr[i + 1] - this.ticksArr[i]);
            }
        }
    }
    /**
     * @description: 当前组件写入新值 || min || max || scales发生变化 时更新value对应的位置
     * @param: newValue 需要处理的value的值
     */
    updateValuePosition(newValue) {
        let valueTmp;
        if (this.isDouble) {
            valueTmp = this.restrictDoubleValue(newValue);
            const valueMax = TiSliderComponent.splitValueToArray(valueTmp).valueMax;
            const valueMin = TiSliderComponent.splitValueToArray(valueTmp).valueMin;
            // 当设置value均为最大值情况下，设置最小滑块层级，确保滑块可被拖动
            // 最小值的情况左右滑块zIndex相等，但是右滑块DOM在左滑块之后，因此根据zIndex规则，右滑块可以覆盖左滑块
            if ((valueMin === valueMax) && (valueMin === this.max)) {
                this.isMinPointerActive = true;
            }
            // 设置滑块的位置
            this.valueToPosition(valueMin, this.pointerMinEle);
            this.valueToPosition(valueMax, this.pointerMaxEle);
        }
        else {
            valueTmp = this.restrictSingleValue(newValue);
            this.valueToPosition(valueTmp, this.pointerMaxEle);
        }
        if (newValue !== valueTmp) {
            this.model = valueTmp;
        }
    }
    /**
     * @description: 限定双滑块value的值
     * @param: value 需要处理的value的值
     */
    restrictDoubleValue(value) {
        const valueMin = TiSliderComponent.splitValueToArray(value).valueMin; // 双滑块的小值
        const valueMax = TiSliderComponent.splitValueToArray(value).valueMax; // 双滑块的大值
        // 非法情况：非数字，超过限制，value大小顺序不正确情况
        const isInvalidValueMin = isNaN(valueMin) ||
            TiSliderComponent.isLimitExceed(valueMin, this.min, this.max) || valueMin > valueMax;
        // 非法情况：非数字，超过限制，value大小顺序不正确情况
        const isInvalidValueMax = isNaN(valueMax) ||
            TiSliderComponent.isLimitExceed(valueMax, this.min, this.max) || valueMin > valueMax;
        return `${isInvalidValueMin ? this.min : valueMin};${isInvalidValueMax ? this.max : valueMax}`;
    }
    /**
     * @description: 限定单滑块value的值
     * @param: value 需要处理的value的值
     */
    restrictSingleValue(value) {
        if (isNaN(parseFloat(value)) || value < this.min) {
            // value不是数字或者小于最小值point定位到最小值
            return this.min;
        }
        if (value > this.max) {
            // value大于最大值point定位到最大值
            return this.max;
        }
        return value;
    }
    /**
     * @description: 处理tip
     */
    setTipConfig() {
        const defaultTipShow = 'auto';
        const defaultTipFormatter = (value) => {
            return value;
        };
        this.tipMode = Util.isUndefined(this.tipMode) ? defaultTipShow : this.tipMode;
        this.tipFormatterFn = Util.isUndefined(this.tipFormatterFn) ? defaultTipFormatter : this.tipFormatterFn;
        this.isTipAutoShow = (this.tipMode !== 'always');
        if (this.isTipAutoShow) {
            this.hide(this.tipMaxEle);
            this.hide(this.tipMinEle);
        }
        else {
            this.show(this.tipMaxEle);
            this.show(this.tipMinEle);
        }
    }
    /**
     * @description: 处理限制
     */
    setMinMax() {
        const defaultMin = 0;
        const defaultMax = 10;
        const min = parseFloat(`${this.min}`);
        const max = parseFloat(`${this.max}`);
        this.min = (isNaN(min) || min >= max) ? defaultMin : min;
        this.max = (isNaN(max) || min >= max) ? defaultMax : max;
    }
    /**
     * @description: 处理刻度
     */
    setScales() {
        const step = this.step;
        const min = this.min;
        const max = this.max;
        let ticks = [];
        if (typeof this.scales === 'function') {
            this.ticks = TiSliderComponent.translateScales(this.scales, min, max, step);
        }
        else if (Array.isArray(this.scales)) {
            // 为Array情况下，直接使用数值
            this.ticks = this.scales.concat();
        }
        else {
            // 未传scale(包含非法)的情况下，只显示最小和最大值
            const ticksLen = (max - min) / step;
            ticks.push(min);
            for (let i = 0; i < ticksLen - 1; i++) {
                // 除最小最大值外，其余只打点不显示label
                ticks.push('');
            }
            ticks.push(max);
            this.ticks = ticks;
        }
        if (!Util.isUndefined(this.ratios)) {
            let ratiosSum = 0; // 将ratios中每一项与之前的求和
            const sumArray = []; //  由ratiosSum组成的数组
            const ratiosLen = this.ratios.length;
            for (let i = 0; i < ratiosLen; i++) {
                ratiosSum = Number((ratiosSum + Number(this.ratios[i])).toFixed(this.decimalDigit));
                sumArray.push(ratiosSum);
            }
            ticks = this.getTicks(sumArray, this.decimalDigit);
            this.ticks = ticks;
        }
    }
    /**
     * @description: 非均匀情况下确定打点的位置
     * @param: arr 由ratiosSum组成的数组
     * @param: num ratios中最大的小数位数
     */
    getTicks(arr, num) {
        const minScale = Number(Math.pow(0.1, num)
            .toFixed(num)); //  判断是否打点的基数
        let k = 1;
        let p = 0;
        const ticks = [this.ticks[0]];
        const length = parseInt(`${1 / minScale}`, 10);
        for (let i = 0; i < length; i++) {
            p = Number((p + minScale).toFixed(num));
            if (arr.indexOf(p) === -1) {
                // 判断每次相加基数后是否在数组中，不在不打点不显示label
                // tslint:disable-next-line:no-null-keyword
                ticks.push(null);
            }
            else {
                // 否则打点显示label
                ticks.push(this.ticks[k]);
                k++;
            }
        }
        return ticks;
    }
    /**
     * @description: 显示隐藏的元素
     * @param: ele: 要显示的DOM对象
     */
    show(ele) {
        // 注：此处未使用ng-show方式控制滑块显示是因为有延迟，造成后续方法获取pointer宽度为0，显示错乱
        this.renderer2.setStyle(ele, 'display', 'block');
    }
    /**
     * @description: 隐藏显示的元素
     * @param: ele: 要隐藏的DOM对象
     */
    hide(ele) {
        // 注：此处未使用ng-show方式控制滑块显示是因为有延迟，造成后续方法获取pointer宽度为0，显示错乱
        this.renderer2.setStyle(ele, 'display', 'none');
    }
    /**
     * @ignore
     * @description: 获取ticks的最大显示宽度，一行显示不下情况下，换行显示
     * @param: index 刻度下标
     */
    calcTickMaxWidth(index) {
        const ticksLen = this.ticks.length;
        const spacePercent = 1 / (ticksLen - 1); // 两个刻度点间隔宽度百分百（小数）
        if (index === 0 || index === (ticksLen - 1)) {
            // 第一个和最后一个刻度
            return TiSliderComponent.parseToCalcStyle(spacePercent, this.pointerMaxEleWidth / 2);
        }
        return TiSliderComponent.parseToCalcStyle(spacePercent);
    }
    /**
     * @ignore
     * @description: 获取 ticks 的left位置
     * @param: index 刻度下标
     */
    calcTickLeftPosition(index) {
        return `${index / (this.ticks.length - 1) * 100}%`;
    }
    /**
     * @ignore
     * @description: 确定滑动轴打点是否为选中点，根据函数返回值设置选中样式 (是否是selection区域的点)
     * @param: index 刻度下标
     */
    isSelectTick(index) {
        const ticksLen = this.ticks.length;
        // 双滑块情况下,位于最大最小值之间为选中状态
        if (this.isDouble) {
            const value = this.model.split(';');
            const isLargeThanValMin = index / ticksLen >= (parseFloat(value[0]) - this.min) / (this.max - this.min);
            const isSmallThanValMax = index / ticksLen <= (parseFloat(value[1]) - this.min) / (this.max - this.min);
            return isLargeThanValMin && isSmallThanValMax;
        }
        // 单滑块情况下,小于选中值为选中状态
        return index / ticksLen <= (parseFloat(this.model) - this.min);
    }
    /**
     * @description:  获取滑动轴的宽度(涉及到屏幕缩放，所以需要实时获取)
     */
    getBarWidth() {
        return this.trackELe.getBoundingClientRect().width - this.pointerMaxEleWidth;
    }
    /**
     * @description: 获取ratios中最大的小数位数
     */
    getDecimalDigit() {
        const decimalArr = [];
        if (Array.isArray(this.ratios)) {
            this.ratios.forEach((item) => {
                const decimal = item.toString()
                    .split('.')[1];
                if (decimal) {
                    decimalArr.push(decimal.length);
                }
            });
        }
        return Math.max.apply(null, decimalArr);
    }
    /**
     * @description: 获取当前value所在的区域以及当前value对应的长度占总长的百分比(小数)
     * @param: value 指针对应的value值
     * @param: paragraph 当前打点的段数
     */
    getValuePercent(value, paragraph) {
        let ratiosSum = 0; // 当前打点的段数下ratios的总和
        for (let i = 0; i < paragraph; i++) {
            ratiosSum = Number((ratiosSum + this.ratios[i]).toFixed(this.decimalDigit));
        }
        return ratiosSum + (value - this.ticksArr[paragraph]) / (this.ticksArr[paragraph + 1]
            - this.ticksArr[paragraph]) * this.ratios[paragraph];
    }
    /**
     * @description: 设置pointerDOM位置
     * @param: value 指针对应的value值
     * @param: pointer 被设置的DOM对象
     */
    setPointerPos(value, pointer) {
        let valuePercent;
        if (!Util.isUndefined(this.ratios)) {
            if (Util.isUndefined(this.ticks)) {
                return;
            }
            this.ticksArr = [];
            this.ticks.forEach((tick) => {
                if (!Util.isNull(tick)) {
                    this.ticksArr.push(tick);
                }
            });
            const ticksArrLen = this.ticksArr.length;
            for (let i = 0; i < ticksArrLen - 1; i++) {
                if (value >= this.ticksArr[i] && value <= this.ticksArr[i + 1]) {
                    valuePercent = this.getValuePercent(value, i);
                }
            }
        }
        else {
            valuePercent = (value - this.min) / (this.max - this.min);
        }
        // 计算value对应的百分比位置,并以tick中心点居中显示
        const pointerLeft = TiSliderComponent.parseToCalcStyle(valuePercent);
        this.renderer2.setStyle(pointer, 'left', pointerLeft);
    }
    /**
     * @description: 改变某一指针value值对应的指示位置
     * @param: value 指针对应的value值
     * @param: pointer 被设置的DOM对象
     */
    valueToPosition(value, pointer) {
        this.setPointerPos(value, pointer); // 设置pointer位置
        let styles; // 滑动轴有效区域背景 样式对象
        // 修复SSR报错：ERROR { Error: Uncaught (in promise): TypeError: this.pointerMaxEle.getBoundingClientRect is not a function
        if (typeof this.pointerMaxEle.getBoundingClientRect !== 'function') {
            return;
        }
        // 设置滑动轴有效区域背景
        const pointerMaxLeft = this.pointerMaxEle.getBoundingClientRect().left;
        const pointerMinLeft = this.pointerMinEle.getBoundingClientRect().left;
        const barWidth = this.getBarWidth();
        const barLeft = this.trackELe.getBoundingClientRect().left;
        const pointerWidthHalf = this.pointerMaxEleWidth / 2;
        if (this.isDouble) {
            styles = {
                width: `${(pointerMaxLeft - pointerMinLeft) * 100 / barWidth}%`,
                left: `${((pointerMinLeft - barLeft + pointerWidthHalf) * 100 / barWidth)}%`
            };
        }
        else {
            styles = {
                width: `${((pointerMaxLeft - barLeft + pointerWidthHalf) * 100 / barWidth)}%`,
                left: 0
            };
        }
        this.tiRenderer.setStyles(this.selectionEle, styles);
        this.setTip(pointer.querySelector('.ti3-slider-tip'), value);
    }
    /**
     * @description:设置Tip提示内容及位置
     * @param: curTipEle 要设置tip的元素
     * @param: value 设置tip内容对应的value值
     */
    setTip(curTipEle, value) {
        // 设置tip内容
        const tipContent = this.tipFormatterFn(value);
        curTipEle.innerHTML = this.domSanitizer.sanitize(SecurityContext.HTML, tipContent);
        // 设置当前tip位置
        const tipDisplay = getComputedStyle(curTipEle).display;
        this.show(curTipEle); // 先把tip显示出来 才能获取宽度
        const tipContentWidth = curTipEle.getBoundingClientRect().width;
        const styles = {
            left: `${-(tipContentWidth - this.pointerMaxEleWidth) / 2 - 1}px`,
            display: tipDisplay // 设置回原来的display
        };
        this.tiRenderer.setStyles(curTipEle, styles);
        // tip重合情况处理  (双滑块并且tip是一直显示出来那种场景)
        if (this.isDouble && !this.isTipAutoShow) {
            /**
             * @description: 渲染当前的tip样式 （移除一个class并且添加一个class）
             * @param: tipEle 当前tipDOM
             * @param: removeClass 要移除的class名字
             * @param: addClass 要添加的class名字
             */
            const renderTipStyle = (tipEle, removeClass, addClass) => {
                this.renderer2.removeClass(tipEle, removeClass);
                this.renderer2.addClass(tipEle, addClass);
            };
            // 重置tip样式，防止之前样式设置造成的影响  ti3-slider-tip-top
            renderTipStyle(this.tipMaxEle, 'ti3-slider-tip-bottom', 'ti3-slider-tip-top');
            renderTipStyle(this.tipMinEle, 'ti3-slider-tip-bottom', 'ti3-slider-tip-top');
            this.show(this.tipMaxEle);
            this.show(this.tipMinEle);
            // 最大最小值重合情况下，只显示当前tip
            const selectionWidth = this.selectionEle.getBoundingClientRect().width;
            if (selectionWidth === 0) {
                if (this.tiRenderer.hasClass(curTipEle, 'ti3-slider-tip-max')) {
                    // 当前tip是最大值的 隐藏最小值tip
                    this.hide(this.tipMinEle);
                }
                else {
                    // 当前tip是最小值的 隐藏最大值tip
                    this.hide(this.tipMaxEle);
                }
                return;
            }
            // tip重合情况下，当前tip向下显示
            const tipMaxWidth = this.tipMaxEle.getBoundingClientRect().width;
            const tipMinWidth = this.tipMinEle.getBoundingClientRect().width;
            if ((tipMaxWidth + tipMinWidth) / 2 >= selectionWidth) {
                renderTipStyle(curTipEle, 'ti3-slider-tip-top', 'ti3-slider-tip-bottom');
            }
        }
    }
}
TiSliderComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-slider',
                template: "<div #trackEle class=\"ti3-slider-track-container\">\r\n  <div class=\"ti3-slider-track-content\">\r\n    <div #selection class=\"ti3-slider-bar-selection\"></div>\r\n    <div #pointerMin [id]=\"appendId('min')\" [tiDraggable]=\"dragOptions\"\r\n         [style.zIndex]=\"isMinPointerActive ? 2 : 1\" [tiDragDisabled]=\"disabled\"\r\n         class=\"ti3-slider-pointer ti3-slider-pointer-min ti3-icon ti3-icon-slider-point\">\r\n        <div #tipMin class=\"ti3-slider-tip ti3-slider-tip-top ti3-slider-tip-min\"></div>\r\n    </div>\r\n    <div #pointerMax [id]=\"appendId('max')\" [tiDraggable]=\"dragOptions\"\r\n         [style.zIndex]=\"!isMinPointerActive ? 2 : 1\" [tiDragDisabled]=\"disabled\"\r\n         class=\"ti3-slider-pointer ti3-slider-pointer-max ti3-icon ti3-icon-slider-point\">\r\n        <div #tipMax class=\"ti3-slider-tip ti3-slider-tip-top ti3-slider-tip-max\"></div>\r\n    </div>\r\n  </div>\r\n  <ul class=\"ti3-slider-ticks\" [id]=\"appendId('list')\">\r\n    <li *ngFor=\"let tick of ticks; index as i\" class=\"ti3-slider-tick\"\r\n        [ngStyle]=\"{'left': calcTickLeftPosition(i), 'max-width': calcTickMaxWidth(i)}\">\r\n        <ng-container *ngIf=\"tick !== null\">\r\n          <div class=\"ti3-slider-tick-dot\" [ngClass]=\"{'ti3-slider-selection-tick-dot': isSelectTick(i)}\"></div>\r\n          <section *ngIf=\"labelTemplate else defaultTemplate\" class=\"ti3-slider-tick-value\">\r\n            <ng-container *ngTemplateOutlet=\"labelTemplate; context: {$implicit: tick, index: i}\">\r\n            </ng-container>\r\n          </section>\r\n\r\n          <ng-template #defaultTemplate>\r\n            <span *ngIf=\"tick!== ''\" class=\"ti3-slider-tick-value\" [innerHTML]=\"tick\"></span>\r\n          </ng-template>\r\n        </ng-container>\r\n    </li>\r\n  </ul>\r\n</div>\r\n",
                host: {
                    '[class.ti3-slider-container]': 'true',
                    '[class.ti3-slider-disable]': 'disabled',
                    '(mousedown)': 'hostMousedownEvent($event)'
                },
                providers: [TiFormComponent.getValueAccessor(TiSliderComponent)],
                styles: ["::ng-deep :root{--ti-slider-bar-selection-height:16px;--ti-slider-border-radius:var(--ti-common-border-radius-normal);--ti-slider-pointer-height:28px;--ti-slider-pointer-width:20px;--ti-slider-tick-margin-left:calc(var(--ti-slider-pointer-width)/2);--ti-slider-tick-top:8px;--ti-slider-tip-triangle-height:6px;--ti-slider-tip-triangle-width:10px;--ti-slider-tip-vertical-space:calc(var(--ti-slider-tip-triangle-height) + 5px);--ti-slider-track-height:8px}:host.ti3-slider-container{cursor:pointer;display:block;margin:36px 0;*zoom:1}:host.ti3-slider-container:after{clear:both;content:\"\";display:table}:host.ti3-slider-container:before{content:\"\";display:table}:host.ti3-slider-container .ti3-slider-track-container{background-color:var(--ti-slider-track-bg-color);border-radius:var(--ti-slider-border-radius);height:var(--ti-slider-track-height);position:relative;width:100%}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content{height:var(--ti-slider-track-height);position:relative;width:calc(100% - 20px)}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-bar-selection{background-color:var(--ti-slider-selection-bg-color);border-radius:var(--ti-slider-border-radius) 0 0 var(--ti-slider-border-radius);height:var(--ti-slider-bar-selection-height);position:absolute;top:calc(-1*var(--ti-common-space-base));z-index:1}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min{-ms-box-sizing:border-box;background-color:var(--ti-common-color-bg-white-normal);border-radius:calc(var(--ti-slider-border-radius)*5);box-sizing:border-box;height:var(--ti-slider-pointer-height);line-height:calc(var(--ti-slider-pointer-height) - 2px);position:absolute;top:calc(-1*(var(--ti-slider-pointer-height) - var(--ti-slider-track-height))/2);width:20px;z-index:1}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max.ti3-icon-slider-point:hover,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min.ti3-icon-slider-point:hover{border-color:var(--ti-slider-pointer-color-hover);color:var(--ti-slider-pointer-color-hover)}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max.ti3-icon-slider-point,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min.ti3-icon-slider-point{background:var(--ti-slider-pointer-bg-color);border:1px solid var(--ti-slider-pointer-color);border-radius:calc(var(--ti-slider-border-radius)*5);box-shadow:var(--ti-slider-pointer-bs);color:var(--ti-slider-pointer-color);position:absolute;text-align:center}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max .ti3-slider-tip,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min .ti3-slider-tip{background-color:var(--ti-slider-tip-bg-color);border-radius:var(--ti-common-border-radius-1);box-shadow:var(--ti-slider-tip-bs);color:var(--ti-slider-tip-color);cursor:default;font-family:var(--ti-default-font-family);font-size:12px;line-height:var(--ti-common-line-height-number);padding:12px 16px;position:absolute;white-space:pre;word-wrap:break-word}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max .ti3-slider-tip.ti3-slider-tip-top,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min .ti3-slider-tip.ti3-slider-tip-top{bottom:calc(100% + var(--ti-slider-tip-vertical-space))}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max .ti3-slider-tip.ti3-slider-tip-top:before,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min .ti3-slider-tip.ti3-slider-tip-top:before{border-left:calc(var(--ti-slider-tip-triangle-width)/2) solid transparent;border-right:calc(var(--ti-slider-tip-triangle-width)/2) solid transparent;border-top:var(--ti-slider-tip-triangle-height) solid var(--ti-slider-tip-bg-color);content:\" \";height:0;left:50%;margin-left:calc(-1*var(--ti-slider-tip-triangle-width)/2);pointer-events:none;position:absolute;top:100%;width:0;z-index:3}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max .ti3-slider-tip.ti3-slider-tip-bottom,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min .ti3-slider-tip.ti3-slider-tip-bottom{top:calc(100% + var(--ti-slider-tip-vertical-space))}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-max .ti3-slider-tip.ti3-slider-tip-bottom:before,:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min .ti3-slider-tip.ti3-slider-tip-bottom:before{border-bottom:var(--ti-slider-tip-triangle-height) solid var(--ti-slider-tip-bg-color);border-left:calc(var(--ti-slider-tip-triangle-width)/2) solid transparent;border-right:calc(var(--ti-slider-tip-triangle-width)/2) solid transparent;bottom:100%;content:\" \";height:0;left:50%;margin-left:calc(-1*var(--ti-slider-tip-triangle-width)/2);pointer-events:none;position:absolute;width:0;z-index:3}:host.ti3-slider-container .ti3-slider-track-container .ti3-slider-track-content .ti3-slider-pointer-min{display:none}:host.ti3-slider-container .ti3-slider-ticks{position:relative;width:calc(100% - var(--ti-slider-pointer-width))}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick{height:var(--ti-slider-track-height);margin-left:var(--ti-slider-tick-margin-left);position:absolute;top:calc(-1*var(--ti-slider-tick-top))}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick .ti3-slider-tick-dot{background-color:var(--ti-common-color-bg-white-normal);height:var(--ti-slider-track-height);position:relative;width:2px}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick .ti3-slider-tick-dot.ti3-slider-selection-tick-dot{background-color:var(--ti-slider-tick-selection-color)}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick:first-child .ti3-slider-tick-dot,:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick:last-child .ti3-slider-tick-dot{width:0}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick:first-child .ti3-slider-tick-value{left:calc(-1*var(--ti-slider-tick-margin-left))}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick:last-child .ti3-slider-tick-value{left:calc(-100% + var(--ti-slider-tick-margin-left));white-space:nowrap}:host.ti3-slider-container .ti3-slider-ticks .ti3-slider-tick .ti3-slider-tick-value{color:var(--ti-slider-tick-color);left:-50%;position:relative;top:var(--ti-slider-tick-top)}:host.ti3-slider-container.ti3-slider-disable.ti3-slider-container{cursor:not-allowed}:host.ti3-slider-container.ti3-slider-disable.ti3-slider-container .ti3-slider-track-container{background-color:var(--ti-slider-pointer-bg-disable)}:host.ti3-slider-container.ti3-slider-disable.ti3-slider-container .ti3-slider-track-container .ti3-slider-bar-selection{background-color:var(--ti-slider-color-disabled)}:host.ti3-slider-container.ti3-slider-disable.ti3-slider-container .ti3-slider-track-container .ti3-slider-pointer-max.ti3-icon-slider-point,:host.ti3-slider-container.ti3-slider-disable.ti3-slider-container .ti3-slider-track-container .ti3-slider-pointer-min.ti3-icon-slider-point{background:var(--ti-slider-pointer-bg-disable);border-color:var(--ti-slider-pointer-border-disable);box-shadow:none;color:var(--ti-slider-color-disabled)}"]
            },] }
];
TiSliderComponent.ctorParameters = () => [
    { type: TiRenderer },
    { type: IterableDiffers },
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: DomSanitizer }
];
TiSliderComponent.propDecorators = {
    min: [{ type: Input }],
    max: [{ type: Input }],
    step: [{ type: Input }],
    scales: [{ type: Input }],
    tipMode: [{ type: Input }],
    tipFormatterFn: [{ type: Input }],
    ratios: [{ type: Input }],
    changeStop: [{ type: Output }],
    labelTemplate: [{ type: ContentChild, args: [TemplateRef, { static: true },] }],
    trackRef: [{ type: ViewChild, args: ['trackEle', { static: true },] }],
    selectionRef: [{ type: ViewChild, args: ['selection', { static: true },] }],
    pointerMinRef: [{ type: ViewChild, args: ['pointerMin', { static: true },] }],
    pointerMaxRef: [{ type: ViewChild, args: ['pointerMax', { static: true },] }],
    tipMinRef: [{ type: ViewChild, args: ['tipMin', { static: true },] }],
    tipMaxRef: [{ type: ViewChild, args: ['tipMax', { static: true },] }],
    onResize: [{ type: HostListener, args: ['window:resize',] }]
};

class TiSliderModule {
}
TiSliderModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiDraggableModule,
                    TiIconModule,
                    TiRendererModule
                ],
                exports: [TiSliderComponent],
                declarations: [TiSliderComponent]
            },] }
];

/**
 * TiNumber 数字输入框指令
 *
 * 该指令主要作用于输入框上，限制只能输入数字。用户可以通过设置 数字保留精度、是否国际化 来设置数字显示格式
 *
 * 输入框处于焦点状态时，输入框中数字标准化显示。失去焦点时，根据用户配置是否支持国际化进行格式化显示
 *
 * 目前JS可以解析的范围是[-2^53, 2^53]，即16位数字。当超过16位整数时，此时数字范围已经超过JS解析方位，不能精确表示。
 *
 * <example-url>../tiny3demo/#/inputnumber/inputnumber-all</example-url>
 */
// The default ControlValueAccessor for writing a value and listening to changes on input elements.
// The accessor is used by the FormControlDirective, FormControlName, and NgModel directives.
class TiInputNumberDirective extends DefaultValueAccessor {
    constructor(renderer, elementRef, document) {
        super(renderer, elementRef, true);
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.document = document;
        /**
         * 设置数据是否支持国际化显示，默认支持国际化
         */
        this.localeable = true;
        this.numberFormat = '1.0-3';
        this.oldInputValue = ''; // 没有千位分隔符的input中的值
        this.element = this.elementRef.nativeElement;
    }
    ngOnInit() {
        if (!TiLocaleFormat.isInvalidFormat(this.format)) {
            const precision = parseInt(this.format.slice(1), 10);
            // tslint:disable-next-line:prefer-template
            this.numberFormat = '1.' + precision + '-' + precision;
        }
    }
    // 检测当前值是否合法 如果合法 返回true；否则返回false.
    isValidInput(value) {
        const decimalSep = this.localeable ? TiLocaleFormat.getNumberSymbol('Decimal') : '.'; // 当前局点小数点的形式
        let regex; // regex是正则表达式，不明其类型，所以
        if (decimalSep === ',') {
            regex = /^\-{0,1}\d{0,},{0,1}\d{0,}$/;
        }
        else if (decimalSep === '.') {
            regex = /^\-{0,1}\d{0,}\.{0,1}\d{0,}$/;
        }
        return regex.test(value);
    }
    /**
     * 功能描述：当该值合法，直接返回. 如果不合法，则返回之前保存的有效值。
     * @memberOf TiInputNumberDirective
     */
    getCorrectValue(value) {
        if (!this.isValidInput(value)) {
            return this.oldInputValue;
        }
        return value;
    }
    // 根据精度和是否支持国际化，格式化数字
    formatValue(value) {
        if (Number.isNaN(value)) {
            return;
        }
        // https://angular.cn/api/common/DecimalPipe
        // digitsInfo: {minIntegerDigits}.{minFractionDigits}-{maxFractionDigits}
        // minIntegerDigits: 小数点前最小位数 默认为1
        // minFractionDigits: 小数点后最小位数 默认0
        // maxFractionDigits: 小数点后最大位数 默认3
        // tslint:disable-next-line:prefer-template
        const localeValue = TiLocaleFormat.formatNumber(value, this.numberFormat);
        if (this.localeable) {
            return this.document.activeElement === this.element ? TiLocaleFormat.deleteGroupSep(localeValue) : localeValue;
        }
        else { // 不支持国际化时，也可利用TiLocaleFormat.formatNumber精度处理能力
            return TiLocaleFormat.parseNumber(localeValue).toString();
        }
    }
    // 将国际化数字转换为标准化数字
    parseValue(value) {
        return this.localeable ? TiLocaleFormat.parseNumber(value) : parseFloat(value);
    }
    // 将国际化数字的千位分隔符去掉(输入框聚焦状态需要)
    deleteGroupSepValue(formatValue) {
        return this.localeable ? TiLocaleFormat.deleteGroupSep(formatValue) : formatValue;
    }
    /**
     * @ignore
     * 实现继承来自父类的方法
     * Sets the "value" property on the input element.
     * model->view
     */
    writeValue(value) {
        // writeValue()方法会执行两遍。第一遍为null, 第二遍为用户配置的数据。
        if (value === null) {
            return;
        }
        // 由于10.0.0及之前版本中开发者只能给ngModel传入空字符串时才能清空值，但是该组件ngModel应该是传入number类型，所以要清空时应该设置undefined。
        // 10.0.1版本开始进行纠正，为了兼容旧版本，设置空字符串时也能清空。
        if (value === undefined || value === '') {
            super.writeValue('');
            this.oldInputValue = '';
            this.oldModel = undefined;
            return;
        }
        let normalValue;
        if (Number.isNaN(parseFloat(value))) {
            if (this.oldModel === undefined) {
                super.writeValue('');
                this.oldInputValue = '';
            }
            else {
                const formatValue = this.formatValue(this.oldModel);
                super.writeValue(formatValue);
                this.oldInputValue = this.deleteGroupSepValue(formatValue);
            }
            normalValue = this.oldModel;
        }
        else {
            const formatValue = this.formatValue(value);
            super.writeValue(formatValue);
            this.oldInputValue = this.deleteGroupSepValue(formatValue);
            normalValue = this.parseValue(formatValue);
        }
        if (normalValue !== value) {
            if (Util.isUndefined(this.onChangeFn)) {
                // 在reactive-form中使用，初始化赋值调用writeValue时，
                // 此时registerOnChange还未被调用，onChangeFn还未被赋值，
                // 所以要使用setTimeout等onChangeFn被赋值后再调用
                setTimeout(() => {
                    this.changeModel(normalValue);
                }, 0);
            }
            else {
                this.changeModel(normalValue);
            }
        }
        else {
            this.oldModel = normalValue;
        }
    }
    /**
     * @ignore
     * Registers a function called when the control value changes
     * @param fn The callback function
     * 注册当控件接收到change事件之后，调用的函数fn
     * viewValue和model value值的同步
     */
    registerOnChange(fn) {
        this.onChangeFn = fn;
    }
    /**
     * @ignore
     * view -> model
     * 非法字符不能输入。如果是合法则更新，如果是非法，则设置为oldInputValue...
     */
    handleInput(value) {
        // IE9 cut delete backspace下支持这三种方式引起的改变。
        // text组件针对这三种方式做了兼容性处理，并且触发input事件
        // 所以 inputnumber无需再做兼容性处理
        this.parser(value);
    }
    parser(value) {
        const validationValue = this.getCorrectValue(value);
        if (!this.isValidInput(value)) {
            let cursorPos = this.element.selectionStart;
            const diff = value.length - validationValue.length;
            cursorPos = cursorPos - diff;
            this.renderer.setProperty(this.element, 'value', this.oldInputValue); // Sets the "value" property on the input element.
            this.element.setSelectionRange(cursorPos, cursorPos);
        }
        else {
            this.oldInputValue = validationValue;
            const parseValue = this.parseValue(validationValue);
            this.changeModel(Number.isNaN(parseValue) ? undefined : parseValue);
        }
    }
    /**
     * @ignore
     * 得到焦点数据标准化处理
     * @memberOf TiInputNumberDirective
     * renderer.setProperty: Implement this callback to set the value of a property of an element in the DOM.
     */
    focusFn() {
        if (this.element.value === '') {
            return;
        }
        // 为了得到各个浏览器下正确的光标位置，所以添加延时处理
        if (this.localeable) {
            setTimeout(() => {
                const start = this.element.selectionStart;
                const end = this.element.selectionEnd;
                if (end - start === this.element.value.length) {
                    this.renderer.setProperty(this.element, 'value', TiLocaleFormat.deleteGroupSep(this.element.value));
                    this.element.setSelectionRange(0, this.element.value.length);
                }
                else {
                    const groupSep = TiLocaleFormat.getNumberSymbol('Group');
                    const old = this.element.value;
                    const sub = old.substr(0, start);
                    const groupSepNum = sub.split(groupSep).length - 1;
                    this.renderer.setProperty(this.element, 'value', TiLocaleFormat.deleteGroupSep(this.element.value));
                    this.element.setSelectionRange(start - groupSepNum, start - groupSepNum);
                }
            }, 0);
        }
    }
    /**
     * @ignore
     * 失去焦点数字国际化处理
     * @memberOf TiInputNumberDirective
     */
    blurFn() {
        const value = this.parseValue(this.element.value);
        if (Number.isNaN(value)) {
            this.renderer.setProperty(this.element, 'value', '');
            this.oldInputValue = '';
            return;
        }
        const formatValue = this.formatValue(value);
        this.renderer.setProperty(this.element, 'value', formatValue);
        this.oldInputValue = this.deleteGroupSepValue(formatValue);
        const normalValue = this.parseValue(formatValue);
        if (value !== normalValue) {
            this.changeModel(normalValue);
        }
    }
    changeModel(model) {
        if (model !== this.oldModel) {
            this.onChangeFn(model);
            this.oldModel = model;
        }
    }
}
TiInputNumberDirective.decorators = [
    { type: Directive, args: [{
                // 指令元数据
                selector: '[tiNumber]',
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        // tslint:disable-next-line:no-forward-ref
                        useExisting: forwardRef(() => TiInputNumberDirective),
                        multi: true
                    }
                ],
                host: {
                    '(input)': 'handleInput($event.target.value)',
                    '(focus)': 'focusFn();',
                    '(blur)': 'blurFn()'
                }
            },] }
];
TiInputNumberDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiInputNumberDirective.propDecorators = {
    localeable: [{ type: Input }],
    format: [{ type: Input }]
};

class TiInputNumberModule {
}
TiInputNumberModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule],
                exports: [TiInputNumberDirective],
                declarations: [TiInputNumberDirective]
            },] }
];

/**
 * 数字微调组件
 *
 * <example-url>../tiny3demo/#/spinner/spinner-all</example-url>
 */
class TiSpinnerComponent extends TiFormComponent {
    constructor(hostRef, renderer2) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        /**
         * @ignore
         */
        this.method = {
            METHOD_ADD: 'add',
            METHOD_SUB: 'sub'
        };
        /**
         * 最大值，JS中能表示的整数范围是53位的，如果超过了这个范围的整数，进行一些运算时会出现错误，因此最大值为2^53
         */
        this.max = Math.pow(2, 53);
        /**
         * 最小值，JS中能表示的整数范围是53位的，如果超过了这个范围的整数，进行一些运算时会出现错误，因此最小值为-2^53
         */
        this.min = -Math.pow(2, 53);
        /**
         * 微调器的步长
         */
        this.step = 1;
        /**
         * 占位提示信息
         */
        this.placeholder = '';
        /**
         * @ignore
         *
         * 从10.0.1版本开始该接口不再开放。如果不想要组件根据最大最小值进行强制转换，那么不要设置最大最小值即可。
         *
         * 失去焦点是否支持根据最大最小值进行强制转换（默认值为true, 支持强转; 当用户配置为false时，不支持强制转换）
         */
        this.correctable = true;
        /**
         * 是否开启国际化。默认值为true,开启国际化功能; 当用户配置为false时，不支持国际化)
         */
        this.localeable = true;
        /**
         * 输入文本的最大长度， 默认值为20.
         */
        this.maxlength = 20;
        /**
         * @ignore
         * 当数据发生改变时，触发change事件
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.stepChange = new EventEmitter();
        this.numberFormat = '1.0-3'; // 整数位保留最小位数.小数位保留最小位数-小数位最大保留位置
    }
    // 组件声明周期钩子--start ↓
    ngOnInit() {
        super.ngOnInit();
        this.setFocusableElems([this.inputEle.nativeElement]);
        this.init();
    }
    init() {
        if (!TiLocaleFormat.isInvalidFormat(this.format)) {
            const precision = parseInt(this.format.slice(1), 10);
            // tslint:disable-next-line:prefer-template
            this.numberFormat = '1.' + precision + '-' + precision;
        }
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        this.setChanges(changes, 'max');
        this.setChanges(changes, 'min');
    }
    // 输入属性发生改变
    setChanges(changes, key) {
        if (changes[key] && !changes[key].isFirstChange()) {
            this[key] = parseFloat(changes[key].currentValue);
            if (Number.isNaN(this[key]) || this.min > this.max) {
                this[key] = parseFloat(changes[key].previousValue);
            }
            if (this.correctable && this.model !== undefined) {
                const model = this.getModelByMinMax(this.inputValue);
                if (model !== this.model) {
                    // error: Expression has changed after it was checked.
                    setTimeout(() => {
                        this.inputValue = model;
                        this.model = model;
                    }, 0);
                }
            }
        }
    }
    // 组件声明周期钩子--end
    // 实现ControlValueAccessor接口
    /**
     * @ignore
     * model --> view
     */
    writeValue(value) {
        if (value === null) {
            return;
        }
        super.writeValue(value);
        if (!Util.isUndefined(value)) {
            if (Number.isNaN(parseFloat(value))) {
                this.model = this.inputValue;
                return;
            }
            if (this.correctable) {
                const val = this.getModelByMinMax(value);
                this.model = val;
                this.inputValue = val;
                return;
            }
        }
        this.inputValue = value;
    }
    // 实现ControlValueAccessor接口--end
    /**
     * @ignore
     */
    blurFn() {
        let correctValue = this.inputValue;
        if (this.correctable && this.inputValue !== undefined) {
            correctValue = this.getModelByMinMax(this.inputValue);
        }
        const parseFormatValue = correctValue === undefined ? correctValue : parseFloat(this.formatValue(correctValue));
        if (parseFormatValue !== this.model) {
            this.model = parseFormatValue;
        }
        this.inputValue = this.model;
        this.onModelTouched(); // 校验 初次聚焦 后续聚焦失焦
    }
    /**
     * @ignore
     * description: Event emitter for producting the `ngModelChange` event after the view model updates.
     * ngModelChange 是ngModel指令的@Output.
     * 它在viewToModelUpdate函数中触发
     *
     */
    inputChange(value) {
        if (value !== undefined && (value < this.min || value > this.max)) {
            return;
        }
        const parseFormatValue = value === undefined ? value : parseFloat(this.formatValue(value));
        if (parseFormatValue !== this.model) {
            this.model = parseFormatValue;
        }
    }
    /**
     * 键盘上下键操作
     * @ignore
     */
    keydownFn(event) {
        if (this.disabled) {
            return;
        }
        if (event.keyCode === TiKeymap.KEY_ARROW_UP) {
            this.stepNumber(this.method.METHOD_ADD);
        }
        else if (event.keyCode === TiKeymap.KEY_ARROW_DOWN) {
            this.stepNumber(this.method.METHOD_SUB);
        }
    }
    /**
     * @ignore
     */
    stepNumberMousedown(e, method) {
        if (e.button === TiKeymap.MOUSE_MIDDLE_BUTTON || e.button === TiKeymap.MOUSE_RIGHT_BUTTON || this.disabled) {
            return;
        }
        // 如果是鼠标按下向下btn，输入框需要做获得光标的处理
        this.inputEle.nativeElement.focus();
        e.preventDefault(); // 目的是防止input失去焦点
        this.stepNumber(method);
    }
    stepNumber(method) {
        if ((this.inputValue >= this.max && method === this.method.METHOD_ADD) ||
            (this.inputValue <= this.min && method === this.method.METHOD_SUB)) {
            return;
        }
        this.stepChange.emit(method);
        // 当输入框中的值为空时，点击+,-，显示最小值。
        if (this.inputValue === undefined) {
            this.model = this.min;
            this.inputValue = this.model;
            return;
        }
        if (method === this.method.METHOD_ADD) {
            if (this.inputValue > this.max - this.step) {
                this.model = this.max;
                this.inputValue = this.model;
                return;
            }
            if (this.inputValue < this.min) {
                this.model = this.min;
                this.inputValue = this.model;
                return;
            }
        }
        else if (method === this.method.METHOD_SUB) {
            if (this.inputValue < this.min + this.step) {
                this.model = this.min;
                this.inputValue = this.model;
                return;
            }
            if (this.inputValue > this.max) {
                this.model = this.max;
                this.inputValue = this.model;
                return;
            }
        }
        this.model = this.accOperate(this.inputValue, this.step, method);
        this.inputValue = this.model;
    }
    // 组件交互方法集合--end
    // 根据最大最小值得到model值
    getModelByMinMax(curValue) {
        if (curValue < this.min) {
            return this.min;
        }
        if (curValue > this.max) {
            return this.max;
        }
        return curValue;
    }
    formatValue(value) {
        if (value === undefined) {
            return;
        }
        // https://angular.cn/api/common/DecimalPipe
        // digitsInfo: {minIntegerDigits}.{minFractionDigits}-{maxFractionDigits}
        // minIntegerDigits: 小数点前最小位数 默认为1
        // minFractionDigits: 小数点后最小位数 默认0
        // maxFractionDigits: 小数点后最大位数 默认3
        // tslint:disable-next-line:prefer-template
        const localeValue = TiLocaleFormat.formatNumber(value, this.numberFormat);
        return TiLocaleFormat.parseNumber(localeValue).toString();
    }
    // 根据步长、+/-进行数值计算
    accOperate(value, step, method) {
        let r1;
        let r2;
        let c;
        let m;
        let _value;
        let _step;
        // 计算 val 小数点后数字的位数
        const getLength = (val) => {
            return (String(val)).split('.')[1] ? (String(val)).split('.')[1].length : 0;
        };
        // 去除 val 中的 ‘.’
        const replacePeriod = (val) => {
            return Number((String(val)).replace('.', ''));
        };
        r1 = getLength(value);
        r2 = getLength(step);
        c = Math.abs(r1 - r2);
        m = Math.pow(10, Math.max(r1, r2));
        if (c > 0) {
            const cm = Math.pow(10, c);
            if (r1 > r2) {
                _value = replacePeriod(value);
                _step = replacePeriod(step) * cm;
            }
            else {
                _value = replacePeriod(value) * cm;
                _step = replacePeriod(step);
            }
        }
        else {
            _value = replacePeriod(value);
            _step = replacePeriod(step);
        }
        if (method === this.method.METHOD_ADD) {
            return (_value + _step) / m;
        }
        if (method === this.method.METHOD_SUB) {
            return (_value - _step) / m;
        }
        return undefined;
    }
}
TiSpinnerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-spinner',
                template: "<div [id]=\"appendId('sub')\" class=\"ti3-icon ti3-spinner-downicon ti3-icon-reduce\" \r\n(mousedown)=\"stepNumberMousedown($event, method.METHOD_SUB)\"\r\n[ngClass]=\"{'ti3-spinner-icon-disabled': inputValue <= min}\"></div>\r\n<div #inputBox class=\"ti3-spinner-input-box\">\r\n    <input #input [placeholder]=\"placeholder\" [id]=\"appendId('input')\" type=\"text\" [disabled]=\"disabled\"\r\n       (blur)=\"blurFn()\"\r\n       [(ngModel)]=\"inputValue\" (ngModelChange)=\"inputChange($event)\" (keydown) = \"keydownFn($event)\"\r\n       [format]=\"format\" [localeable] = \"localeable\"\r\n       class=\"ti3-spinner-input\" [maxlength]=\"maxlength\" noborder tiText tiNumber/> \r\n</div>\r\n<div [id]=\"appendId('add')\" class=\"ti3-icon ti3-spinner-upicon ti3-icon-add\" \r\n(mousedown)=\"stepNumberMousedown($event, method.METHOD_ADD)\"\r\n[ngClass]=\"{'ti3-spinner-icon-disabled': inputValue >= max}\"></div>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiSpinnerComponent)],
                styles: ["::ng-deep :root{--ti-spinner-inner-height:calc(var(--ti-input-height) - 2px)}:host{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block;height:var(--ti-input-height)!important;line-height:normal;position:relative;transition:border-color .15s;vertical-align:middle;white-space:normal;width:120px}:host:active{border-color:var(--ti-input-border-color-focus);cursor:pointer}:host:hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}:host[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-downicon,:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-input,:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-upicon,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-downicon,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-input,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-upicon,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-downicon,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-input,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-upicon,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-downicon,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-input,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-upicon{background-color:var(--ti-input-bg-color-error)}.ti3-spinner-input-box{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);box-sizing:border-box;color:var(--ti-input-text-color);ime-mode:disabled;left:var(--ti-spinner-inner-height);position:absolute;text-align:center;top:0;width:calc(100% - var(--ti-spinner-inner-height)*2)}.ti3-spinner-input-box .ti3-spinner-input{height:var(--ti-spinner-inner-height);line-height:var(--ti-spinner-inner-height);text-align:center;width:100%}.ti3-spinner-downicon,.ti3-spinner-upicon{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-common-color-icon-normal);line-height:var(--ti-spinner-inner-height);position:absolute;text-align:center;top:0;width:var(--ti-spinner-inner-height)}.ti3-spinner-downicon:not(.ti3-spinner-icon-disabled):hover,.ti3-spinner-upicon:not(.ti3-spinner-icon-disabled):hover{background-color:var(--ti-input-bg-color);color:var(--ti-common-color-icon-hover);cursor:pointer}.ti3-spinner-downicon.ti3-spinner-icon-disabled,.ti3-spinner-upicon.ti3-spinner-icon-disabled{background-color:var(--ti-input-bg-color-disabled);color:var(--ti-common-color-icon-disabled);cursor:not-allowed}.ti3-spinner-upicon{border-left:1px solid var(--ti-input-border-color);right:0}.ti3-spinner-downicon{border-right:1px solid var(--ti-input-border-color);left:0}:host[disabled]{background-color:var(--ti-input-bg-color-disabled);cursor:not-allowed}:host[disabled],:host[disabled]:hover{border-color:var(--ti-input-border-color-disabled)!important}:host[disabled] .ti3-spinner-input{background-color:var(--ti-input-bg-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed}:host[disabled] .ti3-spinner-downicon,:host[disabled] .ti3-spinner-upicon{border-color:var(--ti-input-border-color-disabled)}:host[disabled] .ti3-spinner-downicon:not(.ti3-spinner-icon-disabled),:host[disabled] .ti3-spinner-upicon:not(.ti3-spinner-icon-disabled){background-color:var(--ti-input-bg-color-disabled);color:var(--ti-common-color-icon-disabled);cursor:not-allowed}"]
            },] }
];
TiSpinnerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiSpinnerComponent.propDecorators = {
    format: [{ type: Input }],
    max: [{ type: Input }],
    min: [{ type: Input }],
    step: [{ type: Input }],
    placeholder: [{ type: Input }],
    correctable: [{ type: Input }],
    localeable: [{ type: Input }],
    maxlength: [{ type: Input }],
    stepChange: [{ type: Output }],
    inputEle: [{ type: ViewChild, args: ['input', { static: true },] }]
};

class TiSpinnerModule {
}
TiSpinnerModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiIconModule,
                    TiTextModule,
                    TiInputNumberModule
                ],
                exports: [TiSpinnerComponent],
                declarations: [TiSpinnerComponent]
            },] }
];

/**
 * steps步骤组件
 *
 * 点击可跳转和不可跳转两种方式（默认点击不跳转）
 *
 * <example-url>../tiny3demo/#/steps/steps-all</example-url>
 */
class TiStepsComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, iterableDiffers, zone) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.iterableDiffers = iterableDiffers;
        this.zone = zone;
        /**
         * 是否支持点击跳转功能，默认不支持
         */
        this.clickable = false;
        /**
         * 用户可指定要显示的属性值，默认显示label属性
         */
        this.labelKey = 'label';
        /**
         * 宽度是否自动撑满父容器。
         *
         * 不设置时默认各步骤间线宽60px，步骤确定后整体宽度固定；设置为true时，整体宽度会自适应撑满父容器，适用于在弹窗中使用的场景。
         */
        this.adaptive = false;
        /**
         * 当前步骤改变时的事件
         */
        this.activeStepChange = new EventEmitter();
        /**
         * 点击后用户可根据条件判断是否跳转:见测试用例
         */
        this.beforeStep = new EventEmitter();
        this.isInitLabelChange = true;
        this.explainTotalWidth = 0;
        // 设置每个步骤之间的横线的宽度
        this.setLineWidth = (width) => {
            this.explainTotalWidth = Util.isUndefined(width) ? this.getExplainTotalWidth() : width;
            this.lineRef.forEach((stepLine) => {
                this.renderer2.setStyle(stepLine.nativeElement, 'width', `calc((100% - ${this.explainTotalWidth}px) / ${this.steps.length - 1})`);
            });
        };
    }
    ngOnInit() {
        super.ngOnInit();
        if (!this.adaptive) {
            return;
        }
        // this.trackByLabelFn监听对象：可以深度监听
        this.stepsDiffer = this.iterableDiffers.find(this.steps)
            .create(this.trackByLabelFn);
        // 修复错误：ERROR ReferenceError: window is not defined
        if (typeof window === 'undefined') {
            return;
        }
        this.zone.runOutsideAngular(() => {
            this.windowResizeListener = this.renderer2.listen(window, 'resize', this.setLineWidth);
        });
    }
    ngDoCheck() {
        if (this.adaptive) {
            // 处理增删步骤
            const stepsDiffer = this.stepsDiffer.diff(this.steps);
            if (stepsDiffer) {
                this.labelChange = true;
            }
        }
    }
    ngAfterViewChecked() {
        // 需要判断当label变化时才计算线长
        if (this.adaptive && this.labelChange) {
            this.labelChange = false;
            this.setLineWidth();
            // 初始时在前几次的 ngAfterViewChecked 中计算文本宽度，生产环境清缓存场景下计算有点不准确(时机有点早)，但在初始时的后几次ngAfterViewChecked中计算的文本宽度是准确的。
            // TODO: 是否有更合适的时机计算(已验证使用MutationObserver也解决不了，在ngAfterViewChecked中加setTimeout(0)也解决不了)
            if (this.isInitLabelChange) {
                setTimeout(() => {
                    const explainTotalWidth = this.getExplainTotalWidth();
                    if (explainTotalWidth !== this.explainTotalWidth) {
                        this.setLineWidth(explainTotalWidth);
                    }
                }, 50); // 50ms是经验值
                this.isInitLabelChange = false;
            }
        }
    }
    ngOnDestroy() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    /**
     * @ignore
     * 每步的点击事件处理
     */
    onClick(step) {
        // 不支持点击跳转和当前项灰化时，不处理
        if (!this.clickable || step.disabled || this.activeStep === step) {
            return;
        }
        // 未定义beforeStep事件，直接跳转，定义beforeStep事件将当前点击项索引传出
        if (this.beforeStep.observers.length === 0) {
            this.activeStep = step;
            this.activeStepChange.emit(this.activeStep);
        }
        else {
            this.beforeStep.emit(step);
        }
    }
    getExplainTotalWidth() {
        let explainTotalWidth = 0;
        if (!Util.isUndefined(this.explainRef)) {
            this.explainRef.forEach((step) => {
                // 计算每步选择框和文字的总长度
                explainTotalWidth += step.nativeElement.offsetWidth;
            });
        }
        return explainTotalWidth;
    }
    /**
     * @ignore
     * Diff监听steps中label值的改变
     */
    trackByLabelFn(index, item) {
        return item.label;
    }
    /**
     * @ignore
     * ngFor 使用
     */
    trackByIndexFn(index) {
        return index;
    }
    /**
     * @ignore
     * 判断当前项的状态
     */
    getStepState(index) {
        const activedIndex = this.steps.indexOf(this.activeStep);
        if (index < activedIndex) {
            return 'complete';
        }
        else if (index === activedIndex) {
            return 'active';
        }
        else {
            return 'uncomplete';
        }
    }
}
TiStepsComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-steps',
                template: "<ul class=\"ti3-steps\" #stepRef [id]=\"appendId('list')\">\r\n    <ng-container *ngFor=\"let step of steps; let i=index; trackBy: trackByIndexFn\">\r\n        <li class=\"ti3-steps-line\" #line *ngIf=\"i > 0\"\r\n            [ngClass]=\"{'ti3-steps-complete': getStepState(i) === 'complete',\r\n                    'ti3-steps-active':getStepState(i) === 'active',\r\n                    'ti3-steps-uncomplete': getStepState(i) === 'uncomplete' && clickable && !step.disabled}\">\r\n        </li>\r\n\r\n        <li [id]=\"appendId(i)\" class=\"ti3-steps-explain\" #explain\r\n            [ngClass]=\"{'ti3-steps-complete': getStepState(i) === 'complete',\r\n                    'ti3-steps-active':getStepState(i) === 'active',\r\n                    'ti3-steps-disabled': getStepState(i) === 'uncomplete' && (step.disabled || !clickable),\r\n                    'ti3-steps-uncomplete': getStepState(i) === 'uncomplete' && clickable && !step.disabled,\r\n                    'ti3-steps-explain-clickable': clickable && !step.disabled}\"\r\n            (click)=\"onClick(step)\"\r\n            (keydown.enter)=\"onClick(step)\"\r\n            tiOutline\r\n            [attr.tabindex]=\"clickable && !step.disabled ? 0 : -1\">\r\n            <div class=\"ti3-steps-box\">\r\n                <div class=\"ti3-steps-box-number\">{{i + 1}}</div>\r\n            </div>\r\n            <div class=\"ti3-steps-text\" [ngStyle]=\"{'max-width': maxWidth}\" [id]=\"appendId('i_label')\"\r\n                tiOverflow [textContent]=\"step[labelKey]\" [maxLine]=\"2\">{{step[labelKey]}}</div>\r\n        </li>\r\n    </ng-container>\r\n</ul>\r\n\r\n",
                styles: ["::ng-deep :root{--ti-steps-box-border-width:1px;--ti-steps-box-size:20px;--ti-steps-line-height:1px;--ti-steps-line-width:60px;--ti-steps-transition-time:300ms}:host{display:block}.ti3-steps{padding:var(--ti-common-space-3x) 0;white-space:nowrap}.ti3-steps .ti3-steps-explain{display:inline-block;vertical-align:top}.ti3-steps .ti3-steps-explain .ti3-steps-box{-ms-box-sizing:border-box;border:var(--ti-steps-box-border-width) solid;border-radius:50%;box-sizing:border-box;display:inline-block;font-size:var(--ti-steps-number-font-size);height:var(--ti-steps-box-size);margin-left:var(--ti-common-space-2x);position:relative;width:var(--ti-steps-box-size)}.ti3-steps .ti3-steps-explain .ti3-steps-box:before{background-color:var(--ti-steps-box-bg-color-highlight);border-radius:50%;content:\"\";display:inline-block;height:var(--ti-steps-box-size);opacity:0;position:absolute;right:calc(-1*var(--ti-steps-box-border-width));top:calc(-1*var(--ti-steps-box-border-width));width:var(--ti-steps-box-size)}.ti3-steps .ti3-steps-explain .ti3-steps-box .ti3-steps-box-number{height:100%;line-height:calc(var(--ti-steps-box-size) - var(--ti-steps-box-border-width)*2 - 1px);position:absolute;text-align:center;width:100%}.ti3-steps .ti3-steps-explain .ti3-steps-text{display:inline-block;line-height:var(--ti-steps-box-size);margin:0 var(--ti-common-space-2x) 0 var(--ti-common-space-base);max-width:150px;vertical-align:top;white-space:normal;word-break:break-word}.ti3-steps li:first-child.ti3-steps-explain .ti3-steps-box{margin-left:0}.ti3-steps li:last-child.ti3-steps-explain .ti3-steps-text{margin-right:0}.ti3-steps .ti3-steps-explain-clickable{cursor:pointer}.ti3-steps .ti3-steps-line{background-color:var(--ti-steps-line-color);display:inline-block;font-size:0;height:var(--ti-steps-line-height);line-height:0;margin-top:calc((var(--ti-steps-box-size) - var(--ti-steps-line-height))/2);min-width:20px;vertical-align:top;width:var(--ti-steps-line-width)}.ti3-steps .ti3-steps-line:before{background-color:var(--ti-steps-line-color-highlight);content:\" \";display:inline-block;height:100%;width:0}.ti3-steps .ti3-steps-uncomplete.ti3-steps-line:before{transition:width var(--ti-steps-transition-time);width:0}.ti3-steps .ti3-steps-uncomplete.ti3-steps-explain .ti3-steps-box{border-color:var(--ti-steps-box-uncomplete);color:var(--ti-steps-box-uncomplete)}.ti3-steps .ti3-steps-uncomplete.ti3-steps-explain .ti3-steps-box:before{opacity:0;transform:scale(0);transition:transform var(--ti-steps-transition-time),opacity var(--ti-steps-transition-time)}.ti3-steps .ti3-steps-uncomplete.ti3-steps-explain .ti3-steps-text{-webkit-background-clip:text;background-image:linear-gradient(var(--ti-steps-text-highlight),var(--ti-steps-text-highlight));background-image:-ms-linear-gradient(top,transparent,transparent);background-repeat:no-repeat;background-size:0 100%;color:var(--ti-steps-text-uncomplete);transition:background-size var(--ti-steps-transition-time),color var(--ti-steps-transition-time)}.ti3-steps .ti3-steps-complete.ti3-steps-line:before{transition:width var(--ti-steps-transition-time);width:100%}.ti3-steps .ti3-steps-complete.ti3-steps-explain .ti3-steps-box{border-color:var(--ti-steps-box-highlight);color:var(--ti-steps-box-highlight)}.ti3-steps .ti3-steps-complete.ti3-steps-explain .ti3-steps-box:before{opacity:0;transform:scale(0);transition:transform var(--ti-steps-transition-time),opacity var(--ti-steps-transition-time)}.ti3-steps .ti3-steps-complete.ti3-steps-explain .ti3-steps-text{color:var(--ti-steps-text-highlight)}.ti3-steps .ti3-steps-active.ti3-steps-line:before{transition:width var(--ti-steps-transition-time);width:100%}.ti3-steps .ti3-steps-active.ti3-steps-explain .ti3-steps-box{border-color:var(--ti-steps-box-highlight);color:var(--ti-steps-box-number-active)}.ti3-steps .ti3-steps-active.ti3-steps-explain .ti3-steps-box:before{opacity:1;transform:scale(1);transition:transform var(--ti-steps-transition-time),opacity var(--ti-steps-transition-time)}.ti3-steps .ti3-steps-active.ti3-steps-explain .ti3-steps-text{-webkit-background-clip:text;background-image:linear-gradient(var(--ti-steps-text-highlight),var(--ti-steps-text-highlight));background-image:-ms-linear-gradient(top,transparent,transparent);background-repeat:no-repeat;background-size:100% 100%;color:var(--ti-steps-text-highlight);transition:background-size var(--ti-steps-transition-time),color var(--ti-steps-transition-time)}.ti3-steps .ti3-steps-disabled.ti3-steps-explain .ti3-steps-box{border-color:var(--ti-steps-box-disabled);color:var(--ti-steps-box-disabled)}.ti3-steps .ti3-steps-disabled.ti3-steps-explain .ti3-steps-box:before{display:none!important}.ti3-steps .ti3-steps-disabled.ti3-steps-explain .ti3-steps-text{color:var(--ti-steps-text-disabled);cursor:not-allowed}"]
            },] }
];
TiStepsComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: IterableDiffers },
    { type: NgZone }
];
TiStepsComponent.propDecorators = {
    steps: [{ type: Input }],
    clickable: [{ type: Input }],
    maxWidth: [{ type: Input }],
    labelKey: [{ type: Input }],
    activeStep: [{ type: Input }],
    adaptive: [{ type: Input }],
    activeStepChange: [{ type: Output }],
    beforeStep: [{ type: Output }],
    stepsRef: [{ type: ViewChild, args: ['stepRef',] }],
    lineRef: [{ type: ViewChildren, args: ['line',] }],
    explainRef: [{ type: ViewChildren, args: ['explain',] }]
};

class TiStepsModule {
}
TiStepsModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiOverflowModule,
                    TiIconModule,
                    CommonModule,
                    TiOutlineModule
                ],
                exports: [TiStepsComponent],
                declarations: [TiStepsComponent]
            },] }
];

/**
 * Switch开关组件
 *
 * 用于实现页面中的开关操作。
 *
 * <example-url>../tiny3demo/#/switch/switch-all</example-url>
 */
class TiSwitchComponent extends TiFormComponent {
    constructor() {
        super(...arguments);
        /**
         * 组件开关状态即将切换之前发出事件:。组件状态不改变，后续全权交给组件调用者处理。
         */
        this.beforeChange = new EventEmitter();
        this.initialized = false;
        this.hasAnimation = false;
    }
    ngOnInit() {
        // 基类中做了设置宿主id的操作
        super.ngOnInit();
        this.setFocusableElems([this.aRef.nativeElement]);
    }
    ngOnModelChange(value) {
        super.ngOnModelChange(value);
        if (value === null) { // 以 ngModel 的形式传入值时, writeValue首次传入null
            return;
        }
        if (this.initialized && !this.hasAnimation) { // 保证初始时没有动画
            this.renderer.addClass(this.aRef.nativeElement, 'ti3-switch-animation');
            this.hasAnimation = true;
        }
        this.initialized = true;
    }
    /**
     * 切换开关状态
     */
    toggle() {
        if (this.beforeChange.observers.length === 0) { // 用户未定义beforeChange
            this.model = !this.model;
        }
        else {
            this.beforeChange.emit(this);
        }
    }
    /**
     * @ignore
     * 点击事件
     */
    onClick() {
        if (!this.disabled) {
            this.toggle();
        }
    }
}
TiSwitchComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-switch',
                template: "<a #a\r\n    role=\"radio\"\r\n    class=\"ti3-switch\"\r\n    unselectable=\"on\"\r\n    href=\"javascript:void(0)\"\r\n    oncontextmenu=\"return false\"\r\n    (click)=\"onClick()\"\r\n    [ngClass]=\"{\r\n    'ti3-switch-off': !model, \r\n    'ti3-switch-on': model}\"\r\n    [id]=\"appendId('awrapper')\">\r\n    <div class=\"ti3-switch-track\"></div>\r\n    <span class=\"ti3-switch-pointer\"></span>\r\n</a>",
                host: {
                    '[class.ti3-switch-container]': 'true'
                },
                providers: [TiFormComponent.getValueAccessor(TiSwitchComponent)],
                styles: ["::ng-deep :root{--ti-switch-height:20px;--ti-switch-pointer-off-left:2px;--ti-switch-pointer-on-left:20px;--ti-switch-pointer-top:2px;--ti-switch-pointer-width:16px;--ti-switch-width:38px}.ti3-switch,:host.ti3-switch-container{display:inline-block;height:var(--ti-switch-height)}.ti3-switch{-ms-user-select:none;-webkit-user-select:none;cursor:pointer;position:relative;user-select:none;width:var(--ti-switch-width)}.ti3-switch .ti3-switch-track{border-radius:var(--ti-switch-height);height:100%;width:100%;z-index:0}.ti3-switch .ti3-switch-pointer,.ti3-switch .ti3-switch-track{-ms-box-sizing:border-box;box-sizing:border-box;position:absolute}.ti3-switch .ti3-switch-pointer{background:var(--ti-common-color-bg-white-normal);border-radius:50%;display:inline-block;height:var(--ti-switch-pointer-width);top:var(--ti-switch-pointer-top);width:var(--ti-switch-pointer-width);z-index:8}.ti3-switch.ti3-switch-off .ti3-switch-track{background:var(--ti-switch-track-off-bg-color)}.ti3-switch.ti3-switch-off .ti3-switch-pointer{left:var(--ti-switch-pointer-off-left)}.ti3-switch.ti3-switch-on .ti3-switch-track{background:var(--ti-switch-track-on-bg-color)}.ti3-switch.ti3-switch-on .ti3-switch-pointer{left:var(--ti-switch-pointer-on-left)}.ti3-switch[disabled]{cursor:not-allowed}.ti3-switch[disabled] .ti3-switch-pointer{background:var(--ti-common-color-bg-disabled)}.ti3-switch[disabled].ti3-switch-on .ti3-switch-track{background-color:var(--ti-common-color-bg-light-emphasize)}.ti3-switch[disabled].ti3-switch-off .ti3-switch-track{background-color:var(--ti-switch-track-bg-color-disabled)}.ti3-switch.ti3-switch-animation .ti3-switch-pointer,.ti3-switch.ti3-switch-animation .ti3-switch-track{transition:all .25s linear}"]
            },] }
];
TiSwitchComponent.propDecorators = {
    beforeChange: [{ type: Output }],
    aRef: [{ type: ViewChild, args: ['a', { static: true },] }]
};

class TiSwitchModule {
}
TiSwitchModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                exports: [TiSwitchComponent],
                declarations: [TiSwitchComponent]
            },] }
];

/**
 * TiTabs组件属于布局组件，通过该组件产品可以实现不同视图的切换功能。
 *
 * 其内部包含2个组件 TiTab 和 TiTabHeader
 *
 * <example-url>../tiny3demo/#/tab/tab-all</example-url>
 */
class TiTabsComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, tiRenderer, zone, document) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.tiRenderer = tiRenderer;
        this.zone = zone;
        this.document = document;
        /**
         * 1."justified"(默认): 下拉框的宽度与输入框的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于输入框的宽度)。例如："200px"。
         *
         * 10.0.1新增
         */
        this.panelWidth = '100px';
        /**
         * 面板对齐方式
         *
         * 10.0.1新增
         *
         */
        this.panelAlign = 'right';
        /**
         * 指定下拉项超长文本提示方向
         *
         * 10.0.1新增
         *
         */
        this.tipPosition = 'left';
        /**
         * @ignore
         */
        this.labelKey = 'header';
        /**
         * @ignore
         * 下拉项
         */
        this.options = [];
        /**
         * @ignore
         * TiTabs中包裹的所有的 TiTabComponent 集合
         */
        this.tabs = [];
        this.isNotVisibleInit = false; // 标志初始时是否可见
        /**
         * @ignore
         * TiTabComponent.ts中使用
         */
        this.destroyed = false;
        /**
         * @ignore
         * 是否显示滑动条slider（一级页签显示，二级/暗色页签不显示）
         * TiTabHeaderComponent.ts中使用
         */
        this.hasSlider = false;
        /**
         * @ignore
         * TiTabHeaderComponent.ts中使用
         */
        this.headerWidthChange = false;
        this.resolvedPromise = Promise.resolve(null);
    }
    /**
     * @ignore
     * 下拉选项变更时触发
     */
    onDroplistChange($event) {
        this.tabs.forEach((item) => {
            if (item.id === this.selectedTab.id) {
                this.setActiveValue(item, true);
                this.activeTab(item, true);
            }
        });
    }
    /**
     * @ignore
     * 点击下拉按钮打开下拉面板
     */
    showMorePanel(event) {
        this.dropListComp.show();
        event.stopPropagation();
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始化是否显示滑动条slider（一级页签显示，二级/暗色页签不显示）
        this.hasSlider = !this.nativeElement.hasAttribute('level2') && !this.nativeElement.hasAttribute('dark');
    }
    ngAfterViewInit() {
        super.ngAfterContentInit();
        if (this.hasSlider) {
            // 如果祖先元素中display为none，获取到的组件的宽度为0,元素不可见
            this.isNotVisibleInit = this.nativeElement.clientWidth === 0;
        }
        this.zone.runOutsideAngular(() => {
            // 点击documnet优惠信息窗口关闭
            this.onlistenClick = this.renderer2.listen(this.document, 'click', () => this.dropListComp.hide());
            if (typeof window === 'undefined') {
                return;
            }
            this.windowResizeListener = this.renderer2.listen(window, 'resize', () => {
                this.setMoreStyle();
                this.setTabStyle(true);
            });
        });
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        // 初始祖先元素中display为none，之后第一次由none变成可见时，需要重置silder
        if (this.isNotVisibleInit && this.nativeElement.clientWidth !== 0) {
            this.setTabStyle(false);
            this.isNotVisibleInit = false;
            return;
        }
        // 此处执行晚于TiTabHeaderComponent的ngAfterViewChecked
        if (this.headerWidthChange) {
            this.setTabStyle(false);
            this.headerWidthChange = false;
            this.setMoreStyle();
        }
    }
    ngOnDestroy() {
        this.destroyed = true;
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
        if (this.onlistenClick) {
            this.onlistenClick();
        }
    }
    /**
     * @ignore
     */
    setMoreStyle() {
        if (this.isOverflow()) {
            this.renderer2.setStyle(this.moreRef.nativeElement, 'display', 'block');
        }
        else {
            this.renderer2.setStyle(this.moreRef.nativeElement, 'display', 'none');
        }
    }
    /**
     * @ignore
     * TiTabComponent.ts 中调用
     */
    addTab(tab) {
        if (tab.active) {
            this.tabs.forEach((item) => {
                if (item.active) {
                    this.setActiveValue(item, false);
                }
            });
        }
        this.tabs.push(tab);
        const tabElements = Array.from(this.tabContentContainer.nativeElement.children);
        this.tabs.sort((a, b) => {
            return tabElements.indexOf(a.nativeElement) - tabElements.indexOf(b.nativeElement);
        });
        if (!tab.active && this.selectedTab
            && tabElements.indexOf(tab.nativeElement) < tabElements.indexOf(this.selectedTab.nativeElement)) {
            setTimeout(() => {
                this.setTabStyle(true);
            }, 0);
        }
        this.options = this.tabs;
        setTimeout(() => {
            this.setMoreStyle();
        }, 0);
    }
    /**
     * @ignore
     * TiTabComponent.ts 中调用
     */
    removeTab(tab) {
        const index = this.tabs.indexOf(tab);
        const length = this.tabs.length;
        this.tabs.splice(index, 1);
        setTimeout(() => {
            this.setMoreStyle();
        }, 0);
        // 删除当前激活状态的tab
        if (tab.active && length > 1) {
            const newActiveIndex = this.getNewActiveIndex(index, length);
            if (newActiveIndex !== -1) {
                this.setActiveValue(this.tabs[newActiveIndex], true);
                this.activeTab(this.tabs[newActiveIndex], true);
            }
            return;
        }
        // 删除的是非激活状态的tab,那么就在删除后的tabs数组中查找剩下的哪一个tab是激活状态，再设置激活状态；
        if (!tab.active) {
            setTimeout(() => {
                this.setTabStyle(true);
            }, 0);
        }
    }
    /**
     * @ignore
     * TiTabComponent.ts 中调用
     */
    activeTab(selectedTab, enableAnimate) {
        this.deActiveOthers(selectedTab);
        selectedTab.loaded = true;
        this.selectedTab = selectedTab;
        // 只有不是灰化状态时，才触发切换动效
        if (!selectedTab.disabled) {
            // 添加定时器，处理ngFor未渲染完毕，获取到得silder的位置不准确
            setTimeout(() => {
                // 初始化激活时没有动效
                this.setTabStyle(enableAnimate);
            }, 0);
        }
    }
    deActiveOthers(selectTab) {
        this.tabs.forEach((tab) => {
            if (tab.active && tab !== selectTab) {
                this.setActiveValue(tab, false);
            }
        });
    }
    /**
     * @ignore
     */
    click(tab) {
        if (!tab.disabled && !tab.active) {
            this.setActiveValue(tab, true);
            this.activeTab(tab, true);
        }
    }
    // 删除当前激活状态的tab后，需要激活下一个active tab
    getNewActiveIndex(index, length) {
        // 如果删除的当前激活状态的tab是最后一个，
        // 那么下一个激活的tab就是从右到左第一个不是禁用的tab
        if (index === length - 1) {
            for (let i = index - 1; i >= 0; i--) {
                if (!this.tabs[i].disabled) {
                    return i;
                }
            }
            // 如果删除的当前激活状态的tab不是最后一个，
            // 那么下一个激活的tab就是从左到右第一个不是禁用的tab
        }
        else {
            for (let i = index; i < this.tabs.length; i++) {
                if (!this.tabs[i].disabled) {
                    return i;
                }
            }
        }
        return -1;
    }
    // 设置页签样式
    setTabStyle(enableAnimate) {
        const targetTab = this.selectedTab && this.selectedTab.headNode.parentNode.parentNode;
        // 容错处理：没有获取到DOM时直接return；
        if (Util.isUndefined(targetTab) || !targetTab.classList.contains('ti3-tab-li')) {
            return;
        }
        // 获取该页签的偏移量
        const tagetLeft = targetTab.offsetLeft;
        // 需要显示滑动条时设置滑动条的样式及动效
        if (this.hasSlider) {
            // 修复SSR错误：ERROR TypeError: targetTab.getBoundingClientRect is not a function
            const targetWidth = typeof (targetTab.getBoundingClientRect) === 'function' ? parseFloat(targetTab.getBoundingClientRect().width
                .toFixed(2)) : 0;
            const transitionSet = enableAnimate ? 'left 0.1s ease-in-out' : 'none';
            this.tiRenderer.setStyles(this.slider.nativeElement, {
                transition: transitionSet,
                width: `${targetWidth}px`,
                left: `${tagetLeft}px`
            });
        }
        this.setTabScroll(targetTab, tagetLeft);
    }
    // 设置页签超长滑动动效
    setTabScroll(target, distance) {
        const moreWidth = this.moreRef && this.moreRef.nativeElement.offsetWidth;
        const tabsHeaderWidth = this.tabsHeaderRef && this.tabsHeaderRef.nativeElement.offsetWidth;
        const listWidth = this.tabsListRef && this.tabsListRef.nativeElement.offsetWidth;
        // 修复SSR错误：ERROR TypeError: this.tabsContainerRef.nativeElement.getBoundingClientRect is not a function
        if (typeof this.tabsContainerRef.nativeElement.getBoundingClientRect !== 'function') {
            return;
        }
        const tabsContainerClientRect = this.tabsContainerRef && this.tabsContainerRef.nativeElement.getBoundingClientRect();
        const targetClientRect = target.getBoundingClientRect();
        // 1、条件1和2：激活项能在当前屏范围内完全显示时
        // 2、尾部页签紧贴右侧时（页签动态删减，导致尾部页签没有紧贴右侧 #15412）
        // 同时满足，tabs无需滑动
        if (targetClientRect.x >= tabsContainerClientRect.x
            && targetClientRect.x <= tabsContainerClientRect.x + tabsContainerClientRect.width - moreWidth - targetClientRect.width
            && tabsHeaderWidth <= listWidth + moreWidth) {
            return;
        }
        let marginLeftDistance = distance;
        const maxDistance = this.tabsListRef.nativeElement.scrollWidth - tabsContainerClientRect.width + moreWidth;
        if (maxDistance > 0) {
            if (distance >= maxDistance) {
                marginLeftDistance = maxDistance;
            }
        }
        else {
            marginLeftDistance = 0;
        }
        this.renderer2.setStyle(this.tabsHeaderRef.nativeElement, 'transition', 'margin-left 0.1s ease-in-out');
        this.renderer2.setStyle(this.tabsHeaderRef.nativeElement, 'margin-left', -marginLeftDistance + 'px');
    }
    setActiveValue(tab, value) {
        // 双向数据绑定时，初始传入的值不合法立即修改并传出时会报错。
        // 此处参考ngModel源码setValue的处理，使用promise延后执行时序
        this.resolvedPromise.then(() => {
            tab.active = value;
            tab.activeChange.emit(value);
        });
    }
    /**
     * @ignore
     */
    trackByFn(index, item) {
        return item.headNode;
    }
    // 空间不足时，出现下拉面板
    isOverflow() {
        const headerWidth = this.tabsContainerRef.nativeElement.offsetWidth;
        const listWidth = this.tabsListRef.nativeElement.scrollWidth;
        const moreWidth = this.moreRef.nativeElement.offsetWidth;
        return headerWidth - moreWidth < listWidth;
    }
}
TiTabsComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tabs',
                template: "<div class='ti3-tabs-container1' #tabsContainer>\r\n    <div class='ti3-tabs-header' #tabsHeader>\r\n        <ul class=\"ti3-tabs\" #tabsList [id]=\"appendId('list')\">\r\n            <li class=\"ti3-tab-li\" style='display: inline-block;'\r\n                *ngFor=\"let tab of tabs; let i = index; trackBy: trackByFn\"\r\n                [ngClass]=\"{'ti3-tab-active': tab.active, disabled: tab.disabled}\">\r\n                <a href=\"javascript:void(0);\"\r\n                    oncontextmenu=\"return false\"\r\n                    (click)=\"click(tab)\"\r\n                    [tiInclude]=\"tab.headNode\"\r\n                    [id]=\"appendId(tab.id===undefined||tab.id===''?i:tab.id+'_a')\"\r\n                    [tabindex]=\"tab.disabled ? -1 : 0\"></a>\r\n            </li>\r\n        </ul>\r\n        <span class='ti3-tab-more' (click)='showMorePanel($event)' #more [id]=\"appendId('moreicon')\">\r\n            <ti-icon name=\"accordion-unfold\" #moreIcon></ti-icon>\r\n        </span>\r\n        <div class='ti3-tab-slider-container'>\r\n            <div #slider class=\"ti3-tab-slider\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class=\"ti3-tab-content\" #tabContentContainer>\r\n    <ng-content></ng-content>\r\n</div>\r\n<ti-droplist #droplist\r\n              [dominatorElem]=\"moreIconRef.nativeElement\"\r\n              [(ngModel)]=\"selectedTab\"\r\n              [options]='options'\r\n              [labelKey]=\"labelKey\"\r\n              [panelMaxHeight]=\"panelMaxHeight\"\r\n              [panelWidth]=\"panelWidth\"\r\n              [panelAlign]=\"panelAlign\"\r\n              [tipPosition]='tipPosition'\r\n              (ngModelChange)=\"onDroplistChange($event)\"\r\n              [id]=\"appendId('droplist')\">\r\n</ti-droplist>\r\n\r\n\r\n",
                host: {
                    '[class.ti3-tabs-container]': 'true' // 给host添加类ti-tabs-container替代之前的组件模板内部的最外层div
                },
                styles: ["::ng-deep :root{--ti-tab-dark-li-height:37px;--ti-tab-header-height:36px;--ti-tab-header-line-height:1.5;--ti-tab-second-level-header-height:28px;--ti-tab-second-level-header-line-height:calc(var(--ti-tab-second-level-header-height) - 2px);--ti-tab-second-level-header-margin-horizon:var(--ti-common-space-5x)}:host.ti3-tabs-container{display:block}.ti3-tab-content{border-top:1px solid var(--ti-tab-border-color)}.ti3-tabs{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-tab-header-text-color);font-size:0;height:var(--ti-tab-header-height);list-style:none;margin-bottom:0;padding-left:0;position:relative}.ti3-tabs:after,.ti3-tabs:before{-ms-box-sizing:border-box;box-sizing:border-box;content:\" \";display:table}.ti3-tabs:after{clear:both}.ti3-tabs>li{-ms-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:inline-block;font-size:var(--ti-tab-header-font-size);height:var(--ti-tab-header-height);line-height:var(--ti-tab-header-line-height);margin:0 var(--ti-common-space-5x);position:relative}.ti3-tabs>li:first-child{margin-left:0}.ti3-tabs>li>a{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-tab-header-text-color);display:block;height:var(--ti-tab-header-height);line-height:var(--ti-tab-header-line-height);padding:6px 0 var(--ti-common-space-2x);position:relative;text-decoration:none;transition:color .15s}.ti3-tabs>li:not(.disabled)>a:focus,.ti3-tabs>li:not(.disabled)>a:hover{border-bottom-color:transparent;color:var(--ti-tab-header-text-color-hover);outline:none;transition:color .2s}.ti3-tabs>li.ti3-tab-active:not(.disabled)>a{color:var(--ti-tab-header-text-color-active);cursor:default;font-weight:var(--ti-tab-header-text-color-active-font-weight)}.ti3-tabs>li.disabled>a{background-color:transparent;color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-tabs>li.disabled>a:focus{outline:none!important}.ti3-tab-slider-container{border-bottom:3px solid transparent;bottom:0;left:0;position:absolute;right:0}.ti3-tab-slider{-ms-box-sizing:border-box;border-bottom:var(--ti-tab-header-border-bottom-active);bottom:-3px;box-sizing:border-box;left:-50px;position:absolute;width:0}:host[level2] .ti3-tabs-container1{position:relative;top:1px}:host[level2] .ti3-tabs{height:var(--ti-tab-second-level-header-height)}:host[level2] .ti3-tabs .ti3-tab-li:not(:last-child):after{right:calc(-1*(var(--ti-tab-second-level-header-margin-horizon) + 1px))}:host[level2] .ti3-tabs+.ti3-tab-more+.ti3-tab-slider-container .ti3-tab-slider{border-bottom:none;display:none}:host[level2] .ti3-tabs>li{font-size:var(--ti-common-font-size-base);margin:0}:host[level2] .ti3-tabs>li,:host[level2] .ti3-tabs>li>a{height:var(--ti-tab-second-level-header-height);line-height:var(--ti-tab-second-level-header-line-height)}:host[level2] .ti3-tabs>li>a{-ms-box-sizing:border-box;border:1px solid transparent;box-sizing:border-box;color:var(--ti-tab-header-text-color);padding:0 var(--ti-common-space-3x)}:host[level2] .ti3-tabs>li:not(.disabled)>a:focus,:host[level2] .ti3-tabs>li:not(.disabled)>a:hover{color:var(--ti-tab-second-level-header-text-color-hover);outline:none}:host[level2] .ti3-tabs>li.ti3-tab-active:not(.disabled)>a{border-bottom-color:var(--ti-tab-border-color);border-color:var(--ti-tab-border-color) var(--ti-tab-border-color) var(--ti-common-color-bg-white-normal);color:var(--ti-tab-second-level-header-text-color-active);padding:0 var(--ti-common-space-3x)}:host[level2] .ti3-tabs>li.ti3-tab-active:not(.disabled),:host[level2] .ti3-tabs>li:last-child{margin-right:0}:host[level2] .ti3-tabs>li.disabled>a{background-color:transparent;color:var(--ti-common-color-text-disabled);cursor:not-allowed}:host[dark]>.ti3-tabs-container1 .ti3-tabs-header{background-color:var(--ti-tab-dark-bg-color)}:host[dark]>.ti3-tabs-container1 .ti3-tabs{height:40px;padding-top:3px}:host[dark]>.ti3-tabs-container1 .ti3-tabs .ti3-tab-li:not(:last-child):after{width:0}:host[dark]>.ti3-tabs-container1 .ti3-tabs+.ti3-tab-more{color:var(--ti-tab-dark-text-color);padding-right:20px;padding-top:3px}:host[dark]>.ti3-tabs-container1 .ti3-tabs+.ti3-tab-more:hover{color:var(--ti-common-color-bg-emphasize)}:host[dark]>.ti3-tabs-container1 .ti3-tabs+.ti3-tab-more+.ti3-tab-slider-container .ti3-tab-slider{border-bottom:none;display:none}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li{margin-left:0;margin-right:4px}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li>a{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-tab-dark-text-color);height:var(--ti-tab-dark-li-height);line-height:var(--ti-tab-dark-li-height);padding:0 var(--ti-tab-dark-padding-horizon);transition:background .15s ease-in}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li:not(.disabled)>a:focus,:host[dark]>.ti3-tabs-container1 .ti3-tabs>li:not(.disabled)>a:hover{background-color:var(--ti-tab-dark-bg-color-hover);border-radius:var(--ti-tab-dark-border-radius);color:var(--ti-tab-dark-text-color-hover);outline:none;transition:background .2s}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li.ti3-tab-active:not(.disabled)>a{background-color:var(--ti-tab-dark-bg-color-avtive);border-radius:var(--ti-tab-dark-border-radius);color:var(--ti-tab-dark-text-color-active);transition:background .25s}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li.disabled>a{background-color:transparent;color:var(--ti-tab-dark-color-disabled);cursor:not-allowed}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li:first-child{margin-left:20px}:host[dark]>.ti3-tabs-container1 .ti3-tabs>li:last-child{margin-right:0}:host[dark].ti3-tabs-container>.ti3-tab-content{border:none}:host[small] .ti3-tab-li{font-size:var(--ti-common-font-size-base);margin:0 var(--ti-common-space-10)}@keyframes tiFadeIn{0%{opacity:0}to{opacity:1}}.ti3-tabs{display:flex;flex-shrink:1;overflow:hidden;white-space:nowrap}.ti3-tab-more{cursor:pointer;display:none;padding-left:10px}.ti3-tab-more:hover{color:var(--ti-tab-header-text-color-hover)}.ti3-tabs-header{align-items:center;display:flex;justify-content:space-between;position:relative}.ti3-tabs-container1{overflow:hidden}.ti3-tab-head-no-outline{outline:none}"]
            },] }
];
TiTabsComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiRenderer },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiTabsComponent.propDecorators = {
    panelWidth: [{ type: Input }],
    panelAlign: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    tipPosition: [{ type: Input }],
    slider: [{ type: ViewChild, args: ['slider', { static: true },] }],
    tabContentContainer: [{ type: ViewChild, args: ['tabContentContainer', { static: true },] }],
    moreRef: [{ type: ViewChild, args: ['more', { static: true },] }],
    moreIconRef: [{ type: ViewChild, args: ['moreIcon', { static: true },] }],
    tabsListRef: [{ type: ViewChild, args: ['tabsList', { static: true },] }],
    tabsHeaderRef: [{ type: ViewChild, args: ['tabsHeader', { static: true },] }],
    tabsContainerRef: [{ type: ViewChild, args: ['tabsContainer', { static: true },] }],
    dropListComp: [{ type: ViewChild, args: ['droplist', { static: true },] }]
};

/**
 * TiTabComponent 是单个页签组件，包含了页签标题头指令TiTabHeader 和 该页签对应的内容部分
 *
 */
class TiTabComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, tabset) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.tabset = tabset;
        /**
         * 当前页签的激活状态发生改变时向外进行事件通知,传递的参数为 boolean 类型，表示当前页签是否是激活状态
         */
        this.activeChange = new EventEmitter();
        /**
         * @ignore
         * 记录此页签的内容区是否已经加载过
         */
        this.loaded = false;
    }
    ngOnInit() {
        super.ngOnInit();
        this.createHeadNode();
        this.tabset.addTab(this);
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        const activeObj = changes['active'];
        if (activeObj && activeObj.currentValue && this.tabset.selectedTab !== this && !this.disabled) {
            this.tabset.activeTab(this, !activeObj.firstChange);
        }
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        // 父容器TiTabs的OnDestroy执行晚于TiTab的OnDestroy，所以此处需要setTimeout来延时
        setTimeout(() => {
            if (this.tabset.destroyed) {
                return;
            }
            this.tabset.removeTab(this);
            // 如果没有tab，那么下划线隐藏
            if (this.tabset.tabs.length === 0) {
                this.tabset.tiRenderer.setStyles(this.tabset.slider.nativeElement, {
                    width: 0,
                    left: 0
                });
            }
        }, 0);
    }
    createHeadNode() {
        if (Util.isString(this.header)) {
            this.headNode = this.renderer2.createText(this.header);
        }
    }
}
TiTabComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tab',
                template: "<ng-content></ng-content>\r\n<ng-container *ngIf=\"contentTemplate && loaded\">\r\n    <ng-container *ngTemplateOutlet=\"contentTemplate\"></ng-container>\r\n</ng-container>\r\n",
                host: {
                    '[class.ti3-tab-pane]': 'true'
                },
                styles: [":host.ti3-tab-pane{animation-duration:.3s;animation-fill-mode:backwards;animation-timing-function:ease;display:none;padding-top:var(--ti-common-space-3x)}:host.ti3-tab-pane.ti3-tab-active{display:block}:host.ti3-tab-pane.active-remove{display:none!important}:host.ti3-tab-pane.active-add{animation-name:tiFadeIn}"]
            },] }
];
TiTabComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiTabsComponent }
];
TiTabComponent.propDecorators = {
    header: [{ type: Input }],
    disabled: [{ type: Input }],
    active: [{ type: Input }, { type: HostBinding, args: ['class.ti3-tab-active',] }],
    activeChange: [{ type: Output }],
    contentTemplate: [{ type: ContentChild, args: ['tiTabContent', /* TODO: add static flag */ { static: true },] }]
};

/**
 * TiTabHeaderComponent 是单个页签的标题头组件，其包裹的元素会作为当前页签的标题头
 *
 */
class TiTabHeaderComponent {
    constructor(tab, elementRef) {
        this.tab = tab;
        this.elementRef = elementRef;
    }
    ngAfterContentInit() {
        // 由于此处的AfterContentInit会比TiTabComponent组件的OnInit
        // 执行得晚，所以ti-tab-header中的内容会覆盖header接口传入的字符串值
        this.tab.headNode = this.elementRef.nativeElement;
        if (!this.tab.header) {
            // 处理自定义dom没有header接口时对应下拉面板展示
            this.tab.header = this.elementRef.nativeElement.innerText;
        }
    }
    ngAfterViewChecked() {
        if (!this.tab.tabset.hasSlider) {
            return;
        }
        if (Util.isUndefined(this.oldHeaderWidth)) {
            this.oldHeaderWidth = this.elementRef.nativeElement.offsetWidth;
            return;
        }
        const headerWidth = this.elementRef.nativeElement.offsetWidth;
        if (headerWidth !== this.oldHeaderWidth) {
            this.tab.tabset.headerWidthChange = true;
            this.oldHeaderWidth = headerWidth;
        }
    }
}
TiTabHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tab-header',
                template: "<ng-content></ng-content>",
                host: {
                    '[class.ti3-tab-head-no-outline]': 'true'
                }
            },] }
];
TiTabHeaderComponent.ctorParameters = () => [
    { type: TiTabComponent },
    { type: ElementRef }
];

class TiTabModule {
}
TiTabModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDroplistModule,
                    TiIconModule,
                    TiIncludeModule,
                    TiRendererModule
                ],
                exports: [TiTabsComponent, TiTabComponent, TiTabHeaderComponent],
                declarations: [TiTabsComponent, TiTabComponent, TiTabHeaderComponent]
            },] }
];

/**
 * TagsInput标签输入组件
 *
 * TagsInput组件主要实现了一个可以输入标签、可以联想选择标签的功能组件。
 *
 * <example-url>../tiny3demo/#/tagsinput/tagsinput-all</example-url>
 */
class TiTagsInputComponent extends TiFormComponent {
    constructor() {
        super(...arguments);
        /**
         * 设置联想词条列表的数据
         */
        this.suggestions = [];
        /**
         * 设置输入框提示,在设置提示内容，并且无选中项时显示
         */
        this.placeholder = '';
        /**
         * 设置下拉面板的宽度,默认与dominator对齐 'justified' | 'auto'| string
         */
        this.panelWidth = 'justified';
        /**
         * 支持指定属性作为显示文本
         */
        this.labelKey = 'label';
        /**
         * @ignore
         * input输入框的值
         */
        this.inputValue = ''; // 输入框内容
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        // 推荐在onInit()时调用setFocusableElems(), 但是ngFor/ngIf中的元素在ngAfterViewInit()才能获取到
        this.setFocusableElems([this.dominatorCom.nativeElement, this.inputRef.nativeElement]);
    }
    /**
     * @ignore
     * 处理select事件
     */
    onSelect(event) {
        this.model.push(event);
        this.model = this.model.concat();
        this.selectDrop.searchResult = this.getSuggestions(this.suggestions, this.model);
        // 清空输入框
        this.inputValue = '';
        // 选中项由一行变为两行时，需要重定位
        setTimeout(() => {
            this.selectDrop.rePosition();
        }, 0);
    }
    /**
     * @ignore
     * 处理点击Dominator事件
     */
    onClickDominator() {
        if (this.disabled) {
            return;
        }
        this.inputRef.nativeElement.focus();
    }
    /**
     * @ignore
     * 点击选中项的叉号:从选中项中移除当前选中项
     */
    onDelete(event) {
        this.inputRef.nativeElement.focus();
        // 选中项由两行变为一行时，需要重定位
        setTimeout(() => {
            this.selectDrop.rePosition();
        }, 0);
        this.selectDrop.searchResult = this.getSuggestions(this.suggestions, event.model);
    }
    /**
     * @ignore
     * 输入框失焦时，面板隐藏，根据文本框内容处理是否添加到选中项
     */
    onInputBlur() {
        this.selectDrop.hide();
        const value = this.inputValue;
        // 清空输入框
        this.inputValue = '';
        // 输入框为空时或者当前输入框内容对应的标签已经在选中列表中了
        if (value.trim() === '' || this.findFirstIndex(this.model, 'label', value) !== -1) {
            return;
        }
        // 将输入框内容添加到选中标签中
        this.addTagToSelected(value);
    }
    /**
     * @ignore
     * 处理input框聚焦事件
     */
    onInputFocus(event) {
        this.selectDrop.searchResult = this.getSuggestions(this.suggestions, this.model);
        // 视图绘制早于变量更新，变量更新后下拉定位不正确， 需要延时处理
        setTimeout(() => {
            this.showSelectDrop();
        }, 0);
    }
    /**
     * @ignore
     * 处理input输入框keyup快捷键功能
     */
    onInputKeyup(event) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.responseEnter(event);
        }
    }
    /**
     * @ignore
     * 处理input输入框keydown快捷键功能
     * 回删键只能在keydown中处理：因为回删时，在keydown时输入框为当前值，keyup时为删除后的值
     * 比如输入一个字符，回删，获取的应该是回删前的一个字符，而不是没有删除后的
     */
    onInputKeydown(event) {
        if (event.keyCode === TiKeymap.KEY_BACKSPACE) {
            this.responseBackspace(event);
        }
    }
    /**
     * @ignore
     * 输入框内容变化时的处理
     * @param inputValue
     */
    onInputChange(inputValue) {
        // 过滤出匹配项
        this.selectDrop.searchWordChange(inputValue);
        // 从匹配项中移除已选中项
        this.selectDrop.searchResult = this.getSuggestions(this.selectDrop.searchResult, this.model);
        // 当没有匹配项时面板隐藏
        if (this.selectDrop.searchResult.length === 0) {
            this.selectDrop.hide();
        }
    }
    /**
     * 处理input输入框enter键功能
     * @param event
     */
    responseEnter(event) {
        this.selectDrop.hide();
        // 获取输入框的值
        const value = this.inputValue;
        // 清空input框的内容
        this.inputValue = '';
        // 输入框为空时或者当前输入框内容对应的标签已经在选中列表中了
        if (value.trim() === '' || this.findFirstIndex(this.model, 'label', value) !== -1) {
            this.showSelectDrop();
            return;
        }
        // 将输入框内容添加到选中标签中
        this.addTagToSelected(value);
        // 将选中项与下拉选项对比，从下拉选项中提出选中项
        this.selectDrop.searchResult = this.getSuggestions(this.suggestions, this.model);
        this.showSelectDrop();
    }
    /**
     * 处理input输入框回删键功能
     * @param event
     */
    responseBackspace(event) {
        this.selectDrop.hide();
        // 面板关闭时
        if (!this.selectDrop.isShow) {
            this.showSelectDrop();
            // 选中项由两行变为一行时，需要重定位
            setTimeout(() => {
                this.selectDrop.rePosition();
            }, 0);
        }
        const value = this.inputRef.nativeElement.value;
        // 输入框值不为空字符串时
        if (value !== '') {
            return;
        }
        // 获取当前选中项的长度
        const modelLength = this.model.length;
        // 当前已经没有选中项时，不做处理
        if (modelLength === 0) {
            return;
        }
        const lastSelected = this.model[modelLength - 1];
        const index = this.suggestions.indexOf(lastSelected);
        // 从选中项中删除
        this.model.pop();
        this.model = this.model.concat();
        // 将要从选中项删除的最后一项是下拉选项中的一项时，将其添加到现有的下拉选项中;
        // 如果是用户自己创建的，则不放入下拉项中
        if (index !== -1) {
            this.selectDrop.searchResult = this.getSuggestions(this.suggestions, this.model);
        }
    }
    /**
     * 根据数组中属性找是否有匹配项
     * @param arr 需要匹配的数组
     * @param key 需要查找的属性
     * @param value 属性值
     * @returns
     */
    findFirstIndex(arr, key, value) {
        if (!(arr instanceof Array)) {
            return -1;
        }
        for (let i = 0; i < arr.length; i++) {
            if (arr[i][key] === value) {
                return i;
            }
        }
        return -1;
    }
    /**
     * 将输入框内容添加到选中标签中
     * @param inputValue 输入框的内容
     */
    addTagToSelected(inputValue) {
        const index = this.findFirstIndex(this.suggestions, 'label', inputValue);
        const newTag = index === -1 ? { id: inputValue, label: inputValue } : this.suggestions[index];
        this.model.push(newTag);
        this.model = this.model.concat();
    }
    /**
     * 从suggestions中删除选中项
     */
    getSuggestions(suggestions, selected) {
        const newSuggestions = !(suggestions instanceof Array) ? [] : suggestions.concat(); // 使用数组的concat方法，实现深拷贝
        let index;
        for (const select of selected) {
            index = newSuggestions.indexOf(select);
            if (index !== -1) { // 选中项如果在下拉列表中存在，则删除
                newSuggestions.splice(index, 1);
            }
        }
        return newSuggestions;
    }
    /**
     * @ignore
     * 展开面板时设置下拉选中项和hoverOption
     */
    showSelectDrop() {
        // 设置selectDrop的选中项
        this.selectDrop.listCom.model = undefined;
        // 显示下拉面板
        if (this.selectDrop.searchResult.length > 0) {
            this.selectDrop.show();
        }
        // 不设置待选中项
        this.selectDrop.listCom.hoverOption = undefined;
    }
}
TiTagsInputComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tags-input',
                template: "<ti-dominator\r\n                type=\"tagsinput\"\r\n                multiple=\"true\"\r\n                class=\"ti3-dominator-tagsinput\"\r\n                [id]=\"appendId('dominator')\"\r\n                [(ngModel)]=\"model\"\r\n                [disabled]= \"disabled\"\r\n                (delete)=\"onDelete($event)\"\r\n                (focus)=\"onClickDominator()\"\r\n                (click)=\"onClickDominator()\">\r\n                <ng-template let-item>\r\n                        <ng-container *ngTemplateOutlet=\"commonTemplate; context: {$implicit: item}\">\r\n                        </ng-container>\r\n                </ng-template>\r\n                <input  #input\r\n                        tiText\r\n                        noborder\r\n                        type=\"text\"\r\n                        autocorrect=\"off\"\r\n                        autocapitalize=\"off\"\r\n                        spellcheck=\"false\"\r\n                        [disabled]= \"disabled\"\r\n                        [placeholder]=\"model && model.length === 0 ? placeholder : ''\"\r\n                        [(ngModel)]=\"inputValue\"\r\n                        (ngModelChange)=\"onInputChange($event)\"\r\n                        [ngStyle]=\"{width: (model && model.length === 0) || (inputValue.length > 0) ? '100%' : '21px'}\"\r\n                        (focus)=\"onInputFocus($event)\"\r\n                        (blur)=\"onInputBlur()\"\r\n                        (keyup)=\"onInputKeyup($event)\"\r\n                        (keydown)=\"onInputKeydown($event)\">\r\n</ti-dominator>\r\n<ti-dropsearch\r\n                type=\"suggestion\"\r\n                [id]=\"appendId('droplist')\"\r\n                [labelKey]=\"labelKey\"\r\n                [panelWidth]=\"panelWidth\"\r\n                [options]=\"suggestions\"\r\n                [dominatorElem]=\"dominatorCom.nativeElement\"\r\n                [isShowAfterSelect]=\"true\"\r\n                (select)=\"onSelect($event)\">\r\n                <ng-template let-item let-i=index>\r\n                        <ng-container *ngTemplateOutlet=\"commonTemplate; context: {$implicit: item, index: i}\"></ng-container>\r\n                 </ng-template>\r\n</ti-dropsearch>\r\n\r\n<ng-template #commonTemplate let-item let-i=index>\r\n        <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item, index: i}\">\r\n                </ng-container>\r\n        </ng-container>\r\n        <ng-template #labelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n</ng-template>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiTagsInputComponent)],
                styles: [".ti3-compnent-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-dominator-tagsinput input[tiText]{-ms-box-sizing:border-box;background-color:transparent;box-sizing:border-box;color:var(--ti-common-color-text-primary);float:left;height:calc(var(--ti-input-height) - 4px);max-width:160px;padding:0 var(--ti-input-padding-horizontal)}"]
            },] }
];
TiTagsInputComponent.propDecorators = {
    suggestions: [{ type: Input }],
    placeholder: [{ type: Input }],
    panelWidth: [{ type: Input }],
    labelKey: [{ type: Input }],
    inputRef: [{ type: ViewChild, args: ['input', { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    selectDrop: [{ type: ViewChild, args: [TiDropsearchComponent, { static: true },] }]
};

/**
 *
 */
class TiTagsInputModule {
}
TiTagsInputModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    FormsModule,
                    TiDominatorModule,
                    TiDropsearchModule,
                    TiTextModule
                ],
                exports: [TiTagsInputComponent],
                declarations: [TiTagsInputComponent]
            },] }
];

/**
 * Textarea文本框组件
 *
 * 文本框组件基于原生textarea标签进行扩展，原生textarea加tiTextarea属性指令即为textarea组件。
 *
 * <example-url>../tiny3demo/#/textarea/textarea-all</example-url>
 */
class TiTextareaComponent extends TiAutofocusComponent {
    constructor(elementRef, renderer, zone, formControl, document) {
        super(elementRef, renderer);
        this.zone = zone;
        this.formControl = formControl;
        this.document = document;
        /**
         * 用来调整文本框大小，该属性提供了四个属性值:
         *
         * none(不可调整组件大小):
         *
         * vertical(仅可调整垂直方向的大小，即调整组件的高度)
         *
         * horizontal(仅可调节水平方向的大小，即调整组件的宽度)
         *
         * both(水平和垂直方向均可调节，宽高都可调节)
         */
        this.resize = 'both';
        // 用作拖动文本框大小
        this.options = {
            $target: undefined,
            storeWidth: 0,
            storeHeight: 0,
            mouseXPosition: 0,
            mouseYPosition: 0
        };
        // 默认最大最小宽高
        this.defaultStyle = {
            minWidth: 60,
            minHeight: 64,
            maxWidth: 1280,
            maxHeight: 9999
        };
        this.isFirstFocus = true; // 是否为第一次聚焦
        /**
         * @ignore
         * 绑定在document上的mouseMove事件
         */
        this.mouseMoveHandlerFn = ($event) => {
            if (this.element.disabled) {
                return;
            }
            // 拖动的动作应该是先mousedown，然后mousemove，因此先判断是否已经触发了mousedown
            if (this.options.mouseXPosition === 0 && this.options.mouseYPosition === 0 || !this.options.$target) {
                return;
            }
            this.mouseMove($event);
        };
        /**
         * @ignore
         * 绑定在document上的mouseUp事件
         */
        this.mouseUpHandlerFn = () => {
            if (this.element.disabled) {
                return;
            }
            // 解决问题：当拖动鼠标时，鼠标不在小三角上时，鼠标放开不会移除样式
            // 为确保鼠标弹起时, textarea的边框样式恢复默认:
            if (this.isResizing()) {
                this.renderer.removeClass(this.element, 'ti3-textarea-resize-border');
            }
            try {
                this.stopResize();
                this.toggleTextSelection(false);
            }
            catch (e) { }
        };
        this.element = elementRef.nativeElement; // 获取宿主元素
        this.attrs = this.element.attributes; // 可以根据属性名获取各个属性
        this.container = this.renderer.createElement('div'); // 创建div标签
        this.renderer.addClass(this.container, 'ti3-textarea-container');
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始化maxlength属性
        this.hasMaxlength = Util.isUndefined(this.attrs['maxlength']) ? false : true;
        // 原生不设置maxlength属性时该值为-1;
        this.maxLength = this.hasMaxlength ? this.element.maxLength : -1;
        // 文本框的值发生变化时触发
        // 使用ngModel初始赋值时，触发valueChanges。
        // 使用formControl初始赋值时，不会触发valueChanges。
        if (this.formControl) {
            this.formControl.valueChanges.subscribe((value) => {
                this.setCountLength();
            });
        }
        // 使用formControl初始赋值时，初始化不会触发valueChanges，所以此处额外执行一次。
        // 使用ngModel初始赋值时，此处通过this.element.value拿到的值为空字符串，无法正确显示当前输入内容的长度
        this.setCountLength();
    }
    ngAfterViewInit() {
        // 如果祖先元素中display为none，获取到的组件的宽度为0,元素不可见
        this.isVisibleInit = this.element.offsetWidth !== 0;
        if (this.isVisibleInit) {
            // 设置container的样式
            this.setContainerSize();
            // 初始化创建dom
            this.initFn();
        }
        // 将宿主元素的样式类移到container上
        this.setContainerClass();
        // maxLength接口添加样式
        this.setMaxLengthFn();
        // 处理resize功能
        this.resizeFn();
        // 上面执行完初始化dom后，调用父类的ngAfterViewInit去设置autofocus
        super.ngAfterViewInit();
    }
    ngAfterViewChecked() {
        // 初始祖先元素中display为none，之后第一次由none变成可见时，需要重置silder
        if (!this.isVisibleInit && this.element.offsetWidth !== 0) {
            this.setContainerSize();
            // 初始化创建dom
            this.initFn();
            this.isVisibleInit = true;
        }
        // 处理灰化功能
        if (this.element.disabled) {
            this.renderer.addClass(this.container, 'ti3-textarea-container-disable');
        }
        else {
            this.renderer.removeClass(this.container, 'ti3-textarea-container-disable');
        }
        // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return;
        }
        // 处理通过设置display的方式隐藏组件：内部生成的dom也需要隐藏
        if (getComputedStyle(this.element).display === 'none') {
            this.renderer.setStyle(this.container, 'display', 'none');
        }
        else {
            this.renderer.setStyle(this.container, 'display', 'block');
        }
    }
    // maxlength通过接口传值需触发重新判断，因为init函数中执行较早且只执行一次。
    ngDoCheck() {
        this.hasMaxlength = Util.isUndefined(this.attrs['maxlength']) ? false : true;
        this.maxLength = this.hasMaxlength ? this.element.maxLength : -1;
    }
    // 销毁组件时需要将内部生成dom也移除
    ngOnDestroy() {
        this.renderer.removeChild(this.renderer.parentNode(this.container), this.container);
        if (this.documentMouseMoveListener) {
            this.documentMouseMoveListener();
        }
        if (this.documentMouseUpListener) {
            this.documentMouseUpListener();
        }
    }
    /**
     * @ignore
     */
    onFocus() {
        // IE和火狐浏览器在首次autofoucus聚焦时会将光标移到文字起始位置，用户体验不好
        // 需要手动设置光标位置到行尾
        if (this.isFirstFocus && this.element.autofocus &&
            (TiBrowser.isFirefox() || TiBrowser.isIE())) {
            this.element.setSelectionRange(this.element.value.length, this.element.value.length);
        }
        this.isFirstFocus = false;
    }
    setContainerSize() {
        // 修正SSR错误：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return;
        }
        const containerHeight = getComputedStyle(this.element).height;
        const containerWidth = getComputedStyle(this.element).width;
        // 若服务在textarea上面设置margin外边距,会导致textarea所占的页面空间大于外框的宽高,所以要将textarea上设置的margin转移到外边框
        const containerMargin = this.element.style.margin;
        // 取掉宿主元素的margin属性:
        this.element.style.margin = '';
        // 设置this.container的width、height、margin
        this.renderer.setStyle(this.container, 'height', containerHeight);
        this.renderer.setStyle(this.container, 'width', containerWidth);
        this.renderer.setStyle(this.container, 'margin', containerMargin);
    }
    setContainerClass() {
        // 获取未经过angular解析后的属性需要在onint中处理：若服务在textarea添加class，则把其加到父容器上
        const cNames = this.element.className;
        if (cNames) {
            const cNameArr = this.element.className.split(' '); // 存在多个class
            for (const cName of cNameArr) {
                // 跟校验有关的样式是以"ng-"开头，如果转移到外部容器上会影响校验样式
                if (!/^ng-/.test(cName)) {
                    this.renderer.removeClass(this.element, cName);
                    this.renderer.addClass(this.container, cName);
                }
            }
        }
    }
    // 初始化创建dom
    initFn() {
        const pNode = this.renderer.parentNode(this.element); // 找到宿主元素父元素
        const nextNode = this.renderer.nextSibling(this.element); // 找到宿主元素的兄弟元素
        // 将宿主元素包裹在this.container里边：
        this.renderer.removeChild(pNode, this.element); // 从父元素中移除宿主元素
        this.renderer.appendChild(this.container, this.element); // 将宿主元素放入创建的div标签中
        this.renderer.insertBefore(pNode, this.container, nextNode);
        if (this.resize !== 'none') {
            this.moveNode(this.resizeIconRef.nativeElement);
        }
        if (this.hasMaxlength) {
            this.moveNode(this.eleCharacterRef.nativeElement);
        }
    }
    moveNode(node) {
        this.renderer.removeChild(this.element, node);
        this.renderer.appendChild(this.container, node);
    }
    // maxLength接口
    setMaxLengthFn() {
        // 添加字数限制与当前输入字数显示功能
        if (this.attrs['maxlength'] && !isNaN(this.maxLength)) {
            // 有maxlength限制时给外框div加上标志类 ti3-textarea-container-counter
            this.renderer.addClass(this.container, 'ti3-textarea-container-counter');
        }
        else {
            this.renderer.removeClass(this.container, 'ti3-textarea-container-counter');
        }
    }
    // resize接口
    resizeFn() {
        if (this.resize === 'none') {
            return;
        }
        this.textAreaMinWidth = this.getSizeNumber('minWidth');
        this.textAreaMinHeight = this.getSizeNumber('minHeight');
        this.textAreaMaxWidth = this.getSizeNumber('maxWidth');
        this.textAreaMaxHeight = this.getSizeNumber('maxHeight');
        // 清除textarea上的样式
        this.renderer.setStyle(this.element, 'minWidth', '');
        this.renderer.setStyle(this.element, 'minHeight', '');
        this.renderer.setStyle(this.element, 'maxWidth', '');
        this.renderer.setStyle(this.element, 'maxHeight', '');
        this.zone.runOutsideAngular(() => {
            // resizeIconRef模板的mousedown事件
            this.renderer.listen(this.resizeIconRef.nativeElement, 'mousedown', ($event) => {
                this.renderer.addClass(this.element, 'ti3-textarea-resize-border'); // 拖拽时边框颜色为聚焦时
                this.options.$target = $event.target;
                this.options.mouseXPosition = $event.pageX;
                this.options.mouseYPosition = $event.pageY;
                // 在拖动前获取当前文本框最新的高度、宽度
                this.updateTextAreaSize();
                // 给页面设置不可选样式，避免拖动时页面出现被选中的蓝色区域
                this.toggleTextSelection(true);
            });
            // resizeIconRef模板的mouseup事件
            this.renderer.listen(this.resizeIconRef.nativeElement, 'mouseup', ($event) => {
                this.renderer.removeClass(this.element, 'ti3-textarea-resize-border');
            });
            this.documentMouseMoveListener = this.renderer.listen(this.document, 'mousemove', this.mouseMoveHandlerFn);
            this.documentMouseUpListener = this.renderer.listen(this.document, 'mouseup', this.mouseUpHandlerFn);
        });
    }
    setCountLength() {
        if (this.hasMaxlength) {
            this.countLength = this.element.value.length;
            // safari浏览器回车键是按两个字计算
            if (TiBrowser.isSafari()) {
                this.countLength = this.countLength + this.element.value.split('\n').length - 1;
            }
        }
    }
    // 拖动函数
    mouseMove(event) {
        // 阻止调整文本框大小时文本框聚焦
        event.preventDefault();
        const width = this.options.storeWidth;
        const height = this.options.storeHeight;
        const horizonWidth = event.pageX - this.options.mouseXPosition;
        const verticalHeight = event.pageY - this.options.mouseYPosition;
        if (this.resize !== 'vertical' && (width + horizonWidth) >= this.textAreaMinWidth
            && (width + horizonWidth) < this.textAreaMaxWidth) {
            // 更新textarea宽度
            this.options.storeWidth += horizonWidth;
            // 调整width
            this.renderer.setStyle(this.container, 'width', `${this.options.storeWidth}px`);
        }
        if (this.resize !== 'horizontal' && (height + verticalHeight) >= this.textAreaMinHeight
            && (height + verticalHeight) < this.textAreaMaxHeight) {
            // 更新textarea高度
            this.options.storeHeight += verticalHeight;
            this.renderer.setStyle(this.container, 'height', `${this.options.storeHeight}px`);
        }
        // 更新光标位置
        this.options.mouseXPosition = event.pageX;
        this.options.mouseYPosition = event.pageY;
    }
    stopResize() {
        this.options.mouseXPosition = 0;
        this.options.mouseYPosition = 0;
        this.updateTextAreaSize();
        this.options.$target = null;
    }
    // 获取min-width、min-height等的样式值
    getSizeNumber(value) {
        const val = this.element.style[value]; // 可实现获取样式
        if (val !== 'none' && val !== '') {
            return parseFloat(val.replace(/px/, ''));
        }
        return this.defaultStyle[value];
    }
    // 在拖动前获取当前文本框最新的高度、宽度
    updateTextAreaSize() {
        this.options.storeWidth = this.container.clientWidth;
        this.options.storeHeight = this.container.clientHeight;
    }
    // 给页面设置不可选样式，避免拖动时页面出现被选中的蓝色区域
    toggleTextSelection(toggle) {
        const body = this.document.getElementsByTagName('body');
        if (toggle) {
            this.renderer.addClass(body[0], 'ti3-unselectable');
            this.renderer.setAttribute(body[0], 'unselectable', 'on');
        }
        else {
            this.renderer.removeClass(body[0], 'ti3-unselectable');
            this.renderer.removeAttribute(body[0], 'unselectable');
        }
    }
    isResizing() {
        return this.element.className.indexOf('ti3-textarea-resize-border') > -1;
    }
}
TiTextareaComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiTextarea]',
                template: "<span #resize *ngIf=\"resize !== 'none'\" class=\"ti3-textarea-resize-icon\" ></span>\r\n<span #maxlength *ngIf=\"hasMaxlength\" class=\"ti3-textarea-counter\" [id]=\"appendId('max_length')\">\r\n    <span #charactersCount [ngClass]=\"{'ti3-textarea-counter-count': countLength > 0}\">{{countLength | tiFormatNum}}</span>/{{maxLength | tiFormatNum}}</span>",
                host: {
                    '(focus)': 'onFocus()'
                },
                encapsulation: ViewEncapsulation.None,
                styles: [":root{--ti-textarea-counter-height:16px;--ti-textarea-counter-margin-top:2px}textarea.ng-invalid.ng-dirty:not([tiBlurCheck])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-dirty:not([tiBlurCheck])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-touched:not([tiBlurCheck])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-touched:not([tiBlurCheck])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-error)!important}.ti3-textarea-container{display:inline-block;line-height:normal;min-height:64px;overflow:hidden;position:relative;vertical-align:middle}.ti3-textarea-container>textarea[tiTextarea]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);height:100%!important;outline:none;overflow-x:hidden;padding:var(--ti-textarea-padding-vertical) var(--ti-input-padding-horizontal);resize:none!important;transition:border-color .15s;vertical-align:middle;width:100%!important}.ti3-textarea-container>textarea[tiTextarea]:disabled{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-hover)}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus{border-color:var(--ti-input-border-color-focus);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-focus)}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border{border-color:var(--ti-input-border-color-focus);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-focus)}.ti3-textarea-container>.ti3-textarea-resize-icon{bottom:1px;cursor:nw-resize;height:10px;position:absolute;right:1px;width:10px}.ti3-textarea-container>.ti3-textarea-resize-icon:before{bottom:-2px;height:8.4px;right:-2px;width:8.4px}.ti3-textarea-container>.ti3-textarea-resize-icon:after,.ti3-textarea-container>.ti3-textarea-resize-icon:before{border-bottom:1px solid var(--ti-input-border-color);content:\"\";display:block;position:absolute;transform:rotate(135deg)}.ti3-textarea-container>.ti3-textarea-resize-icon:after{bottom:0;height:4.2px;right:0;width:4.2px}.ti3-textarea-container>.ti3-textarea-counter{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);box-sizing:border-box;color:var(--ti-textarea-counter-text-color);display:block;height:var(--ti-textarea-counter-height);line-height:var(--ti-textarea-counter-height);margin-top:var(--ti-textarea-counter-margin-top);position:absolute;right:0;text-align:right}.ti3-textarea-container>.ti3-textarea-counter>.ti3-textarea-counter-count{color:var(--ti-textarea-counter-inputed-text-color)}.ti3-textarea-container.ti3-textarea-container-counter>textarea[tiTextarea]{height:calc(100% - var(--ti-textarea-counter-height) - var(--ti-textarea-counter-margin-top))!important}.ti3-textarea-container.ti3-textarea-container-counter>.ti3-textarea-resize-icon{bottom:calc(var(--ti-textarea-counter-height) + var(--ti-textarea-counter-margin-top))}.ti3-unselectable{-ms-user-select:none;-webkit-user-select:none;user-select:none}.ti3-textarea-container-disable>span.ti3-textarea-resize-icon{cursor:not-allowed}"]
            },] }
];
TiTextareaComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone },
    { type: NgControl, decorators: [{ type: Optional }] },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiTextareaComponent.propDecorators = {
    resize: [{ type: Input }],
    resizeIconRef: [{ type: ViewChild, args: ['resize',] }],
    eleCharacterRef: [{ type: ViewChild, args: ['maxlength',] }],
    charactersCountRef: [{ type: ViewChild, args: ['charactersCount',] }]
};

/**
 * @ignore
 * TiFormatNumPipe 对textarea字数统计的数字进行国际化处理
 *
 */
class TiFormatNumPipe {
    constructor() {
        this.numberFormat = '1.0-0'; // 整数位保留最小位数.小数位保留最小位数-小数位最大保留位置
    }
    transform(value) {
        return TiLocaleFormat.formatNumber(value, this.numberFormat);
    }
}
TiFormatNumPipe.decorators = [
    { type: Pipe, args: [{ name: 'tiFormatNum' },] }
];

class TiTextareaModule {
}
TiTextareaModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                ],
                exports: [TiTextareaComponent],
                declarations: [TiTextareaComponent, TiFormatNumPipe]
            },] }
];

/**
 *
 * 用于封装给树组件 [TiTreeComponent]{@link ../components/TiTreeComponent.html}
 * 提供公共方法，包括增、删、改、查、选中、取消选中、遍历、筛选、获取选中项等操作
 */
class TiTreeUtil {
    /**
     * 根据某node节点查找其父节点
     * @param  data 所有节点数据
     * @param node 已知node节点
     */
    static getParentNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        for (const item of data) {
            if (!TiTreeUtil.isLeaf(item)) {
                if (item.children.indexOf(node) !== -1) {
                    return item;
                }
                else {
                    const result = TiTreeUtil.getParentNode(item.children, node);
                    if (result) {
                        return result;
                    }
                }
            }
        }
    }
    /**
     * 遍历整个树
     * @param data 所有节点数据
     * @param traverseFn 对各个节点执行的操作
     */
    static traverse(data, traverseFn) {
        if (!Util.isFunction(traverseFn) || !Array.isArray(data)) {
            return;
        }
        for (const item of data) {
            traverseFn(item);
            if (!TiTreeUtil.isLeaf(item)) {
                TiTreeUtil.traverse(item.children, traverseFn);
            }
        }
    }
    /**
     * 多选树，更新各节点的选中状态。
     * 适用场景：手动添加或删除若干节点，当前节点的兄弟节点和父节点的选中状态不一致。
     * 10.0.1 新增
     * @param data  所有节点数据
     */
    static updateChecked(data) {
        TiTreeUtil.check(data);
    }
    /**
     * 检查但前数据的多选状态
     * @param data 当前节点集合
     * @param allData 全部数据集合
     */
    static check(data, allData) {
        let resultData;
        // 如果不传allData，data 是所有数据，此函数递归调用，data之后不是全部数据
        resultData = !allData ? data : allData;
        for (const item of data) {
            if (!TiTreeUtil.isLeaf(item)) {
                if (TiTreeUtil.isLeafsParentNode(item)) {
                    // 根据子叶子节点计算当前节点的复选状态
                    const computedChecked = TiTreeUtil.computeChecked(item);
                    if (computedChecked !== item.checked) {
                        item.checked = computedChecked;
                        if (computedChecked === true) {
                            TiTreeUtil.selectParents(item, resultData, true);
                        }
                        else {
                            TiTreeUtil.deSelectParents(item, resultData);
                        }
                    }
                }
                else {
                    TiTreeUtil.check(item.children, resultData);
                }
            }
        }
    }
    /**
     * 当前节点是否是叶子节点的父节点，
     * 因为更新节点的选中状态时，根据叶子节点的选中状态计算出父节点的选中状态，再更新父节点的选中状态。
     * @param node 当前节点
     */
    static isLeafsParentNode(node) {
        if (!Array.isArray(node.children)) {
            return false;
        }
        else {
            for (const child of node.children) {
                if (Array.isArray(child.children)) {
                    return false;
                }
            }
            return true;
        }
    }
    /**
     * 根据子节点的多选状态，计算出当前节点的多选状态
     * @param node 当前节点
     */
    static computeChecked(node) {
        const childrens = node.children;
        let selectedNum = 0;
        let unSelectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true) {
                selectedNum++;
            }
            else if (!child.checked) { // false和undefined 两种
                unSelectedNum++;
            }
        }
        if (selectedNum === childrens.length) {
            return true;
        }
        else if (unSelectedNum === childrens.length) {
            return false;
        }
        else {
            return 'indeterminate';
        }
    }
    /**
     * 添加节点
     * @param data 所有节点数据
     * @param node  需要添加的节点：一个或多个节点
     * @param index  添加的位置: -1表示从尾部追加
     * @param pNode 指定要添加的节点的父节点，如果没有指定的话默认添加到根节点
     */
    static addNode(data, node, index, pNode) {
        const k = parseInt(index, 10);
        if (isNaN(k) || !Array.isArray(data)) {
            return;
        }
        const nodes = Array.isArray(node) ? node : [node];
        // 当没有指定父节点时，默认将节点添加到根节点
        if (!pNode) {
            const resuleIndex = index === -1 ? data.length : index;
            for (let i = 0; i < nodes.length; i++) {
                data.splice(resuleIndex + i, 0, nodes[i]);
            }
            return;
        }
        // 如果父节点是叶子节点时，给叶子节点添加children数组
        if (TiTreeUtil.isLeaf(pNode)) {
            pNode.children = [];
        }
        // 根据Index值，将node插入指定位置
        if (index === -1) {
            pNode.children = pNode.children.concat(nodes); // 返回值为新数组
        }
        else {
            for (let j = 0; j < nodes.length; j++) {
                pNode.children.splice(index + j, 0, nodes[j]);
            }
        }
    }
    /**
     * 删除一个节点
     * @param  data 所有节点数据
     * @param  node  节点
     */
    static removeNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        // 找到不匹配搜索内容的叶子节点并删除。为了避免要删除的元素在数组中的索引改变，从后向前循环
        for (let i = data.length - 1; i >= 0; i--) {
            if (data[i] === node) {
                TiTreeUtil.deleteArr(data, i);
                return;
            }
            if (!TiTreeUtil.isLeaf(data[i])) {
                TiTreeUtil.removeNode(data[i].children, node);
            }
        }
    }
    // 3.0.3 selectNode/unSelectNode第三个参数：是否单选, 改为是否多选。已确认无人使用。
    // TODO：这两个函数的重复代码，可以合并
    /**
     * 选中某个节点
     * @param  data 所有节点数据
     * @param  node  节点
     * @param  multiple 是否多选模式
     */
    static selectNode(data, node, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        if (!multiple) { // 单选模式
            TiTreeUtil.traverse(data, (travNode) => {
                travNode.checked = false; // 清空所有的选中项
            });
            node.checked = true; // 将当前项置为选中
        }
        else { // 多选
            TiTreeUtil.selectAllChildren(node); // 先置当前节点选中，如果当前节点是非叶子节点 递归让其子节点全部选中
            TiTreeUtil.selectParents(node, data, true); // 设置父节点选中情况
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * 取消选中某个节点
     * @param data 所有节点数据
     * @param node  节点
     * @param multiple 是否多选模式
     */
    static deSelectNode(data, node, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        if (!multiple) {
            TiTreeUtil.traverse(data, (travNode) => {
                travNode.checked = false; // 清空所有的选中项
            });
        }
        else {
            TiTreeUtil.deSelectAllChildren(node);
            TiTreeUtil.deSelectParents(node, data);
        }
    }
    /**
     * 展开id所有父节点
     * @param  data 所有节点数据
     * @param  node  节点
     */
    static expandNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        let num = 0;
        let result = false;
        for (const item of data) {
            if (item === node) {
                num++;
            }
            else if (!TiTreeUtil.isLeaf(item)) {
                result = TiTreeUtil.expandNode(item.children, node);
                if (result) {
                    item.expanded = true;
                    num++;
                }
            }
        }
        return (num > 0);
    }
    /**
     * 根据用户传入的方法筛选节点的数据
     * @param data 所有节点数据
     * @param  matchFn 用户传入匹配节点的方法
     * @returns 是否找到
     */
    static search(data, matchFn) {
        if (!Util.isFunction(matchFn) || !Array.isArray(data)) {
            return false;
        }
        let findNum = 0;
        let isFind = false;
        // 找到不匹配搜索内容的叶子节点并删除。为了避免要删除的元素在数组中的索引改变，从后向前循环
        for (let i = data.length - 1; i >= 0; i--) {
            if (!matchFn(data[i]) && !TiTreeUtil.isLeaf(data[i])) { // 未匹配到且为父节点
                isFind = TiTreeUtil.search(data[i].children, matchFn);
                if (isFind) {
                    findNum++;
                }
                else {
                    TiTreeUtil.deleteArr(data, i);
                }
            }
            else if (matchFn(data[i])) { // 匹配到
                findNum++;
            }
            else { // 未匹配到且为叶子节点
                TiTreeUtil.deleteArr(data, i);
            }
        }
        return (findNum > 0);
    }
    /**
     * 获取选中项
     * @param data 所有节点数据
     * @param  onlySelectLeaf 选中项中是否只包含叶子节点
     * @param  multiple 是否多选模式
     */
    static getSelectedData(data, onlySelectLeaf, multiple) {
        // 每次遍历之前需要清空当前选中项列表
        TiTreeUtil.selectedData = [];
        TiTreeUtil.querySelectedNode(data, onlySelectLeaf, multiple);
        return TiTreeUtil.selectedData;
    }
    /**
     * @ignore
     * @description 根据整棵树的节点数据，查询所有选中项，并更新selectedData
     * @param data 全部节点数据
     * @param onlySelectLeaf 全部节点数据
     */
    static querySelectedNode(data, onlySelectLeaf, multiple) {
        let tempNode;
        for (let i = 0; i < data.length; i++) {
            tempNode = data[i];
            if (TiTreeUtil.checkedParentNode(tempNode)) { // 父节点半选或选中
                TiTreeUtil.pnode.push(tempNode);
                TiTreeUtil.querySelectedNode(tempNode.children, onlySelectLeaf, multiple);
                // 单选情况下仅查找到第一个选中的叶子节点即可
                if (!multiple) {
                    break;
                }
            }
            else if (TiTreeUtil.checkedLeafNode(tempNode)) { // 叶子节点选中
                TiTreeUtil.selectedData.push(tempNode);
                if (!onlySelectLeaf) {
                    tempNode.parent = TiTreeUtil.pnode.concat();
                    // 单选情况下仅查找到第一个选中的叶子节点即可
                    if (!multiple) {
                        TiTreeUtil.pnode.splice(0, TiTreeUtil.pnode.length);
                        break;
                    }
                }
            }
            // 遍历到最后一项时将父节点从pnode中移除
            if (i === data.length - 1) {
                TiTreeUtil.pnode.pop();
            }
        }
    }
    /**
     * @ignore
     * @description 判断节点node是否是一个处于选中或半选状态的父节点
     * @param node 节点数据
     */
    static checkedParentNode(node) {
        return (node.checked === true || node.checked === 'indeterminate') && !TiTreeUtil.isLeaf(node);
    }
    /**
     * @ignore
     * @description 判断节点node是否是一个处于选中状态的叶子节点
     * @param node 节点数据
     */
    static checkedLeafNode(node) {
        return (node.checked === true) && (TiTreeUtil.isLeaf(node));
    }
    /**
     * @ignore
     * 判断是否为叶子节点
     */
    static isLeaf(item) {
        return !(Util.isArray(item.children));
    }
    /**
     * @ignore
     * 从数组arr中删除下标为index的节点
     */
    static deleteArr(arr, index) {
        arr.splice(index, 1);
    }
    // TODO: checked传入false时，与deSelectParents有什么区别？可以合并么？
    /**
     * @ignore
     * 当子节点选中时，设置祖先元素的选中状态
     * @param item 子节点的数据
     * @param allData 全部节点数据
     * @param checked 取值为：true/false/'indeterminate'
     */
    static selectParents(item, allData, checked) {
        const pNode = TiTreeUtil.getParentNode(allData, item);
        if (Util.isUndefined(pNode)) {
            return;
        }
        // 当子元素为半选时，祖先元素一律设置为半选状态
        if (checked === 'indeterminate') {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
            return;
        }
        const childrens = pNode.children;
        let selectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true) {
                selectedNum++;
            }
        }
        if (selectedNum === childrens.length) {
            pNode.checked = true;
            TiTreeUtil.selectParents(pNode, allData, true);
        }
        else {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
        }
    }
    /**
     * @ignore
     * 根据父节点选择子节点
     */
    static selectAllChildren(item) {
        // 如果子节点是禁用状态不做处理；
        if (item.disabled !== true) {
            item.checked = true;
        }
        if (!TiTreeUtil.isLeaf(item)) {
            item.children.forEach((child) => {
                TiTreeUtil.selectAllChildren(child);
            });
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * @ignore
     * 多选状态下，父节点取消选中，置子节点都为取消选中状态
     * @param item 子节点的数据
     */
    static deSelectAllChildren(item) {
        if (item.disabled !== true) {
            item.checked = false;
        }
        if (Util.isArray(item.children) && item.children.length > 0) {
            item.children.forEach((child) => {
                TiTreeUtil.deSelectAllChildren(child);
            });
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * @ignore
     * 当前节点取消选中时，设置祖先元素的选中状态
     * @param item 当前节点的数据
     * @param allData 全部的节点数据
     */
    static deSelectParents(item, allData) {
        const pNode = TiTreeUtil.getParentNode(allData, item);
        if (Util.isUndefined(pNode)) {
            return;
        }
        const childrens = pNode.children;
        let selectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true || child.checked === 'indeterminate') {
                selectedNum++;
            }
        }
        if (selectedNum === 0) {
            pNode.checked = false;
            TiTreeUtil.deSelectParents(pNode, allData);
        }
        else {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
        }
    }
    /**
     * @ignore
     * drop event
     * @param event 拖拽数据
     * @param data 所用节点数据
     * @param multiple 多选
     */
    static dropApply(event, data, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        const dragNode = event.dragNode; // 拖拽节点
        const dragParentNode = TiTreeUtil.getParentNode(data, dragNode); // 拖拽节点的父节点
        const dropNode = event.targetNode; // 拖放节点
        const dropParentNode = TiTreeUtil.getParentNode(data, dropNode); // 拖放节点的父节点
        const dropPosition = event.dropPosition; // 拖拽位置
        TiTreeUtil.removeNode(data, dragNode);
        // 拖拽父节点无子节点时，删除children属性，此处是为解决当children为空时，展开收起图标还会存在的问题
        if ((dragParentNode === null || dragParentNode === void 0 ? void 0 : dragParentNode.children.length) < 1) {
            delete dragParentNode.children;
        }
        if (dropPosition === 0) {
            TiTreeUtil.addNode(data, [dragNode], -1, dropNode);
        }
        else {
            let index;
            if (!dropParentNode) { // 拖放节点为顶级级节点时
                index = data.indexOf(dropNode);
                if (dropPosition === -1) {
                    data.splice(index, 0, dragNode);
                }
                else {
                    data.splice(index + 1, 0, dragNode);
                }
            }
            else {
                index = dropParentNode.children.indexOf(dropNode);
                if (dropPosition === -1) {
                    TiTreeUtil.addNode(data, [dragNode], index, dropParentNode);
                }
                else {
                    TiTreeUtil.addNode(data, [dragNode], index + 1, dropParentNode);
                }
            }
        }
        // 多选
        if (multiple) {
            TiTreeUtil.updateChecked(data);
        }
    }
}
TiTreeUtil.selectedData = [];
TiTreeUtil.pnode = [];

/**
 * Tree树组件
 *
 * 分类：支持单选、多选两种类型
 *
 * 公共方法：树组件提供 [TiTreeUtil]{@link ../classes/TiTreeUtil.html} 公共方法，包括增、删、改、查、选中、取消选中、遍历、筛选、获取选中项等操作
 *
 * <example-url>../tiny3demo/#/tree/tree-all</example-url>
 */
class TiTreeComponent extends TiBaseComponent {
    constructor(elementRef, renderer2, iterableDiffers, tiRenderer, cdRef) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.iterableDiffers = iterableDiffers;
        this.tiRenderer = tiRenderer;
        this.cdRef = cdRef;
        /**
         * 设置多选树时，父节点是否可被点击选中，默认父节点子节点都显示复选框，都可被选中，设置false时，只有子节点前边显示复选框。
         */
        this.parentCheckable = true;
        /**
         * 设置是否为多选。
         */
        this.multiple = false;
        /**
         * 当为多选时该接口才生效。
         *
         * 默认为 false, 当设置为 true 时：
         *
         * 1.点击文本，复选框状态不会改变，只会触发select事件；
         *
         * 2.点击复选框只会触发change事件；
         *
         * 3.复选框disabled时，点击文本会触发select事件。
         *
         * Tiny3.1.1-alpha新增。
         */
        this.changedByCheckbox = false;
        /**
         * 10.1.4 新增
         * 支持拖放
         */
        this.nodeDraggable = false;
        /**
         * 树节点展开前的事件回调，一般用于异步数据获取
         */
        this.beforeExpand = new EventEmitter();
        /**
         * 当用户点击某一节点时触发的事件
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        /**
         * 当前选中项发生变化时，触发change事件
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.change = new EventEmitter();
        /**
         * 10.1.4 新增
         * drop event
         */
        this.nodeDrop = new EventEmitter();
        /**
         * 10.1.4 新增
         * 悬浮增加节点按钮回调
         */
        this.nodeAdded = new EventEmitter();
        /**
         * 10.1.4 新增
         * 悬浮编辑节点按钮回调
         */
        this.nodeEdited = new EventEmitter();
        /**
         * 10.1.4 新增
         * 悬浮删除节点按钮回调
         */
        this.nodeDeleted = new EventEmitter();
        /**
         * @ignore
         * 词条
         */
        this.treeLan = TiLocale.getLocaleWords().tiTree;
        // 处理当前节点选中状态变化后，对父子节点的影响
        this.setSeletedState = (node, allData, checked) => {
            if (checked === true) {
                TiTreeUtil.selectAllChildren(node);
                TiTreeUtil.selectParents(node, allData, true);
            }
            else {
                TiTreeUtil.deSelectAllChildren(node);
                TiTreeUtil.deSelectParents(node, allData);
            }
        };
        /**
         * 单选时，取消所有节点的选中状态
         * @param  allData 所有节点数据
         */
        this.deSelectAllNode = (allData) => {
            allData.forEach((node) => {
                TiTreeUtil.deSelectAllChildren(node);
            });
        };
        // 初始化选中项高亮
        this.initActived = (data) => {
            let result;
            for (const node of data) {
                if (node.checked === true) {
                    return node;
                }
                if (!TiTreeUtil.isLeaf(node)) {
                    result = this.initActived(node.children);
                }
                if (!Util.isUndefined(result)) {
                    return result;
                }
            }
            return result;
        };
    }
    ngOnInit() {
        super.ngOnInit();
        this.dataDiffer = this.iterableDiffers.find(this.data)
            .create();
        // 内部使用的数据，用于记录用户的操作改变
        // TODO: 仅在初始化时挡非法数据，是不够的。建议去除。但因为要兼容已发出的版本，所以不去除。
        this.data = !Util.isArray(this.data) ? [] : this.data;
        // 初始化默认选中项高亮
        this.actived = this.initActived(this.data);
    }
    ngDoCheck() {
        super.ngDoCheck();
        const dataChanges = this.dataDiffer.diff(this.data);
        if (dataChanges) {
            // 重新初始化默认选中项高亮
            this.actived = this.initActived(this.data);
        }
    }
    /**
     * @ignore
     * @description 判断是否显示复选框
     * @param node 节点数据
     */
    showCheckboxFn(node) {
        if (this.multiple !== true) {
            return false;
        }
        if (this.parentCheckable === true) {
            return true;
        }
        return TiTreeUtil.isLeaf(node);
    }
    /**
     * @ignore
     * @description 点击父节点图标执行的逻辑
     * @param  node 当前节点数据
     */
    onClickPnodeIcon(node, event) {
        if (node.disabled) {
            return;
        }
        // 阻止事件冒泡：点击父节点图标无高亮样式
        event.stopPropagation();
        this.beforeExpandNode = node;
        // 1.当前节点是展开状态
        if (node.expanded) {
            node.expanded = false;
        }
        else if (this.beforeExpand.observers.length === 0) { // 2.如果未定义beforeExpand事件(非异步)，点击时让节点展开
            node.expanded = true;
        }
        else { // 3.异步获取数据：将组件实例通知出去
            this.beforeExpand.emit(this);
        }
    }
    // 获取异步点击的节点
    getBeforeExpandNode() {
        return this.beforeExpandNode;
    }
    /**
     * @ignore
     * @description 根据item的isExpanded属性获取item图标
     * @param node 当前节点数据
     */
    getItemIcon(node) {
        if (TiTreeUtil.isLeaf(node)) {
            return `${node.expandIcon} ti3-tree-node-icon`;
        }
        return `${(node.expanded) ? node.expandIcon : node.collapseIcon} ti3-tree-node-icon`;
    }
    /**
     * @ignore
     * @description 点击复选框触发select、change事件
     * 需要注意：click事件中拿到的是操作前的选中状态，而change事件中拿到的是操作后的选中状态
     * @param node 当前节点数据
     */
    onInputChange(node, event) {
        if (node.disabled === true) {
            return;
        }
        // 点击当前项高亮
        this.actived = node;
        this.setSeletedState(node, this.data, node.checked);
        if (!this.changedByCheckbox) {
            this.select.emit(node);
        }
        this.change.emit(node);
    }
    /**
     * @ignore
     * 点击文本区域
     * @param node 当前节点数据
     * @param event 鼠标事件
     * @returns void
     */
    onItemWrapperClick(node) {
        if (node.disabled === true || node.editing) {
            return;
        }
        // 悬浮功能: 点击生成节点时，显示操作按钮
        if (!node.editing) {
            node.isHover = true;
        }
        // 点击当前项高亮
        this.actived = node;
        // 1.处理多选情况
        if (this.multiple === true) {
            if (this.changedByCheckbox) {
                this.select.emit(node);
                return;
            }
            // 1.1 处理父节点不支持多选
            if (!this.showCheckboxFn(node)) {
                return;
            }
            // 1.2 处理父节点支持多选
            node.checked = !node.checked;
            // 处理当前节点选中状态变化后，对父子节点的影响
            this.setSeletedState(node, this.data, node.checked);
            this.select.emit(node);
            this.change.emit(node);
            return;
        }
        // 2.处理单选场景
        // 2.1(单选且已选中)或者(单选且非叶子节点)的情况下，点击只会触发select事件,因为当前选中项不会发生变化
        if (node.checked === true || !TiTreeUtil.isLeaf(node)) {
            // 触发select事件
            this.select.emit(node);
            return;
        }
        // 2.2单选叶子节点未选中
        this.deSelectAllNode(this.data);
        node.checked = true;
        TiTreeUtil.selectParents(node, this.data, 'indeterminate'); // 设置祖先节点的选中状态
        // 触发select和change事件
        this.select.emit(node);
        this.change.emit(node);
    }
    /**
     * @ignore
     */
    trackByFn(index, node) {
        return index;
    }
    /**
     * @ignore
     * 判断是否为叶子节点
     */
    isLeaf(node) {
        return !(Util.isArray(node.children));
    }
    /**
     * @ignore
     * @param node 节点数据
     */
    onBlur(node) {
        if (node.focused) {
            node.focused = false; // 失焦后节点删除获焦标志类
        }
    }
    /**
     * @ignore
     * @param node 节点数据
     */
    onFocus(node) {
        if (!node.focused && !node.disabled) {
            node.focused = true; // 设置获焦标志类
        }
    }
    /**
     * @ignore
     * @param event 键盘事件
     * @param node 当前节点数据
     */
    onKeydown(event, node) {
        /**
         * 快捷键交互定义
         * 1,tab键切换焦点至树组件的文本区域，复选框无需提供焦点，文本样式为文本悬浮态
         * 2,树组件内部焦点切换支持上下左右键：
         *    -上下键：按上下键可以在并列的节点移动，如无并列节点无法移动。
         *    -左右键：展开收起节点及跨层级移动焦点。当焦点再子节点时，按左键可收起改节点，焦点移动至父节点；
         *     当焦点在父节点上时，按右键可将焦点移动到启子节点上,如节点未展开则同时展开该子节点
         * 3,Enter键或Space键：当焦点在节点名称上时，按下键则选中或取消该节点，选中后节点变为选中态
         */
        // 阻止默认和冒泡
        if ([TiKeymap.KEY_ENTER, TiKeymap.KEY_NUMPAD_ENTER, TiKeymap.KEY_SPACE, TiKeymap.KEY_ARROW_UP, TiKeymap.KEY_ARROW_DOWN,
            TiKeymap.KEY_ARROW_LEFT, TiKeymap.KEY_ARROW_RIGHT].indexOf(event.keyCode) > -1) {
            event.preventDefault();
            event.stopPropagation();
        }
        switch (event.keyCode) {
            case TiKeymap.KEY_ENTER: // ENTER键
            case TiKeymap.KEY_NUMPAD_ENTER: // ENTER键(苹果数字小键盘)
            case TiKeymap.KEY_SPACE:
                this.onItemWrapperClick(node);
                break;
            case TiKeymap.KEY_ARROW_UP: // 向上箭头，同级
                this.setKeyDownUp(node, 'up');
                break;
            case TiKeymap.KEY_ARROW_DOWN: // 向下箭头，同级
                this.setKeyDownUp(node, 'down');
                break;
            case TiKeymap.KEY_ARROW_LEFT: // 向左箭头，跨节点层级
                this.setKeyleft(node);
                break;
            case TiKeymap.KEY_ARROW_RIGHT: // 向右箭头，跨节点层级
                this.setKeyright(node);
                break;
            default:
                break;
        }
    }
    // 上下键
    setKeyDownUp(node, type) {
        let parArr;
        const pareNode = TiTreeUtil.getParentNode(this.data, node); // 获取父节点
        if (pareNode) {
            parArr = pareNode.children;
        }
        else {
            parArr = this.data;
        }
        const curIndex = parArr.findIndex((item) => item === node); // 获取当前节点在其父节点集合的index
        this.setFocusNode(node, parArr, curIndex, type);
    }
    // 左键
    setKeyleft(node) {
        // 当正在编辑时，关闭其父节点时，节点恢复文本状态
        if (node.editing && node.label !== '') {
            delete node.editing;
        }
        const pareNode = TiTreeUtil.getParentNode(this.data, node);
        if (!pareNode) { // 当前节点时一级节点时 return
            return;
        }
        pareNode.expanded = false;
        if (pareNode.disabled) {
            this.setKeyleft(pareNode);
            return;
        }
        pareNode.focused = true;
        this.setFocusElem(node);
    }
    // 右键
    setKeyright(node) {
        if (TiTreeUtil.isLeaf(node)) {
            return;
        }
        const childNodeArr = node.children;
        const childnoDisabledArr = childNodeArr.filter((childNode) => !childNode.disabled); // 获取子节点未禁用的节点集合
        if (childnoDisabledArr.length < 1) {
            return;
        }
        const childFirstNode = childnoDisabledArr[0]; // 未禁用的节点集合的first获取焦点
        childFirstNode.focused = true;
        if (!node.expanded) {
            node.expanded = true;
        }
        this.setFocusElem(node);
    }
    // 上下键焦点处理
    setFocusNode(node, parList, curIndex, type) {
        let targetNode;
        let targetIndex;
        let _curIndex = curIndex;
        if (type === 'up') { // 同级获取上一个节点
            targetIndex = _curIndex - 1;
            if (targetIndex < 0) {
                targetIndex = parList.length - 1;
            }
            targetNode = parList[targetIndex];
        }
        else { // 同级获取下一个节点
            targetIndex = _curIndex + 1;
            if (targetIndex > (parList.length - 1)) {
                targetIndex = 0;
            }
            targetNode = parList[targetIndex];
        }
        // 上下移动时，first或last节点禁用时,return
        if ((targetNode === parList[0] || targetNode === parList[parList.length - 1]) && targetNode.disabled) {
            return;
        }
        // 当中间节点有禁用时，移动到禁用的节点上一个或下一个节点
        if (targetNode.disabled) {
            _curIndex = targetIndex;
            this.setFocusNode(node, parList, _curIndex, type);
            return;
        }
        targetNode.focused = true;
        this.setFocusElem(node);
    }
    // 目标元素获取焦点
    setFocusElem(node) {
        if (node.focused) {
            node.focused = false;
        }
        // 当按键操作会改变文本元素是否添加class`ti3-tree-text-focus`, 加延时是为了class变更后，获取正确的含有class的文本区域元素
        // 类ti3-tree-text-focus作为获焦元素的标志
        setTimeout(() => {
            // 找到含有类ti3-tree-text-focus的文本元素
            const focusNode = this.elems.toArray().find((elem) => this.tiRenderer.hasClass(elem.nativeElement, 'ti3-tree-text-focus'));
            if (focusNode) {
                focusNode.nativeElement.focus();
            }
        }, 0);
    }
    /**
     * @ignore
     * @param startEvent 鼠标事件
     * @param node 当前节点数据
     * @description 拖拽开始时在被拖拽元素上触发此事件
     */
    onDragstart(event, node) {
        event.stopPropagation();
        this.dragNode = node; // 保存被拖拽的节点
    }
    /**
     * @ignore
     * @param enterEvent 鼠标事件
     * @param node 当前节点数据
     * @description 拖拽鼠标进入元素时在该元素上触发
     */
    onDragenter(event, node) {
        event.preventDefault();
        this.overNode = null;
        // 拖拽节点和目标节点是同一节点,retuen
        if (node === this.dragNode) {
            return;
        }
        // 保存移动到的节点
        this.overNode = node;
        // 拖拽的节点拖拽到其子节点时，关闭其节点
        if (this.dragNode === TiTreeUtil.getParentNode(this.data, node)) {
            this.dragNode.expanded = false;
        }
    }
    /**
     * @ignore
     * @param overEvent 鼠标事件
     * @param node 当前节点数据
     * @description 拖拽时鼠标在目标元素上移动时触发
     */
    onDragover(event, node) {
        event.preventDefault();
        event.dataTransfer.effectAllowed = "move";
        if (node === this.overNode) {
            this.clearDragClass(event); // 清除节点之前的样式
            this.dropPosition = this.calcDropPosition(event); // 获取移动到节点的位置
            // 拖拽经过节点,放置内部位置时，且该节点未展开时，展开其节点
            if (this.dropPosition === 0 && !node.expanded) {
                node.expanded = true;
            }
            // 设置拖动过程中的状态样式
            this.renderer2.addClass(event.currentTarget, this.setDragOverClass(node));
        }
        ;
    }
    /**
     * @ignore
     * @param leaveEvent 鼠标事件
     * @param node 当前节点数据
     * @description 拖拽时鼠标在离开目标元素时触发
     */
    onDragleave(event, node) {
        event.preventDefault();
        this.clearDragClass(event);
    }
    /**
     * @ignore
     * @param dropEvent 鼠标事件
     * @param node 当前节点数据
     * @description 鼠标在拖放目标上释放时,在拖放目标上触发
     */
    onDrop(event, node) {
        event.preventDefault();
        this.dragNode.focused = false;
        this.clearDragClass(event);
        // 异步加载节点时禁止放置到节点内部
        if (this.dropPosition === 0 && node.loadStatus === 'loading') {
            return;
        }
        // 拖拽节点和目标节点是同一节点,retuen
        if (node === this.dragNode) {
            return;
        }
        const params = {
            event: event,
            targetNode: node,
            dragNode: this.dragNode,
            dropPosition: this.dropPosition
        };
        TiTreeUtil.dropApply(params, this.data, this.multiple);
        this.nodeDrop.emit(params);
    }
    /**
     * @ignore
     * @param endEvent 鼠标事件
     * @param node 当前节点数据
     * @description 鼠标在拖放目标上释放时,在拖拽元素上触发
     */
    onDragend(event, node) {
        event.preventDefault();
        this.dragNode = null;
        this.overNode = null;
    }
    // 计算拖拽节点的放置方式0（作为目标节点的子节点），-1（放置在目标节点的前面）,1（放置在目标节点的后面）
    calcDropPosition(event) {
        const clientY = event.clientY;
        const { top, height } = event.target.getBoundingClientRect();
        const gapHeight = height / 3;
        if (clientY > top + height - gapHeight) {
            return 1;
        }
        if (clientY < top + gapHeight) {
            return -1;
        }
        return 0;
    }
    // 清除拖拽样式
    clearDragClass(event) {
        // 拖拽过程中的三种状态
        const dragClasses = ['ti3-tree-drag-over-inner', 'ti3-tree-drag-over-top', 'ti3-tree-drag-over-bottom'];
        dragClasses.forEach((item) => {
            this.renderer2.removeClass(event.currentTarget, item);
        });
    }
    // 根据拖动的位置获取相应的样式
    setDragOverClass(node) {
        if (node !== this.overNode) {
            return;
        }
        if (this.dropPosition === 0) {
            return "ti3-tree-drag-over-inner";
        }
        else if (this.dropPosition === -1) {
            return "ti3-tree-drag-over-top";
        }
        else if (this.dropPosition === 1) {
            return "ti3-tree-drag-over-bottom";
        }
        return "";
    }
    /**
     * @ignore
     * @param node 节点
     * @param type hover标志
     */
    onMousenode(node, type) {
        // 鼠标进入节点且不是编辑状态时，显示操作按钮
        if (type === 'enter' && !node.editing) {
            node.isHover = true;
        }
        else {
            delete node.isHover;
        }
    }
    /**
     * @ignore
     * @param node 节点
     */
    onBlurEdit(node) {
        if (node.label !== '') {
            delete node.editing;
        }
    }
    /**
      * @ignore
      * @param deleteEvent 删除事件
      * @param node 节点
      */
    deleteNode(event, node) {
        // 阻止事件冒泡 防止触发选中
        event.stopPropagation();
        const parentNode = TiTreeUtil.getParentNode(this.data, node);
        TiTreeUtil.removeNode(this.data, node);
        // 节点的父节点无子节点时， 删除children属性，解决依旧会显示展开图标问题
        if (parentNode && parentNode.children.length < 1) {
            delete parentNode.children;
        }
        // 更新多选状态
        if (this.multiple) {
            TiTreeUtil.updateChecked(this.data);
        }
        this.nodeDeleted.emit(node);
    }
    /**
     * @ignore
     * @param editEvent 编辑事件
     * @param node 节点
     */
    editNode(event, node) {
        // 阻止事件冒泡 防止触发选中
        event.stopPropagation();
        node.editing = true;
        delete node.isHover;
        this.nodeEdited.emit(node);
        // autofocus视图变化时 会报错 视图变化时 强制变检一次，消除报错(Expression has changed after it was checked)
        this.cdRef.detectChanges();
    }
    /**
     * @ignore
     * @param addEvent 增加事件
     * @param node 节点
     */
    addNode(event, node) {
        // 阻止事件冒泡 防止触发选中
        event.stopPropagation();
        const newNode = {
            label: this.treeLan.newNode,
            editing: true,
        };
        node.expanded = true;
        this.nodeAdded.emit(newNode);
        TiTreeUtil.addNode(this.data, [newNode], 0, node);
        // 更新多选状态
        if (this.multiple) {
            TiTreeUtil.updateChecked(this.data);
        }
        // autofocus视图变化时 会报错 强制变检一次，消除报错(Expression has changed after it was checked)
        this.cdRef.detectChanges();
    }
}
TiTreeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-tree',
                template: "<ul class=\"ti3-tree-container ti3-tree-parent-node\" [id]=\"appendId('list')\">\r\n    <li *ngFor=\"let node of data; index as i;\">\r\n        <ng-container *ngTemplateOutlet=\"treeItem; context: {$implicit: node, index: i}\"></ng-container>\r\n    </li>\r\n</ul>\r\n\r\n<ng-template #treeItem let-node let-i=index>\r\n    <div class=\"ti3-tree-content-box\"\r\n        [id]=\"appendId(i + '_node')\"\r\n        [ngClass]=\"{'ti3-tree-item-leaf': isLeaf(node), 'ti3-tree-content-box-disabled': node.disabled}\">\r\n        <span class=\"ti3-tree-item-guide-line\"></span>\r\n        <ti-loading *ngIf=\"node.loadStatus === 'loading'\" class=\"ti3-tree-item-loading\"></ti-loading>\r\n        <i (click)=\"onClickPnodeIcon(node, $event)\" *ngIf=\"!node.loadStatus || node.loadStatus !== 'loading'\"\r\n            [id]=\"appendId(i + '_icon')\"\r\n            class=\"ti3-icon\"\r\n            [ngClass]=\"{'ti3-icon-minus-square': !isLeaf(node) && node.expanded,\r\n                        'ti3-icon-plus-square': !isLeaf(node) && !node.expanded,\r\n                        'ti3-icon-square-disabled': !isLeaf(node) && node.disabled}\">\r\n        </i>\r\n        <label class=\"ti3-tree-checkbox-wrapper\" *ngIf=\"multiple\">\r\n            <input type=\"checkbox\" [(ngModel)]=\"node.checked\" [disabled]=\"node.disabled\" *ngIf=\"showCheckboxFn(node)\" [id]=\"appendId('checkbox_' + i)\"\r\n                [indeterminate]=\"node.checked === 'indeterminate'\" (change)=\"onInputChange(node, $event)\" tabindex=\"-1\" tiCheckbox />\r\n        </label>\r\n        <div (click)=\"onItemWrapperClick(node)\" [id]=\"appendId(i + '_content')\" class=\"ti3-tree-node-text-wrapper\" #nodeList\r\n             (keydown)=\"onKeydown($event, node)\"\r\n             (blur)=\"onBlur(node)\"\r\n             (focus)=\"onFocus(node)\"\r\n             [tabindex]=\"node.disabled ? -1 : 0\"\r\n             [draggable]=\"node.disabled ? false : nodeDraggable\"\r\n             (dragstart)=\"onDragstart($event, node)\"\r\n             (dragenter)=\"onDragenter($event, node)\"\r\n             (dragover)=\"onDragover($event, node)\"\r\n             (dragleave)=\"onDragleave($event, node)\"\r\n             (drop)=\"onDrop($event, node)\"\r\n             (dragend)=\"onDragend($event, node)\"\r\n             (mouseenter)=\"onMousenode(node, 'enter')\"\r\n             (mouseleave)=\"onMousenode(node, 'leave')\"\r\n             [ngClass]=\"{'ti3-tree-item-active' : actived === node,\r\n                    'ti3-tree-text-disabled-wrapper': node.disabled,\r\n                    'ti3-tree-text-nomultiple-wrapper': !multiple && !isLeaf(node),\r\n                    'ti3-tree-text-multiple-leaf-wrapper': multiple && isLeaf(node),\r\n                    'ti3-tree-text-leaf-wrapper': !multiple && isLeaf(node),\r\n                    'ti3-tree-text-focus': node.focused,\r\n                    'ti3-tree-content-drag-box': nodeDraggable}\">\r\n            <ng-container *ngIf=\"itemTemplate else labelTemplate\">\r\n                <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: node, index: i}\">\r\n                </ng-container>\r\n            </ng-container>\r\n            <ng-template #labelTemplate>\r\n                <ng-container *ngIf=\"(node.loadStatus !== 'error') else errorTemplate\">\r\n                    <i class=\"{{getItemIcon(node)}}\" *ngIf='node.expandIcon || node.collapseIcon'></i>\r\n                    <span [title]=\"node.label\" *ngIf=\"!node.editing\" class='ti3-tree-node-text' [innerHTML]=\"node.label | tiHighlight: highlightWords\"></span>\r\n                    <input  tiText\r\n                            tiValidation\r\n                            tiRequired\r\n                            tiAutoSelect\r\n                            autofocus\r\n                            *ngIf=\"node.editing\"\r\n                            autoComplete=\"off\"\r\n                            class=\"ti3-tree-edit-input\"\r\n                            [id]=\"appendId(i + '_input')\"\r\n                            (blur)=\"onBlurEdit(node)\"\r\n                            [(ngModel)] = \"node.label\"\r\n                            (keyup.enter)=\"onBlurEdit(node)\">\r\n                    <ng-container *ngIf=\"node.isHover && !node.disabled\">\r\n                        <ti-icon name=\"add1\"\r\n                                *ngIf=\"node.addable\"\r\n                                [id]=\"appendId(i + '_add')\"\r\n                                (click)=\"addNode($event, node)\"\r\n                                class=\"ti3-tree-operate\"></ti-icon>\r\n                        <ti-icon\r\n                                name=\"edit\"\r\n                                *ngIf=\"node.editable\"\r\n                                [id]=\"appendId(i + '_edit')\"\r\n                                (click)=\"editNode($event, node)\"\r\n                                class=\"ti3-tree-operate\"></ti-icon>\r\n                        <ti-icon name=\"delete-1\"\r\n                                *ngIf=\"node.deleteable\"\r\n                                [id]=\"appendId(i + '_delete')\"\r\n                                (click)=\"deleteNode($event,node)\"\r\n                                class=\"ti3-tree-operate\"></ti-icon>\r\n                    </ng-container>\r\n                </ng-container>\r\n                <ng-template #errorTemplate>\r\n                    <i class='ti3-tree-error-icon ti3-icon ti3-icon-alert-warn'></i>\r\n                    <span>{{treeLan.loadError}}<span [id]=\"appendId(i + '_error')\" (click)=\"onClickPnodeIcon(node, $event)\" class=\"ti3-tree-item-reload\">{{treeLan.reload}}</span></span>\r\n                </ng-template>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n    <ul *ngIf=\"!isLeaf(node) && node.expanded\" class='ti3-tree-parent-node' [id]=\"appendId('child_list_' + i)\">\r\n        <li class='ti3-tree-leaf-node'\r\n            *ngFor=\"let children of node.children; index as j; trackBy: trackByFn\">\r\n            <ng-container *ngTemplateOutlet=\"treeItem; context: {$implicit: children, index: i + '_' + j}\"></ng-container>\r\n        </li>\r\n    </ul>\r\n</ng-template>",
                styles: ["::ng-deep :root{--ti-tree-error-icon-size:16px;--ti-tree-item-guide-line-first-child-space:var(--ti-common-space-2x);--ti-tree-item-guide-line-width:8px;--ti-tree-node-icon-font-size:16px;--ti-tree-node-icon-space:calc(var(--ti-tree-square-icon-font-size) + var(--ti-tree-node-icon-font-size) + var(--ti-common-space-base)*2 + var(--ti-tree-icon-right-space)*2);--ti-tree-node-text-multiple-leaf-space:calc(var(--ti-tree-node-icon-font-size) + var(--ti-common-space-base) + var(--ti-tree-icon-right-space)*2);--ti-tree-node-text-nomultiple-space:calc(var(--ti-tree-square-icon-font-size) + var(--ti-tree-icon-right-space)*2);--ti-tree-node-text-padding-space:calc(var(--ti-common-space-2x) + var(--ti-common-space-base));--ti-tree-small-checkbox-size:12px;--ti-tree-small-icon-font-size:12px;--ti-tree-small-icon-space:calc(var(--ti-common-space-base)/2)}.ti3-tree-node-text{display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ti3-tree-parent-node{font-size:var(--ti-common-font-size-base);position:relative}.ti3-tree-node-icon{font-size:var(--ti-tree-node-icon-font-size);margin-right:var(--ti-tree-icon-right-space);text-align:center}.ti3-tree-leaf-node{margin-left:var(--ti-common-space-6x);position:relative}.ti3-tree-node-text-wrapper{align-items:center;display:flex;padding:0 var(--ti-common-space-2x) 0 var(--ti-common-space-base);white-space:nowrap;width:calc(100% - var(--ti-tree-node-icon-space))}.ti3-tree-node-text-wrapper:hover{background:var(--ti-tree-content-box-color-hover)}.ti3-tree-node-text-wrapper:hover.ti3-tree-text-disabled-wrapper{background:none}.ti3-tree-node-text-wrapper:focus{outline:none}.ti3-tree-node-text-wrapper.ti3-tree-text-focus{background:var(--ti-tree-content-box-color-hover);outline:none}.ti3-tree-node-text-wrapper .ti3-tree-operate{color:var(--ti-common-color-icon-normal);font-size:var(--ti-common-font-size-2);margin-left:var(--ti-common-space-2x)}.ti3-tree-node-text-wrapper .ti3-tree-operate:active,.ti3-tree-node-text-wrapper .ti3-tree-operate:hover{color:var(--ti-common-color-icon-hover);cursor:pointer}.ti3-tree-node-text-wrapper .ti3-tree-operate:first-of-type{margin-left:var(--ti-common-space-3x)}.ti3-tree-node-text-wrapper .ti3-tree-edit-input{height:var(--ti-tree-item-height)}.ti3-tree-text-nomultiple-wrapper{width:calc(100% - var(--ti-tree-node-text-nomultiple-space))}.ti3-tree-text-multiple-leaf-wrapper{width:calc(100% - var(--ti-tree-node-text-multiple-leaf-space))}.ti3-tree-text-leaf-wrapper{width:calc(100% - var(--ti-tree-node-text-padding-space))}.ti3-tree-content-box{align-items:center;cursor:pointer;display:flex;height:var(--ti-tree-item-height);line-height:var(--ti-tree-item-lineheight);padding-left:var(--ti-tree-content-box-left-space)}.ti3-tree-content-box-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-tree-item-active,.ti3-tree-item-active:focus,.ti3-tree-item-active:hover{background:var(--ti-tree-node-bg-color-checked)}.ti3-tree-item-leaf{margin-left:calc(var(--ti-tree-square-icon-font-size) + var(--ti-common-space-base))}.ti3-tree-checkbox-wrapper{display:inline-block;font-size:0}:host .ti3-tree-content-box .ti3-tree-checkbox-wrapper ::ng-deep input[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{margin:0 var(--ti-common-space-base) 0 var(--ti-common-space-base)}.ti3-tree-item-loading{margin-right:var(--ti-common-space-2x)}.ti3-tree-item-reload{color:var(--ti-common-color-text-link);text-decoration:none}.ti3-tree-item-reload:hover{color:var(--ti-common-color-text-link-hover);text-decoration:underline}.ti3-tree-error-icon{background-color:var(--ti-valid-error-color);border-radius:50%;color:var(--ti-common-color-text-white);display:inline-block;height:var(--ti-tree-error-icon-size);line-height:var(--ti-tree-error-icon-size);margin-right:var(--ti-common-space-2x);text-align:center;width:var(--ti-tree-error-icon-size)}.ti3-tree-container .ti3-icon-minus-square{color:var(--ti-tree-minus-square-color)}.ti3-tree-container .ti3-icon-plus-square{color:var(--ti-tree-plus-square-color)}.ti3-tree-container .ti3-icon-square-disabled{background:var(--ti-common-color-bg-disabled);color:var(--ti-common-color-icon-graybg-disabled)}.ti3-tree-container .ti3-icon-minus-square,.ti3-tree-container .ti3-icon-plus-square{display:inline-block;font-size:var(--ti-tree-square-icon-font-size);line-height:var(--ti-tree-square-icon-font-size);margin-right:var(--ti-common-space-base);width:var(--ti-tree-square-icon-font-size)}.ti3-tree-container .ti3-icon-minus-square:hover,.ti3-tree-container .ti3-icon-plus-square:hover{color:var(--ti-tree-icon-color-active);cursor:pointer}.ti3-tree-container .ti3-icon-minus-square:hover.ti3-icon-square-disabled,.ti3-tree-container .ti3-icon-plus-square:hover.ti3-icon-square-disabled{color:var(--ti-common-color-icon-graybg-disabled);cursor:not-allowed}.ti3-tree-container .ti3-icon-minus-square:active,.ti3-tree-container .ti3-icon-plus-square:active{background:var(--ti-tree-icon-bg-color-active);color:var(--ti-tree-icon-color-active)}.ti3-tree-container .ti3-icon-minus-square:active.ti3-icon-square-disabled,.ti3-tree-container .ti3-icon-plus-square:active.ti3-icon-square-disabled{background:var(--ti-common-color-bg-disabled);color:var(--ti-common-color-icon-graybg-disabled)}.ti3-tree-content-drag-box{border-bottom:2px solid transparent;border-top:2px solid transparent;box-sizing:border-box;height:var(--ti-tree-item-height)}.ti3-tree-drag-over-inner{border:2px solid var(--ti-common-color-line-active);padding:0 6px 0 2px}.ti3-tree-drag-over-top{border-top:2px solid var(--ti-common-color-line-active)}.ti3-tree-drag-over-bottom{border-bottom:2px solid var(--ti-common-color-line-active)}.ti3-tree-leaf-node>.ti3-tree-content-box>.ti3-tree-item-guide-line{-ms-box-sizing:border-box;border-bottom:1px solid var(--ti-tree-item-guide-line-color);border-left:1px solid var(--ti-tree-item-guide-line-color);box-sizing:border-box;height:var(--ti-tree-item-height);left:calc(-1*var(--ti-tree-square-icon-font-size)/2);position:absolute;top:calc(-1*var(--ti-tree-item-height)/2);width:var(--ti-tree-item-guide-line-width)}.ti3-tree-leaf-node:first-child>.ti3-tree-content-box>.ti3-tree-item-guide-line{height:calc(var(--ti-tree-item-height) - var(--ti-tree-square-icon-font-size)/2 - var(--ti-tree-item-guide-line-first-child-space));top:calc(var(--ti-tree-square-icon-font-size)/2 + var(--ti-tree-item-guide-line-first-child-space) - var(--ti-tree-item-height)/2)}.ti3-tree-leaf-node:not(:last-child)>.ti3-tree-parent-node:after{-ms-box-sizing:border-box;border-left:1px solid var(--ti-tree-item-guide-line-color);box-sizing:border-box;content:\"\";height:100%;left:calc(-1*var(--ti-tree-square-icon-font-size)/2);position:absolute;top:calc(-1*var(--ti-tree-item-height)/2);width:var(--ti-tree-item-guide-line-width)}:host[small] .ti3-icon-minus-square,:host[small] .ti3-icon-plus-square{font-size:var(--ti-tree-small-icon-font-size);line-height:var(--ti-tree-small-icon-font-size);margin-right:var(--ti-tree-small-icon-space);width:var(--ti-tree-small-icon-font-size)}:host[small] .ti3-tree-node-icon{font-size:var(--ti-tree-small-icon-font-size);margin-right:var(--ti-common-space-base)}:host[small] .ti3-tree-content-box .ti3-tree-checkbox-wrapper ::ng-deep input[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{height:var(--ti-tree-small-checkbox-size);line-height:var(--ti-tree-small-checkbox-size);margin:0 var(--ti-tree-small-icon-space) 0 var(--ti-tree-small-icon-space);width:var(--ti-tree-small-checkbox-size)}:host[small] .ti3-tree-content-box .ti3-tree-checkbox-wrapper ::ng-deep input[type=checkbox][tiCheckbox]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{left:2px;top:2px}:host[small] .ti3-tree-content-box .ti3-tree-checkbox-wrapper ::ng-deep input[type=checkbox][tiCheckbox]:checked+.ti3-checkbox .ti3-checkbox-skin:before{height:7px;width:5px}:host[small] .ti3-tree-item-leaf{margin-left:calc(var(--ti-tree-small-icon-font-size) + var(--ti-tree-small-icon-space))}:host[small] .ti3-tree-content-box{padding-left:var(--ti-common-space-base)}:host[small] .ti3-tree-leaf-node{margin-left:calc(var(--ti-common-space-base) + var(--ti-tree-small-icon-font-size))}:host[small] .ti3-tree-leaf-node .ti3-tree-content-box{padding-left:var(--ti-common-space-base)}:host[small] .ti3-tree-leaf-node>.ti3-tree-content-box>.ti3-tree-item-guide-line{left:calc(-1*var(--ti-tree-small-icon-font-size)/2);width:calc(var(--ti-tree-small-icon-font-size)/2)}:host[small] .ti3-tree-leaf-node:not(:last-child)>.ti3-tree-parent-node:after{left:calc(-1*var(--ti-tree-small-icon-font-size)/2)}:host[small] .ti3-tree-node-text-wrapper{padding-left:var(--ti-tree-small-icon-space)}::ng-deep .ti3-font-highlight{color:var(--ti-common-color-text-highlight)}"]
            },] }
];
TiTreeComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: IterableDiffers },
    { type: TiRenderer },
    { type: ChangeDetectorRef }
];
TiTreeComponent.propDecorators = {
    data: [{ type: Input }],
    parentCheckable: [{ type: Input }],
    multiple: [{ type: Input }],
    changedByCheckbox: [{ type: Input }],
    highlightWords: [{ type: Input }],
    nodeDraggable: [{ type: Input }],
    beforeExpand: [{ type: Output }],
    select: [{ type: Output }],
    change: [{ type: Output }],
    nodeDrop: [{ type: Output }],
    nodeAdded: [{ type: Output }],
    nodeEdited: [{ type: Output }],
    nodeDeleted: [{ type: Output }],
    itemTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    elems: [{ type: ViewChildren, args: ['nodeList',] }]
};

/**
 * @ignore
 * TiHighlightPipe 替换搜索的值并高亮显示
 */
class TiHighlightPipe {
    transform(value, keyword) {
        if (!keyword) {
            return value;
        }
        const Reg = new RegExp(keyword, 'ig');
        const result = value.replace(Reg, word => {
            return `<span class="ti3-font-highlight">${word}</span>`;
        });
        return result;
    }
}
TiHighlightPipe.decorators = [
    { type: Pipe, args: [{
                name: 'tiHighlight',
                pure: true
            },] }
];

/**
 * @ignore
 * 指令功能: 悬浮操作按钮场景，提供input框内容选中功能
 */
class TiAutoSelectDirective {
    constructor(elementRef) {
        this.elementRef = elementRef;
    }
    ngOnInit() {
        setTimeout(() => {
            this.elementRef.nativeElement.select();
        }, 0);
    }
}
TiAutoSelectDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiAutoSelect]'
            },] }
];
TiAutoSelectDirective.ctorParameters = () => [
    { type: ElementRef }
];

class TiTreeModule {
}
TiTreeModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiCheckboxModule,
                    TiIconModule,
                    FormsModule,
                    TiLoadingModule,
                    TiRendererModule,
                    TiTextModule,
                    TiValidationModule
                ],
                exports: [TiTreeComponent],
                declarations: [TiTreeComponent, TiHighlightPipe, TiAutoSelectDirective]
            },] }
];

/**
 * Treeselect树选择下拉组件
 *
 * 支持单选/多选，全选，搜索，懒加载。
 *
 * 单选主要功能为从Tree组件数据中选择某一条数据，单选与Tree功能相同，只是视觉呈现不同。
 *
 * 多选主要功能是从Tree组件数据中任意选择多条数据，多选与Tree功能相同，只是视觉呈现不同。
 *
 * 该组件继承自TiSelectComponent，其中
 *
 * 输入属性：clearable、labelKey、searchKeys、tipPosition、panelMaxHeight和valueKey暂不支持；
 *
 * 输出属性：clear不支持（单选和多选都采用标签方式展示，所以不支持单选情况下的clear事件）
 *
 * <example-url>../tiny3demo/#/treeselect/treeselect-all</example-url>
 */
class TiTreeselectComponent extends TiSelectComponent {
    constructor() {
        super(...arguments);
        /**
         * 下拉面板的高度，默认展示8条
         */
        this.dropMaxHeight = (30 + 1) * 8;
        /**
         * @ignore 全选框的半选中状态
         */
        this.indeterminate = false;
        /**
         * @ignore 全选中
         */
        this.isAllSelected = false;
        /**
         * @ignore 搜索提示文本
         */
        this.searchPlaceholder = TiLocale.getLocaleWords().tiSelect.search;
        /**
         * @ignore 搜索内容
         */
        this.searchText = '';
        /**
         * @ignore 是否处于搜索状态
         */
        this.isInSearch = false;
    }
    // 主干深拷贝，叶子浅拷贝
    // 因为搜索结果里，叶子节点的勾选效果，需要保留在原始数据。
    static leafShallowClone(arr) {
        if (typeof (arr) !== 'object' || arr === null || (arr.label !== undefined && arr.children === undefined)) {
            return arr;
        }
        const clone = Array.isArray(arr) ? arr.slice() : Object.assign({}, arr);
        const keys = Object.keys(clone);
        for (const key of keys) {
            clone[key] = TiTreeselectComponent.leafShallowClone(clone[key]);
        }
        return clone;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 强制装换，方便调用super.xxx
        this.dropsearchCom = this.dropCom;
        // 记录传入的数据，浅拷贝
        this.oldOptions = this.options;
    }
    ngOnChanges(changes) {
        // 解决延迟或者动态设置options，树组件未渲染的问题
        if (changes['options'] && !changes['options'].firstChange) {
            // 重新记录传入的数据
            this.oldOptions = changes['options'].currentValue;
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewChecked() {
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.searchboxCom.getFocusableElems())
                    .concat(this.dropCom.nativeElement));
            }
            else {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.dropCom.nativeElement));
            }
        }
        // 调用父类逻辑afterViewChecked才去设置autofocs
        super.ngAfterViewChecked();
    }
    /**
     * @ignore drop高度被压缩时，重新设置下拉面板的高度
     */
    restyleDropMaxHeight() {
        let dropCurMaxHeight = parseInt(this.dropCom.nativeElement.style.maxHeight, 10);
        let dropMaxHeightAdapted = this.dropMaxHeight;
        if (!isNaN(dropCurMaxHeight)) {
            // 减去搜索框高度和间距的和
            if (this.searchable) {
                dropCurMaxHeight -= TiTreeselectComponent.SEARCHBOX_HEIGHT;
            }
            if (dropCurMaxHeight < this.dropMaxHeight) {
                dropMaxHeightAdapted = dropCurMaxHeight;
            }
        }
        this.renderer.setStyle(this.dataTemplate.nativeElement, 'max-height', dropMaxHeightAdapted + 'px');
    }
    ngOnModelChange() {
        if (this.multiple) {
            // 多选时，重新设置下拉面板定位
            this.setPosition();
            if (this.selectAll) {
                // 允许全选时，设置全选框状态
                this.setAllSelectCheckboxState();
            }
        }
    }
    /**
     * @ignore 设置下拉面板定位
     */
    setPosition(optionsChange) {
        setTimeout(() => {
            if (optionsChange) {
                this.dropCom.resetPosition();
            }
            else {
                this.dropCom.setPosition();
            }
            this.restyleDropMaxHeight();
        }, 0);
    }
    /**
     * @ignore 关闭下拉面板并转移焦点
     */
    close() {
        this.dropCom.hide();
        // 焦点转移至dominator
        if (this.searchable) {
            this.dominatorCom.focus();
        }
    }
    /**
     * @ignore 仅仅关闭下拉面板
     */
    closeWithoutFocus() {
        this.dropCom.hide();
    }
    /**
     * @ignore 打开下拉面板
     */
    open() {
        // 初始化最大高度
        this.renderer.setStyle(this.dataTemplate.nativeElement, 'max-height', this.dropMaxHeight + 'px');
        this.dropCom.show();
        this.restyleDropMaxHeight();
        // 焦点转移至搜索框
        if (this.searchable) {
            this.searchboxCom.focus();
        }
    }
    /**
     * 尝试打开下拉面板
     */
    wantOpen() {
        super.wantOpen();
    }
    /**
     * @ignore 点击ti-dominator触发的事件
     * 点击下拉面板，展开或者关闭面板
     */
    onClickDominator() {
        if (this.disabled) {
            return;
        }
        if (!this.dropCom.isShow) {
            // 清空搜索内容
            this.searchText = '';
            this.searchTextChange(this.searchText);
            this.wantOpen();
        }
        else {
            this.close();
        }
    }
    /**
     * @ignore 删除ti-dominator选中项时触发的事件
     * 需要取消树节点的选中
     */
    onDeleteDominatorTag(item) {
        const deletedItem = item.item;
        // 1.取消选中当前节点、设置子节点及祖先节点的选中情况。从model中删除时，item.item.checked还是为true，要设置为false
        this.setSelectState(deletedItem, !deletedItem.checked);
        // 2.设置为非全选
        this.isAllSelected = false;
        // 3.设置全选框状态
        if (this.multiple && this.selectAll) {
            item.model.length === 0 ? this.indeterminate = false : this.indeterminate = true;
        }
    }
    /**
     * @ignore ti-searchbox-notsearch搜索框内容变化时触发的事件
     */
    searchTextChange(searchText) {
        if (Util.isEmptyString(searchText)) {
            this.options = this.oldOptions;
            this.isInSearch = false;
        }
        else {
            // this.oldOptions 叶子浅拷贝
            const searchResult = TiTreeselectComponent.leafShallowClone(this.oldOptions);
            TiTreeUtil.search(searchResult, (cnode) => {
                return (cnode.label.indexOf(this.searchText) >= 0);
            });
            // 展开整个树
            TiTreeUtil.traverse(searchResult, (node) => {
                node.expanded = true;
            });
            this.options = searchResult;
            this.isInSearch = true;
        }
        if (this.multiple && this.selectAll) {
            this.setAllSelectCheckboxState();
        }
        // 重新设置面板定位
        this.setPosition(true);
    }
    /**
     * @ignore 从model中获取option所在的索引
     */
    getItemIndexFromModel(option) {
        let index = -1;
        index = this.model.findIndex((item) => {
            // 判断item和option的引用是否相同即可
            return (item === option);
        });
        return index;
    }
    /**
     * @ignore 获取需要放到model中的节点，根据规范，如果子节点全部选中了，需要在model中放入父节点或者祖先节点。找到第一个checked为true的节点即可
     * node: 树组件select事件中的参数
     */
    getRealSelectedNode(node) {
        // tslint:disable-next-line: no-null-keyword
        let selectedNode = null;
        const parentNode = TiTreeUtil.getParentNode(this.oldOptions, node);
        (parentNode && parentNode.checked === true) ? selectedNode = this.getRealSelectedNode(parentNode) : selectedNode = node;
        return selectedNode;
    }
    /**
     * @ignore 获取需要从model移除的节点，根据规范，如果某个子节点取消选中了，那么可能是它的父节点或祖先节点或所有子节点从model中被移除
     * node：树组件select事件的参数
     */
    getRealUnselectedNode(node) {
        // tslint:disable-next-line: no-null-keyword
        let unselectedNode = null;
        let parentNode = TiTreeUtil.getParentNode(this.oldOptions, node);
        if (this.getItemIndexFromModel(node) !== -1) {
            // 需要从model中移除的节点是node本身
            unselectedNode = node;
        }
        else {
            // 需要从model中移除的节点是node父节点或祖先节点
            // 当节点处于半选状态时,点击节点的复选框,节点状态为选中,否则为非选中,所以要先判断parentNode是否存在
            while (parentNode && this.getItemIndexFromModel(parentNode) === -1) {
                parentNode = TiTreeUtil.getParentNode(this.oldOptions, parentNode);
            }
            // parentNode可能为undefined
            unselectedNode = parentNode;
        }
        return unselectedNode;
    }
    /**
     * @ignore 取消选中时，获取被选中的子节点，根据规范，父节点或祖先节点被选中之后，如果取消了某个子节点的选中，那么需要把它的所有选中的子节点加入model中
     * unselectedNode：需要从model中移除的节点
     */
    // tslint:disable-next-line: prefer-function-over-method
    getSelectedChildren(unselectedNode) {
        let selectedChildren = [];
        if (unselectedNode.children) {
            unselectedNode.children.forEach((child) => {
                if (child.checked === true) {
                    selectedChildren.push(child);
                }
                else {
                    selectedChildren = selectedChildren.concat(this.getSelectedChildren(child));
                }
            });
        }
        return selectedChildren;
    }
    /**
     * @ignore 根据checked的值，设置option节点及其子节点和祖先节点的选中状态
     * option: 选中的节点；checked：option.checked属性，true/false
     */
    setSelectState(option, checked) {
        // 对oldOptions进行操作，将搜索时的结果映射回来
        TiTreeUtil.traverse(this.oldOptions, (node) => {
            if (node === option) {
                node.checked = checked;
                if (checked === true) {
                    TiTreeUtil.selectAllChildren(node);
                    TiTreeUtil.selectParents(node, this.oldOptions, true);
                }
                else {
                    TiTreeUtil.deSelectAllChildren(node);
                    TiTreeUtil.deSelectParents(node, this.oldOptions);
                }
            }
        });
    }
    /**
     * @ignore 选中某个节点后，更新this.model
     * option: 选中的节点
     */
    setModelWhenSelected(option) {
        // 1.获取option最后一个被选中的祖先节点
        const selectedNode = this.getRealSelectedNode(option);
        // 2.从model中删除selectNode的所有子节点，一直到叶子节点
        TiTreeUtil.traverse([selectedNode], (node) => {
            let deleteIndex = this.getItemIndexFromModel(node);
            while (deleteIndex !== -1) {
                this.model.splice(deleteIndex, 1);
                deleteIndex = this.getItemIndexFromModel(node);
            }
        });
        // 3.将selectedNode加入到this.model中
        if (this.getItemIndexFromModel(selectedNode) === -1) {
            this.model.push(selectedNode);
        }
    }
    /**
     * @ignore 取消选中某个节点后，更新this.model
     * option: 被取消选中的节点
     */
    setModelWhenUnselected(option) {
        // 1.获取需要从model中删除的节点
        const unselectedNode = this.getRealUnselectedNode(option);
        // 2.更新model
        if (unselectedNode) {
            // 2.1unselectedNode为option或option的祖先节点
            const deleteIndex = this.getItemIndexFromModel(unselectedNode);
            this.model.splice(deleteIndex, 1);
            // 将option所有选中的子节点存放到this.model中
            if (unselectedNode !== option) {
                const selectedChildren = this.getSelectedChildren(unselectedNode);
                this.model = this.model.concat(selectedChildren);
            }
        }
        else {
            // 2.2unselectedNode为undefined，这种情况下，只需从model中删除option所有选中的子节点
            TiTreeUtil.traverse([option], (node) => {
                const deleteIndex = this.getItemIndexFromModel(node);
                if (deleteIndex !== -1) {
                    this.model.splice(deleteIndex, 1);
                }
            });
        }
    }
    /**
     * @ignore 处于搜索状态下，更新model
     */
    setModelWhenSearch(data, checked) {
        // 或者所有处于checked状态的叶子节点
        let selectedLeafNodes = [];
        selectedLeafNodes = this.getLeafNodes(data, checked);
        // 根据每个叶子节点更新model
        for (const leafNode of selectedLeafNodes) {
            // 设置oldOptions各节点状态
            this.setSelectState(leafNode, checked);
            checked ? this.setModelWhenSelected(leafNode) : this.setModelWhenUnselected(leafNode);
        }
    }
    /**
     * @ignore 获取data里面选中或者未选中的全部叶子节点
     * data：搜索范围，checked：true/false
     */
    // tslint:disable-next-line: prefer-function-over-method
    getLeafNodes(data, checked) {
        const leafNodes = [];
        TiTreeUtil.traverse(data, (node) => {
            if (TiTreeUtil.isLeaf(node) && node.checked === checked) {
                leafNodes.push(node);
            }
        });
        return leafNodes;
    }
    /**
     * @ignore 设置全选checkbox的状态
     */
    setAllSelectCheckboxState() {
        // 1.假设节点都被选中或都没被选中
        let isAllSelected = true;
        let isAllUnSelected = true;
        // 2.判断是否所有节点都被选中或都没被选中，disabled状态下的节点不用统计
        TiTreeUtil.traverse(this.options, (node) => {
            // 2.1 有节点没被选中
            if (!node.disabled && node.checked !== true) {
                isAllSelected = false;
            }
            // 2.2 有节点被选中或半选中
            if (!node.disabled && (node.checked === true || node.checked === 'indeterminate')) {
                isAllUnSelected = false;
            }
        });
        // 3.设置checkbox状态
        this.isAllSelected = isAllSelected;
        this.indeterminate = !isAllSelected && !isAllUnSelected;
    }
    /**
     * @ignore ti-tree的select事件
     */
    onTreeSelect(option) {
        // 节点被禁用，不做操作，直接返回
        if (option.disabled === true) {
            return;
        }
        // 1.触发select事件
        this.select.emit(option);
        if (!this.multiple) {
            // 2.1单选，直接替换model
            TiTreeUtil.traverse(this.oldOptions, (node) => {
                if (node === option) {
                    node.checked = true;
                    this.model = [option];
                }
                else {
                    node.checked = false;
                }
            });
            // 关闭下拉面板
            this.close();
        }
        else {
            // 2.2多选
            if (!this.isInSearch) {
                // 2.2.1非搜索状态
                // 设置oldOptions各节点状态
                this.setSelectState(option, option.checked);
                if (option.checked === true) {
                    this.setModelWhenSelected(option);
                }
                else {
                    this.setModelWhenUnselected(option);
                }
            }
            else {
                // 2.2.2搜索状态
                this.setModelWhenSearch([option], option.checked);
            }
            // 2.3手动触发ngModelChange事件，splice和push无法触发
            this.model = this.model.concat();
            // 2.4设置全选状态
            if (this.selectAll) {
                this.setAllSelectCheckboxState();
            }
        }
        // 3.重新设置ti-dominator高度
        this.setPosition();
    }
    /**
     * @ignore 全选复选框的按钮事件
     */
    onSelectAllChange(isAllSelected) {
        // 1.将当前tree节点全部选中 或 不选中
        TiTreeUtil.traverse(this.options, (node) => {
            if (!node.disabled) {
                node.checked = isAllSelected;
            }
        });
        // 2.设置model
        if (!this.isInSearch) {
            // 2.1 未处于搜索状态下，使用concat进行单层深拷贝
            (!this.isAllSelected) ? this.model = this.options.concat() : this.model = [];
        }
        else {
            // 2.2  处于搜索状态下
            this.setModelWhenSearch(this.options, isAllSelected);
            // 手动触发ngModelChange事件
            this.model = this.model.concat();
        }
    }
    /**
     * @ignore 全选复选框的点击事件
     */
    onClickSelectAll(event) {
        // 点击时，this.isAllSelected为false，所以要取反
        this.onSelectAllChange(!this.isAllSelected);
        event.preventDefault();
    }
    /**
     * @ignore
     * 失焦情况下，仅关闭面板，不做聚焦等处理
     */
    onBlur() {
        this.closeWithoutFocus();
    }
    /**
     * @ignore
     * 鼠标点击到空白，原本会失焦，此处通过阻止默认事件的方式进行了处理
     */
    onMouseDownDropOuter(event) {
        event.preventDefault();
    }
    /**
     * @ignore
     * #datatemplate内部滚动条会引起外部滚动条事件触发，引起弹框内的树下拉组件无法使用鼠标拖动滚动条，因此此处阻止事件冒泡
     */
    onMouseWheel(event) {
        event.stopPropagation();
    }
}
// 搜索框的高度
TiTreeselectComponent.SEARCHBOX_HEIGHT = 30;
TiTreeselectComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-treeselect',
                template: "<ti-dominator\r\n        [dropshow]=\"dropCom.isShow\"\r\n        [multiple]='true'\r\n        [placeholder]='placeholder'\r\n        [disabled]=\"disabled\"\r\n        [labelKey]=\"labelKey\"\r\n        [maxLine]=\"maxLine\"\r\n        [selectedTipPosition]='selectedTipPosition'\r\n        [id]=\"appendId('dominator')\"\r\n        [(ngModel)]=\"model\"\r\n        (click)=\"onClickDominator()\"\r\n        (delete)=\"onDeleteDominatorTag($event)\">\r\n</ti-dominator>\r\n\r\n<ti-drop\r\n        [dominatorElem]='dominatorCom.nativeElement'\r\n        [dominatorSpace]=\"dominatorSpace\"\r\n        [panelWidth]=\"panelWidth\"\r\n        [id]=\"appendId('drop')\">\r\n        <!-- \u641C\u7D22 -->\r\n        <ti-searchbox-notsearch #searchboxCom *ngIf='searchable' noBorder\r\n                class=\"ti3-treeselect-searchbox\"\r\n                [placeholder]='searchPlaceholder'\r\n                [(ngModel)]='searchText'\r\n                [id]=\"appendId('searchbox')\"\r\n                (ngModelChange)=\"searchTextChange($event)\">\r\n        </ti-searchbox-notsearch>\r\n        <section #datatemplate class='ti3-treeselect-datacontainer'\r\n                (mousedown)=\"onMouseDownDropOuter($event)\"\r\n                (mousewheel)=\"onMouseWheel($event)\"\r\n                (DOMMouseScroll)=\"onMouseWheel($event)\">\r\n                <ng-container *ngIf='(options && options.length > 0) else nodatatemplate'>\r\n                        <!-- \u5168\u9009 -->\r\n                        <li *ngIf='multiple && selectAll'\r\n                                class=\"ti3-treeselect-selectall-option\"\r\n                                (click)=\"onClickSelectAll($event)\"\r\n                                [id]=\"appendId('selectAll')\">\r\n                                <input type=\"checkbox\" tiCheckbox [indeterminate]=\"indeterminate\" [(ngModel)]=\"isAllSelected\" (ngModelChange)=\"onSelectAllChange($event)\" label=\"\u5168\u9009\">\r\n                        </li>\r\n                        <ti-tree\r\n                                [id]=\"appendId('tree')\"\r\n                                [data]='options'\r\n                                [parentCheckable]='true'\r\n                                [multiple]='multiple'\r\n                                (select)='onTreeSelect($event)'\r\n                                [changedByCheckbox]=\"false\">\r\n                        </ti-tree>\r\n                </ng-container>\r\n        </section>\r\n</ti-drop>\r\n\r\n<!-- no data\u6A21\u677F -->\r\n<ng-template #nodatatemplate>\r\n        <div class=\"ti3-treeselect-dropdown-no-data\" [innerHtml]=\"noDataText\"></div>\r\n</ng-template>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiTreeselectComponent)],
                host: {
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}::ng-deep :root{--ti-treeselect-selectall-width:100%}:host{width:280px}ti-drop{outline:none}.ti3-treeselect-selectall-option{background-color:var(--ti-common-color-bg-white-normal);color:inherit;cursor:pointer;line-height:var(--ti-common-line-height-number);list-style:none;padding:var(--ti-common-space-6) var(--ti-common-space-2x);text-align:left}.ti3-treeselect-selectall-option:hover{background-color:var(--ti-common-color-bg-white-emphasize);color:var(--ti-common-color-text-highlight)}.ti3-treeselect-searchbox{width:var(--ti-treeselect-selectall-width)!important}.ti3-treeselect-datacontainer{box-sizing:border-box;max-height:inherit;overflow-x:hidden;overflow-y:auto;padding:var(--ti-common-space-base) 0}.ti3-treeselect-dropdown-no-data{color:var(--ti-common-color-text-disabled);cursor:not-allowed;line-height:var(--ti-common-line-height-number);padding:var(--ti-common-space-6) var(--ti-input-padding-horizontal)}"]
            },] }
];
TiTreeselectComponent.propDecorators = {
    dropMaxHeight: [{ type: Input }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, { static: true },] }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    searchboxCom: [{ type: ViewChild, args: ['searchboxCom',] }],
    dataTemplate: [{ type: ViewChild, args: ['datatemplate',] }]
};

class TiTreeselectModule {
}
TiTreeselectModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    TiDominatorModule, TiDropsearchModule, TiDropModule, TiTreeModule, TiSearchboxModule, TiCheckboxModule,
                    FormsModule,
                    CommonModule
                ],
                exports: [TiTreeselectComponent],
                declarations: [TiTreeselectComponent]
            },] }
];

// 上传文件服务，提供上传过程中的通用方法
/**
 * @ignore
 */
class TiUploadUtil {
    /**
     * 上传多个文件
     * 上传一个或多个文件item对象
     * 无
     */
    static uploadItems(items) {
        // 异常处理 1.入参不合法,2.正在上传的文件不允许重复上传
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i]) || items[i].isUploading) {
                items.splice(i, 1);
            }
        }
        TiUploadUtil.onBeforeSend(items); // 文件上传前处理
        for (let j = items.length - 1; j >= 0; j--) {
            if (items[j].isCancel) { // 已取消上传的文件不再上传(此处主要是对beforeSend中取消上传的文件进行处理)
                items.splice(j, 1);
            }
        }
        if (items.length > 0) {
            TiUploadUtil.isHTML5 ? TiUploadUtil.uploadXhr(items) : TiUploadUtil.uploadForm(items);
        }
    }
    /**
     * 取消队列中多个正在上传中的文件(只在上传时可取消)
     * 文件item对象数组
     * 无
     */
    static cancelItems(items) {
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i])) { // 异常处理:入参不合法情况下，不做处理
                items.splice(i, 1);
            }
            else {
                items[i].isCancel = true;
            }
        }
        if (items[0].isUploading) { // 正在上传过程中，取消上传，上传事件中，会处理响应赋值及事件触发
            TiUploadUtil.isHTML5 ? items[0]._xhr.abort() : items[0]._form.abort();
        }
        else { // 未在上传过程中情况下，依然触发cancel和complete事件
            const response = undefined;
            const status = 0;
            TiUploadUtil.onCancel(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        }
    }
    /**
     * 删除队列中单个或多个上传文件
     * 文件item对象数组
     */
    static removeItems(items) {
        const itemsArr = Object.assign({}, items);
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i])) {
                items.splice(i, 1);
            }
        }
        // 阻止文件上传进程
        if (items[0].isUploading) {
            TiUploadUtil.cancelItems(items);
        }
        // 删除队列中的文件对象及文件对象相关引用
        for (let j = items.length - 1; j >= 0; j--) {
            items[j].uploader.queue.splice(TiUploadUtil.getItemIndex(items[j]), 1);
            itemsArr[j].destroy();
        }
        // 触发外部定义的删除事件
        TiUploadUtil.onRemove(itemsArr);
    }
    /**
     * 触发onBeforeRemoveItems事件
     * 文件item对象数组
     */
    static onBeforeRemove(items) {
        TiUploadUtil.handleEvent('BeforeRemove', items);
    }
    /**
     * 获取文件对象 index值，获取该值用于后续判断item有效性
     * 上传文件item对象
     */
    static getItemIndex(item) {
        if (item && item.uploader) {
            return item.uploader.queue.findIndex((itemInQueue) => {
                return itemInQueue.index === item.index;
            });
        }
        return -1;
    }
    /**
     * 判断文件是否为有效文件
     * 上传文件item对象
     */
    static isValidFileItem(item) {
        return (TiUploadUtil.getItemIndex(item) !== -1);
    }
    // 生成上传数据
    static generateUploadData(items) {
        // 上传数据组装
        const uploadDataObj = new FormData();
        if (items[0].formDataFirst) { // formData先于文件信息情况下，先添加formData
            addFormData();
            addFile();
        }
        else { // formData后于文件信息情况下，后添加formData
            addFile();
            addFormData();
        }
        function addFile() {
            items.forEach((item) => {
                uploadDataObj.append(item.alias, item._file, item.file.name); // 添加上传文件
            });
        }
        function addFormData() {
            // 添加单个文件的formData对象,加入到上传对象中
            for (const key in items[0].formData) {
                if (items[0].formData.hasOwnProperty(key)) {
                    uploadDataObj.append(key, items[0].formData[key]);
                }
            }
        }
        return uploadDataObj;
    }
    static setXhr(xhr, items) {
        // 文件上传信息配置（使用XHR，支持跨域请求）
        xhr.upload.onprogress = (event) => {
            const lengthComputable = event.lengthComputable;
            const loaded = event.loaded;
            const total = event.total;
            const progress = Math.round(lengthComputable ? loaded * 100 / total : 0); // 读取当前进度信息
            TiUploadUtil.onProgress(items, progress);
        };
        xhr.onload = () => {
            const response = xhr.response;
            const status = xhr.status;
            if (TiUploadUtil.isSuccessCode(status)) {
                TiUploadUtil.onSuccess(items, response, status);
            }
            else {
                TiUploadUtil.onError(items, response, status);
            }
            TiUploadUtil.onComplete(items, response, status);
        };
        xhr.onerror = () => {
            const response = xhr.response;
            const status = xhr.status;
            TiUploadUtil.onError(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        };
        xhr.onabort = () => {
            const response = xhr.response;
            const status = xhr.status;
            TiUploadUtil.onCancel(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        };
        // 设置单个item的_xhr,该对象用于操作单个item的上传取消等处理
        items.forEach((item) => {
            item._xhr = xhr;
        });
    }
    static setheaders(xhr, items) {
        // 设置请求头
        for (const key in items[0].headers) {
            if (items[0].headers.hasOwnProperty(key)) {
                xhr.setRequestHeader(key, items[0].headers[key]);
            }
        }
    }
    /**
     * xhr方式上传文件
     * 上传一个或多个文件item对象，上传单个文件的情况下
     */
    static uploadXhr(items) {
        const uploadDataObj = TiUploadUtil.generateUploadData(items); // 组装上传对象
        // 生成并设置xhr
        const xhr = new XMLHttpRequest();
        TiUploadUtil.setXhr(xhr, items);
        // 开始上传
        xhr.open(items[0].method, items[0].url, true);
        TiUploadUtil.setheaders(xhr, items);
        xhr.send(uploadDataObj);
        // 设置对象的上传状态
        items.forEach((item) => {
            item.isUploading = true;
        });
    }
    static uploadForm(items) {
        const form = document.createElement('form');
        form.style.display = 'none';
        for (const item of items) {
            // 清除原有form表单
            if (item._form) {
                item._form.parentNode.replaceChild(items[0]._input, items[0]._form); // 清除先前对应的form表单对象，确保上传文件表单元素外层不被form包裹
            }
            item._form = form; // 保存当前form
        }
        items[0]._input.parentNode.insertBefore(form, items[0]._input); // form插入inputSubmit之前，使其在页面显示
        if (items[0].formDataFirst) { // formData先于文件信息情况下，先添加formData
            addFormData();
            addFile();
        }
        else { // formData后于文件信息情况下，后添加formData
            addFile();
            addFormData();
        }
        // 文件信息组装
        function addFile() {
            for (const item of items) {
                const inputSubmit = item._input;
                inputSubmit.setAttribute('name', item.alias);
                form.appendChild(inputSubmit); // 在form中添加上传文件元素
            }
        }
        // formData信息组装
        function addFormData() {
            for (const key in items[0].formData) {
                if (items[0].formData.hasOwnProperty(key)) {
                    const formDataDomItem = document.createElement('input');
                    formDataDomItem.setAttribute('type', 'hidden');
                    formDataDomItem.setAttribute('name', key);
                    formDataDomItem.value = items[0].formData[key];
                    form.appendChild(formDataDomItem);
                }
            }
        }
        // 生成iframe元素，并将form表单和iframe元素结合
        const iframe = document.createElement('iframe');
        const name = Util.getUniqueId('tiFileIframe'); // 确保iframe唯一性，保证各文件上传最终能独立返回到相应的iframe
        iframe.setAttribute('name', name);
        form.setAttribute('action', items[0].url);
        form.setAttribute('method', items[0].method);
        form.setAttribute('target', name);
        form.setAttribute('enctype', 'multipart/form-data');
        form.appendChild(iframe);
        // 表单提交
        form.submit();
        // 设置对象的上传状态
        items.forEach((item) => {
            item.isUploading = true;
        });
        // 设置假进度
        let newProgress = 0;
        const progressInterval = setInterval(() => {
            if (newProgress !== 98) {
                newProgress += 2;
                this.onProgress(items, newProgress);
            }
        }, 10);
        // 表单完成事件
        const loadEvent = () => {
            let response = '';
            let status = 200;
            clearInterval(progressInterval);
            this.onProgress(items, 100);
            try {
                response = iframe.contentDocument.body.innerHTML; // 后台正常返回情况获取返回结果
                this.onSuccess(items, response, status);
            }
            catch (e) {
                response = e;
                status = 520; // 为方便使用者处理，失败情况下，统一返回520状态码 未知错误
                this.onError(items, response, status);
            }
            this.onComplete(items, response, status);
        };
        iframe.addEventListener('load', loadEvent);
        // 表单取消方法定义
        form.abort = () => {
            clearInterval(progressInterval);
            iframe.removeEventListener('load', loadEvent); // 去除load事件
            // 表单元素还原
            for (const node of form.childNodes) {
                if (node.tagName !== 'IFRAME') {
                    if (form.parentNode.lastChild === form) {
                        form.parentNode.appendChild(node);
                    }
                    else {
                        form.parentNode.insertBefore(node, form.nextSibling);
                    }
                }
            }
            form.remove();
            items.forEach((item) => {
                /* tslint:disable:no-null-keyword */
                item._form = null;
            });
            const status = 0;
            const response = undefined;
            this.onCancel(items, response, status);
            this.onComplete(items, response, status);
        };
    }
    static isSuccessCode(status) {
        // 和ajax请求一致，304 代表客户端已经执行了GET，但文件未变化
        return status >= 200 && status < 300 || status === 304;
    }
    /**
     * 上传前处理
     * 上传一个或多个文件item对象
     */
    static onBeforeSend(items) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            item.isReady = true;
            item.isUploading = false;
            item.isUploaded = false;
            item.isSuccess = false;
            item.isError = false;
            item.isCancel = false;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('BeforeSend', items);
    }
    static handleEvent(type, items, params = []) {
        const onEventTypeItems = items[0].uploader.config && items[0].uploader.config[`on${type}Items`];
        if (onEventTypeItems && (typeof onEventTypeItems === 'function')) {
            // eslint-disable-next-line no-useless-call
            onEventTypeItems.apply(null, [items, ...params]);
        }
    }
    static onProgress(items, progress) {
        TiUploadUtil.handleEvent('Progress', items, [progress]);
        for (const item of items) {
            item.progress = progress; // 设置单个文件的进度信息
        }
    }
    static onSuccess(items, response, status) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = true;
            item.isSuccess = true;
            item.isError = false;
            item.isCancel = false;
            item.progress = 100;
        }
        TiUploadUtil.handleEvent('Success', items, [response, status]);
    }
    static onError(items, response, status) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            // 设置当前上传文件的状态信息
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = true;
            item.isSuccess = false;
            item.isError = true;
            item.isCancel = false;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('Error', items, [response, status]);
    }
    static onComplete(items, response, status) {
        // 置位状态
        items.forEach((item) => {
            item.isUploading = false;
        });
        // 上传下一个文件，对于同一序列的上传文件来说，其isReady状态均已被标识，因此此处可以通过该方法进行筛选
        const readyItemsArr = items[0].uploader.getReadyItems();
        if (readyItemsArr && (readyItemsArr.length !== 0)) {
            this.uploadItems([readyItemsArr[0]]);
        }
        else {
            // 本次上传序列中，所有文件上传完成后回调，因为文件上传是串行上传：
            // 在一个文件上传完成后才执行下一个文件的上传操作，所以此处可以确保同一序列最终的上传完成
            TiUploadUtil.handleEvent('CompleteAll', items, [response, status]);
        }
        TiUploadUtil.handleEvent('Complete', items, [response, status]);
    }
    static onCancel(items, response, status) {
        for (const item of items) {
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = false;
            item.isSuccess = false;
            item.isError = false;
            item.isCancel = true;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('Cancel', items, [response, status]);
    }
    static onRemove(items) {
        TiUploadUtil.handleEvent('Remove', items);
    }
}
// 已支持SSR
TiUploadUtil.isHTML5 = (typeof window !== 'undefined') && (window.File && window.FormData);

/**
 * 该指令适用于自定义上传场景，指令定义在input type='file'元素上，传入的是文件上传实例
 * 文件上传实例的生成，请参考[TiUploadService.create]{@link ../injectables/TiUploadService.html#create}
 *
 * 除自定义使用方式外，Tiny还提供了两种已进行设计的上传组件供业务使用，具体见[TiUploadComponent]{@link ../components/TiUploadComponent.html}
 *
 * <example-url>../tiny3demo/#/upload/upload-all</example-url>
 */
class TiFileSelectDirective {
    constructor(hostElementRef, renderer) {
        this.hostElementRef = hostElementRef;
        this.renderer = renderer;
        this.nativeElement = this.hostElementRef.nativeElement;
        this.fileChangeEvent = this.renderer.listen(this.nativeElement, 'change', () => {
            if (!this.tiFileSelect) { // 配置的上传文件实例不存在情况下，不做后续处理
                return;
            }
            this.onFileChange(this.nativeElement); // 点选文件后的处理
        });
    }
    /**
     * @ignore
     * 选择文件后，根据浏览器差异进行处理
     */
    onFileChange(fileSel) {
        const uploadInst = this.tiFileSelect;
        const files = TiUploadUtil.isHTML5 ? fileSel.files : fileSel; // 获取文件信息
        const addedItems = uploadInst._addToQueue(files); // 文件选择队列
        if (TiUploadUtil.isHTML5) { // H5情况下，重置表单元素值，确保可重复选择文件
            this.nativeElement.value = '';
        }
        else { // 非H5情况下，确保文件下次可继续选择,分两种情况：1.已选文件有效情况下，,重新替换表单元素，确保文件点选元素不会随表单上传消失；
            // 2.文件未加入到队列（文件校验失败情况）情况下，重置点选表单，确保文件可重复选择（校验失败可能是文件队列长度不符，所以为确保用户体验，执行该操作）
            const isRemoveInput = (addedItems.length === 0); // 根据文件是否有效情况确定是否移除input
            this.replaceFileInput(fileSel, isRemoveInput);
        }
        // 自动上传情况下，进行文件上传
        if (uploadInst.config.autoUpload !== false && (addedItems.length !== 0)) {
            uploadInst.uploadItems(addedItems);
        }
    }
    /**
     * @ignore
     * 替换单个文件选择按钮，确保后续文件选择可继续点选
     * 当前文件选择框
     * 文件选择实例对象
     */
    replaceFileInput(fileSel, isRemoveInput) {
        // 清除当前文件输入框选择事件
        this.fileChangeEvent();
        // 新增input,并处理当前input
        const fileSelNew = fileSel.cloneNode(); // 文件元素克隆时,不会复用原有已选文件信息
        if (isRemoveInput) { // 文件选择无效情况下移除input，确保下次可正常选择
            fileSel.parentNode.appendChild(fileSelNew);
            fileSel.remove();
        }
        else {
            fileSel.style.display = 'none'; // 隐藏已选文件，确保点选框页面呈现的唯一性
            fileSel.parentNode.insertBefore(fileSelNew, fileSel.nextSibling); // 点选文件已放入文件队列中,替换新的文件选择按钮，确保下次点选生效
        }
        // 增加当前input事件
        this.fileChangeEvent = this.renderer.listen(fileSelNew, 'change', () => {
            this.onFileChange(fileSelNew);
        });
    }
}
TiFileSelectDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiFileSelect]'
            },] }
];
TiFileSelectDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiFileSelectDirective.propDecorators = {
    tiFileSelect: [{ type: Input }]
};

// 单个文件对象服务封装，包括文件基本信息统一、文件状态信息、文件基本方法封装
/**
 * @ignore
 */
class TiFileItemUtil {
    /**
     * 创建文件对象，该返回值用作后续文件的上传和文件操作，可作为文件回调参数传递
     * fileObject 文件信息对象
     * fileOrInpt 原始文件对象 H5下为file对象，非H5下为fileInput
     * config 文件上传配置信息
     * uploader 上传文件对应的文件实例
     * return 文件对象
     */
    static createFileItem(tifileObject, fileOrInput, config, uploader) {
        /* tslint:disable:no-invalid-this */
        /* tslint:disable:no-null-keyword */
        function upload() {
            TiUploadUtil.uploadItems([this]);
        }
        function cancel() {
            TiUploadUtil.cancelItems([this]);
        }
        function remove(isRemove) {
            if (isRemove) {
                // 触发外部定义的删除前的事件
                TiUploadUtil.onBeforeRemove([this]);
                return;
            }
            TiUploadUtil.removeItems([this]);
        }
        function destroy() {
            if (this._input) { // 删除页面残留dom
                this._input.remove();
            }
            if (this._form) {
                this._form.remove();
            }
            this._input = null; // 清除引用
            this._form = null;
        }
        // 上传文件对象赋值
        let _file = null;
        let _input = null;
        if (!(fileOrInput instanceof Element)) {
            _file = fileOrInput;
        }
        else {
            _input = fileOrInput;
        }
        return {
            url: config.url || '/',
            file: tifileObject,
            alias: config.alias || 'tiFile',
            _file,
            _input,
            formData: config.formData || {},
            formDataFirst: config.formDataFirst || false,
            headers: config.headers || {},
            method: config.method || 'post',
            batchSend: config.batchSend || false,
            uploader,
            upload,
            cancel,
            remove,
            destroy,
            isReady: false,
            isUploading: false,
            isUploaded: false,
            isCancel: false,
            isSuccess: false,
            isError: false,
            progress: 0,
            isHover: false,
            isOverflow: false,
            _xhr: {},
            index: 0,
            _form: undefined
        };
    }
    /**
     * 创建文件对象，统一H5和非H5情况下的文件信息
     * file {FileList|FileInput} 原始文件对象 H5为file对象形式，非H5为fileinput对象
     * return 类文件对象
     */
    static createFileObject(fileThis) {
        if (TiUploadUtil.isHTML5) {
            const fileName = fileThis.name;
            return {
                lastModifiedDate: fileThis.lastModifiedDate,
                size: fileThis.size,
                sizeWithUnit: TiFileItemUtil.formatSize(fileThis.size),
                name: fileThis.name,
                type: fileName.slice(fileName.lastIndexOf('.') + 1)
                    .toLowerCase(),
                _file: fileThis,
                _input: null // 文件input对象，只在IE9 form表单提交方式下有效
            };
        }
        const path = fileThis.value;
        // 非H5情况下,浏览器不打开ActiveX,获取不到文件大小,该种情况下文件大小为null
        const fileSize = Util.isUndefined(fileThis.size) ? null : fileThis.size;
        return {
            lastModifiedDate: null,
            size: fileSize,
            sizeWithUnit: isNaN(fileSize) ? '' : this.formatSize(fileSize / 1024),
            name: path.slice(path.lastIndexOf('/') + path.lastIndexOf('\\') + 2),
            type: path.slice(path.lastIndexOf('.') + 1)
                .toLowerCase(),
            _file: null,
            _input: fileThis // 文件input对象，只在IE9 form表单提交方式下有效
        };
    }
    /**
     * 将文件大小显示标准化：根据文件大小做不同单位的显示，文件大小保留两位小数
     * 文件大小
     * 带单位文件大小
     */
    static formatSize(size) {
        let sizeWithUnit;
        const kbSize = size / 1024;
        /* tslint:disable:prefer-conditional-expression */
        if (kbSize < 1) {
            sizeWithUnit = size.toFixed(2) + 'B';
        }
        else if (kbSize < 1024) {
            sizeWithUnit = kbSize.toFixed(2) + 'KB';
        }
        else if (kbSize < 1024 * 1024) {
            sizeWithUnit = (kbSize / 1024).toFixed(2) + 'MB';
        }
        else {
            sizeWithUnit = (kbSize / 1024 / 1024).toFixed(2) + 'GB';
        }
        return sizeWithUnit;
    }
}

/**
 * @ignore
 * 此TiUploadServiceModule不对用户暴露，用户仅需import TiUploadModule，则间接引入了TiUploadServiceModule
 */
class TiUploadServiceModule {
}
TiUploadServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ]
            },] }
];

// 文件上传服务封装，一个实例对应一个上传文件队列
// @dynamic
/**
 * 文件上传服务，通过该服务生成上传文件实例对象，一个实例对应一个上传文件队列
 *
 * 该服务适用于自定义文件上传实例方式，使用该服务时需要引入模块TiUploadServiceModule，与[tiFileSelect]{@link ../directives/TiFileSelectDirective.html}配合使用
 *
 * 除自定义使用方式外，Tiny还提供了两种已设计的上传样式供业务使用，具体见[TiUploadComponent]{@link ../components/TiUploadComponent.html}
 *
 * <example-url>../tiny3demo/#/upload/upload-all</example-url>
 */
class TiUploadService {
    /**
     * 对单选进行过滤条件重置，单选去除maxCount条件，函数返回过滤后的生效规则
     */
    static initFilter(rules, isSingleFile) {
        if (isSingleFile) { // 单文件情况下去除maxCount设置
            return rules.filter((rule) => {
                return rule.name !== 'maxCount';
            });
        }
        // 多文件情况下 filter不做处理
        return rules || [];
    }
    /**
     * 根据用户配置的maxCount过滤条件，判断文件是否为单文件上传
     * 用户配置的过滤条件
     * 是否为单文件上传
     */
    static isSingleFileFn(filters) {
        if (!filters || !filters.length) { // 不设置filter情况下，为多文件上传
            return false;
        }
        const maxCountIndex = filters.findIndex((item) => {
            return item.name === 'maxCount';
        });
        // 存在maxCount规则，并且其参数不为1的情况下，为多文件上传
        if (maxCountIndex === -1 || (filters[maxCountIndex].params && filters[maxCountIndex].params[0] !== 1)) {
            return false;
        }
        return true;
    }
    /**
     * 批量上传文件
     *   {Array} 上传文件items数组
     * 返回 无
     */
    static uploadItems(items) {
        if (!items.length) {
            return;
        }
        // 设置上传文件标志位,文件逐个上传情况下,会根据该标志位决定下个上传文件
        items.forEach((item) => {
            item.isReady = true;
        });
        // 开始上传文件
        if (items[0].batchSend) {
            TiUploadUtil.uploadItems(items);
        }
        else { // 上传单个文件，在upload方法中会依据isReady的设置进行其他文件的串行上传
            TiUploadUtil.uploadItems([items[0]]);
        }
    }
    /**
     * 批量取消上传文件
     * 返回 无
     */
    static cancelItems(items) {
        if (!items.length) {
            return;
        }
        if (items[0].batchSend) { // 一个链接上传情况下，一次取消多个items，仅触发一次事件
            TiUploadUtil.cancelItems(items);
        }
        else { // 逐个链接上传情况下，一次仅取消一个items，触发多次事件
            items.forEach((item) => {
                item.cancel();
            });
        }
    }
    /**
     * 批量删除文件,只涉及上传队列的文件删除，具体的后台删除还需要产品向后台发送文件删除请求实现
     *   {Array} 上传文件items数组
     * 返回 无
     */
    static removeItems(items) {
        if (!items.length) {
            return;
        }
        if (items[0].batchSend) { // 一个链接上传情况下，一次删除多个items，仅触发一次事件
            TiUploadUtil.removeItems(items);
        }
        else { // 逐个链接上传情况下，一次仅删除一个items，触发多次事件
            items.forEach((item) => {
                item.remove();
            });
        }
    }
    /**
     * 单个文件的有效性校验
     * 返回 {Array} 由不符合的规则name组成的数组
     */
    static getInvalidRules(tifileObject, filtersRules, fileQueue) {
        // 无效判断
        const filterLen = filtersRules.length;
        if (filterLen === 0) {
            return [];
        }
        // 逐条规则校验，并返回结果数组
        const invalidRetArr = []; // 校验返回结果数组，该数组中返回的是不符合的校验规则name
        for (let i = 0; i < filterLen; i++) {
            const filterConfig = filtersRules[i]; // 单条校验规则配置
            // 根据配置寻找规则函数（规则分为默认规则 和 自定义规则）
            const filterName = filterConfig.name; // 配置规则名称
            let ruleFn; // 规则函数
            if (typeof filterConfig.fn === 'function') {
                ruleFn = filterConfig.fn;
            }
            else if (TiUploadService.filterRules[filterName]) { // 未定义fn的情况下，从默认规则中找
                ruleFn = TiUploadService.filterRules[filterName];
            }
            // 调用规则函数，判断文件有效性
            if ((typeof ruleFn === 'function') &&
                !ruleFn(tifileObject, filterConfig.params, fileQueue)) {
                invalidRetArr.push(filterName);
            }
        }
        return invalidRetArr;
    }
    /**
     * 获取未上传文件队列
     */
    static getNotUploadedItems(fileQueue) {
        return fileQueue.filter((item) => {
            return !item.isUploaded;
        });
    }
    /**
     * 获取待上传文件，该方法用于文件批量上传时获取上传文件队列
     * 返回 {Array} 返回待上传文件，且文件队列返回值是根据文件点选次序排列
     */
    static getReadyItems(fileQueue) {
        return fileQueue.filter((item) => {
            return item.isReady && !item.isUploading;
        })
            .sort((item1, item2) => {
            return item1.index - item2.index;
        });
    }
    /**
     * 获取上传失败文件，该方法用于文件批量上传时获取上传失败文件队列
     * 返回 {Array} 返回上传失败文件，且文件队列返回值是根据文件点选次序排列
     */
    static getErrorItems(fileQueue) {
        return fileQueue.filter((item) => {
            return item.isError;
        })
            .sort((item1, item2) => {
            return item1.index - item2.index;
        });
    }
    /**
     * 重新上传列表中所有先前上传错误文件
     * 返回 无
     */
    static reloadAllError(fileQueue) {
        TiUploadService.uploadItems(TiUploadService.getErrorItems(fileQueue));
    }
    /**
     * 重新上传列表中所有文件
     * 返回 无
     */
    static reloadAll(fileQueue) {
        TiUploadService.uploadItems(fileQueue);
    }
    /**
     * 上传列表中所有未上传过的文件
     * 返回 无
     */
    static uploadAll(fileQueue) {
        const items = this.getNotUploadedItems(fileQueue)
            .filter((item) => {
            return !item.isUploading;
        });
        TiUploadService.uploadItems(items);
    }
    /**
     * 判断是否有未上传的
     * 返回 boolean
     */
    static isUploadedAll(fileQueue) {
        const items = this.getNotUploadedItems(fileQueue)
            .filter((item) => {
            return !item.isUploading;
        });
        return items.length === 0;
    }
    /**
     * 删除所有队列中的文件
     */
    static removeAll(fileQueue) {
        while (fileQueue.length !== 0) {
            fileQueue[0].remove();
        }
    }
    /**
     * 取消所有队列中的文件(未上传和待上传文件)
     */
    static cancelAll(fileQueue) {
        const items = this.getNotUploadedItems(fileQueue);
        TiUploadService.cancelItems(items);
    }
    /**
     * 创建文件上传实例
     */
    create(config) {
        const isSingleFile = TiUploadService.isSingleFileFn(config.filters); // 文件是否为单文件设置
        const filters = TiUploadService.initFilter(config.filters, isSingleFile); // 文件校验过滤规则
        let uploader;
        const fileQueue = []; // 文件队列列表，一个实例对应一个文件列表
        let fileIndex = 0; // 文件次序定义，用作文件索引
        /**
         * 将选择的文件进行有效验证后加入到队列中,外部调用该方法时,认为该队列中的文件和当前uploader的配置项一致
         *   files {FileList|FileInput} 文件对象
         * 返回 {Array} 已添加文件数组
         */
        const addToQueue = (files) => {
            // 循环列表添加文件
            const addedItems = []; // 用于记录本次选择文件列表
            if (files && !Util.isUndefined(files.length)) { // H5方式
                for (let i = 0; i < files.length; i++) {
                    addItem(files[i], addedItems);
                }
            }
            else {
                addItem(files, addedItems);
            }
            return addedItems;
        };
        const addItem = (fileOrInput, addedItems) => {
            // 文件对象，该对象包含文件的基本信息，统一了浏览器的差异性，会在文件过滤失败回调中作为参数传递给外部
            const tifileObject = TiFileItemUtil.createFileObject(fileOrInput);
            // 校验单个文件的有效性，并根据校验结果进行文件操作
            const invalidArr = TiUploadService.getInvalidRules(tifileObject, filters, fileQueue); // 校验结果数组，数组中定义校验错误规则的name
            let isValid = !invalidArr.length; // 校验结果返回数组为空时有效
            // 单文件情况下，需要覆盖原有有效文件
            if (isSingleFile) {
                if (fileQueue[0]) {
                    fileQueue[0].remove(); // 删除先前队列中的文件
                }
                if (invalidArr.length === 0) {
                    isValid = true; // 置位校验结果值
                }
            }
            if (isValid) { // 校验成功情况下，将文件加入到上传队列中，并触发
                // 上传文件对象,该对象中包含文件及状态信息等,在回调中传递
                const fileItem = TiFileItemUtil.createFileItem(tifileObject, fileOrInput, config, uploader);
                addedItems.push(fileItem);
                fileQueue.push(fileItem);
                fileItem.index = ++fileIndex; // 文件序列数增加，确保整个文件队列中该值唯一
                if (typeof config.onAddItemSuccess === 'function') {
                    config.onAddItemSuccess(fileItem);
                }
            }
            else if (typeof config.onAddItemFailed === 'function') {
                config.onAddItemFailed(tifileObject, invalidArr);
            }
        };
        uploader = {
            queue: fileQueue,
            isSingleFile,
            config,
            _addToQueue: addToQueue,
            getNotUploadedItems() {
                return TiUploadService.getNotUploadedItems(fileQueue);
            },
            getReadyItems() {
                return TiUploadService.getReadyItems(fileQueue);
            },
            uploadAll() {
                TiUploadService.uploadAll(fileQueue);
            },
            isUploadedAll() {
                return TiUploadService.isUploadedAll(fileQueue);
            },
            removeAll() {
                TiUploadService.removeAll(fileQueue);
            },
            cancelAll() {
                TiUploadService.cancelAll(fileQueue);
            },
            reloadAll() {
                TiUploadService.reloadAll(fileQueue);
            },
            reloadAllError() {
                TiUploadService.reloadAllError(fileQueue);
            },
            uploadItems: TiUploadService.uploadItems,
            removeItems: TiUploadService.removeItems,
            cancelItems: TiUploadService.cancelItems // 取消队列中某几项文件
        };
        return uploader;
    }
}
// 文件校验规则定义
TiUploadService.filterRules = {
    maxSize: (fileObj, params) => {
        const size = fileObj.size;
        if (!Util.isNumber(size)) { // 文件大小获取不到情况下，忽略该条校验规则
            return true;
        }
        return !(size > params[0]);
    },
    minSize: (fileObj, params) => {
        const size = fileObj.size;
        if (!Util.isNumber(size)) { // 文件大小获取不到情况下，忽略该条校验规则
            return true;
        }
        return !(size < params[0]);
    },
    type: (fileObj, params) => {
        // param参数需使用文件扩展名分开，为了确保各浏览器的一致性，文件类型使用扩展名判断，如果产品需要在选择时限制，请在input上设置accept属性
        let isValidType = false;
        params[0].split(',')
            .forEach((type) => {
            if (fileObj.name.match(new RegExp(`.(${type.replace(/\./g, '\\.')})$`, 'i')) !== null) {
                isValidType = true;
            }
        });
        return isValidType;
    },
    maxCount: (fileObj, params, fileQueue) => {
        return !(fileQueue.length >= params[0]);
    }
};
TiUploadService.ɵprov = ɵɵdefineInjectable({ factory: function TiUploadService_Factory() { return new TiUploadService(); }, token: TiUploadService, providedIn: TiUploadServiceModule });
TiUploadService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiUploadServiceModule
            },] }
];

/**
 * 10.0.2版本抽取
 *
 * upload基类，继承于TiBaseComponent组件
 */
class TiUploadbaseComponent extends TiBaseComponent {
    constructor(hostRef, renderer) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        /**
         * 上传方式，可选值为：get/post(其他方式IE9不支持，因此暂不开放)
         */
        this.method = 'post';
        /**
         * 向后台发送请求时对应的文件对象name属性，该name属性是后台读取文件的入口值
         */
        this.alias = 'tiFile';
        /**
         * 上传对象信息中，formData是否先于file对象，适用于后台传输时，formData数据先于file对象的场景
         */
        this.formDataFirst = false;
        /**
         * 文件选中后是否自动上传
         */
        this.autoUpload = true;
        /**
         * 文件上传是否 是否一次请求传输多个文件，默认情况下一次请求上传一个文件
         */
        this.batchSend = false;
        /**
         * 是否禁用
         */
        this.disabled = false;
        /**
         * @ignore
         */
        this.title = TiBrowser.isChrome() ? ' ' : ''; // 禁用文件上传默认tip提示,Chrome下设置title为""时会显示默认提示，所以Chrome下需要设置为" ";而IE下设置为" "会显示文本为空的tip
        /**
         * 文件添加失败回调，可使用该回调定义上传错误提示
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * file: [TiFileInfo]{@link ../interfaces/TiFileInfo.html}, // 上传文件信息
         *
         * validResults: Array&lt;string&gt;  // 校验不合法的规则name数组
         *
         * }
         */
        this.addItemFailed = new EventEmitter();
        /**
         * 文件添加成功回调
         *
         * 参数：文件对象
         */
        this.addItemSuccess = new EventEmitter();
        // 以下回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
        /**
         * 上传文件前回调，可在该回调中动态设置formData
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为数组形式，代表上传的文件对象
         */
        this.beforeSendItems = new EventEmitter();
        /**
         * 上传文件进度改变回调
         *
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * fileItems: Array<[TiFileItem]{@link ../interfaces/TiFileItem.html}>, // 上传文件对象数组
         *
         * progress: number  // 进度信息
         *
         * }
         */
        this.progressItems = new EventEmitter();
        /**
         * 文件上传完成回调，成功/失败都会触发
         *
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * fileItems: Array<[TiFileItem]{@link ../interfaces/TiFileItem.html}>, // 上传文件对象数组
         *
         * response: string  // 文件上传响应信息
         *
         * status: number 文件上传响应状态码
         *
         * }
         */
        this.completeItems = new EventEmitter();
        /**
         * 文件上传成功回调
         *
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * fileItems: Array<[TiFileItem]{@link ../interfaces/TiFileItem.html}>, // 上传文件对象数组
         *
         * response: string  // 文件上传响应信息
         *
         * status: number 文件上传响应状态码
         *
         * }
         */
        this.successItems = new EventEmitter();
        /**
         * 文件上传失败回调
         *
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * fileItems: Array<[TiFileItem]{@link ../interfaces/TiFileItem.html}>, // 上传文件对象数组
         *
         * response: string  // 文件上传响应信息
         *
         * status: number 文件上传响应状态码
         *
         * }
         */
        this.errorItems = new EventEmitter();
        /**
         * 文件上传取消回调
         *
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为对象形式，结构如下：
         *
         * {
         *
         * fileItems: Array<[TiFileItem]{@link ../interfaces/TiFileItem.html}>, // 上传文件对象数组
         *
         * response: string  // 文件上传响应信息
         *
         * status: number 文件上传响应状态码
         *
         * }
         */
        this.cancelItems = new EventEmitter();
        /**
         * 上传删除回调
         * 该回调对单个或多个文件在同一url同时上传有效，可使用其进行文件上传过程中的业务处理
         *
         * 参数为数组形式，代表在操作的文件对象
         */
        this.removeItems = new EventEmitter();
        /**
         * 所有文件上传完成回调
         *
         * 参数为数组形式，代表在操作的文件对象
         */
        this.completeAllItems = new EventEmitter();
        /**
         * 上传文件删除前的回调
         *
         * 参数为数组形式，代表在操作的文件对象
         */
        this.beforeRemoveItems = new EventEmitter();
        /**
         * @ignore 词条
         */
        // tslint:disable-next-line:typedef
        this.uploadLan = TiLocale.getLocaleWords().tiUpload;
    }
    ngOnInit() {
        super.ngOnInit();
        this.uploadConfig = {
            url: this.url,
            method: this.method,
            filters: this.filters,
            alias: this.alias,
            formData: this.formData,
            autoUpload: this.autoUpload,
            batchSend: this.batchSend || false,
            formDataFirst: this.formDataFirst || false,
            headers: this.headers,
            onAddItemFailed: (file, validResults) => {
                this.addItemFailed.emit({ file, validResults });
            },
            onAddItemSuccess: (fileItem) => {
                this.addItemSuccess.emit(fileItem);
            },
            onBeforeSendItems: (fileItems) => {
                this.beforeSendItems.emit(fileItems);
            },
            onProgressItems: (fileItems, progress) => {
                this.progressItems.emit({ fileItems, progress });
            },
            onCompleteItems: (fileItems, response, status) => {
                this.completeItems.emit({ fileItems, response, status });
            },
            onSuccessItems: (fileItems, response, status) => {
                this.successItems.emit({ fileItems, response, status });
            },
            onErrorItems: (fileItems, response, status) => {
                this.errorItems.emit({ fileItems, response, status });
            },
            onCancelItems: (fileItems, response, status) => {
                this.cancelItems.emit({ fileItems, response, status });
            },
            onRemoveItems: (fileItems) => {
                this.removeItems.emit(fileItems);
            },
            onBeforeRemoveItems: (fileItems) => {
                this.beforeRemoveItems.emit(fileItems);
            },
            onCompleteAllItems: (fileItems) => {
                this.completeAllItems.emit(fileItems);
            }
        };
        // 根据配置的文件类型过滤属性设置H5下的文件过滤属性,如果accept未定义,则按照type过滤条件进行设置；
        // 如果accept已定义，则按照accept定义设置：此种场景应用于浏览器设置accept后导致文件窗打开很慢的情况
        if (Util.isUndefined(this.accept) && this.filters && this.filters.length) {
            this.filters.forEach((filter) => {
                if (filter.name === 'type') {
                    this.accept = filter.params[0];
                }
                return;
            });
        }
    }
    /**
     * 手动上传，可以通过组件调用
     */
    upload() {
        this.uploadInst.uploadAll();
    }
}
TiUploadbaseComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-uploadbase',
                template: ''
            },] }
];
TiUploadbaseComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiUploadbaseComponent.propDecorators = {
    url: [{ type: Input }],
    method: [{ type: Input }],
    filters: [{ type: Input }],
    alias: [{ type: Input }],
    formData: [{ type: Input }],
    formDataFirst: [{ type: Input }],
    autoUpload: [{ type: Input }],
    batchSend: [{ type: Input }],
    headers: [{ type: Input }],
    accept: [{ type: Input }],
    disabled: [{ type: Input }],
    addItemFailed: [{ type: Output }],
    addItemSuccess: [{ type: Output }],
    beforeSendItems: [{ type: Output }],
    progressItems: [{ type: Output }],
    completeItems: [{ type: Output }],
    successItems: [{ type: Output }],
    errorItems: [{ type: Output }],
    cancelItems: [{ type: Output }],
    removeItems: [{ type: Output }],
    completeAllItems: [{ type: Output }],
    beforeRemoveItems: [{ type: Output }]
};

/**
 * 该组件用于实现已设计好的交互完整的文件上传组件，包含两种样式：
 *
 * 1.带输入框的样式(type为inputField)
 *
 * 2.按钮样式(type为button)
 *
 * 如果以上两种样式不满足业务场景，可使用自定义方式实现，具体实现请参考[tiFileSelect]{@link ../directives/TiFileSelectDirective.html}
 *
 * <example-url>../tiny3demo/#/upload/upload-all</example-url>
 */
class TiUploadComponent extends TiUploadbaseComponent {
    constructor(uploaderService, hostEle, renderer, tiOverflow) {
        super(hostEle, renderer);
        this.uploaderService = uploaderService;
        this.tiOverflow = tiOverflow;
        /**
         * 上传样式类型
         */
        this.type = 'inputField';
        /**
         * 是否自动聚焦，只适用于inputField类型
         */
        this.autofocus = false;
    }
    /**
     * @ignore 点击上传按钮触发事件
     */
    onSelectClick() {
        this.fileInput.nativeElement.click();
    }
    /**
     * @ignore
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 创建uploader实例
        const autoUpload = Util.isUndefined(this.autoUpload) ? true : this.autoUpload;
        this.uploadConfig.autoUpload = autoUpload;
        this.uploadInst = this.uploaderService.create(this.uploadConfig);
        this.placeholder = this.setPlaceholder();
        // 设置submit按钮的显示状态
        this.showSubmitButton = Util.isUndefined(this.showSubmitButton) ?
            !autoUpload : this.showSubmitButton;
        // 是否定义beforeRemoveItems事件
        this.isRemove = this.beforeRemoveItems.observers.length !== 0;
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngAfterViewInit() {
        super.ngAfterViewInit();
        // 处理autofocus
        if (this.autofocus === true) {
            this.focus();
        }
    }
    // 提供focus/blur方法，供外部调用
    /**
     * 聚焦方法，只适用于inputField类型
     */
    focus() {
        this.fileInput.nativeElement.nextElementSibling.focus();
    }
    /**
     * 失焦方法，只适用于inputField类型
     */
    blur() {
        this.fileInput.nativeElement.nextElementSibling.blur();
    }
    // 通过item元素的移入移出事件控制元素的hover状态，该hover状态会决定item中部分按钮的显示状态
    /**
     * @ignore
     */
    onItemMouseenter(item, event) {
        if (this.disabled) {
            return;
        }
        item.isHover = true;
        // 文件名超长溢出时，显示名称
        const fileNameEle = event.target.querySelector('.ti3-aui-file-name');
        item.isOverflow = this.tiOverflow.isOverflow(fileNameEle);
    }
    /**
     * @ignore
     */
    onItemMouseleave(item) {
        if (this.disabled) {
            return;
        }
        item.isHover = false;
    }
    // 获取上传文件状态，同时根据状态设置状态详细信息
    /**
     * @ignore
     */
    getUploadState() {
        let uploadingLen = 0;
        let uploadErrLen = 0;
        let uploadSuccLen = 0;
        this.uploadInst.queue.forEach((item) => {
            if (item.isUploading) {
                uploadingLen++;
            }
            else if (item.isError) {
                uploadErrLen++;
            }
            else if (item.isSuccess) {
                uploadSuccLen++;
            }
        });
        const fileQueueLen = this.uploadInst.queue.length;
        if (uploadSuccLen === fileQueueLen) {
            this.stateInfo = this.uploadLan.successInfo;
            return 'success';
        }
        if (uploadErrLen !== 0) {
            this.stateInfo = Util.formatEntry(this.uploadLan.errorMultiInfo, [uploadErrLen]);
            return 'error';
        }
        if (uploadingLen !== 0) {
            this.stateInfo = Util.formatEntry(this.uploadLan.uploadingMutiInfo, [`${uploadingLen}/${fileQueueLen}`]);
            return 'uploading';
        }
        this.stateInfo = Util.formatEntry(this.uploadLan.addSuccessMutiInfo, [fileQueueLen]);
        return 'addSuccess';
    }
    /**
     * 初始设置输入框内提示文本
     * 四种场景：自动单文件上传，自动多文件上传，手动单文件上传，手动多文件上传
     */
    setPlaceholder() {
        if (this.placeholder) {
            return this.placeholder;
        }
        if (this.autoUpload) {
            if (this.uploadInst.isSingleFile) {
                return this.uploadLan.autoUploadFilePlaceholder;
            }
            return this.uploadLan.autoUploadFilesPlaceholder;
        }
        if (this.uploadInst.isSingleFile) {
            return this.uploadLan.notAutoUploadFilePlaceholder;
        }
        return this.uploadLan.notAutoUploadFilesPlaceholder;
    }
}
TiUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-upload:not([type]), ti-upload[type="inputField"], ti-upload[type="button"]',
                template: "<div class=\"ti3-file-upload-container\" *ngIf=\"type === 'button'\">\r\n    <!-- IE\u4E0B\u4F7F\u7528button\u505A\u5BB9\u5668\uFF0C\u65E0\u6CD5\u505A\u70B9\u9009\u64CD\u4F5C\uFF0C\u56E0\u6B64\u4F7F\u7528div\u4EE3\u66FF -->\r\n    <div class=\"ti3-file-btn\" tiButton [tiDisabled]='disabled'>\r\n        <input class=\"ti3-file-input\" type=\"file\" [tiFileSelect]=\"uploadInst\" [title]=\"title\" [accept]=\"accept\"\r\n            [disabled]=\"disabled\" [multiple]=\"!uploadInst.isSingleFile\">\r\n        <span class=\"ti3-file-text\">{{buttonText || uploadLan.addFile}}</span>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"ti3-aui-file-container\" *ngIf=\"type !== 'button'\" [ngClass]=\"{'ti3-aui-file-disable': disabled}\">\r\n    <div class=\"clearfix\">\r\n        <div class=\"ti3-aui-file-field-container\" [style.width]=\"inputFieldWidth\">\r\n            <ul class=\"ti3-aui-file-items-container\" [id]=\"appendId('list')\">\r\n                <!-- \u6587\u4EF6\u540D\u79F0\u8D85\u957F\u6EA2\u51FA\u6216\u8005\u8BE5\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25\u65F6\uFF0C\u663E\u793Atip -->\r\n                <li class=\"ti3-aui-file-item\" *ngFor=\"let item of uploadInst.queue; index as i;\" [tiTip]=\"item.isOverflow || item.isError ? tipContent : ''\" [tiTipContext]='{\"item\": item}'\r\n                [tiTipPosition]=\"'top-left'\" (mouseenter)='onItemMouseenter(item, $event)' (mouseleave)='onItemMouseleave(item)' [id]=\"appendId('queue_' + i)\"\r\n                [ngClass]=\"{'ti3-aui-single-file-item': uploadInst.isSingleFile}\">\r\n                    <div class=\"ti3-aui-file-name-size-container\">\r\n                        <div class=\"ti3-aui-file-name\" [ngClass]=\"{'ti3-aui-file-state-general-info-error': item.isError}\">{{item.file.name}}</div>\r\n                        <div class=\"ti3-aui-file-size\">\r\n                            <span class=\"ti3-aui-file-size-brackets\">(</span>\r\n                            <span class=\"ti3-aui-file-item-size\">{{item.file.sizeWithUnit}}</span>\r\n                            <span class=\"ti3-aui-file-size-brackets\">)</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"ti3-aui-file-operates\">\r\n                            <div *ngIf=\"!item.isUploading && !item.isUploaded\">\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" [id]=\"appendId('remove_'+ i)\"></span>\r\n                            </div>\r\n                            <div *ngIf=\"item.isUploading\">\r\n                                <ti-progresspie [value]=\"item.progress\" [hidden]=\"item.isHover\" class=\"ti3-aui-file-progress-pie\">\r\n                                </ti-progresspie>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.cancel()\" *ngIf=\"item.isHover\" [id]=\"appendId('cancel_' + i)\"></span>\r\n                            </div>\r\n                            <div *ngIf=\"item.isSuccess\">\r\n                                <span class=\"ti3-aui-file-success ti3-icon ti3-icon-alert-success\" [hidden]=\"item.isHover\"></span>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" *ngIf=\"item.isHover\" [id]=\"appendId('success_remove_' + i)\"></span>\r\n                            </div>\r\n                           <div *ngIf=\"item.isError\" class=\"ti3-aui-file-error-state\">\r\n                                <span class=\"ti3-aui-file-error-reupload ti3-icon ti3-icon-refresh-1\" (click)=\"item.upload()\" *ngIf=\"!item.batchSend\" [id]=\"appendId('refresh_' + i)\"></span>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" [id]=\"appendId('error_remove_' + i)\"></span>\r\n                           </div>\r\n                        </div>\r\n                </li>\r\n                <li *ngIf=\"!uploadInst.queue.length\" class=\"ti3-aui-file-placeholder\" [id]=\"appendId('placeholder')\">{{placeholder}}</li>\r\n            </ul>\r\n\r\n        </div>\r\n\r\n        <!-- \u81EA\u52A8\u4E0A\u4F20\u6587\u4EF6/\u624B\u52A8\u6DFB\u52A0\u6587\u4EF6\u6309\u94AE -->\r\n        <div class=\"ti3-file-upload-btnCon\">\r\n                <input #fileInput type=\"file\" [tiFileSelect]=\"uploadInst\" class=\"ti3-aui-file-select-input\"\r\n                       [multiple]=\"!uploadInst.isSingleFile\"\r\n                       [title]=\"title\"\r\n                       [accept]=\"accept\"\r\n                       [id]=\"appendId('file')\">\r\n                <button tiButton type=\"button\" class=\"ti3-aui-upload-btn\"\r\n                        [disabled]=\"disabled\"\r\n                        (click)=\"onSelectClick()\"\r\n                        [id]=\"appendId('select')\">{{buttonText || autoUpload ? uploadLan.upload : uploadLan.addFile}}</button>\r\n        </div>\r\n\r\n         <!-- \u624B\u52A8\u4E0A\u4F20\u6587\u4EF6\u6309\u94AE -->\r\n        <span class=\"ti3-file-upload-btnCon\" *ngIf=\"showSubmitButton\">\r\n            <span class=\"ti3-file-upload-btn-cover\" *ngIf=\"disabled || !uploadInst.queue.length || uploadInst.isUploadedAll()\"></span>\r\n            <button tiButton type=\"button\"\r\n                    (click)=\"uploadInst.uploadAll()\"\r\n                    class=\"ti3-aui-upload-btn\"\r\n                    *ngIf=\"showSubmitButton\"\r\n                    [disabled]=\"disabled || !uploadInst.queue.length || uploadInst.isUploadedAll()\"\r\n                    [id]=\"appendId('uploadAll')\">{{buttonText || uploadLan.upload}}</button>\r\n        </span>\r\n    </div>\r\n    <div class=\"ti3-aui-file-state-general\" *ngIf=\"uploadInst.queue.length && !uploadInst.isSingleFile\" [style.width]=\"inputFieldWidth\">\r\n        <div *ngIf=\"getUploadState() === 'addSuccess'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-addSuccess\" >{{stateInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'uploading'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-uploading\">{{stateInfo}}</span>\r\n            <div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.cancelAll()\"[id]=\"appendId('cancel')\">{{uploadLan.cancel}}</div>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'success'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-success ti3-icon ti3-icon-check-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-success\">{{stateInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'error'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-error ti3-icon ti3-icon-exclamation-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-error\">{{stateInfo}}</span><!--\r\n            --><div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.reloadAllError()\" [id]=\"appendId('reload')\">{{uploadLan.reload}}</div>\r\n        </div>\r\n    </div>\r\n    <div class=\"ti3-aui-file-state-general\" *ngIf = \"uploadInst.queue.length && uploadInst.isSingleFile\"  [style.width]=\"inputFieldWidth\">\r\n        <div *ngIf=\"uploadInst.queue[0].isUploading\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-uploading\">{{uploadLan.uploadingSingleInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"uploadInst.queue[0].isSuccess\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-success ti3-icon ti3-icon-check-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-success\">{{uploadLan.successInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"uploadInst.queue[0].isError\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-error ti3-icon ti3-icon-exclamation-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-error\">{{uploadLan.errorSingleInfo}}</span>\r\n            <div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.reloadAllError()\" [id]=\"appendId('reload')\">{{uploadLan.reload}}</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- \u5355\u4E2Aitem tip\u5185\u5BB9\u663E\u793A\u6A21\u677F-->\r\n<ng-template #tipContent let-item=\"context.item\">\r\n    <ti-error-msg *ngIf='item.isError' [errorMessage]=\"item.errorInfo || uploadLan.error\"></ti-error-msg>\r\n    <span class=\"ti3-aui-file-tip-name\" *ngIf=\"item.isOverflow\">{{item.file.name}}</span>\r\n</ng-template>\r\n",
                styles: ["::ng-deep :root{--ti-upload-icon-size:16px;--ti-upload-item-container-padding-vertical:calc(var(--ti-upload-item-space)/2);--ti-upload-item-height:(var(--ti-upload-height) - 2*(var(--ti-upload-item-space)) - 2px);--ti-upload-item-operate-container-width:(var(--ti-upload-icon-size) * 2 + var(--ti-common-space-2x) * 2);--ti-upload-item-size-margin-left:var(--ti-common-space-base);--ti-upload-item-size-max-width:70px;--ti-upload-item-space:2px;--ti-upload-x-reupload-icon-color:var(--ti-common-color-icon-normal)}.ti3-file-detail-item{margin-top:20px;position:relative}.ti3-file-item-name{display:inline-block;max-width:40%;overflow:hidden;padding-left:10px;text-overflow:ellipsis;white-space:nowrap;width:40%}.ti3-file-item-info,.ti3-file-item-size{display:inline-block;max-width:20%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:20%}.ti3-file-detail-operate{bottom:18px;position:absolute;right:10px}.ti3-file-detail-operate-icon{cursor:pointer;font-size:15px;margin-left:5px}.ti3-file-progress{background-color:var(--ti-upload-progress-bg-color);color:var(--ti-upload-progerss-text-color);height:5px}.ti3-file-btn{overflow:hidden;position:relative}.ti3-file-input{bottom:0;cursor:pointer;font-size:1000px;margin:0;opacity:0;padding:0;position:absolute;right:0;z-index:1}.ti3-file-input[disabled]{cursor:not-allowed}.ti3-file-text{line-height:calc(var(--ti-button-middle-height) - 2px)}.ti3-aui-file-disable .ti3-aui-file-field-container{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);box-sizing:border-box;cursor:not-allowed}.ti3-aui-file-disable .ti3-aui-file-select-input{cursor:not-allowed}.ti3-aui-file-container{color:var(--ti-common-color-text-primary);font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number)}.ti3-aui-file-field-container{border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);float:left;position:relative;width:var(--ti-upload-field-default-width)}.ti3-aui-file-items-container{-ms-box-sizing:border-box;box-sizing:border-box;max-height:calc((var(--ti-upload-height) - 2px)*2 - var(--ti-upload-item-space));min-height:calc(var(--ti-upload-height) - 2px);overflow-x:hidden;overflow-y:auto;padding:var(--ti-upload-item-container-padding-vertical) 0;width:calc(100% - 2px)}.ti3-aui-file-item{-ms-box-sizing:border-box;background-color:var(--ti-upload-item-bg);box-sizing:border-box;cursor:pointer;display:flex;float:left;height:calc(var(--ti-upload-item-height));justify-content:space-between;line-height:calc(var(--ti-upload-item-height));margin:calc(var(--ti-upload-item-space)/2) 0 calc(var(--ti-upload-item-space)/2) var(--ti-upload-item-space);max-width:100%;padding:0 var(--ti-input-padding-horizontal)}.ti3-aui-file-item.ti3-aui-single-file-item{width:100%}.ti3-aui-file-name-size-container{display:flex;flex-shrink:0;width:calc(100% - var(--ti-upload-item-operate-container-width))}.ti3-aui-file-name{color:var(--ti-upload-item-name-color);height:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ti3-aui-file-size{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-upload-item-size-color);display:flex;flex-shrink:0;padding-left:var(--ti-upload-item-size-margin-left)}.ti3-aui-file-item-size{max-width:var(--ti-upload-item-size-max-width);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ti3-aui-file-operates{width:calc(var(--ti-upload-item-operate-container-width))}.ti3-aui-file-error-icon,.ti3-aui-file-error-reupload,.ti3-aui-file-success,.ti3-aui-file-x{color:var(--ti-upload-x-reupload-icon-color);float:right;font-size:var(--ti-upload-icon-size)}.ti3-aui-file-success{color:var(--ti-common-color-success)}.ti3-aui-file-error-icon,.ti3-aui-file-error-state .ti3-aui-file-x{margin-right:var(--ti-common-space-2x)}.ti3-aui-file-error-icon{color:var(--ti-common-color-error)}.ti3-aui-file-progress-pie{float:right;height:var(--ti-upload-icon-size);position:relative;top:calc((var(--ti-upload-item-height) - var(--ti-upload-icon-size))/2);width:var(--ti-upload-icon-size)}.ti3-aui-file-select-input{height:0;opacity:0;width:0}.ti3-aui-file-tip-name{display:inline-block;font-size:var(--ti-common-font-size-base);margin-top:var(--ti-common-space-base)}.ti3-aui-file-placeholder{color:var(--ti-input-placeholder-color);line-height:calc(var(--ti-upload-height) - 2px - var(--ti-upload-item-container-padding-vertical)*2);padding-left:var(--ti-input-padding-horizontal)}.ti3-aui-upload-btn{float:left;height:var(--ti-upload-height);margin-left:var(--ti-common-space-2x)}.ti3-aui-file-state-general{margin-top:var(--ti-common-space-2x)}.ti3-aui-file-state-general-info{align-items:center;display:flex}.ti3-aui-file-state-general-info-addSuccess,.ti3-aui-file-state-general-info-uploading{color:var(--ti-common-color-text-weaken)}.ti3-aui-file-state-general-info-error{color:var(--ti-common-color-error-text)}.ti3-aui-file-state-general-info-success{color:var(--ti-common-color-text-primary)}.ti3-aui-file-state-general-operate{color:var(--ti-upload-state-general-operate-color);cursor:pointer;display:inline-block;margin-left:var(--ti-common-space-base);vertical-align:middle}.ti3-aui-file-state-general-operate:hover{color:var(--ti-upload-state-general-operate-color-hover)}.ti3-aui-file-state-general-error,.ti3-aui-file-state-general-success{color:var(--ti-common-color-success);font-size:var(--ti-upload-icon-size);line-height:18px;margin-right:var(--ti-common-space-2x)}.ti3-aui-file-state-general-error{color:var(--ti-common-color-error)}.ti3-file-upload-btnCon{float:left;position:relative}.ti3-file-upload-btn-cover{bottom:0;cursor:not-allowed;left:var(--ti-common-space-2x);position:absolute;right:0;top:0}.ti3-file-upload-container .ti3-btn-default:not(:focus):not([disabled]):hover,.ti3-file-upload-container [ti-button]:not(:focus):not([disabled]):hover{animation:none}"]
            },] }
];
TiUploadComponent.ctorParameters = () => [
    { type: TiUploadService },
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiOverflowService }
];
TiUploadComponent.propDecorators = {
    type: [{ type: Input }],
    buttonText: [{ type: Input }],
    inputFieldWidth: [{ type: Input }],
    showSubmitButton: [{ type: Input }],
    placeholder: [{ type: Input }],
    autofocus: [{ type: Input }],
    fileInput: [{ type: ViewChild, args: ['fileInput',] }]
};

/**
 * @ignore
 */
class TiDisabledDirective {
    constructor(hostEle, renderer) {
        this.hostEle = hostEle;
        this.renderer = renderer;
    }
    set tiDisabled(value) {
        if (value) {
            this.renderer.setAttribute(this.hostEle.nativeElement, 'disabled', 'disabled');
        }
        else {
            this.renderer.removeAttribute(this.hostEle.nativeElement, 'disabled');
        }
    }
}
TiDisabledDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiDisabled]'
            },] }
];
TiDisabledDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiDisabledDirective.propDecorators = {
    tiDisabled: [{ type: Input }]
};

/**
 * 弹框组件提供服务方式供业务使用，使用该服务时需要引入模块TiModalModule，开发者通过调用TiModalService.open方法生成弹出框
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)
 * 中引入BrowserAnimationsModule。</span>这是因为此组件中使用了Angular动画，需要引入BrowserAnimationsModule，
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/modal/modal-all</example-url>
 */
class TiModalService {
    constructor(popService) {
        this.popService = popService;
        /**
         * 页面中存在的所有弹框实例，用于处理业务中无法明确当前有多少有效弹窗场景
         */
        this.openedModals = []; // 所有当前处于打开状态弹框缓存数组
        /* tslint:disable:no-null-keyword */
        this.backdropComponentRef = null; // 单个页面中多个弹框出现时,只允许存在一个遮罩层,因此使用该标志位用来缓存遮罩实例
        this.defaultConfig = {
            backdrop: true,
            draggable: true,
            animation: true,
            closeOnEsc: true,
            closeIcon: true
        };
    }
    /**
     * 生成弹框方法
     *
     * @param content 弹框内容，支持TemplateRef及组件形式，内容由ti-modal-header、ti-modal-body及ti-modal-footer组件构成弹框内容整体。
     *                不支持字符串形式，如果误传入字符串形式，不仅会有报错，还会存在XSS攻击风险，不过XSS攻击风险已在10.1.4版本已处理。
     * @param [config] 弹框配置信息
     * @returns 弹框实例信息，使用该实例信息可调用弹框的close等方法；弹框内容为component类型时，也可通过该实例信息的content属性获取弹框内容数据
     */
    open(content, config) {
        let modalInstance; // 弹框最终返回的实例对象
        let modalComponentRef; // 弹框组件实例,使用该实例获取弹框DOM元素及做属性赋值操作
        const modalConfig = Object.assign(Object.assign({}, this.defaultConfig), config); // 弹框配置合并
        let modal; // generateModal方法返回值
        // 通过id唯一标识防止重复打开相同弹框,id重复情况下返回先前实例
        if (modalConfig && !Util.isUndefined(modalConfig.id)) {
            const index = this.openedModals.findIndex((item) => {
                return item._id === modalConfig.id;
            });
            if (index !== -1) {
                return this.openedModals[index];
            }
        }
        // 根据beforeClose返回处理弹窗的销毁：业务在beforeClose中调用弹框销毁
        const destroy = (reason) => {
            if (typeof modalConfig.beforeClose === 'function') {
                modalConfig.beforeClose(modalInstance, reason);
            }
            else {
                destroyModal(reason);
            }
        };
        // 销毁弹框：通过调用组件的动画状态方式实现动画处理
        const destroyModal = (reason) => {
            if (reason) {
                if (typeof modalConfig.close === 'function') {
                    modalConfig.close(modalInstance);
                }
            }
            else {
                if (typeof modalConfig.dismiss === 'function') {
                    modalConfig.dismiss(modalInstance);
                }
            }
            modalComponentRef.instance.showState = 'hide';
        };
        // 销毁弹框实体：弹框动画执行完成后调用该方法
        const removeModalEle = () => {
            // 销毁弹框实体DOM
            modal.hide();
            // 移除缓存实例
            const index = this.openedModals.indexOf(modalInstance);
            this.openedModals.splice(index, 1);
            modalInstance = null;
            // 销毁backdrop
            destroyBackdrop();
        };
        const destroyBackdrop = () => {
            // backdrop定义为false时，不进行处理
            // backdropComponentRef 已经销毁
            if (!modalConfig.backdrop || !this.backdropComponentRef) {
                return;
            }
            // 修改backdrop zIndex，确保有多个弹窗情况下，最外层弹窗不被遮挡
            this.backdropComponentRef.instance.index = this.openedModals.length - 1;
            // 当前还有其它弹框情况下,不用销毁弹框
            if (this.openedModals.length !== 0) {
                return;
            }
            this.backdropComponentRef.instance.showState = 'hide';
        };
        // 将当前要打开的modal放到openedModals列表中
        modalInstance = {
            _id: modalConfig && modalConfig.id,
            close() {
                destroy(true);
            },
            dismiss() {
                destroy(false);
            },
            destroy(reason) {
                destroyModal(reason);
            },
            _remove: removeModalEle,
            content: null
        };
        modal = this.generateModal(content, modalConfig, modalInstance);
        // 生成弹框window,并返回对应的组件实例
        modalComponentRef = modal.modalComponentRef;
        // 生成模态背景backdrop
        this.backdropComponentRef = this.generateBackdrop(modalConfig);
        return modalInstance;
    }
    generateModal(content, config, modalInstance) {
        const { context } = config, modalConfig = __rest(config, ["context"]);
        // tiModalComponent生成需要使用到的上下文
        const modalContext = Object.assign({ modalInstance, index: this.openedModals.length }, modalConfig);
        // 内容部分需要使用到的上下文
        const contentContext = Object.assign({ close: modalInstance.close, dismiss: modalInstance.dismiss }, context);
        let modalComponent;
        modalComponent = (TiBrowser.isIE() && (TiBrowser.version() === 9))
            ? this.popService.create(TiModalNoAnimationComponent)
            : this.popService.create(TiModalComponent);
        const modalComponentRef = modalComponent.show({
            content,
            context: modalContext,
            contentContext,
            container: 'body'
        });
        // 控制元素动画呈现，元素呈现后修改动画状态才会有动画效果，因此在此处处理
        modalComponentRef.instance.showState = 'show';
        modalInstance.content = modalComponentRef.tiContentRef.componentRef;
        this.openedModals.push(modalInstance);
        return { modalComponentRef, hide: modalComponent.hide };
    }
    generateBackdrop(config) {
        // 配置中不需要backdrop,不生成
        if (!config.backdrop) {
            return this.backdropComponentRef;
        }
        if (this.backdropComponentRef) {
            // backdrop已存在的情况下,修改其zIndex,并确保不生成backdrop
            if (this.backdropComponentRef.instance.showState === 'show') {
                this.backdropComponentRef.instance.index = this.openedModals.length - 1;
                return this.backdropComponentRef;
                // 如果backdrop正在销毁(动画执行期间)时再新生成一个backdrop，这时应该将旧的backdrop立即销毁
            }
            else {
                this.backdropComponentRef.destroy();
            }
        }
        const backdropComponent = (TiBrowser.isIE() && (TiBrowser.version() === 9))
            ? this.popService.create(TiBackdropNoAnimationComponent)
            : this.popService.create(TiBackdropComponent);
        const backdropRef = backdropComponent.show({
            context: {
                animation: config.animation,
                destroy: () => {
                    backdropComponent.hide();
                    this.backdropComponentRef = null;
                }
            },
            container: 'body'
        });
        // 控制元素动画呈现，元素呈现后修改动画状态才会有动画效果，因此在此处处理
        backdropRef.instance.showState = 'show';
        return backdropRef;
    }
}
TiModalService.ɵprov = ɵɵdefineInjectable({ factory: function TiModalService_Factory() { return new TiModalService(ɵɵinject(TiPopupService)); }, token: TiModalService, providedIn: TiModalModule });
TiModalService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiModalModule
            },] }
];
TiModalService.ctorParameters = () => [
    { type: TiPopupService }
];

/**
 * 10.0.2版本新增
 *
 * 该组件基于TiUploadService和已设计好的交互规范，实现上传图片功能（但不限于上传图片），包含两种样式：
 *
 * 1.带上传结果展示的样式(type为block)
 *
 * 2.不展示上传结果的样式(type为drag)
 *
 * 负责人：谭莉
 * <example-url>../tiny3demo/#/uploadimage/uploadimage-all</example-url>
 */
class TiUploadimageComponent extends TiUploadbaseComponent {
    constructor(uploaderService, hostEle, renderer, tiModal, sanitizer, zone) {
        super(hostEle, renderer);
        this.uploaderService = uploaderService;
        this.tiModal = tiModal;
        this.sanitizer = sanitizer;
        this.zone = zone;
        /**
         * 能够上传文件的最大数量，默认不限制
         */
        this.maxCount = undefined;
        /**
         * 设置上传成功后可以删除，默认可删除
         */
        this.deletable = true;
        /**
         * 上传按钮的样式，默认为block
         */
        this.type = 'block';
        /**
         * @ignore
         * 上传结果展示，目前只有一种，picture-card；
         * 当type设置为drag时无效
         */
        this.listType = 'picture-card';
        /**
         * 文件上传达上限的回调
         * 参数是当前的文件预览信息列表
         */
        this.uploadLimit = new EventEmitter();
        /**
         * 上传按钮的宽度，用于自定义样式，默认为100px，在type为drag下设置才生效
         */
        this.uploadBtnWidth = '100px';
        /**
         * 上传按钮的高度，用于自定义样式，默认为100px，在type为drag下设置才生效
         */
        this.uploadBtnHeight = '100px';
        /**
         * @ignore 需要展示的文件列表
         */
        this.fileList = [];
    }
    /**
     * @ignore
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 设置上传实例配置
        this.setUploadConfig();
        // 创建uploader实例
        this.uploadInst = this.uploaderService.create(this.uploadConfig);
        if (this.type === 'drag') {
            this.listType = '';
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        // 拖拽添加/上传时，设置上传按钮的高度和宽度
        if (this.uploadBtn && this.type === 'drag') {
            this.renderer.setStyle(this.uploadBtn.nativeElement, 'width', this.uploadBtnWidth);
            this.renderer.setStyle(this.uploadBtn.nativeElement, 'height', this.uploadBtnHeight);
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentChecked() {
        super.ngAfterContentChecked();
    }
    /**
     * 重新设置上传实例配置
     */
    setUploadConfig() {
        this.setFilters();
        this.uploadConfig.onAddItemFailed = (file, validResults) => {
            // 文件上传达上限，触发回调
            if (validResults.includes('maxCount')) {
                this.uploadLimit.emit(this.fileList);
            }
            this.addItemFailed.emit({ file, validResults });
        };
        this.uploadConfig.onAddItemSuccess = (fileItem) => {
            this.addPreviewList(fileItem);
            this.addItemSuccess.emit(fileItem);
        };
        this.uploadConfig.onSuccessItems = (fileItems, response, status) => {
            this.setPreviewInfo(fileItems[0]);
            this.successItems.emit({ fileItems, response, status });
        };
        this.uploadConfig.onRemoveItems = (fileItems) => {
            this.removePreviewList(fileItems[0]);
            this.removeItems.emit(fileItems);
        };
    }
    /**
     * 设置过滤条件
     */
    setFilters() {
        let uploadFilters = this.filters || [];
        if ((typeof this.maxCount === 'number') && this.maxCount > 0) {
            uploadFilters = uploadFilters.concat({
                name: 'maxCount',
                params: [this.maxCount]
            });
        }
        this.uploadConfig.filters = uploadFilters;
    }
    /**
     * 添加文件成功后，增加一个预览对象
     */
    addPreviewList(fileItem) {
        const imgInfoItem = {
            imgFileItem: fileItem,
            name: fileItem._file.name,
            previewUrl: '',
            isImage: false
        };
        this.fileList.push(imgInfoItem);
    }
    /**
     * 删除时，将文件信息从预览列表中移除
     */
    removePreviewList(fileItem) {
        // 获取需要删除的数据的索引
        const deleteIndex = this.fileList.findIndex((item) => {
            return (fileItem._file === item.imgFileItem._file);
        });
        this.fileList.splice(deleteIndex, 1);
    }
    /**
     * 上传成功后，更新预览地址
     */
    setPreviewInfo(fileItem) {
        // 生成预览url
        const url = window.URL.createObjectURL(fileItem._file);
        const isImagePromise = this.isImage(fileItem._file.name, url);
        isImagePromise.then((result) => {
            this.fileList.forEach((item) => {
                if (item.imgFileItem._file === fileItem._file) {
                    item.previewUrl = url;
                    item.isImage = result;
                }
            });
        });
    }
    /**
     * @ignore 在弹框中预览上传的图片
     * 参数i: 表示被点击图片的索引
     */
    preview(i) {
        const previewList = [];
        let firstIndex = i;
        this.fileList.forEach((item, index) => {
            if (item.imgFileItem.isSuccess && item.isImage) {
                // 上传成功并且是图片
                previewList.push(item);
            }
            else {
                // 非图片或上传失败，并且在被点击的文件之前，第一个预览的索引需要-1
                if (i >= index) {
                    firstIndex -= 1;
                }
            }
        });
        this.tiModal.open(TiImagepreviewComponent, {
            id: 'imagePreviewModal',
            modalClass: 'ti3-image-preview-modal',
            context: {
                index: firstIndex,
                fileList: previewList // 预览列表
            }
        });
    }
    /**
     * 判断是否是图片类型
     * 参数fileName: 文件名称
     * 参数previewUrl: 预览地址
     */
    // tslint:disable-next-line: prefer-function-over-method
    isImage(fileName, previewUrl) {
        const tempArray = fileName.split('.');
        const extension = tempArray[tempArray.length - 1].toLocaleLowerCase();
        const supportTypes = ['jpg', 'png', 'jpeg', 'svg', 'gif', 'bmp'];
        return new Promise(resolve => {
            if (!supportTypes.includes(extension)) {
                resolve(false);
                return;
            }
            this.zone.runOutsideAngular(() => {
                // 测试图片能否加载成功，能加载成功，则认为可预览；否则，认为不可预览
                const img = document.createElement('img');
                img.src = previewUrl;
                img.onerror = (event) => {
                    resolve(false);
                };
                img.onload = (event) => {
                    resolve(true);
                };
            });
        });
    }
    /**
     * @ignore 禁用上传时，阻止默认事件、停止冒泡
     */
    selectFile(event) {
        if (this.disabled) {
            event.stopPropagation();
            event.preventDefault();
            return;
        }
        // 焦点转移
        this.uploadBtn.nativeElement.focus();
    }
    onKeydown() {
        this.uploadInputEle.nativeElement.focus();
    }
}
TiUploadimageComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-upload[type="block"], ti-upload[type="drag"]',
                template: "<!-- \u4E0A\u4F20\u7ED3\u679C\u5C55\u793A -->\r\n<ng-container *ngIf=\"listType==='picture-card'\">\r\n    <div class=\"ti3-picture-card-container\" *ngFor=\"let item of fileList; index as i;\">\r\n        <div class='ti3-picture-card-item'\r\n            [ngClass]=\"{'ti3-picture-card-item-error': item.imgFileItem.isError}\">\r\n            <img class=\"ti3-picture-card-item-img\" *ngIf='item.imgFileItem.isSuccess && item.isImage' [src]=\"sanitizer.bypassSecurityTrustUrl(item.previewUrl)\" />\r\n            <div class=\"ti3-picture-card-item-not-img\" *ngIf=\"item.imgFileItem.isError || item.imgFileItem.isCancel || (item.imgFileItem.isSuccess && !item.isImage)\"></div>\r\n            <!-- \u8FDB\u5EA6 -->\r\n            <div class=\"ti3-image-upload-progress\" *ngIf=\"item.imgFileItem.isUploading\">\r\n                <ti-progressbar [value]=\"item.imgFileItem.progress\" [animation]='true'></ti-progressbar>\r\n                <span class=\"ti3-image-upload-cancel-text\" (click)=\"item.imgFileItem.cancel()\" [id]=\"appendId('cancel')\">{{uploadLan.cancel}}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"ti3-picture-card-drop\" *ngIf=\"item.imgFileItem.isUploaded || item.imgFileItem.isCancel\"\r\n            [tiTip]=\"item.imgFileItem.isError ? tipContent : ''\"\r\n            [tiTipContext]='{\"item\": item}'>\r\n            <span class=\"ti3-picture-card-operation ti3-picture-card-operation-preview\"\r\n                *ngIf=\"item.imgFileItem.isSuccess && item.isImage\"\r\n                (click)=\"preview(i)\"\r\n                [id]=\"appendId('preview')\"\r\n                [ngClass]=\"{\r\n                    'ti3-picture-card-operation-center': !deletable\r\n                }\">\r\n            </span>\r\n            <span class=\"ti3-picture-card-operation ti3-picture-card-operation-delete\"\r\n                *ngIf=\"item.imgFileItem.isError || item.imgFileItem.isCancel || (item.imgFileItem.isSuccess && deletable)\"\r\n                (click)=\"item.imgFileItem.remove()\"\r\n                [id]=\"appendId('remove')\"\r\n                [ngClass]=\"{\r\n                    'ti3-picture-card-operation-delete-success': item.imgFileItem.isSuccess && deletable,\r\n                    'ti3-picture-card-operation-success-center': item.imgFileItem.isError || item.imgFileItem.isCancel || (item.imgFileItem.isSuccess && !item.isImage && deletable)\r\n                }\">\r\n            </span>\r\n        </div>\r\n        <span tiOverflow tiTipPosition=\"right\" class=\"ti3-picture-card-name\"\r\n            [ngClass]=\"{'ti3-picture-card-name-error': item.imgFileItem.isError}\" [id]=\"appendId('name')\">{{item.imgFileItem.file.name}}</span>\r\n    </div>\r\n</ng-container>\r\n\r\n<!-- \u4E0A\u4F20\u6309\u94AE -->\r\n<div #uploadBtn class=\"ti3-image-upload-btn\" tiButton [tiDisabled]='disabled'\r\n    tabindex=\"0\" (keydown.enter)=\"onKeydown()\" tiOutline\r\n    *ngIf=\"!maxCount || uploadInst.queue.length < maxCount\">\r\n    <ng-container *ngTemplateOutlet=\"uploadContainerTemplate?uploadContainerTemplate:defaultUploadTemplate;\"></ng-container>\r\n    <input #uploadInput class=\"ti3-image-upload-input\" type=\"file\" tabindex=\"-1\" [tiDisabled]='disabled'\r\n        [title]=\"title\"\r\n        [accept]=\"accept\"\r\n        (click)=\"selectFile($event)\"\r\n        [tiFileSelect]=\"uploadInst\"\r\n        [multiple]=\"!uploadInst.isSingleFile\"\r\n        [id]=\"appendId('select_file')\"/>\r\n</div>\r\n\r\n<!-- \u9ED8\u8BA4\u4E0A\u4F20\u6837\u5F0F -->\r\n<ng-template #defaultUploadTemplate>\r\n    <div class='ti3-image-upload-content' *ngIf=\"!uploadContainerTemplate\">\r\n        <ti-icon name=\"add\" class=\"ti3-image-upload-icon\"></ti-icon>\r\n    </div>\r\n</ng-template>\r\n\r\n<!-- \u63D0\u793A -->\r\n<ng-template #tipContent let-item=\"context.item\">\r\n    <ti-error-msg [errorMessage]=\"item.imgFileItem.errorInfo || uploadLan.error\"></ti-error-msg>\r\n</ng-template>\r\n",
                styles: ["::ng-deep :root{--ti-image-preview-modal-width:640px;--ti-image-upload-btn-height:100px;--ti-image-upload-btn-width:100px;--ti-image-upload-delete-bg-img-url:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABV0lEQVQ4T42TP0jVURiGn4cGFzeJUBwCdXBouIvgJNXSEoI0OCk4OFzMzT+DSzUFLhkiDg7iIA2CU9AQgUGbILooXeROJQUu4iLCFyd+V7w/71HP9p33/R4+3u8caXEi4ifQW5Jqal/ZbgYwDjwuaXV1/V6AVtDcnZlx78uoJUBj3BGgG1i6o/s18AvYAupXGUTER2BUfXgbICL+Ap/UqeS7DlgA3gBt6mUm3AfABfBWTd4mwCSwCnSpvzOAR8AJUFVXyoBhYBuoqHsZwBNgH3ilpgyaJhgEfgAv1C9JjIi15FEnivoZ8BUYUnfKgB6gBoypG0XDt/8mfVrUo8Am0K8elgHtwBkwoy5mANPAB6BDPW0CFA3nwLI6W9QpqFCrRf0OmCs2Fa0Ax8B3NT2uGyci0pZeql0NsekzRcRnYADYzTymCnCgPs8BUpDvgc4M4A8wrx419H/te4tFrK91SQAAAABJRU5ErkJggg==\");--ti-image-upload-icon-font-size:16px;--ti-image-upload-icon-margin:37px;--ti-image-upload-preview-bg-img-url:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAArUlEQVQ4T62SwRUBMRiEv6mACvRBLZrgxsW6cKMLpdg2lEAF42Vf1gsvT7JWrsl8//wzESOPRup5AWzfgUkENpL2NfAU4ChoJS1qxOHNJ6AF5sBZ0roGkgJ2wbbtE7ACjpK2JUg2RNsHYCZp+ROgJErv/1fjt6m2L8Atl0mVg5jJpm/Hdhf4W42lvZN2uqoldcOrHPRw29f4TxgMCLaBJsIekqaDHeTWHLRCDvAEGOo5EdqEuwAAAAAASUVORK5CYII=\");--ti-image-upload-progress-top:57px;--ti-image-upload-progress-width:80px;--ti-picture-card-item-default-img:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEEElEQVRYR8WXX2gcVRTGv3NnN9s0ttYmaXdnk92ZTaAgUfrQxhIfklqrIhRR6kss7ZsIBR8ECVjFiCKl4pMgBIUiVcQXFaVSE2jeCpVVCIaWuM3822QmDVVa2kab7MyRO8kmacjuTtskvU8z3HPO95t7zz33DOEhD5L6zCwcZ+owgw8GwKNRmeIidqK1dUdB2ufz7ubGJv6CieLV/AVwnRQaPP3lwPf9/f0BMXPCcryfARyMKhzaEQpaa2oXEbF8NSzvbSI+FTkG49ztW6mXyHKmPmIOTsgYIHwCiOtRgpCi/KWlm/8o25qO+zwgHqvlywhyCNBHhK1CUD+ZlmuDkPFJPNGeSY7WCrAW84YxeYgU+gnAOJm268sF1bOqWIvgUWKMjo7WNWzZfgfAHQkg95A3EmB4eDim5XbNAZhbUwB78urT/lypV5DwFYGvW1tTv622IusCYFluLxPOAAi3kohK7POruq7+uBJiXQBMx7XByKwQu6xn1cfXHYCZFcvx5J6GhW3Z+FfPqpvXHUAKmI53Ecydy8UIdF7Lpg5sDIA5sRtCnAOwcz4HMIEAz2maenlDAKRIoVDYGo83PMuMoL5eDCWTydsPfAoKhUIiVvfIO7JWaJnkx0Q0G6XYVLO5p1Ng2e4ZBo7IgAx8k8uq4fODjMgApu31AXzybjHu17PpD2oBGEaxk4RyigiFWzf/Od7R0bG4cpEADHvqkCD+QR6xFWIM4tf0TPrbShCmWXwKQvkVC70FM3+e09LHy/Y1Aa5ccTpELHaBCFsqiPznMx9o19IXVs4bRa+TfB4ELTU2smcg5mPZrCorJaoCjI25TXWbcBFArsYyTxOLfZqWNMt24463VzAPAti2iu8MK0pXrmXnSEWAfD4fb2xSh0DorrXHC/OXgtKmrra27TfCYmR7xwA+vUpFDM0JNE6Y3WsYxs1Vb0PTdgcAvB5RPDRjYMjOpF7cT1Sah5jsA2hF4i5FZOCsnkm9bDmeTMql65gEvckBf3Yv4stsB/Ss+kb53XK8T5n5rUqxiOhDZn7vLgAGfAJi9wXAPPL3Neras0edkf528eqRIPDDhKswgoVre3EF7kt3fmPpz0SMn1FV9Zp8HbfcV4jwXcSPmSPDcmeJULWXr0J3yU+I/e3J5HS4/0X3BQSQDUgi4hfNkOl4I2B+MqLD8mwaA8d6dH3H1Ly414OAfwFQHzUWAb+TYXtHCfxVVKeF81RQEO/JZJrdUNyc2gcRyPNfqXCtHp5Eb9jBWI77LjNkVtZFADHiSqK7paVxIhSfmN4Nv3QeQM2fknJsZp4lovf1rHpysYUqFotpH0o3M1X9Nwzm+Gxbm+qUg9m2dzggNEcAD02CgG8oDfFhrbnZC3M4quN62T10gP8BX1AYJjtlKGcAAAAASUVORK5CYII=\");--ti-picture-card-operation-height:16px;--ti-picture-card-operation-left-center:42px;--ti-picture-card-operation-preview-left:28px;--ti-picture-card-operation-top:42px;--ti-picture-card-operation-width:16px}.ti3-picture-card-container{display:inline-block;position:relative;width:var(--ti-image-upload-btn-width)}.ti3-picture-card-container:not(:last-child){margin-right:var(--ti-common-space-2x)}.ti3-picture-card-container .ti3-picture-card-item{border:1px solid var(--ti-common-color-line-normal);border-radius:var(--ti-common-border-radius-normal);box-sizing:border-box;height:var(--ti-image-upload-btn-height);position:relative}.ti3-picture-card-container .ti3-picture-card-item .ti3-picture-card-item-img{border-style:none;height:100%;object-fit:cover;width:100%}.ti3-picture-card-container .ti3-picture-card-item .ti3-picture-card-item-not-img{background:var(--ti-picture-card-item-default-img) 50% no-repeat;padding:calc(var(--ti-image-upload-btn-width)/2)}.ti3-picture-card-container .ti3-picture-card-item .ti3-image-upload-progress{margin:0 var(--ti-common-space-10);position:absolute;top:var(--ti-image-upload-progress-top);width:var(--ti-image-upload-progress-width)}.ti3-picture-card-container .ti3-picture-card-item .ti3-image-upload-progress ti-progressbar{position:absolute}.ti3-picture-card-container .ti3-picture-card-item .ti3-image-upload-progress .ti3-progress-bar{background-color:var(--ti-common-color-success)}.ti3-picture-card-container .ti3-picture-card-item .ti3-image-upload-progress .ti3-image-upload-cancel-text{color:var(--ti-common-color-prompt-text);cursor:pointer;display:inline-block;margin-top:calc(5px + var(--ti-common-space-2x));text-align:center;width:100%}.ti3-picture-card-container .ti3-picture-card-item-error{border-color:var(--ti-common-color-error-border)}.ti3-picture-card-container .ti3-picture-card-drop{background:rgba(0,0,0,.4);border-radius:var(--ti-common-border-radius-normal);height:var(--ti-image-upload-btn-height);opacity:0;position:absolute;top:0;width:var(--ti-image-upload-btn-width)}.ti3-picture-card-container .ti3-picture-card-drop:hover{opacity:1}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation{display:inline-block;height:var(--ti-picture-card-operation-height);position:absolute;width:var(--ti-picture-card-operation-width)}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation:hover{cursor:pointer}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-preview{background-image:var(--ti-image-upload-preview-bg-img-url);left:var(--ti-picture-card-operation-preview-left);top:var(--ti-picture-card-operation-top)}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-center{left:var(--ti-picture-card-operation-left-center)}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-success-center{left:var(--ti-picture-card-operation-left-center)!important}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-delete{background-image:var(--ti-image-upload-delete-bg-img-url);top:var(--ti-picture-card-operation-top)}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-delete-error{left:var(--ti-picture-card-operation-left-center)}.ti3-picture-card-container .ti3-picture-card-drop .ti3-picture-card-operation-delete-success{left:calc(var(--ti-picture-card-operation-preview-left)*2)}.ti3-picture-card-container .ti3-picture-card-name{display:inline-block;margin-top:var(--ti-common-space-2x);overflow:hidden;text-align:center;text-overflow:ellipsis;white-space:nowrap;width:100%}.ti3-picture-card-container .ti3-picture-card-name-error{color:var(--ti-common-color-error-text)}.ti3-image-upload-btn{border:1px dashed var(--ti-common-color-line-normal);border-radius:var(--ti-common-border-radius-normal);height:var(--ti-image-upload-btn-height);overflow:hidden;padding:0;position:relative;vertical-align:top;width:var(--ti-image-upload-btn-width)}.ti3-image-upload-btn[disabled]{cursor:not-allowed}.ti3-image-upload-btn :hover{cursor:pointer}.ti3-image-upload-btn .ti3-image-upload-icon{display:inline-block;font-size:var(--ti-image-upload-icon-font-size);left:0;margin:var(--ti-image-upload-icon-margin) auto;position:absolute;top:0;width:100%}.ti3-image-upload-btn .ti3-image-upload-input{display:inline-block;font-size:0;height:100%;left:0;opacity:0;outline:none;position:absolute;top:0;width:100%}.ti3-image-upload-btn .ti3-image-upload-input[disabled]{cursor:not-allowed}::ng-deep .ti3-image-preview-modal{width:var(--ti-image-preview-modal-width)!important}"]
            },] }
];
TiUploadimageComponent.ctorParameters = () => [
    { type: TiUploadService },
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiModalService },
    { type: DomSanitizer },
    { type: NgZone }
];
TiUploadimageComponent.propDecorators = {
    maxCount: [{ type: Input }],
    deletable: [{ type: Input }],
    type: [{ type: Input }],
    uploadLimit: [{ type: Output }],
    uploadBtn: [{ type: ViewChild, args: ['uploadBtn', { static: false },] }],
    uploadInputEle: [{ type: ViewChild, args: ['uploadInput', { static: false },] }],
    uploadContainerTemplate: [{ type: ContentChild, args: ['uploadContainer', { static: true },] }],
    uploadBtnWidth: [{ type: Input }],
    uploadBtnHeight: [{ type: Input }]
};

class TiUploadModule {
}
TiUploadModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiIconModule,
                    TiTipModule,
                    TiProgresspieModule,
                    TiUploadServiceModule,
                    TiOverflowModule,
                    TiValidationModule,
                    TiProgressbarModule,
                    TiModalModule,
                    TiImagepreviewModule,
                    TiButtonModule,
                    TiOutlineModule
                ],
                exports: [TiFileSelectDirective, TiUploadComponent, TiDisabledDirective, TiUploadbaseComponent, TiUploadimageComponent],
                declarations: [TiFileSelectDirective, TiUploadComponent, TiDisabledDirective, TiUploadbaseComponent, TiUploadimageComponent]
            },] }
];

/**
 * @ignore
 */
class TiIntromodalComponent extends TiBaseComponent {
    ngOnInit() {
        super.ngOnInit();
        this.totalArray = new Array(this.totalNumber + 1);
        this.isStringContent = typeof this.content === 'string';
        this.templateContent = this.content instanceof TemplateRef ? this.content : undefined;
    }
}
TiIntromodalComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-intromodal',
                template: "<ti-modal-header [id]=\"appendId('title')\">{{title}}</ti-modal-header>\r\n<ti-modal-body class=\"ti3-intro-body\">\r\n    <ng-container *ngIf=\"isStringContent else templateContent\">\r\n        <span>{{content}}</span>\r\n    </ng-container>\r\n    <div *ngIf=\"image\" [class]=\"image\"></div>\r\n    <div class=\"ti3-intro-steplist-wrapper\">\r\n        <span class=\"ti3-intro-steplist-container\" *ngIf=\"totalNumber > 1\">\r\n            <span *ngFor=\"let item of totalArray;let i = index;\"\r\n                class=\"ti3-intro-steplist-item\"\r\n                [ngClass]=\"{'active': i === currentNumber,\r\n                            'ti-step-showed': currentNumber > i }\"\r\n                (click)=\"wantStep(i)\" [id]=\"appendId(i)\"></span>\r\n        </span>\r\n    </div>\r\n</ti-modal-body>\r\n<ti-modal-footer>\r\n    <div class=\"ti3-intro-button-container\">\r\n        <button type=\"button\" tiButton color=\"danger\"\r\n            *ngIf=\"currentNumber < totalNumber\"\r\n            (click)=\"wantStep(1)\"\r\n            [id]=\"appendId('next')\">{{ 'tiIntro.next' | tiTranslate }}</button>\r\n        <button type=\"button\" tiButton color=\"danger\"\r\n            *ngIf=\"currentNumber === totalNumber\"\r\n            (click)=\"close()\"\r\n            [id]=\"appendId('finish')\">{{ finishButtonText ? finishButtonText : 'tiIntro.finish' | tiTranslate }}</button>\r\n    </div>\r\n</ti-modal-footer>",
                host: {
                    '[class.ti3-intromodal-wrapper]': 'true'
                },
                styles: ["::ng-deep :root{--ti-intro-step-list-item-width:5px}:host.ti3-intromodal-wrapper .ti3-intro-close{cursor:pointer;position:absolute;right:12px;top:12px}:host.ti3-intromodal-wrapper ti-modal-header{padding:var(--ti-common-space-8x) var(--ti-common-space-10x) var(--ti-common-space-3x);text-align:center}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body{padding:0 calc(var(--ti-common-space-base)*12);text-align:center}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-wrapper{font-size:0;line-height:0;margin-top:var(--ti-common-space-3x)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container{display:inline-block}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item{background-color:var(--ti-common-color-line-normal);border-radius:calc(var(--ti-intro-step-list-item-width)*0.5);cursor:pointer;float:left;height:var(--ti-intro-step-list-item-width);margin:0 3px;width:var(--ti-intro-step-list-item-width)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item:last-child{margin-right:0}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item.ti-step-showed{background-color:var(--ti-common-color-line-hover)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item.active{width:20px}:host.ti3-intromodal-wrapper .ti3-intro-header{color:var(--ti-common-color-text-primary);font-size:var(--ti-common-font-size-2);font-weight:700;line-height:var(--ti-common-line-height-number);width:366px}:host.ti3-intromodal-wrapper .ti3-intro-body{color:var(--ti-common-color-text-secondary);line-height:20px;padding:12px 0 32px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container{float:left;margin-top:8px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item{background-color:var(--ti-common-color-line-normal);border-radius:calc(var(--ti-intro-step-list-item-width)*0.5);cursor:pointer;float:left;height:var(--ti-intro-step-list-item-width);margin:0 3px;width:var(--ti-intro-step-list-item-width)}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item:last-child{margin-right:0}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item.ti-step-showed{background-color:var(--ti-common-color-line-hover)}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item.active{width:20px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-button-container{float:right}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-button-container button:last-child{margin-left:var(--ti-common-space-2x)}"]
            },] }
];
TiIntromodalComponent.propDecorators = {
    title: [{ type: Input }],
    content: [{ type: Input }],
    image: [{ type: Input }],
    totalNumber: [{ type: Input }],
    currentNumber: [{ type: Input }],
    finishButtonText: [{ type: Input }],
    close: [{ type: Input }],
    wantStep: [{ type: Input }]
};

/**
 * @ignore
 */
class TiIntrotipComponent extends TiIntromodalComponent {
}
TiIntrotipComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-intromodal',
                template: "<ti-icon name=\"close\" class=\"ti3-intro-close\" tiOutline (click)=\"close(false)\" [tabindex]=\"0\" (keydown.enter)=\"close(false)\" [id]=\"appendId('close')\"></ti-icon>\r\n<div class=\"ti3-intro-header\" [id]=\"appendId('header')\">{{title}}</div>\r\n<div class=\"ti3-intro-body\" [id]=\"appendId('body')\">\r\n    <ng-container *ngIf=\"isStringContent else templateContent\">\r\n        <span>{{content}}</span>\r\n    </ng-container>\r\n    <div *ngIf=\"image\" [class]=\"image\"></div>\r\n</div>\r\n<div class=\"ti3-intro-footer\">\r\n    <div class=\"ti3-intro-steplist-container\" *ngIf=\"totalNumber > 1\">\r\n        <span *ngFor=\"let item of totalArray;let i = index;\"\r\n            class=\"ti3-intro-steplist-item\"\r\n            [ngClass]=\"{'active': i === currentNumber,\r\n                        'ti-step-showed': currentNumber > i }\"\r\n            (click)=\"wantStep(i)\"\r\n            [id]=\"appendId(i)\"></span>\r\n    </div>\r\n    <div class=\"ti3-intro-button-container\">\r\n        <button type=\"button\" tiButton *ngIf=\"currentNumber > 0\"\r\n            (click)=\"wantStep(currentNumber - 1)\"\r\n            [id]=\"appendId('previous')\">{{ 'tiIntro.previous' | tiTranslate }}</button>\r\n        <button type=\"button\" tiButton color=\"danger\"\r\n            *ngIf=\"currentNumber < totalNumber\"\r\n            (click)=\"wantStep(currentNumber + 1)\"\r\n            [id]=\"appendId('next')\">{{ 'tiIntro.next' | tiTranslate }}</button>\r\n        <button type=\"button\" tiButton color=\"danger\"\r\n            *ngIf=\"currentNumber === totalNumber\" (click)=\"close(true)\"\r\n            [id]=\"appendId('finish')\">{{ finishButtonText ? finishButtonText : 'tiIntro.finish' | tiTranslate }}</button>\r\n    </div>\r\n</div>",
                host: {
                    '[class.ti3-intromodal-wrapper]': 'true'
                },
                styles: ["::ng-deep :root{--ti-intro-step-list-item-width:5px}:host.ti3-intromodal-wrapper .ti3-intro-close{cursor:pointer;position:absolute;right:12px;top:12px}:host.ti3-intromodal-wrapper ti-modal-header{padding:var(--ti-common-space-8x) var(--ti-common-space-10x) var(--ti-common-space-3x);text-align:center}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body{padding:0 calc(var(--ti-common-space-base)*12);text-align:center}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-wrapper{font-size:0;line-height:0;margin-top:var(--ti-common-space-3x)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container{display:inline-block}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item{background-color:var(--ti-common-color-line-normal);border-radius:calc(var(--ti-intro-step-list-item-width)*0.5);cursor:pointer;float:left;height:var(--ti-intro-step-list-item-width);margin:0 3px;width:var(--ti-intro-step-list-item-width)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item:last-child{margin-right:0}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item.ti-step-showed{background-color:var(--ti-common-color-line-hover)}:host.ti3-intromodal-wrapper ti-modal-body.ti3-intro-body .ti3-intro-steplist-container .ti3-intro-steplist-item.active{width:20px}:host.ti3-intromodal-wrapper .ti3-intro-header{color:var(--ti-common-color-text-primary);font-size:var(--ti-common-font-size-2);font-weight:700;line-height:var(--ti-common-line-height-number);width:366px}:host.ti3-intromodal-wrapper .ti3-intro-body{color:var(--ti-common-color-text-secondary);line-height:20px;padding:12px 0 32px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container{float:left;margin-top:8px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item{background-color:var(--ti-common-color-line-normal);border-radius:calc(var(--ti-intro-step-list-item-width)*0.5);cursor:pointer;float:left;height:var(--ti-intro-step-list-item-width);margin:0 3px;width:var(--ti-intro-step-list-item-width)}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item:last-child{margin-right:0}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item.ti-step-showed{background-color:var(--ti-common-color-line-hover)}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-steplist-container .ti3-intro-steplist-item.active{width:20px}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-button-container{float:right}:host.ti3-intromodal-wrapper .ti3-intro-footer .ti3-intro-button-container button:last-child{margin-left:var(--ti-common-space-2x)}"]
            },] }
];

/**
 * @ignore
 */
class TiIntroServiceModule {
}
TiIntroServiceModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiButtonModule,
                    TiIconModule,
                    TiLocaleModule,
                    TiModalModule,
                    TiTipServiceModule,
                    TiOutlineModule
                ],
                declarations: [TiIntrotipComponent, TiIntromodalComponent],
                entryComponents: [TiIntrotipComponent, TiIntromodalComponent]
            },] }
];

/**
 * 新手引导组件，适用于服务中内容（入口）新增和变动等指引提醒
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)中引入BrowserAnimationsModule。</span>
 * 这是因为此组件中使用了 TiModalService，TiModalService需要BrowserAnimationsModule
 * （具体原因可以查看 [TiModalService]{@link ../injectables/TiModalService.html}），
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/intro/intro-all</example-url>
 */
class TiIntroService {
    constructor(tipService, modalService, rendererFactory, document) {
        this.tipService = tipService;
        this.modalService = modalService;
        this.document = document;
        // 可聚焦元素
        this.focusableElementsString = `a[href], area[href], input:not([disabled]):not([tabindex=\'-1\']),
    button:not([disabled]):not([tabindex=\'-1\']),select:not([disabled]):not([tabindex=\'-1\']),
    textarea:not([disabled]):not([tabindex=\'-1\']),
    iframe, object, embed, *[tabindex]:not([tabindex=\'-1\']), *[contenteditable=true]`;
        /**
         * intro的公共配置，不是默认配置，不能修改
         */
        this.commonConfig = {
            trigger: 'manual',
            theme: 'white',
            maxWidth: '400px'
        };
        /* tslint:disable:no-null-keyword */
        this.render = rendererFactory.createRenderer(null, null);
    }
    destroyBackdrop() {
        const canvas = this.document.body.querySelector('#ti3-intro-backdrop');
        if (canvas) {
            // canvas.remove() IE报错；canvas.removeNode() Chrome报错；可以使用removeChild方法
            canvas.parentNode.removeChild(canvas);
        }
    }
    static clearCircle(x, y, radius, stepClear, ctx) {
        const calcWidth = radius - stepClear;
        const calcHeight = Math.sqrt(radius * radius - calcWidth * calcWidth);
        const posX = x - calcWidth;
        const posY = y - calcHeight;
        const widthX = calcWidth * 2;
        const heightY = calcHeight * 2;
        if (stepClear < radius) {
            ctx.clearRect(posX, posY, widthX, heightY);
            const newStepClear = stepClear + 1;
            TiIntroService.clearCircle(x, y, radius, newStepClear, ctx);
        }
    }
    static scrollToViewport(element) {
        // 修复SSR错误：ERROR TypeError: element.getBoundingClientRect is not a function
        if (typeof element.getBoundingClientRect !== 'function') {
            return;
        }
        const layout = element.getBoundingClientRect();
        const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
        // 修复SSR报错：ERROR ReferenceError: window is not defined
        if (typeof window === 'undefined') {
            return;
        }
        if (layout.top < 0) {
            // 上边界溢出屏幕
            window.scrollTo(0, layout.top + scrollTop - 20);
        }
        else if (layout.bottom > document.documentElement.clientHeight) {
            // 下边界溢出屏幕
            window.scrollTo(0, scrollTop + layout.bottom + 20 - document.documentElement.clientHeight);
        }
    }
    /**
     * 创建intro实例
     */
    create(config) {
        let introRef; // create方法创建并返回的intro实例
        const steps = config.steps;
        let introModalRef; // modal实例，用于隐藏弹窗
        let introTipRef; // 是生成的tip，有show & hide
        let introMultiTipRefs = []; // 多个tip场景下生成的tip实例数组
        let curStep = 0; // 在整个create方法中，标识当前步数
        const lastStep = steps[steps.length - 1].step; // 最后一TiIntroStep的step属性值，即总步数
        // 关闭多个tip的操作元素
        const closeMultiTipEle = steps.filter((item) => item.isAction).length > 0 ?
            steps.filter((item) => item.isAction)[0].element : undefined;
        // 先隐藏closeMultiTipEle，并注册事件
        if (closeMultiTipEle) {
            this.render.setStyle(closeMultiTipEle, 'display', 'none');
        }
        this.unListenDocumentKeydown = this.render.listen(document, 'keydown', (event) => {
            switch (event.which) {
                case TiKeymap.KEY_TAB: // tab键用于处理在提示框内循环获取焦点
                    this.clickTab(event);
                    break;
                default:
                    break;
            }
        });
        /**
         * @param flag boolean true:完成intro引导；false：未完成intro引导，但是退出
         */
        const close = (flag) => {
            if (introMultiTipRefs.length > 0) {
                introMultiTipRefs.forEach((item) => {
                    this.hidePreStep(item);
                });
                introMultiTipRefs = [];
                this.render.setStyle(closeMultiTipEle, 'display', 'none');
            }
            else {
                this.hidePreStep(introTipRef);
            }
            this.destroyBackdrop();
            if (flag && typeof config.onFinish === 'function') {
                config.onFinish();
            }
            else if (!flag && typeof config.onExit === 'function') {
                config.onExit();
            }
            if (this.unListenWindowResize) {
                this.unListenWindowResize();
                this.unListenWindowResize = undefined;
            }
            if (this.unListenWindowHashchange) {
                this.unListenWindowHashchange();
                this.unListenWindowHashchange = undefined;
            }
            if (this.closeMultiTipEleClickListener) {
                this.closeMultiTipEleClickListener();
            }
            if (this.unListenDocumentKeydown) {
                this.unListenDocumentKeydown();
                this.unListenDocumentKeydown = undefined;
            }
        };
        /**
         * 无效步数条件：
         * 1.不是有效数字
         * 2.等于currentNumber，等于0除外
         * 3.小于0 或 大于 totalNumber
         * 使用curStep 和 lastStep，没有提为private方法
         */
        const isInvalidStepNum = (num) => {
            return isNaN(num) || (curStep === num && num !== 0) || num < 0 || num > lastStep;
        };
        /**
         * 即将进入某一步的引导
         *
         * 需要在进入前做一些合法性判断，清除上一步信息等
         */
        const wantStep = (num) => {
            if (isInvalidStepNum(num)) {
                TiLog.error('stepNumber is not valid');
                return;
            }
            this.hidePreStep(introTipRef);
            curStep = num;
            if (typeof config.beforeStep === 'function') {
                config.beforeStep(introRef, num);
            }
            else {
                // tslint:disable-next-line: no-use-before-declare
                goStep(num);
            }
            // 延时为了保证遮罩dom已经绘制完毕。
            setTimeout(() => {
                // 在引导的时候，把焦点调整为遮罩层。为后续把焦点圈在提示框内做准备。
                const backdropEle = document.querySelector('#ti3-intro-backdrop');
                if (backdropEle) {
                    backdropEle.focus();
                }
            }, 100);
        };
        // 开始某一步的引导
        const goStep = (num) => {
            const currentSteps = steps.filter((item) => item.step === num);
            // curIntroStep curIntroStep
            let currentStep;
            if (currentSteps.length === 1) {
                currentStep = currentSteps[0];
            }
            // 先关闭之前的canvas
            this.destroyBackdrop();
            /**
             * 具体的引导步骤分为3种
             * 1.总览页： 一个正常弹窗，用modal实现 intromodal
             * 2.分布页：带按钮的tip，用tipService实现
             * 3.提示： 没有按钮的普通tip，用tipService实现
             */
            // 第一种情况，弹窗
            if (currentStep && !currentStep.element) {
                introModalRef = this.modalService.open(TiIntromodalComponent, {
                    id: 'ti3-intro-modal',
                    context: {
                        title: currentStep.title,
                        content: currentStep.content,
                        totalNumber: lastStep,
                        currentNumber: curStep,
                        finishButtonText: config.finishButtonText,
                        id: config.id + '_' + num,
                        close: () => {
                            introModalRef.close();
                        },
                        wantStep
                    },
                    draggable: false
                });
                return;
            }
            // 如果有弹窗的话，关闭弹窗
            if (introModalRef) {
                introModalRef._remove();
                introModalRef = undefined;
            }
            // 重新绘制canvas
            this.drawBackdrop();
            // 第二种情况，带按钮的tip
            if (currentStep && currentStep.title) {
                TiIntroService.scrollToViewport(currentStep.element);
                introTipRef = this.tipService.create(currentStep.element, Object.assign(Object.assign({}, this.commonConfig), { position: currentStep.position, registerVisibilityChangeEvent: false }));
                introTipRef.show(TiIntrotipComponent, {
                    title: currentStep.title,
                    content: currentStep.content,
                    totalNumber: lastStep,
                    currentNumber: curStep,
                    finishButtonText: config.finishButtonText,
                    id: config.id + '_' + num,
                    close,
                    wantStep
                });
                this.highlight(currentStep.element, currentStep.shape);
            }
            // 第三种情况，普通tip，并且是多个，有一个是关闭按钮。和第二种情况是if else 的关系，重新列为一个if分支是为了让三种情况称为并列的if
            if (currentSteps && currentSteps.length > 1) {
                currentSteps.forEach((item) => {
                    if (item.isAction) {
                        this.render.setStyle(item.element, 'display', 'block');
                        this.closeMultiTipEleClickListener = this.render.listen(item.element, 'click', () => {
                            close(true);
                        });
                    }
                    else {
                        TiIntroService.scrollToViewport(item.element);
                        const introtipRef = this.tipService.create(item.element, Object.assign(Object.assign({}, this.commonConfig), { position: item.position, registerVisibilityChangeEvent: false }));
                        introtipRef.show(item.content);
                        introMultiTipRefs.push(introtipRef);
                        this.highlight(item.element, item.shape);
                    }
                });
            }
            // 修复SSR报错：ERROR ReferenceError: window is not defined
            if (!this.unListenWindowResize && typeof window !== 'undefined') {
                this.unListenWindowResize = this.render.listen(window, 'resize', () => {
                    this.hidePreStep(introTipRef);
                    this.destroyBackdrop();
                    goStep(curStep);
                });
            }
            if (!this.unListenWindowHashchange && typeof window !== 'undefined') {
                this.unListenWindowHashchange = this.render.listen(window, 'hashchange', () => {
                    close(false);
                });
            }
        };
        // 对外暴露的intro实例
        introRef = {
            start() {
                wantStep(0);
            },
            end() {
                close(true);
            },
            step: (number) => {
                wantStep(number);
            },
            proceed() {
                goStep(curStep);
            }
        };
        return introRef;
    }
    clickTab(event) {
        const introModal = document.querySelector('.ti3-intromodal-wrapper');
        const focusableElements = introModal === null || introModal === void 0 ? void 0 : introModal.querySelectorAll(this.focusableElementsString);
        Util.focusInDialogOnTabchange(event, focusableElements);
    }
    hidePreStep(introTipRef) {
        if (introTipRef) {
            introTipRef.hide();
        }
    }
    drawBackdrop() {
        // 修复SSR报错：
        /* ERROR Error: NotYetImplemented
        at HTMLCanvasElement.Wo4J.exports.nyi (D:\ngworkspace\tiny3-0119-2\ngversion\ng11-ssr\dist\tiny3demo\server\main.js:140019:9)
        at TiIntroService.drawBackdrop (D:\ngworkspace\tiny3-0119-2\ngversion\ng11-ssr\dist\tiny3demo\server\main.js:12914:28) */
        if (typeof document === 'undefined') {
            return;
        }
        const canvas = this.render.createElement('canvas');
        this.render.setStyle(canvas, 'z-index', 5000); // 最大的可取值为5000，5001会遮盖tip
        this.render.setStyle(canvas, 'position', 'absolute');
        this.render.setStyle(canvas, 'top', 0);
        this.render.setStyle(canvas, 'left', 0);
        this.render.setStyle(canvas, 'outline', 'none');
        this.render.setAttribute(canvas, 'tabindex', '0'); // 非表单元素想要使用focus()函数聚焦，需要设置tabindex属性。
        canvas.id = 'ti3-intro-backdrop';
        const ctx = canvas.getContext('2d');
        // _drawBackDrop(canvas, ctx) {
        // 获取整个页面宽高，用于计算canvas宽高
        // 获取整个页面的宽高,包括滚动条部分及body margin等
        let browserWidth = this.document.documentElement.scrollWidth;
        let browserHeight = this.document.documentElement.scrollHeight;
        // 获取整个页面可视区域宽高，页面不出滚动条情况下，该值原则上应该是与上述browser宽高相等的
        // 但是由于浏览器的计算差异，可能存在不相等的情况
        const clientWidth = this.document.documentElement.clientWidth;
        const clientHeight = this.document.documentElement.clientHeight;
        // 由于在IE下该宽高计算不精确，可能会导致页面本身无滚动条的情况下，
        // 当使用该值设置canvas宽度后，出现滚动条，因此需要对宽高进行特殊处理
        // 根据多次试验经验，发现当实际页面实际宽度为小数时，clientWidth取值为去掉小数点后的值，
        // scrollWidth则会自动+1，导致使用scrollWidth设置会出现滚动条，
        // 因此，通过两者之差小于1的方式判断该情况下，取小值设置canvas宽度即可解决该问题
        if (browserWidth - clientWidth <= 1) {
            browserWidth = clientWidth;
        }
        // 纵向情况下处理同上
        if (browserHeight - clientHeight <= 1) {
            browserHeight = clientHeight;
        }
        canvas.width = browserWidth;
        canvas.height = browserHeight;
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, browserWidth, browserHeight);
        this.render.appendChild(this.document.body, canvas);
    }
    highlight(element, shape) {
        const layout = Position.getHostEleLayout(element, element);
        const canvas = this.document.body.querySelector('#ti3-intro-backdrop');
        // 修复SSR报错：ERROR TypeError: Cannot read property 'getContext' of undefined
        if (!canvas) {
            return;
        }
        const ctx = canvas.getContext('2d');
        const highlightLayout = Object.assign({}, layout);
        if (layout.isFixed) {
            // 如果被高亮的元素是fixed定位，以元素相对于视口的位置为高亮区域的定位
            this.render.setStyle(canvas, 'position', 'fixed');
            highlightLayout.top = element.getBoundingClientRect().top;
            highlightLayout.left = element.getBoundingClientRect().left;
        }
        if (shape === 'circle') {
            const radius = (highlightLayout.width < highlightLayout.height ? highlightLayout.width : highlightLayout.height) / 2;
            const x = highlightLayout.left + highlightLayout.width / 2;
            const y = highlightLayout.top + highlightLayout.height / 2;
            TiIntroService.clearCircle(x, y, radius, 1, ctx);
        }
        else {
            ctx.clearRect(highlightLayout.left, highlightLayout.top, highlightLayout.width, highlightLayout.height);
        }
    }
}
TiIntroService.ɵprov = ɵɵdefineInjectable({ factory: function TiIntroService_Factory() { return new TiIntroService(ɵɵinject(TiTipService), ɵɵinject(TiModalService), ɵɵinject(RendererFactory2), ɵɵinject(DOCUMENT)); }, token: TiIntroService, providedIn: TiIntroServiceModule });
TiIntroService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiIntroServiceModule
            },] }
];
TiIntroService.ctorParameters = () => [
    { type: TiTipService },
    { type: TiModalService },
    { type: RendererFactory2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];

/**
 * @ignore
 * message模板组件定义
 */
class TiMessageComponent {
    constructor() {
        // 常量配置
        this.CONST_CONFIG = {
            validType: ['confirm', 'error', 'warn', 'prompt'],
            defaultType: 'confirm'
        };
        this.localeWords = TiLocale.getLocaleWords();
    }
    /**
     * 设置按钮属性（除primary和autofocus外）
     * @param options 外部配置属性
     * @param defaults 按钮text和click属性
     * @returns 合并后的属性
     */
    static setBtn(options, defaults) {
        const defaultOpts = Object.assign({ show: true, disabled: false }, defaults);
        if (typeof options === 'object') {
            return Object.assign(Object.assign({}, defaultOpts), options);
        }
        return defaultOpts;
    }
    ngOnInit() {
        this.setType();
        this.setTitle();
        this.setBtns();
        this.setContent();
    }
    setType() {
        const validType = this.CONST_CONFIG.validType;
        const defaultType = this.CONST_CONFIG.defaultType;
        if (validType.indexOf(this.type) === -1) {
            this.type = defaultType;
        }
    }
    setTitle() {
        if (typeof this.title === 'string') {
            return;
        }
        // 不同类型的message有默认title
        this.title = this.localeWords.tiMessage[this.type];
    }
    /**
     * 设置按钮属性：
     * 对按钮的设置支持Object类型
     * 为Object类型时，覆盖和扩展默认设置
     */
    setBtns() {
        this.okButton = TiMessageComponent.setBtn(this.okButton, {
            text: this.localeWords.tiMessage.ok,
            click: () => {
                this.close();
            }
        });
        this.cancelButton = TiMessageComponent.setBtn(this.cancelButton, {
            text: this.localeWords.tiMessage.cancel,
            click: () => {
                this.dismiss();
            }
        });
        this.setBtnUniqueState('autofocus');
        this.setBtnUniqueState('primary');
    }
    /**
     * 设置按钮属性，确保默认状态只在一个按钮生效
     * @param prop 按钮属性
     */
    setBtnUniqueState(prop) {
        if (Util.isUndefined(this.okButton[prop]) && Util.isUndefined(this.cancelButton[prop])) {
            this.okButton[prop] = true;
        }
    }
    setContent() {
        this.contentConfig = {
            content: this.content,
            context: this.context
        };
    }
    setId(suffix) {
        if (Util.isUndefined(this.id)) {
            return '';
        }
        return `${this.id}${suffix}`;
    }
}
TiMessageComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-message',
                template: "<ti-modal-header class=\"ti3-msg-header\">\r\n    <div class=\"ti3-msg-icon ti3-icon\"\r\n         [ngClass]=\"{ 'ti3-icon-check-circle': type === 'confirm',\r\n                    'ti3-icon-exclamation-circle ti3-msg-icon-error': type === 'error',\r\n                    'ti3-icon-warn ti3-msg-icon-warn': type ===  'warn',\r\n                    'ti3-icon-info-circle': type === 'prompt'}\">\r\n    </div>\r\n    <span *ngIf='title' class=\"ti3-msg-content-title\" [innerHtml]='title' [id]=\"setId('_title')\"></span>\r\n</ti-modal-header>\r\n<ti-modal-body>\r\n    <div class=\"ti3-msg-content-wrapper\" [tiTransclude]='contentConfig' [id]=\"setId('_body')\"></div>\r\n</ti-modal-body>\r\n<ti-modal-footer>\r\n    <button type=\"button\" tiButton\r\n            [color]=\"okButton.primary ? 'danger' : ''\"\r\n            [autofocus]=\"okButton.autofocus\"\r\n            *ngIf=\"okButton.show\"\r\n            [disabled]=\"okButton.disabled\"\r\n            (click)=\"okButton.click()\"\r\n            [id]='setId(\"_ok_btn\")'>{{okButton.text}}</button><!--\r\n    \u9700\u8981\u5C4F\u853D\u6362\u884C\u5BF9\u6309\u94AE\u95F4\u8DDD\u7684\u5F71\u54CD--><button type=\"button\" tiButton\r\n            [color]=\"cancelButton.primary ? 'danger' : ''\"\r\n            *ngIf=\"cancelButton.show\"\r\n            [autofocus]=\"cancelButton.autofocus\"\r\n            [disabled]=\"cancelButton.disabled\"\r\n            (click)=\"cancelButton.click()\"\r\n            [id]='setId(\"_cancel_btn\")'>{{cancelButton.text}}</button>\r\n</ti-modal-footer>",
                styles: ["::ng-deep :root{--ti-message-icon-margin-right:var(--ti-common-space-2x);--ti-message-icon-size:24px}ti-modal-header.ti3-msg-header{padding-bottom:var(--ti-common-space-3x)}.ti3-msg-icon{float:left;font-size:var(--ti-message-icon-size);line-height:normal;margin-right:var(--ti-message-icon-margin-right)}.ti3-msg-icon.ti3-icon-check-circle{color:var(--ti-message-prompt-icon-color)}.ti3-msg-icon.ti3-msg-icon-warn{color:var(--ti-message-warn-icon-color)}.ti3-msg-icon.ti3-icon-info-circle{color:var(--ti-message-confirm-icon-color)}.ti3-msg-icon.ti3-msg-icon-error{color:var(--ti-message-error-icon-color)}.ti3-msg-body{overflow:auto;padding:0 var(--ti-common-space-8x);position:relative}.ti3-msg-content-wrapper{color:var(--ti-common-color-text-secondary);font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);overflow:inherit;word-wrap:break-word}.ti3-msg-content-title{color:var(--ti-common-color-text-primary);display:inline-block;font-size:var(--ti-message-content-title-font-size);font-weight:700;line-height:26px;width:calc(100% - var(--ti-message-icon-size) - var(--ti-message-icon-margin-right))}"]
            },] }
];
TiMessageComponent.propDecorators = {
    id: [{ type: Input }],
    title: [{ type: Input }],
    type: [{ type: Input }],
    content: [{ type: Input }],
    context: [{ type: Input }],
    okButton: [{ type: Input }],
    cancelButton: [{ type: Input }],
    close: [{ type: Input }],
    dismiss: [{ type: Input }]
};

/**
 * @ignore
 */
class TiContentWrapperComponent {
}
TiContentWrapperComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-content-wrapper',
                template: '<ng-content></ng-content>'
            },] }
];

/**
 * @ignore
 * 生成并且compile内容为宿主元素的子元素
 */
class TiTranscludeDirective {
    constructor(eleRef, popService) {
        this.eleRef = eleRef;
        this.popService = popService;
    }
    ngOnInit() {
        this.wrapperRef = this.popService.create(TiContentWrapperComponent);
        this.wrapperRef.show({
            content: this.tiTransclude.content,
            contentContext: this.tiTransclude.context,
            container: this.eleRef
        });
    }
    ngOnDestroy() {
        this.wrapperRef.hide();
    }
}
TiTranscludeDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiTransclude]'
            },] }
];
TiTranscludeDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: TiPopupService }
];
TiTranscludeDirective.propDecorators = {
    tiTransclude: [{ type: Input }]
};

class TiMessageModule {
}
TiMessageModule.decorators = [
    { type: NgModule, args: [{
                imports: [CommonModule, TiModalModule, TiButtonModule, TiIconModule],
                declarations: [TiMessageComponent, TiTranscludeDirective, TiContentWrapperComponent],
                entryComponents: [TiMessageComponent, TiContentWrapperComponent]
            },] }
];

/**
 * 消息框组件，使用服务方式生成，使用该服务时需要引入模块TiMessageModule，通过调用TiMessageService.open(config)方法生成弹出框
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)
 * 中引入BrowserAnimationsModule。</span>这是因为此组件中使用了Angular动画，需要引入BrowserAnimationsModule，
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/message/message-all</example-url>
 */
class TiMessageService {
    constructor(tiModal) {
        this.tiModal = tiModal;
    }
    /**
     * 生成消息弹框方法
     * [config] 弹框配置信息
     * 返回 弹框实例信息，使用该实例信息可调用弹框的close等方法；内容为component类型时，也可通过content属性获取内容结果数据
     */
    open(config) {
        const { type, title, content, context, okButton, cancelButton } = config, modalConfig = __rest(config, ["type", "title", "content", "context", "okButton", "cancelButton"]);
        return this.tiModal.open(TiMessageComponent, Object.assign({ context: {
                id: config.id,
                type,
                title,
                content,
                context,
                okButton,
                cancelButton
            }, modalClass: 'ti3-msg-default-width' }, modalConfig));
    }
}
TiMessageService.ɵprov = ɵɵdefineInjectable({ factory: function TiMessageService_Factory() { return new TiMessageService(ɵɵinject(TiModalService)); }, token: TiMessageService, providedIn: TiMessageModule });
TiMessageService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiMessageModule
            },] }
];
TiMessageService.ctorParameters = () => [
    { type: TiModalService }
];

/**
 * @ignore
 *
 * 10.0.3版本增加，暂时不对外开放
 *
 * 该指令可以实现图片放大镜功能，添加tiZoom后会创建放大区域选择器元素（div）和放大结果呈现元素（div）
 *
 * 通过设置放大结果的background-image、background-size和background-position来达到放大效果
 *
 * 10.1.0版本从指令调整为组件形式
 *
 * <example-url>../tiny3demo/#/zoom/zoom-all</example-url>
 */
class TiZoomComponent {
    constructor(hostRef, renderer, tiRenderer) {
        this.renderer = renderer;
        this.tiRenderer = tiRenderer;
        // 选择遮罩的宽高，默认150px
        this.zoomSelectorLength = 150;
        // 放大展示的宽高，默认300px
        this.zoomViewerLength = 300;
        // 宿主元素的图片路径
        this.imgSrc = '';
        this.hostEle = hostRef.nativeElement;
    }
    ngOnInit() {
        // 设置父元素
        this.setParentEle();
        // 设置放大比例
        this.ratio = this.zoomViewerLength / this.zoomSelectorLength;
    }
    /**
     * @ignore
     * 图片加载成功事件处理
     */
    onHostLoad(event) {
        this.imgSrc = event.target.src;
    }
    /**
     * @ignore
     * 鼠标进入宿主元素，创建放大效果相关元素
     */
    onHostMouseEnter(event) {
        this.createZoomSelector();
        this.createZoomViewer();
        this.reStyleResults(event);
    }
    /**
     * @ignore
     * 鼠标离开宿主元素，移除放大效果相关元素
     */
    onHostMouseLeave(event) {
        // 当鼠标离开宿主元素并且不是进入选择遮罩时，移除选择遮罩和放大结果
        if (event.relatedTarget !== this.zoomSelectorEle) {
            this.removeZoomEle();
        }
    }
    /**
     * 设置父元素
     */
    setParentEle() {
        const parentEle = this.hostEle.parentElement;
        if (parentEle !== null && parentEle.clientWidth !== 0 && parentEle.clientHeight !== 0) {
            if (this.hostEle.offsetParent !== parentEle) {
                // 父元素必须能够定位
                this.renderer.setStyle(parentEle, 'position', 'relative');
            }
            this.parentEle = parentEle;
        }
        else {
            this.parentEle = document.body;
        }
    }
    /**
     * 创建选择遮罩，初始化样式，增加事件监听
     */
    createZoomSelector() {
        this.zoomSelectorEle = this.renderer.createElement('div');
        // 添加样式，tinyplus3的productpreview需要根据分辨率修改元素尺寸
        this.renderer.addClass(this.zoomSelectorEle, 'ti3-img-zoom-selector');
        this.tiRenderer.setStyles(this.zoomSelectorEle, {
            width: this.zoomSelectorLength + 'px',
            height: this.zoomSelectorLength + 'px'
        });
        // 鼠标在选择遮罩上移动时的事件
        this.selectorMouseMoveHandler = this.renderer.listen(this.zoomSelectorEle, 'mousemove', (event) => {
            this.reStyleResults(event);
        });
        // 鼠标离开选择遮罩的事件，销毁遮罩元素和放大结果呈现元素
        this.selectorMouseLeaveHandler = this.renderer.listen(this.zoomSelectorEle, 'mouseleave', (event) => {
            this.renderer.removeChild(this.parentEle, this.zoomSelectorEle);
            this.renderer.removeChild(document.body, this.zoomViewerEle);
            this.zoomSelectorEle = undefined;
            this.zoomViewerEle = undefined;
        });
        this.renderer.appendChild(this.parentEle, this.zoomSelectorEle);
    }
    /**
     * 创建放大结果呈现元素，初始化样式
     */
    createZoomViewer() {
        this.zoomViewerEle = this.renderer.createElement('div');
        const hostEleRect = this.hostEle.getBoundingClientRect();
        const parentEleRect = this.parentEle.getBoundingClientRect();
        // 放大结果元素相对于父元素进行定位
        // left = 父元素宽度 - 边框宽度 + 滚动距离
        let left = this.parentEle.offsetWidth - TiZoomComponent.ZOOM_VIEWER_BORDER_WIDTH + parentEleRect.left + window.pageXOffset;
        // top = 父元素到视口距离 + 滚动距离
        let top = parentEleRect.top + window.pageYOffset;
        // 当父元素为body时，调整为相对于宿主元素定位
        if (this.parentEle === document.body) {
            left = this.hostEle.offsetWidth - TiZoomComponent.ZOOM_VIEWER_BORDER_WIDTH + hostEleRect.left + window.pageXOffset;
            top = hostEleRect.top + window.pageYOffset;
        }
        // 添加样式，tinyplus3的productpreview需要根据分辨率修改元素尺寸
        this.renderer.addClass(this.zoomViewerEle, 'ti3-img-zoom-viewer');
        this.tiRenderer.setStyles(this.zoomViewerEle, {
            left: left + 'px',
            top: top + 'px',
            width: `${this.zoomViewerLength}px`,
            height: `${this.zoomViewerLength}px`,
            background: `url(${this.imgSrc})`,
            'background-size': `${this.hostEle.width * this.ratio}px ${this.hostEle.height * this.ratio}px`
        });
        this.renderer.appendChild(document.body, this.zoomViewerEle);
    }
    // 计算鼠标相对宿主元素的位置
    getCursorPos(mouseEvent) {
        const hostEleRect = this.hostEle.getBoundingClientRect();
        // 考虑滚动情况
        const left = mouseEvent.pageX - hostEleRect.left - window.pageXOffset;
        const top = mouseEvent.pageY - hostEleRect.top - window.pageYOffset;
        return { x: left, y: top };
    }
    /**
     * 计算选择遮罩偏移和放大区域
     */
    reStyleResults(mouseEvent) {
        // 1. 获取计算鼠标相对于宿主元素左上角的位置
        const cursorPos = this.getCursorPos(mouseEvent);
        // 获取遮罩宽度
        const zoomSelectorWidth = this.zoomSelectorEle.offsetWidth;
        // 2. 计算放大结果的位置
        let viewerPosX = cursorPos.x - (zoomSelectorWidth / 2);
        let viewerPosY = cursorPos.y - (zoomSelectorWidth / 2);
        // 3. 调整
        // 3.1 选择遮罩移出宿主元素的右侧
        if (viewerPosX > this.hostEle.offsetWidth - zoomSelectorWidth) {
            viewerPosX = this.hostEle.offsetWidth - zoomSelectorWidth;
        }
        // 3.2 选择遮罩移出宿主元素的左侧
        if (viewerPosX < 0) {
            viewerPosX = 0;
        }
        // 3.3 选择遮罩移出宿主元素的下方
        if (viewerPosY > this.hostEle.offsetHeight - zoomSelectorWidth) {
            viewerPosY = this.hostEle.offsetHeight - zoomSelectorWidth;
        }
        // 3.4 选择遮罩移出宿主元素的上方
        if (viewerPosY < 0) {
            viewerPosY = 0;
        }
        // 4. 设置选择区域偏移，选择区域偏移=放大结果位置 + 宿主元素的偏移
        this.tiRenderer.setStyles(this.zoomSelectorEle, {
            left: `${viewerPosX + this.hostEle.offsetLeft}px`,
            top: `${viewerPosY + this.hostEle.offsetTop}px`
        });
        // 5. 设置放大结果
        this.renderer.setStyle(this.zoomViewerEle, 'background-position', `-${viewerPosX * this.ratio}px -${viewerPosY * this.ratio}px`);
    }
    ngOnDestroy() {
        this.removeZoomEle();
    }
    /**
     * 移除选择遮罩和放大结果元素、解绑相关事件
     */
    removeZoomEle() {
        if (this.zoomSelectorEle !== undefined) {
            this.renderer.removeChild(this.parentEle, this.zoomSelectorEle);
            this.zoomSelectorEle = undefined;
        }
        if (this.zoomViewerEle !== undefined) {
            this.renderer.removeChild(document.body, this.zoomViewerEle);
            this.zoomViewerEle = undefined;
        }
        if (this.selectorMouseMoveHandler) {
            this.selectorMouseMoveHandler();
        }
        if (this.selectorMouseLeaveHandler) {
            this.selectorMouseLeaveHandler();
        }
    }
}
// 放大结果的边框宽度
TiZoomComponent.ZOOM_VIEWER_BORDER_WIDTH = 1;
TiZoomComponent.decorators = [
    { type: Component, args: [{
                // 非img元素，tiZoom指令无效
                selector: 'img[tiZoom]',
                template: '',
                styles: [".ti3-img-zoom-selector{background-color:var(--ti-common-color-icon-hover);cursor:move;display:block;left:0;opacity:.2;position:absolute;top:0}.ti3-img-zoom-viewer{background-repeat:no-repeat!important;border:1px solid var(--ti-common-color-line-dividing);box-sizing:border-box;display:block;position:absolute;top:0}"]
            },] }
];
TiZoomComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiRenderer }
];
TiZoomComponent.propDecorators = {
    zoomSelectorLength: [{ type: Input }],
    zoomViewerLength: [{ type: Input }],
    onHostLoad: [{ type: HostListener, args: ['load', ['$event'],] }],
    onHostMouseEnter: [{ type: HostListener, args: ['mouseenter', ['$event'],] }],
    onHostMouseLeave: [{ type: HostListener, args: ['mouseleave', ['$event'],] }]
};

class TiZoomModule {
}
TiZoomModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule,
                    TiRendererModule
                ],
                exports: [TiZoomComponent],
                declarations: [TiZoomComponent]
            },] }
];

// 按照类名字母排序

/**
 * Generated bundle index. Do not edit.
 */

export { BaseValidator, ContainsValidatorDirective, DateValidatorDirective, DigitsValidatorDirective, EmailValidatorDirective, EqualValidatorDirective, IntegerValidatorDirective, Ipv4ValidatorDirective, Ipv6ValidatorDirective, MaxLengthValidatorDirective, MaxValueValidatorDirective, MinLengthValidatorDirective, MinValueValidatorDirective, NotContainsValidatorDirective, NotEqualValidatorDirective, NotScriptValidatorDirective, NumberValidatorDirective, PasswordValidatorDirective, PortValidatorDirective, RangeSizeValidatorDirective, RangeValueValidatorDirective, RegExpValidatorDirective, RequiredValidatorDirective, TiAccordionComponent, TiAccordionHeadComponent, TiAccordionItemComponent, TiAccordionModule, TiActionmenuComponent, TiActionmenuModule, TiAlertComponent, TiAlertModule, TiAutocompleteComponent, TiAutocompleteModule, TiBackdropNoAnimationComponent, TiBaseComponent, TiBaseModule, TiBrowser, TiButtonComponent, TiButtonItemComponent, TiButtonModule, TiButtongroupComponent, TiButtongroupModule, TiCellIconsComponent, TiCellTextComponent, TiCheckboxComponent, TiCheckboxModule, TiCheckgroupComponent, TiCheckgroupModule, TiCheckitemComponent, TiColClickDirective, TiCollapseDirective, TiCollapseModule, TiColsResizableDirective, TiColsToggleComponent, TiColspanDirective, TiColumnFixedDirective, TiDateBaseComponent, TiDateBaseModule, TiDateComponent, TiDateDominatorComponent, TiDateDominatorModule, TiDateEditComponent, TiDateEditModule, TiDateModule, TiDatePanelComponent, TiDatePanelModule, TiDateRangeComponent, TiDateRangeModule, TiDatetimeComponent, TiDatetimeModule, TiDatetimeRangeComponent, TiDatetimeRangeModule, TiDetailsIconComponent, TiDetailsTrDirective, TiDisabledDirective, TiDominatorComponent, TiDominatorModule, TiDragService, TiDragServiceModule, TiDraggableDirective, TiDraggableModule, TiDropComponent, TiDropModule, TiDroplistComponent, TiDroplistModule, TiDropsearchComponent, TiDropsearchModule, TiErrorMsgComponent, TiFileSelectDirective, TiFormComponent, TiFormfieldComponent, TiFormfieldModule, TiHeadFilterComponent, TiHeadSortComponent, TiIconClassComponent, TiIconComponent, TiIconModule, TiImagepreviewComponent, TiImagepreviewModule, TiIncludeDirective, TiIncludeModule, TiInputNumberDirective, TiInputNumberModule, TiIntroService, TiIntroServiceModule, TiIpComponent, TiIpModule, TiIpsectionComponent, TiIpsectionModule, TiItemComponent, TiItemLabelComponent, TiKeymap, TiLeftmenuComponent, TiLeftmenuFootComponent, TiLeftmenuGroupComponent, TiLeftmenuGroupItemComponent, TiLeftmenuHeadComponent, TiLeftmenuItemComponent, TiLeftmenuLevel1Component, TiLeftmenuLevel2Component, TiLeftmenuModule, TiListComponent, TiListModule, TiLoadingComponent, TiLoadingModule, TiLocale, TiLocaleFormat, TiLocaleModule, TiLog, TiMaskDirective, TiMaskModule, TiMenuComponent, TiMenuListComponent, TiMenuModule, TiMessageModule, TiMessageService, TiModalBodyComponent, TiModalComponent, TiModalFooterComponent, TiModalHeaderComponent, TiModalModule, TiModalNoAnimationComponent, TiModalService, TiOutlineDirective, TiOutlineModule, TiOverflowDirective, TiOverflowMaxlineDirective, TiOverflowModule, TiOverflowService, TiOverflowServiceModule, TiPaginationComponent, TiPaginationModule, TiPendingStateComponent, TiPopconfirmDirective, TiPopconfirmModule, TiPopupModule, TiPopupService, Position as TiPosition, TiProgressbarComponent, TiProgressbarModule, TiProgresspieComponent, TiProgresspieModule, TiRadioComponent, TiRadioModule, TiRenderer, TiRendererModule, TiScrollDirective, TiScrollModule, TiSearchboxComponent, TiSearchboxModule, TiSearchboxNotsearchComponent, TiSelectComponent, TiSelectModule, TiSliderComponent, TiSliderModule, TiSpinnerComponent, TiSpinnerModule, TiStepsComponent, TiStepsModule, TiSwitchComponent, TiSwitchModule, TiTabComponent, TiTabHeaderComponent, TiTabModule, TiTableComponent, TiTableModule, TiTabsComponent, TiTagComponent, TiTagModule, TiTagsInputComponent, TiTagsInputModule, TiTextComponent, TiTextModule, TiTextareaComponent, TiTextareaModule, TiTheme, TiTimeComponent, TiTimeModule, TiTipDirective, TiTipModule, TiTipService, TiTipServiceModule, TiTranslatePipe, TiTreeComponent, TiTreeModule, TiTreeUtil, TiTreeselectComponent, TiTreeselectModule, TiUploadComponent, TiUploadModule, TiUploadService, TiUploadServiceModule, TiUploadUtil, TiUploadbaseComponent, TiUploadimageComponent, TiValidationDirective, TiValidationModule, TiValidators, TiWholeComponent, TiZoomComponent, TiZoomModule, UrlValidatorDirective, Util, de_DE, en_US, es_ES, es_US, fr_FR, pt_BR, zh_CN, TiRadioBaseComponent as ɵa, TiAutofocusComponent as ɵb, TiPopconfirmComponent as ɵc, TiMessageComponent as ɵd, ObservableMap as ɵe, ObservableSet as ɵf, TiTipContainerComponent as ɵg, TiBackdropComponent as ɵh, CheckStyleService as ɵi, CheckStyleModule as ɵj, CommonServiceModule as ɵk, CommonService as ɵl, TiPwdMsgComponent as ɵm, TiTableFixedHeadService as ɵn, TiTableFixedHeadServiceModule as ɵo, TiHeadFilterDropComponent as ɵp, TiColsToggleDropComponent as ɵq, TiColumnsPipe as ɵr, TiFormatNumPipe as ɵs, TiHighlightPipe as ɵt, TiAutoSelectDirective as ɵu, TiIntrotipComponent as ɵv, TiIntromodalComponent as ɵw, TiTranscludeDirective as ɵx, TiContentWrapperComponent as ɵy };
//# sourceMappingURL=cloud-tiny3.js.map
