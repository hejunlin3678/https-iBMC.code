import { Util } from '../../../utils/Util';
/**
 * @ignore
 */
export class TiPwdConfig {
    // /**
    //  * 计算密码熵值,具体的计算密码熵值的算法如下：
    //  * 1、第一个字符为4bits
    //  * 2、2-8个字符，每一个字符为2bits
    //  * 3、9-20个字符之间，每一个字符为1.5bits
    //  * 4、21个字符之后，每一个字符为1bit
    //  * 5、如果密码中同时存在大写字母和特殊字符，则熵值+6
    //  * @param {String} str 密码字串
    //  * @param {Number} minLen 密码最小长度
    //  * @param {Number} minType 密码最小组合种类
    //  * @returns {Number} level 密码等级
    //  */
    static pwdLevelFn(value, validator) {
        const validatorParam = getValidatorParam();
        const minCharLen = validatorParam.minCharLen;
        const minCharTypeNum = validatorParam.minCharTypeNum;
        const charTypeRegObj = validatorParam.charTypeRegObj;
        // 根据字符个数初步计算熵值
        const len = value.length;
        let pwdScore = 0;
        if (len >= 21) {
            pwdScore = (len - 21) + 1.5 * 12 + 2 * 7 + 4;
        }
        else if (len >= 9 && len < 21) {
            pwdScore = (len - 9 + 1) * 1.5 + 2 * 7 + 4;
        }
        else if (len >= 2 && len < 9) {
            pwdScore = (len - 2 + 1) * 2 + 4;
        }
        else if (len >= 1 && len < 2) {
            pwdScore = 4;
        }
        // 同时存在大写字母和特殊字符，熵值+6
        if (charTypeRegObj.upperCharReg &&
            charTypeRegObj.upperCharReg.test(value) &&
            charTypeRegObj.specialCharReg.test(value)) {
            pwdScore += 6;
            // 重置正则表达式的lastIndex属性:只有正则表达式使用了表示全局检索的 "g" 标志时，该属性才会起作用，
            // 当前正则匹配到字串后，下次使用同样的正则匹配该字串时，正则检查位置会发生变化
            charTypeRegObj.upperCharReg.lastIndex = 0;
            charTypeRegObj.specialCharReg.lastIndex = 0;
        }
        // 根据熵值计算等级
        return countLevel(pwdScore);
        function getValidatorParam() {
            const params = validator.params;
            // 默认值设定
            let minCharLength = 0;
            let minCharTypeNumber = 0;
            let charTypeRegObject = {
                specialCharReg: /[~`!\?,.:;\-_'"\(\)\{\}\[\]\/<>@#\$%\^&\*\+\|\\=\s]/,
                lowerCharReg: /[a-z]+/,
                upperCharReg: /[A-Z]+/,
                digitsCharReg: /[0-9]+/
            };
            // 通过rangeSize规则获取最小长度
            const rangeSizeParams = params.rangeSize;
            if (!Util.isUndefined(rangeSizeParams)) {
                minCharLength = parseInt(rangeSizeParams[0], 10) || 0;
            }
            // 通过minCharType规则获取最小字符类型及其正则
            const minCharTypeParams = params.minCharType;
            if (!Util.isUndefined(minCharTypeParams)) {
                minCharTypeNumber = parseInt(minCharTypeParams[0], 10) || 0;
                charTypeRegObject = minCharTypeParams[1] || charTypeRegObject;
            }
            // 返回对象值
            return {
                minCharLen: minCharLength,
                minCharTypeNum: minCharTypeNumber,
                charTypeRegObj: charTypeRegObject
            };
        }
        /**
         * 计算密码等级
         * 低： 0~25.5（ 小于等于25 .5）
         * 中： 25.5~30(大于25 .5 小于等于30)
         * 高： 30~（大于30）
         * @param score 密码分数
         * @returns 密码等级
         */
        function countLevel(score) {
            let level = 0;
            if (score > 30) {
                level = 2;
            }
            else if (score > 25.5 && score <= 30) {
                level = 1;
            }
            else if (score >= 0 && score <= 25.5) {
                level = 0;
            }
            level = levelHandle(minCharLen, minCharTypeNum, level);
            return level;
        }
        // 密码降级处理
        function levelHandle(psdLen, psdType, level) {
            const type = getCharType(value);
            let pwdLevel = level;
            if (level > 0) {
                if ((psdLen && len < psdLen) || (psdType && type < psdType)) {
                    pwdLevel = level - 1;
                }
            }
            return pwdLevel;
        }
        // 获取当前密码字符种类
        function getCharType(str) {
            let typeNum = 0;
            for (const key in charTypeRegObj) {
                if (charTypeRegObj.hasOwnProperty(key)) {
                    const regExp = charTypeRegObj[key];
                    if (regExp.test(str)) {
                        typeNum++;
                        regExp.lastIndex = 0;
                    }
                }
            }
            return typeNum;
        }
    }
}
TiPwdConfig.pwdTipPostion = 'right';
TiPwdConfig.pwdTipMaxWidth = '440px';
// pwd校验规则
TiPwdConfig.pwdCharTypeRegObj = {
    // specialCharReg: /[~`!\?,.:;\-_'"\(\)\{\}\[\]\/<>@#\$%\^&\*\+\|\\=\s]/,
    // https://www.bejson.com/zhuanyi/ Json转义工具有错，单引号未转义
    specialCharReg: new RegExp('[~`!\\?,.:;\\-_\'\"\\(\\)\\{\\}\\[\\]\\/<>@#\\$%\\^&\\*\\+\\|\\\\=\\s]'),
    lowerCharReg: new RegExp('[a-z]+'),
    upperCharReg: new RegExp('[A-Z]+'),
    digitsCharReg: new RegExp('[0-9]+')
};
TiPwdConfig.pwdValidator = {
    rule: 'password',
    params: {
        rangeSize: [6, 32],
        minCharType: [2] // 该校验方法支持两个参数传递,第二个参数为charTypeRegObj,不传递第二个参数情况下,代表使用该配置中的默认值
    },
    message: {
        rangeSize: '',
        minCharType: '',
        notEqualPosRev: ''
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlQd2RDb25maWcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvZGlyZWN0aXZlcy92YWxpZGF0aW9uL2NoZWNrSGFuZGxlL1RpUHdkQ29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQVUzQzs7R0FFRztBQUNILE1BQU0sT0FBTyxXQUFXO0lBd0JwQixNQUFNO0lBQ04sNEJBQTRCO0lBQzVCLG1CQUFtQjtJQUNuQiwwQkFBMEI7SUFDMUIsK0JBQStCO0lBQy9CLDBCQUEwQjtJQUMxQixnQ0FBZ0M7SUFDaEMsOEJBQThCO0lBQzlCLG1DQUFtQztJQUNuQyxzQ0FBc0M7SUFDdEMsa0NBQWtDO0lBQ2xDLE1BQU07SUFDQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQWEsRUFBRSxTQUFvQztRQUN4RSxNQUFNLGNBQWMsR0FBZ0IsaUJBQWlCLEVBQUUsQ0FBQztRQUN4RCxNQUFNLFVBQVUsR0FBVyxjQUFjLENBQUMsVUFBVSxDQUFDO1FBQ3JELE1BQU0sY0FBYyxHQUFXLGNBQWMsQ0FBQyxjQUFjLENBQUM7UUFDN0QsTUFBTSxjQUFjLEdBQVEsY0FBYyxDQUFDLGNBQXFCLENBQUM7UUFDakUsZUFBZTtRQUNmLE1BQU0sR0FBRyxHQUFXLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDakMsSUFBSSxRQUFRLEdBQVcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksR0FBRyxJQUFJLEVBQUUsRUFBRTtZQUNYLFFBQVEsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ2hEO2FBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxFQUFFLEVBQUU7WUFDN0IsUUFBUSxHQUFHLENBQUMsR0FBRyxHQUFHLENB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Q2xDLFlBQVksRUFBRSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDbEMsYUFBYSxFQUFFLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQztDQUN0QyxDQUFDO0FBQ1ksd0JBQVksR0FBUTtJQUM5QixJQUFJLEVBQUUsVUFBVTtJQUNoQixNQUFNLEVBQUU7UUFDSixTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ2xCLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLDhEQUE4RDtLQUNsRjtJQUNELE9BQU8sRUFBRTtRQUNMLFNBQVMsRUFBRSxFQUFFO1FBQ2IsV0FBVyxFQUFFLEVBQUU7UUFDZixjQUFjLEVBQUUsRUFBRTtLQUNyQjtDQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFRpUGFzc3dvcmRWYWxpZGF0b3JDb25maWcgfSBmcm9tICcuLi9UaVZhbGlkYXRpb25JbnRlcmZhY2UnO1xyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBUaVB3ZFBhcmFtcyB7XHJcbiAgICBtaW5DaGFyTGVuOiBudW1iZXI7XHJcbiAgICBtaW5DaGFyVHlwZU51bTogbnVtYmVyO1xyXG4gICAgY2hhclR5cGVSZWdPYmo6IGFueTtcclxufVxyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFRpUHdkQ29uZmlnIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgcHdkVGlwUG9zdGlvbjogc3RyaW5nID0gJ3JpZ2h0JztcclxuICAgIHB1YmxpYyBzdGF0aWMgcHdkVGlwTWF4V2lkdGg6IHN0cmluZyA9ICc0NDBweCc7XHJcbiAgICAvLyBwd2TmoKHpqozop4TliJlcclxuICAgIHB1YmxpYyBzdGF0aWMgcHdkQ2hhclR5cGVSZWdPYmo6IGFueSA9IHsvLyDpu5jorqTlrZfkuLLnsbvlnovpm4blkIgs54m55q6K6KeE5YiZ5Y+v5Zyo5q2k5aSE6L+b6KGM6YWN572uXHJcbiAgICAgICAgLy8gc3BlY2lhbENoYXJSZWc6IC9bfmAhXFw/LC46O1xcLV8nXCJcXChcXClcXHtcXH1cXFtcXF1cXC88PkAjXFwkJVxcXiZcXCpcXCtcXHxcXFxcPVxcc10vLFxyXG4gICAgICAgIC8vIGh0dHBzOi8vd3d3LmJlanNvbi5jb20vemh1YW55aS8gSnNvbui9rOS5ieW3peWFt+aciemUme+8jOWNleW8leWPt+acqui9rOS5iVxyXG4gICAgICAgIHNwZWNpYWxDaGFyUmVnOiBuZXcgUmVnRXhwKCdbfmAhXFxcXD8sLjo7XFxcXC1fXFwnXFxcIlxcXFwoXFxcXClcXFxce1xcXFx9XFxcXFtcXFxcXVxcXFwvPD5AI1xcXFwkJVxcXFxeJlxcXFwqXFxcXCtcXFxcfFxcXFxcXFxcPVxcXFxzXScpLFxyXG4gICAgICAgIGxvd2VyQ2hhclJlZzogbmV3IFJlZ0V4cCgnW2Etel0rJyksXHJcbiAgICAgICAgdXBwZXJDaGFyUmVnOiBuZXcgUmVnRXhwKCdbQS1aXSsnKSxcclxuICAgICAgICBkaWdpdHNDaGFyUmVnOiBuZXcgUmVnRXhwKCdbMC05XSsnKVxyXG4gICAgfTtcclxuICAgIHB1YmxpYyBzdGF0aWMgcHdkVmFsaWRhdG9yOiBhbnkgPSB7XHJcbiAgICAgICAgcnVsZTogJ3Bhc3N3b3JkJyxcclxuICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgcmFuZ2VTaXplOiBbNiwgMzJdLFxyXG4gICAgICAgICAgICBtaW5DaGFyVHlwZTogWzJdIC8vIOivpeagoemqjOaWueazleaUr+aMgeS4pOS4quWPguaVsOS8oOmAkiznrKzkuozkuKrlj4LmlbDkuLpjaGFyVHlwZVJlZ09iaizkuI3kvKDpgJLnrKzkuozkuKrlj4LmlbDmg4XlhrXkuIss5Luj6KGo5L2/55So6K+l6YWN572u5Lit55qE6buY6K6k5YC8XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXNzYWdlOiB7XHJcbiAgICAgICAgICAgIHJhbmdlU2l6ZTogJycsIC8vICcn5Luj6KGo5L2/55So57uE5Lu25Zu96ZmF5YyW6K+t6KiA5Lit55qE6buY6K6k5o+Q56S65paH5pysXHJcbiAgICAgICAgICAgIG1pbkNoYXJUeXBlOiAnJyxcclxuICAgICAgICAgICAgbm90RXF1YWxQb3NSZXY6ICcnXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vIC8qKlxyXG4gICAgLy8gICog6K6h566X5a+G56CB54a15YC8LOWFt+S9k+eahOiuoeeul+WvhueggeeGteWAvOeahOeul+azleWmguS4i++8mlxyXG4gICAgLy8gICogMeOAgeesrOS4gOS4quWtl+espuS4ujRiaXRzXHJcbiAgICAvLyAgKiAy44CBMi045Liq5a2X56ym77yM5q+P5LiA5Liq5a2X56ym5Li6MmJpdHNcclxuICAgIC8vICAqIDPjgIE5LTIw5Liq5a2X56ym5LmL6Ze077yM5q+P5LiA5Liq5a2X56ym5Li6MS41Yml0c1xyXG4gICAgLy8gICogNOOAgTIx5Liq5a2X56ym5LmL5ZCO77yM5q+P5LiA5Liq5a2X56ym5Li6MWJpdFxyXG4gICAgLy8gICogNeOAgeWmguaenOWvhueggeS4reWQjOaXtuWtmOWcqOWkp+WGmeWtl+avjeWSjOeJueauiuWtl+espu+8jOWImeeGteWAvCs2XHJcbiAgICAvLyAgKiBAcGFyYW0ge1N0cmluZ30gc3RyIOWvhueggeWtl+S4slxyXG4gICAgLy8gICogQHBhcmFtIHtOdW1iZXJ9IG1pbkxlbiDlr4bnoIHmnIDlsI/plb/luqZcclxuICAgIC8vICAqIEBwYXJhbSB7TnVtYmVyfSBtaW5UeXBlIOWvhueggeacgOWwj+e7hOWQiOenjeexu1xyXG4gICAgLy8gICogQHJldHVybnMge051bWJlcn0gbGV2ZWwg5a+G56CB562J57qnXHJcbiAgICAvLyAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgcHdkTGV2ZWxGbih2YWx1ZTogc3RyaW5nLCB2YWxpZGF0b3I6IFRpUGFzc3dvcmRWYWxpZGF0b3JDb25maWcpOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkYXRvclBhcmFtOiBUaVB3ZFBhcmFtcyA9IGdldFZhbGlkYXRvclBhcmFtKCk7XHJcbiAgICAgICAgY29uc3QgbWluQ2hhckxlbjogbnVtYmVyID0gdmFsaWRhdG9yUGFyYW0ubWluQ2hhckxlbjtcclxuICAgICAgICBjb25zdCBtaW5DaGFyVHlwZU51bTogbnVtYmVyID0gdmFsaWRhdG9yUGFyYW0ubWluQ2hhclR5cGVOdW07XHJcbiAgICAgICAgY29uc3QgY2hhclR5cGVSZWdPYmo6IGFueSA9IHZhbGlkYXRvclBhcmFtLmNoYXJUeXBlUmVnT2JqIGFzIGFueTtcclxuICAgICAgICAvLyDmoLnmja7lrZfnrKbkuKrmlbDliJ3mraXorqHnrpfnhrXlgLxcclxuICAgICAgICBjb25zdCBsZW46IG51bWJlciA9IHZhbHVlLmxlbmd0aDtcclxuICAgICAgICBsZXQgcHdkU2NvcmU6IG51bWJlciA9IDA7XHJcbiAgICAgICAgaWYgKGxlbiA+PSAyMSkge1xyXG4gICAgICAgICAgICBwd2RTY29yZSA9IChsZW4gLSAyMSkgKyAxLjUgKiAxMiArIDIgKiA3ICsgNDtcclxuICAgICAgICB9IGVsc2UgaWYgKGxlbiA+PSA5ICYmIGxlbiA8IDIxKSB7XHJcbiAgICAgICAgICAgIHB3ZFNjb3JlID0gKGxlbiAtIDkgKyAxKSAqIDEuNSArIDIgKiA3ICsgNDtcclxuICAgICAgICB9IGVsc2UgaWYgKGxlbiA+PSAyICYmIGxlbiA8IDkpIHtcclxuICAgICAgICAgICAgcHdkU2NvcmUgPSAobGVuIC0gMiArIDEpICogMiArIDQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChsZW4gPj0gMSAmJiBsZW4gPCAyKSB7XHJcbiAgICAgICAgICAgIHB3ZFNjb3JlID0gNDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5ZCM5pe25a2Y5Zyo5aSn5YaZ5a2X5q+N5ZKM54m55q6K5a2X56ym77yM54a15YC8KzZcclxuICAgICAgICBpZiAoY2hhclR5cGVSZWdPYmoudXBwZXJDaGFyUmVnICYmXHJcbiAgICAgICAgICAgIGNoYXJUeXBlUmVnT2JqLnVwcGVyQ2hhclJlZy50ZXN0KHZhbHVlKSAmJlxyXG4gICAgICAgICAgICBjaGFyVHlwZVJlZ09iai5zcGVjaWFsQ2hhclJlZy50ZXN0KHZhbHVlKSkge1xyXG4gICAgICAgICAgICBwd2RTY29yZSArPSA2O1xyXG5cclxuICAgICAgICAgICAgLy8g6YeN572u5q2j5YiZ6KGo6L6+5byP55qEbGFzdEluZGV45bGe5oCnOuWPquacieato+WImeihqOi+vuW8j+S9v+eUqOS6huihqOekuuWFqOWxgOajgOe0oueahCBcImdcIiDmoIflv5fml7bvvIzor6XlsZ7mgKfmiY3kvJrotbfkvZznlKjvvIxcclxuICAgICAgICAgICAgLy8g5b2T5YmN5q2j5YiZ5Yy56YWN5Yiw5a2X5Liy5ZCO77yM5LiL5qyh5L2/55So5ZCM5qC355qE5q2j5YiZ5Yy56YWN6K+l5a2X5Liy5pe277yM5q2j5YiZ5qOA5p+l5L2N572u5Lya5Y+R55Sf5Y+Y5YyWXHJcbiAgICAgICAgICAgIGNoYXJUeXBlUmVnT2JqLnVwcGVyQ2hhclJlZy5sYXN0SW5kZXggPSAwO1xyXG4gICAgICAgICAgICBjaGFyVHlwZVJlZ09iai5zcGVjaWFsQ2hhclJlZy5sYXN0SW5kZXggPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5qC55o2u54a15YC86K6h566X562J57qnXHJcbiAgICAgICAgcmV0dXJuIGNvdW50TGV2ZWwocHdkU2NvcmUpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRWYWxpZGF0b3JQYXJhbSgpOiBUaVB3ZFBhcmFtcyB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtczogYW55ID0gdmFsaWRhdG9yLnBhcmFtcztcclxuICAgICAgICAgICAgLy8g6buY6K6k5YC86K6+5a6aXHJcbiAgICAgICAgICAgIGxldCBtaW5DaGFyTGVuZ3RoOiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBsZXQgbWluQ2hhclR5cGVOdW1iZXI6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGxldCBjaGFyVHlwZVJlZ09iamVjdDogYW55ID0gey8vIOm7mOiupOWtl+S4suexu+Wei+mbhuWQiCznibnmrorop4TliJnlj6/lnKjmraTlpITov5vooYzphY3nva5cclxuICAgICAgICAgICAgICAgIHNwZWNpYWxDaGFyUmVnOiAvW35gIVxcPywuOjtcXC1fJ1wiXFwoXFwpXFx7XFx9XFxbXFxdXFwvPD5AI1xcJCVcXF4mXFwqXFwrXFx8XFxcXD1cXHNdLyxcclxuICAgICAgICAgICAgICAgIGxvd2VyQ2hhclJlZzogL1thLXpdKy8sXHJcbiAgICAgICAgICAgICAgICB1cHBlckNoYXJSZWc6IC9bQS1aXSsvLFxyXG4gICAgICAgICAgICAgICAgZGlnaXRzQ2hhclJlZzogL1swLTldKy9cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIOmAmui/h3JhbmdlU2l6ZeinhOWImeiOt+WPluacgOWwj+mVv+W6plxyXG4gICAgICAgICAgICBjb25zdCByYW5nZVNpemVQYXJhbXM6IG51bWJlciA9IHBhcmFtcy5yYW5nZVNpemU7XHJcbiAgICAgICAgICAgIGlmICghVXRpbC5pc1VuZGVmaW5lZChyYW5nZVNpemVQYXJhbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBtaW5DaGFyTGVuZ3RoID0gcGFyc2VJbnQocmFuZ2VTaXplUGFyYW1zWzBdLCAxMCkgfHwgMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDpgJrov4dtaW5DaGFyVHlwZeinhOWImeiOt+WPluacgOWwj+Wtl+espuexu+Wei+WPiuWFtuato+WImVxyXG4gICAgICAgICAgICBjb25zdCBtaW5DaGFyVHlwZVBhcmFtczogbnVtYmVyID0gcGFyYW1zLm1pbkNoYXJUeXBlO1xyXG4gICAgICAgICAgICBpZiAoIVV0aWwuaXNVbmRlZmluZWQobWluQ2hhclR5cGVQYXJhbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBtaW5DaGFyVHlwZU51bWJlciA9IHBhcnNlSW50KG1pbkNoYXJUeXBlUGFyYW1zWzBdLCAxMCkgfHwgMDtcclxuICAgICAgICAgICAgICAgIGNoYXJUeXBlUmVnT2JqZWN0ID0gbWluQ2hhclR5cGVQYXJhbXNbMV0gfHwgY2hhclR5cGVSZWdPYmplY3Q7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOi/lOWbnuWvueixoeWAvFxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbWluQ2hhckxlbjogbWluQ2hhckxlbmd0aCxcclxuICAgICAgICAgICAgICAgIG1pbkNoYXJUeXBlTnVtOiBtaW5DaGFyVHlwZU51bWJlcixcclxuICAgICAgICAgICAgICAgIGNoYXJUeXBlUmVnT2JqOiBjaGFyVHlwZVJlZ09iamVjdFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6K6h566X5a+G56CB562J57qnXHJcbiAgICAgICAgICog5L2O77yaIDB+MjUuNe+8iCDlsI/kuo7nrYnkuo4yNSAuNe+8iVxyXG4gICAgICAgICAqIOS4re+8miAyNS41fjMwKOWkp+S6jjI1IC41IOWwj+S6juetieS6jjMwKVxyXG4gICAgICAgICAqIOmrmO+8miAzMH7vvIjlpKfkuo4zMO+8iVxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSDlr4bnoIHliIbmlbBcclxuICAgICAgICAgKiBAcmV0dXJucyDlr4bnoIHnrYnnuqdcclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBjb3VudExldmVsKHNjb3JlOiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgICAgICBsZXQgbGV2ZWw6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGlmIChzY29yZSA+IDMwKSB7XHJcbiAgICAgICAgICAgICAgICBsZXZlbCA9IDI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcmUgPiAyNS41ICYmIHNjb3JlIDw9IDMwKSB7XHJcbiAgICAgICAgICAgICAgICBsZXZlbCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gMCAmJiBzY29yZSA8PSAyNS41KSB7XHJcbiAgICAgICAgICAgICAgICBsZXZlbCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV2ZWwgPSBsZXZlbEhhbmRsZShtaW5DaGFyTGVuLCBtaW5DaGFyVHlwZU51bSwgbGV2ZWwpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxldmVsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5a+G56CB6ZmN57qn5aSE55CGXHJcbiAgICAgICAgZnVuY3Rpb24gbGV2ZWxIYW5kbGUocHNkTGVuOiBudW1iZXIsIHBzZFR5cGU6IG51bWJlciwgbGV2ZWw6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGU6IG51bWJlciA9IGdldENoYXJUeXBlKHZhbHVlKTtcclxuICAgICAgICAgICAgbGV0IHB3ZExldmVsOiBudW1iZXIgPSBsZXZlbDtcclxuICAgICAgICAgICAgaWYgKGxldmVsID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKChwc2RMZW4gJiYgbGVuIDwgcHNkTGVuKSB8fCAocHNkVHlwZSAmJiB0eXBlIDwgcHNkVHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwd2RMZXZlbCA9IGxldmVsIC0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHB3ZExldmVsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6I635Y+W5b2T5YmN5a+G56CB5a2X56ym56eN57G7XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q2hhclR5cGUoc3RyOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgICAgICAgICBsZXQgdHlwZU51bTogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gY2hhclR5cGVSZWdPYmopIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGFyVHlwZVJlZ09iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVnRXhwOiBSZWdFeHAgPSBjaGFyVHlwZVJlZ09ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWdFeHAudGVzdChzdHIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVOdW0rKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnRXhwLmxhc3RJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHlwZU51bTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19