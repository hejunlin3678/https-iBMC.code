import { Directive, ElementRef, EventEmitter, Input, Output, Renderer2 } from '@angular/core';
import { animate, AnimationBuilder, style } from '@angular/animations';
import { TiBrowser } from '../../utils/Util';
/**
 * TiCollapseDirective指令主要功能为动态控制某一DOM节点的显示(展开)与隐藏(收起)
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)
 * 中引入BrowserAnimationsModule。</span>这是因为此组件中使用了Angular动画，需要引入BrowserAnimationsModule，
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/collapse/collapse-all</example-url>
 */
export class TiCollapseDirective {
    constructor(elementRef, renderer, builder) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.builder = builder;
        /**
         * 控制折叠面板的收起/展开
         */
        this.isCollapse = true; // 是否收起
        /**
         * 折叠面板在收起/展开结束后(即收起/展开动画结束后)的回调；
         * 回调的参数为布尔值，true: 收起结束后, false: 展开结束后
         */
        this.toggleDone = new EventEmitter();
        this.element = this.elementRef.nativeElement;
    }
    ngOnInit() {
        if (!TiBrowser.isIE() || TiBrowser.version() > 9) {
            // 创建展开时动效的实例
            this.expandPlayer = this.builder.build([
                style({ 'max-height': '0px', overflow: 'hidden' }),
                animate(TiCollapseDirective.ANIMATE_IN, style({ 'max-height': '2999px', overflow: 'visible' }))
            ])
                .create(this.element);
            // 创建收起时动效的实例
            this.collapsePlayer = this.builder.build([
                style({ 'max-height': '2999px', overflow: 'visible' }),
                animate(TiCollapseDirective.ANIMATE_OUT, style({ 'max-height': '0px', overflow: 'hidden' }))
            ])
                .create(this.element);
            // 初始没有动画效果
            if (this.isCollapse) {
                this.collapsePlayer.finish();
            }
            else {
                this.expandPlayer.finish();
            }
        }
        if (this.isCollapse) {
            this.collapse();
        }
        else {
            this.expand();
        }
    }
    ngOnChanges(changes) {
        const isCollapseObj = changes['isCollapse'];
        if (!isCollapseObj || isCollapseObj.firstChange) {
            return;
        }
        if (TiBrowser.isIE() && (TiBrowser.version() === 9)) {
            if (isCollapseObj.currentValue) {
                this.collapse();
            }
            else {
                this.expand();
            }
            this.toggleDone.emit(isCollapseObj.currentValue);
            return;
        }
        if (isCollapseObj.currentValue) {
            // 执行收起动画前一定要重置展开动画，否则会影响收起动画
            this.expandPlayer.reset();
            // 执行收起动画
            this.collapsePlayer.play();
            // 收起动画结束后，设置元素display:none
            this.collapsePlayer.onDone(() => {
                // 设置元素display:none必须在收起动画结束后，否则没有动画效果
                this.collapse();
                this.toggleDone.emit(true);
            });
        }
        else {
            // 执行展开动画前一定要重置收起动画，否则会影响展开动画
            this.collapsePlayer.reset();
            // 设置元素display:block
            this.expand();
            // 执行展开动画
            this.expandPlayer.play();
            this.expandPlayer.onDone(() => {
                this.toggleDone.emit(false);
            });
        }
    }
    expand() {
        this.renderer.setStyle(this.element, 'display', 'block');
    }
    collapse() {
        this.renderer.setStyle(this.element, 'display', 'none');
    }
}
TiCollapseDirective.ANIMATE_IN = '600ms cubic-bezier(0.755, 0.05, 0.855, 0.06)'; // easeInQuint
TiCollapseDirective.ANIMATE_OUT = '600ms cubic-bezier(0.23, 1, 0.32, 1)'; // easeOutQuint
TiCollapseDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tiCollapse]'
            },] }
];
TiCollapseDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: AnimationBuilder }
];
TiCollapseDirective.propDecorators = {
    isCollapse: [{ type: Input, args: ['tiCollapse',] }],
    toggleDone: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlDb2xsYXBzZURpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9kaXJlY3RpdmVzL2NvbGxhcHNlL1RpQ29sbGFwc2VEaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEVBQ04sU0FBUyxFQUdaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQW1CLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM3Qzs7Ozs7Ozs7R0FRRztBQUlILE1BQU0sT0FBTyxtQkFBbUI7SUFnQjVCLFlBQW9CLFVBQXNCLEVBQVUsUUFBbUIsRUFDbkQsT0FBeUI7UUFEekIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkQsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFkN0M7O1dBRUc7UUFDa0IsZUFBVSxHQUFZLElBQUksQ0FBQyxDQUFDLE9BQU87UUFDeEQ7OztXQUdHO1FBQ2dCLGVBQVUsR0FBMEIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQU90RSxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO0lBQ2pELENBQUM7SUFFRCxRQUFRO1FBQ0osSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxTQUFTLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQzlDLGFBQWE7WUFDYixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO2dCQUNuQyxLQUFLLENBQUMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxR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LE9BQU8sQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFTyxRQUFRO1FBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUQsQ0FBQzs7QUFqR2MsOEJBQVUsR0FBVyw4Q0FBOEMsQ0FBQyxDQUFDLGNBQWM7QUFDbkYsK0JBQVcsR0FBVyxzQ0FBc0MsQ0FBQyxDQUFDLGVBQWU7O1lBTC9GLFNBQVMsU0FBRTtnQkFDUixRQUFRLEVBQUUsY0FBYzthQUMzQjs7O1lBdkJHLFVBQVU7WUFNVixTQUFTO1lBSUssZ0JBQWdCOzs7eUJBb0I3QixLQUFLLFNBQUMsWUFBWTt5QkFLbEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBEaXJlY3RpdmUsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgSW5wdXQsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBPbkluaXQsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBSZW5kZXJlcjIsXHJcbiAgICBTaW1wbGVDaGFuZ2UsXHJcbiAgICBTaW1wbGVDaGFuZ2VzXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGFuaW1hdGUsIEFuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvblBsYXllciwgc3R5bGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcclxuaW1wb3J0IHsgVGlCcm93c2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbi8qKlxyXG4gKiBUaUNvbGxhcHNlRGlyZWN0aXZl5oyH5Luk5Li76KaB5Yqf6IO95Li65Yqo5oCB5o6n5Yi25p+Q5LiARE9N6IqC54K555qE5pi+56S6KOWxleW8gCnkuI7pmpDol48o5pS26LW3KVxyXG4gKlxyXG4gKiA8cD48c3BhbiBzdHlsZT1cImNvbG9yOiByZWRcIj7kvb/nlKjmraTnu4Tku7bml7bpnIDopoHlvIDlj5HogIXlnKjpobnnm67mqKHlnZco5bu66K6u5Zyo5qC55qih5Z2XKVxyXG4gKiDkuK3lvJXlhaVCcm93c2VyQW5pbWF0aW9uc01vZHVsZeOAgjwvc3Bhbj7ov5nmmK/lm6DkuLrmraTnu4Tku7bkuK3kvb/nlKjkuoZBbmd1bGFy5Yqo55S777yM6ZyA6KaB5byV5YWlQnJvd3NlckFuaW1hdGlvbnNNb2R1bGXvvIxcclxuICog5L2G5pivIEJyb3dzZXJBbmltYXRpb25zTW9kdWxlIOS4jeiDveWcqOaHkuWKoOi9veaooeWdl+iiq+mHjeWkjeW8leWFpe+8jOaJgOS7pemcgOimgeW8gOWPkeiAheadpeW8leWFpUJyb3dzZXJBbmltYXRpb25zTW9kdWxl77yM5L+d6K+B5YW25byV5YWl5LiA5qyh44CCPC9wPlxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueTNkZW1vLyMvY29sbGFwc2UvY29sbGFwc2UtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBEaXJlY3RpdmUgKHtcclxuICAgIHNlbGVjdG9yOiAnW3RpQ29sbGFwc2VdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlDb2xsYXBzZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIHByaXZhdGUgc3RhdGljIEFOSU1BVEVfSU46IHN0cmluZyA9ICc2MDBtcyBjdWJpYy1iZXppZXIoMC43NTUsIDAuMDUsIDAuODU1LCAwLjA2KSc7IC8vIGVhc2VJblF1aW50XHJcbiAgICBwcml2YXRlIHN0YXRpYyBBTklNQVRFX09VVDogc3RyaW5nID0gJzYwMG1zIGN1YmljLWJlemllcigwLjIzLCAxLCAwLjMyLCAxKSc7IC8vIGVhc2VPdXRRdWludFxyXG4gICAgLyoqXHJcbiAgICAgKiDmjqfliLbmipjlj6DpnaLmnb/nmoTmlLbotbcv5bGV5byAXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgndGlDb2xsYXBzZScpIGlzQ29sbGFwc2U6IGJvb2xlYW4gPSB0cnVlOyAvLyDmmK/lkKbmlLbotbdcclxuICAgIC8qKlxyXG4gICAgICog5oqY5Y+g6Z2i5p2/5Zyo5pS26LW3L+WxleW8gOe7k+adn+WQjijljbPmlLbotbcv5bGV5byA5Yqo55S757uT5p2f5ZCOKeeahOWbnuiwg++8m1xyXG4gICAgICog5Zue6LCD55qE5Y+C5pWw5Li65biD5bCU5YC877yMdHJ1ZTog5pS26LW357uT5p2f5ZCOLCBmYWxzZTog5bGV5byA57uT5p2f5ZCOXHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSB0b2dnbGVEb25lOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBleHBhbmRQbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcclxuICAgIHByaXZhdGUgY29sbGFwc2VQbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlcikge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICghVGlCcm93c2VyLmlzSUUoKSB8fCBUaUJyb3dzZXIudmVyc2lvbigpID4gOSkge1xyXG4gICAgICAgICAgICAvLyDliJvlu7rlsZXlvIDml7bliqjmlYjnmoTlrp7kvotcclxuICAgICAgICAgICAgdGhpcy5leHBhbmRQbGF5ZXIgPSB0aGlzLmJ1aWxkZXIuYnVpbGQoW1xyXG4gICAgICAgICAgICAgICAgc3R5bGUoeyAnbWF4LWhlaWdodCc6ICcwcHgnLCBvdmVyZmxvdzogJ2hpZGRlbicgfSksXHJcbiAgICAgICAgICAgICAgICBhbmltYXRlKFRpQ29sbGFwc2VEaXJlY3RpdmUuQU5JTUFURV9JTiwgc3R5bGUoeyAnbWF4LWhlaWdodCc6ICcyOTk5cHgnLCBvdmVyZmxvdzogJ3Zpc2libGUnIH0pKV0pXHJcbiAgICAgICAgICAgICAgICAuY3JlYXRlKHRoaXMuZWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICAvLyDliJvlu7rmlLbotbfml7bliqjmlYjnmoTlrp7kvotcclxuICAgICAgICAgICAgdGhpcy5jb2xsYXBzZVBsYXllciA9IHRoaXMuYnVpbGRlci5idWlsZChbXHJcbiAgICAgICAgICAgICAgICBzdHlsZSh7ICdtYXgtaGVpZ2h0JzogJzI5OTlweCcsIG92ZXJmbG93OiAndmlzaWJsZScgfSksXHJcbiAgICAgICAgICAgICAgICBhbmltYXRlKFRpQ29sbGFwc2VEaXJlY3RpdmUuQU5JTUFURV9PVVQsIHN0eWxlKHsgJ21heC1oZWlnaHQnOiAnMHB4Jywgb3ZlcmZsb3c6ICdoaWRkZW4nIH0pKV0pXHJcbiAgICAgICAgICAgICAgICAuY3JlYXRlKHRoaXMuZWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICAvLyDliJ3lp4vmsqHmnInliqjnlLvmlYjmnpxcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNDb2xsYXBzZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsYXBzZVBsYXllci5maW5pc2goKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kUGxheWVyLmZpbmlzaCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc0NvbGxhcHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGFwc2UoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmV4cGFuZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgaXNDb2xsYXBzZU9iajogU2ltcGxlQ2hhbmdlID0gY2hhbmdlc1snaXNDb2xsYXBzZSddO1xyXG5cclxuICAgICAgICBpZiAoIWlzQ29sbGFwc2VPYmogfHwgaXNDb2xsYXBzZU9iai5maXJzdENoYW5nZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoVGlCcm93c2VyLmlzSUUoKSAmJiAoVGlCcm93c2VyLnZlcnNpb24oKSA9PT0gOSkpIHtcclxuICAgICAgICAgICAgaWYgKGlzQ29sbGFwc2VPYmouY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgIHRoaXMuY29sbGFwc2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy50b2dnbGVEb25lLmVtaXQoaXNDb2xsYXBzZU9iai5jdXJyZW50VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlzQ29sbGFwc2VPYmouY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vIOaJp+ihjOaUtui1t+WKqOeUu+WJjeS4gOWumuimgemHjee9ruWxleW8gOWKqOeUu++8jOWQpuWImeS8muW9seWTjeaUtui1t+WKqOeUu1xyXG4gICAgICAgICAgICB0aGlzLmV4cGFuZFBsYXllci5yZXNldCgpO1xyXG4gICAgICAgICAgICAvLyDmiafooYzmlLbotbfliqjnlLtcclxuICAgICAgICAgICAgdGhpcy5jb2xsYXBzZVBsYXllci5wbGF5KCk7XHJcbiAgICAgICAgICAgIC8vIOaUtui1t+WKqOeUu+e7k+adn+WQju+8jOiuvue9ruWFg+e0oGRpc3BsYXk6bm9uZVxyXG4gICAgICAgICAgICB0aGlzLmNvbGxhcHNlUGxheWVyLm9uRG9uZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDorr7nva7lhYPntKBkaXNwbGF5Om5vbmXlv4XpobvlnKjmlLbotbfliqjnlLvnu5PmnZ/lkI7vvIzlkKbliJnmsqHmnInliqjnlLvmlYjmnpxcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sbGFwc2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlRG9uZS5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDmiafooYzlsZXlvIDliqjnlLvliY3kuIDlrpropoHph43nva7mlLbotbfliqjnlLvvvIzlkKbliJnkvJrlvbHlk43lsZXlvIDliqjnlLtcclxuICAgICAgICAgICAgIHRoaXMuY29sbGFwc2VQbGF5ZXIucmVzZXQoKTtcclxuICAgICAgICAgICAgIC8vIOiuvue9ruWFg+e0oGRpc3BsYXk6YmxvY2tcclxuICAgICAgICAgICAgIHRoaXMuZXhwYW5kKCk7XHJcbiAgICAgICAgICAgICAvLyDmiafooYzlsZXlvIDliqjnlLtcclxuICAgICAgICAgICAgIHRoaXMuZXhwYW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgICAgICAgIHRoaXMuZXhwYW5kUGxheWVyLm9uRG9uZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVEb25lLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZXhwYW5kKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29sbGFwc2UoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICdkaXNwbGF5JywgJ25vbmUnKTtcclxuICAgIH1cclxufVxyXG4iXX0=