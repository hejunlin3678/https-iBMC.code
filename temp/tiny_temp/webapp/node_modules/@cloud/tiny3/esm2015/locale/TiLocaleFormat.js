/**
 * @ignore
 *
 * 只供内部使用，外部使用tinyplus3提供的国际化方法
 *
 * 该类提供一个方法集，用于数字、时间日期的国际化处理
 * 其中 tiny提供的数字、时间日期和货币的国际化处理方法，用于屏蔽angular方法需要传入format/localeId的复杂处理
 *
 * <h3>示例</h3>
 * <iframe src="../tiny3demo/#/locale/locale-format" frameborder='0' width="100%" onload="this.height = document.documentElement.clientHeight"></iframe>
 */
import { formatDate, getLocaleId } from '@angular/common';
import { TiLocale } from './TiLocale';
export class TiLocaleFormat {
    /**
     * 获取语种关键字，默认为'en'
     * @return 语种关键字
     */
    static getLocaleKey() {
        let locale = TiLocale.getLocaleWords().tiLocaleKey;
        try { // local信息未注册情况下，getLocaleId该方法会报错，因此使用try catch的方式
            getLocaleId(TiLocale.getLocaleWords().tiLocaleKey);
        }
        catch (error) {
            locale = TiLocaleFormat.DEFAULT_LOCALE;
        }
        return locale;
    }
    /**
     * @description 对国际化数字进行处理(包含小数点)
     * @param: number 国际化数字
     * @param: isIntegerValid 只针对integer的情况
     * @return 返回数字信息
     */
    static parseNumWithDecimal(number, isIntegerValid) {
        const groupSep = TiLocaleFormat.getNumberSymbol('Group');
        const decimalSep = TiLocaleFormat.getNumberSymbol('Decimal');
        /* tslint:disable:prefer-template */
        const numberReg = new RegExp('^(?:-?\\d*|-?\\d(?:\\' + groupSep + '?\\d*)+)?(?:\\' + decimalSep + '\\d*)?$');
        // const numberFormat = number.toString();
        const numberFormat = number;
        if (!numberReg.test(numberFormat)) {
            return NaN;
        }
        const groupReg = new RegExp('\\' + groupSep, 'g');
        const decimalReg = new RegExp('\\' + decimalSep, 'g');
        const numberFormatString = numberFormat.replace(groupReg, '')
            .replace(decimalReg, '.');
        const numberFloat = parseFloat(numberFormatString);
        /*
        * *只针对integer的情况
        * 截取转换前的小数位字符串numFormatSlice
        * 转换前的小数位字符串长度numFormatCount
        * 转换后的小数位为0,就添加小数位个数的0，返回值是string类型
        * */
        if (isIntegerValid && (numberFormatString.indexOf('.') !== -1)) {
            return numberFormatString;
        }
        return numberFloat;
    }
    /**
     * 获取数字规则信息
     * key 规则关键字
     */
    static getNumberSymbol(key) {
        const standardNumber = 10000.0;
        const localeNumber = TiLocaleFormat.formatNumber(standardNumber, '1.1-1');
        return key === 'Group' ? localeNumber.charAt(2) : localeNumber.charAt(6);
    }
    /**
     * @description 对数字进行国际化处理
     * @param: number 数字
     * @param: numberFormat 数字格式化形式
     * @return 返回格式化后的信息
     */
    static formatNumber(number, format) {
        let options;
        if (format) {
            options = {
                minimumIntegerDigits: format.substring(0, format.indexOf('.')),
                minimumFractionDigits: format.substring(format.indexOf('.') + 1, format.indexOf('-')),
                maximumFractionDigits: format.substring(format.indexOf('-') + 1)
            };
        }
        // TODO: new Intl.NumberFormat es西语下整数部分有四位时，本地化数字没有千位分隔
        const res = new Intl.NumberFormat(TiLocale.getLocaleWords().tiLocaleKey, options)
            .format(number);
        return res;
    }
    /**
     * @description 对国际化数字进行标准化处理
     * @param: number 国际化数字
     * @return 返回数字信息
     */
    static parseNumber(number) {
        return parseFloat(TiLocaleFormat.parseNumWithDecimal(number));
    }
    /**
     * @description 对时间进行国际化处理
     * @param: time 时间
     * @param: format 时间格式
     * @return 返回格式化后的信息
     */
    static formatTime(time, format, timezone) {
        return formatDate(time, format || TiLocaleFormat.TIME_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * @description 对日期进行国际化处理
     * @param date 日期
     * @param format 日期格式
     * @return 返回格式化后的信息
     */
    static formatDate(date, format, timezone) {
        return formatDate(date, format || TiLocaleFormat.DATE_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * @description 对时间日期进行国际化处理
     * @param: 时间日期
     * @param: 时间日期格式
     * @return 返回格式化后的信息
     */
    static formatDateTime(dateTime, format, timezone) {
        return formatDate(dateTime, format || TiLocaleFormat.DATETIME_FORMAT, TiLocaleFormat.getLocaleKey(), timezone);
    }
    /**
     * 功能描述：去除千位分隔符，得到标准化数字
     * value: 带有千位分隔符的数据
     */
    static deleteGroupSep(value) {
        let res;
        res = String(value);
        const groupSep = TiLocaleFormat.getNumberSymbol('Group');
        const groupSepReg = new RegExp('\\' + groupSep, 'g');
        return res.replace(groupSepReg, '');
    }
    /**
     * 检测format接口配置是否合法。目前spinner和inputnumber组件会用到
     */
    static isInvalidFormat(format) {
        if (typeof (format) !== 'string'
            || format.charAt(0)
                .toUpperCase() !== 'N'
            || Number.isNaN(parseInt(format.slice(1), 10))) {
            return true;
        }
        return false;
    }
}
TiLocaleFormat.TIME_FORMAT = 'mediumTime'; // 'h:mm:ss a' (e.g. 9:03:01 AM)
TiLocaleFormat.DATE_FORMAT = 'mediumDate'; // 'MMM d, y' (e.g. Jun 15, 2015).
TiLocaleFormat.DATETIME_FORMAT = 'medium'; // 'MMM d, y, h:mm:ss a' (e.g. Jun 15, 2015, 9:03:01 AM)
TiLocaleFormat.DEFAULT_LOCALE = 'en';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlMb2NhbGVGb3JtYXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvbG9jYWxlL1RpTG9jYWxlRm9ybWF0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7O0dBVUc7QUFDSCxPQUFPLEVBQUUsVUFBVSxFQUNmLFdBQVcsRUFBdUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM5RSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RDLE1BQU0sT0FBTyxjQUFjO0lBS3ZCOzs7T0FHRztJQUNLLE1BQU0sQ0FBQyxZQUFZO1FBQ3ZCLElBQUksTUFBTSxHQUFXLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxXQUFXLENBQUM7UUFDM0QsSUFBSSxFQUFDLG1EQUFtRDtZQUNwRCxXQUFXLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3REO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDWixNQUFNLEdBQUcsY0FBYyxDQUFDLGNBQWMsQ0FBQztTQUMxQztRQUVELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFDRDs7Ozs7T0FLRztJQUNLLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxNQUFjLEVBQUUsY0FBd0I7UUFDdkUsTUFBTSxRQUFRLEdBQVcsY0FBYyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNqRSxNQUFNLFVBQVUsR0FBVyxjQUFjLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JFLG9DQUFvQztRQUNwQyxNQUFNLFNBQVMsR0FDWCxJQUFJLE1BQU0sQ0FBQyx1QkFBdUIsR0FBRyxRQUFRLEdBQUcsZ0JBQWdCLEdBQUcsVUFBVSxHQUFHLFNBQVMsQ0FBQyxDQUFDO1FBQy9GLDBDQUEwQztRQUMxQyxNQUFNLFlBQVksR0FBVyxNQUFNLENBQUM7UUFFcEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENB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O0FBQzVGLDZCQUFjLEdBQVcsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBpZ25vcmVcclxuICpcclxuICog5Y+q5L6b5YaF6YOo5L2/55So77yM5aSW6YOo5L2/55SodGlueXBsdXMz5o+Q5L6b55qE5Zu96ZmF5YyW5pa55rOVXHJcbiAqXHJcbiAqIOivpeexu+aPkOS+m+S4gOS4quaWueazlembhu+8jOeUqOS6juaVsOWtl+OAgeaXtumXtOaXpeacn+eahOWbvemZheWMluWkhOeQhlxyXG4gKiDlhbbkuK0gdGlueeaPkOS+m+eahOaVsOWtl+OAgeaXtumXtOaXpeacn+WSjOi0p+W4geeahOWbvemZheWMluWkhOeQhuaWueazle+8jOeUqOS6juWxj+iUvWFuZ3VsYXLmlrnms5XpnIDopoHkvKDlhaVmb3JtYXQvbG9jYWxlSWTnmoTlpI3mnYLlpITnkIZcclxuICpcclxuICogPGgzPuekuuS+izwvaDM+XHJcbiAqIDxpZnJhbWUgc3JjPVwiLi4vdGlueTNkZW1vLyMvbG9jYWxlL2xvY2FsZS1mb3JtYXRcIiBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9XCIxMDAlXCIgb25sb2FkPVwidGhpcy5oZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XCI+PC9pZnJhbWU+XHJcbiAqL1xyXG5pbXBvcnQgeyBmb3JtYXREYXRlLCBmb3JtYXROdW1iZXIsIGdldExvY2FsZUN1cnJlbmN5U3ltYm9sLFxyXG4gICAgZ2V0TG9jYWxlSWQsIGdldExvY2FsZU51bWJlclN5bWJvbCwgTnVtYmVyU3ltYm9sIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgVGlMb2NhbGUgfSBmcm9tICcuL1RpTG9jYWxlJztcclxuZXhwb3J0IGNsYXNzIFRpTG9jYWxlRm9ybWF0IHtcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFRJTUVfRk9STUFUOiBzdHJpbmcgPSAnbWVkaXVtVGltZSc7IC8vICdoOm1tOnNzIGEnIChlLmcuIDk6MDM6MDEgQU0pXHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBEQVRFX0ZPUk1BVDogc3RyaW5nID0gJ21lZGl1bURhdGUnOyAvLyAnTU1NIGQsIHknIChlLmcuIEp1biAxNSwgMjAxNSkuXHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBEQVRFVElNRV9GT1JNQVQ6IHN0cmluZyA9ICdtZWRpdW0nOyAvLyAnTU1NIGQsIHksIGg6bW06c3MgYScgKGUuZy4gSnVuIDE1LCAyMDE1LCA5OjAzOjAxIEFNKVxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9MT0NBTEU6IHN0cmluZyA9ICdlbic7XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluivreenjeWFs+mUruWtl++8jOm7mOiupOS4uidlbidcclxuICAgICAqIEByZXR1cm4g6K+t56eN5YWz6ZSu5a2XXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGdldExvY2FsZUtleSgpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBsb2NhbGU6IHN0cmluZyA9IFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudGlMb2NhbGVLZXk7XHJcbiAgICAgICAgdHJ5IHsvLyBsb2NhbOS/oeaBr+acquazqOWGjOaDheWGteS4i++8jGdldExvY2FsZUlk6K+l5pa55rOV5Lya5oql6ZSZ77yM5Zug5q2k5L2/55SodHJ5IGNhdGNo55qE5pa55byPXHJcbiAgICAgICAgICAgIGdldExvY2FsZUlkKFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudGlMb2NhbGVLZXkpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGxvY2FsZSA9IFRpTG9jYWxlRm9ybWF0LkRFRkFVTFRfTE9DQUxFO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGxvY2FsZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWvueWbvemZheWMluaVsOWtl+i/m+ihjOWkhOeQhijljIXlkKvlsI/mlbDngrkpXHJcbiAgICAgKiBAcGFyYW06IG51bWJlciDlm73pmYXljJbmlbDlrZdcclxuICAgICAqIEBwYXJhbTogaXNJbnRlZ2VyVmFsaWQg5Y+q6ZKI5a+5aW50ZWdlcueahOaDheWGtVxyXG4gICAgICogQHJldHVybiDov5Tlm57mlbDlrZfkv6Hmga9cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcGFyc2VOdW1XaXRoRGVjaW1hbChudW1iZXI6IHN0cmluZywgaXNJbnRlZ2VyVmFsaWQ/OiBib29sZWFuKTogYW55IHtcclxuICAgICAgICBjb25zdCBncm91cFNlcDogc3RyaW5nID0gVGlMb2NhbGVGb3JtYXQuZ2V0TnVtYmVyU3ltYm9sKCdHcm91cCcpO1xyXG4gICAgICAgIGNvbnN0IGRlY2ltYWxTZXA6IHN0cmluZyA9IFRpTG9jYWxlRm9ybWF0LmdldE51bWJlclN5bWJvbCgnRGVjaW1hbCcpO1xyXG4gICAgICAgIC8qIHRzbGludDpkaXNhYmxlOnByZWZlci10ZW1wbGF0ZSAqL1xyXG4gICAgICAgIGNvbnN0IG51bWJlclJlZzogUmVnRXhwID1cclxuICAgICAgICAgICAgbmV3IFJlZ0V4cCgnXig/Oi0/XFxcXGQqfC0/XFxcXGQoPzpcXFxcJyArIGdyb3VwU2VwICsgJz9cXFxcZCopKyk/KD86XFxcXCcgKyBkZWNpbWFsU2VwICsgJ1xcXFxkKik/JCcpO1xyXG4gICAgICAgIC8vIGNvbnN0IG51bWJlckZvcm1hdCA9IG51bWJlci50b1N0cmluZygpO1xyXG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdDogc3RyaW5nID0gbnVtYmVyO1xyXG5cclxuICAgICAgICBpZiAoIW51bWJlclJlZy50ZXN0KG51bWJlckZvcm1hdCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE5hTjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZ3JvdXBSZWc6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1xcXFwnICsgZ3JvdXBTZXAsICdnJyk7XHJcbiAgICAgICAgY29uc3QgZGVjaW1hbFJlZzogUmVnRXhwID0gbmV3IFJlZ0V4cCgnXFxcXCcgKyBkZWNpbWFsU2VwLCAnZycpO1xyXG4gICAgICAgIGNvbnN0IG51bWJlckZvcm1hdFN0cmluZzogc3RyaW5nID0gbnVtYmVyRm9ybWF0LnJlcGxhY2UoZ3JvdXBSZWcsICcnKVxyXG4gICAgICAgICAgICAucmVwbGFjZShkZWNpbWFsUmVnLCAnLicpO1xyXG4gICAgICAgIGNvbnN0IG51bWJlckZsb2F0OiBudW1iZXIgPSBwYXJzZUZsb2F0KG51bWJlckZvcm1hdFN0cmluZyk7XHJcbiAgICAgICAgLypcclxuICAgICAgICAqICrlj6rpkojlr7lpbnRlZ2Vy55qE5oOF5Ya1XHJcbiAgICAgICAgKiDmiKrlj5bovazmjaLliY3nmoTlsI/mlbDkvY3lrZfnrKbkuLJudW1Gb3JtYXRTbGljZVxyXG4gICAgICAgICog6L2s5o2i5YmN55qE5bCP5pWw5L2N5a2X56ym5Liy6ZW/5bqmbnVtRm9ybWF0Q291bnRcclxuICAgICAgICAqIOi9rOaNouWQjueahOWwj+aVsOS9jeS4ujAs5bCx5re75Yqg5bCP5pWw5L2N5Liq5pWw55qEMO+8jOi/lOWbnuWAvOaYr3N0cmluZ+exu+Wei1xyXG4gICAgICAgICogKi9cclxuXHJcbiAgICAgICAgaWYgKGlzSW50ZWdlclZhbGlkICYmIChudW1iZXJGb3JtYXRTdHJpbmcuaW5kZXhPZignLicpICE9PSAtMSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlckZvcm1hdFN0cmluZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudW1iZXJGbG9hdDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5pWw5a2X6KeE5YiZ5L+h5oGvXHJcbiAgICAgKiBrZXkg6KeE5YiZ5YWz6ZSu5a2XXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TnVtYmVyU3ltYm9sKGtleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBzdGFuZGFyZE51bWJlcjogbnVtYmVyID0gMTAwMDAuMDtcclxuICAgICAgICBjb25zdCBsb2NhbGVOdW1iZXI6IHN0cmluZyA9IFRpTG9jYWxlRm9ybWF0LmZvcm1hdE51bWJlcihzdGFuZGFyZE51bWJlciwgJzEuMS0xJyk7XHJcblxyXG4gICAgICAgIHJldHVybiBrZXkgPT09ICdHcm91cCcgPyBsb2NhbGVOdW1iZXIuY2hhckF0KDIpIDogbG9jYWxlTnVtYmVyLmNoYXJBdCg2KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWvueaVsOWtl+i/m+ihjOWbvemZheWMluWkhOeQhlxyXG4gICAgICogQHBhcmFtOiBudW1iZXIg5pWw5a2XXHJcbiAgICAgKiBAcGFyYW06IG51bWJlckZvcm1hdCDmlbDlrZfmoLzlvI/ljJblvaLlvI9cclxuICAgICAqIEByZXR1cm4g6L+U5Zue5qC85byP5YyW5ZCO55qE5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZm9ybWF0TnVtYmVyKG51bWJlcjogbnVtYmVyLCBmb3JtYXQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IG9wdGlvbnM6IGFueTtcclxuICAgICAgICBpZiAoZm9ybWF0KSB7XHJcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBtaW5pbXVtSW50ZWdlckRpZ2l0czogZm9ybWF0LnN1YnN0cmluZygwLCBmb3JtYXQuaW5kZXhPZignLicpKSxcclxuICAgICAgICAgICAgICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogZm9ybWF0LnN1YnN0cmluZyhmb3JtYXQuaW5kZXhPZignLicpICsgMSwgZm9ybWF0LmluZGV4T2YoJy0nKSksXHJcbiAgICAgICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IGZvcm1hdC5zdWJzdHJpbmcoZm9ybWF0LmluZGV4T2YoJy0nKSArIDEpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUT0RPOiBuZXcgSW50bC5OdW1iZXJGb3JtYXQgZXPopb/or63kuIvmlbTmlbDpg6jliIbmnInlm5vkvY3ml7bvvIzmnKzlnLDljJbmlbDlrZfmsqHmnInljYPkvY3liIbpmpRcclxuICAgICAgICBjb25zdCByZXM6IHN0cmluZyA9IG5ldyBJbnRsLk51bWJlckZvcm1hdChUaUxvY2FsZS5nZXRMb2NhbGVXb3JkcygpLnRpTG9jYWxlS2V5LCBvcHRpb25zKVxyXG4gICAgICAgICAgICAuZm9ybWF0KG51bWJlcik7XHJcblxyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5a+55Zu96ZmF5YyW5pWw5a2X6L+b6KGM5qCH5YeG5YyW5aSE55CGXHJcbiAgICAgKiBAcGFyYW06IG51bWJlciDlm73pmYXljJbmlbDlrZdcclxuICAgICAqIEByZXR1cm4g6L+U5Zue5pWw5a2X5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgcGFyc2VOdW1iZXIobnVtYmVyOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KFRpTG9jYWxlRm9ybWF0LnBhcnNlTnVtV2l0aERlY2ltYWwobnVtYmVyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5a+55pe26Ze06L+b6KGM5Zu96ZmF5YyW5aSE55CGXHJcbiAgICAgKiBAcGFyYW06IHRpbWUg5pe26Ze0XHJcbiAgICAgKiBAcGFyYW06IGZvcm1hdCDml7bpl7TmoLzlvI9cclxuICAgICAqIEByZXR1cm4g6L+U5Zue5qC85byP5YyW5ZCO55qE5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZm9ybWF0VGltZSh0aW1lOiBzdHJpbmcgfCBudW1iZXIgfCBEYXRlLCBmb3JtYXQ/OiBzdHJpbmcsIHRpbWV6b25lPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gZm9ybWF0RGF0ZSh0aW1lLCBmb3JtYXQgfHwgVGlMb2NhbGVGb3JtYXQuVElNRV9GT1JNQVQsIFRpTG9jYWxlRm9ybWF0LmdldExvY2FsZUtleSgpLCB0aW1lem9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5a+55pel5pyf6L+b6KGM5Zu96ZmF5YyW5aSE55CGXHJcbiAgICAgKiBAcGFyYW0gZGF0ZSDml6XmnJ9cclxuICAgICAqIEBwYXJhbSBmb3JtYXQg5pel5pyf5qC85byPXHJcbiAgICAgKiBAcmV0dXJuIOi/lOWbnuagvOW8j+WMluWQjueahOS/oeaBr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdERhdGUoZGF0ZTogRGF0ZSwgZm9ybWF0Pzogc3RyaW5nLCB0aW1lem9uZT86IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1hdERhdGUoZGF0ZSwgZm9ybWF0IHx8IFRpTG9jYWxlRm9ybWF0LkRBVEVfRk9STUFULCBUaUxvY2FsZUZvcm1hdC5nZXRMb2NhbGVLZXkoKSwgdGltZXpvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWvueaXtumXtOaXpeacn+i/m+ihjOWbvemZheWMluWkhOeQhlxyXG4gICAgICogQHBhcmFtOiDml7bpl7Tml6XmnJ9cclxuICAgICAqIEBwYXJhbTog5pe26Ze05pel5pyf5qC85byPXHJcbiAgICAgKiBAcmV0dXJuIOi/lOWbnuagvOW8j+WMluWQjueahOS/oeaBr1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdERhdGVUaW1lKGRhdGVUaW1lOiBEYXRlLCBmb3JtYXQ/OiBzdHJpbmcsIHRpbWV6b25lPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gZm9ybWF0RGF0ZShkYXRlVGltZSwgZm9ybWF0IHx8IFRpTG9jYWxlRm9ybWF0LkRBVEVUSU1FX0ZPUk1BVCwgVGlMb2NhbGVGb3JtYXQuZ2V0TG9jYWxlS2V5KCksIHRpbWV6b25lKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWKn+iDveaPj+i/sO+8muWOu+mZpOWNg+S9jeWIhumalOespu+8jOW+l+WIsOagh+WHhuWMluaVsOWtl1xyXG4gICAgICogdmFsdWU6IOW4puacieWNg+S9jeWIhumalOespueahOaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGRlbGV0ZUdyb3VwU2VwKHZhbHVlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCByZXM6IGFueTtcclxuICAgICAgICByZXMgPSBTdHJpbmcodmFsdWUpO1xyXG4gICAgICAgIGNvbnN0IGdyb3VwU2VwOiBzdHJpbmcgPSBUaUxvY2FsZUZvcm1hdC5nZXROdW1iZXJTeW1ib2woJ0dyb3VwJyk7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBTZXBSZWc6IGFueSA9IG5ldyBSZWdFeHAoJ1xcXFwnICsgZ3JvdXBTZXAsICdnJyk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMucmVwbGFjZShncm91cFNlcFJlZywgJycpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmo4DmtYtmb3JtYXTmjqXlj6PphY3nva7mmK/lkKblkIjms5XjgILnm67liY1zcGlubmVy5ZKMaW5wdXRudW1iZXLnu4Tku7bkvJrnlKjliLBcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBpc0ludmFsaWRGb3JtYXQoZm9ybWF0OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodHlwZW9mIChmb3JtYXQpICE9PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICB8fCBmb3JtYXQuY2hhckF0KDApXHJcbiAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpICE9PSAnTidcclxuICAgICAgICAgICAgfHwgTnVtYmVyLmlzTmFOKHBhcnNlSW50KGZvcm1hdC5zbGljZSgxKSwgMTApKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxyXG4iXX0=