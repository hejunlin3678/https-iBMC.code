import { Component, ElementRef, HostListener, Renderer2, ViewChild, ViewEncapsulation, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { TiKeymap, Util } from '../../utils/Util';
import { TiRenderer } from '../renderer/TiRenderer';
import { TiBaseComponent } from '../../components/base/TiBaseModule';
/**
 * @ignore
 */
export const animateStyle = '0.3s cubic-bezier(0.40, 0.00, 0.20, 1.00)';
/**
 * @ignore
 */
export class TiModalComponent extends TiBaseComponent {
    constructor(ele, tiRenderer, renderer, document) {
        super(ele, renderer);
        this.tiRenderer = tiRenderer;
        this.renderer = renderer;
        this.document = document;
        this.index = 0; // 多个弹出框情况下，zindex层级设置辅助
        this.focusableElements = []; // 弹框中可聚焦元素列表
    }
    set showState(value) {
        this._showState = value;
    }
    get showState() {
        return this._showState;
    }
    static preventEvent(event) {
        event.preventDefault();
        event.stopPropagation();
    }
    // 路由切换后，modal还会存在，因此此处做了事件处理
    onhashchange() {
        this.modalInstance._remove();
    }
    // 缩放时重置弹框位置
    onResize() {
        this.tiRenderer.setStyles(this.contentRef.nativeElement, {
            left: 0,
            top: 0
        });
    }
    // 键盘事件处理
    onKeydown(event) {
        switch (event.which) {
            case TiKeymap.KEY_ESCAPE: // close on ESC
                if (this.closeOnEsc) {
                    this.dismissModal();
                }
                break;
            case TiKeymap.KEY_TAB: // tab键用于处理在弹框内循环获取焦点
                this.onTabChange(event);
                break;
            default:
                break;
        }
    }
    // 弹窗外围出现的滚动条滚动会导致下拉等定位在body上的组件相对于宿主元素定位偏移，
    // 因此触发tiScroll事件做处理，事件包括：
    // 整个页面滚动条滚轮滚动事件, mousewheel处理Chrome和IE下事件，DOMMouseScroll处理firefox下事件
    // 整个页面滚动条鼠标滚动事件
    onTiScroll() {
        Util.trigger(document, 'tiScroll');
    }
    ngAfterContentInit() {
        this.dragOptions = {
            // 这时弹窗内容DOM还未解析，所以需要使用标签选择器('ti-modal-header')来获取元素
            handle: this.nativeElement.querySelector('ti-modal-header'),
            drag: (opts) => {
                Util.trigger(document, 'tiScroll');
                // 当前浏览器可视区域的宽高
                const curBrowseWidth = document.documentElement.clientWidth;
                const curBrowseheight = document.documentElement.clientHeight;
                // 元素原始位置（由于元素本身left和top实时变化，因此取其父元素位置）
                const eleRect = opts.helper.parentElement.getBoundingClientRect();
                // 元素距页面可视区域的可用位置范围
                const minLeft = -eleRect.left + document.body.scrollLeft;
                const maxLeft = Math.max(curBrowseWidth + minLeft - eleRect.width, minLeft);
                const minTop = -eleRect.top + document.body.scrollTop;
                const maxTop = Math.max(curBrowseheight + minTop - eleRect.height, minTop);
                const position = opts.position;
                // 元素left位置根据可用left范围计算
                if (position.left < minLeft) {
                    position.left = minLeft;
                }
                else if (position.left > maxLeft) {
                    position.left = maxLeft;
                }
                // 元素top位置根据可用top范围计算
                if (position.top < minTop) {
                    position.top = minTop;
                }
                else if (position.top > maxTop) {
                    position.top = maxTop;
                }
                return position;
            }
        };
    }
    dismissModal() {
        this.modalInstance.dismiss();
    }
    onAnimationDone($event) {
        // 弹框toState有三种状态:'show'/'hide'/null
        // 弹框显示动画结束后,重新将焦点聚焦在弹框元素/弹框中
        if ($event.toState === 'show') {
            this.reStyleModal();
            this.focusInModal();
            return;
        }
        // 弹框隐藏动画结束后,销毁弹框DOM
        if ($event.toState === 'hide') {
            this.modalInstance._remove();
        }
    }
    // 弹框打开时，设置弹框元素样式
    reStyleModal() {
        const parentEle = this.nativeElement.querySelector('.ti3-modal-header');
        if (this.draggable !== false) {
            this.renderer.setStyle(parentEle, 'cursor', 'move');
        }
        if (this.headerAlign === 'center' || this.headerAlign === 'right') {
            this.renderer.setStyle(parentEle, 'text-align', this.headerAlign);
        }
        this.renderer.addClass(this.document.body, 'ti3-modal-open');
        this.setMaxHeight();
    }
    /**
     * 设置弹框高度：
     * 根据UCD3.0规范，modal最大高度不能超过弹框宽度,所以需要获取到modal的宽度值，用其减去modal的header和footer的高度
     * 后设为body的最大高度，当高度超出时，ti-modal-body垂直方向上出现滚动条
     * 10.1.1变更说明：
     * 根据规范变更，弹框高度可以超过弹框宽度，同时弹窗的最大高度是660px。
     */
    setMaxHeight() {
        // 修复SSR问题：ERROR TypeError: modalHeaderEle.getBoundingClientRect is not a function
        const modalHeaderEle = this.nativeElement.querySelector('.ti3-modal-header');
        const modalHeaderHeight = modalHeaderEle && (typeof modalHeaderEle.getBoundingClientRect === 'function') ? modalHeaderEle.getBoundingClientRect().height : 0;
        const modalFooterEle = this.nativeElement.querySelector('.ti3-modal-footer');
        const modalFooterHeight = modalFooterEle && (typeof modalFooterEle.getBoundingClientRect === 'function') ? modalFooterEle.getBoundingClientRect().height : 0;
        const modalBodyMaxHeight = TiModalComponent.MODAL_MAX_HEIGHT - modalHeaderHeight - modalFooterHeight;
        this.renderer.setStyle(this.nativeElement.querySelector('.ti3-modal-body'), 'maxHeight', modalBodyMaxHeight + 'px');
    }
    focusInModal() {
        /**
         * 首先判断新打开的modal是否已存在获取焦点的元素
         * 如果存在，则需要对modal元素再次设置焦点
         * 否则，对modal容器设置焦点
         */
        const activeElement = this.document.activeElement;
        const isfocusedInModal = activeElement && this.nativeElement.contains(activeElement);
        if (isfocusedInModal) {
            /**
             * 对已经设置焦点的元素，再次设置焦点，是为了解决以下两个问题：
             * 1>首次加载时，已经获取焦点的元素，其输入tip提示位置偏移
             * 2>首次加载时，IE浏览器中，已经获取焦点的元素input，光标位置出现偏移
             */
            if (activeElement) {
                activeElement.blur();
                // tiautofocusinmodal属性需要在change校验中使用(ChangeCheck.ts)
                this.renderer.setAttribute(activeElement, 'tiautofocusinmodal', '');
                activeElement.focus();
                this.renderer.removeAttribute(activeElement, 'tiautofocusinmodal');
            }
        }
        else {
            // 弹窗内未找到已聚焦元素情况下，优先处理 input 和 textarea 原生标签autofocus聚焦
            // (input,textarea.button原生标签的autofocus弹窗打开时无效(chrome是从第二次打开无效)，因此要做此处理)
            let focusEle = this.nativeElement.querySelector(`input[autofocus]:not([disabled]):not([tabindex=\'-1\']),
                textarea[autofocus]:not([disabled]):not([tabindex=\'-1\']), button[autofocus]:not([disabled]):not([tabindex=\'-1\'])`);
            // 如果通过上述处理，聚焦元素仍未获取到的情况下，则可聚焦元素为当前弹框
            focusEle = focusEle || this.modalEleRef.nativeElement;
            focusEle.focus();
        }
    }
    // 用于处理tab键行为，确保tab时只可在弹框内循环获取焦点
    onTabChange(event) {
        const focusableElementList = this.getFocusableElesInModal(); // 获取当前弹出框DOM中可以获取焦点的元素列表
        const focusableListLength = focusableElementList.length;
        if (focusableListLength === 0) {
            return;
        }
        const target = event.target; // 事件对象元素
        const firstFocusableEle = focusableElementList[0]; // 第一个可获取焦点的元素
        const lastFocusableEle = focusableElementList[focusableListLength - 1]; // 最后一个可获取焦点的元素
        // 按下tab+shift键时，如果当前已获取焦点元素是弹出框中的第一个可获取焦点元素或弹框本身，则聚焦最后一个元素
        if (event.shiftKey) {
            if (target === firstFocusableEle || target === this.modalEleRef.nativeElement) {
                lastFocusableEle.focus();
                TiModalComponent.preventEvent(event); // 阻止默认事件及继续冒泡，确保此处手动focus生效
            }
            return;
        }
        // 按下tab键时，如当前已获取焦点元素是弹框中最后一个可获取焦点元素，则聚焦第一个元素
        if (target === lastFocusableEle) {
            firstFocusableEle.focus();
            TiModalComponent.preventEvent(event);
        }
    }
    getFocusableElesInModal() {
        if (this.focusableElements.length !== 0) {
            return this.focusableElements;
        }
        const contentEle = this.contentRef.nativeElement;
        if (contentEle) {
            const elements = contentEle.querySelectorAll(TiModalComponent.tababbleSelector);
            [].forEach.call(elements, (element) => {
                if (getComputedStyle(element).display !== 'none' &&
                    element.offsetWidth > 0 && element.offsetHeight > 0) {
                    this.focusableElements.push(element);
                }
            });
        }
        return this.focusableElements;
    }
}
/**
 * 10.1.1新增
 * 规范刷新，弹窗整体的最大高度为660px（按照最小分辨率1280*768计算）
 */
TiModalComponent.MODAL_MAX_HEIGHT = 660;
// 可通过tab聚焦的元素选择器列表
TiModalComponent.tababbleSelector = `a[href], area[href], input:not([disabled]):not([tabindex=\'-1\']),
       button:not([disabled]):not([tabindex=\'-1\']),select:not([disabled]):not([tabindex=\'-1\']),
       textarea:not([disabled]):not([tabindex=\'-1\']),
       iframe, object, embed, *[tabindex]:not([tabindex=\'-1\']), *[contenteditable=true]`;
TiModalComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-modal-wrapper',
                template: "<div #modalEle class='ti3-modal' tabindex='-1'\r\n     [@.disabled]='!animation' [@modalAnimate]='showState'>\r\n    <div [ngClass]='[modalClass||\"\", \"ti3-modal-dialog\"]' [@modalPosAnimate]='showState' (@modalPosAnimate.done)='onAnimationDone($event)'>\r\n        <div class=\"ti3-modal-content\" #modalContent [tiDraggable] = \"dragOptions\" [tiDragDisabled] = \"!draggable\">\r\n            <span *ngIf='closeIcon' class='ti3-close ti3-icon ti3-icon-close'\r\n            [tabindex]=\"0\" (keydown.enter)=\"dismissModal()\" tiOutline\r\n            (click)='dismissModal()' [id]=\"appendId('close')\"></span>\r\n            <ng-content></ng-content>\r\n        </div>\r\n    </div>\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                animations: [
                    trigger('modalAnimate', [
                        state('show', style({
                            opacity: 1
                        })),
                        state('hide, void', style({
                            opacity: 0
                        })),
                        transition('show => hide', animate(animateStyle)),
                        transition('hide => show', animate(animateStyle))
                    ]),
                    trigger('modalPosAnimate', [
                        state('show', style({
                            transform: 'translate(0, 0px)'
                        })),
                        state('hide, void', style({
                            transform: 'translate(0, -6px)'
                        })),
                        transition('show => hide', animate(animateStyle)),
                        transition('hide => show', animate(animateStyle))
                    ])
                ],
                styles: [":root{--ti-modal-content-margin:0 32px;--ti-modal-footer-padding:28px 32px 32px;--ti-modal-header-font-size:var(--ti-common-font-size-3);--ti-modal-header-height:36px;--ti-modal-header-padding:32px 32px 28px;--ti-modal-width:550px}.ti3-modal{-ms-box-sizing:border-box;-webkit-overflow-scrolling:touch;bottom:0;box-sizing:border-box;left:0;outline:0;overflow:hidden;position:fixed;right:0;top:0;z-index:1050}.ti3-modal-open .ti3-modal{overflow-x:hidden;overflow-y:auto}.ti3-modal-dialog{-ms-box-sizing:border-box;box-sizing:border-box;margin:10px;position:relative;width:auto}.ti3-modal-dialog.ti3-msg-default-width{width:var(--ti-message-default-width)}.ti3-modal-content{background-clip:padding-box;background-color:var(--ti-modal-content-bg-color);border-radius:var(--ti-common-border-radius-normal);box-shadow:var(--ti-common-shadow-4-down);outline:0;position:relative}.ti3-modal-content,.ti3-modal-header{-ms-box-sizing:border-box;box-sizing:border-box}.ti3-modal-header{border-radius:var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal) 0 0;color:var(--ti-modal-header-text-color);display:block;font-size:var(--ti-modal-header-font-size);font-weight:var(--ti-modal-header-font-weight);line-height:100%;padding:var(--ti-modal-header-padding)}.ti3-modal-header.ti3-modal-title-center{text-align:center}.ti3-close{-moz-osx-font-smoothing:grayscale;-ms-box-sizing:border-box;-webkit-font-smoothing:antialiased;box-sizing:border-box;color:var(--ti-modal-close-icon-color);cursor:pointer;font:normal normal normal var(--ti-common-font-size-base)/var(--ti-modal-header-height) ti3Font;position:absolute;right:var(--ti-modal-close-icon-position-right);text-rendering:auto;text-transform:none;top:var(--ti-modal-close-icon-position-top);z-index:2000}.ti3-close:hover{color:var(--ti-modal-close-icon-color-hover)}.ti3-modal-body{-ms-box-sizing:border-box;box-sizing:border-box;display:block;overflow-y:auto;padding:var(--ti-modal-content-margin);position:relative}.ti3-modal-footer{border-radius:0 0 var(--ti-common-border-radius-normal) var(--ti-common-border-radius-normal);display:block;padding:var(--ti-modal-footer-padding);text-align:center}.ti3-modal-footer button:nth-of-type(2){margin-left:10px}@media screen and (min-width:768px){.ti3-modal-dialog{margin:150px auto 0;width:var(--ti-modal-width)}}"]
            },] }
];
TiModalComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: TiRenderer },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiModalComponent.propDecorators = {
    contentRef: [{ type: ViewChild, args: ['modalContent', { static: true },] }],
    modalEleRef: [{ type: ViewChild, args: ['modalEle', { static: true },] }],
    onhashchange: [{ type: HostListener, args: ['window:hashchange',] }],
    onResize: [{ type: HostListener, args: ['window:resize',] }],
    onKeydown: [{ type: HostListener, args: ['document:keydown', ['$event'],] }],
    onTiScroll: [{ type: HostListener, args: ['document:mousewheel',] }, { type: HostListener, args: ['document:DOMMouseScroll',] }, { type: HostListener, args: ['window:scroll',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlNb2RhbENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9zZXJ2aWNlcy9tb2RhbC9UaU1vZGFsQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDZSxTQUFTLEVBQUUsVUFBVSxFQUN2QyxZQUFZLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQ2hFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUVyRTs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBVywyQ0FBMkMsQ0FBQztBQUNoRjs7R0FFRztBQTZCSCxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsZUFBZTtJQWdDakQsWUFBWSxHQUFlLEVBQVUsVUFBc0IsRUFBWSxRQUFtQixFQUE0QixRQUFRO1FBQzFILEtBQUssQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFEWSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVksYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUE0QixhQUFRLEdBQVIsUUFBUSxDQUFBO1FBTnZILFVBQUssR0FBVyxDQUFDLENBQUMsQ0FBQyx3QkFBd0I7UUFLMUMsc0JBQWlCLEdBQWUsRUFBRSxDQUFDLENBQUMsYUFBYTtJQUd6RCxDQUFDO0lBbEJELElBQUksU0FBUyxD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QUM7cUJBQ3BELENBQUM7aUJBQ0w7O2FBQ0o7OztZQTVDZ0MsVUFBVTtZQU9sQyxVQUFVO1lBTkQsU0FBUzs0Q0E0RXNFLE1BQU0sU0FBQyxRQUFROzs7eUJBcEIzRyxTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTswQkFDMUMsU0FBUyxTQUFDLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBNEJ0QyxZQUFZLFNBQUMsbUJBQW1CO3VCQUloQyxZQUFZLFNBQUMsZUFBZTt3QkFPNUIsWUFBWSxTQUFDLGtCQUFrQixFQUFFLENBQUMsUUFBUSxDQUFDO3lCQWtCM0MsWUFBWSxTQUFDLHFCQUFxQixjQUFHLFlBQVksU0FBQyx5QkFBeUIsY0FBRyxZQUFZLFNBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBBZnRlckNvbnRlbnRJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsXHJcbiAgICBIb3N0TGlzdGVuZXIsIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiwgSW5qZWN0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbmltcG9ydCB7IGFuaW1hdGUsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgdHJpZ2dlciB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xyXG5pbXBvcnQgeyBUaUtleW1hcCwgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaVJlbmRlcmVyIH0gZnJvbSAnLi4vcmVuZGVyZXIvVGlSZW5kZXJlcic7XHJcbmltcG9ydCB7IFRpQmFzZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvYmFzZS9UaUJhc2VNb2R1bGUnO1xyXG5cclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICovXHJcbmV4cG9ydCBjb25zdCBhbmltYXRlU3R5bGU6IHN0cmluZyA9ICcwLjNzIGN1YmljLWJlemllcigwLjQwLCAwLjAwLCAwLjIwLCAxLjAwKSc7XHJcbi8qKlxyXG4gKiBAaWdub3JlXHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndGktbW9kYWwtd3JhcHBlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vVGlNb2RhbENvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL21vZGFsLmxlc3MnXSxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgICBhbmltYXRpb25zOiBbIC8vIOeUseS6juWKqOeUu+WIm+W7uumcgOimgeWcqOWFg+aVsOaNruS4reino+aekO+8jOWboOatpOWKqOeUu+WumuS5ieW/hemhu+WcqOatpOWkhOWumuS5iVxyXG4gICAgICAgIHRyaWdnZXIoJ21vZGFsQW5pbWF0ZScsIFtcclxuICAgICAgICAgICAgc3RhdGUoJ3Nob3cnLCBzdHlsZSh7XHJcbiAgICAgICAgICAgICAgICBvcGFjaXR5IDogMVxyXG4gICAgICAgICAgICB9KSksXHJcbiAgICAgICAgICAgIHN0YXRlKCdoaWRlLCB2b2lkJywgc3R5bGUoe1xyXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxyXG4gICAgICAgICAgICB9KSksXHJcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ3Nob3cgPT4gaGlkZScsIGFuaW1hdGUoYW5pbWF0ZVN0eWxlKSksXHJcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2hpZGUgPT4gc2hvdycsIGFuaW1hdGUoYW5pbWF0ZVN0eWxlKSlcclxuICAgICAgICBdKSxcclxuICAgICAgICB0cmlnZ2VyKCdtb2RhbFBvc0FuaW1hdGUnLCBbXHJcbiAgICAgICAgICAgIHN0YXRlKCdzaG93Jywgc3R5bGUoe1xyXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKDAsIDBweCknXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgc3RhdGUoJ2hpZGUsIHZvaWQnLCBzdHlsZSh7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCwgLTZweCknXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbignc2hvdyA9PiBoaWRlJywgYW5pbWF0ZShhbmltYXRlU3R5bGUpKSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbignaGlkZSA9PiBzaG93JywgYW5pbWF0ZShhbmltYXRlU3R5bGUpKVxyXG4gICAgICAgIF0pXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaU1vZGFsQ29tcG9uZW50IGV4dGVuZHMgVGlCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCB7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjEuMeaWsOWinlxyXG4gICAgICog6KeE6IyD5Yi35paw77yM5by556qX5pW05L2T55qE5pyA5aSn6auY5bqm5Li6NjYwcHjvvIjmjInnhafmnIDlsI/liIbovqjnjocxMjgwKjc2OOiuoeeul++8iVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNT0RBTF9NQVhfSEVJR0hUOiBudW1iZXIgPSA2NjA7XHJcbiAgICAvLyDlj6/pgJrov4d0YWLogZrnhKbnmoTlhYPntKDpgInmi6nlmajliJfooahcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHRhYmFiYmxlU2VsZWN0b3I6IHN0cmluZyA9IGBhW2hyZWZdLCBhcmVhW2hyZWZdLCBpbnB1dDpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLFxyXG4gICAgICAgYnV0dG9uOm5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PVxcJy0xXFwnXSksc2VsZWN0Om5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PVxcJy0xXFwnXSksXHJcbiAgICAgICB0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLFxyXG4gICAgICAgaWZyYW1lLCBvYmplY3QsIGVtYmVkLCAqW3RhYmluZGV4XTpub3QoW3RhYmluZGV4PVxcJy0xXFwnXSksICpbY29udGVudGVkaXRhYmxlPXRydWVdYDtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdtb2RhbENvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGNvbnRlbnRSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdtb2RhbEVsZScsIHsgc3RhdGljOiB0cnVlIH0pIHByb3RlY3RlZCBtb2RhbEVsZVJlZjogRWxlbWVudFJlZjtcclxuXHJcbiAgICBwcm90ZWN0ZWQgX3Nob3dTdGF0ZTogc3RyaW5nOyAvLyDnu4Tku7bmmL7npLrnirbmgIHvvIznlKjkuo7mjqfliLbliqjnlLvnmoTnirbmgIHliIfmjaJcclxuICAgIHNldCBzaG93U3RhdGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3Nob3dTdGF0ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgZ2V0IHNob3dTdGF0ZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zaG93U3RhdGU7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgYW5pbWF0aW9uOiBib29sZWFuOyAgLy8g5piv5ZCm5pyJ5Yqo55S7XHJcbiAgICBwdWJsaWMgZHJhZ2dhYmxlOiBib29sZWFuOyAgLy8g5piv5ZCm5Y+v5ouW5ou9XHJcbiAgICBwdWJsaWMgY2xvc2VPbkVzYzogYm9vbGVhbjsgLy8g5piv5ZCm5Y+v6YCa6L+HRVND6ZSu5YWz6Zet5by55qGGXHJcbiAgICBwdWJsaWMgbW9kYWxJbnN0YW5jZTogYW55OyAvLyDnu4Tku7blrp7kvovvvIzlj6/kvb/nlKjor6Xlrp7kvovosIPnlKjmlrnms5XmjqfliLbnu4Tku7booYzkuLpcclxuICAgIHB1YmxpYyBpbmRleDogbnVtYmVyID0gMDsgLy8g5aSa5Liq5by55Ye65qGG5oOF5Ya15LiL77yMemluZGV45bGC57qn6K6+572u6L6F5YqpXHJcbiAgICBwdWJsaWMgY2xvc2VJY29uOiBib29sZWFuOyAvLyDmmK/lkKbmnInlpLTpg6jlhbPpl63mjInpkq5cclxuICAgIHB1YmxpYyBtb2RhbENsYXNzOiBzdHJpbmc7IC8vIOW8ueahhuagt+W8j+iuvue9rlxyXG4gICAgcHVibGljIGhlYWRlckFsaWduOiAnY2VudGVyJyB8ICdsZWZ0JyB8ICdyaWdodCc7IC8vIOWktOmDqOWvuem9kOaWueW8j1xyXG4gICAgcHVibGljIGRyYWdPcHRpb25zOiBhbnk7IC8vIOaLluaLvemFjee9rlxyXG4gICAgcHJpdmF0ZSBmb2N1c2FibGVFbGVtZW50czogQXJyYXk8YW55PiA9IFtdOyAvLyDlvLnmoYbkuK3lj6/ogZrnhKblhYPntKDliJfooahcclxuICAgIGNvbnN0cnVjdG9yKGVsZTogRWxlbWVudFJlZiwgcHJpdmF0ZSB0aVJlbmRlcmVyOiBUaVJlbmRlcmVyLCBwcm90ZWN0ZWQgcmVuZGVyZXI6IFJlbmRlcmVyMiwgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudCkge1xyXG4gICAgICAgIHN1cGVyKGVsZSwgcmVuZGVyZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIHByZXZlbnRFdmVudChldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLy8g6Lev55Sx5YiH5o2i5ZCO77yMbW9kYWzov5jkvJrlrZjlnKjvvIzlm6DmraTmraTlpITlgZrkuobkuovku7blpITnkIZcclxuICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpoYXNoY2hhbmdlJykgb25oYXNoY2hhbmdlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubW9kYWxJbnN0YW5jZS5fcmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICAvLyDnvKnmlL7ml7bph43nva7lvLnmoYbkvY3nva5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKSBvblJlc2l6ZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnRpUmVuZGVyZXIuc2V0U3R5bGVzKHRoaXMuY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCB7XHJcbiAgICAgICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgICAgIHRvcDogMFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8g6ZSu55uY5LqL5Lu25aSE55CGXHJcbiAgICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duJywgWyckZXZlbnQnXSkgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgc3dpdGNoIChldmVudC53aGljaCkge1xyXG4gICAgICAgICAgICBjYXNlIFRpS2V5bWFwLktFWV9FU0NBUEU6ICAvLyBjbG9zZSBvbiBFU0NcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsb3NlT25Fc2MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc21pc3NNb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVGlLZXltYXAuS0VZX1RBQjogLy8gdGFi6ZSu55So5LqO5aSE55CG5Zyo5by55qGG5YaF5b6q546v6I635Y+W54Sm54K5XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uVGFiQ2hhbmdlKGV2ZW50KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g5by556qX5aSW5Zu05Ye6546w55qE5rua5Yqo5p2h5rua5Yqo5Lya5a+86Ie05LiL5ouJ562J5a6a5L2N5ZyoYm9keeS4iueahOe7hOS7tuebuOWvueS6juWuv+S4u+WFg+e0oOWumuS9jeWBj+enu++8jFxyXG4gICAgLy8g5Zug5q2k6Kem5Y+RdGlTY3JvbGzkuovku7blgZrlpITnkIbvvIzkuovku7bljIXmi6zvvJpcclxuICAgIC8vIOaVtOS4qumhtemdoua7muWKqOadoea7mui9rua7muWKqOS6i+S7tiwgbW91c2V3aGVlbOWkhOeQhkNocm9tZeWSjElF5LiL5LqL5Lu277yMRE9NTW91c2VTY3JvbGzlpITnkIZmaXJlZm945LiL5LqL5Lu2XHJcbiAgICAvLyDmlbTkuKrpobXpnaLmu5rliqjmnaHpvKDmoIfmu5rliqjkuovku7ZcclxuICAgIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50Om1vdXNld2hlZWwnKSBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpET01Nb3VzZVNjcm9sbCcpIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpzY3JvbGwnKSBvblRpU2Nyb2xsKCk6IHZvaWQge1xyXG4gICAgICAgIFV0aWwudHJpZ2dlcihkb2N1bWVudCwgJ3RpU2Nyb2xsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHJhZ09wdGlvbnMgPSB7Ly8g55Sx5LqO5q2k5aSE6ZyA6KaB6I635Y+WbmdDb250ZW505Lit55qE5YaF5a65LOWboOatpOWcqOivpeaXtuacuuS4rei/m+ihjOWkhOeQhlxyXG4gICAgICAgICAgICAvLyDov5nml7blvLnnqpflhoXlrrlET03ov5jmnKrop6PmnpDvvIzmiYDku6XpnIDopoHkvb/nlKjmoIfnrb7pgInmi6nlmagoJ3RpLW1vZGFsLWhlYWRlcicp5p2l6I635Y+W5YWD57SgXHJcbiAgICAgICAgICAgIGhhbmRsZTogdGhpcy5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RpLW1vZGFsLWhlYWRlcicpLFxyXG4gICAgICAgICAgICBkcmFnOiAob3B0czoge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBudW1iZXJcclxuICAgICAgICAgICAgICAgICAgICB0b3A6IG51bWJlclxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhlbHBlcjogRWxlbWVudFxyXG4gICAgICAgICAgICB9KTogeyBsZWZ0OiBudW1iZXIsIHRvcDogbnVtYmVyXHJcbiAgICAgICAgICAgIH0gPT4ge1xyXG4gICAgICAgICAgICAgICAgVXRpbC50cmlnZ2VyKGRvY3VtZW50LCAndGlTY3JvbGwnKTtcclxuICAgICAgICAgICAgICAgIC8vIOW9k+WJjea1j+iniOWZqOWPr+inhuWMuuWfn+eahOWuvemrmFxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VyQnJvd3NlV2lkdGg6IG51bWJlciA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGN1ckJyb3dzZWhlaWdodDogbnVtYmVyID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgICAgIC8vIOWFg+e0oOWOn+Wni+S9jee9ru+8iOeUseS6juWFg+e0oOacrOi6q2xlZnTlkox0b3Dlrp7ml7blj5jljJbvvIzlm6DmraTlj5blhbbniLblhYPntKDkvY3nva7vvIlcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVsZVJlY3Q6IENsaWVudFJlY3QgfCBET01SZWN0ID0gb3B0cy5oZWxwZXIucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgIC8vIOWFg+e0oOi3nemhtemdouWPr+inhuWMuuWfn+eahOWPr+eUqOS9jee9ruiMg+WbtFxyXG4gICAgICAgICAgICAgICAgY29uc3QgbWluTGVmdDogbnVtYmVyID0gLSBlbGVSZWN0LmxlZnQgKyBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXhMZWZ0OiBudW1iZXIgPSBNYXRoLm1heChjdXJCcm93c2VXaWR0aCArIG1pbkxlZnQgLSBlbGVSZWN0LndpZHRoLCBtaW5MZWZ0KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1pblRvcDogbnVtYmVyID0gLWVsZVJlY3QudG9wICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXhUb3A6IG51bWJlciA9IE1hdGgubWF4KGN1ckJyb3dzZWhlaWdodCArIG1pblRvcCAtIGVsZVJlY3QuaGVpZ2h0LCBtaW5Ub3ApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb246IHsgbGVmdDogbnVtYmVyLCB0b3A6IG51bWJlcn0gPSBvcHRzLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgLy8g5YWD57SgbGVmdOS9jee9ruagueaNruWPr+eUqGxlZnTojIPlm7TorqHnrpdcclxuICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbi5sZWZ0IDwgbWluTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmxlZnQgPSBtaW5MZWZ0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbi5sZWZ0ID4gbWF4TGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmxlZnQgPSBtYXhMZWZ0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8g5YWD57SgdG9w5L2N572u5qC55o2u5Y+v55SodG9w6IyD5Zu06K6h566XXHJcbiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24udG9wIDwgbWluVG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24udG9wID0gbWluVG9wO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbi50b3AgPiBtYXhUb3ApIHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbi50b3AgPSBtYXhUb3A7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBkaXNtaXNzTW9kYWwoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5tb2RhbEluc3RhbmNlLmRpc21pc3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25BbmltYXRpb25Eb25lKCRldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgLy8g5by55qGGdG9TdGF0ZeacieS4ieenjeeKtuaAgTonc2hvdycvJ2hpZGUnL251bGxcclxuICAgICAgICAvLyDlvLnmoYbmmL7npLrliqjnlLvnu5PmnZ/lkI4s6YeN5paw5bCG54Sm54K56IGa54Sm5Zyo5by55qGG5YWD57SgL+W8ueahhuS4rVxyXG4gICAgICAgIGlmICgkZXZlbnQudG9TdGF0ZSA9PT0gJ3Nob3cnKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVTdHlsZU1vZGFsKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXNJbk1vZGFsKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOW8ueahhumakOiXj+WKqOeUu+e7k+adn+WQjizplIDmr4HlvLnmoYZET01cclxuICAgICAgICBpZiAoJGV2ZW50LnRvU3RhdGUgPT09ICdoaWRlJykge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGFsSW5zdGFuY2UuX3JlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDlvLnmoYbmiZPlvIDml7bvvIzorr7nva7lvLnmoYblhYPntKDmoLflvI9cclxuICAgIHByaXZhdGUgcmVTdHlsZU1vZGFsKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudEVsZTogRWxlbWVudCA9IHRoaXMubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudGkzLW1vZGFsLWhlYWRlcicpO1xyXG4gICAgICAgIGlmICh0aGlzLmRyYWdnYWJsZSAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShwYXJlbnRFbGUsICdjdXJzb3InLCAnbW92ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5oZWFkZXJBbGlnbiA9PT0gJ2NlbnRlcicgfHwgdGhpcy5oZWFkZXJBbGlnbiA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHBhcmVudEVsZSwgJ3RleHQtYWxpZ24nLCB0aGlzLmhlYWRlckFsaWduKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5kb2N1bWVudC5ib2R5LCAndGkzLW1vZGFsLW9wZW4nKTtcclxuICAgICAgICB0aGlzLnNldE1heEhlaWdodCgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7lvLnmoYbpq5jluqbvvJpcclxuICAgICAqIOagueaNrlVDRDMuMOinhOiMg++8jG1vZGFs5pyA5aSn6auY5bqm5LiN6IO96LaF6L+H5by55qGG5a695bqmLOaJgOS7pemcgOimgeiOt+WPluWIsG1vZGFs55qE5a695bqm5YC877yM55So5YW25YeP5Y67bW9kYWznmoRoZWFkZXLlkoxmb290ZXLnmoTpq5jluqZcclxuICAgICAqIOWQjuiuvuS4umJvZHnnmoTmnIDlpKfpq5jluqbvvIzlvZPpq5jluqbotoXlh7rml7bvvIx0aS1tb2RhbC1ib2R55Z6C55u05pa55ZCR5LiK5Ye6546w5rua5Yqo5p2hXHJcbiAgICAgKiAxMC4xLjHlj5jmm7Tor7TmmI7vvJpcclxuICAgICAqIOagueaNruinhOiMg+WPmOabtO+8jOW8ueahhumrmOW6puWPr+S7pei2hei/h+W8ueahhuWuveW6pu+8jOWQjOaXtuW8ueeql+eahOacgOWkp+mrmOW6puaYrzY2MHB444CCXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc2V0TWF4SGVpZ2h0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOS/ruWkjVNTUumXrumimO+8mkVSUk9SIFR5cGVFcnJvcjogbW9kYWxIZWFkZXJFbGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIG5vdCBhIGZ1bmN0aW9uXHJcbiAgICAgICAgY29uc3QgbW9kYWxIZWFkZXJFbGU6IEVsZW1lbnQgPSB0aGlzLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnRpMy1tb2RhbC1oZWFkZXInKTtcclxuICAgICAgICBjb25zdCBtb2RhbEhlYWRlckhlaWdodDogbnVtYmVyID0gbW9kYWxIZWFkZXJFbGUgJiYgKHR5cGVvZiBtb2RhbEhlYWRlckVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPT09ICdmdW5jdGlvbicpID8gbW9kYWxIZWFkZXJFbGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IDogMDtcclxuICAgICAgICBjb25zdCBtb2RhbEZvb3RlckVsZTogRWxlbWVudCA9IHRoaXMubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudGkzLW1vZGFsLWZvb3RlcicpO1xyXG4gICAgICAgIGNvbnN0IG1vZGFsRm9vdGVySGVpZ2h0OiBudW1iZXIgPSBtb2RhbEZvb3RlckVsZSAmJiAodHlwZW9mIG1vZGFsRm9vdGVyRWxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCA9PT0gJ2Z1bmN0aW9uJykgPyBtb2RhbEZvb3RlckVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgOiAwO1xyXG4gICAgICAgIGNvbnN0IG1vZGFsQm9keU1heEhlaWdodDogbnVtYmVyID0gVGlNb2RhbENvbXBvbmVudC5NT0RBTF9NQVhfSEVJR0hUIC0gbW9kYWxIZWFkZXJIZWlnaHQgLSBtb2RhbEZvb3RlckhlaWdodDtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudGkzLW1vZGFsLWJvZHknKSwgJ21heEhlaWdodCcsIG1vZGFsQm9keU1heEhlaWdodCArICdweCcpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBmb2N1c0luTW9kYWwoKTogdm9pZCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6aaW5YWI5Yik5pat5paw5omT5byA55qEbW9kYWzmmK/lkKblt7LlrZjlnKjojrflj5bnhKbngrnnmoTlhYPntKBcclxuICAgICAgICAgKiDlpoLmnpzlrZjlnKjvvIzliJnpnIDopoHlr7ltb2RhbOWFg+e0oOWGjeasoeiuvue9rueEpueCuVxyXG4gICAgICAgICAqIOWQpuWIme+8jOWvuW1vZGFs5a655Zmo6K6+572u54Sm54K5XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudDogYW55ID0gdGhpcy5kb2N1bWVudC5hY3RpdmVFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IGlzZm9jdXNlZEluTW9kYWw6IGJvb2xlYW4gPSBhY3RpdmVFbGVtZW50ICYmIHRoaXMubmF0aXZlRWxlbWVudC5jb250YWlucyhhY3RpdmVFbGVtZW50KTtcclxuICAgICAgICBpZiAoaXNmb2N1c2VkSW5Nb2RhbCkge1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5a+55bey57uP6K6+572u54Sm54K555qE5YWD57Sg77yM5YaN5qyh6K6+572u54Sm54K577yM5piv5Li65LqG6Kej5Yaz5Lul5LiL5Lik5Liq6Zeu6aKY77yaXHJcbiAgICAgICAgICAgICAqIDE+6aaW5qyh5Yqg6L295pe277yM5bey57uP6I635Y+W54Sm54K555qE5YWD57Sg77yM5YW26L6T5YWldGlw5o+Q56S65L2N572u5YGP56e7XHJcbiAgICAgICAgICAgICAqIDI+6aaW5qyh5Yqg6L295pe277yMSUXmtY/op4jlmajkuK3vvIzlt7Lnu4/ojrflj5bnhKbngrnnmoTlhYPntKBpbnB1dO+8jOWFieagh+S9jee9ruWHuueOsOWBj+enu1xyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgaWYgKGFjdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUVsZW1lbnQuYmx1cigpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGlhdXRvZm9jdXNpbm1vZGFs5bGe5oCn6ZyA6KaB5ZyoY2hhbmdl5qCh6aqM5Lit5L2/55SoKENoYW5nZUNoZWNrLnRzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoYWN0aXZlRWxlbWVudCwgJ3RpYXV0b2ZvY3VzaW5tb2RhbCcsICcnKTtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGFjdGl2ZUVsZW1lbnQsICd0aWF1dG9mb2N1c2lubW9kYWwnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOW8ueeql+WGheacquaJvuWIsOW3suiBmueEpuWFg+e0oOaDheWGteS4i++8jOS8mOWFiOWkhOeQhiBpbnB1dCDlkowgdGV4dGFyZWEg5Y6f55Sf5qCH562+YXV0b2ZvY3Vz6IGa54SmXHJcbiAgICAgICAgICAgIC8vIChpbnB1dCx0ZXh0YXJlYS5idXR0b27ljp/nlJ/moIfnrb7nmoRhdXRvZm9jdXPlvLnnqpfmiZPlvIDml7bml6DmlYgoY2hyb21l5piv5LuO56ys5LqM5qyh5omT5byA5peg5pWIKe+8jOWboOatpOimgeWBmuatpOWkhOeQhilcclxuICAgICAgICAgICAgbGV0IGZvY3VzRWxlOiBhbnkgPSB0aGlzLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihgaW5wdXRbYXV0b2ZvY3VzXTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLFxyXG4gICAgICAgICAgICAgICAgdGV4dGFyZWFbYXV0b2ZvY3VzXTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLCBidXR0b25bYXV0b2ZvY3VzXTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pYCk7XHJcbiAgICAgICAgICAgIC8vIOWmguaenOmAmui/h+S4iui/sOWkhOeQhu+8jOiBmueEpuWFg+e0oOS7jeacquiOt+WPluWIsOeahOaDheWGteS4i++8jOWImeWPr+iBmueEpuWFg+e0oOS4uuW9k+WJjeW8ueahhlxyXG4gICAgICAgICAgICBmb2N1c0VsZSA9IGZvY3VzRWxlIHx8IHRoaXMubW9kYWxFbGVSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgZm9jdXNFbGUuZm9jdXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDnlKjkuo7lpITnkIZ0YWLplK7ooYzkuLrvvIznoa7kv510YWLml7blj6rlj6/lnKjlvLnmoYblhoXlvqrnjq/ojrflj5bnhKbngrlcclxuICAgIHByaXZhdGUgb25UYWJDaGFuZ2UoZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBmb2N1c2FibGVFbGVtZW50TGlzdDogQXJyYXk8RWxlbWVudD4gPSB0aGlzLmdldEZvY3VzYWJsZUVsZXNJbk1vZGFsKCk7IC8vIOiOt+WPluW9k+WJjeW8ueWHuuahhkRPTeS4reWPr+S7peiOt+WPlueEpueCueeahOWFg+e0oOWIl+ihqFxyXG4gICAgICAgIGNvbnN0IGZvY3VzYWJsZUxpc3RMZW5ndGg6IG51bWJlciA9IGZvY3VzYWJsZUVsZW1lbnRMaXN0Lmxlbmd0aDtcclxuICAgICAgICBpZiAoZm9jdXNhYmxlTGlzdExlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRhcmdldDogRXZlbnRUYXJnZXQgPSBldmVudC50YXJnZXQ7IC8vIOS6i+S7tuWvueixoeWFg+e0oFxyXG4gICAgICAgIGNvbnN0IGZpcnN0Rm9jdXNhYmxlRWxlOiBhbnkgPSBmb2N1c2FibGVFbGVtZW50TGlzdFswXTsgLy8g56ys5LiA5Liq5Y+v6I635Y+W54Sm54K555qE5YWD57SgXHJcbiAgICAgICAgY29uc3QgbGFzdEZvY3VzYWJsZUVsZTogYW55ID0gZm9jdXNhYmxlRWxlbWVudExpc3RbZm9jdXNhYmxlTGlzdExlbmd0aCAtIDFdOyAvLyDmnIDlkI7kuIDkuKrlj6/ojrflj5bnhKbngrnnmoTlhYPntKBcclxuICAgICAgICAvLyDmjInkuIt0YWIrc2hpZnTplK7ml7bvvIzlpoLmnpzlvZPliY3lt7Lojrflj5bnhKbngrnlhYPntKDmmK/lvLnlh7rmoYbkuK3nmoTnrKzkuIDkuKrlj6/ojrflj5bnhKbngrnlhYPntKDmiJblvLnmoYbmnKzouqvvvIzliJnogZrnhKbmnIDlkI7kuIDkuKrlhYPntKBcclxuICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gZmlyc3RGb2N1c2FibGVFbGUgfHwgdGFyZ2V0ID09PSB0aGlzLm1vZGFsRWxlUmVmLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGxhc3RGb2N1c2FibGVFbGUuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIFRpTW9kYWxDb21wb25lbnQucHJldmVudEV2ZW50KGV2ZW50KTsgLy8g6Zi75q2i6buY6K6k5LqL5Lu25Y+K57un57ut5YaS5rOh77yM56Gu5L+d5q2k5aSE5omL5YqoZm9jdXPnlJ/mlYhcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDmjInkuIt0YWLplK7ml7bvvIzlpoLlvZPliY3lt7Lojrflj5bnhKbngrnlhYPntKDmmK/lvLnmoYbkuK3mnIDlkI7kuIDkuKrlj6/ojrflj5bnhKbngrnlhYPntKDvvIzliJnogZrnhKbnrKzkuIDkuKrlhYPntKBcclxuICAgICAgICBpZiAodGFyZ2V0ID09PSBsYXN0Rm9jdXNhYmxlRWxlKSB7XHJcbiAgICAgICAgICAgIGZpcnN0Rm9jdXNhYmxlRWxlLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIFRpTW9kYWxDb21wb25lbnQucHJldmVudEV2ZW50KGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGdldEZvY3VzYWJsZUVsZXNJbk1vZGFsKCk6IEFycmF5PEVsZW1lbnQ+IHtcclxuICAgICAgICBpZiAodGhpcy5mb2N1c2FibGVFbGVtZW50cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNhYmxlRWxlbWVudHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNvbnRlbnRFbGU6IEVsZW1lbnQgPSB0aGlzLmNvbnRlbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgICBpZiAoY29udGVudEVsZSkge1xyXG4gICAgICAgICAgICBjb25zdCBlbGVtZW50czogTm9kZUxpc3RPZjxFbGVtZW50PiA9IGNvbnRlbnRFbGUucXVlcnlTZWxlY3RvckFsbChUaU1vZGFsQ29tcG9uZW50LnRhYmFiYmxlU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwoZWxlbWVudHMsIChlbGVtZW50OiBhbnkpID0+IHsgLy8g5om+5Ye66aG16Z2i55yf5a6e5pi+56S655qE5YWD57Sg77yM5Y+q5pyJ5pi+56S655qE5YWD57Sg5omN5Y+vdGFi6IGa54SmXHJcbiAgICAgICAgICAgICAgICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5kaXNwbGF5ICE9PSAnbm9uZScgJiZcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZnNldFdpZHRoID4gMCAmJiBlbGVtZW50Lm9mZnNldEhlaWdodCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzYWJsZUVsZW1lbnRzLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNhYmxlRWxlbWVudHM7XHJcbiAgICB9XHJcbn1cclxuIl19