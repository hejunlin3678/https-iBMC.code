import { Injectable, RendererFactory2, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { TiIntroServiceModule } from './TiIntroModule';
import { TiModalService } from '../modal/TiModalService';
import { TiTipService } from '../tip/TiTipService';
import { TiLog, TiKeymap, Util } from '../../utils/Util';
import { Position } from '../../utils/Position';
import { TiIntromodalComponent } from './TiIntromodalComponent';
import { TiIntrotipComponent } from './TiIntrotipComponent';
import * as i0 from "@angular/core";
import * as i1 from "../tip/TiTipService";
import * as i2 from "../modal/TiModalService";
import * as i3 from "@angular/common";
import * as i4 from "./TiIntroModule";
/**
 * 新手引导组件，适用于服务中内容（入口）新增和变动等指引提醒
 *
 * <p><span style="color: red">使用此组件时需要开发者在项目模块(建议在根模块)中引入BrowserAnimationsModule。</span>
 * 这是因为此组件中使用了 TiModalService，TiModalService需要BrowserAnimationsModule
 * （具体原因可以查看 [TiModalService]{@link ../injectables/TiModalService.html}），
 * 但是 BrowserAnimationsModule 不能在懒加载模块被重复引入，所以需要开发者来引入BrowserAnimationsModule，保证其引入一次。</p>
 *
 * <example-url>../tiny3demo/#/intro/intro-all</example-url>
 */
export class TiIntroService {
    constructor(tipService, modalService, rendererFactory, document) {
        this.tipService = tipService;
        this.modalService = modalService;
        this.document = document;
        // 可聚焦元素
        this.focusableElementsString = `a[href], area[href], input:not([disabled]):not([tabindex=\'-1\']),
    button:not([disabled]):not([tabindex=\'-1\']),select:not([disabled]):not([tabindex=\'-1\']),
    textarea:not([disabled]):not([tabindex=\'-1\']),
    iframe, object, embed, *[tabindex]:not([tabindex=\'-1\']), *[contenteditable=true]`;
        /**
         * intro的公共配置，不是默认配置，不能修改
         */
        this.commonConfig = {
            trigger: 'manual',
            theme: 'white',
            maxWidth: '400px'
        };
        /* tslint:disable:no-null-keyword */
        this.render = rendererFactory.createRenderer(null, null);
    }
    destroyBackdrop() {
        const canvas = this.document.body.querySelector('#ti3-intro-backdrop');
        if (canvas) {
            // canvas.remove() IE报错；canvas.removeNode() Chrome报错；可以使用removeChild方法
            canvas.parentNode.removeChild(canvas);
        }
    }
    static clearCircle(x, y, radius, stepClear, ctx) {
        const calcWidth = radius - stepClear;
        const calcHeight = Math.sqrt(radius * radius - calcWidth * calcWidth);
        const posX = x - calcWidth;
        const posY = y - calcHeight;
        const widthX = calcWidth * 2;
        const heightY = calcHeight * 2;
        if (stepClear < radius) {
            ctx.clearRect(posX, posY, widthX, heightY);
            const newStepClear = stepClear + 1;
            TiIntroService.clearCircle(x, y, radius, newStepClear, ctx);
        }
    }
    static scrollToViewport(element) {
        // 修复SSR错误：ERROR TypeError: element.getBoundingClientRect is not a function
        if (typeof element.getBoundingClientRect !== 'function') {
            return;
        }
        const layout = element.getBoundingClientRect();
        const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
        // 修复SSR报错：ERROR ReferenceError: window is not defined
        if (typeof window === 'undefined') {
            return;
        }
        if (layout.top < 0) {
            // 上边界溢出屏幕
            window.scrollTo(0, layout.top + scrollTop - 20);
        }
        else if (layout.bottom > document.documentElement.clientHeight) {
            // 下边界溢出屏幕
            window.scrollTo(0, scrollTop + layout.bottom + 20 - document.documentElement.clientHeight);
        }
    }
    /**
     * 创建intro实例
     */
    create(config) {
        let introRef; // create方法创建并返回的intro实例
        const steps = config.steps;
        let introModalRef; // modal实例，用于隐藏弹窗
        let introTipRef; // 是生成的tip，有show & hide
        let introMultiTipRefs = []; // 多个tip场景下生成的tip实例数组
        let curStep = 0; // 在整个create方法中，标识当前步数
        const lastStep = steps[steps.length - 1].step; // 最后一TiIntroStep的step属性值，即总步数
        // 关闭多个tip的操作元素
        const closeMultiTipEle = steps.filter((item) => item.isAction).length > 0 ?
            steps.filter((item) => item.isAction)[0].element : undefined;
        // 先隐藏closeMultiTipEle，并注册事件
        if (closeMultiTipEle) {
            this.render.setStyle(closeMultiTipEle, 'display', 'none');
        }
        this.unListenDocumentKeydown = this.render.listen(document, 'keydown', (event) => {
            switch (event.which) {
                case TiKeymap.KEY_TAB: // tab键用于处理在提示框内循环获取焦点
                    this.clickTab(event);
                    break;
                default:
                    break;
            }
        });
        /**
         * @param flag boolean true:完成intro引导；false：未完成intro引导，但是退出
         */
        const close = (flag) => {
            if (introMultiTipRefs.length > 0) {
                introMultiTipRefs.forEach((item) => {
                    this.hidePreStep(item);
                });
                introMultiTipRefs = [];
                this.render.setStyle(closeMultiTipEle, 'display', 'none');
            }
            else {
                this.hidePreStep(introTipRef);
            }
            this.destroyBackdrop();
            if (flag && typeof config.onFinish === 'function') {
                config.onFinish();
            }
            else if (!flag && typeof config.onExit === 'function') {
                config.onExit();
            }
            if (this.unListenWindowResize) {
                this.unListenWindowResize();
                this.unListenWindowResize = undefined;
            }
            if (this.unListenWindowHashchange) {
                this.unListenWindowHashchange();
                this.unListenWindowHashchange = undefined;
            }
            if (this.closeMultiTipEleClickListener) {
                this.closeMultiTipEleClickListener();
            }
            if (this.unListenDocumentKeydown) {
                this.unListenDocumentKeydown();
                this.unListenDocumentKeydown = undefined;
            }
        };
        /**
         * 无效步数条件：
         * 1.不是有效数字
         * 2.等于currentNumber，等于0除外
         * 3.小于0 或 大于 totalNumber
         * 使用curStep 和 lastStep，没有提为private方法
         */
        const isInvalidStepNum = (num) => {
            return isNaN(num) || (curStep === num && num !== 0) || num < 0 || num > lastStep;
        };
        /**
         * 即将进入某一步的引导
         *
         * 需要在进入前做一些合法性判断，清除上一步信息等
         */
        const wantStep = (num) => {
            if (isInvalidStepNum(num)) {
                TiLog.error('stepNumber is not valid');
                return;
            }
            this.hidePreStep(introTipRef);
            curStep = num;
            if (typeof config.beforeStep === 'function') {
                config.beforeStep(introRef, num);
            }
            else {
                // tslint:disable-next-line: no-use-before-declare
                goStep(num);
            }
            // 延时为了保证遮罩dom已经绘制完毕。
            setTimeout(() => {
                // 在引导的时候，把焦点调整为遮罩层。为后续把焦点圈在提示框内做准备。
                const backdropEle = document.querySelector('#ti3-intro-backdrop');
                if (backdropEle) {
                    backdropEle.focus();
                }
            }, 100);
        };
        // 开始某一步的引导
        const goStep = (num) => {
            const currentSteps = steps.filter((item) => item.step === num);
            // curIntroStep curIntroStep
            let currentStep;
            if (currentSteps.length === 1) {
                currentStep = currentSteps[0];
            }
            // 先关闭之前的canvas
            this.destroyBackdrop();
            /**
             * 具体的引导步骤分为3种
             * 1.总览页： 一个正常弹窗，用modal实现 intromodal
             * 2.分布页：带按钮的tip，用tipService实现
             * 3.提示： 没有按钮的普通tip，用tipService实现
             */
            // 第一种情况，弹窗
            if (currentStep && !currentStep.element) {
                introModalRef = this.modalService.open(TiIntromodalComponent, {
                    id: 'ti3-intro-modal',
                    context: {
                        title: currentStep.title,
                        content: currentStep.content,
                        totalNumber: lastStep,
                        currentNumber: curStep,
                        finishButtonText: config.finishButtonText,
                        id: config.id + '_' + num,
                        close: () => {
                            introModalRef.close();
                        },
                        wantStep
                    },
                    draggable: false
                });
                return;
            }
            // 如果有弹窗的话，关闭弹窗
            if (introModalRef) {
                introModalRef._remove();
                introModalRef = undefined;
            }
            // 重新绘制canvas
            this.drawBackdrop();
            // 第二种情况，带按钮的tip
            if (currentStep && currentStep.title) {
                TiIntroService.scrollToViewport(currentStep.element);
                introTipRef = this.tipService.create(currentStep.element, Object.assign(Object.assign({}, this.commonConfig), { position: currentStep.position, registerVisibilityChangeEvent: false }));
                introTipRef.show(TiIntrotipComponent, {
                    title: currentStep.title,
                    content: currentStep.content,
                    totalNumber: lastStep,
                    currentNumber: curStep,
                    finishButtonText: config.finishButtonText,
                    id: config.id + '_' + num,
                    close,
                    wantStep
                });
                this.highlight(currentStep.element, currentStep.shape);
            }
            // 第三种情况，普通tip，并且是多个，有一个是关闭按钮。和第二种情况是if else 的关系，重新列为一个if分支是为了让三种情况称为并列的if
            if (currentSteps && currentSteps.length > 1) {
                currentSteps.forEach((item) => {
                    if (item.isAction) {
                        this.render.setStyle(item.element, 'display', 'block');
                        this.closeMultiTipEleClickListener = this.render.listen(item.element, 'click', () => {
                            close(true);
                        });
                    }
                    else {
                        TiIntroService.scrollToViewport(item.element);
                        const introtipRef = this.tipService.create(item.element, Object.assign(Object.assign({}, this.commonConfig), { position: item.position, registerVisibilityChangeEvent: false }));
                        introtipRef.show(item.content);
                        introMultiTipRefs.push(introtipRef);
                        this.highlight(item.element, item.shape);
                    }
                });
            }
            // 修复SSR报错：ERROR ReferenceError: window is not defined
            if (!this.unListenWindowResize && typeof window !== 'undefined') {
                this.unListenWindowResize = this.render.listen(window, 'resize', () => {
                    this.hidePreStep(introTipRef);
                    this.destroyBackdrop();
                    goStep(curStep);
                });
            }
            if (!this.unListenWindowHashchange && typeof window !== 'undefined') {
                this.unListenWindowHashchange = this.render.listen(window, 'hashchange', () => {
                    close(false);
                });
            }
        };
        // 对外暴露的intro实例
        introRef = {
            start() {
                wantStep(0);
            },
            end() {
                close(true);
            },
            step: (number) => {
                wantStep(number);
            },
            proceed() {
                goStep(curStep);
            }
        };
        return introRef;
    }
    clickTab(event) {
        const introModal = document.querySelector('.ti3-intromodal-wrapper');
        const focusableElements = introModal === null || introModal === void 0 ? void 0 : introModal.querySelectorAll(this.focusableElementsString);
        Util.focusInDialogOnTabchange(event, focusableElements);
    }
    hidePreStep(introTipRef) {
        if (introTipRef) {
            introTipRef.hide();
        }
    }
    drawBackdrop() {
        // 修复SSR报错：
        /* ERROR Error: NotYetImplemented
        at HTMLCanvasElement.Wo4J.exports.nyi (D:\ngworkspace\tiny3-0119-2\ngversion\ng11-ssr\dist\tiny3demo\server\main.js:140019:9)
        at TiIntroService.drawBackdrop (D:\ngworkspace\tiny3-0119-2\ngversion\ng11-ssr\dist\tiny3demo\server\main.js:12914:28) */
        if (typeof document === 'undefined') {
            return;
        }
        const canvas = this.render.createElement('canvas');
        this.render.setStyle(canvas, 'z-index', 5000); // 最大的可取值为5000，5001会遮盖tip
        this.render.setStyle(canvas, 'position', 'absolute');
        this.render.setStyle(canvas, 'top', 0);
        this.render.setStyle(canvas, 'left', 0);
        this.render.setStyle(canvas, 'outline', 'none');
        this.render.setAttribute(canvas, 'tabindex', '0'); // 非表单元素想要使用focus()函数聚焦，需要设置tabindex属性。
        canvas.id = 'ti3-intro-backdrop';
        const ctx = canvas.getContext('2d');
        // _drawBackDrop(canvas, ctx) {
        // 获取整个页面宽高，用于计算canvas宽高
        // 获取整个页面的宽高,包括滚动条部分及body margin等
        let browserWidth = this.document.documentElement.scrollWidth;
        let browserHeight = this.document.documentElement.scrollHeight;
        // 获取整个页面可视区域宽高，页面不出滚动条情况下，该值原则上应该是与上述browser宽高相等的
        // 但是由于浏览器的计算差异，可能存在不相等的情况
        const clientWidth = this.document.documentElement.clientWidth;
        const clientHeight = this.document.documentElement.clientHeight;
        // 由于在IE下该宽高计算不精确，可能会导致页面本身无滚动条的情况下，
        // 当使用该值设置canvas宽度后，出现滚动条，因此需要对宽高进行特殊处理
        // 根据多次试验经验，发现当实际页面实际宽度为小数时，clientWidth取值为去掉小数点后的值，
        // scrollWidth则会自动+1，导致使用scrollWidth设置会出现滚动条，
        // 因此，通过两者之差小于1的方式判断该情况下，取小值设置canvas宽度即可解决该问题
        if (browserWidth - clientWidth <= 1) {
            browserWidth = clientWidth;
        }
        // 纵向情况下处理同上
        if (browserHeight - clientHeight <= 1) {
            browserHeight = clientHeight;
        }
        canvas.width = browserWidth;
        canvas.height = browserHeight;
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, browserWidth, browserHeight);
        this.render.appendChild(this.document.body, canvas);
    }
    highlight(element, shape) {
        const layout = Position.getHostEleLayout(element, element);
        const canvas = this.document.body.querySelector('#ti3-intro-backdrop');
        // 修复SSR报错：ERROR TypeError: Cannot read property 'getContext' of undefined
        if (!canvas) {
            return;
        }
        const ctx = canvas.getContext('2d');
        const highlightLayout = Object.assign({}, layout);
        if (layout.isFixed) {
            // 如果被高亮的元素是fixed定位，以元素相对于视口的位置为高亮区域的定位
            this.render.setStyle(canvas, 'position', 'fixed');
            highlightLayout.top = element.getBoundingClientRect().top;
            highlightLayout.left = element.getBoundingClientRect().left;
        }
        if (shape === 'circle') {
            const radius = (highlightLayout.width < highlightLayout.height ? highlightLayout.width : highlightLayout.height) / 2;
            const x = highlightLayout.left + highlightLayout.width / 2;
            const y = highlightLayout.top + highlightLayout.height / 2;
            TiIntroService.clearCircle(x, y, radius, 1, ctx);
        }
        else {
            ctx.clearRect(highlightLayout.left, highlightLayout.top, highlightLayout.width, highlightLayout.height);
        }
    }
}
TiIntroService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TiIntroService_Factory() { return new TiIntroService(i0.ɵɵinject(i1.TiTipService), i0.ɵɵinject(i2.TiModalService), i0.ɵɵinject(i0.RendererFactory2), i0.ɵɵinject(i3.DOCUMENT)); }, token: TiIntroService, providedIn: i4.TiIntroServiceModule });
TiIntroService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiIntroServiceModule
            },] }
];
TiIntroService.ctorParameters = () => [
    { type: TiTipService },
    { type: TiModalService },
    { type: RendererFactory2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlJbnRyb1NlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvc2VydmljZXMvaW50cm8vVGlJbnRyb1NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBYSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFbkQsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWhELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDOzs7Ozs7QUFHNUQ7Ozs7Ozs7OztHQVNHO0FBS0gsTUFBTSxPQUFPLGNBQWM7SUFXdkIsWUFDWSxVQUF3QixFQUN4QixZQUE0QixFQUNwQyxlQUFpQyxFQUNQLFFBQVE7UUFIMUIsZUFBVSxHQUFWLFVBQVUsQ0FBYztRQUN4QixpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFFVixhQUFRLEdBQVIsUUFBUSxDQUFBO1FBVHRDLFFBQVE7UUFDQSw0QkFBdUIsR0FBVzs7O3VGQUd5QyxDQUFDO1FBVXBGOztXQUVHO1FBQ0ssaUJBQVksR0FBUTtZQUN4QixPQUFPLEVBQUUsUUFBUTtZQUNqQixLQUFLLEVBQUUsT0FBTztZQUNkLFFBQVEsRUFBRSxPQUFPO1NBQ3BC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SSxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQ3BCLE1BQU0sTUFBTSxHQUFXLENBQUMsZUFBZSxDQUFDLEtBQUssR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdILE1BQU0sQ0FBQyxHQUFXLGVBQWUsQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDbkUsTUFBTSxDQUFDLEdBQVcsZUFBZSxDQUFDLEdBQUcsR0FBRyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNuRSxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUNwRDthQUFNO1lBQ0gsR0FBRyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLGVBQWUsQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLEtBQUssRUFBRSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDM0c7SUFDTCxDQUFDOzs7O1lBMVlKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsb0JBQW9CO2FBQ25DOzs7WUFyQlEsWUFBWTtZQURaLGNBQWM7WUFMUyxnQkFBZ0I7NENBNEN2QyxNQUFNLFNBQUMsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIFJlbmRlcmVyMiwgUmVuZGVyZXJGYWN0b3J5MiwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbmltcG9ydCB7IFRpSW50cm9TZXJ2aWNlTW9kdWxlIH0gZnJvbSAnLi9UaUludHJvTW9kdWxlJztcclxuaW1wb3J0IHsgVGlNb2RhbFJlZiB9IGZyb20gJy4uL21vZGFsL1RpTW9kYWxNb2R1bGUnO1xyXG5pbXBvcnQgeyBUaU1vZGFsU2VydmljZSB9IGZyb20gJy4uL21vZGFsL1RpTW9kYWxTZXJ2aWNlJztcclxuaW1wb3J0IHsgVGlUaXBTZXJ2aWNlIH0gZnJvbSAnLi4vdGlwL1RpVGlwU2VydmljZSc7XHJcbmltcG9ydCB7IFRpVGlwUmVmIH0gZnJvbSAnLi4vdGlwL1RpVGlwSW50ZXJmYWNlJztcclxuaW1wb3J0IHsgVGlMb2csIFRpS2V5bWFwLCBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vdXRpbHMvUG9zaXRpb24nO1xyXG5cclxuaW1wb3J0IHsgVGlJbnRyb21vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi9UaUludHJvbW9kYWxDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBUaUludHJvdGlwQ29tcG9uZW50IH0gZnJvbSAnLi9UaUludHJvdGlwQ29tcG9uZW50JztcclxuaW1wb3J0IHsgVGlJbnRyb0NvbmZpZywgVGlJbnRyb1JlZiwgVGlJbnRyb1NoYXBlLCBUaUludHJvU3RlcCB9IGZyb20gJy4vVGlJbnRyb0ludGVyZmFjZSc7XHJcblxyXG4vKipcclxuICog5paw5omL5byV5a+857uE5Lu277yM6YCC55So5LqO5pyN5Yqh5Lit5YaF5a6577yI5YWl5Y+j77yJ5paw5aKe5ZKM5Y+Y5Yqo562J5oyH5byV5o+Q6YaSXHJcbiAqXHJcbiAqIDxwPjxzcGFuIHN0eWxlPVwiY29sb3I6IHJlZFwiPuS9v+eUqOatpOe7hOS7tuaXtumcgOimgeW8gOWPkeiAheWcqOmhueebruaooeWdlyjlu7rorq7lnKjmoLnmqKHlnZcp5Lit5byV5YWlQnJvd3NlckFuaW1hdGlvbnNNb2R1bGXjgII8L3NwYW4+XHJcbiAqIOi/meaYr+WboOS4uuatpOe7hOS7tuS4reS9v+eUqOS6hiBUaU1vZGFsU2VydmljZe+8jFRpTW9kYWxTZXJ2aWNl6ZyA6KaBQnJvd3NlckFuaW1hdGlvbnNNb2R1bGVcclxuICog77yI5YW35L2T5Y6f5Zug5Y+v5Lul5p+l55yLIFtUaU1vZGFsU2VydmljZV17QGxpbmsgLi4vaW5qZWN0YWJsZXMvVGlNb2RhbFNlcnZpY2UuaHRtbH3vvInvvIxcclxuICog5L2G5pivIEJyb3dzZXJBbmltYXRpb25zTW9kdWxlIOS4jeiDveWcqOaHkuWKoOi9veaooeWdl+iiq+mHjeWkjeW8leWFpe+8jOaJgOS7pemcgOimgeW8gOWPkeiAheadpeW8leWFpUJyb3dzZXJBbmltYXRpb25zTW9kdWxl77yM5L+d6K+B5YW25byV5YWl5LiA5qyh44CCPC9wPlxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueTNkZW1vLyMvaW50cm8vaW50cm8tYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46IFRpSW50cm9TZXJ2aWNlTW9kdWxlXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgVGlJbnRyb1NlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMjtcclxuICAgIHByaXZhdGUgdW5MaXN0ZW5XaW5kb3dSZXNpemU6ICgpID0+IHZvaWQ7XHJcbiAgICBwcml2YXRlIHVuTGlzdGVuV2luZG93SGFzaGNoYW5nZTogKCkgPT4gdm9pZDtcclxuICAgIHByaXZhdGUgY2xvc2VNdWx0aVRpcEVsZUNsaWNrTGlzdGVuZXI6ICgpID0+IHZvaWQ7XHJcbiAgICBwcml2YXRlIHVuTGlzdGVuRG9jdW1lbnRLZXlkb3duOiAoKSA9PiB2b2lkO1xyXG4gICAgLy8g5Y+v6IGa54Sm5YWD57SgXHJcbiAgICBwcml2YXRlIGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nOiBzdHJpbmcgPSBgYVtocmVmXSwgYXJlYVtocmVmXSwgaW5wdXQ6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9XFwnLTFcXCddKSxcclxuICAgIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLHNlbGVjdDpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLFxyXG4gICAgdGV4dGFyZWE6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9XFwnLTFcXCddKSxcclxuICAgIGlmcmFtZSwgb2JqZWN0LCBlbWJlZCwgKlt0YWJpbmRleF06bm90KFt0YWJpbmRleD1cXCctMVxcJ10pLCAqW2NvbnRlbnRlZGl0YWJsZT10cnVlXWA7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHRpcFNlcnZpY2U6IFRpVGlwU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogVGlNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcmVuZGVyZXJGYWN0b3J5OiBSZW5kZXJlckZhY3RvcnkyLFxyXG4gICAgICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgZG9jdW1lbnQpIHtcclxuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1udWxsLWtleXdvcmQgKi9cclxuICAgICAgICB0aGlzLnJlbmRlciA9IHJlbmRlcmVyRmFjdG9yeS5jcmVhdGVSZW5kZXJlcihudWxsLCBudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGludHJv55qE5YWs5YWx6YWN572u77yM5LiN5piv6buY6K6k6YWN572u77yM5LiN6IO95L+u5pS5XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY29tbW9uQ29uZmlnOiBhbnkgPSB7XHJcbiAgICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXHJcbiAgICAgICAgdGhlbWU6ICd3aGl0ZScsXHJcbiAgICAgICAgbWF4V2lkdGg6ICc0MDBweCdcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBkZXN0cm95QmFja2Ryb3AoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgY2FudmFzOiBhbnkgPSB0aGlzLmRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcignI3RpMy1pbnRyby1iYWNrZHJvcCcpO1xyXG5cclxuICAgICAgICBpZiAoY2FudmFzKSB7XHJcbiAgICAgICAgICAgIC8vIGNhbnZhcy5yZW1vdmUoKSBJReaKpemUme+8m2NhbnZhcy5yZW1vdmVOb2RlKCkgQ2hyb21l5oql6ZSZ77yb5Y+v5Lul5L2/55SocmVtb3ZlQ2hpbGTmlrnms5VcclxuICAgICAgICAgICAgY2FudmFzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY2FudmFzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgY2xlYXJDaXJjbGUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1czogbnVtYmVyLCBzdGVwQ2xlYXI6IG51bWJlciwgY3R4OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjYWxjV2lkdGg6IG51bWJlciA9IHJhZGl1cyAtIHN0ZXBDbGVhcjtcclxuICAgICAgICBjb25zdCBjYWxjSGVpZ2h0OiBudW1iZXIgPSBNYXRoLnNxcnQocmFkaXVzICogcmFkaXVzIC0gY2FsY1dpZHRoICogY2FsY1dpZHRoKTtcclxuXHJcbiAgICAgICAgY29uc3QgcG9zWDogbnVtYmVyID0geCAtIGNhbGNXaWR0aDtcclxuICAgICAgICBjb25zdCBwb3NZOiBudW1iZXIgPSB5IC0gY2FsY0hlaWdodDtcclxuXHJcbiAgICAgICAgY29uc3Qgd2lkdGhYOiBudW1iZXIgPSBjYWxjV2lkdGggKiAyO1xyXG4gICAgICAgIGNvbnN0IGhlaWdodFk6IG51bWJlciA9IGNhbGNIZWlnaHQgKiAyO1xyXG5cclxuICAgICAgICBpZiAoc3RlcENsZWFyIDwgcmFkaXVzKSB7XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QocG9zWCwgcG9zWSwgd2lkdGhYLCBoZWlnaHRZKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3U3RlcENsZWFyOiBudW1iZXIgPSBzdGVwQ2xlYXIgKyAxO1xyXG4gICAgICAgICAgICBUaUludHJvU2VydmljZS5jbGVhckNpcmNsZSh4LCB5LCByYWRpdXMsIG5ld1N0ZXBDbGVhciwgY3R4KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2Nyb2xsVG9WaWV3cG9ydChlbGVtZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICAvLyDkv67lpI1TU1LplJnor6/vvJpFUlJPUiBUeXBlRXJyb3I6IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIG5vdCBhIGZ1bmN0aW9uXHJcbiAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGxheW91dDogYW55ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsVG9wOiBudW1iZXIgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgIC8vIOS/ruWkjVNTUuaKpemUme+8mkVSUk9SIFJlZmVyZW5jZUVycm9yOiB3aW5kb3cgaXMgbm90IGRlZmluZWRcclxuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGF5b3V0LnRvcCA8IDApIHtcclxuICAgICAgICAgICAgLy8g5LiK6L6555WM5rqi5Ye65bGP5bmVXHJcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBsYXlvdXQudG9wICsgc2Nyb2xsVG9wIC0gMjApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobGF5b3V0LmJvdHRvbSA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIHtcclxuICAgICAgICAgICAgLy8g5LiL6L6555WM5rqi5Ye65bGP5bmVXHJcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBzY3JvbGxUb3AgKyBsYXlvdXQuYm90dG9tICsgMjAgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7ppbnRyb+WunuS+i1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY3JlYXRlKGNvbmZpZzogVGlJbnRyb0NvbmZpZyk6IFRpSW50cm9SZWYge1xyXG4gICAgICAgIGxldCBpbnRyb1JlZjogVGlJbnRyb1JlZjsgLy8gY3JlYXRl5pa55rOV5Yib5bu65bm26L+U5Zue55qEaW50cm/lrp7kvotcclxuICAgICAgICBjb25zdCBzdGVwczogQXJyYXk8VGlJbnRyb1N0ZXA+ID0gY29uZmlnLnN0ZXBzO1xyXG4gICAgICAgIGxldCBpbnRyb01vZGFsUmVmOiBUaU1vZGFsUmVmOyAvLyBtb2RhbOWunuS+i++8jOeUqOS6jumakOiXj+W8ueeql1xyXG4gICAgICAgIGxldCBpbnRyb1RpcFJlZjogVGlUaXBSZWY7IC8vIOaYr+eUn+aIkOeahHRpcO+8jOaciXNob3cgJiBoaWRlXHJcbiAgICAgICAgbGV0IGludHJvTXVsdGlUaXBSZWZzOiBBcnJheTxUaVRpcFJlZj4gPSBbXTsgLy8g5aSa5LiqdGlw5Zy65pmv5LiL55Sf5oiQ55qEdGlw5a6e5L6L5pWw57uEXHJcbiAgICAgICAgbGV0IGN1clN0ZXA6IG51bWJlciA9IDA7IC8vIOWcqOaVtOS4qmNyZWF0ZeaWueazleS4re+8jOagh+ivhuW9k+WJjeatpeaVsFxyXG4gICAgICAgIGNvbnN0IGxhc3RTdGVwOiBudW1iZXIgPSBzdGVwc1tzdGVwcy5sZW5ndGggLSAxIF0uc3RlcDsgLy8g5pyA5ZCO5LiAVGlJbnRyb1N0ZXDnmoRzdGVw5bGe5oCn5YC877yM5Y2z5oC75q2l5pWwXHJcbiAgICAgICAgLy8g5YWz6Zet5aSa5LiqdGlw55qE5pON5L2c5YWD57SgXHJcbiAgICAgICAgY29uc3QgY2xvc2VNdWx0aVRpcEVsZTogRWxlbWVudCA9IHN0ZXBzLmZpbHRlcigoaXRlbTogVGlJbnRyb1N0ZXApID0+IGl0ZW0uaXNBY3Rpb24pLmxlbmd0aCA+IDAgP1xyXG4gICAgICAgICAgICBzdGVwcy5maWx0ZXIoKGl0ZW06IFRpSW50cm9TdGVwKSA9PiBpdGVtLmlzQWN0aW9uKVswXS5lbGVtZW50IDogdW5kZWZpbmVkO1xyXG4gICAgICAgIC8vIOWFiOmakOiXj2Nsb3NlTXVsdGlUaXBFbGXvvIzlubbms6jlhozkuovku7ZcclxuICAgICAgICBpZiAoY2xvc2VNdWx0aVRpcEVsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShjbG9zZU11bHRpVGlwRWxlLCAnZGlzcGxheScsICdub25lJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudW5MaXN0ZW5Eb2N1bWVudEtleWRvd24gPSB0aGlzLnJlbmRlci5saXN0ZW4oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQud2hpY2gpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgVGlLZXltYXAuS0VZX1RBQjogLy8gdGFi6ZSu55So5LqO5aSE55CG5Zyo5o+Q56S65qGG5YaF5b6q546v6I635Y+W54Sm54K5XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGlja1RhYihldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwYXJhbSBmbGFnIGJvb2xlYW4gdHJ1ZTrlrozmiJBpbnRyb+W8leWvvO+8m2ZhbHNl77ya5pyq5a6M5oiQaW50cm/lvJXlr7zvvIzkvYbmmK/pgIDlh7pcclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25zdCBjbG9zZTogKGZsYWc6IGJvb2xlYW4pID0+IHZvaWQgPSAoZmxhZzogYm9vbGVhbik6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaW50cm9NdWx0aVRpcFJlZnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaW50cm9NdWx0aVRpcFJlZnMuZm9yRWFjaCgoaXRlbTogVGlUaXBSZWYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVQcmVTdGVwKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpbnRyb011bHRpVGlwUmVmcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY2xvc2VNdWx0aVRpcEVsZSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlUHJlU3RlcChpbnRyb1RpcFJlZik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveUJhY2tkcm9wKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZmxhZyAmJiB0eXBlb2YgY29uZmlnLm9uRmluaXNoID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcub25GaW5pc2goKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghZmxhZyAmJiB0eXBlb2YgY29uZmlnLm9uRXhpdCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLm9uRXhpdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVuTGlzdGVuV2luZG93UmVzaXplKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuTGlzdGVuV2luZG93UmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuTGlzdGVuV2luZG93UmVzaXplID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVuTGlzdGVuV2luZG93SGFzaGNoYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51bkxpc3RlbldpbmRvd0hhc2hjaGFuZ2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5MaXN0ZW5XaW5kb3dIYXNoY2hhbmdlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNsb3NlTXVsdGlUaXBFbGVDbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTXVsdGlUaXBFbGVDbGlja0xpc3RlbmVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMudW5MaXN0ZW5Eb2N1bWVudEtleWRvd24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5MaXN0ZW5Eb2N1bWVudEtleWRvd24oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5MaXN0ZW5Eb2N1bWVudEtleWRvd24gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDml6DmlYjmraXmlbDmnaHku7bvvJpcclxuICAgICAgICAgKiAxLuS4jeaYr+acieaViOaVsOWtl1xyXG4gICAgICAgICAqIDIu562J5LqOY3VycmVudE51bWJlcu+8jOetieS6jjDpmaTlpJZcclxuICAgICAgICAgKiAzLuWwj+S6jjAg5oiWIOWkp+S6jiB0b3RhbE51bWJlclxyXG4gICAgICAgICAqIOS9v+eUqGN1clN0ZXAg5ZKMIGxhc3RTdGVw77yM5rKh5pyJ5o+Q5Li6cHJpdmF0ZeaWueazlVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnN0IGlzSW52YWxpZFN0ZXBOdW06IChudW1iZXI6IG51bWJlcikgPT4gYm9vbGVhbiA9IChudW06IG51bWJlcik6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaXNOYU4obnVtKSB8fCAoY3VyU3RlcCA9PT0gbnVtICYmIG51bSAhPT0gMCkgfHwgbnVtIDwgMCB8fCBudW0gPiBsYXN0U3RlcDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOWNs+Wwhui/m+WFpeafkOS4gOatpeeahOW8leWvvFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICog6ZyA6KaB5Zyo6L+b5YWl5YmN5YGa5LiA5Lqb5ZCI5rOV5oCn5Yik5pat77yM5riF6Zmk5LiK5LiA5q2l5L+h5oGv562JXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3Qgd2FudFN0ZXA6IChudW1iZXI6IG51bWJlcikgPT4gdm9pZCA9IChudW06IG51bWJlcik6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNJbnZhbGlkU3RlcE51bShudW0pKSB7XHJcbiAgICAgICAgICAgICAgICBUaUxvZy5lcnJvcignc3RlcE51bWJlciBpcyBub3QgdmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5oaWRlUHJlU3RlcChpbnRyb1RpcFJlZik7XHJcbiAgICAgICAgICAgIGN1clN0ZXAgPSBudW07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnLmJlZm9yZVN0ZXAgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5iZWZvcmVTdGVwKGludHJvUmVmLCBudW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby11c2UtYmVmb3JlLWRlY2xhcmVcclxuICAgICAgICAgICAgICAgIGdvU3RlcChudW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOW7tuaXtuS4uuS6huS/neivgemBrue9qWRvbeW3sue7j+e7mOWItuWujOavleOAglxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOWcqOW8leWvvOeahOaXtuWAme+8jOaKiueEpueCueiwg+aVtOS4uumBrue9qeWxguOAguS4uuWQjue7reaKiueEpueCueWciOWcqOaPkOekuuahhuWGheWBmuWHhuWkh+OAglxyXG4gICAgICAgICAgICAgICAgY29uc3QgYmFja2Ryb3BFbGU6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RpMy1pbnRyby1iYWNrZHJvcCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJhY2tkcm9wRWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3BFbGUuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDlvIDlp4vmn5DkuIDmraXnmoTlvJXlr7xcclxuICAgICAgICBjb25zdCBnb1N0ZXA6IChudW1iZXI6IG51bWJlcikgPT4gdm9pZCA9IChudW06IG51bWJlcik6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U3RlcHM6IEFycmF5PFRpSW50cm9TdGVwPiA9ICBzdGVwcy5maWx0ZXIoKGl0ZW06IFRpSW50cm9TdGVwKSA9PiBpdGVtLnN0ZXAgPT09IG51bSk7XHJcbiAgICAgICAgICAgIC8vIGN1ckludHJvU3RlcCBjdXJJbnRyb1N0ZXBcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRTdGVwOiBUaUludHJvU3RlcDtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGVwcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRTdGVwID0gY3VycmVudFN0ZXBzWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOWFiOWFs+mXreS5i+WJjeeahGNhbnZhc1xyXG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lCYWNrZHJvcCgpO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5YW35L2T55qE5byV5a+85q2l6aqk5YiG5Li6M+enjVxyXG4gICAgICAgICAgICAgKiAxLuaAu+iniOmhte+8miDkuIDkuKrmraPluLjlvLnnqpfvvIznlKhtb2RhbOWunueOsCBpbnRyb21vZGFsXHJcbiAgICAgICAgICAgICAqIDIu5YiG5biD6aG177ya5bim5oyJ6ZKu55qEdGlw77yM55SodGlwU2VydmljZeWunueOsFxyXG4gICAgICAgICAgICAgKiAzLuaPkOekuu+8miDmsqHmnInmjInpkq7nmoTmma7pgJp0aXDvvIznlKh0aXBTZXJ2aWNl5a6e546wXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAvLyDnrKzkuIDnp43mg4XlhrXvvIzlvLnnqpdcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGVwICYmICFjdXJyZW50U3RlcC5lbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpbnRyb01vZGFsUmVmID0gdGhpcy5tb2RhbFNlcnZpY2Uub3BlbihUaUludHJvbW9kYWxDb21wb25lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ3RpMy1pbnRyby1tb2RhbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3VycmVudFN0ZXAudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGN1cnJlbnRTdGVwLmNvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTnVtYmVyOiBsYXN0U3RlcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE51bWJlcjogY3VyU3RlcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQnV0dG9uVGV4dDogY29uZmlnLmZpbmlzaEJ1dHRvblRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb25maWcuaWQgKyAnXycgKyBudW0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlOiAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRyb01vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbnRTdGVwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5aaC5p6c5pyJ5by556qX55qE6K+d77yM5YWz6Zet5by556qXXHJcbiAgICAgICAgICAgIGlmIChpbnRyb01vZGFsUmVmKSB7XHJcbiAgICAgICAgICAgICAgICBpbnRyb01vZGFsUmVmLl9yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIGludHJvTW9kYWxSZWYgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g6YeN5paw57uY5Yi2Y2FudmFzXHJcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhY2tkcm9wKCk7XHJcblxyXG4gICAgICAgICAgICAvLyDnrKzkuoznp43mg4XlhrXvvIzluKbmjInpkq7nmoR0aXBcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGVwICYmIGN1cnJlbnRTdGVwLnRpdGxlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgVGlJbnRyb1NlcnZpY2Uuc2Nyb2xsVG9WaWV3cG9ydChjdXJyZW50U3RlcC5lbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGludHJvVGlwUmVmID0gdGhpcy50aXBTZXJ2aWNlLmNyZWF0ZShjdXJyZW50U3RlcC5lbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25Db25maWcsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGN1cnJlbnRTdGVwLnBvc2l0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyVmlzaWJpbGl0eUNoYW5nZUV2ZW50OiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpbnRyb1RpcFJlZi5zaG93KFRpSW50cm90aXBDb21wb25lbnQsIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3VycmVudFN0ZXAudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY3VycmVudFN0ZXAuY29udGVudCxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbE51bWJlcjogbGFzdFN0ZXAsXHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudE51bWJlcjogY3VyU3RlcCxcclxuICAgICAgICAgICAgICAgICAgICBmaW5pc2hCdXR0b25UZXh0OiBjb25maWcuZmluaXNoQnV0dG9uVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBpZDogY29uZmlnLmlkICsgJ18nICsgbnVtLFxyXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlLFxyXG4gICAgICAgICAgICAgICAgICAgIHdhbnRTdGVwXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodChjdXJyZW50U3RlcC5lbGVtZW50LCBjdXJyZW50U3RlcC5zaGFwZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOesrOS4ieenjeaDheWGte+8jOaZrumAmnRpcO+8jOW5tuS4lOaYr+WkmuS4qu+8jOacieS4gOS4quaYr+WFs+mXreaMiemSruOAguWSjOesrOS6jOenjeaDheWGteaYr2lmIGVsc2Ug55qE5YWz57O777yM6YeN5paw5YiX5Li65LiA5LiqaWbliIbmlK/mmK/kuLrkuoborqnkuInnp43mg4XlhrXnp7DkuLrlubbliJfnmoRpZlxyXG4gICAgICAgICAgICBpZiAoY3VycmVudFN0ZXBzICYmIGN1cnJlbnRTdGVwcy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50U3RlcHMuZm9yRWFjaCgoaXRlbTogVGlJbnRyb1N0ZXApOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc0FjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShpdGVtLmVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VNdWx0aVRpcEVsZUNsaWNrTGlzdGVuZXIgPSB0aGlzLnJlbmRlci5saXN0ZW4oaXRlbS5lbGVtZW50LCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVGlJbnRyb1NlcnZpY2Uuc2Nyb2xsVG9WaWV3cG9ydChpdGVtLmVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnRyb3RpcFJlZjogVGlUaXBSZWYgPSB0aGlzLnRpcFNlcnZpY2UuY3JlYXRlKGl0ZW0uZWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25Db25maWcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogaXRlbS5wb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyVmlzaWJpbGl0eUNoYW5nZUV2ZW50OiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50cm90aXBSZWYuc2hvdyhpdGVtLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRyb011bHRpVGlwUmVmcy5wdXNoKGludHJvdGlwUmVmKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0KGl0ZW0uZWxlbWVudCwgaXRlbS5zaGFwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5L+u5aSNU1NS5oql6ZSZ77yaRVJST1IgUmVmZXJlbmNlRXJyb3I6IHdpbmRvdyBpcyBub3QgZGVmaW5lZFxyXG4gICAgICAgICAgICBpZiAoIXRoaXMudW5MaXN0ZW5XaW5kb3dSZXNpemUgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5MaXN0ZW5XaW5kb3dSZXNpemUgPSB0aGlzLnJlbmRlci5saXN0ZW4od2luZG93LCAncmVzaXplJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZVByZVN0ZXAoaW50cm9UaXBSZWYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVzdHJveUJhY2tkcm9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ29TdGVwKGN1clN0ZXApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCF0aGlzLnVuTGlzdGVuV2luZG93SGFzaGNoYW5nZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51bkxpc3RlbldpbmRvd0hhc2hjaGFuZ2UgPSB0aGlzLnJlbmRlci5saXN0ZW4od2luZG93LCAnaGFzaGNoYW5nZScsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjbG9zZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOWvueWkluaatOmcsueahGludHJv5a6e5L6LXHJcbiAgICAgICAgaW50cm9SZWYgPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0KCk6IHZvaWQge1xyXG4gICAgICAgICAgICAgICAgd2FudFN0ZXAoMCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVuZCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgICAgIGNsb3NlKHRydWUpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdGVwOiAobnVtYmVyOiBudW1iZXIpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIHdhbnRTdGVwKG51bWJlcik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHByb2NlZWQoKTogdm9pZCB7XHJcbiAgICAgICAgICAgICAgICBnb1N0ZXAoY3VyU3RlcCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGludHJvUmVmO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGlja1RhYihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGludHJvTW9kYWw6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpMy1pbnRyb21vZGFsLXdyYXBwZXInKTtcclxuICAgICAgICBjb25zdCBmb2N1c2FibGVFbGVtZW50czogTm9kZUxpc3QgPSBpbnRyb01vZGFsPy5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcpO1xyXG5cclxuICAgICAgICBVdGlsLmZvY3VzSW5EaWFsb2dPblRhYmNoYW5nZShldmVudCwgZm9jdXNhYmxlRWxlbWVudHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaGlkZVByZVN0ZXAoaW50cm9UaXBSZWY6IFRpVGlwUmVmKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGludHJvVGlwUmVmKSB7XHJcbiAgICAgICAgICAgIGludHJvVGlwUmVmLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3QmFja2Ryb3AoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5L+u5aSNU1NS5oql6ZSZ77yaXHJcblxyXG4gICAgICAgIC8qIEVSUk9SIEVycm9yOiBOb3RZZXRJbXBsZW1lbnRlZFxyXG4gICAgICAgIGF0IEhUTUxDYW52YXNFbGVtZW50LldvNEouZXhwb3J0cy5ueWkgKEQ6XFxuZ3dvcmtzcGFjZVxcdGlueTMtMDExOS0yXFxuZ3ZlcnNpb25cXG5nMTEtc3NyXFxkaXN0XFx0aW55M2RlbW9cXHNlcnZlclxcbWFpbi5qczoxNDAwMTk6OSlcclxuICAgICAgICBhdCBUaUludHJvU2VydmljZS5kcmF3QmFja2Ryb3AgKEQ6XFxuZ3dvcmtzcGFjZVxcdGlueTMtMDExOS0yXFxuZ3ZlcnNpb25cXG5nMTEtc3NyXFxkaXN0XFx0aW55M2RlbW9cXHNlcnZlclxcbWFpbi5qczoxMjkxNDoyOCkgKi9cclxuICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNhbnZhczogYW55ID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY2FudmFzLCAnei1pbmRleCcsIDUwMDApOyAvLyDmnIDlpKfnmoTlj6/lj5blgLzkuLo1MDAw77yMNTAwMeS8mumBrueblnRpcFxyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGNhbnZhcywgJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY2FudmFzLCAndG9wJywgMCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY2FudmFzLCAnbGVmdCcsIDApO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKGNhbnZhcywgJ291dGxpbmUnLCAnbm9uZScpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldEF0dHJpYnV0ZShjYW52YXMsICd0YWJpbmRleCcsICcwJyk7IC8vIOmdnuihqOWNleWFg+e0oOaDs+imgeS9v+eUqGZvY3VzKCnlh73mlbDogZrnhKbvvIzpnIDopoHorr7nva50YWJpbmRleOWxnuaAp+OAglxyXG4gICAgICAgIGNhbnZhcy5pZCA9ICd0aTMtaW50cm8tYmFja2Ryb3AnO1xyXG4gICAgICAgIGNvbnN0IGN0eDogYW55ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgLy8gX2RyYXdCYWNrRHJvcChjYW52YXMsIGN0eCkge1xyXG4gICAgICAgIC8vIOiOt+WPluaVtOS4qumhtemdouWuvemrmO+8jOeUqOS6juiuoeeul2NhbnZhc+WuvemrmFxyXG4gICAgICAgIC8vIOiOt+WPluaVtOS4qumhtemdoueahOWuvemrmCzljIXmi6zmu5rliqjmnaHpg6jliIblj4pib2R5IG1hcmdpbuetiVxyXG4gICAgICAgIGxldCBicm93c2VyV2lkdGg6IG51bWJlciA9IHRoaXMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoO1xyXG4gICAgICAgIGxldCBicm93c2VySGVpZ2h0OiBudW1iZXIgPSB0aGlzLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQ7XHJcbiAgICAgICAgLy8g6I635Y+W5pW05Liq6aG16Z2i5Y+v6KeG5Yy65Z+f5a696auY77yM6aG16Z2i5LiN5Ye65rua5Yqo5p2h5oOF5Ya15LiL77yM6K+l5YC85Y6f5YiZ5LiK5bqU6K+l5piv5LiO5LiK6L+wYnJvd3NlcuWuvemrmOebuOetieeahFxyXG4gICAgICAgIC8vIOS9huaYr+eUseS6jua1j+iniOWZqOeahOiuoeeul+W3ruW8gu+8jOWPr+iDveWtmOWcqOS4jeebuOetieeahOaDheWGtVxyXG4gICAgICAgIGNvbnN0IGNsaWVudFdpZHRoOiBudW1iZXIgPSB0aGlzLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICBjb25zdCBjbGllbnRIZWlnaHQ6IG51bWJlciA9IHRoaXMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcclxuXHJcbiAgICAgICAgLy8g55Sx5LqO5ZyoSUXkuIvor6Xlrr3pq5jorqHnrpfkuI3nsr7noa7vvIzlj6/og73kvJrlr7zoh7TpobXpnaLmnKzouqvml6Dmu5rliqjmnaHnmoTmg4XlhrXkuIvvvIxcclxuICAgICAgICAvLyDlvZPkvb/nlKjor6XlgLzorr7nva5jYW52YXPlrr3luqblkI7vvIzlh7rnjrDmu5rliqjmnaHvvIzlm6DmraTpnIDopoHlr7nlrr3pq5jov5vooYznibnmrorlpITnkIZcclxuICAgICAgICAvLyDmoLnmja7lpJrmrKHor5Xpqoznu4/pqozvvIzlj5HnjrDlvZPlrp7pmYXpobXpnaLlrp7pmYXlrr3luqbkuLrlsI/mlbDml7bvvIxjbGllbnRXaWR0aOWPluWAvOS4uuWOu+aOieWwj+aVsOeCueWQjueahOWAvO+8jFxyXG4gICAgICAgIC8vIHNjcm9sbFdpZHRo5YiZ5Lya6Ieq5YqoKzHvvIzlr7zoh7Tkvb/nlKhzY3JvbGxXaWR0aOiuvue9ruS8muWHuueOsOa7muWKqOadoe+8jFxyXG4gICAgICAgIC8vIOWboOatpO+8jOmAmui/h+S4pOiAheS5i+W3ruWwj+S6jjHnmoTmlrnlvI/liKTmlq3or6Xmg4XlhrXkuIvvvIzlj5blsI/lgLzorr7nva5jYW52YXPlrr3luqbljbPlj6/op6PlhrPor6Xpl67pophcclxuICAgICAgICBpZiAoYnJvd3NlcldpZHRoIC0gY2xpZW50V2lkdGggPD0gMSkge1xyXG4gICAgICAgICAgICBicm93c2VyV2lkdGggPSBjbGllbnRXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g57q15ZCR5oOF5Ya15LiL5aSE55CG5ZCM5LiKXHJcbiAgICAgICAgaWYgKGJyb3dzZXJIZWlnaHQgLSBjbGllbnRIZWlnaHQgPD0gMSkge1xyXG4gICAgICAgICAgICBicm93c2VySGVpZ2h0ID0gY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gYnJvd3NlcldpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBicm93c2VySGVpZ2h0O1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAwLCAwLCAwLjIpJztcclxuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgYnJvd3NlcldpZHRoLCBicm93c2VySGVpZ2h0KTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGhpcy5kb2N1bWVudC5ib2R5LCBjYW52YXMpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBoaWdobGlnaHQoZWxlbWVudDogYW55LCBzaGFwZTogVGlJbnRyb1NoYXBlKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgbGF5b3V0OiBhbnkgPSBQb3NpdGlvbi5nZXRIb3N0RWxlTGF5b3V0KGVsZW1lbnQsIGVsZW1lbnQpO1xyXG4gICAgICAgIGNvbnN0IGNhbnZhczogYW55ID0gdGhpcy5kb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJyN0aTMtaW50cm8tYmFja2Ryb3AnKTtcclxuICAgICAgICAvLyDkv67lpI1TU1LmiqXplJnvvJpFUlJPUiBUeXBlRXJyb3I6IENhbm5vdCByZWFkIHByb3BlcnR5ICdnZXRDb250ZXh0JyBvZiB1bmRlZmluZWRcclxuICAgICAgICBpZiAoIWNhbnZhcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGN0eDogYW55ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgY29uc3QgaGlnaGxpZ2h0TGF5b3V0OiBhbnkgPSB7Li4ubGF5b3V0fTtcclxuICAgICAgICBpZiAobGF5b3V0LmlzRml4ZWQpIHtcclxuICAgICAgICAgICAgLy8g5aaC5p6c6KKr6auY5Lqu55qE5YWD57Sg5pivZml4ZWTlrprkvY3vvIzku6XlhYPntKDnm7jlr7nkuo7op4blj6PnmoTkvY3nva7kuLrpq5jkuq7ljLrln5/nmoTlrprkvY1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUoY2FudmFzLCAncG9zaXRpb24nLCAnZml4ZWQnKTtcclxuICAgICAgICAgICAgaGlnaGxpZ2h0TGF5b3V0LnRvcCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xyXG4gICAgICAgICAgICBoaWdobGlnaHRMYXlvdXQubGVmdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNoYXBlID09PSAnY2lyY2xlJykge1xyXG4gICAgICAgICAgICBjb25zdCByYWRpdXM6IG51bWJlciA9IChoaWdobGlnaHRMYXlvdXQud2lkdGggPCBoaWdobGlnaHRMYXlvdXQuaGVpZ2h0ID8gaGlnaGxpZ2h0TGF5b3V0LndpZHRoIDogaGlnaGxpZ2h0TGF5b3V0LmhlaWdodCkgLyAyO1xyXG4gICAgICAgICAgICBjb25zdCB4OiBudW1iZXIgPSBoaWdobGlnaHRMYXlvdXQubGVmdCArIGhpZ2hsaWdodExheW91dC53aWR0aCAvIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IHk6IG51bWJlciA9IGhpZ2hsaWdodExheW91dC50b3AgKyBoaWdobGlnaHRMYXlvdXQuaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgVGlJbnRyb1NlcnZpY2UuY2xlYXJDaXJjbGUoeCwgeSwgcmFkaXVzLCAxLCBjdHgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoaGlnaGxpZ2h0TGF5b3V0LmxlZnQsIGhpZ2hsaWdodExheW91dC50b3AsIGhpZ2hsaWdodExheW91dC53aWR0aCwgaGlnaGxpZ2h0TGF5b3V0LmhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=