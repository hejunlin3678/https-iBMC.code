import { Util } from '../../utils/Util';
// 上传文件服务，提供上传过程中的通用方法
/**
 * @ignore
 */
export class TiUploadUtil {
    /**
     * 上传多个文件
     * 上传一个或多个文件item对象
     * 无
     */
    static uploadItems(items) {
        // 异常处理 1.入参不合法,2.正在上传的文件不允许重复上传
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i]) || items[i].isUploading) {
                items.splice(i, 1);
            }
        }
        TiUploadUtil.onBeforeSend(items); // 文件上传前处理
        for (let j = items.length - 1; j >= 0; j--) {
            if (items[j].isCancel) { // 已取消上传的文件不再上传(此处主要是对beforeSend中取消上传的文件进行处理)
                items.splice(j, 1);
            }
        }
        if (items.length > 0) {
            TiUploadUtil.isHTML5 ? TiUploadUtil.uploadXhr(items) : TiUploadUtil.uploadForm(items);
        }
    }
    /**
     * 取消队列中多个正在上传中的文件(只在上传时可取消)
     * 文件item对象数组
     * 无
     */
    static cancelItems(items) {
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i])) { // 异常处理:入参不合法情况下，不做处理
                items.splice(i, 1);
            }
            else {
                items[i].isCancel = true;
            }
        }
        if (items[0].isUploading) { // 正在上传过程中，取消上传，上传事件中，会处理响应赋值及事件触发
            TiUploadUtil.isHTML5 ? items[0]._xhr.abort() : items[0]._form.abort();
        }
        else { // 未在上传过程中情况下，依然触发cancel和complete事件
            const response = undefined;
            const status = 0;
            TiUploadUtil.onCancel(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        }
    }
    /**
     * 删除队列中单个或多个上传文件
     * 文件item对象数组
     */
    static removeItems(items) {
        const itemsArr = Object.assign({}, items);
        for (let i = items.length - 1; i >= 0; i--) {
            if (!TiUploadUtil.isValidFileItem(items[i])) {
                items.splice(i, 1);
            }
        }
        // 阻止文件上传进程
        if (items[0].isUploading) {
            TiUploadUtil.cancelItems(items);
        }
        // 删除队列中的文件对象及文件对象相关引用
        for (let j = items.length - 1; j >= 0; j--) {
            items[j].uploader.queue.splice(TiUploadUtil.getItemIndex(items[j]), 1);
            itemsArr[j].destroy();
        }
        // 触发外部定义的删除事件
        TiUploadUtil.onRemove(itemsArr);
    }
    /**
     * 触发onBeforeRemoveItems事件
     * 文件item对象数组
     */
    static onBeforeRemove(items) {
        TiUploadUtil.handleEvent('BeforeRemove', items);
    }
    /**
     * 获取文件对象 index值，获取该值用于后续判断item有效性
     * 上传文件item对象
     */
    static getItemIndex(item) {
        if (item && item.uploader) {
            return item.uploader.queue.findIndex((itemInQueue) => {
                return itemInQueue.index === item.index;
            });
        }
        return -1;
    }
    /**
     * 判断文件是否为有效文件
     * 上传文件item对象
     */
    static isValidFileItem(item) {
        return (TiUploadUtil.getItemIndex(item) !== -1);
    }
    // 生成上传数据
    static generateUploadData(items) {
        // 上传数据组装
        const uploadDataObj = new FormData();
        if (items[0].formDataFirst) { // formData先于文件信息情况下，先添加formData
            addFormData();
            addFile();
        }
        else { // formData后于文件信息情况下，后添加formData
            addFile();
            addFormData();
        }
        function addFile() {
            items.forEach((item) => {
                uploadDataObj.append(item.alias, item._file, item.file.name); // 添加上传文件
            });
        }
        function addFormData() {
            // 添加单个文件的formData对象,加入到上传对象中
            for (const key in items[0].formData) {
                if (items[0].formData.hasOwnProperty(key)) {
                    uploadDataObj.append(key, items[0].formData[key]);
                }
            }
        }
        return uploadDataObj;
    }
    static setXhr(xhr, items) {
        // 文件上传信息配置（使用XHR，支持跨域请求）
        xhr.upload.onprogress = (event) => {
            const lengthComputable = event.lengthComputable;
            const loaded = event.loaded;
            const total = event.total;
            const progress = Math.round(lengthComputable ? loaded * 100 / total : 0); // 读取当前进度信息
            TiUploadUtil.onProgress(items, progress);
        };
        xhr.onload = () => {
            const response = xhr.response;
            const status = xhr.status;
            if (TiUploadUtil.isSuccessCode(status)) {
                TiUploadUtil.onSuccess(items, response, status);
            }
            else {
                TiUploadUtil.onError(items, response, status);
            }
            TiUploadUtil.onComplete(items, response, status);
        };
        xhr.onerror = () => {
            const response = xhr.response;
            const status = xhr.status;
            TiUploadUtil.onError(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        };
        xhr.onabort = () => {
            const response = xhr.response;
            const status = xhr.status;
            TiUploadUtil.onCancel(items, response, status);
            TiUploadUtil.onComplete(items, response, status);
        };
        // 设置单个item的_xhr,该对象用于操作单个item的上传取消等处理
        items.forEach((item) => {
            item._xhr = xhr;
        });
    }
    static setheaders(xhr, items) {
        // 设置请求头
        for (const key in items[0].headers) {
            if (items[0].headers.hasOwnProperty(key)) {
                xhr.setRequestHeader(key, items[0].headers[key]);
            }
        }
    }
    /**
     * xhr方式上传文件
     * 上传一个或多个文件item对象，上传单个文件的情况下
     */
    static uploadXhr(items) {
        const uploadDataObj = TiUploadUtil.generateUploadData(items); // 组装上传对象
        // 生成并设置xhr
        const xhr = new XMLHttpRequest();
        TiUploadUtil.setXhr(xhr, items);
        // 开始上传
        xhr.open(items[0].method, items[0].url, true);
        TiUploadUtil.setheaders(xhr, items);
        xhr.send(uploadDataObj);
        // 设置对象的上传状态
        items.forEach((item) => {
            item.isUploading = true;
        });
    }
    static uploadForm(items) {
        const form = document.createElement('form');
        form.style.display = 'none';
        for (const item of items) {
            // 清除原有form表单
            if (item._form) {
                item._form.parentNode.replaceChild(items[0]._input, items[0]._form); // 清除先前对应的form表单对象，确保上传文件表单元素外层不被form包裹
            }
            item._form = form; // 保存当前form
        }
        items[0]._input.parentNode.insertBefore(form, items[0]._input); // form插入inputSubmit之前，使其在页面显示
        if (items[0].formDataFirst) { // formData先于文件信息情况下，先添加formData
            addFormData();
            addFile();
        }
        else { // formData后于文件信息情况下，后添加formData
            addFile();
            addFormData();
        }
        // 文件信息组装
        function addFile() {
            for (const item of items) {
                const inputSubmit = item._input;
                inputSubmit.setAttribute('name', item.alias);
                form.appendChild(inputSubmit); // 在form中添加上传文件元素
            }
        }
        // formData信息组装
        function addFormData() {
            for (const key in items[0].formData) {
                if (items[0].formData.hasOwnProperty(key)) {
                    const formDataDomItem = document.createElement('input');
                    formDataDomItem.setAttribute('type', 'hidden');
                    formDataDomItem.setAttribute('name', key);
                    formDataDomItem.value = items[0].formData[key];
                    form.appendChild(formDataDomItem);
                }
            }
        }
        // 生成iframe元素，并将form表单和iframe元素结合
        const iframe = document.createElement('iframe');
        const name = Util.getUniqueId('tiFileIframe'); // 确保iframe唯一性，保证各文件上传最终能独立返回到相应的iframe
        iframe.setAttribute('name', name);
        form.setAttribute('action', items[0].url);
        form.setAttribute('method', items[0].method);
        form.setAttribute('target', name);
        form.setAttribute('enctype', 'multipart/form-data');
        form.appendChild(iframe);
        // 表单提交
        form.submit();
        // 设置对象的上传状态
        items.forEach((item) => {
            item.isUploading = true;
        });
        // 设置假进度
        let newProgress = 0;
        const progressInterval = setInterval(() => {
            if (newProgress !== 98) {
                newProgress += 2;
                this.onProgress(items, newProgress);
            }
        }, 10);
        // 表单完成事件
        const loadEvent = () => {
            let response = '';
            let status = 200;
            clearInterval(progressInterval);
            this.onProgress(items, 100);
            try {
                response = iframe.contentDocument.body.innerHTML; // 后台正常返回情况获取返回结果
                this.onSuccess(items, response, status);
            }
            catch (e) {
                response = e;
                status = 520; // 为方便使用者处理，失败情况下，统一返回520状态码 未知错误
                this.onError(items, response, status);
            }
            this.onComplete(items, response, status);
        };
        iframe.addEventListener('load', loadEvent);
        // 表单取消方法定义
        form.abort = () => {
            clearInterval(progressInterval);
            iframe.removeEventListener('load', loadEvent); // 去除load事件
            // 表单元素还原
            for (const node of form.childNodes) {
                if (node.tagName !== 'IFRAME') {
                    if (form.parentNode.lastChild === form) {
                        form.parentNode.appendChild(node);
                    }
                    else {
                        form.parentNode.insertBefore(node, form.nextSibling);
                    }
                }
            }
            form.remove();
            items.forEach((item) => {
                /* tslint:disable:no-null-keyword */
                item._form = null;
            });
            const status = 0;
            const response = undefined;
            this.onCancel(items, response, status);
            this.onComplete(items, response, status);
        };
    }
    static isSuccessCode(status) {
        // 和ajax请求一致，304 代表客户端已经执行了GET，但文件未变化
        return status >= 200 && status < 300 || status === 304;
    }
    /**
     * 上传前处理
     * 上传一个或多个文件item对象
     */
    static onBeforeSend(items) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            item.isReady = true;
            item.isUploading = false;
            item.isUploaded = false;
            item.isSuccess = false;
            item.isError = false;
            item.isCancel = false;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('BeforeSend', items);
    }
    static handleEvent(type, items, params = []) {
        const onEventTypeItems = items[0].uploader.config && items[0].uploader.config[`on${type}Items`];
        if (onEventTypeItems && (typeof onEventTypeItems === 'function')) {
            // eslint-disable-next-line no-useless-call
            onEventTypeItems.apply(null, [items, ...params]);
        }
    }
    static onProgress(items, progress) {
        TiUploadUtil.handleEvent('Progress', items, [progress]);
        for (const item of items) {
            item.progress = progress; // 设置单个文件的进度信息
        }
    }
    static onSuccess(items, response, status) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = true;
            item.isSuccess = true;
            item.isError = false;
            item.isCancel = false;
            item.progress = 100;
        }
        TiUploadUtil.handleEvent('Success', items, [response, status]);
    }
    static onError(items, response, status) {
        // 设置当前上传文件的状态信息
        for (const item of items) {
            // 设置当前上传文件的状态信息
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = true;
            item.isSuccess = false;
            item.isError = true;
            item.isCancel = false;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('Error', items, [response, status]);
    }
    static onComplete(items, response, status) {
        // 置位状态
        items.forEach((item) => {
            item.isUploading = false;
        });
        // 上传下一个文件，对于同一序列的上传文件来说，其isReady状态均已被标识，因此此处可以通过该方法进行筛选
        const readyItemsArr = items[0].uploader.getReadyItems();
        if (readyItemsArr && (readyItemsArr.length !== 0)) {
            this.uploadItems([readyItemsArr[0]]);
        }
        else {
            // 本次上传序列中，所有文件上传完成后回调，因为文件上传是串行上传：
            // 在一个文件上传完成后才执行下一个文件的上传操作，所以此处可以确保同一序列最终的上传完成
            TiUploadUtil.handleEvent('CompleteAll', items, [response, status]);
        }
        TiUploadUtil.handleEvent('Complete', items, [response, status]);
    }
    static onCancel(items, response, status) {
        for (const item of items) {
            item.isReady = false;
            item.isUploading = false;
            item.isUploaded = false;
            item.isSuccess = false;
            item.isError = false;
            item.isCancel = true;
            item.progress = 0;
        }
        TiUploadUtil.handleEvent('Cancel', items, [response, status]);
    }
    static onRemove(items) {
        TiUploadUtil.handleEvent('Remove', items);
    }
}
// 已支持SSR
TiUploadUtil.isHTML5 = (typeof window !== 'undefined') && (window.File && window.FormData);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlVcGxvYWRVdGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL3NlcnZpY2VzL3VwbG9hZC9UaVVwbG9hZFV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXhDLHNCQUFzQjtBQUN0Qjs7R0FFRztBQUNILE1BQU0sT0FBTyxZQUFZO0lBR3JCOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQXdCO1FBQzlDLGdDQUFnQztRQUNoQyxLQUFLLElBQUksQ0FBQyxHQUFXLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDaEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRTtnQkFDakUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDdEI7U0FDSjtRQUNELFlBQVksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVO1FBQzVDLEtBQUssSUFBSSxDQUFDLEdBQVcsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNoRCxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSw2Q0FBNkM7Z0JBQ2xFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2FBQ3RCO1NBQ0o7UUFDRCxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2xCLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FB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RyxLQUFLLENBQUM7WUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7U0FDckI7UUFDRCxZQUFZLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBRU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUF3QjtRQUM1QyxZQUFZLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM5QyxDQUFDOztBQTNaRCxTQUFTO0FBQ2Msb0JBQU8sR0FBWSxDQUFDLE9BQU8sTUFBTSxLQUFLLFdBQVcsQ0FBQyxJQUFJLENBQUUsTUFBYyxDQUFDLElBQUksSUFBSyxNQUFjLENBQUMsUUFBUSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaUZpbGVJdGVtIH0gZnJvbSAnLi9UaUZpbGVJbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcblxyXG4vLyDkuIrkvKDmlofku7bmnI3liqHvvIzmj5DkvpvkuIrkvKDov4fnqIvkuK3nmoTpgJrnlKjmlrnms5VcclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBUaVVwbG9hZFV0aWwge1xyXG4gICAgLy8g5bey5pSv5oyBU1NSXHJcbiAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IGlzSFRNTDU6IGJvb2xlYW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpICYmICgod2luZG93IGFzIGFueSkuRmlsZSAmJiAod2luZG93IGFzIGFueSkuRm9ybURhdGEpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDkuIrkvKDlpJrkuKrmlofku7ZcclxuICAgICAqIOS4iuS8oOS4gOS4quaIluWkmuS4quaWh+S7tml0ZW3lr7nosaFcclxuICAgICAqIOaXoFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHVwbG9hZEl0ZW1zKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IHZvaWQge1xyXG4gICAgICAgIC8vIOW8guW4uOWkhOeQhiAxLuWFpeWPguS4jeWQiOazlSwyLuato+WcqOS4iuS8oOeahOaWh+S7tuS4jeWFgeiuuOmHjeWkjeS4iuS8oFxyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IGl0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmICghVGlVcGxvYWRVdGlsLmlzVmFsaWRGaWxlSXRlbShpdGVtc1tpXSkgfHwgaXRlbXNbaV0uaXNVcGxvYWRpbmcpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBUaVVwbG9hZFV0aWwub25CZWZvcmVTZW5kKGl0ZW1zKTsgLy8g5paH5Lu25LiK5Lyg5YmN5aSE55CGXHJcbiAgICAgICAgZm9yIChsZXQgajogbnVtYmVyID0gaXRlbXMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW1zW2pdLmlzQ2FuY2VsKSB7IC8vIOW3suWPlua2iOS4iuS8oOeahOaWh+S7tuS4jeWGjeS4iuS8oCjmraTlpITkuLvopoHmmK/lr7liZWZvcmVTZW5k5Lit5Y+W5raI5LiK5Lyg55qE5paH5Lu26L+b6KGM5aSE55CGKVxyXG4gICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGosIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIFRpVXBsb2FkVXRpbC5pc0hUTUw1ID8gVGlVcGxvYWRVdGlsLnVwbG9hZFhocihpdGVtcykgOiBUaVVwbG9hZFV0aWwudXBsb2FkRm9ybShpdGVtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5raI6Zif5YiX5Lit5aSa5Liq5q2j5Zyo5LiK5Lyg5Lit55qE5paH5Lu2KOWPquWcqOS4iuS8oOaXtuWPr+WPlua2iClcclxuICAgICAqIOaWh+S7tml0ZW3lr7nosaHmlbDnu4RcclxuICAgICAqIOaXoFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNhbmNlbEl0ZW1zKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IHZvaWQge1xyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IGl0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmICghVGlVcGxvYWRVdGlsLmlzVmFsaWRGaWxlSXRlbShpdGVtc1tpXSkpIHsgLy8g5byC5bi45aSE55CGOuWFpeWPguS4jeWQiOazleaDheWGteS4i++8jOS4jeWBmuWkhOeQhlxyXG4gICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXNbaV0uaXNDYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVtc1swXS5pc1VwbG9hZGluZykgeyAvLyDmraPlnKjkuIrkvKDov4fnqIvkuK3vvIzlj5bmtojkuIrkvKDvvIzkuIrkvKDkuovku7bkuK3vvIzkvJrlpITnkIblk43lupTotYvlgLzlj4rkuovku7bop6blj5FcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLmlzSFRNTDUgPyBpdGVtc1swXS5feGhyLmFib3J0KCkgOiBpdGVtc1swXS5fZm9ybS5hYm9ydCgpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIOacquWcqOS4iuS8oOi/h+eoi+S4reaDheWGteS4i++8jOS+neeEtuinpuWPkWNhbmNlbOWSjGNvbXBsZXRl5LqL5Lu2XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlOiBzdHJpbmcgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1czogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLm9uQ2FuY2VsKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLm9uQ29tcGxldGUoaXRlbXMsIHJlc3BvbnNlLCBzdGF0dXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOmYn+WIl+S4reWNleS4quaIluWkmuS4quS4iuS8oOaWh+S7tlxyXG4gICAgICog5paH5Lu2aXRlbeWvueixoeaVsOe7hFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZUl0ZW1zKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zQXJyOiBBcnJheTxUaUZpbGVJdGVtPiA9IHsuLi5pdGVtc307XHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICAgICAgaWYgKCFUaVVwbG9hZFV0aWwuaXNWYWxpZEZpbGVJdGVtKGl0ZW1zW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOmYu+atouaWh+S7tuS4iuS8oOi/m+eoi1xyXG4gICAgICAgIGlmIChpdGVtc1swXS5pc1VwbG9hZGluZykge1xyXG4gICAgICAgICAgICBUaVVwbG9hZFV0aWwuY2FuY2VsSXRlbXMoaXRlbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDliKDpmaTpmJ/liJfkuK3nmoTmlofku7blr7nosaHlj4rmlofku7blr7nosaHnm7jlhbPlvJXnlKhcclxuICAgICAgICBmb3IgKGxldCBqOiBudW1iZXIgPSBpdGVtcy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xyXG4gICAgICAgICAgICBpdGVtc1tqXS51cGxvYWRlci5xdWV1ZS5zcGxpY2UoVGlVcGxvYWRVdGlsLmdldEl0ZW1JbmRleChpdGVtc1tqXSksIDEpO1xyXG4gICAgICAgICAgICBpdGVtc0FycltqXS5kZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOinpuWPkeWklumDqOWumuS5ieeahOWIoOmZpOS6i+S7tlxyXG4gICAgICAgIFRpVXBsb2FkVXRpbC5vblJlbW92ZShpdGVtc0Fycik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDop6blj5FvbkJlZm9yZVJlbW92ZUl0ZW1z5LqL5Lu2XHJcbiAgICAgKiDmlofku7ZpdGVt5a+56LGh5pWw57uEXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgb25CZWZvcmVSZW1vdmUoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+KTogdm9pZCB7XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLmhhbmRsZUV2ZW50KCdCZWZvcmVSZW1vdmUnLCBpdGVtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmlofku7blr7nosaEgaW5kZXjlgLzvvIzojrflj5bor6XlgLznlKjkuo7lkI7nu63liKTmlq1pdGVt5pyJ5pWI5oCnXHJcbiAgICAgKiDkuIrkvKDmlofku7ZpdGVt5a+56LGhXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGdldEl0ZW1JbmRleChpdGVtOiBUaUZpbGVJdGVtKTogbnVtYmVyIHtcclxuICAgICAgICBpZiAoaXRlbSAmJiBpdGVtLnVwbG9hZGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLnVwbG9hZGVyLnF1ZXVlLmZpbmRJbmRleCgoaXRlbUluUXVldWU6IFRpRmlsZUl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtSW5RdWV1ZS5pbmRleCA9PT0gaXRlbS5pbmRleDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKTmlq3mlofku7bmmK/lkKbkuLrmnInmlYjmlofku7ZcclxuICAgICAqIOS4iuS8oOaWh+S7tml0ZW3lr7nosaFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgaXNWYWxpZEZpbGVJdGVtKGl0ZW06IFRpRmlsZUl0ZW0pOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKFRpVXBsb2FkVXRpbC5nZXRJdGVtSW5kZXgoaXRlbSkgIT09IC0xKTtcclxuICAgIH1cclxuICAgIC8vIOeUn+aIkOS4iuS8oOaVsOaNrlxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVVcGxvYWREYXRhKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IGFueSB7XHJcbiAgICAgICAgLy8g5LiK5Lyg5pWw5o2u57uE6KOFXHJcbiAgICAgICAgY29uc3QgdXBsb2FkRGF0YU9iajogYW55ID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgaWYgKGl0ZW1zWzBdLmZvcm1EYXRhRmlyc3QpIHsgLy8gZm9ybURhdGHlhYjkuo7mlofku7bkv6Hmga/mg4XlhrXkuIvvvIzlhYjmt7vliqBmb3JtRGF0YVxyXG4gICAgICAgICAgICBhZGRGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICBhZGRGaWxlKCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gZm9ybURhdGHlkI7kuo7mlofku7bkv6Hmga/mg4XlhrXkuIvvvIzlkI7mt7vliqBmb3JtRGF0YVxyXG4gICAgICAgICAgICBhZGRGaWxlKCk7XHJcbiAgICAgICAgICAgIGFkZEZvcm1EYXRhKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZEZpbGUoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW06IFRpRmlsZUl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIHVwbG9hZERhdGFPYmouYXBwZW5kKGl0ZW0uYWxpYXMsIGl0ZW0uX2ZpbGUsIGl0ZW0uZmlsZS5uYW1lKTsgLy8g5re75Yqg5LiK5Lyg5paH5Lu2XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBhZGRGb3JtRGF0YSgpOiBhbnkge1xyXG4gICAgICAgICAgICAvLyDmt7vliqDljZXkuKrmlofku7bnmoRmb3JtRGF0YeWvueixoSzliqDlhaXliLDkuIrkvKDlr7nosaHkuK1cclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gaXRlbXNbMF0uZm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtc1swXS5mb3JtRGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YU9iai5hcHBlbmQoa2V5LCBpdGVtc1swXS5mb3JtRGF0YVtrZXldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHVwbG9hZERhdGFPYmo7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyBzZXRYaHIoeGhyOiBhbnksIGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IHZvaWQge1xyXG4gICAgICAgIC8vIOaWh+S7tuS4iuS8oOS/oeaBr+mFjee9ru+8iOS9v+eUqFhIUu+8jOaUr+aMgei3qOWfn+ivt+axgu+8iVxyXG4gICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IChldmVudDogYW55KTogdm9pZCA9PiB7IC8vIOaWh+S7tui/m+W6puiOt+WPluS6i+S7tlxyXG4gICAgICAgICAgICBjb25zdCBsZW5ndGhDb21wdXRhYmxlOiBib29sZWFuID0gZXZlbnQubGVuZ3RoQ29tcHV0YWJsZTtcclxuICAgICAgICAgICAgY29uc3QgbG9hZGVkOiBudW1iZXIgPSBldmVudC5sb2FkZWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsOiBudW1iZXIgPSBldmVudC50b3RhbDtcclxuICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3M6IG51bWJlciA9IE1hdGgucm91bmQobGVuZ3RoQ29tcHV0YWJsZSA/IGxvYWRlZCAqIDEwMCAvIHRvdGFsIDogMCk7IC8vIOivu+WPluW9k+WJjei/m+W6puS/oeaBr1xyXG4gICAgICAgICAgICBUaVVwbG9hZFV0aWwub25Qcm9ncmVzcyhpdGVtcywgcHJvZ3Jlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHhoci5vbmxvYWQgPSAoKTogdm9pZCA9PiB7IC8vIOS4iuS8oOWujOaIkOS6i+S7tlxyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZTogc3RyaW5nID0geGhyLnJlc3BvbnNlO1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0dXM6IG51bWJlciA9IHhoci5zdGF0dXM7XHJcbiAgICAgICAgICAgIGlmIChUaVVwbG9hZFV0aWwuaXNTdWNjZXNzQ29kZShzdGF0dXMpKSB7XHJcbiAgICAgICAgICAgICAgICBUaVVwbG9hZFV0aWwub25TdWNjZXNzKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFRpVXBsb2FkVXRpbC5vbkVycm9yKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUaVVwbG9hZFV0aWwub25Db21wbGV0ZShpdGVtcywgcmVzcG9uc2UsIHN0YXR1cyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgeGhyLm9uZXJyb3IgPSAoKTogdm9pZCA9PiB7IC8vIOS4iuS8oOWksei0peS6i+S7tlxyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZTogc3RyaW5nID0geGhyLnJlc3BvbnNlO1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0dXM6IG51bWJlciA9IHhoci5zdGF0dXM7XHJcbiAgICAgICAgICAgIFRpVXBsb2FkVXRpbC5vbkVycm9yKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLm9uQ29tcGxldGUoaXRlbXMsIHJlc3BvbnNlLCBzdGF0dXMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHhoci5vbmFib3J0ID0gKCk6IHZvaWQgPT4geyAvLyDlj5bmtojlm57osINcclxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2U6IHN0cmluZyA9IHhoci5yZXNwb25zZTtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdHVzOiBudW1iZXIgPSB4aHIuc3RhdHVzO1xyXG4gICAgICAgICAgICBUaVVwbG9hZFV0aWwub25DYW5jZWwoaXRlbXMsIHJlc3BvbnNlLCBzdGF0dXMpO1xyXG4gICAgICAgICAgICBUaVVwbG9hZFV0aWwub25Db21wbGV0ZShpdGVtcywgcmVzcG9uc2UsIHN0YXR1cyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5Y2V5LiqaXRlbeeahF94aHIs6K+l5a+56LGh55So5LqO5pON5L2c5Y2V5LiqaXRlbeeahOS4iuS8oOWPlua2iOetieWkhOeQhlxyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW06IFRpRmlsZUl0ZW0pID0+IHtcclxuICAgICAgICAgICAgaXRlbS5feGhyID0geGhyO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2V0aGVhZGVycyh4aHI6IGFueSwgaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+KTogdm9pZCB7XHJcbiAgICAgICAgLy8g6K6+572u6K+35rGC5aS0XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gaXRlbXNbMF0uaGVhZGVycykge1xyXG4gICAgICAgICAgICBpZiAoaXRlbXNbMF0uaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIGl0ZW1zWzBdLmhlYWRlcnNba2V5XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIHhocuaWueW8j+S4iuS8oOaWh+S7tlxyXG4gICAgICog5LiK5Lyg5LiA5Liq5oiW5aSa5Liq5paH5Lu2aXRlbeWvueixoe+8jOS4iuS8oOWNleS4quaWh+S7tueahOaDheWGteS4i1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyB1cGxvYWRYaHIoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgdXBsb2FkRGF0YU9iajogYW55ID0gVGlVcGxvYWRVdGlsLmdlbmVyYXRlVXBsb2FkRGF0YShpdGVtcyk7IC8vIOe7hOijheS4iuS8oOWvueixoVxyXG4gICAgICAgIC8vIOeUn+aIkOW5tuiuvue9rnhoclxyXG4gICAgICAgIGNvbnN0IHhocjogYW55ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLnNldFhocih4aHIsIGl0ZW1zKTtcclxuXHJcbiAgICAgICAgLy8g5byA5aeL5LiK5LygXHJcbiAgICAgICAgeGhyLm9wZW4oaXRlbXNbMF0ubWV0aG9kLCBpdGVtc1swXS51cmwsIHRydWUpO1xyXG4gICAgICAgIFRpVXBsb2FkVXRpbC5zZXRoZWFkZXJzKHhociwgaXRlbXMpO1xyXG4gICAgICAgIHhoci5zZW5kKHVwbG9hZERhdGFPYmopO1xyXG5cclxuICAgICAgICAvLyDorr7nva7lr7nosaHnmoTkuIrkvKDnirbmgIFcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtOiBUaUZpbGVJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNVcGxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgdXBsb2FkRm9ybShpdGVtczogQXJyYXk8VGlGaWxlSXRlbT4pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBmb3JtOiBhbnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XHJcbiAgICAgICAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICAvLyDmuIXpmaTljp/mnIlmb3Jt6KGo5Y2VXHJcbiAgICAgICAgICAgIGlmIChpdGVtLl9mb3JtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLl9mb3JtLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGl0ZW1zWzBdLl9pbnB1dCwgaXRlbXNbMF0uX2Zvcm0pOyAvLyDmuIXpmaTlhYjliY3lr7nlupTnmoRmb3Jt6KGo5Y2V5a+56LGh77yM56Gu5L+d5LiK5Lyg5paH5Lu26KGo5Y2V5YWD57Sg5aSW5bGC5LiN6KKrZm9ybeWMheijuVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGl0ZW0uX2Zvcm0gPSBmb3JtOyAvLyDkv53lrZjlvZPliY1mb3JtXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW1zWzBdLl9pbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShmb3JtLCBpdGVtc1swXS5faW5wdXQpOyAvLyBmb3Jt5o+S5YWlaW5wdXRTdWJtaXTkuYvliY3vvIzkvb/lhbblnKjpobXpnaLmmL7npLpcclxuXHJcbiAgICAgICAgaWYgKGl0ZW1zWzBdLmZvcm1EYXRhRmlyc3QpIHsgLy8gZm9ybURhdGHlhYjkuo7mlofku7bkv6Hmga/mg4XlhrXkuIvvvIzlhYjmt7vliqBmb3JtRGF0YVxyXG4gICAgICAgICAgICBhZGRGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICBhZGRGaWxlKCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gZm9ybURhdGHlkI7kuo7mlofku7bkv6Hmga/mg4XlhrXkuIvvvIzlkI7mt7vliqBmb3JtRGF0YVxyXG4gICAgICAgICAgICBhZGRGaWxlKCk7XHJcbiAgICAgICAgICAgIGFkZEZvcm1EYXRhKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmlofku7bkv6Hmga/nu4Too4VcclxuICAgICAgICBmdW5jdGlvbiBhZGRGaWxlKCk6IHZvaWQge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0U3VibWl0OiBFbGVtZW50ID0gaXRlbS5faW5wdXQ7XHJcbiAgICAgICAgICAgICAgICBpbnB1dFN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBpdGVtLmFsaWFzKTtcclxuICAgICAgICAgICAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoaW5wdXRTdWJtaXQpOyAvLyDlnKhmb3Jt5Lit5re75Yqg5LiK5Lyg5paH5Lu25YWD57SgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZvcm1EYXRh5L+h5oGv57uE6KOFXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkRm9ybURhdGEoKTogdm9pZCB7Ly8g5re75YqgZm9ybURhdGHlhYPntKBcclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gaXRlbXNbMF0uZm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtc1swXS5mb3JtRGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybURhdGFEb21JdGVtOiBhbnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhRG9tSXRlbS5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGFEb21JdGVtLnNldEF0dHJpYnV0ZSgnbmFtZScsIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGFEb21JdGVtLnZhbHVlID0gaXRlbXNbMF0uZm9ybURhdGFba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtLmFwcGVuZENoaWxkKGZvcm1EYXRhRG9tSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOeUn+aIkGlmcmFtZeWFg+e0oO+8jOW5tuWwhmZvcm3ooajljZXlkoxpZnJhbWXlhYPntKDnu5PlkIhcclxuICAgICAgICBjb25zdCBpZnJhbWU6IGFueSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xyXG4gICAgICAgIGNvbnN0IG5hbWU6IHN0cmluZyA9IFV0aWwuZ2V0VW5pcXVlSWQoJ3RpRmlsZUlmcmFtZScpOyAvLyDnoa7kv51pZnJhbWXllK/kuIDmgKfvvIzkv53or4HlkITmlofku7bkuIrkvKDmnIDnu4jog73ni6znq4vov5Tlm57liLDnm7jlupTnmoRpZnJhbWVcclxuICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCduYW1lJywgbmFtZSk7XHJcbiAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2FjdGlvbicsIGl0ZW1zWzBdLnVybCk7XHJcbiAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ21ldGhvZCcsIGl0ZW1zWzBdLm1ldGhvZCk7XHJcbiAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsIG5hbWUpO1xyXG4gICAgICAgIGZvcm0uc2V0QXR0cmlidXRlKCdlbmN0eXBlJywgJ211bHRpcGFydC9mb3JtLWRhdGEnKTtcclxuICAgICAgICBmb3JtLmFwcGVuZENoaWxkKGlmcmFtZSk7XHJcblxyXG4gICAgICAgIC8vIOihqOWNleaPkOS6pFxyXG4gICAgICAgIGZvcm0uc3VibWl0KCk7XHJcbiAgICAgICAgLy8g6K6+572u5a+56LGh55qE5LiK5Lyg54q25oCBXHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbTogVGlGaWxlSXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBpdGVtLmlzVXBsb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5YGH6L+b5bqmXHJcbiAgICAgICAgbGV0IG5ld1Byb2dyZXNzOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IHByb2dyZXNzSW50ZXJ2YWw6IGFueSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKG5ld1Byb2dyZXNzICE9PSA5OCkge1xyXG4gICAgICAgICAgICAgICAgbmV3UHJvZ3Jlc3MgKz0gMjtcclxuICAgICAgICAgICAgICAgIHRoaXMub25Qcm9ncmVzcyhpdGVtcywgbmV3UHJvZ3Jlc3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMTApO1xyXG5cclxuICAgICAgICAvLyDooajljZXlrozmiJDkuovku7ZcclxuICAgICAgICBjb25zdCBsb2FkRXZlbnQ6ICgpID0+IHZvaWQgPVxyXG4gICAgICAgICAgICAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXNwb25zZTogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgICAgIGxldCBzdGF0dXM6IG51bWJlciA9IDIwMDtcclxuXHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NJbnRlcnZhbCk7XHJcbiAgICAgICAgICAgIHRoaXMub25Qcm9ncmVzcyhpdGVtcywgMTAwKTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5ib2R5LmlubmVySFRNTDsgLy8g5ZCO5Y+w5q2j5bi46L+U5Zue5oOF5Ya16I635Y+W6L+U5Zue57uT5p6cXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uU3VjY2VzcyhpdGVtcywgcmVzcG9uc2UsIHN0YXR1cyk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZTtcclxuICAgICAgICAgICAgICAgIHN0YXR1cyA9IDUyMDsgLy8g5Li65pa55L6/5L2/55So6ICF5aSE55CG77yM5aSx6LSl5oOF5Ya15LiL77yM57uf5LiA6L+U5ZueNTIw54q25oCB56CBIOacquefpemUmeivr1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5vbkNvbXBsZXRlKGl0ZW1zLCByZXNwb25zZSwgc3RhdHVzKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmcmFtZS5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgbG9hZEV2ZW50KTtcclxuXHJcbiAgICAgICAgLy8g6KGo5Y2V5Y+W5raI5pa55rOV5a6a5LmJXHJcbiAgICAgICAgZm9ybS5hYm9ydCA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc0ludGVydmFsKTtcclxuICAgICAgICAgICAgaWZyYW1lLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkRXZlbnQpOyAvLyDljrvpmaRsb2Fk5LqL5Lu2XHJcbiAgICAgICAgICAgIC8vIOihqOWNleWFg+e0oOi/mOWOn1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgZm9ybS5jaGlsZE5vZGVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKG5vZGUgYXMgYW55KS50YWdOYW1lICE9PSAnSUZSQU1FJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtLnBhcmVudE5vZGUubGFzdENoaWxkID09PSBmb3JtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0ucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGZvcm0ubmV4dFNpYmxpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3JtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtOiBUaUZpbGVJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1udWxsLWtleXdvcmQgKi9cclxuICAgICAgICAgICAgICAgIGl0ZW0uX2Zvcm0gPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1czogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2U6IHN0cmluZyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5vbkNhbmNlbChpdGVtcywgcmVzcG9uc2UsIHN0YXR1cyk7XHJcbiAgICAgICAgICAgIHRoaXMub25Db21wbGV0ZShpdGVtcywgcmVzcG9uc2UsIHN0YXR1cyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBpc1N1Y2Nlc3NDb2RlKHN0YXR1czogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgLy8g5ZKMYWpheOivt+axguS4gOiHtO+8jDMwNCDku6PooajlrqLmiLfnq6/lt7Lnu4/miafooYzkuoZHRVTvvIzkvYbmlofku7bmnKrlj5jljJZcclxuICAgICAgICByZXR1cm4gc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkuIrkvKDliY3lpITnkIZcclxuICAgICAqIOS4iuS8oOS4gOS4quaIluWkmuS4quaWh+S7tml0ZW3lr7nosaFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25CZWZvcmVTZW5kKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPik6IHZvaWQge1xyXG4gICAgICAgIC8vIOiuvue9ruW9k+WJjeS4iuS8oOaWh+S7tueahOeKtuaAgeS/oeaBr1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICBpdGVtLmlzUmVhZHkgPSB0cnVlO1xyXG4gICAgICAgICAgICBpdGVtLmlzVXBsb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNVcGxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmlzU3VjY2VzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmlzRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgaXRlbS5pc0NhbmNlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLnByb2dyZXNzID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLmhhbmRsZUV2ZW50KCdCZWZvcmVTZW5kJywgaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGhhbmRsZUV2ZW50KHR5cGU6IHN0cmluZywgaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+LCBwYXJhbXM6IEFycmF5PGFueT4gPSBbXSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9uRXZlbnRUeXBlSXRlbXM6IGFueSA9IGl0ZW1zWzBdLnVwbG9hZGVyLmNvbmZpZyAmJiBpdGVtc1swXS51cGxvYWRlci5jb25maWdbYG9uJHt0eXBlfUl0ZW1zYF07XHJcbiAgICAgICAgaWYgKG9uRXZlbnRUeXBlSXRlbXMgJiYgKHR5cGVvZiBvbkV2ZW50VHlwZUl0ZW1zID09PSAnZnVuY3Rpb24nKSkge1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1jYWxsXHJcbiAgICAgICAgICAgIG9uRXZlbnRUeXBlSXRlbXMuYXBwbHkobnVsbCwgW2l0ZW1zLCAuLi5wYXJhbXNdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25Qcm9ncmVzcyhpdGVtczogQXJyYXk8VGlGaWxlSXRlbT4sIHByb2dyZXNzOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBUaVVwbG9hZFV0aWwuaGFuZGxlRXZlbnQoJ1Byb2dyZXNzJywgaXRlbXMsIFtwcm9ncmVzc10pO1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICBpdGVtLnByb2dyZXNzID0gcHJvZ3Jlc3M7IC8vIOiuvue9ruWNleS4quaWh+S7tueahOi/m+W6puS/oeaBr1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBvblN1Y2Nlc3MoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+LCByZXNwb25zZTogc3RyaW5nLCBzdGF0dXM6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIC8vIOiuvue9ruW9k+WJjeS4iuS8oOaWh+S7tueahOeKtuaAgeS/oeaBr1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICBpdGVtLmlzUmVhZHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgaXRlbS5pc1VwbG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmlzVXBsb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpdGVtLmlzU3VjY2VzcyA9IHRydWU7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmlzQ2FuY2VsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0ucHJvZ3Jlc3MgPSAxMDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFRpVXBsb2FkVXRpbC5oYW5kbGVFdmVudCgnU3VjY2VzcycsIGl0ZW1zLCBbcmVzcG9uc2UsIHN0YXR1c10pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIG9uRXJyb3IoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+LCByZXNwb25zZTogc3RyaW5nLCBzdGF0dXM6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIC8vIOiuvue9ruW9k+WJjeS4iuS8oOaWh+S7tueahOeKtuaAgeS/oeaBr1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAgICAgICAvLyDorr7nva7lvZPliY3kuIrkvKDmlofku7bnmoTnirbmgIHkv6Hmga9cclxuICAgICAgICAgICAgaXRlbS5pc1JlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNVcGxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaXRlbS5pc1VwbG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaXRlbS5pc1N1Y2Nlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgaXRlbS5pc0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgaXRlbS5pc0NhbmNlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLnByb2dyZXNzID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLmhhbmRsZUV2ZW50KCdFcnJvcicsIGl0ZW1zLCBbcmVzcG9uc2UsIHN0YXR1c10pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIG9uQ29tcGxldGUoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+LCByZXNwb25zZTogc3RyaW5nLCBzdGF0dXM6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIC8vIOe9ruS9jeeKtuaAgVxyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW06IFRpRmlsZUl0ZW0pID0+IHtcclxuICAgICAgICAgICAgaXRlbS5pc1VwbG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIOS4iuS8oOS4i+S4gOS4quaWh+S7tu+8jOWvueS6juWQjOS4gOW6j+WIl+eahOS4iuS8oOaWh+S7tuadpeivtO+8jOWFtmlzUmVhZHnnirbmgIHlnYflt7LooqvmoIfor4bvvIzlm6DmraTmraTlpITlj6/ku6XpgJrov4for6Xmlrnms5Xov5vooYznrZvpgIlcclxuICAgICAgICBjb25zdCByZWFkeUl0ZW1zQXJyOiBBcnJheTxUaUZpbGVJdGVtPiA9IGl0ZW1zWzBdLnVwbG9hZGVyLmdldFJlYWR5SXRlbXMoKTtcclxuICAgICAgICBpZiAocmVhZHlJdGVtc0FyciAmJiAocmVhZHlJdGVtc0Fyci5sZW5ndGggIT09IDApKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkSXRlbXMoW3JlYWR5SXRlbXNBcnJbMF1dKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDmnKzmrKHkuIrkvKDluo/liJfkuK3vvIzmiYDmnInmlofku7bkuIrkvKDlrozmiJDlkI7lm57osIPvvIzlm6DkuLrmlofku7bkuIrkvKDmmK/kuLLooYzkuIrkvKDvvJpcclxuICAgICAgICAgICAgLy8g5Zyo5LiA5Liq5paH5Lu25LiK5Lyg5a6M5oiQ5ZCO5omN5omn6KGM5LiL5LiA5Liq5paH5Lu255qE5LiK5Lyg5pON5L2c77yM5omA5Lul5q2k5aSE5Y+v5Lul56Gu5L+d5ZCM5LiA5bqP5YiX5pyA57uI55qE5LiK5Lyg5a6M5oiQXHJcbiAgICAgICAgICAgIFRpVXBsb2FkVXRpbC5oYW5kbGVFdmVudCgnQ29tcGxldGVBbGwnLCBpdGVtcywgW3Jlc3BvbnNlLCBzdGF0dXNdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLmhhbmRsZUV2ZW50KCdDb21wbGV0ZScsIGl0ZW1zLCBbcmVzcG9uc2UsIHN0YXR1c10pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIG9uQ2FuY2VsKGl0ZW1zOiBBcnJheTxUaUZpbGVJdGVtPiwgcmVzcG9uc2U6IHN0cmluZywgc3RhdHVzOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcclxuICAgICAgICAgICAgaXRlbS5pc1JlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNVcGxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaXRlbS5pc1VwbG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNTdWNjZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmlzQ2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgaXRlbS5wcm9ncmVzcyA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFRpVXBsb2FkVXRpbC5oYW5kbGVFdmVudCgnQ2FuY2VsJywgaXRlbXMsIFtyZXNwb25zZSwgc3RhdHVzXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25SZW1vdmUoaXRlbXM6IEFycmF5PFRpRmlsZUl0ZW0+KTogdm9pZCB7XHJcbiAgICAgICAgVGlVcGxvYWRVdGlsLmhhbmRsZUV2ZW50KCdSZW1vdmUnLCBpdGVtcyk7XHJcbiAgICB9XHJcbn1cclxuIl19