import { TiUploadUtil } from './TiUploadUtil';
import { Util } from '../../utils/Util';
// 单个文件对象服务封装，包括文件基本信息统一、文件状态信息、文件基本方法封装
/**
 * @ignore
 */
export class TiFileItemUtil {
    /**
     * 创建文件对象，该返回值用作后续文件的上传和文件操作，可作为文件回调参数传递
     * fileObject 文件信息对象
     * fileOrInpt 原始文件对象 H5下为file对象，非H5下为fileInput
     * config 文件上传配置信息
     * uploader 上传文件对应的文件实例
     * return 文件对象
     */
    static createFileItem(tifileObject, fileOrInput, config, uploader) {
        /* tslint:disable:no-invalid-this */
        /* tslint:disable:no-null-keyword */
        function upload() {
            TiUploadUtil.uploadItems([this]);
        }
        function cancel() {
            TiUploadUtil.cancelItems([this]);
        }
        function remove(isRemove) {
            if (isRemove) {
                // 触发外部定义的删除前的事件
                TiUploadUtil.onBeforeRemove([this]);
                return;
            }
            TiUploadUtil.removeItems([this]);
        }
        function destroy() {
            if (this._input) { // 删除页面残留dom
                this._input.remove();
            }
            if (this._form) {
                this._form.remove();
            }
            this._input = null; // 清除引用
            this._form = null;
        }
        // 上传文件对象赋值
        let _file = null;
        let _input = null;
        if (!(fileOrInput instanceof Element)) {
            _file = fileOrInput;
        }
        else {
            _input = fileOrInput;
        }
        return {
            url: config.url || '/',
            file: tifileObject,
            alias: config.alias || 'tiFile',
            _file,
            _input,
            formData: config.formData || {},
            formDataFirst: config.formDataFirst || false,
            headers: config.headers || {},
            method: config.method || 'post',
            batchSend: config.batchSend || false,
            uploader,
            upload,
            cancel,
            remove,
            destroy,
            isReady: false,
            isUploading: false,
            isUploaded: false,
            isCancel: false,
            isSuccess: false,
            isError: false,
            progress: 0,
            isHover: false,
            isOverflow: false,
            _xhr: {},
            index: 0,
            _form: undefined
        };
    }
    /**
     * 创建文件对象，统一H5和非H5情况下的文件信息
     * file {FileList|FileInput} 原始文件对象 H5为file对象形式，非H5为fileinput对象
     * return 类文件对象
     */
    static createFileObject(fileThis) {
        if (TiUploadUtil.isHTML5) {
            const fileName = fileThis.name;
            return {
                lastModifiedDate: fileThis.lastModifiedDate,
                size: fileThis.size,
                sizeWithUnit: TiFileItemUtil.formatSize(fileThis.size),
                name: fileThis.name,
                type: fileName.slice(fileName.lastIndexOf('.') + 1)
                    .toLowerCase(),
                _file: fileThis,
                _input: null // 文件input对象，只在IE9 form表单提交方式下有效
            };
        }
        const path = fileThis.value;
        // 非H5情况下,浏览器不打开ActiveX,获取不到文件大小,该种情况下文件大小为null
        const fileSize = Util.isUndefined(fileThis.size) ? null : fileThis.size;
        return {
            lastModifiedDate: null,
            size: fileSize,
            sizeWithUnit: isNaN(fileSize) ? '' : this.formatSize(fileSize / 1024),
            name: path.slice(path.lastIndexOf('/') + path.lastIndexOf('\\') + 2),
            type: path.slice(path.lastIndexOf('.') + 1)
                .toLowerCase(),
            _file: null,
            _input: fileThis // 文件input对象，只在IE9 form表单提交方式下有效
        };
    }
    /**
     * 将文件大小显示标准化：根据文件大小做不同单位的显示，文件大小保留两位小数
     * 文件大小
     * 带单位文件大小
     */
    static formatSize(size) {
        let sizeWithUnit;
        const kbSize = size / 1024;
        /* tslint:disable:prefer-conditional-expression */
        if (kbSize < 1) {
            sizeWithUnit = size.toFixed(2) + 'B';
        }
        else if (kbSize < 1024) {
            sizeWithUnit = kbSize.toFixed(2) + 'KB';
        }
        else if (kbSize < 1024 * 1024) {
            sizeWithUnit = (kbSize / 1024).toFixed(2) + 'MB';
        }
        else {
            sizeWithUnit = (kbSize / 1024 / 1024).toFixed(2) + 'GB';
        }
        return sizeWithUnit;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlGaWxlSXRlbVV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvc2VydmljZXMvdXBsb2FkL1RpRmlsZUl0ZW1VdGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFeEMsd0NBQXdDO0FBQ3hDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGNBQWM7SUFDdkI7Ozs7Ozs7T0FPRztJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsWUFBd0IsRUFBRSxXQUEyQixFQUNyRCxNQUFzQixFQUFFLFFBQXFCO1FBQ3RFLG9DQUFvQztRQUNwQyxvQ0FBb0M7UUFDcEMsU0FBUyxNQUFNO1lBQ1gsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDckMsQ0FBQztRQUNELFNBQVMsTUFBTTtZQUNYLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFFRCxTQUFTLE1BQU0sQ0FBQyxRQUFrQjtZQUM5QixJQUFJLFFBQVEsRUFBRTtnQkFDVixnQkFBZ0I7Z0JBQ2hCLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUVwQyxPQUFPO2FBQ1Y7WUFFRCxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNyQyxDQUFDO1FBRUQsU0FBUyxPQUFPO1lBQ1osSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsWUFBWTtnQkFDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUN4QjtZQUNELElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDWixJQUFJLENBQUMsS0FBSyxDQUFDLE1B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QyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3BFLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNsQyxXQUFXLEVBQUU7WUFDdEIsS0FBSyxFQUFFLElBQUk7WUFDWCxNQUFNLEVBQUUsUUFBUSxDQUFDLGdDQUFnQztTQUNwRCxDQUFDO0lBQ04sQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQVk7UUFDbEMsSUFBSSxZQUFvQixDQUFDO1FBQ3pCLE1BQU0sTUFBTSxHQUFXLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbkMsa0RBQWtEO1FBQ2xELElBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNaLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztTQUN4QzthQUFNLElBQUksTUFBTSxHQUFHLElBQUksRUFBRTtZQUN0QixZQUFZLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7U0FDM0M7YUFBTSxJQUFJLE1BQU0sR0FBRyxJQUFJLEdBQUcsSUFBSSxFQUFFO1lBQzdCLFlBQVksR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1NBQ3BEO2FBQU07WUFDSCxZQUFZLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7U0FDM0Q7UUFFRCxPQUFPLFlBQVksQ0FBQztJQUN4QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaVVwbG9hZFV0aWwgfSBmcm9tICcuL1RpVXBsb2FkVXRpbCc7XHJcbmltcG9ydCB7IFRpRmlsZUluZm8sIFRpRmlsZUl0ZW0sIFRpVXBsb2FkQ29uZmlnLCBUaVVwbG9hZFJlZiB9IGZyb20gJy4vVGlGaWxlSW50ZXJmYWNlJztcclxuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5cclxuLy8g5Y2V5Liq5paH5Lu25a+56LGh5pyN5Yqh5bCB6KOF77yM5YyF5ous5paH5Lu25Z+65pys5L+h5oGv57uf5LiA44CB5paH5Lu254q25oCB5L+h5oGv44CB5paH5Lu25Z+65pys5pa55rOV5bCB6KOFXHJcbi8qKlxyXG4gKiBAaWdub3JlXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgVGlGaWxlSXRlbVV0aWwge1xyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rmlofku7blr7nosaHvvIzor6Xov5Tlm57lgLznlKjkvZzlkI7nu63mlofku7bnmoTkuIrkvKDlkozmlofku7bmk43kvZzvvIzlj6/kvZzkuLrmlofku7blm57osIPlj4LmlbDkvKDpgJJcclxuICAgICAqIGZpbGVPYmplY3Qg5paH5Lu25L+h5oGv5a+56LGhXHJcbiAgICAgKiBmaWxlT3JJbnB0IOWOn+Wni+aWh+S7tuWvueixoSBINeS4i+S4umZpbGXlr7nosaHvvIzpnZ5INeS4i+S4umZpbGVJbnB1dFxyXG4gICAgICogY29uZmlnIOaWh+S7tuS4iuS8oOmFjee9ruS/oeaBr1xyXG4gICAgICogdXBsb2FkZXIg5LiK5Lyg5paH5Lu25a+55bqU55qE5paH5Lu25a6e5L6LXHJcbiAgICAgKiByZXR1cm4g5paH5Lu25a+56LGhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlRmlsZUl0ZW0odGlmaWxlT2JqZWN0OiBUaUZpbGVJbmZvLCBmaWxlT3JJbnB1dDogRWxlbWVudCB8IEZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogVGlVcGxvYWRDb25maWcsIHVwbG9hZGVyOiBUaVVwbG9hZFJlZik6IFRpRmlsZUl0ZW0ge1xyXG4gICAgICAgIC8qIHRzbGludDpkaXNhYmxlOm5vLWludmFsaWQtdGhpcyAqL1xyXG4gICAgICAgIC8qIHRzbGludDpkaXNhYmxlOm5vLW51bGwta2V5d29yZCAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLnVwbG9hZEl0ZW1zKFt0aGlzXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgVGlVcGxvYWRVdGlsLmNhbmNlbEl0ZW1zKFt0aGlzXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaXNSZW1vdmU/OiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmIChpc1JlbW92ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g6Kem5Y+R5aSW6YOo5a6a5LmJ55qE5Yig6Zmk5YmN55qE5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICBUaVVwbG9hZFV0aWwub25CZWZvcmVSZW1vdmUoW3RoaXNdKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFRpVXBsb2FkVXRpbC5yZW1vdmVJdGVtcyhbdGhpc10pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2lucHV0KSB7IC8vIOWIoOmZpOmhtemdouaui+eVmWRvbVxyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5wdXQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2Zvcm0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5faW5wdXQgPSBudWxsOyAvLyDmuIXpmaTlvJXnlKhcclxuICAgICAgICAgICAgdGhpcy5fZm9ybSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDkuIrkvKDmlofku7blr7nosaHotYvlgLxcclxuICAgICAgICBsZXQgX2ZpbGU6IGFueSA9IG51bGw7XHJcbiAgICAgICAgbGV0IF9pbnB1dDogYW55ID0gbnVsbDtcclxuICAgICAgICBpZiAoIShmaWxlT3JJbnB1dCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIF9maWxlID0gZmlsZU9ySW5wdXQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgX2lucHV0ID0gZmlsZU9ySW5wdXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB1cmw6IGNvbmZpZy51cmwgfHwgJy8nLCAvLyDlkI7lj7DlnLDlnYBcclxuICAgICAgICAgICAgZmlsZTogdGlmaWxlT2JqZWN0LFxyXG4gICAgICAgICAgICBhbGlhczogY29uZmlnLmFsaWFzIHx8ICd0aUZpbGUnLCAvLyDmlofku7ZuYW1lXHJcbiAgICAgICAgICAgIF9maWxlLFxyXG4gICAgICAgICAgICBfaW5wdXQsXHJcbiAgICAgICAgICAgIGZvcm1EYXRhOiBjb25maWcuZm9ybURhdGEgfHwge30sXHJcbiAgICAgICAgICAgIGZvcm1EYXRhRmlyc3Q6IGNvbmZpZy5mb3JtRGF0YUZpcnN0IHx8IGZhbHNlLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyB8fCB7fSxcclxuICAgICAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kIHx8ICdwb3N0JyxcclxuICAgICAgICAgICAgYmF0Y2hTZW5kOiBjb25maWcuYmF0Y2hTZW5kIHx8IGZhbHNlLFxyXG4gICAgICAgICAgICB1cGxvYWRlciwgLy8g5LiK5Lyg5a6e5L6L5a+56LGhXHJcblxyXG4gICAgICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgICAgIGNhbmNlbCxcclxuICAgICAgICAgICAgcmVtb3ZlLFxyXG4gICAgICAgICAgICBkZXN0cm95LFxyXG5cclxuICAgICAgICAgICAgaXNSZWFkeTogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzVXBsb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNVcGxvYWRlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzQ2FuY2VsOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNTdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNFcnJvcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHByb2dyZXNzOiAwLFxyXG5cclxuICAgICAgICAgICAgaXNIb3ZlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzT3ZlcmZsb3c6IGZhbHNlLFxyXG4gICAgICAgICAgICBfeGhyOiB7fSxcclxuICAgICAgICAgICAgaW5kZXg6IDAsXHJcbiAgICAgICAgICAgIF9mb3JtOiB1bmRlZmluZWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65paH5Lu25a+56LGh77yM57uf5LiASDXlkozpnZ5INeaDheWGteS4i+eahOaWh+S7tuS/oeaBr1xyXG4gICAgICogZmlsZSB7RmlsZUxpc3R8RmlsZUlucHV0fSDljp/lp4vmlofku7blr7nosaEgSDXkuLpmaWxl5a+56LGh5b2i5byP77yM6Z2eSDXkuLpmaWxlaW5wdXTlr7nosaFcclxuICAgICAqIHJldHVybiDnsbvmlofku7blr7nosaFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVGaWxlT2JqZWN0KGZpbGVUaGlzOiBhbnkpOiBUaUZpbGVJbmZvIHtcclxuICAgICAgICBpZiAoVGlVcGxvYWRVdGlsLmlzSFRNTDUpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZU5hbWU6IHN0cmluZyA9IGZpbGVUaGlzLm5hbWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogZmlsZVRoaXMubGFzdE1vZGlmaWVkRGF0ZSxcclxuICAgICAgICAgICAgICAgIHNpemU6IGZpbGVUaGlzLnNpemUsIC8vIOivu+WPlueahOaWh+S7tuecn+WunuWkp+Wwj+WAvCzljZXkvY3kuLpCXHJcbiAgICAgICAgICAgICAgICBzaXplV2l0aFVuaXQ6IFRpRmlsZUl0ZW1VdGlsLmZvcm1hdFNpemUoZmlsZVRoaXMuc2l6ZSksIC8vIOWBmuWNleS9jei9rOaNouWQjueahOaWh+S7tuWkp+Wwj++8jOaWueS+v+eVjOmdouivpuaDheaYvuekuuaYvuekulxyXG4gICAgICAgICAgICAgICAgbmFtZTogZmlsZVRoaXMubmFtZSxcclxuICAgICAgICAgICAgICAgIHR5cGU6IGZpbGVOYW1lLnNsaWNlKGZpbGVOYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKSwgLy8g56Gu5L+d5rWP6KeI5Zmo5b2i5byP55qE5LiA6Ie05oCnXHJcbiAgICAgICAgICAgICAgICBfZmlsZTogZmlsZVRoaXMsIC8vIOaWh+S7tuWvueixoe+8jOWPquWcqEg15pa55byP5LiL5pyJ5pWIXHJcbiAgICAgICAgICAgICAgICBfaW5wdXQ6IG51bGwgLy8g5paH5Lu2aW5wdXTlr7nosaHvvIzlj6rlnKhJRTkgZm9ybeihqOWNleaPkOS6pOaWueW8j+S4i+acieaViFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXRoOiBzdHJpbmcgPSBmaWxlVGhpcy52YWx1ZTtcclxuICAgICAgICAvLyDpnZ5INeaDheWGteS4iyzmtY/op4jlmajkuI3miZPlvIBBY3RpdmVYLOiOt+WPluS4jeWIsOaWh+S7tuWkp+Wwjyzor6Xnp43mg4XlhrXkuIvmlofku7blpKflsI/kuLpudWxsXHJcbiAgICAgICAgY29uc3QgZmlsZVNpemU6IG51bWJlciA9IFV0aWwuaXNVbmRlZmluZWQoZmlsZVRoaXMuc2l6ZSkgPyBudWxsIDogZmlsZVRoaXMuc2l6ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogbnVsbCwgLy8g6Z2eSDXmg4XlhrXkuIss6I635Y+W5LiN5Yiw6K+l5YC8XHJcbiAgICAgICAgICAgIHNpemU6IGZpbGVTaXplLFxyXG4gICAgICAgICAgICBzaXplV2l0aFVuaXQ6IGlzTmFOKGZpbGVTaXplKSA/ICcnIDogdGhpcy5mb3JtYXRTaXplKGZpbGVTaXplIC8gMTAyNCksIC8vIOWBmuWNleS9jei9rOaNouWQjueahOaWh+S7tuWkp+Wwj++8jOaWueS+v+eVjOmdouivpuaDheaYvuekuuaYvuekulxyXG4gICAgICAgICAgICBuYW1lOiBwYXRoLnNsaWNlKHBhdGgubGFzdEluZGV4T2YoJy8nKSArIHBhdGgubGFzdEluZGV4T2YoJ1xcXFwnKSArIDIpLFxyXG4gICAgICAgICAgICB0eXBlOiBwYXRoLnNsaWNlKHBhdGgubGFzdEluZGV4T2YoJy4nKSArIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIF9maWxlOiBudWxsLCAvLyDmlofku7blr7nosaHvvIzlj6rlnKhINeaWueW8j+S4i+acieaViFxyXG4gICAgICAgICAgICBfaW5wdXQ6IGZpbGVUaGlzIC8vIOaWh+S7tmlucHV05a+56LGh77yM5Y+q5ZyoSUU5IGZvcm3ooajljZXmj5DkuqTmlrnlvI/kuIvmnInmlYhcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5paH5Lu25aSn5bCP5pi+56S65qCH5YeG5YyW77ya5qC55o2u5paH5Lu25aSn5bCP5YGa5LiN5ZCM5Y2V5L2N55qE5pi+56S677yM5paH5Lu25aSn5bCP5L+d55WZ5Lik5L2N5bCP5pWwXHJcbiAgICAgKiDmlofku7blpKflsI9cclxuICAgICAqIOW4puWNleS9jeaWh+S7tuWkp+Wwj1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBmb3JtYXRTaXplKHNpemU6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IHNpemVXaXRoVW5pdDogc3RyaW5nO1xyXG4gICAgICAgIGNvbnN0IGtiU2l6ZTogbnVtYmVyID0gc2l6ZSAvIDEwMjQ7XHJcbiAgICAgICAgLyogdHNsaW50OmRpc2FibGU6cHJlZmVyLWNvbmRpdGlvbmFsLWV4cHJlc3Npb24gKi9cclxuICAgICAgICBpZiAoa2JTaXplIDwgMSkge1xyXG4gICAgICAgICAgICBzaXplV2l0aFVuaXQgPSBzaXplLnRvRml4ZWQoMikgKyAnQic7XHJcbiAgICAgICAgfSBlbHNlIGlmIChrYlNpemUgPCAxMDI0KSB7XHJcbiAgICAgICAgICAgIHNpemVXaXRoVW5pdCA9IGtiU2l6ZS50b0ZpeGVkKDIpICsgJ0tCJztcclxuICAgICAgICB9IGVsc2UgaWYgKGtiU2l6ZSA8IDEwMjQgKiAxMDI0KSB7XHJcbiAgICAgICAgICAgIHNpemVXaXRoVW5pdCA9IChrYlNpemUgLyAxMDI0KS50b0ZpeGVkKDIpICsgJ01CJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaXplV2l0aFVuaXQgPSAoa2JTaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMikgKyAnR0InO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNpemVXaXRoVW5pdDtcclxuICAgIH1cclxufVxyXG4iXX0=