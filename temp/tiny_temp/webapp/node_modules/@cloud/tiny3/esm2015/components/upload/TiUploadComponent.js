import { Component, ElementRef, Input, Renderer2, ViewChild } from '@angular/core';
import { TiUploadService } from '../../services/upload/TiUploadService';
import { Util } from '../../utils/Util';
import { TiOverflowService } from '../../services/overflow/TiOverflowService';
import { TiUploadbaseComponent } from './TiUploadbaseComponent';
/**
 * 该组件用于实现已设计好的交互完整的文件上传组件，包含两种样式：
 *
 * 1.带输入框的样式(type为inputField)
 *
 * 2.按钮样式(type为button)
 *
 * 如果以上两种样式不满足业务场景，可使用自定义方式实现，具体实现请参考[tiFileSelect]{@link ../directives/TiFileSelectDirective.html}
 *
 * <example-url>../tiny3demo/#/upload/upload-all</example-url>
 */
export class TiUploadComponent extends TiUploadbaseComponent {
    constructor(uploaderService, hostEle, renderer, tiOverflow) {
        super(hostEle, renderer);
        this.uploaderService = uploaderService;
        this.tiOverflow = tiOverflow;
        /**
         * 上传样式类型
         */
        this.type = 'inputField';
        /**
         * 是否自动聚焦，只适用于inputField类型
         */
        this.autofocus = false;
    }
    /**
     * @ignore 点击上传按钮触发事件
     */
    onSelectClick() {
        this.fileInput.nativeElement.click();
    }
    /**
     * @ignore
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 创建uploader实例
        const autoUpload = Util.isUndefined(this.autoUpload) ? true : this.autoUpload;
        this.uploadConfig.autoUpload = autoUpload;
        this.uploadInst = this.uploaderService.create(this.uploadConfig);
        this.placeholder = this.setPlaceholder();
        // 设置submit按钮的显示状态
        this.showSubmitButton = Util.isUndefined(this.showSubmitButton) ?
            !autoUpload : this.showSubmitButton;
        // 是否定义beforeRemoveItems事件
        this.isRemove = this.beforeRemoveItems.observers.length !== 0;
    }
    // tslint:disable-next-line:use-life-cycle-interface
    ngAfterViewInit() {
        super.ngAfterViewInit();
        // 处理autofocus
        if (this.autofocus === true) {
            this.focus();
        }
    }
    // 提供focus/blur方法，供外部调用
    /**
     * 聚焦方法，只适用于inputField类型
     */
    focus() {
        this.fileInput.nativeElement.nextElementSibling.focus();
    }
    /**
     * 失焦方法，只适用于inputField类型
     */
    blur() {
        this.fileInput.nativeElement.nextElementSibling.blur();
    }
    // 通过item元素的移入移出事件控制元素的hover状态，该hover状态会决定item中部分按钮的显示状态
    /**
     * @ignore
     */
    onItemMouseenter(item, event) {
        if (this.disabled) {
            return;
        }
        item.isHover = true;
        // 文件名超长溢出时，显示名称
        const fileNameEle = event.target.querySelector('.ti3-aui-file-name');
        item.isOverflow = this.tiOverflow.isOverflow(fileNameEle);
    }
    /**
     * @ignore
     */
    onItemMouseleave(item) {
        if (this.disabled) {
            return;
        }
        item.isHover = false;
    }
    // 获取上传文件状态，同时根据状态设置状态详细信息
    /**
     * @ignore
     */
    getUploadState() {
        let uploadingLen = 0;
        let uploadErrLen = 0;
        let uploadSuccLen = 0;
        this.uploadInst.queue.forEach((item) => {
            if (item.isUploading) {
                uploadingLen++;
            }
            else if (item.isError) {
                uploadErrLen++;
            }
            else if (item.isSuccess) {
                uploadSuccLen++;
            }
        });
        const fileQueueLen = this.uploadInst.queue.length;
        if (uploadSuccLen === fileQueueLen) {
            this.stateInfo = this.uploadLan.successInfo;
            return 'success';
        }
        if (uploadErrLen !== 0) {
            this.stateInfo = Util.formatEntry(this.uploadLan.errorMultiInfo, [uploadErrLen]);
            return 'error';
        }
        if (uploadingLen !== 0) {
            this.stateInfo = Util.formatEntry(this.uploadLan.uploadingMutiInfo, [`${uploadingLen}/${fileQueueLen}`]);
            return 'uploading';
        }
        this.stateInfo = Util.formatEntry(this.uploadLan.addSuccessMutiInfo, [fileQueueLen]);
        return 'addSuccess';
    }
    /**
     * 初始设置输入框内提示文本
     * 四种场景：自动单文件上传，自动多文件上传，手动单文件上传，手动多文件上传
     */
    setPlaceholder() {
        if (this.placeholder) {
            return this.placeholder;
        }
        if (this.autoUpload) {
            if (this.uploadInst.isSingleFile) {
                return this.uploadLan.autoUploadFilePlaceholder;
            }
            return this.uploadLan.autoUploadFilesPlaceholder;
        }
        if (this.uploadInst.isSingleFile) {
            return this.uploadLan.notAutoUploadFilePlaceholder;
        }
        return this.uploadLan.notAutoUploadFilesPlaceholder;
    }
}
TiUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-upload:not([type]), ti-upload[type="inputField"], ti-upload[type="button"]',
                template: "<div class=\"ti3-file-upload-container\" *ngIf=\"type === 'button'\">\r\n    <!-- IE\u4E0B\u4F7F\u7528button\u505A\u5BB9\u5668\uFF0C\u65E0\u6CD5\u505A\u70B9\u9009\u64CD\u4F5C\uFF0C\u56E0\u6B64\u4F7F\u7528div\u4EE3\u66FF -->\r\n    <div class=\"ti3-file-btn\" tiButton [tiDisabled]='disabled'>\r\n        <input class=\"ti3-file-input\" type=\"file\" [tiFileSelect]=\"uploadInst\" [title]=\"title\" [accept]=\"accept\"\r\n            [disabled]=\"disabled\" [multiple]=\"!uploadInst.isSingleFile\">\r\n        <span class=\"ti3-file-text\">{{buttonText || uploadLan.addFile}}</span>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"ti3-aui-file-container\" *ngIf=\"type !== 'button'\" [ngClass]=\"{'ti3-aui-file-disable': disabled}\">\r\n    <div class=\"clearfix\">\r\n        <div class=\"ti3-aui-file-field-container\" [style.width]=\"inputFieldWidth\">\r\n            <ul class=\"ti3-aui-file-items-container\" [id]=\"appendId('list')\">\r\n                <!-- \u6587\u4EF6\u540D\u79F0\u8D85\u957F\u6EA2\u51FA\u6216\u8005\u8BE5\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25\u65F6\uFF0C\u663E\u793Atip -->\r\n                <li class=\"ti3-aui-file-item\" *ngFor=\"let item of uploadInst.queue; index as i;\" [tiTip]=\"item.isOverflow || item.isError ? tipContent : ''\" [tiTipContext]='{\"item\": item}'\r\n                [tiTipPosition]=\"'top-left'\" (mouseenter)='onItemMouseenter(item, $event)' (mouseleave)='onItemMouseleave(item)' [id]=\"appendId('queue_' + i)\"\r\n                [ngClass]=\"{'ti3-aui-single-file-item': uploadInst.isSingleFile}\">\r\n                    <div class=\"ti3-aui-file-name-size-container\">\r\n                        <div class=\"ti3-aui-file-name\" [ngClass]=\"{'ti3-aui-file-state-general-info-error': item.isError}\">{{item.file.name}}</div>\r\n                        <div class=\"ti3-aui-file-size\">\r\n                            <span class=\"ti3-aui-file-size-brackets\">(</span>\r\n                            <span class=\"ti3-aui-file-item-size\">{{item.file.sizeWithUnit}}</span>\r\n                            <span class=\"ti3-aui-file-size-brackets\">)</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"ti3-aui-file-operates\">\r\n                            <div *ngIf=\"!item.isUploading && !item.isUploaded\">\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" [id]=\"appendId('remove_'+ i)\"></span>\r\n                            </div>\r\n                            <div *ngIf=\"item.isUploading\">\r\n                                <ti-progresspie [value]=\"item.progress\" [hidden]=\"item.isHover\" class=\"ti3-aui-file-progress-pie\">\r\n                                </ti-progresspie>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.cancel()\" *ngIf=\"item.isHover\" [id]=\"appendId('cancel_' + i)\"></span>\r\n                            </div>\r\n                            <div *ngIf=\"item.isSuccess\">\r\n                                <span class=\"ti3-aui-file-success ti3-icon ti3-icon-alert-success\" [hidden]=\"item.isHover\"></span>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" *ngIf=\"item.isHover\" [id]=\"appendId('success_remove_' + i)\"></span>\r\n                            </div>\r\n                           <div *ngIf=\"item.isError\" class=\"ti3-aui-file-error-state\">\r\n                                <span class=\"ti3-aui-file-error-reupload ti3-icon ti3-icon-refresh-1\" (click)=\"item.upload()\" *ngIf=\"!item.batchSend\" [id]=\"appendId('refresh_' + i)\"></span>\r\n                                <span class=\"ti3-aui-file-x ti3-icon ti3-icon-cancel\" (click)=\"item.remove(isRemove)\" [id]=\"appendId('error_remove_' + i)\"></span>\r\n                           </div>\r\n                        </div>\r\n                </li>\r\n                <li *ngIf=\"!uploadInst.queue.length\" class=\"ti3-aui-file-placeholder\" [id]=\"appendId('placeholder')\">{{placeholder}}</li>\r\n            </ul>\r\n\r\n        </div>\r\n\r\n        <!-- \u81EA\u52A8\u4E0A\u4F20\u6587\u4EF6/\u624B\u52A8\u6DFB\u52A0\u6587\u4EF6\u6309\u94AE -->\r\n        <div class=\"ti3-file-upload-btnCon\">\r\n                <input #fileInput type=\"file\" [tiFileSelect]=\"uploadInst\" class=\"ti3-aui-file-select-input\"\r\n                       [multiple]=\"!uploadInst.isSingleFile\"\r\n                       [title]=\"title\"\r\n                       [accept]=\"accept\"\r\n                       [id]=\"appendId('file')\">\r\n                <button tiButton type=\"button\" class=\"ti3-aui-upload-btn\"\r\n                        [disabled]=\"disabled\"\r\n                        (click)=\"onSelectClick()\"\r\n                        [id]=\"appendId('select')\">{{buttonText || autoUpload ? uploadLan.upload : uploadLan.addFile}}</button>\r\n        </div>\r\n\r\n         <!-- \u624B\u52A8\u4E0A\u4F20\u6587\u4EF6\u6309\u94AE -->\r\n        <span class=\"ti3-file-upload-btnCon\" *ngIf=\"showSubmitButton\">\r\n            <span class=\"ti3-file-upload-btn-cover\" *ngIf=\"disabled || !uploadInst.queue.length || uploadInst.isUploadedAll()\"></span>\r\n            <button tiButton type=\"button\"\r\n                    (click)=\"uploadInst.uploadAll()\"\r\n                    class=\"ti3-aui-upload-btn\"\r\n                    *ngIf=\"showSubmitButton\"\r\n                    [disabled]=\"disabled || !uploadInst.queue.length || uploadInst.isUploadedAll()\"\r\n                    [id]=\"appendId('uploadAll')\">{{buttonText || uploadLan.upload}}</button>\r\n        </span>\r\n    </div>\r\n    <div class=\"ti3-aui-file-state-general\" *ngIf=\"uploadInst.queue.length && !uploadInst.isSingleFile\" [style.width]=\"inputFieldWidth\">\r\n        <div *ngIf=\"getUploadState() === 'addSuccess'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-addSuccess\" >{{stateInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'uploading'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-uploading\">{{stateInfo}}</span>\r\n            <div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.cancelAll()\"[id]=\"appendId('cancel')\">{{uploadLan.cancel}}</div>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'success'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-success ti3-icon ti3-icon-check-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-success\">{{stateInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"getUploadState() === 'error'\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-error ti3-icon ti3-icon-exclamation-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-error\">{{stateInfo}}</span><!--\r\n            --><div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.reloadAllError()\" [id]=\"appendId('reload')\">{{uploadLan.reload}}</div>\r\n        </div>\r\n    </div>\r\n    <div class=\"ti3-aui-file-state-general\" *ngIf = \"uploadInst.queue.length && uploadInst.isSingleFile\"  [style.width]=\"inputFieldWidth\">\r\n        <div *ngIf=\"uploadInst.queue[0].isUploading\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-info-uploading\">{{uploadLan.uploadingSingleInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"uploadInst.queue[0].isSuccess\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-success ti3-icon ti3-icon-check-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-success\">{{uploadLan.successInfo}}</span>\r\n        </div>\r\n        <div *ngIf=\"uploadInst.queue[0].isError\" class=\"ti3-aui-file-state-general-info\">\r\n            <span class=\"ti3-aui-file-state-general-icon ti3-aui-file-state-general-error ti3-icon ti3-icon-exclamation-circle\"></span>\r\n            <span class=\"ti3-aui-file-state-general-info-error\">{{uploadLan.errorSingleInfo}}</span>\r\n            <div class=\"ti3-aui-file-state-general-operate\" (click)=\"uploadInst.reloadAllError()\" [id]=\"appendId('reload')\">{{uploadLan.reload}}</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- \u5355\u4E2Aitem tip\u5185\u5BB9\u663E\u793A\u6A21\u677F-->\r\n<ng-template #tipContent let-item=\"context.item\">\r\n    <ti-error-msg *ngIf='item.isError' [errorMessage]=\"item.errorInfo || uploadLan.error\"></ti-error-msg>\r\n    <span class=\"ti3-aui-file-tip-name\" *ngIf=\"item.isOverflow\">{{item.file.name}}</span>\r\n</ng-template>\r\n",
                styles: ["::ng-deep :root{--ti-upload-icon-size:16px;--ti-upload-item-container-padding-vertical:calc(var(--ti-upload-item-space)/2);--ti-upload-item-height:(var(--ti-upload-height) - 2*(var(--ti-upload-item-space)) - 2px);--ti-upload-item-operate-container-width:(var(--ti-upload-icon-size) * 2 + var(--ti-common-space-2x) * 2);--ti-upload-item-size-margin-left:var(--ti-common-space-base);--ti-upload-item-size-max-width:70px;--ti-upload-item-space:2px;--ti-upload-x-reupload-icon-color:var(--ti-common-color-icon-normal)}.ti3-file-detail-item{margin-top:20px;position:relative}.ti3-file-item-name{display:inline-block;max-width:40%;overflow:hidden;padding-left:10px;text-overflow:ellipsis;white-space:nowrap;width:40%}.ti3-file-item-info,.ti3-file-item-size{display:inline-block;max-width:20%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:20%}.ti3-file-detail-operate{bottom:18px;position:absolute;right:10px}.ti3-file-detail-operate-icon{cursor:pointer;font-size:15px;margin-left:5px}.ti3-file-progress{background-color:var(--ti-upload-progress-bg-color);color:var(--ti-upload-progerss-text-color);height:5px}.ti3-file-btn{overflow:hidden;position:relative}.ti3-file-input{bottom:0;cursor:pointer;font-size:1000px;margin:0;opacity:0;padding:0;position:absolute;right:0;z-index:1}.ti3-file-input[disabled]{cursor:not-allowed}.ti3-file-text{line-height:calc(var(--ti-button-middle-height) - 2px)}.ti3-aui-file-disable .ti3-aui-file-field-container{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);box-sizing:border-box;cursor:not-allowed}.ti3-aui-file-disable .ti3-aui-file-select-input{cursor:not-allowed}.ti3-aui-file-container{color:var(--ti-common-color-text-primary);font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number)}.ti3-aui-file-field-container{border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);float:left;position:relative;width:var(--ti-upload-field-default-width)}.ti3-aui-file-items-container{-ms-box-sizing:border-box;box-sizing:border-box;max-height:calc((var(--ti-upload-height) - 2px)*2 - var(--ti-upload-item-space));min-height:calc(var(--ti-upload-height) - 2px);overflow-x:hidden;overflow-y:auto;padding:var(--ti-upload-item-container-padding-vertical) 0;width:calc(100% - 2px)}.ti3-aui-file-item{-ms-box-sizing:border-box;background-color:var(--ti-upload-item-bg);box-sizing:border-box;cursor:pointer;display:flex;float:left;height:calc(var(--ti-upload-item-height));justify-content:space-between;line-height:calc(var(--ti-upload-item-height));margin:calc(var(--ti-upload-item-space)/2) 0 calc(var(--ti-upload-item-space)/2) var(--ti-upload-item-space);max-width:100%;padding:0 var(--ti-input-padding-horizontal)}.ti3-aui-file-item.ti3-aui-single-file-item{width:100%}.ti3-aui-file-name-size-container{display:flex;flex-shrink:0;width:calc(100% - var(--ti-upload-item-operate-container-width))}.ti3-aui-file-name{color:var(--ti-upload-item-name-color);height:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ti3-aui-file-size{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-upload-item-size-color);display:flex;flex-shrink:0;padding-left:var(--ti-upload-item-size-margin-left)}.ti3-aui-file-item-size{max-width:var(--ti-upload-item-size-max-width);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ti3-aui-file-operates{width:calc(var(--ti-upload-item-operate-container-width))}.ti3-aui-file-error-icon,.ti3-aui-file-error-reupload,.ti3-aui-file-success,.ti3-aui-file-x{color:var(--ti-upload-x-reupload-icon-color);float:right;font-size:var(--ti-upload-icon-size)}.ti3-aui-file-success{color:var(--ti-common-color-success)}.ti3-aui-file-error-icon,.ti3-aui-file-error-state .ti3-aui-file-x{margin-right:var(--ti-common-space-2x)}.ti3-aui-file-error-icon{color:var(--ti-common-color-error)}.ti3-aui-file-progress-pie{float:right;height:var(--ti-upload-icon-size);position:relative;top:calc((var(--ti-upload-item-height) - var(--ti-upload-icon-size))/2);width:var(--ti-upload-icon-size)}.ti3-aui-file-select-input{height:0;opacity:0;width:0}.ti3-aui-file-tip-name{display:inline-block;font-size:var(--ti-common-font-size-base);margin-top:var(--ti-common-space-base)}.ti3-aui-file-placeholder{color:var(--ti-input-placeholder-color);line-height:calc(var(--ti-upload-height) - 2px - var(--ti-upload-item-container-padding-vertical)*2);padding-left:var(--ti-input-padding-horizontal)}.ti3-aui-upload-btn{float:left;height:var(--ti-upload-height);margin-left:var(--ti-common-space-2x)}.ti3-aui-file-state-general{margin-top:var(--ti-common-space-2x)}.ti3-aui-file-state-general-info{align-items:center;display:flex}.ti3-aui-file-state-general-info-addSuccess,.ti3-aui-file-state-general-info-uploading{color:var(--ti-common-color-text-weaken)}.ti3-aui-file-state-general-info-error{color:var(--ti-common-color-error-text)}.ti3-aui-file-state-general-info-success{color:var(--ti-common-color-text-primary)}.ti3-aui-file-state-general-operate{color:var(--ti-upload-state-general-operate-color);cursor:pointer;display:inline-block;margin-left:var(--ti-common-space-base);vertical-align:middle}.ti3-aui-file-state-general-operate:hover{color:var(--ti-upload-state-general-operate-color-hover)}.ti3-aui-file-state-general-error,.ti3-aui-file-state-general-success{color:var(--ti-common-color-success);font-size:var(--ti-upload-icon-size);line-height:18px;margin-right:var(--ti-common-space-2x)}.ti3-aui-file-state-general-error{color:var(--ti-common-color-error)}.ti3-file-upload-btnCon{float:left;position:relative}.ti3-file-upload-btn-cover{bottom:0;cursor:not-allowed;left:var(--ti-common-space-2x);position:absolute;right:0;top:0}.ti3-file-upload-container .ti3-btn-default:not(:focus):not([disabled]):hover,.ti3-file-upload-container [ti-button]:not(:focus):not([disabled]):hover{animation:none}"]
            },] }
];
TiUploadComponent.ctorParameters = () => [
    { type: TiUploadService },
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiOverflowService }
];
TiUploadComponent.propDecorators = {
    type: [{ type: Input }],
    buttonText: [{ type: Input }],
    inputFieldWidth: [{ type: Input }],
    showSubmitButton: [{ type: Input }],
    placeholder: [{ type: Input }],
    autofocus: [{ type: Input }],
    fileInput: [{ type: ViewChild, args: ['fileInput',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlVcGxvYWRDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy91cGxvYWQvVGlVcGxvYWRDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbkYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUM5RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUVoRTs7Ozs7Ozs7OztHQVVHO0FBT0gsTUFBTSxPQUFPLGlCQUFrQixTQUFRLHFCQUFxQjtJQUN4RCxZQUFvQixlQUFnQyxFQUFFLE9BQW1CLEVBQUUsUUFBbUIsRUFDMUUsVUFBNkI7UUFDN0MsS0FBSyxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUZULG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxlQUFVLEdBQVYsVUFBVSxDQUFtQjtRQUdqRDs7V0FFRztRQUNNLFNBQUksR0FBMEIsWUFBWSxDQUFDO1FBeUJwRDs7V0FFRztRQUNNLGNBQVMsR0FBWSxLQUFLLENBQUM7SUFoQ3BDLENBQUM7SUE2Q0Q7O09BRUc7SUFDSCxhQUFhO1FBQ1QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUNEOztPQUVHO0lBQ0gscURBQXFEO0lBQ3JELFFBQVE7UUFDSixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsZUFBZTtRQUNmLE1BQU0sVUFBVSxHQUFZLElBQUksQ0FBQyxX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QUMsNkJBQTZCLENBQUM7SUFDeEQsQ0FBQzs7O1lBcExKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsK0VBQStFO2dCQUN6RiwyeVJBQTRCOzthQUUvQjs7O1lBcEJRLGVBQWU7WUFGSixVQUFVO1lBQVMsU0FBUztZQUl2QyxpQkFBaUI7OzttQkE0QnJCLEtBQUs7eUJBUUwsS0FBSzs4QkFNTCxLQUFLOytCQU1MLEtBQUs7MEJBSUwsS0FBSzt3QkFJTCxLQUFLO3dCQUlMLFNBQVMsU0FBQyxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgUmVuZGVyZXIyLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlGaWxlSXRlbSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3VwbG9hZC9UaUZpbGVJbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBUaVVwbG9hZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy91cGxvYWQvVGlVcGxvYWRTZXJ2aWNlJztcclxuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaU92ZXJmbG93U2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL292ZXJmbG93L1RpT3ZlcmZsb3dTZXJ2aWNlJztcclxuaW1wb3J0IHsgVGlVcGxvYWRiYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9UaVVwbG9hZGJhc2VDb21wb25lbnQnO1xyXG5cclxuLyoqXHJcbiAqIOivpee7hOS7tueUqOS6juWunueOsOW3suiuvuiuoeWlveeahOS6pOS6kuWujOaVtOeahOaWh+S7tuS4iuS8oOe7hOS7tu+8jOWMheWQq+S4pOenjeagt+W8j++8mlxyXG4gKlxyXG4gKiAxLuW4pui+k+WFpeahhueahOagt+W8jyh0eXBl5Li6aW5wdXRGaWVsZClcclxuICpcclxuICogMi7mjInpkq7moLflvI8odHlwZeS4umJ1dHRvbilcclxuICpcclxuICog5aaC5p6c5Lul5LiK5Lik56eN5qC35byP5LiN5ruh6Laz5Lia5Yqh5Zy65pmv77yM5Y+v5L2/55So6Ieq5a6a5LmJ5pa55byP5a6e546w77yM5YW35L2T5a6e546w6K+35Y+C6ICDW3RpRmlsZVNlbGVjdF17QGxpbmsgLi4vZGlyZWN0aXZlcy9UaUZpbGVTZWxlY3REaXJlY3RpdmUuaHRtbH1cclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL3VwbG9hZC91cGxvYWQtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0aS11cGxvYWQ6bm90KFt0eXBlXSksIHRpLXVwbG9hZFt0eXBlPVwiaW5wdXRGaWVsZFwiXSwgdGktdXBsb2FkW3R5cGU9XCJidXR0b25cIl0nLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3VwbG9hZC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3VwbG9hZC5sZXNzJ11cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUaVVwbG9hZENvbXBvbmVudCBleHRlbmRzIFRpVXBsb2FkYmFzZUNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHVwbG9hZGVyU2VydmljZTogVGlVcGxvYWRTZXJ2aWNlLCBob3N0RWxlOiBFbGVtZW50UmVmLCByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0aU92ZXJmbG93OiBUaU92ZXJmbG93U2VydmljZSkge1xyXG4gICAgICAgIHN1cGVyKGhvc3RFbGUsIHJlbmRlcmVyKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LiK5Lyg5qC35byP57G75Z6LXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHR5cGU6ICdpbnB1dEZpZWxkJ3wnYnV0dG9uJyA9ICdpbnB1dEZpZWxkJztcclxuICAgIC8qKlxyXG4gICAgICog5oyJ6ZKu55qE6YWN572uXHJcbiAgICAgKlxyXG4gICAgICogdHlwZeS4umJ1dHRvbuW9ouW8j+aXtizkuLrmlofku7bpgInmi6nmjInpkq7mloflrZfvvJtcclxuICAgICAqXHJcbiAgICAgKiB0eXBl5Li6aW5wdXRGaWVsZOaXtizkuLrkuIrkvKDmjInpkq7mloflrZdcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgYnV0dG9uVGV4dDogc3RyaW5nOyAvLyDmjInpkq7nmoTphY3nva4sdHlwZeS4umJ1dHRvbuW9ouW8j+aXtizkuLrmlofku7bpgInmi6nmjInpkq7mloflrZfvvJt0eXBl5Li6aW5wdXRGaWVsZOaXtizkuLrkuIrkvKDmjInpkq7mloflrZdcclxuXHJcbiAgICAvLyBpbnB1dEZpZWxk5b2i5byP5paH5Lu25LiK5Lyg55qE55u45YWz6YWN572uXHJcbiAgICAvKipcclxuICAgICAqIOmAieaLqei+k+WFpeahhuWuveW6puiuvue9ru+8jOWPqumAgueUqOS6jmlucHV0RmllbGTnsbvlnovvvIzmlbDmja7nsbvlnovlkIxjc3Mgd2lkdGjlsZ7mgKforr7nva5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaW5wdXRGaWVsZFdpZHRoOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYvuekuuaPkOS6pOaMiemSru+8jOWPqumAgueUqOS6jmlucHV0RmllbGTnsbvlnotcclxuICAgICAqXHJcbiAgICAgKiDpu5jorqTlgLzkuI5hdXRvVXBsb2Fk5YC855u45YWz77yM5b2TYXV0b1VwbG9hZOS4unRydWXml7bvvIzkuI3mmL7npLrvvJvlj43kuYvliJnmmL7npLpcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgc2hvd1N1Ym1pdEJ1dHRvbjogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICog6L6T5YWl5o+Q56S677yM5Y+q6YCC55So5LqOaW5wdXRGaWVsZOexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKboh6rliqjogZrnhKbvvIzlj6rpgILnlKjkuo5pbnB1dEZpZWxk57G75Z6LXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGF1dG9mb2N1czogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbGVJbnB1dCcpIGZpbGVJbnB1dDogYW55O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOWkmuaWh+S7tuS4iuS8oOeahOeKtuaAgeaPkOekuuS/oeaBr1xyXG4gICAgICovXHJcbiAgICBzdGF0ZUluZm86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDmmK/lkKblrprkuYliZWZvcmVSZW1vdmVJdGVtc+S6i+S7tlxyXG4gICAgICovXHJcbiAgICBpc1JlbW92ZTogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDngrnlh7vkuIrkvKDmjInpkq7op6blj5Hkuovku7ZcclxuICAgICAqL1xyXG4gICAgb25TZWxlY3RDbGljaygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZpbGVJbnB1dC5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5Yib5bu6dXBsb2FkZXLlrp7kvotcclxuICAgICAgICBjb25zdCBhdXRvVXBsb2FkOiBib29sZWFuID0gVXRpbC5pc1VuZGVmaW5lZCh0aGlzLmF1dG9VcGxvYWQpID8gdHJ1ZSA6IHRoaXMuYXV0b1VwbG9hZDtcclxuICAgICAgICB0aGlzLnVwbG9hZENvbmZpZy5hdXRvVXBsb2FkID0gYXV0b1VwbG9hZDtcclxuICAgICAgICB0aGlzLnVwbG9hZEluc3QgPSB0aGlzLnVwbG9hZGVyU2VydmljZS5jcmVhdGUodGhpcy51cGxvYWRDb25maWcpO1xyXG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLnNldFBsYWNlaG9sZGVyKCk7XHJcbiAgICAgICAgLy8g6K6+572uc3VibWl05oyJ6ZKu55qE5pi+56S654q25oCBXHJcbiAgICAgICAgdGhpcy5zaG93U3VibWl0QnV0dG9uID0gVXRpbC5pc1VuZGVmaW5lZCh0aGlzLnNob3dTdWJtaXRCdXR0b24pID9cclxuICAgICAgICAgICAgIWF1dG9VcGxvYWQgOiB0aGlzLnNob3dTdWJtaXRCdXR0b247XHJcbiAgICAgICAgLy8g5piv5ZCm5a6a5LmJYmVmb3JlUmVtb3ZlSXRlbXPkuovku7ZcclxuICAgICAgICB0aGlzLmlzUmVtb3ZlID0gdGhpcy5iZWZvcmVSZW1vdmVJdGVtcy5vYnNlcnZlcnMubGVuZ3RoICE9PSAwO1xyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnVzZS1saWZlLWN5Y2xlLWludGVyZmFjZVxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xyXG4gICAgICAgIC8vIOWkhOeQhmF1dG9mb2N1c1xyXG4gICAgICAgIGlmICh0aGlzLmF1dG9mb2N1cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g5o+Q5L6bZm9jdXMvYmx1cuaWueazle+8jOS+m+WklumDqOiwg+eUqFxyXG4gICAgLyoqXHJcbiAgICAgKiDogZrnhKbmlrnms5XvvIzlj6rpgILnlKjkuo5pbnB1dEZpZWxk57G75Z6LXHJcbiAgICAgKi9cclxuICAgIGZvY3VzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZmlsZUlucHV0Lm5hdGl2ZUVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nLmZvY3VzKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWkseeEpuaWueazle+8jOWPqumAgueUqOS6jmlucHV0RmllbGTnsbvlnotcclxuICAgICAqL1xyXG4gICAgYmx1cigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZpbGVJbnB1dC5uYXRpdmVFbGVtZW50Lm5leHRFbGVtZW50U2libGluZy5ibHVyKCk7XHJcbiAgICB9XHJcbiAgICAvLyDpgJrov4dpdGVt5YWD57Sg55qE56e75YWl56e75Ye65LqL5Lu25o6n5Yi25YWD57Sg55qEaG92ZXLnirbmgIHvvIzor6Vob3ZlcueKtuaAgeS8muWGs+Wumml0ZW3kuK3pg6jliIbmjInpkq7nmoTmmL7npLrnirbmgIFcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBvbkl0ZW1Nb3VzZWVudGVyKGl0ZW06IFRpRmlsZUl0ZW0sIGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW0uaXNIb3ZlciA9IHRydWU7XHJcbiAgICAgICAgLy8g5paH5Lu25ZCN6LaF6ZW/5rqi5Ye65pe277yM5pi+56S65ZCN56ewXHJcbiAgICAgICAgY29uc3QgZmlsZU5hbWVFbGU6IEVsZW1lbnQgPSBldmVudC50YXJnZXQucXVlcnlTZWxlY3RvcignLnRpMy1hdWktZmlsZS1uYW1lJyk7XHJcbiAgICAgICAgaXRlbS5pc092ZXJmbG93ID0gdGhpcy50aU92ZXJmbG93LmlzT3ZlcmZsb3coZmlsZU5hbWVFbGUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIG9uSXRlbU1vdXNlbGVhdmUoaXRlbTogVGlGaWxlSXRlbSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaXRlbS5pc0hvdmVyID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvLyDojrflj5bkuIrkvKDmlofku7bnirbmgIHvvIzlkIzml7bmoLnmja7nirbmgIHorr7nva7nirbmgIHor6bnu4bkv6Hmga9cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBnZXRVcGxvYWRTdGF0ZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCB1cGxvYWRpbmdMZW46IG51bWJlciA9IDA7XHJcbiAgICAgICAgbGV0IHVwbG9hZEVyckxlbjogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgdXBsb2FkU3VjY0xlbjogbnVtYmVyID0gMDtcclxuICAgICAgICB0aGlzLnVwbG9hZEluc3QucXVldWUuZm9yRWFjaCgoaXRlbTogVGlGaWxlSXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5pc1VwbG9hZGluZykge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkaW5nTGVuKys7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pc0Vycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRFcnJMZW4rKztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlzU3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkU3VjY0xlbisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZmlsZVF1ZXVlTGVuOiBudW1iZXIgPSB0aGlzLnVwbG9hZEluc3QucXVldWUubGVuZ3RoO1xyXG4gICAgICAgIGlmICh1cGxvYWRTdWNjTGVuID09PSBmaWxlUXVldWVMZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZUluZm8gPSB0aGlzLnVwbG9hZExhbi5zdWNjZXNzSW5mbztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAnc3VjY2Vzcyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1cGxvYWRFcnJMZW4gIT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZUluZm8gPSBVdGlsLmZvcm1hdEVudHJ5KHRoaXMudXBsb2FkTGFuLmVycm9yTXVsdGlJbmZvLCBbdXBsb2FkRXJyTGVuXSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJ2Vycm9yJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHVwbG9hZGluZ0xlbiAhPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlSW5mbyA9IFV0aWwuZm9ybWF0RW50cnkodGhpcy51cGxvYWRMYW4udXBsb2FkaW5nTXV0aUluZm8sIFtgJHt1cGxvYWRpbmdMZW59LyR7ZmlsZVF1ZXVlTGVufWBdKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAndXBsb2FkaW5nJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdGF0ZUluZm8gPSBVdGlsLmZvcm1hdEVudHJ5KHRoaXMudXBsb2FkTGFuLmFkZFN1Y2Nlc3NNdXRpSW5mbywgW2ZpbGVRdWV1ZUxlbl0pO1xyXG5cclxuICAgICAgICByZXR1cm4gJ2FkZFN1Y2Nlc3MnO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vorr7nva7ovpPlhaXmoYblhoXmj5DnpLrmlofmnKxcclxuICAgICAqIOWbm+enjeWcuuaZr++8muiHquWKqOWNleaWh+S7tuS4iuS8oO+8jOiHquWKqOWkmuaWh+S7tuS4iuS8oO+8jOaJi+WKqOWNleaWh+S7tuS4iuS8oO+8jOaJi+WKqOWkmuaWh+S7tuS4iuS8oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldFBsYWNlaG9sZGVyKCk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5hdXRvVXBsb2FkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVwbG9hZEluc3QuaXNTaW5nbGVGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRMYW4uYXV0b1VwbG9hZEZpbGVQbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkTGFuLmF1dG9VcGxvYWRGaWxlc1BsYWNlaG9sZGVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMudXBsb2FkSW5zdC5pc1NpbmdsZUZpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkTGFuLm5vdEF1dG9VcGxvYWRGaWxlUGxhY2Vob2xkZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRMYW4ubm90QXV0b1VwbG9hZEZpbGVzUGxhY2Vob2xkZXI7XHJcbiAgICB9XHJcbn1cclxuIl19