import { Component, ElementRef, EventEmitter, Input, Output, Renderer2, } from '@angular/core';
import { TiBrowser, Util } from '../../utils/Util';
import { TiTableComponent } from './TiTableComponent';
/**
 * TiDetailsIcon 详情展开图标组件
 *
 * ti-details-icon 用来显示详情展开图标，其嵌在详情展开列的 td 标签中；
 * 点击该图标，对应详情行在展开/收起两个状态之间切换。
 */
export class TiDetailsIconComponent {
    constructor(table, elementRef, renderer) {
        this.table = table;
        this.elementRef = elementRef;
        this.renderer = renderer;
        /**
         * 点击详情展开图标时触发此接口函数，其中showDetails属性控制其是否展开；
         *
         * 一旦使用此接口，就由开发者决定其是否要展开或收起。
         */
        this.beforeToggle = new EventEmitter();
        this.oldShowDetails = false;
        this.element = this.elementRef.nativeElement;
    }
    ngOnInit() {
        this.row = Util.isUndefined(this.row) ? {} : this.row;
        this.row.showDetails = Util.isUndefined(this.row.showDetails) ? false : this.row.showDetails;
        // 给当前行添加样式类标记
        const parentTr = this.renderer.parentNode(this.renderer.parentNode(this.element));
        this.renderer.addClass(parentTr, TiDetailsIconComponent.TABLE_ClASS_DETAIL_BASE);
    }
    ngDoCheck() {
        // 如果需要关闭其它行的详情(即只能展开一行的详情)时，需要监听showDetails
        if (this.table.closeOtherDetails && this.row.showDetails !== this.oldShowDetails) {
            this.oldShowDetails = this.row.showDetails;
            if (this.row.showDetails) {
                // 当打开当前行的详情时，关闭其他行的详情
                this.table.closeOtherDetailsFn(this.row);
            }
        }
    }
    /**
     * @ignore
     */
    onClick() {
        if (this.beforeToggle.observers.length > 0) {
            this.beforeToggle.emit(this.row);
        }
        else {
            this.row.showDetails = !this.row.showDetails;
        }
        // 为了解决 codeclub #1720
        // 在chrome浏览器下，滚动条滚到底部后，这时页面内容高度变小，滚动条保留在底部(正常的现象),
        // 之后页面内容高度再变大时，滚动条依然保留在底部。
        // 这导致了当页面滚动条拖动到底部后，将表格的pagesize由大变小(如20条修改为10条)，再去点击某一行详情展开时，
        // 视觉上详情行是向上展开的，其原因是滚动条一直停留在底部；这时，只要稍微手动触发滚动条滚动，详情正常展开
        // 注意：此问题只修复了在body上出滚动条的表格的详情展开问题。
        if (TiBrowser.isChrome()) {
            const scrollTop = Math.ceil(document.documentElement.scrollTop);
            // 窗口可视区域高度
            const height = document.documentElement.clientHeight;
            const scrollHeight = document.body.scrollHeight;
            if (scrollTop > 0 && scrollTop + height >= scrollHeight) {
                document.body.scrollTop = scrollTop - 0.5;
                document.body.scrollTop = scrollTop + 0.5;
            }
        }
    }
}
/**
 * @ignore
 * 表格详情中，非详情行标记样式类
 */
TiDetailsIconComponent.TABLE_ClASS_DETAIL_BASE = 'ti3-table-detail-icon-tr';
TiDetailsIconComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-details-icon',
                template: "<a href=\"javascript:void(0)\" oncontextmenu=\"return false\" class=\"ti3-toggle-details\">\r\n    <i style=\"line-height: 18px;\" class=\"ti3-icon ti3-icon-angle-right\"\r\n       [ngClass]=\"{'ti3-icon-angle-transform-down-thin': !row.showDetails,'ti3-icon-angle-transform-up-thin': row.showDetails}\"></i>\r\n</a>",
                host: {
                    '(click)': 'onClick()'
                }
            },] }
];
TiDetailsIconComponent.ctorParameters = () => [
    { type: TiTableComponent },
    { type: ElementRef },
    { type: Renderer2 }
];
TiDetailsIconComponent.propDecorators = {
    row: [{ type: Input }],
    index: [{ type: Input }],
    beforeToggle: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlEZXRhaWxzSWNvbkNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL3RhYmxlL1RpRGV0YWlsc0ljb25Db21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGdCQUFnQixFQUFrQixNQUFNLG9CQUFvQixDQUFDO0FBQ3RFOzs7OztHQUtHO0FBU0gsTUFBTSxPQUFPLHNCQUFzQjtJQXNCL0IsWUFBb0IsS0FBdUIsRUFBVSxVQUFzQixFQUN2RCxRQUFtQjtRQURuQixVQUFLLEdBQUwsS0FBSyxDQUFrQjtRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdkQsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQVR2Qzs7OztXQUlHO1FBQ2dCLGlCQUFZLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDM0UsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFJcEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztJQUNqRCxDQUFDO0lBRUQsUUFBUTtRQUNKLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztRQUN0RCxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7UUFDN0YsY0FBYztRQUNkLE1BQU0sUUFBUSxHQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxzQkFBc0IsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFFRCxTQUFTO1FBQ0wsNENBQTRDO1FBQzVDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQzlFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7WUFDM0MsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRTtnQkFDdEIsc0JBQXNCO2dCQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUM1QztTQUNKO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksT0FBTztRQUNWLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDcEM7YUFBTTtZQUNILElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7U0FDaEQ7UUFFRCxzQkFBc0I7UUFDdEIsbURBQW1EO1FBQ25ELDJCQUEyQjtRQUMzQiw4REFBOEQ7UUFDOUQsc0RBQXNEO1FBQ3RELGtDQUFrQztRQUNsQyxJQUFJLFNBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUN0QixNQUFNLFNBQVMsR0FBVyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDeEUsV0FBVztZQUNYLE1BQU0sTUFBTSxHQUFXLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDO1lBQzdELE1BQU0sWUFBWSxHQUFXLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3hELElBQUksU0FBUyxHQUFHLENBQUMsSUFBSSxTQUFTLEdBQUcsTUFBTSxJQUFJLFlBQVksRUFBRTtnQkFDckQsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQztnQkFDMUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQzthQUM3QztTQUNKO0lBQ0wsQ0FBQzs7QUF2RUQ7OztHQUdHO0FBQ1csOENBQXVCLEdBQVcsMEJBQTBCLENBQUM7O1lBYjlFLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQix3VUFBa0M7Z0JBQ2xDLElBQUksRUFBRTtvQkFDRixTQUFTLEVBQUUsV0FBVztpQkFDekI7YUFDRjs7O1lBYlEsZ0JBQWdCO1lBUnZCLFVBQVU7WUFLVixTQUFTOzs7a0JBMkJOLEtBQUs7b0JBSUwsS0FBSzsyQkFNTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgRG9DaGVjayxcclxuICBFbGVtZW50UmVmLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBJbnB1dCxcclxuICBPbkluaXQsXHJcbiAgT3V0cHV0LFxyXG4gIFJlbmRlcmVyMixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlCcm93c2VyLCBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFRpVGFibGVDb21wb25lbnQsIFRpVGFibGVSb3dEYXRhIH0gZnJvbSAnLi9UaVRhYmxlQ29tcG9uZW50JztcclxuLyoqXHJcbiAqIFRpRGV0YWlsc0ljb24g6K+m5oOF5bGV5byA5Zu+5qCH57uE5Lu2XHJcbiAqXHJcbiAqIHRpLWRldGFpbHMtaWNvbiDnlKjmnaXmmL7npLror6bmg4XlsZXlvIDlm77moIfvvIzlhbbltYzlnKjor6bmg4XlsZXlvIDliJfnmoQgdGQg5qCH562+5Lit77ybXHJcbiAqIOeCueWHu+ivpeWbvuagh++8jOWvueW6lOivpuaDheihjOWcqOWxleW8gC/mlLbotbfkuKTkuKrnirbmgIHkuYvpl7TliIfmjaLjgIJcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndGktZGV0YWlscy1pY29uJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZGV0YWlscy1pY29uLmh0bWwnLFxyXG4gIGhvc3Q6IHtcclxuICAgICAgJyhjbGljayknOiAnb25DbGljaygpJ1xyXG4gIH1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUaURldGFpbHNJY29uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBEb0NoZWNrIHtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6KGo5qC86K+m5oOF5Lit77yM6Z2e6K+m5oOF6KGM5qCH6K6w5qC35byP57G7XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgVEFCTEVfQ2xBU1NfREVUQUlMX0JBU0U6IHN0cmluZyA9ICd0aTMtdGFibGUtZGV0YWlsLWljb24tdHInO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY3ooYzmlbDmja5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgcm93OiBUaVRhYmxlUm93RGF0YTtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6KGM57Si5byV5YC877yM5Y2zIG5nRm9y55qE5a+55bqU55qEaW5kZXhcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaW5kZXg6IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICog54K55Ye76K+m5oOF5bGV5byA5Zu+5qCH5pe26Kem5Y+R5q2k5o6l5Y+j5Ye95pWw77yM5YW25Litc2hvd0RldGFpbHPlsZ7mgKfmjqfliLblhbbmmK/lkKblsZXlvIDvvJtcclxuICAgICAqXHJcbiAgICAgKiDkuIDml6bkvb/nlKjmraTmjqXlj6PvvIzlsLHnlLHlvIDlj5HogIXlhrPlrprlhbbmmK/lkKbopoHlsZXlvIDmiJbmlLbotbfjgIJcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IGJlZm9yZVRvZ2dsZTogRXZlbnRFbWl0dGVyPFRpVGFibGVSb3dEYXRhPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHByaXZhdGUgb2xkU2hvd0RldGFpbHM6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZWxlbWVudDogYW55O1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0YWJsZTogVGlUYWJsZUNvbXBvbmVudCwgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yb3cgPSBVdGlsLmlzVW5kZWZpbmVkKHRoaXMucm93KSA/IHt9IDogdGhpcy5yb3c7XHJcbiAgICAgICAgdGhpcy5yb3cuc2hvd0RldGFpbHMgPSBVdGlsLmlzVW5kZWZpbmVkKHRoaXMucm93LnNob3dEZXRhaWxzKSA/IGZhbHNlIDogdGhpcy5yb3cuc2hvd0RldGFpbHM7XHJcbiAgICAgICAgLy8g57uZ5b2T5YmN6KGM5re75Yqg5qC35byP57G75qCH6K6wXHJcbiAgICAgICAgY29uc3QgcGFyZW50VHI6IGFueSA9IHRoaXMucmVuZGVyZXIucGFyZW50Tm9kZSh0aGlzLnJlbmRlcmVyLnBhcmVudE5vZGUodGhpcy5lbGVtZW50KSk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhwYXJlbnRUciwgVGlEZXRhaWxzSWNvbkNvbXBvbmVudC5UQUJMRV9DbEFTU19ERVRBSUxfQkFTRSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdEb0NoZWNrKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOWmguaenOmcgOimgeWFs+mXreWFtuWug+ihjOeahOivpuaDhSjljbPlj6rog73lsZXlvIDkuIDooYznmoTor6bmg4Up5pe277yM6ZyA6KaB55uR5ZCsc2hvd0RldGFpbHNcclxuICAgICAgICBpZiAodGhpcy50YWJsZS5jbG9zZU90aGVyRGV0YWlscyAmJiB0aGlzLnJvdy5zaG93RGV0YWlscyAhPT0gdGhpcy5vbGRTaG93RGV0YWlscykge1xyXG4gICAgICAgICAgICB0aGlzLm9sZFNob3dEZXRhaWxzID0gdGhpcy5yb3cuc2hvd0RldGFpbHM7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvdy5zaG93RGV0YWlscykge1xyXG4gICAgICAgICAgICAgICAgLy8g5b2T5omT5byA5b2T5YmN6KGM55qE6K+m5oOF5pe277yM5YWz6Zet5YW25LuW6KGM55qE6K+m5oOFXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhYmxlLmNsb3NlT3RoZXJEZXRhaWxzRm4odGhpcy5yb3cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGljaygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5iZWZvcmVUb2dnbGUub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5iZWZvcmVUb2dnbGUuZW1pdCh0aGlzLnJvdyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yb3cuc2hvd0RldGFpbHMgPSAhdGhpcy5yb3cuc2hvd0RldGFpbHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDkuLrkuobop6PlhrMgY29kZWNsdWIgIzE3MjBcclxuICAgICAgICAvLyDlnKhjaHJvbWXmtY/op4jlmajkuIvvvIzmu5rliqjmnaHmu5rliLDlupXpg6jlkI7vvIzov5nml7bpobXpnaLlhoXlrrnpq5jluqblj5jlsI/vvIzmu5rliqjmnaHkv53nlZnlnKjlupXpg6go5q2j5bi455qE546w6LGhKSxcclxuICAgICAgICAvLyDkuYvlkI7pobXpnaLlhoXlrrnpq5jluqblho3lj5jlpKfml7bvvIzmu5rliqjmnaHkvp3nhLbkv53nlZnlnKjlupXpg6jjgIJcclxuICAgICAgICAvLyDov5nlr7zoh7TkuoblvZPpobXpnaLmu5rliqjmnaHmi5bliqjliLDlupXpg6jlkI7vvIzlsIbooajmoLznmoRwYWdlc2l6ZeeUseWkp+WPmOWwjyjlpoIyMOadoeS/ruaUueS4ujEw5p2hKe+8jOWGjeWOu+eCueWHu+afkOS4gOihjOivpuaDheWxleW8gOaXtu+8jFxyXG4gICAgICAgIC8vIOinhuinieS4iuivpuaDheihjOaYr+WQkeS4iuWxleW8gOeahO+8jOWFtuWOn+WboOaYr+a7muWKqOadoeS4gOebtOWBnOeVmeWcqOW6lemDqO+8m+i/meaXtu+8jOWPquimgeeojeW+ruaJi+WKqOinpuWPkea7muWKqOadoea7muWKqO+8jOivpuaDheato+W4uOWxleW8gFxyXG4gICAgICAgIC8vIOazqOaEj++8muatpOmXrumimOWPquS/ruWkjeS6huWcqGJvZHnkuIrlh7rmu5rliqjmnaHnmoTooajmoLznmoTor6bmg4XlsZXlvIDpl67popjjgIJcclxuICAgICAgICBpZiAoVGlCcm93c2VyLmlzQ2hyb21lKCkpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsVG9wOiBudW1iZXIgPSBNYXRoLmNlaWwoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCk7XHJcbiAgICAgICAgICAgIC8vIOeql+WPo+WPr+inhuWMuuWfn+mrmOW6plxyXG4gICAgICAgICAgICBjb25zdCBoZWlnaHQ6IG51bWJlciA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbEhlaWdodDogbnVtYmVyID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7XHJcbiAgICAgICAgICAgIGlmIChzY3JvbGxUb3AgPiAwICYmIHNjcm9sbFRvcCArIGhlaWdodCA+PSBzY3JvbGxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wIC0gMC41O1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBzY3JvbGxUb3AgKyAwLjU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19