import { ChangeDetectorRef, Component, ElementRef, Input, Renderer2 } from '@angular/core';
import { Util } from '../../utils/Util';
import { TiBaseComponent } from '../base/TiBaseModule';
/**
 * 本组件实现对多个表单元素的布局，支持单列和多列布局。
 * 其中包含了tiFormfield、tiItem、tiItemLabel和tiButtonItem几个组件。
 *
 * <example-url>../tiny3demo/#/formfield/formfield-all</example-url>
 */
export class TiFormfieldComponent extends TiBaseComponent {
    constructor(hostRef, renderer, changeDetector) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.changeDetector = changeDetector;
        /**
         * 设置表单类型，不设置时默认为带输入控件类表单;当为 text 时，为纯文本描述类表单
         *
         * 带输入控件类表单：各个表单条目的内容区主要为输入框、下拉框、按钮组等输入组件；
         *
         * 纯文本描述类表单：各个表单条目的内容区为纯文本。
         */
        this.type = 'default';
        /**
         * 设置表单布局的列数
         */
        this.colsNumber = 1;
        /**
         * 设置列与列之间的间隔，只有多列（colsNumber >= 2）时该属性配置才生效。
         */
        this.colsGap = [];
        /**
         * 统一设置表单条目的垂直对齐方式（上下布局表单不支持该属性）。
         */
        this.verticalAlign = 'top';
        /**
         * 设置各列宽度（IE不支持，行合并列合并暂不支持）
         *
         * 设置该接口后，colsGap第一个值表示各列间距
         *
         * 10.1.1 新增
         */
        this.colsWidth = [];
        /**
         * @ignore
         * 纯文本描述类表单的type的值
         */
        this.textType = 'text';
        /**
         * @ignore
         * ti-formfield中包含的所有ti-item的集合
         */
        this.items = [];
        /**
         * @ignore
         * ti-formfield中包含的所有ti-btn-item的集合
         */
        this.btnItems = [];
        /**
         * @ignore
         * 根据colsNum对 items 分组后的数据
         */
        this.groupedItems = [];
        /**
         * @ignore
         * 表单的列数
         */
        this.colsNum = 1;
        /**
         * @ignore
         * 当前formfield下ti-item的总个数
         */
        this.itemTotal = 0;
        /**
         * @ignore
         * 表单是否为上下布局
         */
        this.isVertical = false;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        this.isVertical = this.nativeElement.hasAttribute('vertical');
        this.setColsNumber();
        // 统一设置表单内容的垂直对齐方式;
        // tbody、tr、td的verticalAlign继承于此(table),所以此处可以
        // 统一设置表单内容的垂直对齐方式
        this.setFieldStyle();
    }
    setColsNumber() {
        if (this.colsNumber) {
            // tslint:disable-next-line:prefer-template
            const colsNumber = parseInt(String(this.colsNumber), 10);
            if (!Number.isNaN(colsNumber) && colsNumber >= 1) {
                this.colsNum = colsNumber;
            }
        }
    }
    setFieldStyle() {
        if (!Util.isEmptyString(this.verticalAlign)) {
            this.containterObj = { 'vertical-align': this.verticalAlign };
        }
        // 设置width接口时，配置grid，IE下不支持grid布局，存在兼容性问题
        const isSupportGrid = (typeof window !== 'undefined') && window.CSS && window.CSS.supports && window.CSS.supports('(display: grid)');
        this.useGrid = this.colsWidth && this.colsWidth.length > 0 && isSupportGrid;
        if (this.useGrid) {
            this.labelWidth = this.labelWidth ? this.labelWidth : '80px'; // 给定宽度，确保content对齐；
            for (let i = 0; i < this.colsWidth.length; i++) {
                // 各列设置百分比且设置列间距时，需要重新计算各列宽度，设置宽度-各列间距总和
                const calcWidth = `calc( ${this.colsWidth[i]} - ${parseFloat(this.colsGap[0]) * (this.colsWidth.length - 1) / this.colsWidth.length}px)`;
                this.colsWidth[i] = /%$/.test(this.colsWidth[i]) && this.colsGap[0] ? calcWidth : this.colsWidth[i];
            }
            this.containterObj['grid-template-columns'] = `${this.colsWidth.join(' ')}`;
            this.containterObj['grid-column-gap'] = this.colsGap[0]; // 列间距 grid-column-gap属性只支持一个值，取首项作为列间距
            this.buttonStyle = this.isVertical ? {} : { 'margin-left': `calc(${this.labelWidth} + 20px)` }; // 20px padding
        }
    }
    /**
     * @ignore
     * 需要在TiItemComponent.ts中调用
     */
    addCntItem(item) {
        this.items.push(item);
        this.items.sort((a, b) => {
            return a.itemIndex - b.itemIndex;
        });
        this.groupedItems = this.chunkArray(this.items, this.colsNum);
        // 强制变检一次，消除报错(Expression has changed after it was checked)
        this.changeDetector.detectChanges();
    }
    /**
     * @ignore
     * 需要在 TiItemComponent.ts 中调用
     */
    removeCntItem(item) {
        const itemIndex = this.items.indexOf(item);
        if (itemIndex !== -1) {
            this.items.splice(itemIndex, 1);
            this.groupedItems = this.chunkArray(this.items, this.colsNum);
            // 强制变检一次，消除报错(Expression has changed after it was checked)
            // ti-item和ti-formfiled组件都销毁时，视图也已销毁，不需要再强制变检;
            // 因此，强制变检需要在一定的条件下执行，消除服务报错（Attempt to use a destroyed view: detectChanges）
            if (!this.changeDetector['destroyed']) {
                this.changeDetector.detectChanges();
            }
        }
    }
    /**
     * @ignore
     * 需要在 TiButtonItemComponent.ts 中调用
     */
    addBtnItem(item) {
        this.btnItems.push(item);
    }
    /**
     * @ignore
     * 需要在 TiButtonItemComponent.ts 中调用
     */
    removeBtnItem(item) {
        const itemIndex = this.btnItems.indexOf(item);
        if (itemIndex !== -1) {
            this.btnItems.splice(itemIndex, 1);
        }
    }
    // tslint:disable-next-line:prefer-function-over-method
    chunkArray(array, size) {
        const length = array ? array.length : 0;
        if (!length || size < 1) {
            return [];
        }
        const result = [];
        // 单列
        if (size === 1) {
            array.forEach((item) => {
                result.push([item]);
            });
            // 多列
        }
        else {
            const rowspanNums = new Array(size); // 记录每一列的行合并的信息
            let onegroup = [];
            let colIndex = 0;
            array.forEach((item, index) => {
                while (rowspanNums[colIndex] > 0) {
                    rowspanNums[colIndex] = rowspanNums[colIndex] - 1;
                    colIndex++;
                    if (colIndex === size) {
                        result.push(onegroup);
                        onegroup = [];
                        colIndex = 0;
                    }
                }
                onegroup.push(item);
                // 如果该单元是行合并，则影响后续行
                if (item.rowspan > 1) {
                    rowspanNums[colIndex] = item.rowspan - 1;
                }
                // 如果该单元是列合并，则影响当前行
                if (item.colspan > 1) {
                    colIndex += (item.colspan - 1);
                }
                // 设置列间距
                if (colIndex < size - 1) {
                    // 设置宽度时，为使IE下有良好的呈现，取首项作为各列间距
                    item.gapWidth = this.colsWidth && this.colsWidth.length > 0 && this.colsGap[0] ? this.colsGap[0] : (this.colsGap[colIndex] || TiFormfieldComponent.COLS_GAP);
                }
                colIndex++;
                if (colIndex === size || index === array.length - 1) {
                    result.push(onegroup);
                    onegroup = [];
                    colIndex = 0;
                }
            });
        }
        return result;
    }
    /**
     * @ignore
     * 需要在html模板中使用
     */
    trackByFn(index, item) {
        return item.itemIndex;
    }
    /**
     * @ignore
     * 每项图标是否占位，设置按钮及content样式
     */
    getRequire(item, index) {
        let hasRequire;
        for (let i = 0; i < this.groupedItems.length; i++) {
            const groupedItem = this.groupedItems[i];
            if (groupedItem[index % this.colsNum] && groupedItem[index % this.colsNum].required) {
                hasRequire = true;
            }
        }
        if (index === 0 && hasRequire) {
            this.buttonStyle = { 'margin-left': `calc(${this.labelWidth} + 36px)` }; // 20 padding + 16 图标
        }
        if (hasRequire) {
            item.contentStyle['width'] = item.hasLabel ? `calc(100% - ${this.labelWidth} - 36px)` : `calc(100% - 16px)`;
        }
        else {
            // TiItemComponent 初始化时，ti-item-label指令无法获取到label，导致宽度设置不正确，因此在此处设置宽度
            item.contentStyle['width'] = item.hasLabel ? `calc(100% - ${this.labelWidth} - 20px)` : '100%';
        }
        return hasRequire;
    }
}
/**
 * 默认两列的间距
 */
TiFormfieldComponent.COLS_GAP = '70px';
TiFormfieldComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-formfield',
                template: "<h3 *ngIf=\"title\" class=\"ti3-form-title\" [id]=\"appendId('title')\">{{title}}</h3>\r\n<ng-container *ngIf=\"!useGrid else gridLayout\">\r\n    <table style=\"max-width: 100%;\" class=\"ti3-form\" [ngStyle]=\"containterObj\">\r\n        <tbody [ngClass]=\"{'ti3-text-form': type === textType}\">\r\n            <tr *ngFor=\"let groupedItem of groupedItems;index as groupIndex;\"\r\n                [ngClass]=\"{ 'ti3-form-list' : groupedItems.length === (groupIndex + 1)}\">\r\n                <ng-container *ngFor=\"let item of groupedItem;index as i;trackBy: trackByFn\">\r\n                    <ng-container\r\n                        *ngTemplateOutlet=\"isVertical&&type!==textType ? topAlign : leftAlign; context: {$implicit: item}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngFor=\"let item of btnItems;\">\r\n                <td *ngIf=\"!isVertical\"></td>\r\n                <td *ngIf=\"!isVertical\"></td>\r\n                <td [tiInclude]=\"item.btnContent\" [ngStyle]=\"item.verticalAlignObj\" class=\"ti3-form-button-item\"\r\n                    [attr.colspan]=\"item.btnColspan\"></td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n\r\n    <ng-template #leftAlign let-item>\r\n        <td [ngStyle]=\"item.verticalAlignObj\"\r\n            [ngClass]=\"{'ti3-form-require': item.required}\"\r\n            [attr.rowspan]=\"item.rowspan\">\r\n            <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon\"></span>\r\n        </td>\r\n        <td [tiInclude]=\"item.itemLabel\"\r\n            class=\"ti3-form-label ti3-text-form-label\"\r\n            [attr.rowspan]=\"item.rowspan\"\r\n            *ngIf=\"item.hasLabel\"\r\n            [ngStyle]=\"item.labelStyle\"></td>\r\n        <td [tiInclude]=\"item.element\"\r\n            [attr.colspan]=\"(item.colspan - 1) * 4 + 1 + (item.hasLabel ? 0 : 1)\"\r\n            [attr.rowspan]=\"item.rowspan\"\r\n            [ngStyle]=\"item.contentStyle\"\r\n            class=\"ti3-form-content ti3-text-form-content\"></td>\r\n        <td [ngStyle]=\"{width: item.gapWidth}\"\r\n            [attr.rowspan]=\"item.rowspan\"></td>\r\n    </ng-template>\r\n\r\n    <ng-template #topAlign let-item>\r\n        <td [attr.rowspan]=\"item.rowspan\">\r\n            <div class=\"ti3-form-top-label\">\r\n                <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon ti3-form-top-require\"></span>\r\n                <span [tiInclude]=\"item.itemLabel\"\r\n                      class=\"ti3-form-top-text\"\r\n                      [attr.rowspan]=\"item.rowspan\"\r\n                      *ngIf=\"item.hasLabel\"\r\n                      [ngStyle]=\"item.labelStyle\"></span>\r\n            </div>\r\n            <div [tiInclude]=\"item.element\"\r\n                 [attr.colspan]=\"(item.colspan - 1) * 4 + 1 + (item.hasLabel ? 0 : 1)\"\r\n                 [attr.rowspan]=\"item.rowspan\"\r\n                 [ngStyle]=\"item.contentStyle\"\r\n                 class=\"ti3-form-content\"></div>\r\n        </td>\r\n        <td [ngStyle]=\"{width: item.gapWidth}\"\r\n            [attr.rowspan]=\"item.rowspan\"></td>\r\n    </ng-template>\r\n</ng-container>\r\n\r\n<ng-template #gridLayout>\r\n    <div class=\"ti3-form\">\r\n        <div class=\"ti3-form-grid-container\" [ngStyle]=\"containterObj\">\r\n            <div *ngFor=\"let item of items;index as i;trackBy: trackByFn\"\r\n                 [ngClass]=\"{ 'ti3-text-form': type === textType }\"\r\n                 [ngStyle]=\"item.itemStyle\">\r\n                <ng-container\r\n                    *ngTemplateOutlet=\"isVertical&&type!==textType ? gridTopAlign : gridLeftAlign; context: {$implicit: item, index: i}\">\r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n        <div *ngFor=\"let item of btnItems;\" class=\"ti3-form-button-item\" [ngStyle]=\"buttonStyle\">\r\n            <div [tiInclude]=\"item.btnContent\" [ngStyle]=\"item.verticalAlignObj\"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <ng-template #gridLeftAlign let-item let-i=index>\r\n        <div [ngStyle]=\"item.verticalAlignObj\"\r\n             [ngClass]=\"{'ti3-form-require': item.required}\"\r\n             class=\"ti3-form-grid-require\"\r\n             *ngIf=\"getRequire(item, i)\">\r\n            <ti-icon [hidden]=\"!item.required\" name=\"staricon\"></ti-icon>\r\n        </div>\r\n        <div [tiInclude]=\"item.itemLabel\"\r\n             class=\"ti3-form-label ti3-text-form-label\"\r\n             *ngIf=\"item.hasLabel\"\r\n             [ngStyle]=\"item.labelStyle\"\r\n             style=\"display: inline-block;\"></div>\r\n        <div [tiInclude]=\"item.element\"\r\n             [ngStyle]=\"item.contentStyle\"\r\n             class=\"ti3-form-content ti3-text-form-content\"\r\n             style=\"display: inline-block;\"></div>\r\n    </ng-template>\r\n\r\n    <ng-template #gridTopAlign let-item>\r\n        <div class=\"ti3-form-top-label\">\r\n            <span [hidden]=\"!item.required\" class=\"ti3-icon ti3-icon-staricon ti3-form-top-require\"></span>\r\n            <span [tiInclude]=\"item.itemLabel\"\r\n                  class=\"ti3-form-top-text\"\r\n                  *ngIf=\"item.hasLabel\"\r\n                  [ngStyle]=\"item.labelStyle\"></span>\r\n        </div>\r\n        <div [tiInclude]=\"item.element\"\r\n             [ngStyle]=\"item.contentStyle\"\r\n             class=\"ti3-form-content\"></div>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n",
                styles: [".ti3-form-title{color:var(--ti-common-color-text-primary);font-size:20px;margin-bottom:30px}.ti3-form{text-align:left}.ti3-form>tbody,.ti3-form>tbody tr,.ti3-form div,.ti3-form div tr{vertical-align:inherit}.ti3-form>tbody tr>td,.ti3-form div tr>td{vertical-align:inherit;white-space:normal}.ti3-form>tbody tr>td.ti3-form-label,.ti3-form div tr>td.ti3-form-label{white-space:nowrap}.ti3-form .ti3-form-grid-container{display:-ms-grid;display:grid}.ti3-form .ti3-form-list .ti3-form-content,.ti3-form .ti3-form-list .ti3-form-label,.ti3-form .ti3-form-list .ti3-form-require{padding-bottom:0}.ti3-form .ti3-form-require{padding:0 var(--ti-formfield-item-required-padding-right) var(--ti-formfield-item-padding-bottom) 0}.ti3-form .ti3-form-require .ti3-icon{color:var(--ti-common-color-error);font-size:var(--ti-formfield-item-required-font-size);font-weight:400;line-height:var(--ti-formfield-item-required-label-line-height)}.ti3-form .ti3-form-grid-require{display:inline-block;width:16px}.ti3-form .ti3-form-label{color:var(--ti-common-color-text-secondary);font-size:var(--ti-default-font-size);line-height:var(--ti-formfield-item-required-label-line-height);padding:0 var(--ti-formfield-item-label-padding-right) var(--ti-formfield-item-padding-bottom) 0}.ti3-form .ti3-form-content{padding-bottom:var(--ti-formfield-item-padding-bottom);word-break:break-word}.ti3-form .ti3-form-content input[type=checkbox][ti-checkbox]+.ti3-checkbox,.ti3-form .ti3-form-content input[type=radio][ti-radio]+.ti3-radio{display:inline-block;line-height:var(--ti-formfield-item-content-line-height)}.ti3-form .ti3-form-grid-container+.ti3-form-button-item,.ti3-form td.ti3-form-button-item{padding-top:var(--ti-formfield-button-item-padding-top)}.ti3-form .ti3-text-form .ti3-text-form-content,.ti3-form .ti3-text-form .ti3-text-form-label{line-height:var(--ti-formfield-text-from-item-line-height);padding-bottom:0}.ti3-form .ti3-text-form .ti3-text-form-label{color:var(--ti-formfield-text-form-label-color)}.ti3-form .ti3-form-top-label{align-items:center;color:var(--ti-common-color-text-secondary);display:flex;font-size:var(--ti-default-font-size);padding-bottom:var(--ti-common-space-2x);white-space:nowrap}.ti3-form .ti3-form-top-require{color:var(--ti-common-color-error);font-size:var(--ti-formfield-item-required-font-size)}.ti3-form .ti3-form-top-text{line-height:var(--ti-common-line-height-number)}"]
            },] }
];
TiFormfieldComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef }
];
TiFormfieldComponent.propDecorators = {
    type: [{ type: Input }],
    title: [{ type: Input }],
    labelWidth: [{ type: Input }],
    colsNumber: [{ type: Input }],
    colsGap: [{ type: Input }],
    verticalAlign: [{ type: Input }],
    textLineHeight: [{ type: Input }],
    colsWidth: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlGb3JtZmllbGRDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy9mb3JtZmllbGQvVGlGb3JtZmllbGRDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBR3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RDs7Ozs7R0FLRztBQU1ILE1BQU0sT0FBTyxvQkFBcUIsU0FBUSxlQUFlO0lBbUdyRCxZQUNjLE9BQW1CLEVBQ25CLFFBQW1CLEVBQ3JCLGNBQWlDO1FBRXpDLEtBQUssQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFKZixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQ25CLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDckIsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBakc3Qzs7Ozs7O1dBTUc7UUFDTSxTQUFJLEdBQXVCLFNBQVMsQ0FBQztRQVM5Qzs7V0FFRztRQUNNLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDaEM7O1dBRUc7UUFDTSxZQUFPLEdBQWtCLEVBQUUsQ0FBQztRQUNyQzs7V0FFRztRQUNNLGtCQUFhLEdBQWdDLEtBQUssQ0FBQztRQVM1RDs7Ozs7O1dBTUc7UUFDTSxjQUFTLEdBQWtCLEVBQUUsQ0FBQztRQUV2Qzs7O1dBR0c7UUFDYSxhQUFRLEdBQVcsTUFBTSxDQUFDO1FBQzFDOzs7V0FHRztRQUNJLFVBQUssR0FBMkIsRUFBRSxDQUFDO1FBQzFDOzs7V0FHRztRQUNJLGFBQVEsR0FBaUMsRUFBRSxDQUFDO1FBQ25EOzs7V0FHRztRQUNJLGlCQUFZLEdBQWUsRUFB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LElBQUksQ0FBQyxVQUFVLFVBQVUsRUFBRSxDQUFDLENBQUMscUJBQXFCO1NBQ2pHO1FBRUQsSUFBSSxVQUFVLEVBQUU7WUFDWixJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGVBQWUsSUFBSSxDQUFDLFVBQVUsVUFBVSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQztTQUMvRzthQUFNO1lBQ0gscUVBQXFFO1lBQ3JFLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsZUFBZSxJQUFJLENBQUMsVUFBVSxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBRTtTQUNuRztRQUVELE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7O0FBaFNEOztHQUVHO0FBQ3FCLDZCQUFRLEdBQVcsTUFBTSxDQUFDOztZQVRyRCxTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLGc4S0FBK0I7O2FBRWhDOzs7WUFsQkMsVUFBVTtZQUVWLFNBQVM7WUFKVCxpQkFBaUI7OzttQkFpQ2QsS0FBSztvQkFJTCxLQUFLO3lCQUlMLEtBQUs7eUJBSUwsS0FBSztzQkFJTCxLQUFLOzRCQUlMLEtBQUs7NkJBUUwsS0FBSzt3QkFRTCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBJbnB1dCxcclxuICBSZW5kZXJlcjJcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaUl0ZW1Db21wb25lbnQgfSBmcm9tICcuL1RpSXRlbUNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRpQnV0dG9uSXRlbUNvbXBvbmVudCB9IGZyb20gJy4vVGlCdXR0b25JdGVtQ29tcG9uZW50JztcclxuaW1wb3J0IHsgVGlCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9UaUJhc2VNb2R1bGUnO1xyXG4vKipcclxuICog5pys57uE5Lu25a6e546w5a+55aSa5Liq6KGo5Y2V5YWD57Sg55qE5biD5bGA77yM5pSv5oyB5Y2V5YiX5ZKM5aSa5YiX5biD5bGA44CCXHJcbiAqIOWFtuS4reWMheWQq+S6hnRpRm9ybWZpZWxk44CBdGlJdGVt44CBdGlJdGVtTGFiZWzlkox0aUJ1dHRvbkl0ZW3lh6DkuKrnu4Tku7bjgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL2Zvcm1maWVsZC9mb3JtZmllbGQtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndGktZm9ybWZpZWxkJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybWZpZWxkLmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Zvcm1maWVsZC5sZXNzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRpRm9ybWZpZWxkQ29tcG9uZW50IGV4dGVuZHMgVGlCYXNlQ29tcG9uZW50IHtcclxuICAgIC8qKlxyXG4gICAgICog6buY6K6k5Lik5YiX55qE6Ze06LedXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTFNfR0FQOiBzdHJpbmcgPSAnNzBweCc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruihqOWNleexu+Wei++8jOS4jeiuvue9ruaXtum7mOiupOS4uuW4pui+k+WFpeaOp+S7tuexu+ihqOWNlTvlvZPkuLogdGV4dCDml7bvvIzkuLrnuq/mlofmnKzmj4/ov7DnsbvooajljZVcclxuICAgICAqXHJcbiAgICAgKiDluKbovpPlhaXmjqfku7bnsbvooajljZXvvJrlkITkuKrooajljZXmnaHnm67nmoTlhoXlrrnljLrkuLvopoHkuLrovpPlhaXmoYbjgIHkuIvmi4nmoYbjgIHmjInpkq7nu4TnrYnovpPlhaXnu4Tku7bvvJtcclxuICAgICAqXHJcbiAgICAgKiDnuq/mlofmnKzmj4/ov7DnsbvooajljZXvvJrlkITkuKrooajljZXmnaHnm67nmoTlhoXlrrnljLrkuLrnuq/mlofmnKzjgIJcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdHlwZTogJ2RlZmF1bHQnIHwgJ3RleHQnID0gJ2RlZmF1bHQnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7ooajljZXnmoTmoIfpophcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdGl0bGU6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog57uf5LiA6K6+572u6KGo5Y2V5p2h55uu55qEIGxhYmVsIOaJgOWNoOWuveW6puOAguS+i+Wmgu+8mlwiMTAwcHhcIlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBsYWJlbFdpZHRoOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruihqOWNleW4g+WxgOeahOWIl+aVsFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBjb2xzTnVtYmVyOiBudW1iZXIgPSAxO1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7liJfkuI7liJfkuYvpl7TnmoTpl7TpmpTvvIzlj6rmnInlpJrliJfvvIhjb2xzTnVtYmVyID49IDLvvInml7bor6XlsZ7mgKfphY3nva7miY3nlJ/mlYjjgIJcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY29sc0dhcDogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnu5/kuIDorr7nva7ooajljZXmnaHnm67nmoTlnoLnm7Tlr7npvZDmlrnlvI/vvIjkuIrkuIvluIPlsYDooajljZXkuI3mlK/mjIHor6XlsZ7mgKfvvInjgIJcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdmVydGljYWxBbGlnbjogJ3RvcCcgfCAnbWlkZGxlJyB8ICdib3R0b20nID0gJ3RvcCc7XHJcbiAgICAvKipcclxuICAgICAqIOe7n+S4gOiuvue9rue6r+aWh+acrOaPj+i/sOexu+ihqOWNleeahOavj+S4quihqOWNleadoeebrueahOihjOmrmOOAglxyXG4gICAgICpcclxuICAgICAqIOe6r+aWh+acrOaPj+i/sOexu+ihqOWNleS4jeiuvue9ruaXtu+8jOihjOmrmOm7mOiupOS4ujQwcHjvvJvorr7nva7lgLzml7bvvIzkvovlpoLvvJonMzBweCcs5YiZ55qE6KGM6auY5Li6MzBweOOAglxyXG4gICAgICpcclxuICAgICAqIOebruWJjee6r+aWh+acrOaPj+i/sOexu+ihqOWNleacieS4ieenjeW6lOeUqOWcuuaZr++8muihqOagvOS4i+WxleihqOWNle+8jOihjOmrmOWAvDQwcHjvvIjpu5jorqTvvInvvJvotK3kubDpobXphY3nva7kv6Hmga/msYfmgLvvvIzooYzpq5gzMFBY77yb6K6i5Y2V6K+m5oOF56Gu6K6k77yM6KGM6auYMjJweOOAglxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0ZXh0TGluZUhlaWdodDogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7lkITliJflrr3luqbvvIhJReS4jeaUr+aMge+8jOihjOWQiOW5tuWIl+WQiOW5tuaaguS4jeaUr+aMge+8iVxyXG4gICAgICpcclxuICAgICAqIOiuvue9ruivpeaOpeWPo+WQju+8jGNvbHNHYXDnrKzkuIDkuKrlgLzooajnpLrlkITliJfpl7Tot51cclxuICAgICAqXHJcbiAgICAgKiAxMC4xLjEg5paw5aKeXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNvbHNXaWR0aDogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog57qv5paH5pys5o+P6L+w57G76KGo5Y2V55qEdHlwZeeahOWAvFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgdGV4dFR5cGU6IHN0cmluZyA9ICd0ZXh0JztcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogdGktZm9ybWZpZWxk5Lit5YyF5ZCr55qE5omA5pyJdGktaXRlbeeahOmbhuWQiFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXRlbXM6IEFycmF5PFRpSXRlbUNvbXBvbmVudD4gPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogdGktZm9ybWZpZWxk5Lit5YyF5ZCr55qE5omA5pyJdGktYnRuLWl0ZW3nmoTpm4blkIhcclxuICAgICAqL1xyXG4gICAgcHVibGljIGJ0bkl0ZW1zOiBBcnJheTxUaUJ1dHRvbkl0ZW1Db21wb25lbnQ+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOagueaNrmNvbHNOdW3lr7kgaXRlbXMg5YiG57uE5ZCO55qE5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBncm91cGVkSXRlbXM6IEFycmF5PGFueT4gPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6KGo5Y2V55qE5YiX5pWwXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb2xzTnVtOiBudW1iZXIgPSAxO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb250YWludGVyT2JqOiB7ICd2ZXJ0aWNhbC1hbGlnbic6IHN0cmluZywgJ2dyaWQtdGVtcGxhdGUtY29sdW1ucyc/OiBzdHJpbmcsICdncmlkLWNvbHVtbi1nYXAnPzogc3RyaW5nIH07XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOW9k+WJjWZvcm1maWVsZOS4i3RpLWl0ZW3nmoTmgLvkuKrmlbBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGl0ZW1Ub3RhbDogbnVtYmVyID0gMDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6KGo5Y2V5piv5ZCm5Li65LiK5LiL5biD5bGAXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc1ZlcnRpY2FsOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIGJ1dHRvbuagt+W8j1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYnV0dG9uU3R5bGU6IHsgJ21hcmdpbi1sZWZ0Jz86IHN0cmluZzsgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6KGo5Y2V5piv5ZCm5L2/55SoZ3JpZOW4g+WxgFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdXNlR3JpZDogYm9vbGVhbjtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByb3RlY3RlZCBob3N0UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcihob3N0UmVmLCByZW5kZXJlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gdGhpcy5uYXRpdmVFbGVtZW50Lmhhc0F0dHJpYnV0ZSgndmVydGljYWwnKTtcclxuICAgICAgICB0aGlzLnNldENvbHNOdW1iZXIoKTtcclxuICAgICAgICAvLyDnu5/kuIDorr7nva7ooajljZXlhoXlrrnnmoTlnoLnm7Tlr7npvZDmlrnlvI87XHJcbiAgICAgICAgLy8gdGJvZHnjgIF0cuOAgXRk55qEdmVydGljYWxBbGlnbue7p+aJv+S6juatpCh0YWJsZSks5omA5Lul5q2k5aSE5Y+v5LulXHJcbiAgICAgICAgLy8g57uf5LiA6K6+572u6KGo5Y2V5YaF5a6555qE5Z6C55u05a+56b2Q5pa55byPXHJcbiAgICAgICAgdGhpcy5zZXRGaWVsZFN0eWxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRDb2xzTnVtYmVyKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHNOdW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci10ZW1wbGF0ZVxyXG4gICAgICAgICAgICBjb25zdCBjb2xzTnVtYmVyOiBudW1iZXIgPSBwYXJzZUludChTdHJpbmcodGhpcy5jb2xzTnVtYmVyKSwgMTApO1xyXG4gICAgICAgICAgICBpZiAoIU51bWJlci5pc05hTihjb2xzTnVtYmVyKSAmJiBjb2xzTnVtYmVyID49IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sc051bSA9IGNvbHNOdW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRGaWVsZFN0eWxlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICghVXRpbC5pc0VtcHR5U3RyaW5nKHRoaXMudmVydGljYWxBbGlnbikpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWludGVyT2JqID0geyAndmVydGljYWwtYWxpZ24nOiB0aGlzLnZlcnRpY2FsQWxpZ24gfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOiuvue9rndpZHRo5o6l5Y+j5pe277yM6YWN572uZ3JpZO+8jElF5LiL5LiN5pSv5oyBZ3JpZOW4g+WxgO+8jOWtmOWcqOWFvOWuueaAp+mXrumimFxyXG4gICAgICAgIGNvbnN0IGlzU3VwcG9ydEdyaWQ6IGJvb2xlYW4gPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpICYmICh3aW5kb3cgYXMgYW55KS5DU1MgJiYgKHdpbmRvdyBhcyBhbnkpLkNTUy5zdXBwb3J0cyAmJiAod2luZG93IGFzIGFueSkuQ1NTLnN1cHBvcnRzKCcoZGlzcGxheTogZ3JpZCknKTtcclxuICAgICAgICB0aGlzLnVzZUdyaWQgPSB0aGlzLmNvbHNXaWR0aCAmJiB0aGlzLmNvbHNXaWR0aC5sZW5ndGggPiAwICYmIGlzU3VwcG9ydEdyaWQ7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnVzZUdyaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5sYWJlbFdpZHRoID0gdGhpcy5sYWJlbFdpZHRoID8gdGhpcy5sYWJlbFdpZHRoIDogJzgwcHgnOyAvLyDnu5nlrprlrr3luqbvvIznoa7kv51jb250ZW505a+56b2Q77ybXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb2xzV2lkdGgubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIOWQhOWIl+iuvue9rueZvuWIhuavlOS4lOiuvue9ruWIl+mXtOi3neaXtu+8jOmcgOimgemHjeaWsOiuoeeul+WQhOWIl+WuveW6pu+8jOiuvue9ruWuveW6pi3lkITliJfpl7Tot53mgLvlkoxcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbGNXaWR0aDogc3RyaW5nID0gYGNhbGMoICR7dGhpcy5jb2xzV2lkdGhbaV19IC0gJHtwYXJzZUZsb2F0KHRoaXMuY29sc0dhcFswXSkgKiAodGhpcy5jb2xzV2lkdGgubGVuZ3RoIC0gMSkgLyB0aGlzLmNvbHNXaWR0aC5sZW5ndGh9cHgpYDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sc1dpZHRoW2ldID0gLyUkLy50ZXN0KHRoaXMuY29sc1dpZHRoW2ldKSAmJiB0aGlzLmNvbHNHYXBbMF0gPyBjYWxjV2lkdGggOiB0aGlzLmNvbHNXaWR0aFtpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW50ZXJPYmpbJ2dyaWQtdGVtcGxhdGUtY29sdW1ucyddID0gYCR7dGhpcy5jb2xzV2lkdGguam9pbignICcpfWA7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbnRlck9ialsnZ3JpZC1jb2x1bW4tZ2FwJ10gPSB0aGlzLmNvbHNHYXBbMF07IC8vIOWIl+mXtOi3nSBncmlkLWNvbHVtbi1nYXDlsZ7mgKflj6rmlK/mjIHkuIDkuKrlgLzvvIzlj5bpppbpobnkvZzkuLrliJfpl7Tot51cclxuICAgICAgICAgICAgdGhpcy5idXR0b25TdHlsZSA9IHRoaXMuaXNWZXJ0aWNhbCA/IHt9IDogeyAnbWFyZ2luLWxlZnQnOiBgY2FsYygke3RoaXMubGFiZWxXaWR0aH0gKyAyMHB4KWAgfTsgLy8gMjBweCBwYWRkaW5nXHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6ZyA6KaB5ZyoVGlJdGVtQ29tcG9uZW50LnRz5Lit6LCD55SoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhZGRDbnRJdGVtKGl0ZW06IFRpSXRlbUNvbXBvbmVudCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuaXRlbXMucHVzaChpdGVtKTtcclxuICAgICAgICB0aGlzLml0ZW1zLnNvcnQoKGE6IFRpSXRlbUNvbXBvbmVudCwgYjogVGlJdGVtQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLml0ZW1JbmRleCAtIGIuaXRlbUluZGV4O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZ3JvdXBlZEl0ZW1zID0gdGhpcy5jaHVua0FycmF5KHRoaXMuaXRlbXMsIHRoaXMuY29sc051bSk7XHJcbiAgICAgICAgLy8g5by65Yi25Y+Y5qOA5LiA5qyh77yM5raI6Zmk5oql6ZSZKEV4cHJlc3Npb24gaGFzIGNoYW5nZWQgYWZ0ZXIgaXQgd2FzIGNoZWNrZWQpXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOmcgOimgeWcqCBUaUl0ZW1Db21wb25lbnQudHMg5Lit6LCD55SoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZW1vdmVDbnRJdGVtKGl0ZW06IFRpSXRlbUNvbXBvbmVudCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1JbmRleDogbnVtYmVyID0gdGhpcy5pdGVtcy5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgIGlmIChpdGVtSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBlZEl0ZW1zID0gdGhpcy5jaHVua0FycmF5KHRoaXMuaXRlbXMsIHRoaXMuY29sc051bSk7XHJcbiAgICAgICAgICAgIC8vIOW8uuWItuWPmOajgOS4gOasoe+8jOa2iOmZpOaKpemUmShFeHByZXNzaW9uIGhhcyBjaGFuZ2VkIGFmdGVyIGl0IHdhcyBjaGVja2VkKVxyXG4gICAgICAgICAgICAvLyB0aS1pdGVt5ZKMdGktZm9ybWZpbGVk57uE5Lu26YO96ZSA5q+B5pe277yM6KeG5Zu+5Lmf5bey6ZSA5q+B77yM5LiN6ZyA6KaB5YaN5by65Yi25Y+Y5qOAO1xyXG4gICAgICAgICAgICAvLyDlm6DmraTvvIzlvLrliLblj5jmo4DpnIDopoHlnKjkuIDlrprnmoTmnaHku7bkuIvmiafooYzvvIzmtojpmaTmnI3liqHmiqXplJnvvIhBdHRlbXB0IHRvIHVzZSBhIGRlc3Ryb3llZCB2aWV3OiBkZXRlY3RDaGFuZ2Vz77yJXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5jaGFuZ2VEZXRlY3RvclsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDpnIDopoHlnKggVGlCdXR0b25JdGVtQ29tcG9uZW50LnRzIOS4reiwg+eUqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkQnRuSXRlbShpdGVtOiBUaUJ1dHRvbkl0ZW1Db21wb25lbnQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmJ0bkl0ZW1zLnB1c2goaXRlbSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOmcgOimgeWcqCBUaUJ1dHRvbkl0ZW1Db21wb25lbnQudHMg5Lit6LCD55SoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZW1vdmVCdG5JdGVtKGl0ZW06IFRpQnV0dG9uSXRlbUNvbXBvbmVudCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1JbmRleDogbnVtYmVyID0gdGhpcy5idG5JdGVtcy5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgIGlmIChpdGVtSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnRuSXRlbXMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItZnVuY3Rpb24tb3Zlci1tZXRob2RcclxuICAgIHByaXZhdGUgY2h1bmtBcnJheShhcnJheTogQXJyYXk8VGlJdGVtQ29tcG9uZW50Piwgc2l6ZTogbnVtYmVyKTogQXJyYXk8YW55PiB7XHJcbiAgICAgICAgY29uc3QgbGVuZ3RoOiBudW1iZXIgPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7XHJcbiAgICAgICAgaWYgKCFsZW5ndGggfHwgc2l6ZSA8IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzdWx0OiBBcnJheTxBcnJheTxUaUl0ZW1Db21wb25lbnQ+PiA9IFtdO1xyXG4gICAgICAgIC8vIOWNleWIl1xyXG4gICAgICAgIGlmIChzaXplID09PSAxKSB7XHJcbiAgICAgICAgICAgIGFycmF5LmZvckVhY2goKGl0ZW06IFRpSXRlbUNvbXBvbmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goW2l0ZW1dKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgLy8g5aSa5YiXXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93c3Bhbk51bXM6IEFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXkoc2l6ZSk7IC8vIOiusOW9leavj+S4gOWIl+eahOihjOWQiOW5tueahOS/oeaBr1xyXG4gICAgICAgICAgICBsZXQgb25lZ3JvdXA6IEFycmF5PFRpSXRlbUNvbXBvbmVudD4gPSBbXTtcclxuICAgICAgICAgICAgbGV0IGNvbEluZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKChpdGVtOiBUaUl0ZW1Db21wb25lbnQsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChyb3dzcGFuTnVtc1tjb2xJbmRleF0gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93c3Bhbk51bXNbY29sSW5kZXhdID0gcm93c3Bhbk51bXNbY29sSW5kZXhdIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xJbmRleCA9PT0gc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvbmVncm91cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWdyb3VwID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb25lZ3JvdXAucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOivpeWNleWFg+aYr+ihjOWQiOW5tu+8jOWImeW9seWTjeWQjue7reihjFxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucm93c3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByb3dzcGFuTnVtc1tjb2xJbmRleF0gPSBpdGVtLnJvd3NwYW4gLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c6K+l5Y2V5YWD5piv5YiX5ZCI5bm277yM5YiZ5b2x5ZON5b2T5YmN6KGMXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbEluZGV4ICs9IChpdGVtLmNvbHNwYW4gLSAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyDorr7nva7liJfpl7Tot51cclxuICAgICAgICAgICAgICAgIGlmIChjb2xJbmRleCA8IHNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6K6+572u5a695bqm5pe277yM5Li65L2/SUXkuIvmnInoia/lpb3nmoTlkYjnjrDvvIzlj5bpppbpobnkvZzkuLrlkITliJfpl7Tot51cclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmdhcFdpZHRoID0gdGhpcy5jb2xzV2lkdGggJiYgdGhpcy5jb2xzV2lkdGgubGVuZ3RoID4gMCAmJiB0aGlzLmNvbHNHYXBbMF0gPyB0aGlzLmNvbHNHYXBbMF0gOiAodGhpcy5jb2xzR2FwW2NvbEluZGV4XSB8fCBUaUZvcm1maWVsZENvbXBvbmVudC5DT0xTX0dBUCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29sSW5kZXgrKztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY29sSW5kZXggPT09IHNpemUgfHwgaW5kZXggPT09IGFycmF5Lmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvbmVncm91cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lZ3JvdXAgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog6ZyA6KaB5ZyoaHRtbOaooeadv+S4reS9v+eUqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdHJhY2tCeUZuKGluZGV4OiBudW1iZXIsIGl0ZW06IFRpSXRlbUNvbXBvbmVudCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0uaXRlbUluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5q+P6aG55Zu+5qCH5piv5ZCm5Y2g5L2N77yM6K6+572u5oyJ6ZKu5Y+KY29udGVudOagt+W8j1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0UmVxdWlyZShpdGVtOiBUaUl0ZW1Db21wb25lbnQsIGluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgaGFzUmVxdWlyZTogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmdyb3VwZWRJdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBncm91cGVkSXRlbTogVGlJdGVtQ29tcG9uZW50ID0gdGhpcy5ncm91cGVkSXRlbXNbaV07XHJcbiAgICAgICAgICAgIGlmIChncm91cGVkSXRlbVtpbmRleCAlIHRoaXMuY29sc051bV0gJiYgZ3JvdXBlZEl0ZW1baW5kZXggJSB0aGlzLmNvbHNOdW1dLnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgaGFzUmVxdWlyZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChpbmRleCA9PT0gMCAmJiBoYXNSZXF1aXJlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uU3R5bGUgPSB7ICdtYXJnaW4tbGVmdCc6IGBjYWxjKCR7dGhpcy5sYWJlbFdpZHRofSArIDM2cHgpYCB9OyAvLyAyMCBwYWRkaW5nICsgMTYg5Zu+5qCHXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGFzUmVxdWlyZSkge1xyXG4gICAgICAgICAgICBpdGVtLmNvbnRlbnRTdHlsZVsnd2lkdGgnXSA9IGl0ZW0uaGFzTGFiZWwgPyBgY2FsYygxMDAlIC0gJHt0aGlzLmxhYmVsV2lkdGh9IC0gMzZweClgIDogYGNhbGMoMTAwJSAtIDE2cHgpYDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBUaUl0ZW1Db21wb25lbnQg5Yid5aeL5YyW5pe277yMdGktaXRlbS1sYWJlbOaMh+S7pOaXoOazleiOt+WPluWIsGxhYmVs77yM5a+86Ie05a695bqm6K6+572u5LiN5q2j56Gu77yM5Zug5q2k5Zyo5q2k5aSE6K6+572u5a695bqmXHJcbiAgICAgICAgICAgIGl0ZW0uY29udGVudFN0eWxlWyd3aWR0aCddID0gaXRlbS5oYXNMYWJlbCA/IGBjYWxjKDEwMCUgLSAke3RoaXMubGFiZWxXaWR0aH0gLSAyMHB4KWAgOiAnMTAwJScgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGhhc1JlcXVpcmU7XHJcbiAgICB9XHJcbn1cclxuIl19