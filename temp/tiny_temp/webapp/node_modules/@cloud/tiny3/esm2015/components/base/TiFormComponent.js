import { Component, EventEmitter, forwardRef, Input, Output } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { TiBaseComponent } from './TiBaseComponent';
import { TiBrowser } from '../../utils/Util';
// TODO: aria-label
/**
 * 表单基类，已实现autofocus tabindex disabled focus() blur() focus/blur/change事件 ControlValueAccessor
 */
export class TiFormComponent extends TiBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * HTML属性tabindex
         */
        this.tabindex = '0';
        /**
         * HTML事件focus
         */
        // TODO：ip组件等是触发原生HTML的focus事件，便于校验？
        // TODO：一行有两个tslint错误，无法临时消除
        // tslint:disable-next-line:no-output-rename
        this.focusEvent = new EventEmitter();
        /**
         * HTML事件blur
         */
        // tslint:disable-next-line:no-output-rename
        this.blurEvent = new EventEmitter();
        /**
         * @ignore
         * HTML事件change
         */
        // blur时model值改变触发change
        // tslint:disable-next-line:no-output-rename
        this.changeEvent = new EventEmitter();
        /**
         * 整体focus/blur事件参与的元素，和disabled设置。
         * 组件具有多个input输入框:
         * 1)无元素聚焦->任一元素聚焦=整体聚焦事件。
         * 2)任一元素失焦->其他元素无焦点=整体失焦事件。
         */
        this.focusableElems = [];
        this.ngAfterViewCheckedFirst = true; // 是否第一次执行初始化
        /**
         * focus回调函数
         */
        this.focusCallbackFn = (event) => {
            this.focusedElem = event.target;
            // 非IE浏览器支持event.relatedTarget，使用event.relatedTarget进行处理
            if (!TiBrowser.isIE()) {
                // 当为内部焦点转移，不做处理
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(event.relatedTarget)) {
                    return;
                }
            }
            else { // IE浏览器的处理：浏览器不支持relatedTarget情况下的处理，参见blur中的说明
                if (event.target.tiFocusFrom) {
                    // return;
                    // 情况一：失焦后强制聚焦
                    if (event.target === event.target.tiFocusFrom) {
                        // 面板滚动条IE兼容：在focusin中，让失焦元素强制聚焦，会走到这里。
                        return;
                    }
                    // 情况二：内部焦点转移
                    if (this.focusableElems.length > 1 &&
                        this.focusableElems.includes(event.target.tiFocusFrom)) {
                        return;
                    }
                    // 情况三：较难理解：外部焦点转移时，(event.target as any).tiFocusFrom也是有值的。
                    // 这种情况，是因为组件嵌套使用，此聚焦元素分别从属于多个组件。
                    // 对于A组件来说，是焦点内部转移。对于B组件来说，是焦点外部转移。
                }
            }
            // 设置宿主元素的聚焦属性，用于标识该组件处于聚焦状态，该属性可用于css选择器：在宿主元素上增加属性focused
            this.setAttr(this.nativeElement, 'tiFocused', true);
            // 触发整体聚焦事件
            this.focusEvent.emit(event);
            // 保存focus时model值，blur时如果model值改变，则发送change事件
            this.focusModel = this.model;
        };
        /**
         * blur 回调函数
         */
        this.blurCallbackFn = (event) => {
            // 非IE浏览器支持event.relatedTarget，使用event.relatedTarget进行处理
            if (!TiBrowser.isIE()) {
                // 当为内部焦点转移，不做处理
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(event.relatedTarget)) {
                    return;
                }
            }
            else {
                // 已经失焦的元素，清除记录焦点从哪里而来。
                event.target.tiFocusFrom = undefined;
                // 如果失焦元素强制聚焦，不触发整体失焦事件。
                if (event.target === document.activeElement) {
                    // 面板滚动条IE兼容：在focusin中，让失焦元素强制聚焦，会走到这里。
                    // 即将聚焦（实际上已经聚焦）的元素，记录一下焦点从哪儿来：从自己来的
                    document.activeElement.tiFocusFrom = event.target;
                    return;
                }
                // 浏览器不支持relatedTarget:IE下不支持
                // 判断是否为内部焦点转移通过元素方法：
                // 两个元素的焦点切换时，会先触发a元素的失焦，再触发b元素的聚焦
                // a失焦处理：当前聚焦元素为该元素的可聚焦元素时，则认为是内部焦点转移，并且将聚焦元素的relatedTarget赋值为当前失焦元素，方便blur时的处理；
                // b聚焦处理：判断当前聚焦元素的relatedTarget是否为内部可聚焦元素，如果是的话，则判定其为内部焦点转移
                if (this.focusableElems.length > 1 &&
                    this.focusableElems.includes(document.activeElement)) {
                    // 即将聚焦（实际上已经聚焦）的元素，记录一下焦点从哪儿来。
                    document.activeElement.tiFocusFrom = event.target; // element setAttribute赋值不支持对象形式，因此使用该方式
                    return;
                }
            }
            this.focusedElem = undefined;
            // 取消宿主元素的聚焦属性
            this.setAttr(this.nativeElement, 'tiFocused', false);
            // 触发整体失焦事件
            this.blurEvent.emit(event);
            // blur时如果model值改变，则发送change事件
            if (this.model !== this.focusModel) {
                this.changeEvent.emit(this.model);
            }
            // 触发组件的touched回调，标志其已被touch过
            if (this.onModelTouched) {
                this.onModelTouched();
            }
        };
        /* 表单4接口end */
    }
    /**
     * @ignore
     * 实现表单注册接口
     * @param type 类型
     * @returns 对象
     */
    static getValueAccessor(type) {
        return {
            provide: NG_VALUE_ACCESSOR,
            // tslint:disable-next-line:no-forward-ref
            useExisting: forwardRef(() => type),
            multi: true
        };
    }
    /**
     * 是否组件整体聚焦
     */
    get focused() {
        return this.nativeElement.attributes.tiFocused !== undefined;
    }
    /**
     * 为Dom元素添加/移除属性，此处用于disabled和focused属性的操作
     * @param  element 需要操作的Dom元素
     * @param  attr 操作的属性
     * @param  value 属性值，为true时属性值即为属性值,为false时，移除属性
     */
    setAttr(element, attr, value) {
        // 如果可聚焦元素是原生input等，[disabled]属性会生效。
        // this.renderer.setProperty(this.focusElem, 'disabled', isDisabled); // 参照angular官方设置disabled源码，true和fasle都考虑了
        // 如果可聚焦元素是组件、div，[disabled]属性不会生效。但setAttribute会增加一项html属性。setProperty不增加。
        if (value) {
            this.renderer.setAttribute(element, attr, attr);
        }
        else {
            this.renderer.removeAttribute(element, attr);
        }
    }
    ngOnInit() {
        super.ngOnInit();
        // 表单中统一加该属性，用于表单校验中的样式选择器
        this.renderer.setAttribute(this.nativeElement, 'tiForm', '');
    }
    /**
     * 监听disabled变化
     */
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        if (changes['disabled']) {
            this.setDisabledState(changes['disabled'].currentValue);
        }
    }
    /**
     * 注意：子类继承自Form基类，如果有this.setFocusableElems([xxx]), 那么要更晚调用super.ngAfterViewChecked()。
     * 子类ngAfterViewChecked(): void {
     *      this.setFocusableElems([xxx]);
     *      // 更晚调用super
     *      super.ngAfterViewChecked();
     * }
     */
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        if (this.ngAfterViewCheckedFirst) {
            this.ngAfterViewCheckedFirst = false;
            // 尽量延迟autoFocus的执行。因为有些组件在ngAfterViewInit才拿得到ngFor ngIf内的元素作为可聚焦元素。
            this.autoFocus();
        }
    }
    /**
     * 当做生命周期用吧，监听模型值变化。包括writeValue和this.model=赋值 这两个时刻。
     * @param model 模型值
     */
    ngOnModelChange(model) {
    }
    /**
     * 设置tab键/点击时的聚焦元素，会顺便设置组件focus()聚焦时可聚焦元素（第一个非disabled的可聚焦元素）。
     * 当可聚焦元素变动，或者单一元素disabled状态变动，都要重新调用此方法设置。
     * 建议一般在ngOnInit生命周期调用，如果ngFor/ngIf内元素在ngOnInit找不到那么可在ngAfterViewInit生命周期调用。
     * 注意：所有生命周期，都要调用类似super.ngOnInit()
     *
     * @param elems 可聚焦元素数组Array<Element>，第一个非disabled元素为整个组件的可聚焦元素。
     *
     * 目前使用分为几种情况：
     * 1）一般表单组件，含有可聚焦子元素。
     * 组件主动设置可聚焦元素数组this.setFocusableElems([xxxElement, yyyElement]);
     * 2）有的表单组件，永远不聚焦。
     * slider/list/menulist/droplist，统一不调用此接口。
     * a.不调用接口时，@Input() tabindex: string = '0';未生效。但用户在html标签上设置的属性tabindex="0"等，会生效。
     * b.调用了this.setFocusableElems([]);时，强制清除了标签属性tabindex。用户设置的属性tabindex="1"，会无效，不出现在标签上。
     * 3）少量组件，内部没有可聚焦元素。但是皮儿需要聚焦，ti-dominator。
     * 需要设置this.setFocusableElems([this.nativeElement]);
     */
    setFocusableElems(elems) {
        if (!elems) {
            // 不支持组件传入 null 和undefined，支持传入[]
            return;
        }
        // TODO: 第二次调用时，如果焦点元素减少，那么需要处理tabindex
        // TODO: 支持用户动态第二次设置setFocusableElems。其实，actionmenu会动态设置
        this.focusableElems = elems;
        // 将要上焦点的元素
        this.setFocusElem();
        // 给所有子元素添加tabindex。
        this.setElemsTabindex();
        // 设置宿主标签上的focus()/blur()方法
        this.setNativeElementFocusFn();
        // 设置focus/blur事件监听
        this.setFocusEvents();
    }
    /**
     *  调用focus()函数，会触发组件整体聚焦，此时焦点元素。
     */
    setFocusElem() {
        this.focusElem = undefined;
        // 寻找第一个非disabled元素，作为可聚焦元素
        for (const elem of this.focusableElems) {
            if (elem && elem.attributes.disabled === undefined) {
                this.focusElem = elem;
                break;
            }
        }
    }
    /**
     * 去除皮上的tabindex，给内部可聚焦子元素添加tabindex
     * 当然，特殊情况：this.setFocusableElems([this.nativeElement]);时，又会给皮上补上tabindex
     * 本来此方法，可以合入setFocusEvents()，减少遍历循环。但为了清晰，依然单独为函数。
     */
    setElemsTabindex() {
        // 去除组件标签上的tabindex属性。
        this.renderer.removeAttribute(this.nativeElement, 'tabindex');
        this.focusableElems.forEach((elem) => {
            // 给每一个元素添加tabindex
            this.setTabindex(elem);
        });
    }
    /**
     * @ignore
     */
    getFocusableElems() {
        return this.focusableElems;
    }
    /**
     * 宿主元素标签上添加类似原生focus()方法。
     * 用户调用方法: document.getElementById('ti-xxx').focus();
     * 其实，更推荐调用组件实例上的方法tiXxxComp.focus();
     */
    setNativeElementFocusFn() {
        // 注意：这里必须用箭头函数，以保证运行时this变量不变。
        if (this.focusElem !== this.nativeElement) { // 避免无限循环调用，所以要有此条件限制
            // SSR环境直接返回，是因为SSR环境报错：Cannot assign to read only property 'focus' of object 
            // 采用['nativeElement']['focus']也解决不了
            if (typeof global !== 'undefined') {
                return;
            }
            this.nativeElement.focus = () => {
                this.focus();
            };
            this.nativeElement.blur = () => {
                this.blur();
            };
        }
    }
    /**
     * 设置组件中的可聚焦元素并监听事件
     */
    setFocusEvents() {
        // if (elems.length === 1 && this.focusableElems && this.focusableElems.length > 1) {
        //     // 多聚焦元素，第二次setFocusElem()时，elems长度为1，也会走到这里，返回。
        //     return;
        // }
        // 取消原有的focus/blur监听
        if (this.focusCancelFns) {
            this.focusCancelFns.forEach((fn) => fn());
        }
        if (this.blurCancelFns) {
            this.blurCancelFns.forEach((fn) => fn());
        }
        if (this.mousedownCancelFns) {
            this.mousedownCancelFns.forEach((fn) => fn());
        }
        // 建立新的focus/blur监听
        this.focusCancelFns = new Array();
        this.blurCancelFns = new Array();
        this.mousedownCancelFns = new Array();
        this.focusableElems.forEach((elem) => {
            this.focusCancelFns.push(this.renderer.listen(elem, 'focus', this.focusCallbackFn));
            this.blurCancelFns.push(this.renderer.listen(elem, 'blur', this.blurCallbackFn));
        });
    }
    /**
     * 聚焦方法。类似HTML DOM节点方法focus
     */
    focus() {
        if (this.focusElem) {
            this.focusElem.focus();
        }
    }
    /**
     * 失焦方法。类似HTML DOM节点方法blur
     */
    blur() {
        if (this.focusedElem) {
            this.focusedElem.blur(); // 只对当前聚焦元素进行失焦处理
        }
    }
    /**
     * Tiny组件各种行为，尽量和原生一致。 autofocus也许可以做成一个指令
     * Tiny3新增：增加初始化焦点autofocus支持。IE9本来不支持autofocus，这时也支持了
     */
    autoFocus() {
        if (this.nativeElement.attributes.autofocus) {
            this.focus();
        }
    }
    /**
     * 实现类表单组件的set和get方法
     */
    get model() {
        return this._model;
    }
    /**
     * 设置model值，如果有变化，则触发ngModelChange
     */
    set model(model) {
        if (this._model === model) {
            return;
        }
        this._model = model;
        if (this.onModelChange) {
            this.onModelChange(model);
        }
        this.ngOnModelChange(model);
    }
    /* 表单4接口start */
    /**
     * @ignore
     * 如果用户改变了[ngModel]绑定的变量，那么Angular会通知到这里
     * 子类如果没有特殊需求，都需要首行调用super.writeValue（xxx）
     *
     * super.writeValue 和 this.model=xxx的区别：
     * super.writeValue不会触发ngModelChange
     * this.model=xxx会触发ngModelChange
     * @param model any类型
     */
    writeValue(model) {
        this._model = model;
        this.ngOnModelChange(model);
    }
    /**
     * @ignore
     * Angular将(ngModelChange)绑定的函数，通知到这里。
     * 当组件内部model值改变，需要调用这个函数向外通知。
     * @param fn 回调函数
     */
    registerOnChange(fn) {
        this.onModelChange = fn;
    }
    /**
     * @ignore
     * Blur时，或者需要校验时，需要调用此函数。（可能描述不准确，需要再查资料）
     * @param fn 回调函数
     */
    registerOnTouched(fn) {
        this.onModelTouched = fn;
    }
    /**
     * @ignore
     * 用户绑定在[disabled]上的变量变化，会通知到这里。
     * ti-xxx组件皮上设置[disabled]，会给皮上设置disabled属性，也会给所有可聚焦元素设置disabled属性。
     * 如有特殊需求，子类可以不使用super.setDisabledState(), 而是直接覆盖。
     * Angular原生[disabled]机制：checkbox/radio走不进原生setDisabledState()。原生[disabled][id]等取值也很晚。
     * 注意: Form基类@Input() disabled已经接管了Angular原生[disabled]机制。
     * ngOnChanges监听到disabled值（第一次和后续改变），会通知到这里。
     * @param isDisabled 是否禁用
     */
    setDisabledState(isDisabled) {
        // 表单this.form.controls.myselect.disable();会直接通知到这里，但不会通知到ngOnChanges。所以要设置this.disabled =
        this.disabled = isDisabled;
        // 给宿主添加disabled属性
        this.setAttr(this.nativeElement, 'disabled', isDisabled);
        // 给聚焦事件元素添加disabled属性
        this.focusableElems.forEach((element) => {
            this.setAttr(element, 'disabled', isDisabled);
            // 如果可聚焦元素是自定义组件、div等，那么标签上的disabled属性不生效。
            // 需要借助于tabindex控制是否允许焦点。
            // 控制禁用样式，方案一：（推荐）less里[disabled]属性模仿伪类，ti-xxx皮上的[disabled]更可靠
            // 方案二：html的ngClass用Form基类disabled变量。
            this.setTabindex(element);
        });
    }
    /**
     * 设置tabindex
     * @param element 原生标签元素
     */
    setTabindex(element) {
        // 整体禁用，或者小元素被禁用。
        if (element.attributes.disabled) {
            // 禁用时
            this.renderer.removeAttribute(element, 'tabindex');
            // A和input已经有disabled属性了，不需要加tabindex
            // 普通元素，也不需要加tabindex
            // A标签禁用时想要点击和tab都不落焦点，唯一方法是去除href
            if (element.tagName === 'A') {
                this.renderer.removeAttribute(element, 'href');
            }
        }
        else {
            if (element.tagName === 'A') {
                // 特例：A标签不设置tabindex='0'。Chrome浏览器不设置tabindex效果：点击时无蓝框，tab时有蓝框。
                if (this.tabindex === '0') {
                    this.renderer.removeAttribute(element, 'tabindex');
                }
                else {
                    this.renderer.setAttribute(element, 'tabindex', this.tabindex);
                }
                // disabled时去除的href，添加回来
                if (!element.attributes.href) {
                    // 默认所有的A标签都是tiny使用的标签，href都是javascript:void(0)
                    this.renderer.setAttribute(element, 'href', 'javascript:void(0)');
                }
            }
            else {
                this.renderer.setAttribute(element, 'tabindex', this.tabindex);
            }
        }
    }
}
TiFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-form',
                template: ''
            },] }
];
TiFormComponent.propDecorators = {
    tabindex: [{ type: Input }],
    disabled: [{ type: Input }],
    focusEvent: [{ type: Output, args: ['focus',] }],
    blurEvent: [{ type: Output, args: ['blur',] }],
    changeEvent: [{ type: Output, args: ['change',] }]
};
/**
 * tabindex相关知识：
 * 所有已设置tabindex的元素，都会点击聚焦。哪怕<div tabindex="-1">test</div>也会点击聚焦。
 * Tab键，会按照顺序聚焦：1,2,3,4，...0，按照此顺序聚焦。
 * tabindex='-1'不参与Tab键, 但是可以点击聚焦。
 * A标签不设置tabindex效果：Chrome浏览器点击时无蓝框，tab时有蓝框。其他浏览器有差异。
 * A标签禁用时想要点击和tab都不落焦点，唯一方法是去除href
 * input标签不设置tabindex效果：Chrome浏览器点击时/tab时都有蓝框。
 * 如果设置tabindex='',或者tabindex='tabindex'，这样非法设置，Chrome相当于没有设置。其他浏览器有差异
 */
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlGb3JtQ29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL2NvbXBvbmVudHMvYmFzZS9UaUZvcm1Db21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQXVCLE1BQU0sZUFBZSxDQUFDO0FBQ3hHLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBSzdDLG1CQUFtQjtBQUNuQjs7R0FFRztBQUtILE1BQU0sT0FBTyxlQUFnQixTQUFRLGVBQWU7SUFKcEQ7O1FBS0k7O1dBRUc7UUFDTSxhQUFRLEdBQVcsR0FBRyxDQUFDO1FBS2hDOztXQUVHO1FBQ0gsb0NBQW9DO1FBQ3BDLDRCQUE0QjtRQUM1Qiw0Q0FBNEM7UUFDbEIsZUFBVSxHQUE2QixJQUFJLFlBQVksRUFBYyxDQUFDO1FBQ2hHOztXQUVHO1FBQ0gsNENBQTRDO1FBQ25CLGNBQVMsR0FBNkIsSUFBSSxZQUFZLEVBQWMsQ0FBQztRQUM5Rjs7O1dBR0c7UUFDSCx3QkFBd0I7UUFDeEIsNENBQTRDO1FBQ2pCLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFRcEY7Ozs7O1dBS0c7UUFDSyxtQkFBYyxHQUFlLEVBQUUsQ0FBQztRQUdoQyw0QkFBdUIsR0FBWSxJQUFJLENBQUMsQ0FBQyxhQUFhO1FBaU05RDs7V0FFRztRQUNLLG9CQUFlLEdBQWtDLENBQUMsS0FBaUIsRUFBRSxFQUFFO1lBQzNFLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUNoQyx3REFBd0Q7WUFDeEQsSUFBSSxDQUFD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QVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ2xFO2dCQUNELHdCQUF3QjtnQkFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFO29CQUMxQiwrQ0FBK0M7b0JBQy9DLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztpQkFDckU7YUFDSjtpQkFBTTtnQkFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNsRTtTQUNKO0lBQ0wsQ0FBQzs7O1lBbmRKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsU0FBUztnQkFDbkIsUUFBUSxFQUFFLEVBQUU7YUFDZjs7O3VCQUtJLEtBQUs7dUJBSUwsS0FBSzt5QkFPTCxNQUFNLFNBQUMsT0FBTzt3QkFLZCxNQUFNLFNBQUMsTUFBTTswQkFPYixNQUFNLFNBQUMsUUFBUTs7QUF1YnBCOzs7Ozs7Ozs7R0FTRyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBmb3J3YXJkUmVmLCBJbnB1dCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgVGlCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9UaUJhc2VDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBUaUJyb3dzZXIgfSBmcm9tICcuLi8uLi91dGlscy9VdGlsJztcclxuXHJcbi8vIFNTUueOr+Wig+mcgOimgVxyXG5kZWNsYXJlIGxldCBnbG9iYWw6IGFueTtcclxuXHJcbi8vIFRPRE86IGFyaWEtbGFiZWxcclxuLyoqXHJcbiAqIOihqOWNleWfuuexu++8jOW3suWunueOsGF1dG9mb2N1cyB0YWJpbmRleCBkaXNhYmxlZCBmb2N1cygpIGJsdXIoKSBmb2N1cy9ibHVyL2NoYW5nZeS6i+S7tiBDb250cm9sVmFsdWVBY2Nlc3NvclxyXG4gKi9cclxuQENvbXBvbmVudCh7Ly8gbGli57yW6K+R6KaB5rGCQENvbXBvbmVudFxyXG4gICAgc2VsZWN0b3I6ICd0aS1mb3JtJyxcclxuICAgIHRlbXBsYXRlOiAnJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlGb3JtQ29tcG9uZW50IGV4dGVuZHMgVGlCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xyXG4gICAgLyoqXHJcbiAgICAgKiBIVE1M5bGe5oCndGFiaW5kZXhcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdGFiaW5kZXg6IHN0cmluZyA9ICcwJztcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm56aB55SoXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuOyAvLyDlm6DkuLpBbmd1YWxy5Y6f55SfW2Rpc2FibGVkXS0+c2V0RGlzYWJsZWRTdGF0ZeacuuWItuWcqOWNlemAieWkmumAieayoeacieeUn+aViOOAguaJgOS7pe+8jOi/memHjOaOpeeuoeS6huOAglxyXG4gICAgLyoqXHJcbiAgICAgKiBIVE1M5LqL5Lu2Zm9jdXNcclxuICAgICAqL1xyXG4gICAgLy8gVE9ET++8mmlw57uE5Lu2562J5piv6Kem5Y+R5Y6f55SfSFRNTOeahGZvY3Vz5LqL5Lu277yM5L6/5LqO5qCh6aqM77yfXHJcbiAgICAvLyBUT0RP77ya5LiA6KGM5pyJ5Lik5LiqdHNsaW506ZSZ6K+v77yM5peg5rOV5Li05pe25raI6ZmkXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tb3V0cHV0LXJlbmFtZVxyXG4gICAgQE91dHB1dCgnZm9jdXMnKSByZWFkb25seSBmb2N1c0V2ZW50OiBFdmVudEVtaXR0ZXI8Rm9jdXNFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvY3VzRXZlbnQ+KCk7XHJcbiAgICAvKipcclxuICAgICAqIEhUTUzkuovku7ZibHVyXHJcbiAgICAgKi9cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtcmVuYW1lXHJcbiAgICBAT3V0cHV0KCdibHVyJykgcmVhZG9ubHkgYmx1ckV2ZW50OiBFdmVudEVtaXR0ZXI8Rm9jdXNFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvY3VzRXZlbnQ+KCk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEhUTUzkuovku7ZjaGFuZ2VcclxuICAgICAqL1xyXG4gICAgLy8gYmx1cuaXtm1vZGVs5YC85pS55Y+Y6Kem5Y+RY2hhbmdlXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tb3V0cHV0LXJlbmFtZVxyXG4gICAgQE91dHB1dCgnY2hhbmdlJykgcmVhZG9ubHkgY2hhbmdlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBmb2N1c0NhbmNlbEZuczogQXJyYXk8KCkgPT4gdm9pZD47IC8vIOebkeWQrGZvdWNz5LqL5Lu255qE5Y+W5raI5Y+l5p+EXHJcbiAgICBwcml2YXRlIGJsdXJDYW5jZWxGbnM6IEFycmF5PCgpID0+IHZvaWQ+OyAvLyDnm5HlkKxibHVy5LqL5Lu255qE5Y+W5raI5Y+l5p+EXHJcbiAgICBwcml2YXRlIG1vdXNlZG93bkNhbmNlbEZuczogQXJyYXk8KCkgPT4gdm9pZD47IC8vIOebkeWQrGJsdXLkuovku7bnmoTlj5bmtojlj6Xmn4RcclxuICAgIHByaXZhdGUgZm9jdXNNb2RlbDogYW55OyAvLyDokL3nhKbngrnml7bvvIzorrDlvZVtb2RlbOWAvFxyXG5cclxuICAgIHByb3RlY3RlZCBmb2N1c0VsZW06IGFueTsgLy8gYXV0b2ZvY3VzIGZvY3VzKCnlsIbopoHogZrnhKbnmoTlhYPntKDjgILpu5jorqTmmK/lrr/kuLvlhYPntKDvvIzlrZDnsbvorr7nva5mb2N1c2FibGVFbGVtc+WQju+8jOS4uuesrOS4gOS4qumdnmRpc2FibGVk5Y+v6IGa54Sm5YWD57Sg44CCXHJcbiAgICAvKipcclxuICAgICAqIOaVtOS9k2ZvY3VzL2JsdXLkuovku7blj4LkuI7nmoTlhYPntKDvvIzlkoxkaXNhYmxlZOiuvue9ruOAglxyXG4gICAgICog57uE5Lu25YW35pyJ5aSa5LiqaW5wdXTovpPlhaXmoYY6XHJcbiAgICAgKiAxKeaXoOWFg+e0oOiBmueEpi0+5Lu75LiA5YWD57Sg6IGa54SmPeaVtOS9k+iBmueEpuS6i+S7tuOAglxyXG4gICAgICogMinku7vkuIDlhYPntKDlpLHnhKYtPuWFtuS7luWFg+e0oOaXoOeEpueCuT3mlbTkvZPlpLHnhKbkuovku7bjgIJcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBmb2N1c2FibGVFbGVtczogQXJyYXk8YW55PiA9IFtdO1xyXG4gICAgLy8g5a6e546w6KGo5Y2VNOaOpeWPozHms6jlhoxcclxuICAgIHByaXZhdGUgX21vZGVsOiBhbnk7ICAvLyDkvKDlhaXmqKHlnovlgLxcclxuICAgIHByaXZhdGUgbmdBZnRlclZpZXdDaGVja2VkRmlyc3Q6IGJvb2xlYW4gPSB0cnVlOyAvLyDmmK/lkKbnrKzkuIDmrKHmiafooYzliJ3lp4vljJZcclxuXHJcbnByb3RlY3RlZCBvbk1vZGVsQ2hhbmdlOiAobW9kZWw6IGFueSkgPT4gdm9pZDsgLy8g5qih5Z6LY2hhbmdl5Zue6LCD5Ye95pWw77yM6Kem5Y+R5qih5Z6L5YC85pS55Y+YXHJcbiAgICBwcm90ZWN0ZWQgb25Nb2RlbFRvdWNoZWQ6ICgpID0+IHZvaWQ7IC8vIOaooeWei2JsdXLlm57osIPlh73mlbDvvIzop6blj5HmoKHpqoxcclxuICAgIHByb3RlY3RlZCBmb2N1c2VkRWxlbTogYW55OyAvLyDlt7LogZrnhKblhYPntKAsIOWcqOWtkOe7hOS7tuS4reacieS9v+eUqFxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlrp7njrDooajljZXms6jlhozmjqXlj6NcclxuICAgICAqIEBwYXJhbSB0eXBlIOexu+Wei1xyXG4gICAgICogQHJldHVybnMg5a+56LGhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0VmFsdWVBY2Nlc3Nvcih0eXBlOiBUeXBlPGFueT4pOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZm9yd2FyZC1yZWZcclxuICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gdHlwZSksXHJcbiAgICAgICAgICAgIG11bHRpOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm57uE5Lu25pW05L2T6IGa54SmXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgZm9jdXNlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMudGlGb2N1c2VkICE9PSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOS4ukRvbeWFg+e0oOa3u+WKoC/np7vpmaTlsZ7mgKfvvIzmraTlpITnlKjkuo5kaXNhYmxlZOWSjGZvY3VzZWTlsZ7mgKfnmoTmk43kvZxcclxuICAgICAqIEBwYXJhbSAgZWxlbWVudCDpnIDopoHmk43kvZznmoREb23lhYPntKBcclxuICAgICAqIEBwYXJhbSAgYXR0ciDmk43kvZznmoTlsZ7mgKdcclxuICAgICAqIEBwYXJhbSAgdmFsdWUg5bGe5oCn5YC877yM5Li6dHJ1ZeaXtuWxnuaAp+WAvOWNs+S4uuWxnuaAp+WAvCzkuLpmYWxzZeaXtu+8jOenu+mZpOWxnuaAp1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgc2V0QXR0cihlbGVtZW50OiBhbnksIGF0dHI6IHN0cmluZywgdmFsdWU6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICAvLyDlpoLmnpzlj6/ogZrnhKblhYPntKDmmK/ljp/nlJ9pbnB1dOetie+8jFtkaXNhYmxlZF3lsZ7mgKfkvJrnlJ/mlYjjgIJcclxuICAgICAgICAvLyB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZm9jdXNFbGVtLCAnZGlzYWJsZWQnLCBpc0Rpc2FibGVkKTsgLy8g5Y+C54WnYW5ndWxhcuWumOaWueiuvue9rmRpc2FibGVk5rqQ56CB77yMdHJ1ZeWSjGZhc2xl6YO96ICD6JmR5LqGXHJcbiAgICAgICAgLy8g5aaC5p6c5Y+v6IGa54Sm5YWD57Sg5piv57uE5Lu244CBZGl277yMW2Rpc2FibGVkXeWxnuaAp+S4jeS8mueUn+aViOOAguS9hnNldEF0dHJpYnV0ZeS8muWinuWKoOS4gOmhuWh0bWzlsZ7mgKfjgIJzZXRQcm9wZXJ0eeS4jeWinuWKoOOAglxyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShlbGVtZW50LCBhdHRyLCBhdHRyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZShlbGVtZW50LCBhdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIC8vIOihqOWNleS4ree7n+S4gOWKoOivpeWxnuaAp++8jOeUqOS6juihqOWNleagoemqjOS4reeahOagt+W8j+mAieaLqeWZqFxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMubmF0aXZlRWxlbWVudCwgJ3RpRm9ybScsICcnKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog55uR5ZCsZGlzYWJsZWTlj5jljJZcclxuICAgICAqL1xyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgIGlmIChjaGFuZ2VzWydkaXNhYmxlZCddKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGlzYWJsZWRTdGF0ZShjaGFuZ2VzWydkaXNhYmxlZCddLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDms6jmhI/vvJrlrZDnsbvnu6fmib/oh6pGb3Jt5Z+657G777yM5aaC5p6c5pyJdGhpcy5zZXRGb2N1c2FibGVFbGVtcyhbeHh4XSksIOmCo+S5iOimgeabtOaZmuiwg+eUqHN1cGVyLm5nQWZ0ZXJWaWV3Q2hlY2tlZCgp44CCXHJcbiAgICAgKiDlrZDnsbtuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICAgKiAgICAgIHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW3h4eF0pO1xyXG4gICAgICogICAgICAvLyDmm7TmmZrosIPnlKhzdXBlclxyXG4gICAgICogICAgICBzdXBlci5uZ0FmdGVyVmlld0NoZWNrZWQoKTtcclxuICAgICAqIH1cclxuICAgICAqL1xyXG4gICAgbmdBZnRlclZpZXdDaGVja2VkKCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nQWZ0ZXJWaWV3Q2hlY2tlZCgpO1xyXG4gICAgICAgIGlmICh0aGlzLm5nQWZ0ZXJWaWV3Q2hlY2tlZEZpcnN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMubmdBZnRlclZpZXdDaGVja2VkRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8g5bC96YeP5bu26L+fYXV0b0ZvY3Vz55qE5omn6KGM44CC5Zug5Li65pyJ5Lqb57uE5Lu25ZyobmdBZnRlclZpZXdJbml05omN5ou/5b6X5YiwbmdGb3IgbmdJZuWGheeahOWFg+e0oOS9nOS4uuWPr+iBmueEpuWFg+e0oOOAglxyXG4gICAgICAgICAgICB0aGlzLmF1dG9Gb2N1cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5b2T5YGa55Sf5ZG95ZGo5pyf55So5ZCn77yM55uR5ZCs5qih5Z6L5YC85Y+Y5YyW44CC5YyF5ousd3JpdGVWYWx1ZeWSjHRoaXMubW9kZWw96LWL5YC8IOi/meS4pOS4quaXtuWIu+OAglxyXG4gICAgICogQHBhcmFtIG1vZGVsIOaooeWei+WAvFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgbmdPbk1vZGVsQ2hhbmdlKG1vZGVsOiBhbnkpOiB2b2lkIHtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572udGFi6ZSuL+eCueWHu+aXtueahOiBmueEpuWFg+e0oO+8jOS8mumhuuS+v+iuvue9rue7hOS7tmZvY3VzKCnogZrnhKbml7blj6/ogZrnhKblhYPntKDvvIjnrKzkuIDkuKrpnZ5kaXNhYmxlZOeahOWPr+iBmueEpuWFg+e0oO+8ieOAglxyXG4gICAgICog5b2T5Y+v6IGa54Sm5YWD57Sg5Y+Y5Yqo77yM5oiW6ICF5Y2V5LiA5YWD57SgZGlzYWJsZWTnirbmgIHlj5jliqjvvIzpg73opoHph43mlrDosIPnlKjmraTmlrnms5Xorr7nva7jgIJcclxuICAgICAqIOW7uuiuruS4gOiIrOWcqG5nT25Jbml055Sf5ZG95ZGo5pyf6LCD55So77yM5aaC5p6cbmdGb3IvbmdJZuWGheWFg+e0oOWcqG5nT25Jbml05om+5LiN5Yiw6YKj5LmI5Y+v5ZyobmdBZnRlclZpZXdJbml055Sf5ZG95ZGo5pyf6LCD55So44CCXHJcbiAgICAgKiDms6jmhI/vvJrmiYDmnInnlJ/lkb3lkajmnJ/vvIzpg73opoHosIPnlKjnsbvkvLxzdXBlci5uZ09uSW5pdCgpXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGVsZW1zIOWPr+iBmueEpuWFg+e0oOaVsOe7hEFycmF5PEVsZW1lbnQ+77yM56ys5LiA5Liq6Z2eZGlzYWJsZWTlhYPntKDkuLrmlbTkuKrnu4Tku7bnmoTlj6/ogZrnhKblhYPntKDjgIJcclxuICAgICAqXHJcbiAgICAgKiDnm67liY3kvb/nlKjliIbkuLrlh6Dnp43mg4XlhrXvvJpcclxuICAgICAqIDHvvInkuIDoiKzooajljZXnu4Tku7bvvIzlkKvmnInlj6/ogZrnhKblrZDlhYPntKDjgIJcclxuICAgICAqIOe7hOS7tuS4u+WKqOiuvue9ruWPr+iBmueEpuWFg+e0oOaVsOe7hHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW3h4eEVsZW1lbnQsIHl5eUVsZW1lbnRdKTtcclxuICAgICAqIDLvvInmnInnmoTooajljZXnu4Tku7bvvIzmsLjov5zkuI3ogZrnhKbjgIJcclxuICAgICAqIHNsaWRlci9saXN0L21lbnVsaXN0L2Ryb3BsaXN077yM57uf5LiA5LiN6LCD55So5q2k5o6l5Y+j44CCXHJcbiAgICAgKiBhLuS4jeiwg+eUqOaOpeWPo+aXtu+8jEBJbnB1dCgpIHRhYmluZGV4OiBzdHJpbmcgPSAnMCc75pyq55Sf5pWI44CC5L2G55So5oi35ZyoaHRtbOagh+etvuS4iuiuvue9rueahOWxnuaAp3RhYmluZGV4PVwiMFwi562J77yM5Lya55Sf5pWI44CCXHJcbiAgICAgKiBiLuiwg+eUqOS6hnRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW10pO+aXtu+8jOW8uuWItua4hemZpOS6huagh+etvuWxnuaAp3RhYmluZGV444CC55So5oi36K6+572u55qE5bGe5oCndGFiaW5kZXg9XCIxXCLvvIzkvJrml6DmlYjvvIzkuI3lh7rnjrDlnKjmoIfnrb7kuIrjgIJcclxuICAgICAqIDPvvInlsJHph4/nu4Tku7bvvIzlhoXpg6jmsqHmnInlj6/ogZrnhKblhYPntKDjgILkvYbmmK/nmq7lhL/pnIDopoHogZrnhKbvvIx0aS1kb21pbmF0b3LjgIJcclxuICAgICAqIOmcgOimgeiuvue9rnRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW3RoaXMubmF0aXZlRWxlbWVudF0pO1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgc2V0Rm9jdXNhYmxlRWxlbXMoZWxlbXM6IEFycmF5PGFueT4pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIWVsZW1zKSB7XHJcbiAgICAgICAgICAgIC8vIOS4jeaUr+aMgee7hOS7tuS8oOWFpSBudWxsIOWSjHVuZGVmaW5lZO+8jOaUr+aMgeS8oOWFpVtdXHJcbiAgICAgICAgICAgIHJldHVybiA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRPRE86IOesrOS6jOasoeiwg+eUqOaXtu+8jOWmguaenOeEpueCueWFg+e0oOWHj+Wwke+8jOmCo+S5iOmcgOimgeWkhOeQhnRhYmluZGV4XHJcbiAgICAgICAgLy8gVE9ETzog5pSv5oyB55So5oi35Yqo5oCB56ys5LqM5qyh6K6+572uc2V0Rm9jdXNhYmxlRWxlbXPjgILlhbblrp7vvIxhY3Rpb25tZW515Lya5Yqo5oCB6K6+572uXHJcbiAgICAgICAgdGhpcy5mb2N1c2FibGVFbGVtcyA9IGVsZW1zO1xyXG4gICAgICAgIC8vIOWwhuimgeS4iueEpueCueeahOWFg+e0oFxyXG4gICAgICAgIHRoaXMuc2V0Rm9jdXNFbGVtKCk7XHJcbiAgICAgICAgLy8g57uZ5omA5pyJ5a2Q5YWD57Sg5re75YqgdGFiaW5kZXjjgIJcclxuICAgICAgICB0aGlzLnNldEVsZW1zVGFiaW5kZXgoKTtcclxuICAgICAgICAvLyDorr7nva7lrr/kuLvmoIfnrb7kuIrnmoRmb2N1cygpL2JsdXIoKeaWueazlVxyXG4gICAgICAgIHRoaXMuc2V0TmF0aXZlRWxlbWVudEZvY3VzRm4oKTtcclxuICAgICAgICAvLyDorr7nva5mb2N1cy9ibHVy5LqL5Lu255uR5ZCsXHJcbiAgICAgICAgdGhpcy5zZXRGb2N1c0V2ZW50cygpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiAg6LCD55SoZm9jdXMoKeWHveaVsO+8jOS8muinpuWPkee7hOS7tuaVtOS9k+iBmueEpu+8jOatpOaXtueEpueCueWFg+e0oOOAglxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldEZvY3VzRWxlbSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZvY3VzRWxlbSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAvLyDlr7vmib7nrKzkuIDkuKrpnZ5kaXNhYmxlZOWFg+e0oO+8jOS9nOS4uuWPr+iBmueEpuWFg+e0oFxyXG4gICAgICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLmZvY3VzYWJsZUVsZW1zKSB7XHJcbiAgICAgICAgICAgIGlmIChlbGVtICYmIGVsZW0uYXR0cmlidXRlcy5kaXNhYmxlZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzRWxlbSA9IGVsZW07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Y676Zmk55qu5LiK55qEdGFiaW5kZXjvvIznu5nlhoXpg6jlj6/ogZrnhKblrZDlhYPntKDmt7vliqB0YWJpbmRleFxyXG4gICAgICog5b2T54S277yM54m55q6K5oOF5Ya177yadGhpcy5zZXRGb2N1c2FibGVFbGVtcyhbdGhpcy5uYXRpdmVFbGVtZW50XSk75pe277yM5Y+I5Lya57uZ55qu5LiK6KGl5LiKdGFiaW5kZXhcclxuICAgICAqIOacrOadpeatpOaWueazle+8jOWPr+S7peWQiOWFpXNldEZvY3VzRXZlbnRzKCnvvIzlh4/lsJHpgY3ljoblvqrnjq/jgILkvYbkuLrkuobmuIXmmbDvvIzkvp3nhLbljZXni6zkuLrlh73mlbDjgIJcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRFbGVtc1RhYmluZGV4KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOWOu+mZpOe7hOS7tuagh+etvuS4iueahHRhYmluZGV45bGe5oCn44CCXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5uYXRpdmVFbGVtZW50LCAndGFiaW5kZXgnKTtcclxuICAgICAgICB0aGlzLmZvY3VzYWJsZUVsZW1zLmZvckVhY2goKGVsZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDnu5nmr4/kuIDkuKrlhYPntKDmt7vliqB0YWJpbmRleFxyXG4gICAgICAgICAgICB0aGlzLnNldFRhYmluZGV4KGVsZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb2N1c2FibGVFbGVtcygpOiBBcnJheTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mb2N1c2FibGVFbGVtcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5a6/5Li75YWD57Sg5qCH562+5LiK5re75Yqg57G75Ly85Y6f55SfZm9jdXMoKeaWueazleOAglxyXG4gICAgICog55So5oi36LCD55So5pa55rOVOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGkteHh4JykuZm9jdXMoKTtcclxuICAgICAqIOWFtuWunu+8jOabtOaOqOiNkOiwg+eUqOe7hOS7tuWunuS+i+S4iueahOaWueazlXRpWHh4Q29tcC5mb2N1cygpO1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldE5hdGl2ZUVsZW1lbnRGb2N1c0ZuKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOazqOaEj++8mui/memHjOW/hemhu+eUqOeureWktOWHveaVsO+8jOS7peS/neivgei/kOihjOaXtnRoaXPlj5jph4/kuI3lj5jjgIJcclxuICAgICAgICBpZiAodGhpcy5mb2N1c0VsZW0gIT09IHRoaXMubmF0aXZlRWxlbWVudCkgeyAvLyDpgb/lhY3ml6DpmZDlvqrnjq/osIPnlKjvvIzmiYDku6XopoHmnInmraTmnaHku7bpmZDliLZcclxuICAgICAgICAgICAgLy8gU1NS546v5aKD55u05o6l6L+U5Zue77yM5piv5Zug5Li6U1NS546v5aKD5oql6ZSZ77yaQ2Fubm90IGFzc2lnbiB0byByZWFkIG9ubHkgcHJvcGVydHkgJ2ZvY3VzJyBvZiBvYmplY3QgXHJcbiAgICAgICAgICAgIC8vIOmHh+eUqFsnbmF0aXZlRWxlbWVudCddWydmb2N1cydd5Lmf6Kej5Yaz5LiN5LqGXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubmF0aXZlRWxlbWVudC5mb2N1cyA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmJsdXIgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJsdXIoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rue7hOS7tuS4reeahOWPr+iBmueEpuWFg+e0oOW5tuebkeWQrOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldEZvY3VzRXZlbnRzKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIGlmIChlbGVtcy5sZW5ndGggPT09IDEgJiYgdGhpcy5mb2N1c2FibGVFbGVtcyAmJiB0aGlzLmZvY3VzYWJsZUVsZW1zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAvLyAgICAgLy8g5aSa6IGa54Sm5YWD57Sg77yM56ys5LqM5qyhc2V0Rm9jdXNFbGVtKCnml7bvvIxlbGVtc+mVv+W6puS4ujHvvIzkuZ/kvJrotbDliLDov5nph4zvvIzov5Tlm57jgIJcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyDlj5bmtojljp/mnInnmoRmb2N1cy9ibHVy55uR5ZCsXHJcbiAgICAgICAgaWYgKHRoaXMuZm9jdXNDYW5jZWxGbnMpIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c0NhbmNlbEZucy5mb3JFYWNoKChmbjogKCkgPT4gdm9pZCkgPT4gZm4oKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmJsdXJDYW5jZWxGbnMpIHtcclxuICAgICAgICAgICAgdGhpcy5ibHVyQ2FuY2VsRm5zLmZvckVhY2goKGZuOiAoKSA9PiB2b2lkKSA9PiBmbigpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubW91c2Vkb3duQ2FuY2VsRm5zKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW91c2Vkb3duQ2FuY2VsRm5zLmZvckVhY2goKGZuOiAoKSA9PiB2b2lkKSA9PiBmbigpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5bu656uL5paw55qEZm9jdXMvYmx1cuebkeWQrFxyXG4gICAgICAgIHRoaXMuZm9jdXNDYW5jZWxGbnMgPSBuZXcgQXJyYXk8YW55PigpO1xyXG4gICAgICAgIHRoaXMuYmx1ckNhbmNlbEZucyA9IG5ldyBBcnJheTxhbnk+KCk7XHJcbiAgICAgICAgdGhpcy5tb3VzZWRvd25DYW5jZWxGbnMgPSBuZXcgQXJyYXk8YW55PigpO1xyXG5cclxuICAgICAgICB0aGlzLmZvY3VzYWJsZUVsZW1zLmZvckVhY2goKGVsZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZvY3VzQ2FuY2VsRm5zLnB1c2godGhpcy5yZW5kZXJlci5saXN0ZW4oZWxlbSwgJ2ZvY3VzJywgdGhpcy5mb2N1c0NhbGxiYWNrRm4pKTtcclxuICAgICAgICAgICAgdGhpcy5ibHVyQ2FuY2VsRm5zLnB1c2godGhpcy5yZW5kZXJlci5saXN0ZW4oZWxlbSwgJ2JsdXInLCB0aGlzLmJsdXJDYWxsYmFja0ZuKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGZvY3Vz5Zue6LCD5Ye95pWwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZm9jdXNDYWxsYmFja0ZuOiAoKGV2ZW50OiBGb2N1c0V2ZW50KSA9PiB2b2lkKSA9IChldmVudDogRm9jdXNFdmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZm9jdXNlZEVsZW0gPSBldmVudC50YXJnZXQ7XHJcbiAgICAgICAgLy8g6Z2eSUXmtY/op4jlmajmlK/mjIFldmVudC5yZWxhdGVkVGFyZ2V077yM5L2/55SoZXZlbnQucmVsYXRlZFRhcmdldOi/m+ihjOWkhOeQhlxyXG4gICAgICAgIGlmICghVGlCcm93c2VyLmlzSUUoKSkge1xyXG4gICAgICAgICAgICAvLyDlvZPkuLrlhoXpg6jnhKbngrnovaznp7vvvIzkuI3lgZrlpITnkIZcclxuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNhYmxlRWxlbXMubGVuZ3RoID4gMSAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGVFbGVtcy5pbmNsdWRlcyhldmVudC5yZWxhdGVkVGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHsvLyBJRea1j+iniOWZqOeahOWkhOeQhu+8mua1j+iniOWZqOS4jeaUr+aMgXJlbGF0ZWRUYXJnZXTmg4XlhrXkuIvnmoTlpITnkIbvvIzlj4Lop4FibHVy5Lit55qE6K+05piOXHJcbiAgICAgICAgICAgIGlmICgoZXZlbnQudGFyZ2V0IGFzIGFueSkudGlGb2N1c0Zyb20pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAvLyDmg4XlhrXkuIDvvJrlpLHnhKblkI7lvLrliLbogZrnhKZcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IChldmVudC50YXJnZXQgYXMgYW55KS50aUZvY3VzRnJvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOmdouadv+a7muWKqOadoUlF5YW85a6577ya5ZyoZm9jdXNpbuS4re+8jOiuqeWkseeEpuWFg+e0oOW8uuWItuiBmueEpu+8jOS8mui1sOWIsOi/memHjOOAglxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDmg4XlhrXkuozvvJrlhoXpg6jnhKbngrnovaznp7tcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvY3VzYWJsZUVsZW1zLmxlbmd0aCA+IDEgJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzYWJsZUVsZW1zLmluY2x1ZGVzKChldmVudC50YXJnZXQgYXMgYW55KS50aUZvY3VzRnJvbSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8g5oOF5Ya15LiJ77ya6L6D6Zq+55CG6Kej77ya5aSW6YOo54Sm54K56L2s56e75pe277yMKGV2ZW50LnRhcmdldCBhcyBhbnkpLnRpRm9jdXNGcm9t5Lmf5piv5pyJ5YC855qE44CCXHJcbiAgICAgICAgICAgICAgICAvLyDov5nnp43mg4XlhrXvvIzmmK/lm6DkuLrnu4Tku7bltYzlpZfkvb/nlKjvvIzmraTogZrnhKblhYPntKDliIbliKvku47lsZ7kuo7lpJrkuKrnu4Tku7bjgIJcclxuICAgICAgICAgICAgICAgIC8vIOWvueS6jkHnu4Tku7bmnaXor7TvvIzmmK/nhKbngrnlhoXpg6jovaznp7vjgILlr7nkuo5C57uE5Lu25p2l6K+077yM5piv54Sm54K55aSW6YOo6L2s56e744CCXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6K6+572u5a6/5Li75YWD57Sg55qE6IGa54Sm5bGe5oCn77yM55So5LqO5qCH6K+G6K+l57uE5Lu25aSE5LqO6IGa54Sm54q25oCB77yM6K+l5bGe5oCn5Y+v55So5LqOY3Nz6YCJ5oup5Zmo77ya5Zyo5a6/5Li75YWD57Sg5LiK5aKe5Yqg5bGe5oCnZm9jdXNlZFxyXG4gICAgICAgIHRoaXMuc2V0QXR0cih0aGlzLm5hdGl2ZUVsZW1lbnQsICd0aUZvY3VzZWQnLCB0cnVlKTtcclxuICAgICAgICAvLyDop6blj5HmlbTkvZPogZrnhKbkuovku7ZcclxuICAgICAgICB0aGlzLmZvY3VzRXZlbnQuZW1pdChldmVudCk7XHJcbiAgICAgICAgLy8g5L+d5a2YZm9jdXPml7Ztb2RlbOWAvO+8jGJsdXLml7blpoLmnpxtb2RlbOWAvOaUueWPmO+8jOWImeWPkemAgWNoYW5nZeS6i+S7tlxyXG4gICAgICAgIHRoaXMuZm9jdXNNb2RlbCA9IHRoaXMubW9kZWw7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGJsdXIg5Zue6LCD5Ye95pWwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYmx1ckNhbGxiYWNrRm46ICgoZXZlbnQ6IEZvY3VzRXZlbnQpID0+IHZvaWQpID0gKGV2ZW50OiBGb2N1c0V2ZW50KSA9PiB7XHJcbiAgICAgICAgLy8g6Z2eSUXmtY/op4jlmajmlK/mjIFldmVudC5yZWxhdGVkVGFyZ2V077yM5L2/55SoZXZlbnQucmVsYXRlZFRhcmdldOi/m+ihjOWkhOeQhlxyXG4gICAgICAgIGlmICghVGlCcm93c2VyLmlzSUUoKSkge1xyXG4gICAgICAgICAgICAvLyDlvZPkuLrlhoXpg6jnhKbngrnovaznp7vvvIzkuI3lgZrlpITnkIZcclxuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNhYmxlRWxlbXMubGVuZ3RoID4gMSAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGVFbGVtcy5pbmNsdWRlcyhldmVudC5yZWxhdGVkVGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIC8vIOW3sue7j+WkseeEpueahOWFg+e0oO+8jOa4hemZpOiusOW9leeEpueCueS7juWTqumHjOiAjOadpeOAglxyXG4gICAgICAgICAgICAoZXZlbnQudGFyZ2V0IGFzIGFueSkudGlGb2N1c0Zyb20gPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICAvLyDlpoLmnpzlpLHnhKblhYPntKDlvLrliLbogZrnhKbvvIzkuI3op6blj5HmlbTkvZPlpLHnhKbkuovku7bjgIJcclxuICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgLy8g6Z2i5p2/5rua5Yqo5p2hSUXlhbzlrrnvvJrlnKhmb2N1c2lu5Lit77yM6K6p5aSx54Sm5YWD57Sg5by65Yi26IGa54Sm77yM5Lya6LWw5Yiw6L+Z6YeM44CCXHJcbiAgICAgICAgICAgICAgICAvLyDljbPlsIbogZrnhKbvvIjlrp7pmYXkuIrlt7Lnu4/ogZrnhKbvvInnmoTlhYPntKDvvIzorrDlvZXkuIDkuIvnhKbngrnku47lk6rlhL/mnaXvvJrku47oh6rlt7HmnaXnmoRcclxuICAgICAgICAgICAgICAgIChkb2N1bWVudC5hY3RpdmVFbGVtZW50IGFzIGFueSkudGlGb2N1c0Zyb20gPSBldmVudC50YXJnZXQ7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmtY/op4jlmajkuI3mlK/mjIFyZWxhdGVkVGFyZ2V0OklF5LiL5LiN5pSv5oyBXHJcbiAgICAgICAgICAgIC8vIOWIpOaWreaYr+WQpuS4uuWGhemDqOeEpueCuei9rOenu+mAmui/h+WFg+e0oOaWueazle+8mlxyXG4gICAgICAgICAgICAvLyDkuKTkuKrlhYPntKDnmoTnhKbngrnliIfmjaLml7bvvIzkvJrlhYjop6blj5Fh5YWD57Sg55qE5aSx54Sm77yM5YaN6Kem5Y+RYuWFg+e0oOeahOiBmueEplxyXG4gICAgICAgICAgICAvLyBh5aSx54Sm5aSE55CG77ya5b2T5YmN6IGa54Sm5YWD57Sg5Li66K+l5YWD57Sg55qE5Y+v6IGa54Sm5YWD57Sg5pe277yM5YiZ6K6k5Li65piv5YaF6YOo54Sm54K56L2s56e777yM5bm25LiU5bCG6IGa54Sm5YWD57Sg55qEcmVsYXRlZFRhcmdldOi1i+WAvOS4uuW9k+WJjeWkseeEpuWFg+e0oO+8jOaWueS+v2JsdXLml7bnmoTlpITnkIbvvJtcclxuICAgICAgICAgICAgLy8gYuiBmueEpuWkhOeQhu+8muWIpOaWreW9k+WJjeiBmueEpuWFg+e0oOeahHJlbGF0ZWRUYXJnZXTmmK/lkKbkuLrlhoXpg6jlj6/ogZrnhKblhYPntKDvvIzlpoLmnpzmmK/nmoTor53vvIzliJnliKTlrprlhbbkuLrlhoXpg6jnhKbngrnovaznp7tcclxuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNhYmxlRWxlbXMubGVuZ3RoID4gMSAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c2FibGVFbGVtcy5pbmNsdWRlcyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5Y2z5bCG6IGa54Sm77yI5a6e6ZmF5LiK5bey57uP6IGa54Sm77yJ55qE5YWD57Sg77yM6K6w5b2V5LiA5LiL54Sm54K55LuO5ZOq5YS/5p2l44CCXHJcbiAgICAgICAgICAgICAgICAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBhcyBhbnkpLnRpRm9jdXNGcm9tID0gZXZlbnQudGFyZ2V0OyAvLyBlbGVtZW50IHNldEF0dHJpYnV0Zei1i+WAvOS4jeaUr+aMgeWvueixoeW9ouW8j++8jOWboOatpOS9v+eUqOivpeaWueW8j1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZvY3VzZWRFbGVtID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIC8vIOWPlua2iOWuv+S4u+WFg+e0oOeahOiBmueEpuWxnuaAp1xyXG4gICAgICAgIHRoaXMuc2V0QXR0cih0aGlzLm5hdGl2ZUVsZW1lbnQsICd0aUZvY3VzZWQnLCBmYWxzZSk7XHJcbiAgICAgICAgLy8g6Kem5Y+R5pW05L2T5aSx54Sm5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5ibHVyRXZlbnQuZW1pdChldmVudCk7XHJcbiAgICAgICAgLy8gYmx1cuaXtuWmguaenG1vZGVs5YC85pS55Y+Y77yM5YiZ5Y+R6YCBY2hhbmdl5LqL5Lu2XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwgIT09IHRoaXMuZm9jdXNNb2RlbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQodGhpcy5tb2RlbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOinpuWPkee7hOS7tueahHRvdWNoZWTlm57osIPvvIzmoIflv5flhbblt7Looqt0b3VjaOi/h1xyXG4gICAgICAgIGlmICh0aGlzLm9uTW9kZWxUb3VjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25Nb2RlbFRvdWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiBmueEpuaWueazleOAguexu+S8vEhUTUwgRE9N6IqC54K55pa55rOVZm9jdXNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGZvY3VzKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmZvY3VzRWxlbSkge1xyXG4gICAgICAgICAgICB0aGlzLmZvY3VzRWxlbS5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5aSx54Sm5pa55rOV44CC57G75Ly8SFRNTCBET03oioLngrnmlrnms5VibHVyXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBibHVyKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmZvY3VzZWRFbGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXNlZEVsZW0uYmx1cigpOyAvLyDlj6rlr7nlvZPliY3ogZrnhKblhYPntKDov5vooYzlpLHnhKblpITnkIZcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRpbnnnu4Tku7blkITnp43ooYzkuLrvvIzlsL3ph4/lkozljp/nlJ/kuIDoh7TjgIIgYXV0b2ZvY3Vz5Lmf6K645Y+v5Lul5YGa5oiQ5LiA5Liq5oyH5LukXHJcbiAgICAgKiBUaW55M+aWsOWinu+8muWinuWKoOWIneWni+WMlueEpueCuWF1dG9mb2N1c+aUr+aMgeOAgklFOeacrOadpeS4jeaUr+aMgWF1dG9mb2N1c++8jOi/meaXtuS5n+aUr+aMgeS6hlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGF1dG9Gb2N1cygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMuYXV0b2ZvY3VzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWunueOsOexu+ihqOWNlee7hOS7tueahHNldOWSjGdldOaWueazlVxyXG4gICAgICovXHJcbiAgICBnZXQgbW9kZWwoKTogYW55IHtcclxuICAgICAgcmV0dXJuIHRoaXMuX21vZGVsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva5tb2RlbOWAvO+8jOWmguaenOacieWPmOWMlu+8jOWImeinpuWPkW5nTW9kZWxDaGFuZ2VcclxuICAgICAqL1xyXG4gICAgc2V0IG1vZGVsKG1vZGVsOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5fbW9kZWwgPT09IG1vZGVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcclxuICAgICAgICBpZiAodGhpcy5vbk1vZGVsQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25Nb2RlbENoYW5nZShtb2RlbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubmdPbk1vZGVsQ2hhbmdlKG1vZGVsKTtcclxuICAgIH1cclxuICAgIC8qIOihqOWNlTTmjqXlj6NzdGFydCAqL1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlpoLmnpznlKjmiLfmlLnlj5jkuoZbbmdNb2RlbF3nu5HlrprnmoTlj5jph4/vvIzpgqPkuYhBbmd1bGFy5Lya6YCa55+l5Yiw6L+Z6YeMXHJcbiAgICAgKiDlrZDnsbvlpoLmnpzmsqHmnInnibnmrorpnIDmsYLvvIzpg73pnIDopoHpppbooYzosIPnlKhzdXBlci53cml0ZVZhbHVl77yIeHh477yJXHJcbiAgICAgKlxyXG4gICAgICogc3VwZXIud3JpdGVWYWx1ZSDlkowgdGhpcy5tb2RlbD14eHjnmoTljLrliKvvvJpcclxuICAgICAqIHN1cGVyLndyaXRlVmFsdWXkuI3kvJrop6blj5FuZ01vZGVsQ2hhbmdlXHJcbiAgICAgKiB0aGlzLm1vZGVsPXh4eOS8muinpuWPkW5nTW9kZWxDaGFuZ2VcclxuICAgICAqIEBwYXJhbSBtb2RlbCBhbnnnsbvlnotcclxuICAgICAqL1xyXG4gICAgd3JpdGVWYWx1ZShtb2RlbDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcclxuICAgICAgICB0aGlzLm5nT25Nb2RlbENoYW5nZShtb2RlbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEFuZ3VsYXLlsIYobmdNb2RlbENoYW5nZSnnu5HlrprnmoTlh73mlbDvvIzpgJrnn6XliLDov5nph4zjgIJcclxuICAgICAqIOW9k+e7hOS7tuWGhemDqG1vZGVs5YC85pS55Y+Y77yM6ZyA6KaB6LCD55So6L+Z5Liq5Ye95pWw5ZCR5aSW6YCa55+l44CCXHJcbiAgICAgKiBAcGFyYW0gZm4g5Zue6LCD5Ye95pWwXHJcbiAgICAgKi9cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChtb2RlbDogYW55KSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlID0gZm47XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEJsdXLml7bvvIzmiJbogIXpnIDopoHmoKHpqozml7bvvIzpnIDopoHosIPnlKjmraTlh73mlbDjgILvvIjlj6/og73mj4/ov7DkuI3lh4bnoa7vvIzpnIDopoHlho3mn6XotYTmlpnvvIlcclxuICAgICAqIEBwYXJhbSBmbiDlm57osIPlh73mlbBcclxuICAgICAqL1xyXG4gICAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9uTW9kZWxUb3VjaGVkID0gZm47XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeUqOaIt+e7keWumuWcqFtkaXNhYmxlZF3kuIrnmoTlj5jph4/lj5jljJbvvIzkvJrpgJrnn6XliLDov5nph4zjgIJcclxuICAgICAqIHRpLXh4eOe7hOS7tuearuS4iuiuvue9rltkaXNhYmxlZF3vvIzkvJrnu5nnmq7kuIrorr7nva5kaXNhYmxlZOWxnuaAp++8jOS5n+S8mue7meaJgOacieWPr+iBmueEpuWFg+e0oOiuvue9rmRpc2FibGVk5bGe5oCn44CCXHJcbiAgICAgKiDlpoLmnInnibnmrorpnIDmsYLvvIzlrZDnsbvlj6/ku6XkuI3kvb/nlKhzdXBlci5zZXREaXNhYmxlZFN0YXRlKCksIOiAjOaYr+ebtOaOpeimhuebluOAglxyXG4gICAgICogQW5ndWxhcuWOn+eUn1tkaXNhYmxlZF3mnLrliLbvvJpjaGVja2JveC9yYWRpb+i1sOS4jei/m+WOn+eUn3NldERpc2FibGVkU3RhdGUoKeOAguWOn+eUn1tkaXNhYmxlZF1baWRd562J5Y+W5YC85Lmf5b6I5pma44CCXHJcbiAgICAgKiDms6jmhI86IEZvcm3ln7rnsbtASW5wdXQoKSBkaXNhYmxlZOW3sue7j+aOpeeuoeS6hkFuZ3VsYXLljp/nlJ9bZGlzYWJsZWRd5py65Yi244CCXHJcbiAgICAgKiBuZ09uQ2hhbmdlc+ebkeWQrOWIsGRpc2FibGVk5YC877yI56ys5LiA5qyh5ZKM5ZCO57ut5pS55Y+Y77yJ77yM5Lya6YCa55+l5Yiw6L+Z6YeM44CCXHJcbiAgICAgKiBAcGFyYW0gaXNEaXNhYmxlZCDmmK/lkKbnpoHnlKhcclxuICAgICAqL1xyXG4gICAgc2V0RGlzYWJsZWRTdGF0ZT8oaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIC8vIOihqOWNlXRoaXMuZm9ybS5jb250cm9scy5teXNlbGVjdC5kaXNhYmxlKCk75Lya55u05o6l6YCa55+l5Yiw6L+Z6YeM77yM5L2G5LiN5Lya6YCa55+l5YiwbmdPbkNoYW5nZXPjgILmiYDku6XopoHorr7nva50aGlzLmRpc2FibGVkID1cclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcclxuICAgICAgICAvLyDnu5nlrr/kuLvmt7vliqBkaXNhYmxlZOWxnuaAp1xyXG4gICAgICAgIHRoaXMuc2V0QXR0cih0aGlzLm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcsIGlzRGlzYWJsZWQpO1xyXG4gICAgICAgIC8vIOe7meiBmueEpuS6i+S7tuWFg+e0oOa3u+WKoGRpc2FibGVk5bGe5oCnXHJcbiAgICAgICAgdGhpcy5mb2N1c2FibGVFbGVtcy5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKGVsZW1lbnQsICdkaXNhYmxlZCcsIGlzRGlzYWJsZWQpO1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzlj6/ogZrnhKblhYPntKDmmK/oh6rlrprkuYnnu4Tku7bjgIFkaXbnrYnvvIzpgqPkuYjmoIfnrb7kuIrnmoRkaXNhYmxlZOWxnuaAp+S4jeeUn+aViOOAglxyXG4gICAgICAgICAgICAvLyDpnIDopoHlgJ/liqnkuo50YWJpbmRleOaOp+WItuaYr+WQpuWFgeiuuOeEpueCueOAglxyXG4gICAgICAgICAgICAvLyDmjqfliLbnpoHnlKjmoLflvI/vvIzmlrnmoYjkuIDvvJrvvIjmjqjojZDvvIlsZXNz6YeMW2Rpc2FibGVkXeWxnuaAp+aooeS7v+S8quexu++8jHRpLXh4eOearuS4iueahFtkaXNhYmxlZF3mm7Tlj6/pnaBcclxuICAgICAgICAgICAgLy8g5pa55qGI5LqM77yaaHRtbOeahG5nQ2xhc3PnlKhGb3Jt5Z+657G7ZGlzYWJsZWTlj5jph4/jgIJcclxuICAgICAgICAgICAgdGhpcy5zZXRUYWJpbmRleChlbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572udGFiaW5kZXhcclxuICAgICAqIEBwYXJhbSBlbGVtZW50IOWOn+eUn+agh+etvuWFg+e0oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldFRhYmluZGV4KGVsZW1lbnQ6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIC8vIOaVtOS9k+emgeeUqO+8jOaIluiAheWwj+WFg+e0oOiiq+emgeeUqOOAglxyXG4gICAgICAgIGlmIChlbGVtZW50LmF0dHJpYnV0ZXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgLy8g56aB55So5pe2XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGVsZW1lbnQsICd0YWJpbmRleCcpO1xyXG4gICAgICAgICAgICAvLyBB5ZKMaW5wdXTlt7Lnu4/mnIlkaXNhYmxlZOWxnuaAp+S6hu+8jOS4jemcgOimgeWKoHRhYmluZGV4XHJcbiAgICAgICAgICAgIC8vIOaZrumAmuWFg+e0oO+8jOS5n+S4jemcgOimgeWKoHRhYmluZGV4XHJcblxyXG4gICAgICAgICAgICAvLyBB5qCH562+56aB55So5pe25oOz6KaB54K55Ye75ZKMdGFi6YO95LiN6JC954Sm54K577yM5ZSv5LiA5pa55rOV5piv5Y676ZmkaHJlZlxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lID09PSAnQScpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGVsZW1lbnQsICdocmVmJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lID09PSAnQScpIHtcclxuICAgICAgICAgICAgICAgIC8vIOeJueS+i++8mkHmoIfnrb7kuI3orr7nva50YWJpbmRleD0nMCfjgIJDaHJvbWXmtY/op4jlmajkuI3orr7nva50YWJpbmRleOaViOaenO+8mueCueWHu+aXtuaXoOiTneahhu+8jHRhYuaXtuacieiTneahhuOAglxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGFiaW5kZXggPT09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGVsZW1lbnQsICd0YWJpbmRleCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShlbGVtZW50LCAndGFiaW5kZXgnLCB0aGlzLnRhYmluZGV4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGRpc2FibGVk5pe25Y676Zmk55qEaHJlZu+8jOa3u+WKoOWbnuadpVxyXG4gICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LmF0dHJpYnV0ZXMuaHJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOm7mOiupOaJgOacieeahEHmoIfnrb7pg73mmK90aW555L2/55So55qE5qCH562+77yMaHJlZumDveaYr2phdmFzY3JpcHQ6dm9pZCgwKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKGVsZW1lbnQsICdocmVmJywgJ2phdmFzY3JpcHQ6dm9pZCgwKScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoZWxlbWVudCwgJ3RhYmluZGV4JywgdGhpcy50YWJpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiDooajljZU05o6l5Y+jZW5kICovXHJcbn1cclxuLyoqXHJcbiAqIHRhYmluZGV455u45YWz55+l6K+G77yaXHJcbiAqIOaJgOacieW3suiuvue9rnRhYmluZGV455qE5YWD57Sg77yM6YO95Lya54K55Ye76IGa54Sm44CC5ZOq5oCVPGRpdiB0YWJpbmRleD1cIi0xXCI+dGVzdDwvZGl2PuS5n+S8mueCueWHu+iBmueEpuOAglxyXG4gKiBUYWLplK7vvIzkvJrmjInnhafpobrluo/ogZrnhKbvvJoxLDIsMyw077yMLi4uMO+8jOaMieeFp+atpOmhuuW6j+iBmueEpuOAglxyXG4gKiB0YWJpbmRleD0nLTEn5LiN5Y+C5LiOVGFi6ZSuLCDkvYbmmK/lj6/ku6Xngrnlh7vogZrnhKbjgIJcclxuICogQeagh+etvuS4jeiuvue9rnRhYmluZGV45pWI5p6c77yaQ2hyb21l5rWP6KeI5Zmo54K55Ye75pe25peg6JOd5qGG77yMdGFi5pe25pyJ6JOd5qGG44CC5YW25LuW5rWP6KeI5Zmo5pyJ5beu5byC44CCXHJcbiAqIEHmoIfnrb7npoHnlKjml7bmg7PopoHngrnlh7vlkox0YWLpg73kuI3okL3nhKbngrnvvIzllK/kuIDmlrnms5XmmK/ljrvpmaRocmVmXHJcbiAqIGlucHV05qCH562+5LiN6K6+572udGFiaW5kZXjmlYjmnpzvvJpDaHJvbWXmtY/op4jlmajngrnlh7vml7YvdGFi5pe26YO95pyJ6JOd5qGG44CCXHJcbiAqIOWmguaenOiuvue9rnRhYmluZGV4PScnLOaIluiAhXRhYmluZGV4PSd0YWJpbmRleCfvvIzov5nmoLfpnZ7ms5Xorr7nva7vvIxDaHJvbWXnm7jlvZPkuo7msqHmnInorr7nva7jgILlhbbku5bmtY/op4jlmajmnInlt67lvIJcclxuICovXHJcbiJdfQ==