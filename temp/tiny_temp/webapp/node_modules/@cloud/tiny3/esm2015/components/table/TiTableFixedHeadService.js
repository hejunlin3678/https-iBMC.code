import { Injectable, RendererFactory2 } from '@angular/core';
import { TiRenderer } from '../../services/renderer/TiRenderer';
import { TiTableFixedHeadServiceModule } from './TiTableFixedHeadServiceModule';
import * as i0 from "@angular/core";
import * as i1 from "../../services/renderer/TiRenderer";
import * as i2 from "./TiTableFixedHeadServiceModule";
/**
 * @ignore
 * 提供表头锁定功能
 */
export class TiTableFixedHeadService {
    constructor(rendererFactory, tiRenderer) {
        this.tiRenderer = tiRenderer;
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    getTheadContainer(hostEle) {
        return this.tiRenderer.findChildrenByClassName(hostEle, 'ti3-table-fixed-head')[0];
    }
    getTbodyContainer(theadContainer) {
        const tbodyContainer = theadContainer.nextElementSibling;
        if (tbodyContainer && this.tiRenderer.hasClass(tbodyContainer, 'ti3-table-container')) {
            return tbodyContainer;
        }
        return;
    }
    processOverflowY(theadContainer, tbodyContainer, tableCom) {
        const headTable = theadContainer.children[0];
        const scrollBarWidth = this.getScrollBarWidth('Y');
        const isOverflowedY = this.overflowedResult(tbodyContainer, 'Y');
        const isOverflowedX = this.overflowedResult(tbodyContainer, 'X');
        // 根据表体的宽度来设置表头的宽度
        if (isOverflowedY && !isOverflowedX) {
            this.renderer.setStyle(headTable, 'width', `calc(100% - ${scrollBarWidth}px)`);
        }
        else {
            this.renderer.setStyle(headTable, 'width', '100%');
        }
        const fixheadFiller = this.tiRenderer.findChildrenByClassName(theadContainer, 'ti3-table-fixed-head-filler')[0];
        // 1px为经验值，避免计算的误差导致填充块和表头之间有一点空白间隔
        const fillerWidth = scrollBarWidth + 1;
        // 根据Y轴是否有滚动条来控制表头右侧的填充块的有无
        if (isOverflowedY) {
            if (tableCom.fixedColumnInfo.thFixedRight) {
                this.renderer.setStyle(tableCom.fixedColumnInfo.thFixedRight, 'right', `${scrollBarWidth}px`);
            }
            if (fixheadFiller) {
                this.renderer.setStyle(fixheadFiller, 'width', fillerWidth + 'px');
                return;
            }
            const headerFiller = document.createElement('div');
            this.renderer.addClass(headerFiller, 'ti3-table-fixed-head-filler');
            this.renderer.setStyle(headerFiller, 'width', fillerWidth + 'px');
            theadContainer.appendChild(headerFiller);
        }
        else if (fixheadFiller) {
            this.renderer.removeChild(theadContainer, fixheadFiller);
            if (tableCom.fixedColumnInfo.thFixedRight) {
                this.renderer.setStyle(tableCom.fixedColumnInfo.thFixedRight, 'right', 0);
            }
        }
    }
    removeTbodyContainerBorderBottom(tbodyContainer, displayedData) {
        const tbody = tbodyContainer.children[0].children[1];
        const hasNodataTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata').length > 0;
        const hasNodataGuideTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata-guide').length > 0;
        const hasLoadfailTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-loadfail').length > 0;
        const hasNodataSimpleTbody = this.tiRenderer.findChildrenByClassName(tbody, 'ti3-table-nodata-simple').length > 0;
        // 判断是否包含表格无数据，有图片是大间距，其他场景全部为单行文字样式，包括以下四种情况；
        // 1、表格无数据：ti-table-nodata（有图片）；
        // 2、查询内容为空，提示用户'购买商品'：ti-table-nodata-guide；
        // 3、加载不成功，提示'重新加载'：ti-table-loadfail。
        // 4. 表格无数据：ti-table-nodata-simple，只有文字提示（无图片）
        const noBorderTerm = hasNodataTbody || hasNodataGuideTbody || hasLoadfailTbody || hasNodataSimpleTbody;
        if (displayedData.length === 0 && noBorderTerm) {
            this.renderer.setStyle(tbodyContainer, 'border-bottom', 'none');
        }
        else {
            this.renderer.setStyle(tbodyContainer, 'border-bottom', '');
        }
    }
    // 由于用scrollHeight计算在IE和火狐下偶尔有1px的误差，
    // 所以此处直接获取表格更准确的高度和容器的clientHeight作对比
    overflowedResult(tbodyContainer, direction, isNum) {
        let containerSize = 0;
        let tbodySize = 0;
        const tbodyTable = tbodyContainer.children[0];
        if (direction === 'X') {
            containerSize = tbodyContainer.clientWidth;
            // 修复SSR错误：ERROR TypeError: tbodyTable.getBoundingClientRect is not a function
            if (typeof tbodyTable.getBoundingClientRect !== 'function') {
                return;
            }
            tbodySize = this.numRound(tbodyTable.getBoundingClientRect().width, 0);
        }
        else {
            containerSize = tbodyContainer.clientHeight;
            // 修复SSR错误：ERROR TypeError: tbodyTable.getBoundingClientRect is not a function
            if (typeof tbodyTable.getBoundingClientRect !== 'function') {
                return;
            }
            tbodySize = this.numRound(tbodyTable.getBoundingClientRect().height, 0);
        }
        // 若isNum为true，返回差值，否则返回布尔值
        return isNum ? (tbodySize - containerSize) : (tbodySize > containerSize);
    }
    processYScrollStateChange(colsResizableDire) {
        const options = colsResizableDire.resizableOpts;
        // 主要处理 columns 初始异步的场景
        if (!options.ths || options.ths.length === 0) {
            return;
        }
        const tbodyContainer = colsResizableDire.tableCom.tbodyContainer;
        const theadContainer = colsResizableDire.tableCom.theadContainer;
        const newYScrollState = this.overflowedResult(tbodyContainer, 'Y');
        if (newYScrollState === options.yScrollState) {
            this.processOverflowY(theadContainer, tbodyContainer, colsResizableDire.tableCom);
            return;
        }
        const newXScrollState = this.overflowedResult(tbodyContainer, 'X');
        let lastColIndex = options.ths.length - 1;
        let lastTh = options.ths[lastColIndex];
        let lastThWidth = options.storedSizes[lastColIndex];
        const scrollBarWidth = this.getScrollBarWidth('Y');
        // 纵向滚动条由无到有
        if (newYScrollState) {
            if (newXScrollState && newXScrollState === options.xScrollState) {
                options.storeTableWidthChange += scrollBarWidth;
            }
            else {
                // 第一次纵向滚动条状态发生变化要减小表格宽度时，去减小非特殊列中宽度最大的一列的宽度
                // 这样处理是为了避免最后一列的宽度变小
                if (colsResizableDire.isfirstYScrollStateChange) {
                    lastTh = this.getMaxWidthTh(colsResizableDire);
                    if (lastTh) {
                        lastColIndex = parseInt(lastTh.getAttribute('ti-visible-index'), 10);
                        lastThWidth = options.storedSizes[lastColIndex];
                    }
                }
                options.storedSizes[lastColIndex] = lastThWidth - scrollBarWidth;
            }
            // 纵向滚动条由有到无
        }
        else {
            if (newXScrollState === options.xScrollState) {
                if (newXScrollState) {
                    options.storeTableWidthChange -= scrollBarWidth;
                }
                else {
                    options.storedSizes[lastColIndex] = lastThWidth + scrollBarWidth;
                }
            }
            else if (!newXScrollState) {
                options.storedSizes[lastColIndex] = lastThWidth + (scrollBarWidth -
                    options.storeTableWidthChange);
                options.storeTableWidthChange = 0;
            }
        }
        if (lastTh) {
            colsResizableDire.setWidth(lastTh, options.storedSizes[lastColIndex]);
            colsResizableDire.setWidth(options.secondThs[lastColIndex], options.storedSizes[lastColIndex]);
        }
        this.processOverflowY(theadContainer, tbodyContainer, colsResizableDire.tableCom);
        colsResizableDire.isfirstYScrollStateChange = false;
        options.xScrollState = this.overflowedResult(tbodyContainer, 'X');
        options.yScrollState = this.overflowedResult(tbodyContainer, 'Y');
        // 纵向滚动条状态改变时可能会引起列宽改变和横向滚动条状态改变，所以要处理列固定
        if (colsResizableDire.tableCom.fixedColumnInfo.hasFixedColumn) {
            colsResizableDire.tableCom.processFixedColumn();
        }
    }
    getMaxWidthTh(colsResizableDire) {
        const options = colsResizableDire.resizableOpts;
        colsResizableDire.updateStoredSizes();
        const ths = options.ths.filter((th) => {
            // 排除最后一列和不可拖动的列
            return !th.hasAttribute(colsResizableDire.notResizableAttr) && !colsResizableDire.isLastColumn(th);
        });
        // 按列宽从小到大排序
        const sortedThs = ths.sort((a, b) => {
            const indexA = parseInt(a.getAttribute('ti-visible-index'), 10);
            const indexB = parseInt(b.getAttribute('ti-visible-index'), 10);
            return options.storedSizes[indexA] - options.storedSizes[indexB];
        });
        // 返回宽度最大的列
        return sortedThs[sortedThs.length - 1];
    }
    // 处理在列拖动过程中横向滚动条的出现引起纵向滚动条出现时的账本(storeColsWidthChange)的变化
    handleYOverflowedWithX(resizableOpts, tbodyContainer) {
        const newYScrollState = this.overflowedResult(tbodyContainer, 'Y');
        if (newYScrollState === resizableOpts.yScrollState) {
            return;
        }
        const scrollBarWidth = this.getScrollBarWidth('Y');
        const newXScrollState = this.overflowedResult(tbodyContainer, 'X');
        if (newYScrollState) {
            resizableOpts.storeTableWidthChange += scrollBarWidth;
            resizableOpts.isYOverflowedWithX = true;
        }
        resizableOpts.xScrollState = newXScrollState;
        resizableOpts.yScrollState = newYScrollState;
    }
    handleYNotOverflowedWithX(resizableOpts, tbodyContainer) {
        const scrollBarWidthX = this.getScrollBarWidth('X');
        const scrollBarWidthY = this.getScrollBarWidth('Y');
        const overflowedHeight = this.overflowedResult(tbodyContainer, 'Y', true);
        const overflowedWidth = this.overflowedResult(tbodyContainer, 'X', true);
        // 当列拖动横向滚动条出现导致纵向滚动条出现后，再缩小列宽时，由于无法准确获得横向滚动条消失的时刻去对表格
        // 宽度做补偿，所以当表格列宽到达容器边界附近时，用临时将overflow-x设为hidden的方式使横向滚动条消失。
        if (resizableOpts.isYOverflowedWithX && overflowedHeight > 0 && overflowedHeight <= scrollBarWidthX &&
            overflowedWidth > 0 && overflowedWidth <= scrollBarWidthY) {
            this.renderer.setStyle(tbodyContainer, 'overflow-x', 'hidden');
            // 对账本(storeTableWidthChange)清零
            resizableOpts.storeTableWidthChange = 0;
            resizableOpts.isYOverflowedWithX = false;
            setTimeout(() => {
                this.renderer.setStyle(tbodyContainer, 'overflow-x', 'auto');
            }, 0);
        }
    }
    // 获取滚动条宽度
    getScrollBarWidth(direction) {
        const temporaryDiv = document.createElement('div');
        this.tiRenderer.setStyles(temporaryDiv, {
            position: 'absolute',
            top: '-9999px',
            left: '-9999px',
            width: '100px',
            height: '100px',
            overflow: 'hidden'
        });
        const nestDiv = document.createElement('div');
        this.tiRenderer.setStyles(nestDiv, { width: '100%', height: '100%' });
        temporaryDiv.appendChild(nestDiv);
        document.body.appendChild(temporaryDiv);
        const noScrollWidth = nestDiv.getBoundingClientRect().width;
        const noScrollHeight = nestDiv.getBoundingClientRect().height;
        this.renderer.setStyle(temporaryDiv, 'overflow', 'scroll');
        const scrollWidth = nestDiv.getBoundingClientRect().width;
        const scrollHeight = nestDiv.getBoundingClientRect().height;
        this.renderer.removeChild(document.body, temporaryDiv);
        const scrollBarWidthX = this.numRound(noScrollHeight - scrollHeight, 1);
        const scrollBarWidthY = this.numRound(noScrollWidth - scrollWidth, 1);
        return direction === 'X' ? scrollBarWidthX : scrollBarWidthY;
    }
    // 对浮点数四舍五入保留指定小数位数的数字
    numRound(num, decimal) {
        return parseFloat(num.toFixed(decimal));
    }
}
TiTableFixedHeadService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TiTableFixedHeadService_Factory() { return new TiTableFixedHeadService(i0.ɵɵinject(i0.RendererFactory2), i0.ɵɵinject(i1.TiRenderer)); }, token: TiTableFixedHeadService, providedIn: i2.TiTableFixedHeadServiceModule });
TiTableFixedHeadService.decorators = [
    { type: Injectable, args: [{
                providedIn: TiTableFixedHeadServiceModule
            },] }
];
TiTableFixedHeadService.ctorParameters = () => [
    { type: RendererFactory2 },
    { type: TiRenderer }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlUYWJsZUZpeGVkSGVhZFNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy90YWJsZS9UaVRhYmxlRml4ZWRIZWFkU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7OztBQUdoRjs7O0dBR0c7QUFJSCxNQUFNLE9BQU8sdUJBQXVCO0lBRWhDLFlBQVksZUFBaUMsRUFDekIsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QyxJQUFJLENBQUMsUUFBUSxHQUFHLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFTSxpQkFBaUIsQ0FBQyxPQUFZO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBRU0saUJBQWlCLENBQUMsY0FBbUI7UUFDeEMsTUFBTSxjQUFjLEdBQVEsY0FBYyxDQUFDLGtCQUFrQixDQUFDO1FBQzlELElBQUksY0FBYyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFO1lBQ25GLE9BQU8sY0FBYyxDQUFDO1NBQ3pCO1FBRUQsT0FBTztJQUNYLENBQUM7SUFFTSxnQkFBZ0IsQ0FBQyxjQUFtQixFQUFFLGNBQW1CLEVBQUUsUUFBMEI7UUFDeEYsTUFBTSxTQUFTLEdBQVEsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FB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Q0FBQyxRQUFRLENBQUMsY0FBYyxHQUFHLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNoRixNQUFNLGVBQWUsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsR0FBRyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFOUUsT0FBTyxTQUFTLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQztJQUNqRSxDQUFDO0lBRUQsc0JBQXNCO0lBQ2YsUUFBUSxDQUFDLEdBQVcsRUFBRSxPQUFlO1FBQ3hDLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUM1QyxDQUFDOzs7O1lBelFKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsNkJBQTZCO2FBQzVDOzs7WUFYK0IsZ0JBQWdCO1lBQ3ZDLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBSZW5kZXJlcjIsIFJlbmRlcmVyRmFjdG9yeTIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlSZW5kZXJlciB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3JlbmRlcmVyL1RpUmVuZGVyZXInO1xyXG5pbXBvcnQgeyBUaVRhYmxlRml4ZWRIZWFkU2VydmljZU1vZHVsZSB9IGZyb20gJy4vVGlUYWJsZUZpeGVkSGVhZFNlcnZpY2VNb2R1bGUnO1xyXG5pbXBvcnQgeyBSZXNpemFibGVPcHRzLCBUaUNvbHNSZXNpemFibGVEaXJlY3RpdmUgfSBmcm9tICcuL1RpQ29sc1Jlc2l6YWJsZURpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFRpVGFibGVDb21wb25lbnQgfSBmcm9tICcuL1RpVGFibGVDb21wb25lbnQnO1xyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKiDmj5DkvpvooajlpLTplIHlrprlip/og71cclxuICovXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46IFRpVGFibGVGaXhlZEhlYWRTZXJ2aWNlTW9kdWxlXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaVRhYmxlRml4ZWRIZWFkU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjI7XHJcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlckZhY3Rvcnk6IFJlbmRlcmVyRmFjdG9yeTIsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRpUmVuZGVyZXI6IFRpUmVuZGVyZXIpIHtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKG51bGwsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRUaGVhZENvbnRhaW5lcihob3N0RWxlOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRpUmVuZGVyZXIuZmluZENoaWxkcmVuQnlDbGFzc05hbWUoaG9zdEVsZSwgJ3RpMy10YWJsZS1maXhlZC1oZWFkJylbMF07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFRib2R5Q29udGFpbmVyKHRoZWFkQ29udGFpbmVyOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IHRib2R5Q29udGFpbmVyOiBhbnkgPSB0aGVhZENvbnRhaW5lci5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgaWYgKHRib2R5Q29udGFpbmVyICYmIHRoaXMudGlSZW5kZXJlci5oYXNDbGFzcyh0Ym9keUNvbnRhaW5lciwgJ3RpMy10YWJsZS1jb250YWluZXInKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGJvZHlDb250YWluZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHByb2Nlc3NPdmVyZmxvd1kodGhlYWRDb250YWluZXI6IGFueSwgdGJvZHlDb250YWluZXI6IGFueSwgdGFibGVDb206IFRpVGFibGVDb21wb25lbnQpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBoZWFkVGFibGU6IGFueSA9IHRoZWFkQ29udGFpbmVyLmNoaWxkcmVuWzBdO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbEJhcldpZHRoOiBudW1iZXIgPSB0aGlzLmdldFNjcm9sbEJhcldpZHRoKCdZJyk7XHJcbiAgICAgICAgY29uc3QgaXNPdmVyZmxvd2VkWTogYm9vbGVhbiA9IHRoaXMub3ZlcmZsb3dlZFJlc3VsdCh0Ym9keUNvbnRhaW5lciwgJ1knKTtcclxuICAgICAgICBjb25zdCBpc092ZXJmbG93ZWRYOiBib29sZWFuID0gdGhpcy5vdmVyZmxvd2VkUmVzdWx0KHRib2R5Q29udGFpbmVyLCAnWCcpO1xyXG4gICAgICAgIC8vIOagueaNruihqOS9k+eahOWuveW6puadpeiuvue9ruihqOWktOeahOWuveW6plxyXG4gICAgICAgIGlmIChpc092ZXJmbG93ZWRZICYmICFpc092ZXJmbG93ZWRYKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoaGVhZFRhYmxlLCAnd2lkdGgnLCBgY2FsYygxMDAlIC0gJHtzY3JvbGxCYXJXaWR0aH1weClgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGhlYWRUYWJsZSwgJ3dpZHRoJywgJzEwMCUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZpeGhlYWRGaWxsZXI6IGFueSA9IHRoaXMudGlSZW5kZXJlci5maW5kQ2hpbGRyZW5CeUNsYXNzTmFtZSh0aGVhZENvbnRhaW5lciwgJ3RpMy10YWJsZS1maXhlZC1oZWFkLWZpbGxlcicpWzBdO1xyXG4gICAgICAgIC8vIDFweOS4uue7j+mqjOWAvO+8jOmBv+WFjeiuoeeul+eahOivr+W3ruWvvOiHtOWhq+WFheWdl+WSjOihqOWktOS5i+mXtOacieS4gOeCueepuueZvemXtOmalFxyXG4gICAgICAgIGNvbnN0IGZpbGxlcldpZHRoOiBudW1iZXIgPSBzY3JvbGxCYXJXaWR0aCArIDE7XHJcbiAgICAgICAgLy8g5qC55o2uWei9tOaYr+WQpuaciea7muWKqOadoeadpeaOp+WItuihqOWktOWPs+S+p+eahOWhq+WFheWdl+eahOacieaXoFxyXG4gICAgICAgIGlmIChpc092ZXJmbG93ZWRZKSB7XHJcbiAgICAgICAgICAgIGlmICh0YWJsZUNvbS5maXhlZENvbHVtbkluZm8udGhGaXhlZFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRhYmxlQ29tLmZpeGVkQ29sdW1uSW5mby50aEZpeGVkUmlnaHQsICdyaWdodCcsIGAke3Njcm9sbEJhcldpZHRofXB4YCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChmaXhoZWFkRmlsbGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGZpeGhlYWRGaWxsZXIsICd3aWR0aCcsIGZpbGxlcldpZHRoICsgJ3B4Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJGaWxsZXI6IGFueSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGhlYWRlckZpbGxlciwgJ3RpMy10YWJsZS1maXhlZC1oZWFkLWZpbGxlcicpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGhlYWRlckZpbGxlciwgJ3dpZHRoJywgZmlsbGVyV2lkdGggKyAncHgnKTtcclxuICAgICAgICAgICAgdGhlYWRDb250YWluZXIuYXBwZW5kQ2hpbGQoaGVhZGVyRmlsbGVyKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGZpeGhlYWRGaWxsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGVhZENvbnRhaW5lciwgZml4aGVhZEZpbGxlcik7XHJcbiAgICAgICAgICAgIGlmICh0YWJsZUNvbS5maXhlZENvbHVtbkluZm8udGhGaXhlZFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRhYmxlQ29tLmZpeGVkQ29sdW1uSW5mby50aEZpeGVkUmlnaHQsICdyaWdodCcsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZW1vdmVUYm9keUNvbnRhaW5lckJvcmRlckJvdHRvbSh0Ym9keUNvbnRhaW5lcjogYW55LCBkaXNwbGF5ZWREYXRhOiBBcnJheTxPYmplY3Q+KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgdGJvZHk6IGFueSA9IHRib2R5Q29udGFpbmVyLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzFdO1xyXG4gICAgICAgIGNvbnN0IGhhc05vZGF0YVRib2R5OiBhbnkgPSB0aGlzLnRpUmVuZGVyZXIuZmluZENoaWxkcmVuQnlDbGFzc05hbWUodGJvZHksICd0aTMtdGFibGUtbm9kYXRhJykubGVuZ3RoID4gMDtcclxuICAgICAgICBjb25zdCBoYXNOb2RhdGFHdWlkZVRib2R5OiBhbnkgPSB0aGlzLnRpUmVuZGVyZXIuZmluZENoaWxkcmVuQnlDbGFzc05hbWUodGJvZHksICd0aTMtdGFibGUtbm9kYXRhLWd1aWRlJykubGVuZ3RoID4gMDtcclxuICAgICAgICBjb25zdCBoYXNMb2FkZmFpbFRib2R5OiBhbnkgPSB0aGlzLnRpUmVuZGVyZXIuZmluZENoaWxkcmVuQnlDbGFzc05hbWUodGJvZHksICd0aTMtdGFibGUtbG9hZGZhaWwnKS5sZW5ndGggPiAwO1xyXG4gICAgICAgIGNvbnN0IGhhc05vZGF0YVNpbXBsZVRib2R5OiBhbnkgPSB0aGlzLnRpUmVuZGVyZXIuZmluZENoaWxkcmVuQnlDbGFzc05hbWUodGJvZHksJ3RpMy10YWJsZS1ub2RhdGEtc2ltcGxlJykubGVuZ3RoID4gMDtcclxuICAgICAgICAvLyDliKTmlq3mmK/lkKbljIXlkKvooajmoLzml6DmlbDmja7vvIzmnInlm77niYfmmK/lpKfpl7Tot53vvIzlhbbku5blnLrmma/lhajpg6jkuLrljZXooYzmloflrZfmoLflvI/vvIzljIXmi6zku6XkuIvlm5vnp43mg4XlhrXvvJtcclxuICAgICAgICAvLyAx44CB6KGo5qC85peg5pWw5o2u77yadGktdGFibGUtbm9kYXRh77yI5pyJ5Zu+54mH77yJ77ybXHJcbiAgICAgICAgLy8gMuOAgeafpeivouWGheWuueS4uuepuu+8jOaPkOekuueUqOaItyfotK3kubDllYblk4En77yadGktdGFibGUtbm9kYXRhLWd1aWRl77ybXHJcbiAgICAgICAgLy8gM+OAgeWKoOi9veS4jeaIkOWKn++8jOaPkOekuifph43mlrDliqDovb0n77yadGktdGFibGUtbG9hZGZhaWzjgIJcclxuICAgICAgICAvLyA0LiDooajmoLzml6DmlbDmja7vvJp0aS10YWJsZS1ub2RhdGEtc2ltcGxl77yM5Y+q5pyJ5paH5a2X5o+Q56S677yI5peg5Zu+54mH77yJXHJcbiAgICAgICAgY29uc3Qgbm9Cb3JkZXJUZXJtOiBhbnkgPSBoYXNOb2RhdGFUYm9keSB8fCBoYXNOb2RhdGFHdWlkZVRib2R5IHx8IGhhc0xvYWRmYWlsVGJvZHkgfHwgaGFzTm9kYXRhU2ltcGxlVGJvZHk7XHJcblxyXG4gICAgICAgIGlmIChkaXNwbGF5ZWREYXRhLmxlbmd0aCA9PT0gMCAmJiBub0JvcmRlclRlcm0pIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0Ym9keUNvbnRhaW5lciwgJ2JvcmRlci1ib3R0b20nLCAnbm9uZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGJvZHlDb250YWluZXIsICdib3JkZXItYm90dG9tJywgJycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDnlLHkuo7nlKhzY3JvbGxIZWlnaHTorqHnrpflnKhJReWSjOeBq+eLkOS4i+WBtuWwlOaciTFweOeahOivr+W3ru+8jFxyXG4gICAgLy8g5omA5Lul5q2k5aSE55u05o6l6I635Y+W6KGo5qC85pu05YeG56Gu55qE6auY5bqm5ZKM5a655Zmo55qEY2xpZW50SGVpZ2h05L2c5a+55q+UXHJcbiAgICBwdWJsaWMgb3ZlcmZsb3dlZFJlc3VsdCh0Ym9keUNvbnRhaW5lcjogYW55LCBkaXJlY3Rpb246IHN0cmluZywgaXNOdW0/OiBib29sZWFuKTogYW55IHtcclxuICAgICAgICBsZXQgY29udGFpbmVyU2l6ZTogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgdGJvZHlTaXplOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGNvbnN0IHRib2R5VGFibGU6IGFueSA9IHRib2R5Q29udGFpbmVyLmNoaWxkcmVuWzBdO1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdYJykge1xyXG4gICAgICAgICAgICBjb250YWluZXJTaXplID0gdGJvZHlDb250YWluZXIuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgICAgIC8vIOS/ruWkjVNTUumUmeivr++8mkVSUk9SIFR5cGVFcnJvcjogdGJvZHlUYWJsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgaXMgbm90IGEgZnVuY3Rpb25cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0Ym9keVRhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRib2R5U2l6ZSA9IHRoaXMubnVtUm91bmQodGJvZHlUYWJsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCwgMCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29udGFpbmVyU2l6ZSA9IHRib2R5Q29udGFpbmVyLmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgLy8g5L+u5aSNU1NS6ZSZ6K+v77yaRVJST1IgVHlwZUVycm9yOiB0Ym9keVRhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCBpcyBub3QgYSBmdW5jdGlvblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRib2R5VGFibGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGJvZHlTaXplID0gdGhpcy5udW1Sb3VuZCh0Ym9keVRhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCwgMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDoi6Vpc051beS4unRydWXvvIzov5Tlm57lt67lgLzvvIzlkKbliJnov5Tlm57luIPlsJTlgLxcclxuICAgICAgICByZXR1cm4gaXNOdW0gPyAodGJvZHlTaXplIC0gY29udGFpbmVyU2l6ZSkgOiAodGJvZHlTaXplID4gY29udGFpbmVyU2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHByb2Nlc3NZU2Nyb2xsU3RhdGVDaGFuZ2UoY29sc1Jlc2l6YWJsZURpcmU6IFRpQ29sc1Jlc2l6YWJsZURpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IFJlc2l6YWJsZU9wdHMgPSBjb2xzUmVzaXphYmxlRGlyZS5yZXNpemFibGVPcHRzO1xyXG4gICAgICAgIC8vIOS4u+imgeWkhOeQhiBjb2x1bW5zIOWIneWni+W8guatpeeahOWcuuaZr1xyXG4gICAgICAgIGlmICghb3B0aW9ucy50aHMgfHwgb3B0aW9ucy50aHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdGJvZHlDb250YWluZXI6IGFueSA9IGNvbHNSZXNpemFibGVEaXJlLnRhYmxlQ29tLnRib2R5Q29udGFpbmVyO1xyXG4gICAgICAgIGNvbnN0IHRoZWFkQ29udGFpbmVyOiBhbnkgPSBjb2xzUmVzaXphYmxlRGlyZS50YWJsZUNvbS50aGVhZENvbnRhaW5lcjtcclxuICAgICAgICBjb25zdCBuZXdZU2Nyb2xsU3RhdGU6IGJvb2xlYW4gPSB0aGlzLm92ZXJmbG93ZWRSZXN1bHQodGJvZHlDb250YWluZXIsICdZJyk7XHJcbiAgICAgICAgaWYgKG5ld1lTY3JvbGxTdGF0ZSA9PT0gb3B0aW9ucy55U2Nyb2xsU3RhdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzT3ZlcmZsb3dZKHRoZWFkQ29udGFpbmVyLCB0Ym9keUNvbnRhaW5lciwgY29sc1Jlc2l6YWJsZURpcmUudGFibGVDb20pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbmV3WFNjcm9sbFN0YXRlOiBib29sZWFuID0gdGhpcy5vdmVyZmxvd2VkUmVzdWx0KHRib2R5Q29udGFpbmVyLCAnWCcpO1xyXG4gICAgICAgIGxldCBsYXN0Q29sSW5kZXg6IG51bWJlciA9IG9wdGlvbnMudGhzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgbGV0IGxhc3RUaDogYW55ID0gb3B0aW9ucy50aHNbbGFzdENvbEluZGV4XTtcclxuICAgICAgICBsZXQgbGFzdFRoV2lkdGg6IG51bWJlciA9IG9wdGlvbnMuc3RvcmVkU2l6ZXNbbGFzdENvbEluZGV4XTtcclxuICAgICAgICBjb25zdCBzY3JvbGxCYXJXaWR0aDogbnVtYmVyID0gdGhpcy5nZXRTY3JvbGxCYXJXaWR0aCgnWScpO1xyXG4gICAgICAgIC8vIOe6teWQkea7muWKqOadoeeUseaXoOWIsOaciVxyXG4gICAgICAgIGlmIChuZXdZU2Nyb2xsU3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKG5ld1hTY3JvbGxTdGF0ZSAmJiBuZXdYU2Nyb2xsU3RhdGUgPT09IG9wdGlvbnMueFNjcm9sbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLnN0b3JlVGFibGVXaWR0aENoYW5nZSArPSBzY3JvbGxCYXJXaWR0aDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIOesrOS4gOasoee6teWQkea7muWKqOadoeeKtuaAgeWPkeeUn+WPmOWMluimgeWHj+Wwj+ihqOagvOWuveW6puaXtu+8jOWOu+WHj+Wwj+mdnueJueauiuWIl+S4reWuveW6puacgOWkp+eahOS4gOWIl+eahOWuveW6plxyXG4gICAgICAgICAgICAgICAgLy8g6L+Z5qC35aSE55CG5piv5Li65LqG6YG/5YWN5pyA5ZCO5LiA5YiX55qE5a695bqm5Y+Y5bCPXHJcbiAgICAgICAgICAgICAgICBpZiAoY29sc1Jlc2l6YWJsZURpcmUuaXNmaXJzdFlTY3JvbGxTdGF0ZUNoYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RUaCA9IHRoaXMuZ2V0TWF4V2lkdGhUaChjb2xzUmVzaXphYmxlRGlyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RUaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29sSW5kZXggPSBwYXJzZUludChsYXN0VGguZ2V0QXR0cmlidXRlKCd0aS12aXNpYmxlLWluZGV4JyksIDEwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFRoV2lkdGggPSBvcHRpb25zLnN0b3JlZFNpemVzW2xhc3RDb2xJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zdG9yZWRTaXplc1tsYXN0Q29sSW5kZXhdID0gbGFzdFRoV2lkdGggLSBzY3JvbGxCYXJXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g57q15ZCR5rua5Yqo5p2h55Sx5pyJ5Yiw5pegXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKG5ld1hTY3JvbGxTdGF0ZSA9PT0gb3B0aW9ucy54U2Nyb2xsU3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdYU2Nyb2xsU3RhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN0b3JlVGFibGVXaWR0aENoYW5nZSAtPSBzY3JvbGxCYXJXaWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdG9yZWRTaXplc1tsYXN0Q29sSW5kZXhdID0gbGFzdFRoV2lkdGggKyBzY3JvbGxCYXJXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmICghbmV3WFNjcm9sbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLnN0b3JlZFNpemVzW2xhc3RDb2xJbmRleF0gPSBsYXN0VGhXaWR0aCArIChzY3JvbGxCYXJXaWR0aCAtXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdG9yZVRhYmxlV2lkdGhDaGFuZ2UpO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zdG9yZVRhYmxlV2lkdGhDaGFuZ2UgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsYXN0VGgpIHtcclxuICAgICAgICAgICAgY29sc1Jlc2l6YWJsZURpcmUuc2V0V2lkdGgobGFzdFRoLCBvcHRpb25zLnN0b3JlZFNpemVzW2xhc3RDb2xJbmRleF0pO1xyXG4gICAgICAgICAgICBjb2xzUmVzaXphYmxlRGlyZS5zZXRXaWR0aChvcHRpb25zLnNlY29uZFRoc1tsYXN0Q29sSW5kZXhdLCBvcHRpb25zLnN0b3JlZFNpemVzW2xhc3RDb2xJbmRleF0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5wcm9jZXNzT3ZlcmZsb3dZKHRoZWFkQ29udGFpbmVyLCB0Ym9keUNvbnRhaW5lciwgY29sc1Jlc2l6YWJsZURpcmUudGFibGVDb20pO1xyXG4gICAgICAgIGNvbHNSZXNpemFibGVEaXJlLmlzZmlyc3RZU2Nyb2xsU3RhdGVDaGFuZ2UgPSBmYWxzZTtcclxuICAgICAgICBvcHRpb25zLnhTY3JvbGxTdGF0ZSA9IHRoaXMub3ZlcmZsb3dlZFJlc3VsdCh0Ym9keUNvbnRhaW5lciwgJ1gnKTtcclxuICAgICAgICBvcHRpb25zLnlTY3JvbGxTdGF0ZSA9IHRoaXMub3ZlcmZsb3dlZFJlc3VsdCh0Ym9keUNvbnRhaW5lciwgJ1knKTtcclxuXHJcbiAgICAgICAgLy8g57q15ZCR5rua5Yqo5p2h54q25oCB5pS55Y+Y5pe25Y+v6IO95Lya5byV6LW35YiX5a695pS55Y+Y5ZKM5qiq5ZCR5rua5Yqo5p2h54q25oCB5pS55Y+Y77yM5omA5Lul6KaB5aSE55CG5YiX5Zu65a6aXHJcbiAgICAgICAgaWYgKGNvbHNSZXNpemFibGVEaXJlLnRhYmxlQ29tLmZpeGVkQ29sdW1uSW5mby5oYXNGaXhlZENvbHVtbikge1xyXG4gICAgICAgICAgICBjb2xzUmVzaXphYmxlRGlyZS50YWJsZUNvbS5wcm9jZXNzRml4ZWRDb2x1bW4oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNYXhXaWR0aFRoKGNvbHNSZXNpemFibGVEaXJlOiBUaUNvbHNSZXNpemFibGVEaXJlY3RpdmUpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IFJlc2l6YWJsZU9wdHMgPSBjb2xzUmVzaXphYmxlRGlyZS5yZXNpemFibGVPcHRzO1xyXG4gICAgICAgIGNvbHNSZXNpemFibGVEaXJlLnVwZGF0ZVN0b3JlZFNpemVzKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRoczogQXJyYXk8YW55PiA9IG9wdGlvbnMudGhzLmZpbHRlcigodGg6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDmjpLpmaTmnIDlkI7kuIDliJflkozkuI3lj6/mi5bliqjnmoTliJdcclxuICAgICAgICAgICAgcmV0dXJuICF0aC5oYXNBdHRyaWJ1dGUoY29sc1Jlc2l6YWJsZURpcmUubm90UmVzaXphYmxlQXR0cikgJiYgIWNvbHNSZXNpemFibGVEaXJlLmlzTGFzdENvbHVtbih0aCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOaMieWIl+WuveS7juWwj+WIsOWkp+aOkuW6j1xyXG4gICAgICAgIGNvbnN0IHNvcnRlZFRoczogQXJyYXk8YW55PiA9IHRocy5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleEE6IG51bWJlciA9IHBhcnNlSW50KGEuZ2V0QXR0cmlidXRlKCd0aS12aXNpYmxlLWluZGV4JyksIDEwKTtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXhCOiBudW1iZXIgPSBwYXJzZUludChiLmdldEF0dHJpYnV0ZSgndGktdmlzaWJsZS1pbmRleCcpLCAxMCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5zdG9yZWRTaXplc1tpbmRleEFdIC0gb3B0aW9ucy5zdG9yZWRTaXplc1tpbmRleEJdO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDov5Tlm57lrr3luqbmnIDlpKfnmoTliJdcclxuICAgICAgICByZXR1cm4gc29ydGVkVGhzW3NvcnRlZFRocy5sZW5ndGggLSAxXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlpITnkIblnKjliJfmi5bliqjov4fnqIvkuK3mqKrlkJHmu5rliqjmnaHnmoTlh7rnjrDlvJXotbfnurXlkJHmu5rliqjmnaHlh7rnjrDml7bnmoTotKbmnKwoc3RvcmVDb2xzV2lkdGhDaGFuZ2Up55qE5Y+Y5YyWXHJcbiAgICBwdWJsaWMgaGFuZGxlWU92ZXJmbG93ZWRXaXRoWChyZXNpemFibGVPcHRzOiBSZXNpemFibGVPcHRzLCB0Ym9keUNvbnRhaW5lcjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgbmV3WVNjcm9sbFN0YXRlOiBib29sZWFuID0gdGhpcy5vdmVyZmxvd2VkUmVzdWx0KHRib2R5Q29udGFpbmVyLCAnWScpO1xyXG5cclxuICAgICAgICBpZiAobmV3WVNjcm9sbFN0YXRlID09PSByZXNpemFibGVPcHRzLnlTY3JvbGxTdGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzY3JvbGxCYXJXaWR0aDogbnVtYmVyID0gdGhpcy5nZXRTY3JvbGxCYXJXaWR0aCgnWScpO1xyXG4gICAgICAgIGNvbnN0IG5ld1hTY3JvbGxTdGF0ZTogYm9vbGVhbiA9IHRoaXMub3ZlcmZsb3dlZFJlc3VsdCh0Ym9keUNvbnRhaW5lciwgJ1gnKTtcclxuICAgICAgICBpZiAobmV3WVNjcm9sbFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHJlc2l6YWJsZU9wdHMuc3RvcmVUYWJsZVdpZHRoQ2hhbmdlICs9IHNjcm9sbEJhcldpZHRoO1xyXG4gICAgICAgICAgICByZXNpemFibGVPcHRzLmlzWU92ZXJmbG93ZWRXaXRoWCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXNpemFibGVPcHRzLnhTY3JvbGxTdGF0ZSA9IG5ld1hTY3JvbGxTdGF0ZTtcclxuICAgICAgICByZXNpemFibGVPcHRzLnlTY3JvbGxTdGF0ZSA9IG5ld1lTY3JvbGxTdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGFuZGxlWU5vdE92ZXJmbG93ZWRXaXRoWChyZXNpemFibGVPcHRzOiBSZXNpemFibGVPcHRzLCB0Ym9keUNvbnRhaW5lcjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsQmFyV2lkdGhYOiBudW1iZXIgPSB0aGlzLmdldFNjcm9sbEJhcldpZHRoKCdYJyk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsQmFyV2lkdGhZOiBudW1iZXIgPSB0aGlzLmdldFNjcm9sbEJhcldpZHRoKCdZJyk7XHJcbiAgICAgICAgY29uc3Qgb3ZlcmZsb3dlZEhlaWdodDogbnVtYmVyID0gdGhpcy5vdmVyZmxvd2VkUmVzdWx0KHRib2R5Q29udGFpbmVyLCAnWScsIHRydWUpO1xyXG4gICAgICAgIGNvbnN0IG92ZXJmbG93ZWRXaWR0aDogbnVtYmVyID0gdGhpcy5vdmVyZmxvd2VkUmVzdWx0KHRib2R5Q29udGFpbmVyLCAnWCcsIHRydWUpO1xyXG4gICAgICAgIC8vIOW9k+WIl+aLluWKqOaoquWQkea7muWKqOadoeWHuueOsOWvvOiHtOe6teWQkea7muWKqOadoeWHuueOsOWQju+8jOWGjee8qeWwj+WIl+WuveaXtu+8jOeUseS6juaXoOazleWHhuehruiOt+W+l+aoquWQkea7muWKqOadoea2iOWkseeahOaXtuWIu+WOu+WvueihqOagvFxyXG4gICAgICAgIC8vIOWuveW6puWBmuihpeWBv++8jOaJgOS7peW9k+ihqOagvOWIl+WuveWIsOi+vuWuueWZqOi+ueeVjOmZhOi/keaXtu+8jOeUqOS4tOaXtuWwhm92ZXJmbG93LXjorr7kuLpoaWRkZW7nmoTmlrnlvI/kvb/mqKrlkJHmu5rliqjmnaHmtojlpLHjgIJcclxuICAgICAgICBpZiAocmVzaXphYmxlT3B0cy5pc1lPdmVyZmxvd2VkV2l0aFggJiYgb3ZlcmZsb3dlZEhlaWdodCA+IDAgJiYgb3ZlcmZsb3dlZEhlaWdodCA8PSBzY3JvbGxCYXJXaWR0aFggJiZcclxuICAgICAgICAgICAgb3ZlcmZsb3dlZFdpZHRoID4gMCAmJiBvdmVyZmxvd2VkV2lkdGggPD0gc2Nyb2xsQmFyV2lkdGhZKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGJvZHlDb250YWluZXIsICdvdmVyZmxvdy14JywgJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAvLyDlr7notKbmnKwoc3RvcmVUYWJsZVdpZHRoQ2hhbmdlKea4hembtlxyXG4gICAgICAgICAgICByZXNpemFibGVPcHRzLnN0b3JlVGFibGVXaWR0aENoYW5nZSA9IDA7XHJcbiAgICAgICAgICAgIHJlc2l6YWJsZU9wdHMuaXNZT3ZlcmZsb3dlZFdpdGhYID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGJvZHlDb250YWluZXIsICdvdmVyZmxvdy14JywgJ2F1dG8nKTtcclxuICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOiOt+WPlua7muWKqOadoeWuveW6plxyXG4gICAgcHVibGljIGdldFNjcm9sbEJhcldpZHRoKGRpcmVjdGlvbjogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCB0ZW1wb3JhcnlEaXY6IGFueSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRoaXMudGlSZW5kZXJlci5zZXRTdHlsZXModGVtcG9yYXJ5RGl2LCB7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG4gICAgICAgICAgICB0b3A6ICctOTk5OXB4JyxcclxuICAgICAgICAgICAgbGVmdDogJy05OTk5cHgnLFxyXG4gICAgICAgICAgICB3aWR0aDogJzEwMHB4JyxcclxuICAgICAgICAgICAgaGVpZ2h0OiAnMTAwcHgnLFxyXG4gICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbidcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBuZXN0RGl2OiBhbnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0aGlzLnRpUmVuZGVyZXIuc2V0U3R5bGVzKG5lc3REaXYsIHsgd2lkdGg6ICcxMDAlJywgaGVpZ2h0OiAnMTAwJScgfSk7XHJcbiAgICAgICAgdGVtcG9yYXJ5RGl2LmFwcGVuZENoaWxkKG5lc3REaXYpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVtcG9yYXJ5RGl2KTtcclxuICAgICAgICBjb25zdCBub1Njcm9sbFdpZHRoOiBudW1iZXIgPSBuZXN0RGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xyXG4gICAgICAgIGNvbnN0IG5vU2Nyb2xsSGVpZ2h0OiBudW1iZXIgPSBuZXN0RGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRlbXBvcmFyeURpdiwgJ292ZXJmbG93JywgJ3Njcm9sbCcpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbFdpZHRoOiBudW1iZXIgPSBuZXN0RGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbEhlaWdodDogbnVtYmVyID0gbmVzdERpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZChkb2N1bWVudC5ib2R5LCB0ZW1wb3JhcnlEaXYpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbEJhcldpZHRoWDogbnVtYmVyID0gdGhpcy5udW1Sb3VuZChub1Njcm9sbEhlaWdodCAtIHNjcm9sbEhlaWdodCwgMSk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsQmFyV2lkdGhZOiBudW1iZXIgPSB0aGlzLm51bVJvdW5kKG5vU2Nyb2xsV2lkdGggLSBzY3JvbGxXaWR0aCwgMSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkaXJlY3Rpb24gPT09ICdYJyA/IHNjcm9sbEJhcldpZHRoWCA6IHNjcm9sbEJhcldpZHRoWTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlr7nmta7ngrnmlbDlm5voiI3kupTlhaXkv53nlZnmjIflrprlsI/mlbDkvY3mlbDnmoTmlbDlrZdcclxuICAgIHB1YmxpYyBudW1Sb3VuZChudW06IG51bWJlciwgZGVjaW1hbDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChudW0udG9GaXhlZChkZWNpbWFsKSk7XHJcbiAgICB9XHJcbn1cclxuIl19