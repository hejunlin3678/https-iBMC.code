import { Component, ContentChild, EventEmitter, HostListener, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { TiFormComponent, TiWholeComponent } from '../base/TiBaseModule';
import { TiDominatorComponent } from '../dominator/TiDominatorModule';
import { TiDropComponent } from '../drop/TiDropModule';
import { TiDropsearchComponent } from '../dropsearch/TiDropsearchModule';
import { TiKeymap } from '../../utils/Util';
/**
 * Select选择下拉组件
 *
 * 支持单选/多选，分组，搜索，懒加载。
 *
 * 单选主要功能为从一个数据集合中选择某一条数据，单选与RadioGroup功能相同，只是视觉呈现不同。
 *
 * 多选主要功能是从一个数据集合中任意选择多条数据，与checkboxGroup功能相同，只是视觉呈现不同。
 *
 * <example-url>../tiny3demo/#/select/select-all</example-url>
 */
export class TiSelectComponent extends TiWholeComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * dominator 到drop的距离
         */
        this.dominatorSpace = TiDropComponent.DOMINATOR_SPACE + 'px';
        /**
         * 是否多选
         */
        this.multiple = false;
        /**
         * 多选时, 选中项显示几行
         *
         * 版本 v9.0.4 添加
         */
        this.maxLine = 2;
        /**
         * 选中项文本超出时tip展开方向
         *
         * 9.0.3 新增
         */
        this.selectedTipPosition = 'auto';
        /**
         * 预留文本
         */
        this.placeholder = '';
        // 面板配置
        /**
         * 下拉面板的最大显示宽度，该变量与下拉类组件保持一致
         *
         * 1."justified"(默认): 下拉框的宽度与Select组件的宽度保持一致；
         *
         * 2."auto": 下拉框的宽度根据下拉选项的内容自动撑开；
         *
         * 3.表示宽度的字符串: 设置固定的下拉框宽度(不小于Select组件的宽度)。例如："200px"
         */
        this.panelWidth = 'justified'; // TODO: 确认类型
        /**
         * 无数据时的显示文本
         */
        this.noDataText = '...';
        /**
         * 要显示的字段
         */
        this.labelKey = 'label';
        // 其他配置
        /**
         * 是否显示搜索框
         */
        this.searchable = false;
        /**
         * @ignore
         * 大小样式
         */
        this.size = 'default';
        /**
         * 文字超长显示...，hover时tip弹出方向
         */
        this.tipPosition = 'right';
        /**
         * 单选下拉选择框是否开启清除已选项功能
         *
         * 3.0.8新增
         */
        this.clearable = false;
        /**
         * 多选下拉选择框是否开启全选功能
         *
         * 3.1.2新增
         */
        this.selectAll = false;
        /**
         * 设置是否显示已选项的个数，默认不显示，multiple为true时生效
         *
         * 10.1.0新增
         */
        this.showSelectedNumber = false;
        /**
         * 用户想要打开面板的通知事件，一般用于数据懒加载。使用方式，见懒加载示例
         */
        this.beforeOpen = new EventEmitter();
        // 3.0.2增加select接口
        /**
         * 多选选中/取消选中事件，向外通知option数据，需要自行判断option数据是否选中。
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.select = new EventEmitter();
        /**
         * 当单选下拉选择框开启清除已选项功能时，点击清除按钮时触发
         *
         * 3.0.8新增
         */
        this.clear = new EventEmitter();
        /**
         * @ignore
         * 10.0.2新增
         *
         * 后台搜索，传出搜索框的值
         */
        this.beforeSearch = new EventEmitter();
        this.oldSearchable = null;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        if (this.beforeSearch.observers.length !== 0) {
            this.dropsearchCom.hasBeforeSearchObservers = true;
        }
    }
    /**
     * 兼容旧版：
     * 3.1.2版select只能内嵌一个模板，无命名。
     * 新版可以内嵌四个模板，示例书写要求都命名。
     * 但需要兼容旧版无命名测试用例。
     */
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果item模板为空，那么把第一个出现的无标签（无footer等标签）模板作为item
        if (!this.itemTemplate && this.firstTemplate) {
            const firstTemplateEle = this.firstTemplate.elementRef.nativeElement;
            if (firstTemplateEle !== (this.selectedTemplate && this.selectedTemplate.elementRef.nativeElement)
                && firstTemplateEle !== (this.placeholderTemplate && this.placeholderTemplate.elementRef.nativeElement)
                && firstTemplateEle !== (this.footerTemplate && this.footerTemplate.elementRef.nativeElement)) {
                this.itemTemplate = this.firstTemplate;
            }
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewChecked() {
        // 要支持searchable的动态变更，所以ngAfterViewChecked才能获知搜索框节点。
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.dropsearchCom.getFocusableElems()));
            }
            else {
                this.setFocusableElems(this.dominatorCom.getFocusableElems());
            }
        }
        if (this.pagination && this.pagination.updateFocusableElems) {
            this.setFocusableElems(this.dominatorCom.getFocusableElems()
                .concat(this.dropsearchCom.getFocusableElems()));
            this.pagination.updateFocusableElems = false;
        }
        // 上面设置好focusElems后，调用父类逻辑afterViewChecked才去设置autofocs
        super.ngAfterViewChecked();
    }
    /**
     * 切换面板开合状态
     */
    toggle() {
        if (!this.dropsearchCom.isShow) { // 面板关闭时
            this.wantOpen();
        }
        else { // 面板开时
            this.close();
        }
    }
    /**
     * 打开面板
     */
    open() {
        this.dropsearchCom.show();
    }
    /**
     * 闭合面板
     */
    close() {
        this.dropsearchCom.hide();
    }
    /**
     * @ignore
     * 处理点击Dominator事件
     */
    onClickDominator() {
        if (this.disabled) {
            return;
        }
        this.toggle();
    }
    /**
     * @ignore
     * ti-select键盘事件处理：回车/空格情况下，展开面板
     * @param event 按键事件
     * @returns void
     */
    onKeydown(event) {
        if (this.disabled || this.dropsearchCom.isShow) {
            return;
        }
        const enterKeyCodeArr = [TiKeymap.KEY_SPACE, TiKeymap.KEY_ENTER, TiKeymap.KEY_NUMPAD_ENTER];
        if (enterKeyCodeArr.includes(event.keyCode)) {
            this.wantOpen();
            // 如果响应了按键，那么不再冒泡
            event.stopPropagation();
        }
    }
    /**
     * @ignore
     * 失焦情况下，仅关闭面板，不做聚焦等处理
     */
    onBlur() {
        this.dropsearchCom.hideWithoutFocus();
    }
    /**
     *  点击或者toggle()，触发想要打开面板
     */
    wantOpen() {
        if (this.beforeOpen.observers.length === 0) { // 无beforeOpen懒加载，直接打开
            this.open();
        }
        else { // 有beforeOpen懒加载，发出事件
            this.beforeOpen.emit(this);
        }
    }
    /**
     * @ignore
     * 多选带searchbox场景下，dominator中元素删除时，需要聚焦于searchbox
     */
    onDeleteDominator() {
        if (this.dropsearchCom.isShow) {
            this.dropsearchCom.focus();
        }
    }
    /**
     * @ignore
     * 触发select事件
     */
    onSelect(option) {
        this.select.emit(option);
        if (this.multiple) {
            return;
        }
    }
    /**
     * @ignore
     * 单选点击清除按钮时触发clear事件, 如果下拉中有搜索,则需要聚焦于searchbox。
     */
    onClearDominator() {
        if (this.multiple || !this.clearable) {
            return;
        }
        this.clear.emit();
        if (this.searchable && this.dropsearchCom.isShow) {
            this.dropsearchCom.focus();
        }
    }
    /**
     * @ignore
     */
    onBeforeSearch() {
        this.beforeSearch.emit(this);
    }
    /**
     * @ignore
     * 10.0.2新增
     *
     * 获取可搜索场景下，搜索框的内容
     * @returns 搜索框的内容
     */
    getSearchWord() {
        return this.dropsearchCom.searchWord;
    }
    /**
     * @ignore
     * 10.0.2新增
     *
     * 设置搜索结果
     * @params 业务搜索后的结果，组件不再进行数据处理
     */
    setSearchResult(searchResult) {
        this.dropsearchCom.setSearchResult(searchResult);
    }
}
TiSelectComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-select',
                template: "<ti-dominator\r\n        [dropshow]='dropsearchCom.dropCom.isShow'\r\n        [multiple]=\"multiple\"\r\n        [maxLine]=\"maxLine\"\r\n        [placeholder]='placeholder'\r\n        [selectedTipPosition]='selectedTipPosition'\r\n        [showSelectedNumber]='showSelectedNumber'\r\n        [(ngModel)]=\"modelWhole\"\r\n        [disabled]=\"disabled\"\r\n        [clearable]=\"!multiple && clearable\"\r\n        (click)=\"onClickDominator()\"\r\n        [id]=\"appendId('dominator')\"\r\n        (delete)=\"onDeleteDominator()\"\r\n        (clear)=\"onClearDominator()\">\r\n        <ng-template #selected let-item>\r\n               <ng-container *ngTemplateOutlet=\"selectedTemplate?selectedTemplate:itemTemplate?itemTemplate:defaultItemTemplate; context: {$implicit: item}\"></ng-container>\r\n        </ng-template>\r\n        <ng-template #placeholder *ngIf=\"placeholderTemplate\">\r\n                <ng-container *ngTemplateOutlet=\"placeholderTemplate\"></ng-container>\r\n        </ng-template>\r\n</ti-dominator>\r\n<ti-dropsearch [multiple]=\"multiple\" [searchable]=\"searchable\" [searchKeys]=\"searchKeys\"\r\n        [selectAll]=\"selectAll\" [labelKey]=\"labelKey\" [options]=\"options\"\r\n        [noDataText]=\"noDataText\" [dominatorSpace]=\"dominatorSpace\"\r\n        [(ngModel)]=\"modelWhole\" [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        [panelWidth]=\"panelWidth\" [panelMaxHeight]=\"panelMaxHeight\"\r\n        [size]=\"size\" [tipPosition]=\"tipPosition\" [id]=\"appendId('droplist')\"\r\n        (select)=\"onSelect($event)\"\r\n        (beforeSearch)=\"onBeforeSearch()\" >\r\n        <ng-template #item let-item let-i=index>\r\n               <ng-container *ngTemplateOutlet=\"itemTemplate?itemTemplate:defaultItemTemplate; context: {$implicit: item, index: i}\"></ng-container>\r\n        </ng-template>\r\n        <ng-template #footer>\r\n                <ng-container *ngTemplateOutlet=\"footerTemplate?footerTemplate:defaultFooterTemplate;\"></ng-container>\r\n        </ng-template>\r\n</ti-dropsearch>\r\n\r\n<ng-template #defaultItemTemplate let-item let-i=index><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n\r\n<ng-template #defaultFooterTemplate>\r\n</ng-template>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiSelectComponent)],
                host: {
                    '[class.ti3-select-small]': 'size === "small"',
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}:host{width:200px}:host[noborder],:host[noborder]:hover,:host[noborder][tiFocused]{border-color:var(--ti-input-bg-color)}:host[noborder][disabled]{border-color:var(--ti-input-bg-color-disabled)}:host[dark]{background-color:transparent}:host[dark],:host[dark]:hover,:host[dark][disabled],:host[dark][tiFocused]{border-color:transparent}:host[dark] ::ng-deep .ti3-select-dominator-text{color:var(--ti-common-color-text-white)}:host[dark] ::ng-deep .ti3-select-dominator-dropdown-btn:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--ti-common-color-icon-white);height:0;width:0}", "::ng-deep .ti3-select-small .ti3-select-dominator-text{width:calc(100% - var(--ti-select-small-height) + 2px)!important}::ng-deep .ti3-select-small .ti3-overflow-padding{padding-left:var(--ti-select-small-dominator-text-left-padding)!important;padding-right:0!important}::ng-deep .ti3-select-small .ti3-select-dominator-container{height:var(--ti-select-small-height)!important;line-height:calc(var(--ti-select-small-height) - 2px)!important}::ng-deep .ti3-select-small .ti3-select-dominator-dropdown-btn{width:calc(var(--ti-select-small-height) - 4px)!important}::ng-deep .ti3-select-small .ti3-select-dominator-dropdown-btn:after{right:var(--ti-select-small-triangle-position-right)!important;top:calc((100% - 5px)/2)!important}"]
            },] }
];
TiSelectComponent.propDecorators = {
    dominatorSpace: [{ type: Input }],
    multiple: [{ type: Input }],
    maxLine: [{ type: Input }],
    selectedTipPosition: [{ type: Input }],
    placeholder: [{ type: Input }],
    panelWidth: [{ type: Input }],
    panelMaxHeight: [{ type: Input }],
    noDataText: [{ type: Input }],
    options: [{ type: Input }],
    labelKey: [{ type: Input }],
    searchKeys: [{ type: Input }],
    searchable: [{ type: Input }],
    size: [{ type: Input }],
    tipPosition: [{ type: Input }],
    clearable: [{ type: Input }],
    selectAll: [{ type: Input }],
    showSelectedNumber: [{ type: Input }],
    beforeOpen: [{ type: Output }],
    select: [{ type: Output }],
    clear: [{ type: Output }],
    beforeSearch: [{ type: Output }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    selectedTemplate: [{ type: ContentChild, args: ['selected', /* TODO: add static flag */ { static: true },] }],
    placeholderTemplate: [{ type: ContentChild, args: ['placeholder', /* TODO: add static flag */ { static: true },] }],
    footerTemplate: [{ type: ContentChild, args: ['footer', /* TODO: add static flag */ { static: true },] }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, /* TODO: add static flag */ { static: true },] }],
    dropsearchCom: [{ type: ViewChild, args: [TiDropsearchComponent, { static: true },] }],
    onKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlTZWxlY3RDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy9zZWxlY3QvVGlTZWxlY3RDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0gsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN6RSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFJNUM7Ozs7Ozs7Ozs7R0FVRztBQVdILE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxnQkFBZ0I7SUFWdkQ7O1FBV0k7OztXQUdHO1FBQ00sbUJBQWMsR0FBVyxlQUFlLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUN6RTs7V0FFRztRQUNNLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFDbkM7Ozs7V0FJRztRQUNNLFlBQU8sR0FBVyxDQUFDLENBQUM7UUFDN0I7Ozs7V0FJRztRQUNNLHdCQUFtQixHQUFtQixNQUFNLENBQUM7UUFDdEQ7O1dBRUc7UUFDTSxnQkFBVyxHQUFXLEVBQUUsQ0FBQztRQUNqQyxPQUFPO1FBQ1I7Ozs7Ozs7O1dBUUc7UUFDTSxlQUFVLEdBQWlDLFdBQVcsQ0FBQyxDQUFDLGFBQWE7UUFPOUU7O1dBRUc7UUFDTSxlQUFVLEdBQVcsS0FBSyxDQUFDO1FBTXBDOztXQUVHO1FBQ00s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QUFNLEVBQUUsSUFBSSxFQUFFOzJCQU1uRSxTQUFTLFNBQUMsb0JBQW9CLEVBQUUsMkJBQTJCLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzRCQUs1RSxTQUFTLFNBQUMscUJBQXFCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO3dCQXlGakQsWUFBWSxTQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIE91dHB1dCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUZvcm1Db21wb25lbnQsIFRpV2hvbGVDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IFRpRG9taW5hdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vZG9taW5hdG9yL1RpRG9taW5hdG9yTW9kdWxlJztcclxuaW1wb3J0IHsgVGlEcm9wQ29tcG9uZW50IH0gZnJvbSAnLi4vZHJvcC9UaURyb3BNb2R1bGUnO1xyXG5pbXBvcnQgeyBUaURyb3BzZWFyY2hDb21wb25lbnQgfSBmcm9tICcuLi9kcm9wc2VhcmNoL1RpRHJvcHNlYXJjaE1vZHVsZSc7XHJcbmltcG9ydCB7IFRpS2V5bWFwIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFRpUG9zaXRpb25UeXBlIH0gZnJvbSAnLi4vLi4vdXRpbHMvUG9zaXRpb24nO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBTZWxlY3TpgInmi6nkuIvmi4nnu4Tku7ZcclxuICpcclxuICog5pSv5oyB5Y2V6YCJL+WkmumAie+8jOWIhue7hO+8jOaQnOe0ou+8jOaHkuWKoOi9veOAglxyXG4gKlxyXG4gKiDljZXpgInkuLvopoHlip/og73kuLrku47kuIDkuKrmlbDmja7pm4blkIjkuK3pgInmi6nmn5DkuIDmnaHmlbDmja7vvIzljZXpgInkuI5SYWRpb0dyb3Vw5Yqf6IO955u45ZCM77yM5Y+q5piv6KeG6KeJ5ZGI546w5LiN5ZCM44CCXHJcbiAqXHJcbiAqIOWkmumAieS4u+imgeWKn+iDveaYr+S7juS4gOS4quaVsOaNrumbhuWQiOS4reS7u+aEj+mAieaLqeWkmuadoeaVsOaNru+8jOS4jmNoZWNrYm94R3JvdXDlip/og73nm7jlkIzvvIzlj6rmmK/op4bop4nlkYjnjrDkuI3lkIzjgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL3NlbGVjdC9zZWxlY3QtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0aS1zZWxlY3QnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NlbGVjdC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3NlbGVjdC5sZXNzJywgJy4vc2VsZWN0LXNtYWxsLmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRpU2VsZWN0Q29tcG9uZW50KV0sXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJ1tjbGFzcy50aTMtc2VsZWN0LXNtYWxsXSc6ICdzaXplID09PSBcInNtYWxsXCInLFxyXG4gICAgICAgICcoYmx1ciknOiAnb25CbHVyKCknXHJcbiAgICB9XHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaVNlbGVjdENvbXBvbmVudCBleHRlbmRzIFRpV2hvbGVDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBkb21pbmF0b3Ig5YiwZHJvcOeahOi3neemu1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBkb21pbmF0b3JTcGFjZTogc3RyaW5nID0gVGlEcm9wQ29tcG9uZW50LkRPTUlOQVRPUl9TUEFDRSArICdweCc7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuWkmumAiVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBtdWx0aXBsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlpJrpgInml7YsIOmAieS4remhueaYvuekuuWHoOihjFxyXG4gICAgICpcclxuICAgICAqIOeJiOacrCB2OS4wLjQg5re75YqgXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIG1heExpbmU6IG51bWJlciA9IDI7XHJcbiAgICAvKipcclxuICAgICAqIOmAieS4remhueaWh+acrOi2heWHuuaXtnRpcOWxleW8gOaWueWQkVxyXG4gICAgICpcclxuICAgICAqIDkuMC4zIOaWsOWinlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzZWxlY3RlZFRpcFBvc2l0aW9uOiBUaVBvc2l0aW9uVHlwZSA9ICdhdXRvJztcclxuICAgIC8qKlxyXG4gICAgICog6aKE55WZ5paH5pysXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHBsYWNlaG9sZGVyOiBzdHJpbmcgPSAnJztcclxuICAgICAvLyDpnaLmnb/phY3nva5cclxuICAgIC8qKlxyXG4gICAgICog5LiL5ouJ6Z2i5p2/55qE5pyA5aSn5pi+56S65a695bqm77yM6K+l5Y+Y6YeP5LiO5LiL5ouJ57G757uE5Lu25L+d5oyB5LiA6Ie0XHJcbiAgICAgKlxyXG4gICAgICogMS5cImp1c3RpZmllZFwiKOm7mOiupCk6IOS4i+aLieahhueahOWuveW6puS4jlNlbGVjdOe7hOS7tueahOWuveW6puS/neaMgeS4gOiHtO+8m1xyXG4gICAgICpcclxuICAgICAqIDIuXCJhdXRvXCI6IOS4i+aLieahhueahOWuveW6puagueaNruS4i+aLiemAiemhueeahOWGheWuueiHquWKqOaSkeW8gO+8m1xyXG4gICAgICpcclxuICAgICAqIDMu6KGo56S65a695bqm55qE5a2X56ym5LiyOiDorr7nva7lm7rlrprnmoTkuIvmi4nmoYblrr3luqYo5LiN5bCP5LqOU2VsZWN057uE5Lu255qE5a695bqmKeOAguS+i+Wmgu+8mlwiMjAwcHhcIlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBwYW5lbFdpZHRoOiAnanVzdGlmaWVkJyB8ICdhdXRvJ3wgc3RyaW5nID0gJ2p1c3RpZmllZCc7IC8vIFRPRE86IOehruiupOexu+Wei1xyXG4gICAgLyoqXHJcbiAgICAgKiDkuIvmi4npnaLmnb/nmoTmnIDlpKfmmL7npLrpq5jluqbvvIzmuqLlh7rml7bliJnlh7rmu5rliqjmnaHjgIJcclxuICAgICAqXHJcbiAgICAgKiAg57y655yB5YC8IDog5pyA5aSn5pi+56S6OOadoeaVsOaNru+8iOacieaXoHNlYXJjaGJveOmDveaYvuekujjmnaHvvIlcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgcGFuZWxNYXhIZWlnaHQ6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5peg5pWw5o2u5pe255qE5pi+56S65paH5pysXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIG5vRGF0YVRleHQ6IHN0cmluZyA9ICcuLi4nO1xyXG4gICAgLy8g5YiX6KGo5pWw5o2u6YWN572uXHJcbiAgICAvKipcclxuICAgICAqIOS4i+aLiemAiemhueeahOWFqOmDqOaVsOaNrlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBvcHRpb25zOiBBcnJheTxhbnk+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDopoHmmL7npLrnmoTlrZfmrrVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbGFiZWxLZXk6IHN0cmluZyA9ICdsYWJlbCc7XHJcbiAgICAvKipcclxuICAgICAqIOimgeaQnOe0oueahOWtl+auteaVsOe7hCwg6buY6K6k5pivW2xhYmVsS2V5XVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzZWFyY2hLZXlzOiBBcnJheTxzdHJpbmc+O1xyXG4gICAgLy8g5YW25LuW6YWN572uXHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYvuekuuaQnOe0ouahhlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzZWFyY2hhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWkp+Wwj+agt+W8j1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzaXplOiAnZGVmYXVsdCcgfCAnc21hbGwnID0gJ2RlZmF1bHQnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmloflrZfotoXplb/mmL7npLouLi7vvIxob3ZlcuaXtnRpcOW8ueWHuuaWueWQkVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0aXBQb3NpdGlvbjogVGlQb3NpdGlvblR5cGUgPSAncmlnaHQnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDljZXpgInkuIvmi4npgInmi6nmoYbmmK/lkKblvIDlkK/muIXpmaTlt7LpgInpobnlip/og71cclxuICAgICAqXHJcbiAgICAgKiAzLjAuOOaWsOWinlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBjbGVhcmFibGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKlxyXG4gICAgICog5aSa6YCJ5LiL5ouJ6YCJ5oup5qGG5piv5ZCm5byA5ZCv5YWo6YCJ5Yqf6IO9XHJcbiAgICAgKlxyXG4gICAgICogMy4xLjLmlrDlop5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgc2VsZWN0QWxsOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruaYr+WQpuaYvuekuuW3sumAiemhueeahOS4quaVsO+8jOm7mOiupOS4jeaYvuekuu+8jG11bHRpcGxl5Li6dHJ1ZeaXtueUn+aViFxyXG4gICAgICpcclxuICAgICAqIDEwLjEuMOaWsOWinlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzaG93U2VsZWN0ZWROdW1iZXI6IGJvb2xlYW4gPSBmYWxzZSA7XHJcbiAgICAvKipcclxuICAgICAqIOeUqOaIt+aDs+imgeaJk+W8gOmdouadv+eahOmAmuefpeS6i+S7tu+8jOS4gOiIrOeUqOS6juaVsOaNruaHkuWKoOi9veOAguS9v+eUqOaWueW8j++8jOingeaHkuWKoOi9veekuuS+i1xyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgYmVmb3JlT3BlbjogRXZlbnRFbWl0dGVyPFRpU2VsZWN0Q29tcG9uZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGlTZWxlY3RDb21wb25lbnQ+KCk7XHJcbiAgICAvLyAzLjAuMuWinuWKoHNlbGVjdOaOpeWPo1xyXG4gICAgLyoqXHJcbiAgICAgKiDlpJrpgInpgInkuK0v5Y+W5raI6YCJ5Lit5LqL5Lu277yM5ZCR5aSW6YCa55+lb3B0aW9u5pWw5o2u77yM6ZyA6KaB6Ieq6KGM5Yik5patb3B0aW9u5pWw5o2u5piv5ZCm6YCJ5Lit44CCXHJcbiAgICAgKi9cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtbmFtZWQtYWZ0ZXItc3RhbmRhcmQtZXZlbnRcclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBzZWxlY3Q6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WNlemAieS4i+aLiemAieaLqeahhuW8gOWQr+a4hemZpOW3sumAiemhueWKn+iDveaXtu+8jOeCueWHu+a4hemZpOaMiemSruaXtuinpuWPkVxyXG4gICAgICpcclxuICAgICAqIDMuMC445paw5aKeXHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBjbGVhcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogMTAuMC4y5paw5aKeXHJcbiAgICAgKlxyXG4gICAgICog5ZCO5Y+w5pCc57Si77yM5Lyg5Ye65pCc57Si5qGG55qE5YC8XHJcbiAgICAgKi9cclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBiZWZvcmVTZWFyY2g6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOeUqOaIt+WGmeeahGl0ZW3mqKHmnb/vvIxmaXJzdFRlbXBsYXRl5piv56ys5LiA5Liq5oiW6ICF5ZSv5LiA55qEdGVtcGxhdGVcclxuICAgICAqL1xyXG4gICAgQENvbnRlbnRDaGlsZChUZW1wbGF0ZVJlZiwgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIGZpcnN0VGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAQ29udGVudENoaWxkKCdpdGVtJywgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIGl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBDb250ZW50Q2hpbGQoJ3NlbGVjdGVkJywgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIHNlbGVjdGVkVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAQ29udGVudENoaWxkKCdwbGFjZWhvbGRlcicsIC8qIFRPRE86IGFkZCBzdGF0aWMgZmxhZyAqLyB7IHN0YXRpYzogdHJ1ZSB9KSBwbGFjZWhvbGRlclRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQENvbnRlbnRDaGlsZCgnZm9vdGVyJywgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIGZvb3RlclRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5YaF6YOo5qCH562+ZG9uaW1hdG9y57uE5Lu2XHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoVGlEb21pbmF0b3JDb21wb25lbnQsIC8qIFRPRE86IGFkZCBzdGF0aWMgZmxhZyAqLyB7IHN0YXRpYzogdHJ1ZSB9KSBkb21pbmF0b3JDb206IFRpRG9taW5hdG9yQ29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlhoXpg6jmoIfnrb5Ecm9wbGlzdOe7hOS7tlxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKFRpRHJvcHNlYXJjaENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgZHJvcHNlYXJjaENvbTogVGlEcm9wc2VhcmNoQ29tcG9uZW50O1xyXG4gICAgcHJvdGVjdGVkIG9sZFNlYXJjaGFibGU6IGJvb2xlYW4gPSBudWxsO1xyXG4gICAgcHVibGljIHBhZ2luYXRpb246IGFueTsgLy8g5rKh5pyJ5oyH5a6a57G75Z6L5piv5Zug5Li65aaC5p6c5byV5YWlVGlQYWdpbmF0aW9uQ29tcG9uZW505Lya5Zug5Li65b6q546v5byV55So5a+86Ie05oql6ZSZXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHVzZS1saWZlLWN5Y2xlLWludGVyZmFjZVxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5iZWZvcmVTZWFyY2gub2JzZXJ2ZXJzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmRyb3BzZWFyY2hDb20uaGFzQmVmb3JlU2VhcmNoT2JzZXJ2ZXJzID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWFvOWuueaXp+eJiO+8mlxyXG4gICAgICogMy4xLjLniYhzZWxlY3Tlj6rog73lhoXltYzkuIDkuKrmqKHmnb/vvIzml6Dlkb3lkI3jgIJcclxuICAgICAqIOaWsOeJiOWPr+S7peWGheW1jOWbm+S4quaooeadv++8jOekuuS+i+S5puWGmeimgeaxgumDveWRveWQjeOAglxyXG4gICAgICog5L2G6ZyA6KaB5YW85a655pen54mI5peg5ZG95ZCN5rWL6K+V55So5L6L44CCXHJcbiAgICAgKi9cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdXNlLWxpZmUtY3ljbGUtaW50ZXJmYWNlXHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlckNvbnRlbnRJbml0KCk7XHJcbiAgICAgICAgLy8g5aaC5p6caXRlbeaooeadv+S4uuepuu+8jOmCo+S5iOaKiuesrOS4gOS4quWHuueOsOeahOaXoOagh+etvu+8iOaXoGZvb3Rlcuetieagh+etvu+8ieaooeadv+S9nOS4uml0ZW1cclxuICAgICAgICBpZiAoIXRoaXMuaXRlbVRlbXBsYXRlICYmIHRoaXMuZmlyc3RUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdFRlbXBsYXRlRWxlOiBFbGVtZW50ID0gdGhpcy5maXJzdFRlbXBsYXRlLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKGZpcnN0VGVtcGxhdGVFbGUgIT09ICh0aGlzLnNlbGVjdGVkVGVtcGxhdGUgJiYgdGhpcy5zZWxlY3RlZFRlbXBsYXRlLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudClcclxuICAgICAgICAgICAgICAgICYmIGZpcnN0VGVtcGxhdGVFbGUgIT09ICh0aGlzLnBsYWNlaG9sZGVyVGVtcGxhdGUgJiYgdGhpcy5wbGFjZWhvbGRlclRlbXBsYXRlLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudClcclxuICAgICAgICAgICAgICAgICYmIGZpcnN0VGVtcGxhdGVFbGUgIT09ICh0aGlzLmZvb3RlclRlbXBsYXRlICYmIHRoaXMuZm9vdGVyVGVtcGxhdGUuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbVRlbXBsYXRlID0gdGhpcy5maXJzdFRlbXBsYXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyDopoHmlK/mjIFzZWFyY2hhYmxl55qE5Yqo5oCB5Y+Y5pu077yM5omA5LulbmdBZnRlclZpZXdDaGVja2Vk5omN6IO96I6355+l5pCc57Si5qGG6IqC54K544CCXHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSAhPT0gdGhpcy5vbGRTZWFyY2hhYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub2xkU2VhcmNoYWJsZSA9IHRoaXMuc2VhcmNoYWJsZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyh0aGlzLmRvbWluYXRvckNvbS5nZXRGb2N1c2FibGVFbGVtcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNvbmNhdCh0aGlzLmRyb3BzZWFyY2hDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKSkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyh0aGlzLmRvbWluYXRvckNvbS5nZXRGb2N1c2FibGVFbGVtcygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wYWdpbmF0aW9uICYmIHRoaXMucGFnaW5hdGlvbi51cGRhdGVGb2N1c2FibGVFbGVtcykge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKHRoaXMuZG9taW5hdG9yQ29tLmdldEZvY3VzYWJsZUVsZW1zKClcclxuICAgICAgICAgICAgICAgICAgICAuY29uY2F0KHRoaXMuZHJvcHNlYXJjaENvbS5nZXRGb2N1c2FibGVFbGVtcygpKSk7XHJcbiAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbi51cGRhdGVGb2N1c2FibGVFbGVtcyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkuIrpnaLorr7nva7lpb1mb2N1c0VsZW1z5ZCO77yM6LCD55So54i257G76YC76L6RYWZ0ZXJWaWV3Q2hlY2tlZOaJjeWOu+iuvue9rmF1dG9mb2NzXHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdDaGVja2VkKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YiH5o2i6Z2i5p2/5byA5ZCI54q25oCBXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0b2dnbGUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRyb3BzZWFyY2hDb20uaXNTaG93KSB7IC8vIOmdouadv+WFs+mXreaXtlxyXG4gICAgICAgICAgICB0aGlzLndhbnRPcGVuKCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8g6Z2i5p2/5byA5pe2XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOmdouadv1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRyb3BzZWFyY2hDb20uc2hvdygpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDpl63lkIjpnaLmnb9cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHJvcHNlYXJjaENvbS5oaWRlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWkhOeQhueCueWHu0RvbWluYXRvcuS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja0RvbWluYXRvcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudG9nZ2xlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIHRpLXNlbGVjdOmUruebmOS6i+S7tuWkhOeQhu+8muWbnui9pi/nqbrmoLzmg4XlhrXkuIvvvIzlsZXlvIDpnaLmnb9cclxuICAgICAqIEBwYXJhbSBldmVudCDmjInplK7kuovku7ZcclxuICAgICAqIEByZXR1cm5zIHZvaWRcclxuICAgICAqL1xyXG4gICAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pIHB1YmxpYyBvbktleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCB8fCB0aGlzLmRyb3BzZWFyY2hDb20uaXNTaG93KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZW50ZXJLZXlDb2RlQXJyOiBBcnJheTxudW1iZXI+ID0gW1RpS2V5bWFwLktFWV9TUEFDRSwgVGlLZXltYXAuS0VZX0VOVEVSLCBUaUtleW1hcC5LRVlfTlVNUEFEX0VOVEVSXTtcclxuICAgICAgICBpZiAoZW50ZXJLZXlDb2RlQXJyLmluY2x1ZGVzKGV2ZW50LmtleUNvZGUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMud2FudE9wZW4oKTtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5ZON5bqU5LqG5oyJ6ZSu77yM6YKj5LmI5LiN5YaN5YaS5rOhXHJcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5aSx54Sm5oOF5Ya15LiL77yM5LuF5YWz6Zet6Z2i5p2/77yM5LiN5YGa6IGa54Sm562J5aSE55CGXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkJsdXIoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kcm9wc2VhcmNoQ29tLmhpZGVXaXRob3V0Rm9jdXMoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogIOeCueWHu+aIluiAhXRvZ2dsZSgp77yM6Kem5Y+R5oOz6KaB5omT5byA6Z2i5p2/XHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCB3YW50T3BlbigpOiB2b2lkIHtcclxuICAgICAgaWYgKHRoaXMuYmVmb3JlT3Blbi5vYnNlcnZlcnMubGVuZ3RoID09PSAwKSB7IC8vIOaXoGJlZm9yZU9wZW7mh5LliqDovb3vvIznm7TmjqXmiZPlvIBcclxuICAgICAgICAgICAgdGhpcy5vcGVuKCk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIOaciWJlZm9yZU9wZW7mh5LliqDovb3vvIzlj5Hlh7rkuovku7ZcclxuICAgICAgICAgICAgdGhpcy5iZWZvcmVPcGVuLmVtaXQodGhpcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5aSa6YCJ5bimc2VhcmNoYm945Zy65pmv5LiL77yMZG9taW5hdG9y5Lit5YWD57Sg5Yig6Zmk5pe277yM6ZyA6KaB6IGa54Sm5LqOc2VhcmNoYm94XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkRlbGV0ZURvbWluYXRvcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kcm9wc2VhcmNoQ29tLmlzU2hvdykge1xyXG4gICAgICAgICAgICB0aGlzLmRyb3BzZWFyY2hDb20uZm9jdXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOinpuWPkXNlbGVjdOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25TZWxlY3Qob3B0aW9uOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNlbGVjdC5lbWl0KG9wdGlvbik7XHJcbiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Y2V6YCJ54K55Ye75riF6Zmk5oyJ6ZKu5pe26Kem5Y+RY2xlYXLkuovku7YsIOWmguaenOS4i+aLieS4reacieaQnOe0oizliJnpnIDopoHogZrnhKbkuo5zZWFyY2hib3jjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xlYXJEb21pbmF0b3IoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUgfHwgIXRoaXMuY2xlYXJhYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jbGVhci5lbWl0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSAmJiB0aGlzLmRyb3BzZWFyY2hDb20uaXNTaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcHNlYXJjaENvbS5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25CZWZvcmVTZWFyY2goKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5iZWZvcmVTZWFyY2guZW1pdCh0aGlzKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogMTAuMC4y5paw5aKeXHJcbiAgICAgKlxyXG4gICAgICog6I635Y+W5Y+v5pCc57Si5Zy65pmv5LiL77yM5pCc57Si5qGG55qE5YaF5a65XHJcbiAgICAgKiBAcmV0dXJucyDmkJzntKLmoYbnmoTlhoXlrrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNlYXJjaFdvcmQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kcm9wc2VhcmNoQ29tLnNlYXJjaFdvcmQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIDEwLjAuMuaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOiuvue9ruaQnOe0oue7k+aenFxyXG4gICAgICogQHBhcmFtcyDkuJrliqHmkJzntKLlkI7nmoTnu5PmnpzvvIznu4Tku7bkuI3lho3ov5vooYzmlbDmja7lpITnkIZcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldFNlYXJjaFJlc3VsdChzZWFyY2hSZXN1bHQ6IEFycmF5PGFueT4pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRyb3BzZWFyY2hDb20uc2V0U2VhcmNoUmVzdWx0KHNlYXJjaFJlc3VsdCk7XHJcbiAgICB9XHJcbn1cclxuIl19