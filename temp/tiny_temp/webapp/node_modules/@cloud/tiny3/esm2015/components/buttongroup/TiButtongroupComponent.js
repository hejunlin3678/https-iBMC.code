import { ChangeDetectorRef, Component, ContentChild, ElementRef, Input, IterableDiffers, QueryList, Renderer2, TemplateRef, ViewChildren } from '@angular/core';
import { Util } from '../../utils/Util';
import { TiFormComponent, TiWholeComponent } from '../base/TiBaseModule';
/**
 * buttonGroup选择按钮组组件
 *
 * 该组件支持单选、多选两种形式，显示内容支持用户自定义
 *
 * 单选块：用户要从一个数据集中选择单个选项。
 * 分大尺寸，小尺寸，无边框三种类型。
 * 支持可取消选中，默认选中时再次点击不取消当前选中项；
 *
 * 多选块：允许用户从一个数据集中选择多个选项。
 * 分大尺寸，小尺寸两种类型。
 *
 * <example-url>../tiny3demo/#/buttongroup/buttongroup-all</example-url>
 */
export class TiButtongroupComponent extends TiWholeComponent {
    constructor(elementRef, renderer2, changeDetectorRef, iterableDiffers) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.renderer2 = renderer2;
        this.changeDetectorRef = changeDetectorRef;
        this.iterableDiffers = iterableDiffers;
        /**
         * 用来控制按钮的尺寸大小:默认是large
         *
         * 单选按钮有大小尺寸、无边框之分：取值 'large','small','noBorder'
         *
         * 多选按钮有空间充足，空间不足之分：取值 'large','small',
         */
        this.type = 'large';
        /**
         * 设置是否为多选按钮组
         */
        this.multiple = false;
        // TODO:Tiny4 deselectable改为unselectable
        /**
         * 设置单选按钮组是否可以取消选中
         */
        this.deselectable = false;
        /**
         * 10.0.2新增
         *
         * 按钮是否为多行，设置为多行时，按钮块有下边距，否则没有。
         */
        /**
         * 用于取代公共样式类ti3-button-group-bottom-space
         * <ti-button-group class="ti3-button-group-bottom-space"></ti-button-group>
         */
        this.multiline = false;
    }
    ngOnInit() {
        super.ngOnInit();
        // 处理激活样式
        this.actClass = this.activeClass || 'ti3-active';
        this.itemsDiffer = this.iterableDiffers.find(this.items || [])
            .create();
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        const itemsDiffer = this.itemsDiffer.diff(this.items || []);
        if (itemsDiffer) {
            const focusElements = [];
            this.btns.forEach((item) => {
                focusElements.push(item.nativeElement);
            });
            this.setFocusableElems(focusElements);
        }
    }
    /**
     * 兼容旧版：
     * 10.1.2 版本之前只能内嵌一个模板，无命名。
     * 新版可以内嵌两个模板，示例书写要求都命名（#item，#sup）。
     * 但需要兼容旧版无命名测试用例。
     */
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果 item 模板为空 && 存在第一个模板，那么把第一个出现的 “非 #sup 标签” 的模板作为 item 模板
        if (!this.itemTemplate && this.firstTemplate
            && (this.firstTemplate.elementRef.nativeElement !== (this.supTemplate && this.supTemplate.elementRef.nativeElement))) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    /**
     * @ignore
     * sup属性存在class类或text存在且有效
     */
    isSuperScript(item) {
        return item.sup && (item.sup.constructor === Object) &&
            ((Util.isString(item.sup.class) && item.sup.class !== '') ||
                (Util.isString(item.sup.text) && item.sup.text !== ''));
    }
    /**
     * @ignore
     * @description 根据selectedId来设置每个按钮的样式
     * @param: item
     */
    setActiveClass(item) {
        if (this.hasSelected(item)) {
            return this.actClass;
        }
        return '';
    }
    /**
     * @ignore
     * 每个item上的点击事件
     */
    onClick(item) {
        if (item.disabled || this.disabled) { // 灰化状态下 ，点击操作无效
            return;
        }
        this.selectItem(item);
    }
    /**
     * @ignore
     * 每个item上的点击事件
     */
    selectItem(item) {
        if (this.multiple) {
            if (Util.isUndefined(this.modelWhole)) {
                this.modelWhole = [item];
            }
            else {
                const index = this.modelWhole.indexOf(item);
                if (index !== -1) { // 如果存在，则将其移除
                    this.modelWhole.splice(index, 1);
                }
                else { // 先前未选中情况下，勾选
                    this.modelWhole.push(item);
                }
                // selectedId是引用类型，内容改变不会触发modelchange，故需改变引用地址
                this.modelWhole = this.modelWhole.concat();
            }
        }
        else {
            this.modelWhole = (Object.is(item, this.modelWhole) && this.deselectable) ? '' : item;
        }
    }
    /**
     * @ignore
     * 判断是不是选中项
     */
    hasSelected(item) {
        if (Util.isUndefined(this.modelWhole) || Util.isNull(this.modelWhole)) {
            return;
        }
        if (this.multiple) {
            return this.modelWhole.indexOf(item) !== -1;
        }
        else {
            return Object.is(item, this.modelWhole);
        }
    }
}
TiButtongroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-button-group',
                template: "<!--TODO:div\u548Cspan\u662F\u5426\u53EF\u4EE5\u5408\u4E00\uFF1F\u5F31\u5316button\uFF0C\u6FC0\u6D3B\u72B6\u6001\u4E5F\u653E\u5728\u6700\u5916\u5C42-->\r\n<span style=\"margin-top:-50px\">\r\n<div *ngFor=\"let item of items; index as i;\"\r\n    [id]=\"appendId(i)\" class=\"ti3-btn-item-container\"\r\n    [class.ti3-btn-checkbox-enough-space]=\"type === 'large' && multiple\"\r\n    [class.ti3-btn-checkbox-deficient-space]=\"type === 'small' && multiple\"\r\n    [class.ti3-btn-item-small]=\"type === 'small' && !multiple\"\r\n    [tiTip]=\"item.tipContent\"\r\n    [tiTipContext]=\"item\"\r\n    [tiTipPosition]='item.tipPosition'\r\n    (click)=\"onClick(item)\"\r\n    [ngClass]=\"setActiveClass(item)\">\r\n        <button #btn type=\"button\" tiOutline\r\n                [ngStyle]=\"{'min-width': minWidth}\"\r\n                class=\"ti3-btn-item\"\r\n                [ngClass]=\"{'ti3-btn-item-radio': !multiple,\r\n                            'ti3-btn-item-noBorder': !multiple && type === 'noBorder',\r\n                            'ti3-btn-item-checkbox': multiple}\"\r\n                [disabled]=\"item.disabled || disabled\"\r\n\r\n                ><ng-container *ngIf=\"!itemTemplate else customcontent\">\r\n                    <span class=\"ti3-btn-item-text\" [title]=\"item.text\">{{item.text}}</span>\r\n                </ng-container>\r\n                <ng-template #customcontent>\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate;\r\n                                    context: {$implicit: item, index: i}\"></ng-container>\r\n                </ng-template>\r\n        </button>\r\n        <section *ngIf=\"supTemplate else defaultTemplate\" class=\"ti3-btn-item-sup\">\r\n            <ng-container *ngTemplateOutlet=\"supTemplate; context: {$implicit: item.sup,index: i}\">\r\n            </ng-container>\r\n        </section>\r\n\r\n        <ng-template #defaultTemplate>\r\n            <ng-container *ngIf=\"isSuperScript(item)\">\r\n                <span class=\"ti3-btn-item-sup\" [ngClass]=\"[item.sup.class]\">{{item.sup.text}}</span>\r\n                <!-- \u8FD9\u4E2Aspan\u662F\u4E3A\u4E86\u5728\u6709\u89D2\u6807\u7684\u573A\u666F\u4E0B\u80FD\u89E3\u6790icon\uFF0C\u6240\u4EE5\u4E0D\u663E\u793A -->\r\n                <span class=\"ti3-icon\" style=\"display: none;\"></span>\r\n            </ng-container>\r\n        </ng-template>\r\n\r\n        <span class=\"ti3-btn-multi-selection-icon\" *ngIf=\"multiple && setActiveClass(item)\">\r\n            <span class=\"ti3-icon ti3-icon-checkmark\"></span>\r\n        </span>\r\n</div>\r\n</span>",
                host: {
                    '[class.ti3-button-group-bottom-space]': 'multiline'
                },
                providers: [TiFormComponent.getValueAccessor(TiButtongroupComponent)],
                styles: ["::ng-deep :root{--ti-button-enough-space-padding:20px;--ti-button-insufficient-space-padding:8px;--ti-button-item-small-padding:20px;--ti-button-multi-selection-maxwidth:300px;--ti-button-sup-height:16px}:host[disabled] .ti3-btn-item-container.ti3-active .ti3-btn-item-radio{background-color:var(--ti-button-group-bg-color-active-disabled);color:var(--ti-button-group-text-color-disabled)}.ti3-btn-item-container{display:inline-block;position:relative}.ti3-btn-item-container .ti3-btn-item-sup{color:var(--ti-common-color-text-white);font-size:var(--ti-common-font-size-base);height:var(--ti-button-sup-height);line-height:var(--ti-button-sup-height);min-width:var(--ti-button-sup-height);position:absolute;right:0;text-align:center;top:calc(-1*var(--ti-button-sup-height)/2)}.ti3-btn-item-container .ti3-btn-item.ti3-btn-item-checkbox{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container:last-child .ti3-btn-item.ti3-btn-item-radio{border-radius:0 var(--ti-button-group-border-radius) var(--ti-button-group-border-radius) 0}.ti3-btn-item-container:last-child .ti3-btn-item.ti3-btn-item-noBorder{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container:first-child .ti3-btn-item.ti3-btn-item-radio{border-radius:var(--ti-button-group-border-radius) 0 0 var(--ti-button-group-border-radius)}.ti3-btn-item-container:first-child .ti3-btn-item.ti3-btn-item-noBorder{border-radius:var(--ti-button-group-border-radius)}.ti3-btn-item-container.ti3-active .ti3-btn-item-radio{background-color:var(--ti-button-group-bg-color-active);color:var(--ti-button-group-text-color-active);transition:background .25s,color .25s}.ti3-btn-item-container.ti3-active .ti3-btn-item-radio[disabled]{background-color:var(--ti-button-group-bg-color-active-disabled);color:var(--ti-button-group-text-color-disabled)}.ti3-btn-item-container .ti3-btn-item[disabled]{background-color:var(--ti-button-group-bg-color-disabled);border-color:var(--ti-button-group-bg-color-disabled);color:var(--ti-button-group-text-color-disabled);cursor:not-allowed}.ti3-btn-item-container .ti3-btn-item[disabled].ti3-btn-item-noBorder{background-color:var(--ti-common-color-bg-white-normal)}.ti3-btn-checkbox-enough-space{margin-right:var(--ti-common-space-2x)}.ti3-btn-checkbox-enough-space:last-child{margin-right:0}.ti3-btn-checkbox-enough-space .ti3-btn-item.ti3-btn-item-checkbox{padding:0 var(--ti-button-enough-space-padding)}.ti3-btn-checkbox-deficient-space{margin-right:var(--ti-common-space-2x)}.ti3-btn-checkbox-deficient-space:last-child{margin-right:0}.ti3-btn-checkbox-deficient-space .ti3-btn-item.ti3-btn-item-checkbox{padding:0 var(--ti-button-insufficient-space-padding)}.ti3-btn-item{-ms-box-sizing:border-box;background-color:var(--ti-button-group-bg-color);border:1px solid var(--ti-button-group-border-color);box-sizing:border-box;color:var(--ti-button-group-text-color);cursor:pointer;display:inline-block;height:var(--ti-button-group-height);line-height:calc(var(--ti-button-group-height) - 2px);max-width:var(--ti-button-multi-selection-maxwidth);position:relative;text-align:center;transition:border-color .15s ease-in,background .15s ease-in;vertical-align:middle;white-space:nowrap}.ti3-btn-item.ti3-btn-item-radio{border:none;line-height:var(--ti-button-group-height);padding:0 30px}.ti3-btn-item-text{display:inline-block;overflow:hidden;text-overflow:ellipsis;vertical-align:top;white-space:nowrap;width:100%}.ti3-btn-item-small .ti3-btn-item{height:var(--ti-button-group-height-small);line-height:var(--ti-button-group-height-small);padding:0 var(--ti-button-item-small-padding)}.ti3-btn-item-container:not(.ti3-active) .ti3-btn-item:not([disabled]):focus,.ti3-btn-item-container:not(.ti3-active) .ti3-btn-item:not([disabled]):hover{background-color:var(--ti-button-group-bg-color-hover);border-color:var(--ti-button-group-border-color-hover);color:var(--ti-button-group-text-color-hover);transition:border-color .2s,background .2s}.ti3-btn-item:before{background:var(--ti-button-group-border-left-color);content:\"\";height:100%;left:0;position:absolute;top:0}.ti3-btn-item.ti3-btn-item-checkbox:before{width:0}.ti3-btn-item.ti3-btn-item-radio:after,.ti3-btn-item.ti3-btn-item-radio:before{width:1px}.ti3-btn-item-container:first-child .ti3-btn-item:before{display:none}.ti3-btn-item:after{background:var(--ti-button-group-border-left-color);content:\"\";height:100%;position:absolute;right:0;top:0}.ti3-btn-item.ti3-btn-item-checkbox:after{width:0}.ti3-btn-item-container:last-child .ti3-btn-item:after{display:none}.ti3-btn-item-container.ti3-active .ti3-btn-item{border-color:var(--ti-button-group-border-color-active)}.ti3-btn-item-container.ti3-active .ti3-btn-item:after,.ti3-btn-item-container.ti3-active .ti3-btn-item:before{background:var(--ti-common-color-bg-white-normal)}.ti3-btn-item-noBorder.ti3-btn-item{background-color:transparent;border-radius:var(--ti-button-group-border-radius);padding:0 var(--ti-button-item-small-padding)}.ti3-btn-item-noBorder.ti3-btn-item:hover{background-color:var(--ti-button-group-bg-color-hover)}.ti3-btn-item-noBorder.ti3-btn-item[disabled]{border:none}.ti3-btn-item-noBorder.ti3-btn-item.ti3-btn-item-radio:after,.ti3-btn-item-noBorder.ti3-btn-item.ti3-btn-item-radio:before{width:0}.ti3-btn-multi-selection-icon{border-bottom:16px solid transparent;border-right:16px solid var(--ti-button-group-border-color-active);color:#fff;display:inline-block;font-size:12px;height:0;position:absolute;right:1px;top:1px;width:0}.ti3-btn-multi-selection-icon .ti3-icon-checkmark{position:relative;right:-5px;top:-2px}:host.ti3-button-group-bottom-space .ti3-btn-item-container{margin-bottom:var(--ti-button-group-space-bottom)}"]
            },] }
];
TiButtongroupComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: IterableDiffers }
];
TiButtongroupComponent.propDecorators = {
    items: [{ type: Input }],
    activeClass: [{ type: Input }],
    minWidth: [{ type: Input }],
    type: [{ type: Input }],
    multiple: [{ type: Input }],
    deselectable: [{ type: Input }],
    multiline: [{ type: Input }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    supTemplate: [{ type: ContentChild, args: ['sup', /* TODO: add static flag */ { static: true },] }],
    btns: [{ type: ViewChildren, args: ['btn',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlCdXR0b25ncm91cENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL2J1dHRvbmdyb3VwL1RpQnV0dG9uZ3JvdXBDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVILGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBR0wsZUFBZSxFQUVmLFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxFQUNYLFlBQVksRUFDZixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBMEN6RTs7Ozs7Ozs7Ozs7OztHQWFHO0FBVUgsTUFBTSxPQUFPLHNCQUF1QixTQUFRLGdCQUFnQjtJQTBEeEQsWUFBc0IsVUFBc0IsRUFDdEIsU0FBb0IsRUFDcEIsaUJBQW9DLEVBQ3RDLGVBQWdDO1FBQ3hDLEtBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFKbkIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDdEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBaERwRDs7Ozs7O1dBTUc7UUFDTSxTQUFJLEdBQVcsT0FBTyxDQUFDO1FBQ2hDOztXQUVHO1FBQ00sYUFBUSxHQUFZLEtBQUssQ0FBQztRQUNuQyx3Q0FBd0M7UUFDeEM7O1dBRUc7UUFDTSxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUN2Qzs7OztXQUlHO1FBQ0g7OztXQUdHO1FBQ00sY0FBUyxHQUFZLEtBQUssQ0FBQztJQXdCcEMsQ0FBQztJQUVELFFBQVE7UUFDSixLQUFLLENBQUMsUUFB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Z0JBQWdCLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7YUFDeEU7OztZQTVFRyxVQUFVO1lBT1YsU0FBUztZQVZULGlCQUFpQjtZQU9qQixlQUFlOzs7b0JBNkVkLEtBQUs7MEJBSUwsS0FBSzt1QkFJTCxLQUFLO21CQVFMLEtBQUs7dUJBSUwsS0FBSzsyQkFLTCxLQUFLO3dCQVVMLEtBQUs7NEJBS0wsWUFBWSxTQUFDLFdBQVcsRUFBRSwyQkFBMkIsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBQ3RFLFlBQVksU0FBQyxNQUFNLEVBQUUsMkJBQTJCLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzBCQUNqRSxZQUFZLFNBQUMsS0FBSyxFQUFFLDJCQUEyQixDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTttQkFLaEUsWUFBWSxTQUFDLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQWZ0ZXJWaWV3Q2hlY2tlZCxcclxuICAgIENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgQ29udGVudENoaWxkLFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIElucHV0LFxyXG4gICAgSXRlcmFibGVDaGFuZ2VzLFxyXG4gICAgSXRlcmFibGVEaWZmZXIsXHJcbiAgICBJdGVyYWJsZURpZmZlcnMsXHJcbiAgICBPbkluaXQsXHJcbiAgICBRdWVyeUxpc3QsXHJcbiAgICBSZW5kZXJlcjIsXHJcbiAgICBUZW1wbGF0ZVJlZixcclxuICAgIFZpZXdDaGlsZHJlblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFRpRm9ybUNvbXBvbmVudCwgVGlXaG9sZUNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvVGlCYXNlTW9kdWxlJztcclxuLy8gVE9ETzog5qCH562+5ZG95ZCN5LiN6KeE6IyD77yMVGlCdXR0b25ncm91cOW6lOivpeWvueW6lOWIsHRpLWJ1dHRvbmdyb3VwXHJcbi8qKlxyXG4gKiDmjInpkq7nu4Tnu4Tku7bvvJrmr4/kuKrmjInpkq7nmoTlsZ7mgKfphY3nva5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVGlCdXR0b25JdGVtIHtcclxuICAgIC8qKlxyXG4gICAgICog5oyJ6ZKu5paH5pys5pi+56S6XHJcbiAgICAgKi9cclxuICAgIHRleHQ/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruaMiemSrueKtuaAgVxyXG4gICAgICovXHJcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rnRpcOWGheWuue+8jOexu+Wei+S4uuaWh+acrOOAgVRlbXBsYXRlUmVm5oiW57uE5Lu2XHJcbiAgICAgKi9cclxuICAgIHRpcENvbnRlbnQ/OiBzdHJpbmd8IFRlbXBsYXRlUmVmPGFueT4gfCBhbnk7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rnRpcOaYvuekuuaWueWQke+8jFxyXG4gICAgICovXHJcbiAgICB0aXBQb3NpdGlvbj86IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5oyJ6ZKu5qCH5b+X57G75Z6L77yaXHJcbiAgICAgKlxyXG4gICAgICog5a+56LGh57G75Z6L77yM5YyF5ZCr5Lik5Liq5bGe5oCnOjEudGV4dDog5pi+56S655qE5paH5pys77ybMi5jbGFzczrmoIflv5fnmoTmoLflvI/vvJtlZzp7dGV4dDogc3RyaW5nOyBjbGFzczogc3RyaW5nfVxyXG4gICAgICpcclxuICAgICAqIDEwLjEuMueJiOacrOS5i+WQjuWPr+iHquWumuS5ieaooeadv++8jOiuvue9ruaMiemSruagh+W/l+agt+W8j1xyXG4gICAgICovXHJcbiAgICBzdXA/OiB7XHJcbiAgICAgICAgICAgIHRleHQ/OiBzdHJpbmc7XHJcbiAgICAgICAgICAgIGNsYXNzPzogc3RyaW5nO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5YWB6K645pyJ5aSa5L2Z55qE5bGe5oCn5a2X5q61XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxuICAgICAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhYHorrjmnInlpJrkvZnnmoTlsZ7mgKflrZfmrrVcclxuICAgICAqL1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbn1cclxuLyoqXHJcbiAqIGJ1dHRvbkdyb3Vw6YCJ5oup5oyJ6ZKu57uE57uE5Lu2XHJcbiAqXHJcbiAqIOivpee7hOS7tuaUr+aMgeWNlemAieOAgeWkmumAieS4pOenjeW9ouW8j++8jOaYvuekuuWGheWuueaUr+aMgeeUqOaIt+iHquWumuS5iVxyXG4gKlxyXG4gKiDljZXpgInlnZfvvJrnlKjmiLfopoHku47kuIDkuKrmlbDmja7pm4bkuK3pgInmi6nljZXkuKrpgInpobnjgIJcclxuICog5YiG5aSn5bC65a+477yM5bCP5bC65a+477yM5peg6L655qGG5LiJ56eN57G75Z6L44CCXHJcbiAqIOaUr+aMgeWPr+WPlua2iOmAieS4re+8jOm7mOiupOmAieS4reaXtuWGjeasoeeCueWHu+S4jeWPlua2iOW9k+WJjemAieS4remhue+8m1xyXG4gKlxyXG4gKiDlpJrpgInlnZfvvJrlhYHorrjnlKjmiLfku47kuIDkuKrmlbDmja7pm4bkuK3pgInmi6nlpJrkuKrpgInpobnjgIJcclxuICog5YiG5aSn5bC65a+477yM5bCP5bC65a+45Lik56eN57G75Z6L44CCXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55M2RlbW8vIy9idXR0b25ncm91cC9idXR0b25ncm91cC1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RpLWJ1dHRvbi1ncm91cCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vYnV0dG9uZ3JvdXAuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9idXR0b25ncm91cC5sZXNzJ10sXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJ1tjbGFzcy50aTMtYnV0dG9uLWdyb3VwLWJvdHRvbS1zcGFjZV0nOiAnbXVsdGlsaW5lJ1xyXG4gICAgfSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRpQnV0dG9uZ3JvdXBDb21wb25lbnQpXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlCdXR0b25ncm91cENvbXBvbmVudCBleHRlbmRzIFRpV2hvbGVDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiDmjInpkq7nu4TlsZ7mgKfphY3nva7vvIzkuLrmlbDnu4TlvaLlvI/vvIzmlbDnu4TkuK3mr4/kuIDpobnkuLrkuIDkuKrmjInpkq7nmoTlsZ7mgKfphY3nva7vvIzkuLrlr7nosaHlvaLlvI/vvJpcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgaXRlbXM6IEFycmF5PFRpQnV0dG9uSXRlbT47XHJcbiAgICAvKipcclxuICAgICAqIOa/gOa0u+eKtuaAgemhueagt+W8j+exu+WumuS5iVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBhY3RpdmVDbGFzczogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7ljZXkuKrmjInpkq7mnIDlsI/lrr3luqZcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbWluV2lkdGg6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog55So5p2l5o6n5Yi25oyJ6ZKu55qE5bC65a+45aSn5bCPOum7mOiupOaYr2xhcmdlXHJcbiAgICAgKlxyXG4gICAgICog5Y2V6YCJ5oyJ6ZKu5pyJ5aSn5bCP5bC65a+444CB5peg6L655qGG5LmL5YiG77ya5Y+W5YC8ICdsYXJnZScsJ3NtYWxsJywnbm9Cb3JkZXInXHJcbiAgICAgKlxyXG4gICAgICog5aSa6YCJ5oyJ6ZKu5pyJ56m66Ze05YWF6Laz77yM56m66Ze05LiN6Laz5LmL5YiG77ya5Y+W5YC8ICdsYXJnZScsJ3NtYWxsJyxcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdHlwZTogc3RyaW5nID0gJ2xhcmdlJztcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5piv5ZCm5Li65aSa6YCJ5oyJ6ZKu57uEXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIG11bHRpcGxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvLyBUT0RPOlRpbnk0IGRlc2VsZWN0YWJsZeaUueS4unVuc2VsZWN0YWJsZVxyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7ljZXpgInmjInpkq7nu4TmmK/lkKblj6/ku6Xlj5bmtojpgInkuK1cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgZGVzZWxlY3RhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjAuMuaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOaMiemSruaYr+WQpuS4uuWkmuihjO+8jOiuvue9ruS4uuWkmuihjOaXtu+8jOaMiemSruWdl+acieS4i+i+uei3ne+8jOWQpuWImeayoeacieOAglxyXG4gICAgICovXHJcbiAgICAvKipcclxuICAgICAqIOeUqOS6juWPluS7o+WFrOWFseagt+W8j+exu3RpMy1idXR0b24tZ3JvdXAtYm90dG9tLXNwYWNlXHJcbiAgICAgKiA8dGktYnV0dG9uLWdyb3VwIGNsYXNzPVwidGkzLWJ1dHRvbi1ncm91cC1ib3R0b20tc3BhY2VcIj48L3RpLWJ1dHRvbi1ncm91cD5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbXVsdGlsaW5lOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiOt+WPluWIsOeUqOaIt+iHquWumuS5ieeahOaooeadv1xyXG4gICAgICovXHJcbiAgICBAQ29udGVudENoaWxkKFRlbXBsYXRlUmVmLCAvKiBUT0RPOiBhZGQgc3RhdGljIGZsYWcgKi8geyBzdGF0aWM6IHRydWUgfSkgZmlyc3RUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBDb250ZW50Q2hpbGQoJ2l0ZW0nLCAvKiBUT0RPOiBhZGQgc3RhdGljIGZsYWcgKi8geyBzdGF0aWM6IHRydWUgfSkgaXRlbVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+OyAvLyDoh6rlrprkuYkgaXRlbSDmqKHmnb9cclxuICAgIEBDb250ZW50Q2hpbGQoJ3N1cCcsIC8qIFRPRE86IGFkZCBzdGF0aWMgZmxhZyAqLyB7IHN0YXRpYzogdHJ1ZSB9KSBzdXBUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjsgLy8g6Ieq5a6a5LmJ5oyJ6ZKu5qCH5b+X5qih5p2/XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiOt+WPluavj+S4quaMiemSrlxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkcmVuKCdidG4nKSBidG5zOiBRdWVyeUxpc3Q8RWxlbWVudFJlZj47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOe7keWcqOaooeadv+S4iueUqOaIt+iHquWumuS5iea/gOa0u+agt+W8j1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWN0Q2xhc3M6IHN0cmluZztcclxuICAgIHByaXZhdGUgaXRlbXNEaWZmZXI6IEl0ZXJhYmxlRGlmZmVyPFRpQnV0dG9uSXRlbT47XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCByZW5kZXJlcjI6IFJlbmRlcmVyMixcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGl0ZXJhYmxlRGlmZmVyczogSXRlcmFibGVEaWZmZXJzKSB7XHJcbiAgICAgICAgICAgICAgICBzdXBlcihlbGVtZW50UmVmLCByZW5kZXJlcjIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5aSE55CG5r+A5rS75qC35byPXHJcbiAgICAgICAgdGhpcy5hY3RDbGFzcyA9IHRoaXMuYWN0aXZlQ2xhc3MgfHwgJ3RpMy1hY3RpdmUnO1xyXG4gICAgICAgIHRoaXMuaXRlbXNEaWZmZXIgPSB0aGlzLml0ZXJhYmxlRGlmZmVycy5maW5kKHRoaXMuaXRlbXMgfHwgW10pXHJcbiAgICAgICAgICAgIC5jcmVhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdDaGVja2VkKCk7XHJcbiAgICAgICAgY29uc3QgaXRlbXNEaWZmZXI6IEl0ZXJhYmxlQ2hhbmdlczxUaUJ1dHRvbkl0ZW0+ID0gdGhpcy5pdGVtc0RpZmZlci5kaWZmKHRoaXMuaXRlbXMgfHwgW10pO1xyXG4gICAgICAgIGlmIChpdGVtc0RpZmZlcikge1xyXG4gICAgICAgICAgICBjb25zdCBmb2N1c0VsZW1lbnRzOiBBcnJheTxhbnk+ID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuYnRucy5mb3JFYWNoKChpdGVtOiBFbGVtZW50UmVmKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmb2N1c0VsZW1lbnRzLnB1c2goaXRlbS5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoZm9jdXNFbGVtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YW85a655pen54mI77yaXHJcbiAgICAgKiAxMC4xLjIg54mI5pys5LmL5YmN5Y+q6IO95YaF5bWM5LiA5Liq5qih5p2/77yM5peg5ZG95ZCN44CCXHJcbiAgICAgKiDmlrDniYjlj6/ku6XlhoXltYzkuKTkuKrmqKHmnb/vvIznpLrkvovkuablhpnopoHmsYLpg73lkb3lkI3vvIgjaXRlbe+8jCNzdXDvvInjgIJcclxuICAgICAqIOS9humcgOimgeWFvOWuueaXp+eJiOaXoOWRveWQjea1i+ivleeUqOS+i+OAglxyXG4gICAgICovXHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlckNvbnRlbnRJbml0KCk7XHJcbiAgICAgICAgLy8g5aaC5p6cIGl0ZW0g5qih5p2/5Li656m6ICYmIOWtmOWcqOesrOS4gOS4quaooeadv++8jOmCo+S5iOaKiuesrOS4gOS4quWHuueOsOeahCDigJzpnZ4gI3N1cCDmoIfnrb7igJ0g55qE5qih5p2/5L2c5Li6IGl0ZW0g5qih5p2/XHJcbiAgICAgICAgaWYgKCF0aGlzLml0ZW1UZW1wbGF0ZSAmJiB0aGlzLmZpcnN0VGVtcGxhdGVcclxuICAgICAgICAgICAgJiYgKHRoaXMuZmlyc3RUZW1wbGF0ZS5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgIT09ICh0aGlzLnN1cFRlbXBsYXRlICYmIHRoaXMuc3VwVGVtcGxhdGUuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KSkpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtVGVtcGxhdGUgPSB0aGlzLmZpcnN0VGVtcGxhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogc3Vw5bGe5oCn5a2Y5ZyoY2xhc3PnsbvmiJZ0ZXh05a2Y5Zyo5LiU5pyJ5pWIXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc1N1cGVyU2NyaXB0KGl0ZW06IFRpQnV0dG9uSXRlbSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtLnN1cCAmJiAoaXRlbS5zdXAuY29uc3RydWN0b3IgPT09IE9iamVjdCkgJiZcclxuICAgICAgICAoKFV0aWwuaXNTdHJpbmcoaXRlbS5zdXAuY2xhc3MpICYmIGl0ZW0uc3VwLmNsYXNzICE9PSAnJykgfHxcclxuICAgICAgICAoVXRpbC5pc1N0cmluZyhpdGVtLnN1cC50ZXh0KSAmJiBpdGVtLnN1cC50ZXh0ICE9PSAnJykpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogQGRlc2NyaXB0aW9uIOagueaNrnNlbGVjdGVkSWTmnaXorr7nva7mr4/kuKrmjInpkq7nmoTmoLflvI9cclxuICAgICAqIEBwYXJhbTogaXRlbVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0QWN0aXZlQ2xhc3MoaXRlbTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAodGhpcy5oYXNTZWxlY3RlZChpdGVtKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hY3RDbGFzcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOavj+S4qml0ZW3kuIrnmoTngrnlh7vkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2soaXRlbTogVGlCdXR0b25JdGVtKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGl0ZW0uZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZCkgeyAvLyDngbDljJbnirbmgIHkuIsg77yM54K55Ye75pON5L2c5peg5pWIXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbShpdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOavj+S4qml0ZW3kuIrnmoTngrnlh7vkuovku7ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RJdGVtKGl0ZW06IFRpQnV0dG9uSXRlbSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgICAgIGlmIChVdGlsLmlzVW5kZWZpbmVkKHRoaXMubW9kZWxXaG9sZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWxXaG9sZSA9IFtpdGVtXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSB0aGlzLm1vZGVsV2hvbGUuaW5kZXhPZihpdGVtKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsgLy8g5aaC5p6c5a2Y5Zyo77yM5YiZ5bCG5YW256e76ZmkXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbFdob2xlLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyDlhYjliY3mnKrpgInkuK3mg4XlhrXkuIvvvIzli77pgIlcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsV2hvbGUucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdGVkSWTmmK/lvJXnlKjnsbvlnovvvIzlhoXlrrnmlLnlj5jkuI3kvJrop6blj5Ftb2RlbGNoYW5nZe+8jOaVhemcgOaUueWPmOW8leeUqOWcsOWdgFxyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbFdob2xlID0gdGhpcy5tb2RlbFdob2xlLmNvbmNhdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbFdob2xlID0gKE9iamVjdC5pcyhpdGVtLCB0aGlzLm1vZGVsV2hvbGUpICYmIHRoaXMuZGVzZWxlY3RhYmxlKSA/ICcnIDogaXRlbTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDliKTmlq3mmK/kuI3mmK/pgInkuK3poblcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBoYXNTZWxlY3RlZChpdGVtOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoVXRpbC5pc1VuZGVmaW5lZCh0aGlzLm1vZGVsV2hvbGUpIHx8IFV0aWwuaXNOdWxsKHRoaXMubW9kZWxXaG9sZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9kZWxXaG9sZS5pbmRleE9mKGl0ZW0pICE9PSAtMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmlzKGl0ZW0sIHRoaXMubW9kZWxXaG9sZSkgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=