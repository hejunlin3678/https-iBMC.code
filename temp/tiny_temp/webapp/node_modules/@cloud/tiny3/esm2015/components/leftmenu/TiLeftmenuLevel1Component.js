import { ChangeDetectorRef, Component, ContentChild, ElementRef, Input, Optional, Renderer2, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { TiLeftmenuComponent } from './TiLeftmenuComponent';
import { TiLeftmenuGroupComponent } from './TiLeftmenuGroupComponent';
import { TiLeftmenuItemComponent } from './TiLeftmenuItemComponent';
import { Util } from '../../utils/Util';
import { TiBaseComponent } from '../base/TiBaseModule';
/**
 * TiLeftmenuLevel1Component 是一级菜单组件，嵌在 TiLeftmenu 中使用
 *
 */
export class TiLeftmenuLevel1Component extends TiBaseComponent {
    constructor(leftmenu, elementRef, renderer2, changeRef, leftmenuGroup, domSanitizer) {
        super(elementRef, renderer2);
        this.elementRef = elementRef;
        this.changeRef = changeRef;
        this.leftmenuGroup = leftmenuGroup;
        this.domSanitizer = domSanitizer;
        /**
         * @ignore
         * 当前 TiLeftmenuLevel1下所有的 TiLeftmenuLevel2 的集合
         */
        this.children = [];
        /**
         * @ignore
         * 模板中使用，二级菜单是否展开
         */
        this.showChildren = false;
        /**
         * @ignore
         * 模板中使用，是否是激活状态
         */
        this.isActived = false;
        this.element = this.elementRef.nativeElement;
        this.leftmenu = leftmenu;
    }
    ngOnInit() {
        if (this.leftmenuGroup) {
            this.leftmenuGroup.children.push(this);
        }
    }
    ngAfterViewInit() {
        this.setShowChildren();
        this.setActiveState();
        this.leftmenu.level1Items.push(this);
        this.changeRef.detectChanges();
    }
    ngOnDestroy() {
        const index = this.leftmenu.level1Items.indexOf(this);
        if (this.leftmenuGroup) {
            const groupIndex = this.leftmenuGroup.children.indexOf(this);
            if (groupIndex !== -1) {
                this.leftmenuGroup.children.splice(groupIndex, 1);
            }
        }
        if (index !== -1) {
            this.leftmenu.level1Items.splice(index, 1);
        }
    }
    /**
     * @ignore
     * 模板中使用，点击一级菜单项时调用
     */
    selectFn() {
        if (this.item.href) {
            this.openHref(this.item.href);
            this.element.querySelector('.ti3-leftmenu-level1-item')
                .blur();
            return;
        }
        const oldactive = this.leftmenu.active;
        if (this.hasChildren()) {
            this.showChildren = !this.showChildren;
            this.isActived = !this.showChildren && this.hasActivedChildren();
            if (this.showChildren) {
                for (const level1Items of this.leftmenu.level1Items) {
                    if (level1Items === this) {
                        continue;
                    }
                    if (level1Items.showChildren) {
                        level1Items.showChildren = false;
                        if (level1Items.hasActivedChildren()) {
                            level1Items.isActived = true;
                        }
                        break;
                    }
                }
            }
        }
        else {
            if (this.leftmenu.routable) {
                // 点击当前已经激活的item时，刷新对应路由
                if (this.item === oldactive) {
                    this.leftmenu.triggerReload(this.item);
                }
                else {
                    // 点击其他项需要进行跳转，来触发路由守卫，实际是否跳转取决于路由守卫返回值。
                    this.leftmenu.navigate(this.item);
                }
            }
            else {
                if (this.item !== oldactive) {
                    this.leftmenu.active = this.item;
                    this.leftmenu.activeChange.emit(this.item);
                    this.isActived = true;
                }
            }
        }
    }
    /**
     * @ignore
     * 在 TiLeftmenuComponent.ts 中调用了
     */
    setShowChildren() {
        // 初始化时，子菜单中有当前选中状态时，显示子菜单
        this.showChildren = this.hasActivedChildren();
    }
    /**
     * @ignore
     * 在模板上使用
     */
    hasChildren() {
        return this.children && this.children.length > 0;
    }
    /**
     * @ignore
     * 在模板上使用
     */
    hasActivedChildren() {
        if (!this.hasChildren()) {
            return false;
        }
        const result = this.children.filter((level2) => {
            return level2.item === this.leftmenu.active;
        });
        return result.length > 0;
    }
    /**
     * @ignore
     * 设置当前菜单是否处于激活状态，下边两种情况下将当前菜单设置为激活状态：
     *
     * 有子菜单时，当子菜单有有激活状态项并且子菜单关闭状态情况下；
     *
     * 没有子菜单时，当前菜单就是激活菜单项。
     */
    setActiveState() {
        this.isActived = (this.hasActivedChildren() && !this.showChildren)
            || this.item === this.leftmenu.active;
    }
    /**
     * @ignore
     */
    onStateIconClick() {
        Util.trigger(this.leftmenuItem.element, 'click');
    }
    /**
     * @ignore
     * 如果有链接，跳转新页面
     */
    openHref(href) {
        const newTab = window.open(this.domSanitizer.sanitize(SecurityContext.URL, href), '_blank');
        // IE 下有时 newTab 不存在
        if (newTab) {
            newTab.opener = null;
        }
    }
}
TiLeftmenuLevel1Component.decorators = [
    { type: Component, args: [{
                selector: 'ti-leftmenu-level1',
                template: "<div [ngClass]=\"{'ti3-leftmenu-level1-active-item' : isActived ,\r\n                 'ti3-leftmenu-level1-open-item' : showChildren}\"\r\n     class=\"ti3-leftmenu-level1-item\"\r\n     tabindex=\"0\"\r\n     tiOutline\r\n     (click)=\"selectFn()\"\r\n     (keyup.enter)=\"selectFn()\"\r\n     [id]=\"appendId('leftmenu_level1')\">\r\n\r\n        <ng-content select=\"ti-leftmenu-item\"></ng-content>\r\n        <!-- \u5C0F\u4E09\u89D2 -->\r\n        <span class=\"ti3-leftmenu-triangle\"\r\n              [ngClass]=\"{'ti3-leftmenu-triangle-up' : showChildren,\r\n                          'ti3-leftmenu-triangle-down' : !showChildren}\"\r\n              *ngIf=\"hasChildren() && !item.href\"\r\n              (click)=\"onStateIconClick()\"></span>\r\n        <!-- \u94FE\u63A5\u56FE\u6807 -->\r\n        <span *ngIf=\"item.href\" class=\"ti3-icon-action-binding ti3-icon ti3-leftmenu-href\"></span>\r\n</div>\r\n<div [hidden]=\"!showChildren\" [ngClass]=\"{'ti3-leftmenu-level2-container': showChildren}\">\r\n    <ng-content></ng-content>\r\n</div>\r\n",
                host: {
                    '[class.ti3-leftmenu-level1]': 'true',
                    '[class.ti3-leftmenu-level1-dividing]': 'item.showDividingLine'
                }
            },] }
];
TiLeftmenuLevel1Component.ctorParameters = () => [
    { type: TiLeftmenuComponent },
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: TiLeftmenuGroupComponent, decorators: [{ type: Optional }] },
    { type: DomSanitizer }
];
TiLeftmenuLevel1Component.propDecorators = {
    item: [{ type: Input }],
    leftmenuItem: [{ type: ContentChild, args: [TiLeftmenuItemComponent, /* TODO: add static flag */ { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlMZWZ0bWVudUxldmVsMUNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL2xlZnRtZW51L1RpTGVmdG1lbnVMZXZlbDFDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBR0wsUUFBUSxFQUNSLFNBQVMsRUFDVCxlQUFlLEVBQ2hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsbUJBQW1CLEVBQWtCLE1BQU0sdUJBQXVCLENBQUM7QUFDNUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFdEUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDcEUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RDs7O0dBR0c7QUFVSCxNQUFNLE9BQU8seUJBQTBCLFNBQVEsZUFBZTtJQXdDMUQsWUFBWSxRQUE2QixFQUFVLFVBQXNCLEVBQUUsU0FBb0IsRUFDM0UsU0FBNEIsRUFBc0IsYUFBdUMsRUFDekYsWUFBMEI7UUFDdEMsS0FBSyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUhjLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDckQsY0FBUyxHQUFULFNBQVMsQ0FBbUI7UUFBc0Isa0JBQWEsR0FBYixhQUFhLENBQTBCO1FBQ3pGLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBdEI5Qzs7O1dBR0c7UUFDSSxhQUFRLEdBQXFDLEVBQUUsQ0FBQztRQUN2RDs7O1dBR0c7UUFDSSxpQkFBWSxHQUFZ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a0JBQWtCLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7ZUFDM0QsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztJQUM5QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxnQkFBZ0I7UUFDckIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksUUFBUSxDQUFDLElBQVk7UUFDeEIsTUFBTSxNQUFNLEdBQVEsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ2pHLG9CQUFvQjtRQUNwQixJQUFJLE1BQU0sRUFBRTtZQUNSLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ3hCO0lBQ0wsQ0FBQzs7O1lBbk1KLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsb0JBQW9CO2dCQUM5Qiw2aUNBQXFDO2dCQUNyQyxJQUFJLEVBQUU7b0JBQ0EsNkJBQTZCLEVBQUUsTUFBTTtvQkFDckMsc0NBQXNDLEVBQUUsdUJBQXVCO2lCQUNsRTthQUNKOzs7WUFqQlEsbUJBQW1CO1lBVjFCLFVBQVU7WUFLVixTQUFTO1lBUlQsaUJBQWlCO1lBY1Ysd0JBQXdCLHVCQTJEc0IsUUFBUTtZQTlEdEQsWUFBWTs7O21CQW9DaEIsS0FBSzsyQkFJTCxZQUFZLFNBQUMsdUJBQXVCLEVBQUUsMkJBQTJCLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LFxyXG4gIENoYW5nZURldGVjdG9yUmVmLFxyXG4gIENvbXBvbmVudCxcclxuICBDb250ZW50Q2hpbGQsXHJcbiAgRWxlbWVudFJlZixcclxuICBJbnB1dCxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE9wdGlvbmFsLFxyXG4gIFJlbmRlcmVyMixcclxuICBTZWN1cml0eUNvbnRleHRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcblxyXG5pbXBvcnQgeyBUaUxlZnRtZW51Q29tcG9uZW50LCBUaUxlZnRtZW51SXRlbSB9IGZyb20gJy4vVGlMZWZ0bWVudUNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRpTGVmdG1lbnVHcm91cENvbXBvbmVudCB9IGZyb20gJy4vVGlMZWZ0bWVudUdyb3VwQ29tcG9uZW50JztcclxuaW1wb3J0IHsgVGlMZWZ0bWVudUxldmVsMkNvbXBvbmVudCB9IGZyb20gJy4vVGlMZWZ0bWVudUxldmVsMkNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRpTGVmdG1lbnVJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9UaUxlZnRtZW51SXRlbUNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi91dGlscy9VdGlsJztcclxuaW1wb3J0IHsgVGlCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9UaUJhc2VNb2R1bGUnO1xyXG4vKipcclxuICogVGlMZWZ0bWVudUxldmVsMUNvbXBvbmVudCDmmK/kuIDnuqfoj5zljZXnu4Tku7bvvIzltYzlnKggVGlMZWZ0bWVudSDkuK3kvb/nlKhcclxuICpcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndGktbGVmdG1lbnUtbGV2ZWwxJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vbGVmdG1lbnUtbGV2ZWwxLmh0bWwnLFxyXG4gIGhvc3Q6IHtcclxuICAgICAgICAnW2NsYXNzLnRpMy1sZWZ0bWVudS1sZXZlbDFdJzogJ3RydWUnLFxyXG4gICAgICAgICdbY2xhc3MudGkzLWxlZnRtZW51LWxldmVsMS1kaXZpZGluZ10nOiAnaXRlbS5zaG93RGl2aWRpbmdMaW5lJ1xyXG4gICAgfVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFRpTGVmdG1lbnVMZXZlbDFDb21wb25lbnQgZXh0ZW5kcyBUaUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uSW5pdCB7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruW9k+WJjeiPnOWNlemhueeahOWGheWuueS/oeaBr1xyXG4gICAgICpcclxuICAgICAqIHJvdXRlcijnsbvlnovvvJpBcnJheTxhbnk+KTog6K6+572u5b2T5YmN6aG55a+55bqU55qE6Lev55Sx77yM5LiOIFJvdXRlci5uYXZpZ2F0ZeaWueazleeahOesrOS4gOS4quWPguaVsOS4gOagt++8m1xyXG4gICAgICpcclxuICAgICAqIHJvdXRlckV4dHJhcyjnsbvlnovvvJpOYXZpZ2F0aW9uRXh0cmFzKTog6K6+572u5b2T5YmN6aG55a+55bqU6Lev55Sx55qE6YWN572u5L+h5oGv77yM5LiOIFJvdXRlci5uYXZpZ2F0ZeaWueazleeahOesrOS6jOS4quWPguaVsOS4gOagt++8m1xyXG4gICAgICpcclxuICAgICAqIHJvdXRlckxpc3Qo57G75Z6L77yaQXJyYXk8QXJyYXk8YW55Pj4pOiDorr7nva7kuIDkuKpyb3V0ZXLot6/nlLHliJfooajvvIzlvZPor6XliJfooajkuK3nmoTot6/nlLHooqvmv4DmtLvml7bvvIzlhbblr7nlupTnmoToj5zljZXpobnooqvmv4DmtLvlpITkuo7pq5jkuq7nirbmgIHjgIJcclxuICAgICAqIOWFtuS9v+eUqOWcuuaZr+S4uuWkmuS4qui3r+eUseWvueW6lOWQjOS4gOS4quW3puS+p+iPnOWNlemhueOAglxyXG4gICAgICpcclxuICAgICAqIGhyZWYo57G75Z6L77yac3RyaW5nKe+8mnYxMC4wLjHniYjmnKzmlrDlop7vvIzkuLror6Xoj5zljZXphY3nva7pk77mjqXlnLDlnYDvvIzngrnlh7vlkI7ot6/nlLHmv4DmtLvpobnkuI3lj5jvvIzlnKjmlrDpobXpnaLmiZPlvIDphY3nva7lnLDlnYDjgIJcclxuICAgICAqIHYxMC4wLjEgfiB2MTAuMS4z54mI5pys5a2Y5ZyoWFNT5pS75Ye7KHVybOexu+Weiynpo47pmanlkoznlKjmiLfngrnlh7vov5nkuKrpk77mjqXlubbov5vlhaXkuIDkuKrmlrDnmoTmoIfnrb7vvIzmlrDmoIfnrb7kuK3nmoTpobXpnaLlpoLmnpzlrZjlnKjmgbbmhI/ku6PnoIHvvIzlsLHlj6/ku6XlsIbljp/nvZHnq5nnm7TmjqXlr7zoiKrliLDkuIDkuKromZrlgYfnvZHnq5nnmoTlronlhajpo47pmanjgIJcclxuICAgICAqIHYxMC4xLjQg54mI5pys5YGa5LqG5a6J5YWo5aSE55CG77yM5bey5LiN5a2Y5Zyo5LiK6L+w5Lik56eN5a6J5YWo6Zeu6aKY77yM5bu66K6u5Lia5Yqh5bC95b+r5Y2H57qn54mI5pys44CCXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGl0ZW06IFRpTGVmdG1lbnVJdGVtO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBDb250ZW50Q2hpbGQoVGlMZWZ0bWVudUl0ZW1Db21wb25lbnQsIC8qIFRPRE86IGFkZCBzdGF0aWMgZmxhZyAqLyB7IHN0YXRpYzogdHJ1ZSB9KSBsZWZ0bWVudUl0ZW06IFRpTGVmdG1lbnVJdGVtQ29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlvZPliY0gVGlMZWZ0bWVudUxldmVsMeS4i+aJgOacieeahCBUaUxlZnRtZW51TGV2ZWwyIOeahOmbhuWQiFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY2hpbGRyZW46IEFycmF5PFRpTGVmdG1lbnVMZXZlbDJDb21wb25lbnQ+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaooeadv+S4reS9v+eUqO+8jOS6jOe6p+iPnOWNleaYr+WQpuWxleW8gFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2hvd0NoaWxkcmVuOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaooeadv+S4reS9v+eUqO+8jOaYr+WQpuaYr+a/gOa0u+eKtuaAgVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXNBY3RpdmVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBsZWZ0bWVudTogVGlMZWZ0bWVudUNvbXBvbmVudDtcclxuICAgIHByaXZhdGUgZWxlbWVudDogYW55O1xyXG4gICAgY29uc3RydWN0b3IobGVmdG1lbnU6IFRpTGVmdG1lbnVDb21wb25lbnQsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcmVuZGVyZXIyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGNoYW5nZVJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgbGVmdG1lbnVHcm91cDogVGlMZWZ0bWVudUdyb3VwQ29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkb21TYW5pdGl6ZXI6IERvbVNhbml0aXplcikge1xyXG4gICAgICAgICAgICBzdXBlcihlbGVtZW50UmVmLCByZW5kZXJlcjIpO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgdGhpcy5sZWZ0bWVudSA9IGxlZnRtZW51O1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmxlZnRtZW51R3JvdXApIHtcclxuICAgICAgICAgICAgdGhpcy5sZWZ0bWVudUdyb3VwLmNoaWxkcmVuLnB1c2godGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAgdGhpcy5zZXRTaG93Q2hpbGRyZW4oKTtcclxuICAgICAgICAgdGhpcy5zZXRBY3RpdmVTdGF0ZSgpO1xyXG4gICAgICAgICB0aGlzLmxlZnRtZW51LmxldmVsMUl0ZW1zLnB1c2godGhpcyk7XHJcbiAgICAgICAgIHRoaXMuY2hhbmdlUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSB0aGlzLmxlZnRtZW51LmxldmVsMUl0ZW1zLmluZGV4T2YodGhpcyk7XHJcbiAgICAgICBpZiAodGhpcy5sZWZ0bWVudUdyb3VwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwSW5kZXg6IG51bWJlciA9IHRoaXMubGVmdG1lbnVHcm91cC5jaGlsZHJlbi5pbmRleE9mKHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAoZ3JvdXBJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGVmdG1lbnVHcm91cC5jaGlsZHJlbi5zcGxpY2UoZ3JvdXBJbmRleCwgMSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgfVxyXG5cclxuICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5sZWZ0bWVudS5sZXZlbDFJdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmqKHmnb/kuK3kvb/nlKjvvIzngrnlh7vkuIDnuqfoj5zljZXpobnml7bosIPnlKhcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlbGVjdEZuKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0uaHJlZikge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5IcmVmKHRoaXMuaXRlbS5ocmVmKTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aTMtbGVmdG1lbnUtbGV2ZWwxLWl0ZW0nKVxyXG4gICAgICAgICAgICAuYmx1cigpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvbGRhY3RpdmU6IFRpTGVmdG1lbnVJdGVtID0gdGhpcy5sZWZ0bWVudS5hY3RpdmU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmhhc0NoaWxkcmVuKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRyZW4gPSAhdGhpcy5zaG93Q2hpbGRyZW47XHJcbiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmVkID0gIXRoaXMuc2hvd0NoaWxkcmVuICYmIHRoaXMuaGFzQWN0aXZlZENoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dDaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBsZXZlbDFJdGVtcyBvZiB0aGlzLmxlZnRtZW51LmxldmVsMUl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsMUl0ZW1zID09PSB0aGlzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobGV2ZWwxSXRlbXMuc2hvd0NoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsMUl0ZW1zLnNob3dDaGlsZHJlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGV2ZWwxSXRlbXMuaGFzQWN0aXZlZENoaWxkcmVuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsMUl0ZW1zLmlzQWN0aXZlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubGVmdG1lbnUucm91dGFibGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIOeCueWHu+W9k+WJjeW3sue7j+a/gOa0u+eahGl0ZW3ml7bvvIzliLfmlrDlr7nlupTot6/nlLFcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW0gPT09IG9sZGFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGVmdG1lbnUudHJpZ2dlclJlbG9hZCh0aGlzLml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDngrnlh7vlhbbku5bpobnpnIDopoHov5vooYzot7PovazvvIzmnaXop6blj5Hot6/nlLHlrojljavvvIzlrp7pmYXmmK/lkKbot7Povazlj5blhrPkuo7ot6/nlLHlrojljavov5Tlm57lgLzjgIJcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZnRtZW51Lm5hdmlnYXRlKHRoaXMuaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtICE9PSBvbGRhY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZnRtZW51LmFjdGl2ZSA9IHRoaXMuaXRlbTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZnRtZW51LmFjdGl2ZUNoYW5nZS5lbWl0KHRoaXMuaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5ZyoIFRpTGVmdG1lbnVDb21wb25lbnQudHMg5Lit6LCD55So5LqGXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXRTaG93Q2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5Yid5aeL5YyW5pe277yM5a2Q6I+c5Y2V5Lit5pyJ5b2T5YmN6YCJ5Lit54q25oCB5pe277yM5pi+56S65a2Q6I+c5Y2VXHJcbiAgICAgICAgdGhpcy5zaG93Q2hpbGRyZW4gPSB0aGlzLmhhc0FjdGl2ZWRDaGlsZHJlbigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Zyo5qih5p2/5LiK5L2/55SoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoYXNDaGlsZHJlbigpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbiAmJiB0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDA7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWcqOaooeadv+S4iuS9v+eUqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaGFzQWN0aXZlZENoaWxkcmVuKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNDaGlsZHJlbigpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogQXJyYXk8VGlMZWZ0bWVudUxldmVsMkNvbXBvbmVudD4gPSB0aGlzLmNoaWxkcmVuLmZpbHRlcigobGV2ZWwyOiBUaUxlZnRtZW51TGV2ZWwyQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBsZXZlbDIuaXRlbSA9PT0gdGhpcy5sZWZ0bWVudS5hY3RpdmU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiuvue9ruW9k+WJjeiPnOWNleaYr+WQpuWkhOS6jua/gOa0u+eKtuaAge+8jOS4i+i+ueS4pOenjeaDheWGteS4i+WwhuW9k+WJjeiPnOWNleiuvue9ruS4uua/gOa0u+eKtuaAge+8mlxyXG4gICAgICpcclxuICAgICAqIOacieWtkOiPnOWNleaXtu+8jOW9k+WtkOiPnOWNleacieaciea/gOa0u+eKtuaAgemhueW5tuS4lOWtkOiPnOWNleWFs+mXreeKtuaAgeaDheWGteS4i++8m1xyXG4gICAgICpcclxuICAgICAqIOayoeacieWtkOiPnOWNleaXtu+8jOW9k+WJjeiPnOWNleWwseaYr+a/gOa0u+iPnOWNlemhueOAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0QWN0aXZlU3RhdGUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5pc0FjdGl2ZWQgPSAodGhpcy5oYXNBY3RpdmVkQ2hpbGRyZW4oKSAmJiAhdGhpcy5zaG93Q2hpbGRyZW4pXHJcbiAgICAgICAgICAgIHx8IHRoaXMuaXRlbSA9PT0gdGhpcy5sZWZ0bWVudS5hY3RpdmU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvblN0YXRlSWNvbkNsaWNrKCk6IHZvaWQge1xyXG4gICAgICBVdGlsLnRyaWdnZXIodGhpcy5sZWZ0bWVudUl0ZW0uZWxlbWVudCwgJ2NsaWNrJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlpoLmnpzmnInpk77mjqXvvIzot7PovazmlrDpobXpnaJcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5IcmVmKGhyZWY6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG5ld1RhYjogYW55ID0gd2luZG93Lm9wZW4odGhpcy5kb21TYW5pdGl6ZXIuc2FuaXRpemUoU2VjdXJpdHlDb250ZXh0LlVSTCwgaHJlZiksICdfYmxhbmsnKTtcclxuICAgICAgICAvLyBJRSDkuIvmnInml7YgbmV3VGFiIOS4jeWtmOWcqFxyXG4gICAgICAgIGlmIChuZXdUYWIpIHtcclxuICAgICAgICAgICAgbmV3VGFiLm9wZW5lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==