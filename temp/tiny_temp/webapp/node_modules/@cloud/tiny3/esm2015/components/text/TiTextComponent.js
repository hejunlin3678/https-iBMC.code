import { Component, ElementRef, EventEmitter, NgZone, Output, Renderer2 } from '@angular/core';
import { NgControl } from '@angular/forms';
import { TiBrowser, Util } from '../../utils/Util';
import { TiRenderer } from '../../services/renderer/TiRenderer';
import { TiAutofocusComponent } from '../base/TiBaseModule';
/**
 * 本组件基于原生input标签进行扩展，原生input加 tiText 属性即为text组件,
 * 原生input的所有属性以及 Angular 的各种属性指令都可以使用。
 *
 * <example-url>../tiny3demo/#/text/text-all</example-url>
 */
export class TiTextComponent extends TiAutofocusComponent {
    constructor(elementRef, renderer, tiRenderer, formControl, zone) {
        super(elementRef, renderer);
        this.tiRenderer = tiRenderer;
        this.formControl = formControl;
        this.zone = zone;
        /**
         * clear事件：当开启清除功能时(使用clearable属性)，点击删除按钮触发
         */
        this.clear = new EventEmitter();
        /**
         * @ignore
         *
         * 初始获取文本框类型
         */
        this.isPassword = false;
        this.isFirstFocus = true; // 是否为第一次聚焦
        this.hasClear = false; // 是否有清除功能
        this.lastIsHover = undefined; // 最后一次绘制叉号的状态。
        this.lastDisabled = undefined; // 最后一次叉号是否禁用。
        this.isVisible = false; // 密码是否可见，默认不可见
        this.isNoEye = false; // 眼睛是否不显示，默认显示
        /**
         * @ignore
         * 鼠标移入清除按钮区域时，给宿主元素添加ti-text-clear-active样式
         */
        this.handleMousemove = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear && !this.isPassword) {
                return;
            }
            // 鼠标移入清除按钮区域时，给宿主元素添加ti-text-clear-active样式;
            // 否则去掉ti-text-clear-active样式
            this.isClearActive = this.isIconField(event);
            this.isClearActive ? this.renderer.addClass(this.nativeElement, 'ti3-text-clear-active') :
                this.renderer.removeClass(this.nativeElement, 'ti3-text-clear-active');
            // 密码类型只需要设置悬浮时手型样式
            if (this.isPassword) {
                return;
            }
            // 叉号特殊处理，3）hover
            this.isClearActive ? this.setClearBackgroud(true) : this.setClearBackgroud(false);
        };
        /**
         * @ignore
         */
        this.handleMouseout = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear) {
                return;
            }
            // 叉号特殊处理，3）hover
            this.setClearBackgroud(false);
        };
        /**
         * @ignore
         * 切换密码可见不可见时，输入框需处于失焦状态
         */
        this.handleMousedown = (event) => {
            if (this.nativeElement.disabled || !this.isPassword || !this.isIconField(event)) {
                return;
            }
            event.preventDefault();
            // 聚焦到可输入区域，再点击眼睛图标时，输入框应失焦
            if (document.activeElement === this.nativeElement) {
                this.nativeElement.blur();
            }
        };
        /**
         *  @ignore
         * 当在清除按钮区域点击时，清空输入框内容
         */
        this.handleClick = (event) => {
            if (this.nativeElement.disabled || !this.isShowClear && !this.isPassword || !this.isIconField(event)) {
                return;
            }
            if (this.isShowClear) {
                this.renderer.setProperty(this.nativeElement, 'value', '');
                Util.trigger(this.nativeElement, 'input');
                this.zone.run(() => {
                    this.clear.emit(event);
                });
                // 点击清除按钮后延时才能聚焦元素
                setTimeout(() => {
                    this.nativeElement.focus();
                }, 0);
            }
            if (this.isPassword) {
                this.isVisible = !this.isVisible;
                this.lastIsHover = undefined;
                this.controlEyeShow();
            }
        };
    }
    ngOnInit() {
        super.ngOnInit();
        this.isNoEye = this.nativeElement.hasAttribute('noeye');
        this.isPassword = this.nativeElement.type === 'password' && !this.isNoEye;
        this.hasClear = this.nativeElement.hasAttribute('clearable') && !this.isPassword;
        this.isNoBorder = this.nativeElement.hasAttribute('noborder');
        // 初始化注册事件
        this.initFn();
        this.handlePassword();
        // Chrome下输入框有时出现自动联想(该问题出现无规律可寻，比较奇怪)，
        // 将其autocomplete置为off可规避此问题
        // 之后firefox及IE11也出现类似问题，所以不区分浏览器差异，统一添加这层处理
        if (this.nativeElement.type === 'text' && this.nativeElement.autocomplete !== 'on') {
            this.renderer.setAttribute(this.nativeElement, 'autocomplete', 'off');
        }
        // 由于在valueChanges中监听不到动态表单中文本框的初始值
        // 所以此处对初始值要做单独处理
        this.controlClearShow(this.nativeElement.value);
        // 文本框的值发生变化时触发
        this.formControl.valueChanges.subscribe((value) => {
            this.controlClearShow(value);
        });
        // 初始设置eye图标
        this.controlEyeShow();
    }
    ngDoCheck() {
        const disabled = this.nativeElement.disabled;
        // 与上次disabled状态相同，则返回
        if (this.lastDisabled === disabled) {
            return;
        }
        // 叉号特殊处理，2）禁用
        if (this.isShowClear || this.isPassword) {
            if (disabled) {
                this.setClearBackgroud(null);
                this.lastDisabled = true;
            }
            else { // 从禁用改为非禁用
                this.setClearBackgroud(false);
                this.lastDisabled = false;
            }
        }
    }
    ngOnDestroy() {
        // 销毁组件时需要将内部生成dom也移除
        if (this.pwdHackEle) {
            this.renderer.removeChild(this.renderer.parentNode(this.pwdHackEle), this.pwdHackEle);
        }
    }
    /**
     * @ignore
     */
    handleFocus() {
        // IE和火狐浏览器在首次autofoucus聚焦时会将光标移到文字起始位置，用户体验不好
        // 需要手动设置光标位置到行尾
        if (this.isFirstFocus && this.nativeElement.autofocus &&
            (TiBrowser.isFirefox() || TiBrowser.isIE())) {
            this.nativeElement.setSelectionRange(this.nativeElement.value.length, this.nativeElement.value.length);
        }
        this.isFirstFocus = false;
    }
    initFn() {
        this.zone.runOutsideAngular(() => {
            this.renderer.listen(this.nativeElement, 'mousemove', this.handleMousemove);
            this.renderer.listen(this.nativeElement, 'mouseout', this.handleMouseout);
            this.renderer.listen(this.nativeElement, 'mousedown', this.handleMousedown);
            this.renderer.listen(this.nativeElement, 'click', this.handleClick);
        });
    }
    /**
     *
     * @param isHover true标示悬浮，false标示非悬浮，null标示禁用，undefinded标示不画叉号。
     * @returns
     */
    setClearBackgroud(isHover) {
        // 如果跟上次一样，则返回。
        if (this.lastIsHover === isHover) {
            return;
        }
        else {
            this.lastIsHover = isHover;
        }
        let colorStr = '';
        if (Util.supportsCssVars()) {
            // Chrome等支持CSSVar的浏览器，正常操作,  从CSSVar变量中取出颜色。
            const varName = isHover === false ? '--ti-input-clear-color' :
                isHover === true ? '--ti-input-clear-color-hover' :
                    isHover === null ? '--ti-input-clear-color-disabled' : '';
            // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
            if (typeof getComputedStyle !== 'undefined') {
                colorStr = getComputedStyle(document.documentElement).getPropertyValue(varName);
            }
        }
        else {
            // IE和低版Edge不支持CSSVar的浏览器，从一个CSS样式中取出颜色。
            const styleName = isHover === false ? 'flood-color' :
                isHover === true ? 'lighting-color' :
                    isHover === null ? 'stop-color' : '';
            // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
            if (typeof getComputedStyle !== 'undefined') {
                colorStr = getComputedStyle(this.nativeElement).getPropertyValue(styleName);
            }
        }
        colorStr = colorStr.trim().replace('#', '%23'); // URL编码
        let urlStr;
        if (this.isPassword) {
            urlStr = this.isVisible ? `url(data:image/svg+xml,%3Csvg%20version=%221.1%22%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2232%22%20height=%2232%22%20viewBox=%220%200%2032%2032%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d=%22M16%206.4c9.4%200%2016%206.4%2016%209.6%200%203-6.6%209.6-16%209.6-9.2%200-16-6.4-16-9.6s6.8-9.6%2016-9.6zM16%208.2c-4.2%200-7.8%203.6-7.8%207.8%200%204.4%203.4%207.8%207.8%207.8%204.2%200%207.8-3.6%207.8-7.8%200-4.4-3.6-7.8-7.8-7.8zM16%2011c2.8%200%205%202.2%205%205s-2.2%205-5%205-5-2.2-5-5c0-2.8%202.2-5%205-5z%22%3E%3C/path%3E%3C/svg%3E%0A)` :
                `url(data:image/svg+xml,%3Csvg%20version=%221.1%22%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2232%22%20height=%2232%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d=%22M1.6%202.925c0.6-0.6%201.4-0.6%201.8%200v0l25.6%2024.2c0.2%200.2%200.4%200.6%200.4%201s-0.2%200.6-0.4%201c-0.2%200.2-0.6%200.4-1%200.4s-0.8-0.2-1-0.4v0l-5-5.2c-2%200.6-4%201-6%201-9.2%200-16-6.6-16-9.8%200-1.8%202-4.6%205.4-6.6v0l-3.6-3.8c-0.6-0.4-0.6-1.2-0.2-1.8zM9%2011.725c-0.4%201-0.6%202.2-0.6%203.4%200%204.4%203.4%208%207.8%208%201.4%200%202.8-0.4%203.8-1v0l-2.4-2.4c-0.4%200.2-1%200.4-1.6%200.4-2.8%200-5-2.2-5-5%200-0.4%200-0.8%200.2-1.2v0l-2.2-2.2zM16%205.325c9.4%200%2016%206.6%2016%209.8%200%201.8-2%204.6-5.6%206.8v0l-3.4-3.2c0.6-1%200.8-2.2%200.8-3.4%200-4.4-3.4-8-7.8-8-1.4%200-2.8%200.4-4%201.2v0%200l-2-2c2-1%204-1.2%206-1.2zM16%209.925c2.8%200%205%202.2%205%205%200%200.4%200%201-0.2%201.4v0l-6.6-6c0.6-0.2%201.2-0.4%201.8-0.4z%22%3E%3C/path%3E%3C/svg%3E)`;
        }
        else {
            urlStr = `url(data:image/svg+xml,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216px%22%20height%3D%2216px%22%3E%3Cpath%20fill%3D%22${colorStr}%22%20d%3D%22M12.529%2C11.469L9.061%2C8l3.469-3.469c0.294-0.294%2C0.295-0.768%2C0.001-1.062c-0.293-0.293-0.769-0.293-1.061%2C0L8%2C6.938L4.53%2C3.469c-0.292-0.293-0.767-0.293-1.061%2C0C3.177%2C3.762%2C3.177%2C4.238%2C3.471%2C4.532L6.939%2C8l-3.469%2C3.468c-0.294%2C0.293-0.294%2C0.768-0.001%2C1.062C3.616%2C12.678%2C3.81%2C12.75%2C4%2C12.75s0.384-0.072%2C0.53-0.219L8%2C9.062l3.47%2C3.469c0.147%2C0.146%2C0.339%2C0.219%2C0.53%2C0.219c0.192%2C0%2C0.384-0.072%2C0.53-0.219C12.823%2C12.236%2C12.824%2C11.762%2C12.529%2C11.469z%22%2F%3E%3C%2Fsvg%3E)`;
        }
        this.renderer.setStyle(this.nativeElement, 'backgroundImage', urlStr);
    }
    handlePassword() {
        // 密码框情况下，默认关闭autocomplete，避免浏览器弹出记住密码提示框引起的安全问题
        if (TiBrowser.isChrome() && this.nativeElement.type === 'password' &&
            this.nativeElement.autocomplete !== 'on') {
            this.pwdHackEle = this.renderer.createElement('input');
            this.tiRenderer.setAttributes(this.pwdHackEle, { type: 'text', tabindex: -1, autocomplete: 'off' });
            this.renderer.addClass(this.pwdHackEle, 'ti3-password-hack-input');
            // 插入一个input元素，阻止密码框前面的input联想用户名
            this.renderer.insertBefore(this.nativeElement.parentElement, this.pwdHackEle, this.nativeElement);
        }
    }
    // 控制clear是否显示，文本框为空时不显示，有内容时才显示
    controlClearShow(value) {
        if (!this.hasClear) {
            return;
        }
        const lastIsShowClear = this.isShowClear;
        this.isShowClear = (Util.isString(value) && value !== '');
        // 与上次状态相同，则返回
        if (this.isShowClear === lastIsShowClear) {
            return;
        }
        // 叉号特殊处理，1)初始化和监听是否显示
        if (this.isShowClear) {
            this.setClearBackgroud(false);
        }
        else {
            this.renderer.removeStyle(this.nativeElement, 'background');
            this.lastIsHover = undefined;
        }
    }
    // 控制eye是否显示，
    controlEyeShow() {
        if (!this.isPassword) {
            return;
        }
        this.setClearBackgroud(false);
        this.nativeElement.type = this.isVisible ? 'text' : 'password';
    }
    // 判断事件是否在清除按钮区域
    isIconField(event) {
        const iconWidth = this.isPassword ? TiTextComponent.PASSWORD_WIDTH : TiTextComponent.CLEAR_WIDTH;
        return event.clientX - this.nativeElement.getBoundingClientRect().left >
            this.nativeElement.getBoundingClientRect().width - iconWidth;
    }
}
TiTextComponent.CLEAR_WIDTH = 26; // 常量，清除按钮区域宽度
TiTextComponent.PASSWORD_WIDTH = 36; // 常量，眼睛按钮区域宽度
TiTextComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiText]',
                template: '',
                host: {
                    '[class.ti3-text-input-show-icon]': 'isShowClear || isPassword',
                    '[class.ti3-text-input-show-clear]': 'isShowClear',
                    '[class.ti3-text-input-show-password]': 'isPassword',
                    '[class.ti3-text-input-noborder]': 'isNoBorder',
                    '(focus)': 'handleFocus()'
                },
                styles: ["::ng-deep :root{--ti-text-clear-width:26px;--ti-text-password-width:36px}:host[tiText]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);flood-color:var(--ti-input-clear-color);font-size:var(--ti-input-font-size);height:var(--ti-input-height);lighting-color:var(--ti-input-clear-color-hover);line-height:normal;outline:none;padding:0 var(--ti-input-padding-horizontal);stop-color:var(--ti-input-clear-color-disabled);vertical-align:middle}:host[tiText].ti3-text-input-show-icon{background-repeat:no-repeat;background-size:16px}:host[tiText].ti3-text-input-show-clear{background-position:center right 5px;padding-right:var(--ti-text-clear-width)!important}:host[tiText].ti3-text-input-show-password{background-position:center right 10px;padding-right:var(--ti-text-password-width)!important}:host[tiText].ti3-text-input-noborder{border:0;box-shadow:none;outline:0}:host[tiText]:not([disabled]):not([noborder]).ti3-text-input-show-icon.ti3-text-clear-active:hover{cursor:pointer}:host[tiText]:not([disabled]):not([noborder]):hover{border:1px solid var(--ti-input-border-color-hover)}:host[tiText]:not([disabled]):not([noborder]):focus{border:1px solid var(--ti-input-border-color-focus)}:host[tiText][disabled]:disabled{background-color:var(--ti-input-bg-color-disabled);border:1px solid var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}:host[tiText][disabled]:disabled.ti3-text-input-noborder{border:0}.ti3-password-hack-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}:host[tiText]{transition:border-color .15s}:host[tiText].ti3-text-input-show-icon:focus{transition:transform .15s cubic-bezier(.4,0,.2,1),font-size .15s cubic-bezier(.4,0,.2,1)}:host[tiText]:hover:not(:focus){transition:border-color .2s}"]
            },] }
];
TiTextComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: TiRenderer },
    { type: NgControl },
    { type: NgZone }
];
TiTextComponent.propDecorators = {
    clear: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlUZXh0Q29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL2NvbXBvbmVudHMvdGV4dC9UaVRleHRDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFFVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFHTixNQUFNLEVBQ04sU0FBUyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFZLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUU1RDs7Ozs7R0FLRztBQWNILE1BQU0sT0FBTyxlQUFnQixTQUFRLG9CQUFvQjtJQW9DckQsWUFBWSxVQUFzQixFQUFFLFFBQW1CLEVBQ25DLFVBQXNCLEVBQVUsV0FBc0IsRUFBVSxJQUFZO1FBQzVGLEtBQUssQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFEWixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQVc7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFRO1FBbENoRzs7V0FFRztRQUNnQixVQUFLLEdBQTZCLElBQUksWUFBWSxFQUFFLENBQUM7UUFpQnhFOzs7O1dBSUc7UUFDSSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzNCLGlCQUFZLEdBQVksSUFBSSxDQUFDLENBQUMsV0FBVztRQUN6QyxhQUFRLEdBQVksS0FBSyxDQUFDLENBQUMsVUFBVTtRQUVyQyxnQkFBVyxHQUFZLFNBQVMsQ0FBQyxDQUFDLGVBQWU7UUFDakQsaUJBQVksR0FBWSxTQUFTLENBQUMsQ0FBQyxjQUFjO1FB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RSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7SUFDckUsQ0FBQzs7QUFuU3VCLDJCQUFXLEdBQVcsRUFBRSxDQUFDLENBQUMsY0FBYztBQUN4Qyw4QkFBYyxHQUFXLEVBQUUsQ0FBQyxDQUFDLGNBQWM7O1lBZnRFLFNBQVMsU0FBQztnQkFDUCw4Q0FBOEM7Z0JBQzlDLFFBQVEsRUFBRSxVQUFVO2dCQUNwQixRQUFRLEVBQUUsRUFBRTtnQkFFWixJQUFJLEVBQUU7b0JBQ0Ysa0NBQWtDLEVBQUUsMkJBQTJCO29CQUMvRCxtQ0FBbUMsRUFBRSxhQUFhO29CQUNsRCxzQ0FBc0MsRUFBRSxZQUFZO29CQUNwRCxpQ0FBaUMsRUFBRSxZQUFZO29CQUMvQyxTQUFTLEVBQUUsZUFBZTtpQkFDN0I7O2FBQ0o7OztZQS9CRyxVQUFVO1lBTVYsU0FBUztZQUlKLFVBQVU7WUFGVixTQUFTO1lBTmQsTUFBTTs7O29CQW9DTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCxcclxuICAgIERvQ2hlY2ssXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgTmdab25lLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgT25Jbml0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgUmVuZGVyZXIyXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgVGlCcm93c2VyLCBUaUtleW1hcCwgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaVJlbmRlcmVyIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcmVuZGVyZXIvVGlSZW5kZXJlcic7XHJcbmltcG9ydCB7IFRpQXV0b2ZvY3VzQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9UaUJhc2VNb2R1bGUnO1xyXG5cclxuLyoqXHJcbiAqIOacrOe7hOS7tuWfuuS6juWOn+eUn2lucHV05qCH562+6L+b6KGM5omp5bGV77yM5Y6f55SfaW5wdXTliqAgdGlUZXh0IOWxnuaAp+WNs+S4unRleHTnu4Tku7YsXHJcbiAqIOWOn+eUn2lucHV055qE5omA5pyJ5bGe5oCn5Lul5Y+KIEFuZ3VsYXIg55qE5ZCE56eN5bGe5oCn5oyH5Luk6YO95Y+v5Lul5L2/55So44CCXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55M2RlbW8vIy90ZXh0L3RleHQtYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gICAgc2VsZWN0b3I6ICdbdGlUZXh0XScsXHJcbiAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICBzdHlsZVVybHM6IFsndGV4dC5sZXNzJ10sXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJ1tjbGFzcy50aTMtdGV4dC1pbnB1dC1zaG93LWljb25dJzogJ2lzU2hvd0NsZWFyIHx8IGlzUGFzc3dvcmQnLFxyXG4gICAgICAgICdbY2xhc3MudGkzLXRleHQtaW5wdXQtc2hvdy1jbGVhcl0nOiAnaXNTaG93Q2xlYXInLFxyXG4gICAgICAgICdbY2xhc3MudGkzLXRleHQtaW5wdXQtc2hvdy1wYXNzd29yZF0nOiAnaXNQYXNzd29yZCcsXHJcbiAgICAgICAgJ1tjbGFzcy50aTMtdGV4dC1pbnB1dC1ub2JvcmRlcl0nOiAnaXNOb0JvcmRlcicsXHJcbiAgICAgICAgJyhmb2N1cyknOiAnaGFuZGxlRm9jdXMoKSdcclxuICAgIH1cclxufSlcclxuZXhwb3J0IGNsYXNzIFRpVGV4dENvbXBvbmVudCBleHRlbmRzIFRpQXV0b2ZvY3VzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3kge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ0xFQVJfV0lEVEg6IG51bWJlciA9IDI2OyAvLyDluLjph4/vvIzmuIXpmaTmjInpkq7ljLrln5/lrr3luqZcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFBBU1NXT1JEX1dJRFRIOiBudW1iZXIgPSAzNjsgLy8g5bi46YeP77yM55y8552b5oyJ6ZKu5Yy65Z+f5a695bqmXHJcbiAgICAvKipcclxuICAgICAqIGNsZWFy5LqL5Lu277ya5b2T5byA5ZCv5riF6Zmk5Yqf6IO95pe2KOS9v+eUqGNsZWFyYWJsZeWxnuaApynvvIzngrnlh7vliKDpmaTmjInpkq7op6blj5FcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IGNsZWFyOiBFdmVudEVtaXR0ZXI8TW91c2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiBhdXRvQ29tcGxldGUg5Lmf5L2/55So5LqG6K+l5Y+Y6YePXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0NsZWFyQWN0aXZlOiBib29sZWFuO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICogYXV0b0NvbXBsZXRlIOS5n+S9v+eUqOS6huivpeWPmOmHj1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXNTaG93Q2xlYXI6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzTm9Cb3JkZXI6IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiDliJ3lp4vojrflj5bmlofmnKzmoYbnsbvlnotcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzUGFzc3dvcmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgaXNGaXJzdEZvY3VzOiBib29sZWFuID0gdHJ1ZTsgLy8g5piv5ZCm5Li656ys5LiA5qyh6IGa54SmXHJcbiAgICBwcml2YXRlIGhhc0NsZWFyOiBib29sZWFuID0gZmFsc2U7IC8vIOaYr+WQpuaciea4hemZpOWKn+iDvVxyXG4gICAgcHJpdmF0ZSBwd2RIYWNrRWxlOiBIVE1MSW5wdXRFbGVtZW50OyAvLyDlvZPnsbvlnovkuLpwYXNzd29yZOaXtu+8jOWKqOaAgeeUn+aIkOaUvuWcqHBhc3N3b3Jk5paH5pys5qGG5YmN55qEaW5wdXTlhYPntKBcclxuICAgIHByaXZhdGUgbGFzdElzSG92ZXI6IGJvb2xlYW4gPSB1bmRlZmluZWQ7IC8vIOacgOWQjuS4gOasoee7mOWItuWPieWPt+eahOeKtuaAgeOAglxyXG4gICAgcHJpdmF0ZSBsYXN0RGlzYWJsZWQ6IGJvb2xlYW4gPSB1bmRlZmluZWQ7IC8vIOacgOWQjuS4gOasoeWPieWPt+aYr+WQpuemgeeUqOOAglxyXG4gICAgcHJpdmF0ZSBpc1Zpc2libGU6IGJvb2xlYW4gPSBmYWxzZTsgLy8g5a+G56CB5piv5ZCm5Y+v6KeB77yM6buY6K6k5LiN5Y+v6KeBXHJcbiAgICBwcml2YXRlIGlzTm9FeWU6IGJvb2xlYW4gPSBmYWxzZTsgLy8g55y8552b5piv5ZCm5LiN5pi+56S677yM6buY6K6k5pi+56S6XHJcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50UmVmOiBFbGVtZW50UmVmLCByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0aVJlbmRlcmVyOiBUaVJlbmRlcmVyLCBwcml2YXRlIGZvcm1Db250cm9sOiBOZ0NvbnRyb2wsIHByaXZhdGUgem9uZTogTmdab25lKSB7XHJcbiAgICAgICAgc3VwZXIoZWxlbWVudFJlZiwgcmVuZGVyZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5pc05vRXllID0gdGhpcy5uYXRpdmVFbGVtZW50Lmhhc0F0dHJpYnV0ZSgnbm9leWUnKTtcclxuICAgICAgICB0aGlzLmlzUGFzc3dvcmQgPSB0aGlzLm5hdGl2ZUVsZW1lbnQudHlwZSA9PT0gJ3Bhc3N3b3JkJyAmJiAhdGhpcy5pc05vRXllO1xyXG4gICAgICAgIHRoaXMuaGFzQ2xlYXIgPSB0aGlzLm5hdGl2ZUVsZW1lbnQuaGFzQXR0cmlidXRlKCdjbGVhcmFibGUnKSAmJiAhdGhpcy5pc1Bhc3N3b3JkO1xyXG4gICAgICAgIHRoaXMuaXNOb0JvcmRlciA9IHRoaXMubmF0aXZlRWxlbWVudC5oYXNBdHRyaWJ1dGUoJ25vYm9yZGVyJyk7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+WMluazqOWGjOS6i+S7tlxyXG4gICAgICAgIHRoaXMuaW5pdEZuKCk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVQYXNzd29yZCgpO1xyXG5cclxuICAgICAgICAvLyBDaHJvbWXkuIvovpPlhaXmoYbmnInml7blh7rnjrDoh6rliqjogZTmg7Mo6K+l6Zeu6aKY5Ye6546w5peg6KeE5b6L5Y+v5a+777yM5q+U6L6D5aWH5oCqKe+8jFxyXG4gICAgICAgIC8vIOWwhuWFtmF1dG9jb21wbGV0Zee9ruS4um9mZuWPr+inhOmBv+atpOmXrumimFxyXG4gICAgICAgIC8vIOS5i+WQjmZpcmVmb3jlj4pJRTEx5Lmf5Ye6546w57G75Ly86Zeu6aKY77yM5omA5Lul5LiN5Yy65YiG5rWP6KeI5Zmo5beu5byC77yM57uf5LiA5re75Yqg6L+Z5bGC5aSE55CGXHJcbiAgICAgICAgaWYgKHRoaXMubmF0aXZlRWxlbWVudC50eXBlID09PSAndGV4dCcgJiYgdGhpcy5uYXRpdmVFbGVtZW50LmF1dG9jb21wbGV0ZSAhPT0gJ29uJykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLm5hdGl2ZUVsZW1lbnQsICdhdXRvY29tcGxldGUnLCAnb2ZmJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDnlLHkuo7lnKh2YWx1ZUNoYW5nZXPkuK3nm5HlkKzkuI3liLDliqjmgIHooajljZXkuK3mlofmnKzmoYbnmoTliJ3lp4vlgLxcclxuICAgICAgICAvLyDmiYDku6XmraTlpITlr7nliJ3lp4vlgLzopoHlgZrljZXni6zlpITnkIZcclxuICAgICAgICB0aGlzLmNvbnRyb2xDbGVhclNob3codGhpcy5uYXRpdmVFbGVtZW50LnZhbHVlKTtcclxuXHJcbiAgICAgICAgLy8g5paH5pys5qGG55qE5YC85Y+R55Sf5Y+Y5YyW5pe26Kem5Y+RXHJcbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbENsZWFyU2hvdyh2YWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+iuvue9rmV5ZeWbvuagh1xyXG4gICAgICAgIHRoaXMuY29udHJvbEV5ZVNob3coKTtcclxuICAgIH1cclxuICAgIG5nRG9DaGVjaygpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBkaXNhYmxlZDogYm9vbGVhbiA9IHRoaXMubmF0aXZlRWxlbWVudC5kaXNhYmxlZDtcclxuICAgICAgICAvLyDkuI7kuIrmrKFkaXNhYmxlZOeKtuaAgeebuOWQjO+8jOWImei/lOWbnlxyXG4gICAgICAgIGlmICh0aGlzLmxhc3REaXNhYmxlZCA9PT0gZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlj4nlj7fnibnmrorlpITnkIbvvIwy77yJ56aB55SoXHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93Q2xlYXIgfHwgdGhpcy5pc1Bhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIGlmIChkaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDbGVhckJhY2tncm91ZChudWxsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFzdERpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHsgLy8g5LuO56aB55So5pS55Li66Z2e56aB55SoXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldENsZWFyQmFja2dyb3VkKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFzdERpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgLy8g6ZSA5q+B57uE5Lu25pe26ZyA6KaB5bCG5YaF6YOo55Sf5oiQZG9t5Lmf56e76ZmkXHJcbiAgICAgICAgaWYgKHRoaXMucHdkSGFja0VsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMucmVuZGVyZXIucGFyZW50Tm9kZSh0aGlzLnB3ZEhhY2tFbGUpLCB0aGlzLnB3ZEhhY2tFbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGhhbmRsZUZvY3VzKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIElF5ZKM54Gr54uQ5rWP6KeI5Zmo5Zyo6aaW5qyhYXV0b2ZvdWN1c+iBmueEpuaXtuS8muWwhuWFieagh+enu+WIsOaWh+Wtl+i1t+Wni+S9jee9ru+8jOeUqOaIt+S9k+mqjOS4jeWlvVxyXG4gICAgICAgIC8vIOmcgOimgeaJi+WKqOiuvue9ruWFieagh+S9jee9ruWIsOihjOWwvlxyXG4gICAgICAgIGlmICh0aGlzLmlzRmlyc3RGb2N1cyAmJiB0aGlzLm5hdGl2ZUVsZW1lbnQuYXV0b2ZvY3VzICYmXHJcbiAgICAgICAgICAgIChUaUJyb3dzZXIuaXNGaXJlZm94KCkgfHwgVGlCcm93c2VyLmlzSUUoKSkpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LnNldFNlbGVjdGlvblJhbmdlKHRoaXMubmF0aXZlRWxlbWVudC52YWx1ZS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQudmFsdWUubGVuZ3RoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0ZpcnN0Rm9jdXMgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRGbigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4geyAvLyDpgb/lhY3kuI3lgZzop6blj5Hlj5jljJbmo4DmtYtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5uYXRpdmVFbGVtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5oYW5kbGVNb3VzZW1vdmUpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLm5hdGl2ZUVsZW1lbnQsICdtb3VzZW91dCcsIHRoaXMuaGFuZGxlTW91c2VvdXQpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWRvd24nLCB0aGlzLmhhbmRsZU1vdXNlZG93bik7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgdGhpcy5oYW5kbGVDbGljayk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOm8oOagh+enu+WFpea4hemZpOaMiemSruWMuuWfn+aXtu+8jOe7meWuv+S4u+WFg+e0oOa3u+WKoHRpLXRleHQtY2xlYXItYWN0aXZl5qC35byPXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoYW5kbGVNb3VzZW1vdmUgPSAoZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkID0+IHtcclxuICAgICAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmRpc2FibGVkIHx8ICF0aGlzLmlzU2hvd0NsZWFyICYmICF0aGlzLmlzUGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6byg5qCH56e75YWl5riF6Zmk5oyJ6ZKu5Yy65Z+f5pe277yM57uZ5a6/5Li75YWD57Sg5re75YqgdGktdGV4dC1jbGVhci1hY3RpdmXmoLflvI87XHJcbiAgICAgICAgLy8g5ZCm5YiZ5Y675o6JdGktdGV4dC1jbGVhci1hY3RpdmXmoLflvI9cclxuICAgICAgICB0aGlzLmlzQ2xlYXJBY3RpdmUgPSB0aGlzLmlzSWNvbkZpZWxkKGV2ZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5pc0NsZWFyQWN0aXZlID8gdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLm5hdGl2ZUVsZW1lbnQsICd0aTMtdGV4dC1jbGVhci1hY3RpdmUnKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLm5hdGl2ZUVsZW1lbnQsICd0aTMtdGV4dC1jbGVhci1hY3RpdmUnKTtcclxuXHJcbiAgICAgICAgLy8g5a+G56CB57G75Z6L5Y+q6ZyA6KaB6K6+572u5oKs5rWu5pe25omL5Z6L5qC35byPXHJcbiAgICAgICAgaWYgKHRoaXMuaXNQYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlj4nlj7fnibnmrorlpITnkIbvvIwz77yJaG92ZXJcclxuICAgICAgICB0aGlzLmlzQ2xlYXJBY3RpdmUgPyB0aGlzLnNldENsZWFyQmFja2dyb3VkKHRydWUpIDogdGhpcy5zZXRDbGVhckJhY2tncm91ZChmYWxzZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGhhbmRsZU1vdXNlb3V0ID0gKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMubmF0aXZlRWxlbWVudC5kaXNhYmxlZCB8fCAhdGhpcy5pc1Nob3dDbGVhcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWPieWPt+eJueauiuWkhOeQhu+8jDPvvIlob3ZlclxyXG4gICAgICAgIHRoaXMuc2V0Q2xlYXJCYWNrZ3JvdWQoZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5YiH5o2i5a+G56CB5Y+v6KeB5LiN5Y+v6KeB5pe277yM6L6T5YWl5qGG6ZyA5aSE5LqO5aSx54Sm54q25oCBXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoYW5kbGVNb3VzZWRvd24gPSAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmRpc2FibGVkIHx8ICF0aGlzLmlzUGFzc3dvcmQgfHwgIXRoaXMuaXNJY29uRmllbGQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIC8vIOiBmueEpuWIsOWPr+i+k+WFpeWMuuWfn++8jOWGjeeCueWHu+ecvOedm+Wbvuagh+aXtu+8jOi+k+WFpeahhuW6lOWkseeEplxyXG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmJsdXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaXNIb3ZlciB0cnVl5qCH56S65oKs5rWu77yMZmFsc2XmoIfnpLrpnZ7mgqzmta7vvIxudWxs5qCH56S656aB55So77yMdW5kZWZpbmRlZOagh+ekuuS4jeeUu+WPieWPt+OAglxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgc2V0Q2xlYXJCYWNrZ3JvdWQoaXNIb3ZlcjogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIC8vIOWmguaenOi3n+S4iuasoeS4gOagt++8jOWImei/lOWbnuOAglxyXG4gICAgICAgIGlmICh0aGlzLmxhc3RJc0hvdmVyID09PSBpc0hvdmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RJc0hvdmVyID0gaXNIb3ZlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb2xvclN0cjogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgaWYgKFV0aWwuc3VwcG9ydHNDc3NWYXJzKCkpIHtcclxuICAgICAgICAgICAgLy8gQ2hyb21l562J5pSv5oyBQ1NTVmFy55qE5rWP6KeI5Zmo77yM5q2j5bi45pON5L2cLCAg5LuOQ1NTVmFy5Y+Y6YeP5Lit5Y+W5Ye66aKc6Imy44CCXHJcbiAgICAgICAgICAgIGNvbnN0IHZhck5hbWU6IHN0cmluZyA9XHJcbiAgICAgICAgICAgICAgICBpc0hvdmVyID09PSBmYWxzZSA/ICctLXRpLWlucHV0LWNsZWFyLWNvbG9yJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgaXNIb3ZlciA9PT0gdHJ1ZSA/ICctLXRpLWlucHV0LWNsZWFyLWNvbG9yLWhvdmVyJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSG92ZXIgPT09IG51bGwgPyAnLS10aS1pbnB1dC1jbGVhci1jb2xvci1kaXNhYmxlZCcgOiAnJztcclxuICAgICAgICAgICAgLy8g5L+u5aSNU1NS5oql6ZSZ77yaRVJST1IgUmVmZXJlbmNlRXJyb3I6IGdldENvbXB1dGVkU3R5bGUgaXMgbm90IGRlZmluZWRcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBnZXRDb21wdXRlZFN0eWxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgY29sb3JTdHIgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZ2V0UHJvcGVydHlWYWx1ZSh2YXJOYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIElF5ZKM5L2O54mIRWRnZeS4jeaUr+aMgUNTU1ZhcueahOa1j+iniOWZqO+8jOS7juS4gOS4qkNTU+agt+W8j+S4reWPluWHuuminOiJsuOAglxyXG4gICAgICAgICAgICBjb25zdCBzdHlsZU5hbWU6IHN0cmluZyA9XHJcbiAgICAgICAgICAgICAgICBpc0hvdmVyID09PSBmYWxzZSA/ICdmbG9vZC1jb2xvcicgOlxyXG4gICAgICAgICAgICAgICAgICAgIGlzSG92ZXIgPT09IHRydWUgPyAnbGlnaHRpbmctY29sb3InIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNIb3ZlciA9PT0gbnVsbCA/ICdzdG9wLWNvbG9yJyA6ICcnO1xyXG4gICAgICAgICAgICAvLyDkv67lpI1TU1LmiqXplJnvvJpFUlJPUiBSZWZlcmVuY2VFcnJvcjogZ2V0Q29tcHV0ZWRTdHlsZSBpcyBub3QgZGVmaW5lZFxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGdldENvbXB1dGVkU3R5bGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICBjb2xvclN0ciA9IGdldENvbXB1dGVkU3R5bGUodGhpcy5uYXRpdmVFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKHN0eWxlTmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29sb3JTdHIgPSBjb2xvclN0ci50cmltKCkucmVwbGFjZSgnIycsICclMjMnKTsgLy8gVVJM57yW56CBXHJcbiAgICAgICAgbGV0IHVybFN0cjogc3RyaW5nO1xyXG4gICAgICAgIGlmICh0aGlzLmlzUGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgdXJsU3RyID0gdGhpcy5pc1Zpc2libGUgPyBgdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB2ZXJzaW9uPSUyMjEuMSUyMiUyMHhtbG5zPSUyMmh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJTIyJTIwd2lkdGg9JTIyMzIlMjIlMjBoZWlnaHQ9JTIyMzIlMjIlMjB2aWV3Qm94PSUyMjAlMjAwJTIwMzIlMjAzMiUyMiUzRSUzQ3BhdGglMjBmaWxsJTNEJTIyJHtjb2xvclN0cn0lMjIlMjBkPSUyMk0xNiUyMDYuNGM5LjQlMjAwJTIwMTYlMjA2LjQlMjAxNiUyMDkuNiUyMDAlMjAzLTYuNiUyMDkuNi0xNiUyMDkuNi05LjIlMjAwLTE2LTYuNC0xNi05LjZzNi44LTkuNiUyMDE2LTkuNnpNMTYlMjA4LjJjLTQuMiUyMDAtNy44JTIwMy42LTcuOCUyMDcuOCUyMDAlMjA0LjQlMjAzLjQlMjA3LjglMjA3LjglMjA3LjglMjA0LjIlMjAwJTIwNy44LTMuNiUyMDcuOC03LjglMjAwLTQuNC0zLjYtNy44LTcuOC03Ljh6TTE2JTIwMTFjMi44JTIwMCUyMDUlMjAyLjIlMjA1JTIwNXMtMi4yJTIwNS01JTIwNS01LTIuMi01LTVjMC0yLjglMjAyLjItNSUyMDUtNXolMjIlM0UlM0MvcGF0aCUzRSUzQy9zdmclM0UlMEEpYCA6XHJcbiAgICAgICAgICAgICAgICBgdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB2ZXJzaW9uPSUyMjEuMSUyMiUyMHhtbG5zPSUyMmh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJTIyJTIwd2lkdGg9JTIyMzIlMjIlMjBoZWlnaHQ9JTIyMzIlMjIlM0UlM0NwYXRoJTIwZmlsbCUzRCUyMiR7Y29sb3JTdHJ9JTIyJTIwZD0lMjJNMS42JTIwMi45MjVjMC42LTAuNiUyMDEuNC0wLjYlMjAxLjglMjAwdjBsMjUuNiUyMDI0LjJjMC4yJTIwMC4yJTIwMC40JTIwMC42JTIwMC40JTIwMXMtMC4yJTIwMC42LTAuNCUyMDFjLTAuMiUyMDAuMi0wLjYlMjAwLjQtMSUyMDAuNHMtMC44LTAuMi0xLTAuNHYwbC01LTUuMmMtMiUyMDAuNi00JTIwMS02JTIwMS05LjIlMjAwLTE2LTYuNi0xNi05LjglMjAwLTEuOCUyMDItNC42JTIwNS40LTYuNnYwbC0zLjYtMy44Yy0wLjYtMC40LTAuNi0xLjItMC4yLTEuOHpNOSUyMDExLjcyNWMtMC40JTIwMS0wLjYlMjAyLjItMC42JTIwMy40JTIwMCUyMDQuNCUyMDMuNCUyMDglMjA3LjglMjA4JTIwMS40JTIwMCUyMDIuOC0wLjQlMjAzLjgtMXYwbC0yLjQtMi40Yy0wLjQlMjAwLjItMSUyMDAuNC0xLjYlMjAwLjQtMi44JTIwMC01LTIuMi01LTUlMjAwLTAuNCUyMDAtMC44JTIwMC4yLTEuMnYwbC0yLjItMi4yek0xNiUyMDUuMzI1YzkuNCUyMDAlMjAxNiUyMDYuNiUyMDE2JTIwOS44JTIwMCUyMDEuOC0yJTIwNC42LTUuNiUyMDYuOHYwbC0zLjQtMy4yYzAuNi0xJTIwMC44LTIuMiUyMDAuOC0zLjQlMjAwLTQuNC0zLjQtOC03LjgtOC0xLjQlMjAwLTIuOCUyMDAuNC00JTIwMS4ydjAlMjAwbC0yLTJjMi0xJTIwNC0xLjIlMjA2LTEuMnpNMTYlMjA5LjkyNWMyLjglMjAwJTIwNSUyMDIuMiUyMDUlMjA1JTIwMCUyMDAuNCUyMDAlMjAxLTAuMiUyMDEuNHYwbC02LjYtNmMwLjYtMC4yJTIwMS4yLTAuNCUyMDEuOC0wLjR6JTIyJTNFJTNDL3BhdGglM0UlM0Mvc3ZnJTNFKWBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB1cmxTdHIgPSBgdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB2ZXJzaW9uJTNEJTIyMS4xJTIyJTIweG1sbnMlM0QlMjJodHRwJTNBJTJGJTJGd3d3LnczLm9yZyUyRjIwMDAlMkZzdmclMjIlMjB3aWR0aCUzRCUyMjE2cHglMjIlMjBoZWlnaHQlM0QlMjIxNnB4JTIyJTNFJTNDcGF0aCUyMGZpbGwlM0QlMjIke2NvbG9yU3RyfSUyMiUyMGQlM0QlMjJNMTIuNTI5JTJDMTEuNDY5TDkuMDYxJTJDOGwzLjQ2OS0zLjQ2OWMwLjI5NC0wLjI5NCUyQzAuMjk1LTAuNzY4JTJDMC4wMDEtMS4wNjJjLTAuMjkzLTAuMjkzLTAuNzY5LTAuMjkzLTEuMDYxJTJDMEw4JTJDNi45MzhMNC41MyUyQzMuNDY5Yy0wLjI5Mi0wLjI5My0wLjc2Ny0wLjI5My0xLjA2MSUyQzBDMy4xNzclMkMzLjc2MiUyQzMuMTc3JTJDNC4yMzglMkMzLjQ3MSUyQzQuNTMyTDYuOTM5JTJDOGwtMy40NjklMkMzLjQ2OGMtMC4yOTQlMkMwLjI5My0wLjI5NCUyQzAuNzY4LTAuMDAxJTJDMS4wNjJDMy42MTYlMkMxMi42NzglMkMzLjgxJTJDMTIuNzUlMkM0JTJDMTIuNzVzMC4zODQtMC4wNzIlMkMwLjUzLTAuMjE5TDglMkM5LjA2MmwzLjQ3JTJDMy40NjljMC4xNDclMkMwLjE0NiUyQzAuMzM5JTJDMC4yMTklMkMwLjUzJTJDMC4yMTljMC4xOTIlMkMwJTJDMC4zODQtMC4wNzIlMkMwLjUzLTAuMjE5QzEyLjgyMyUyQzEyLjIzNiUyQzEyLjgyNCUyQzExLjc2MiUyQzEyLjUyOSUyQzExLjQ2OXolMjIlMkYlM0UlM0MlMkZzdmclM0UpYDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLm5hdGl2ZUVsZW1lbnQsICdiYWNrZ3JvdW5kSW1hZ2UnLCB1cmxTdHIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogIEBpZ25vcmVcclxuICAgICAqIOW9k+WcqOa4hemZpOaMiemSruWMuuWfn+eCueWHu+aXtu+8jOa4heepuui+k+WFpeahhuWGheWuuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaGFuZGxlQ2xpY2sgPSAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+e1xyXG4gICAgICAgIGlmICh0aGlzLm5hdGl2ZUVsZW1lbnQuZGlzYWJsZWQgfHwgIXRoaXMuaXNTaG93Q2xlYXIgJiYgIXRoaXMuaXNQYXNzd29yZCB8fCAhdGhpcy5pc0ljb25GaWVsZChldmVudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93Q2xlYXIpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLm5hdGl2ZUVsZW1lbnQsICd2YWx1ZScsICcnKTtcclxuICAgICAgICAgICAgVXRpbC50cmlnZ2VyKHRoaXMubmF0aXZlRWxlbWVudCwgJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhci5lbWl0KGV2ZW50KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLy8g54K55Ye75riF6Zmk5oyJ6ZKu5ZCO5bu25pe25omN6IO96IGa54Sm5YWD57SgXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNQYXNzd29yZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzVmlzaWJsZSA9ICF0aGlzLmlzVmlzaWJsZTtcclxuICAgICAgICAgICAgdGhpcy5sYXN0SXNIb3ZlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sRXllU2hvdygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhbmRsZVBhc3N3b3JkKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOWvhueggeahhuaDheWGteS4i++8jOm7mOiupOWFs+mXrWF1dG9jb21wbGV0Ze+8jOmBv+WFjea1j+iniOWZqOW8ueWHuuiusOS9j+WvhueggeaPkOekuuahhuW8lei1t+eahOWuieWFqOmXrumimFxyXG4gICAgICAgIGlmIChUaUJyb3dzZXIuaXNDaHJvbWUoKSAmJiB0aGlzLm5hdGl2ZUVsZW1lbnQudHlwZSA9PT0gJ3Bhc3N3b3JkJyAmJlxyXG4gICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuYXV0b2NvbXBsZXRlICE9PSAnb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHdkSGFja0VsZSA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgdGhpcy50aVJlbmRlcmVyLnNldEF0dHJpYnV0ZXModGhpcy5wd2RIYWNrRWxlLCB7IHR5cGU6ICd0ZXh0JywgdGFiaW5kZXg6IC0xLCBhdXRvY29tcGxldGU6ICdvZmYnIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMucHdkSGFja0VsZSwgJ3RpMy1wYXNzd29yZC1oYWNrLWlucHV0Jyk7XHJcbiAgICAgICAgICAgIC8vIOaPkuWFpeS4gOS4qmlucHV05YWD57Sg77yM6Zi75q2i5a+G56CB5qGG5YmN6Z2i55qEaW5wdXTogZTmg7PnlKjmiLflkI1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5pbnNlcnRCZWZvcmUodGhpcy5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQsIHRoaXMucHdkSGFja0VsZSwgdGhpcy5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5o6n5Yi2Y2xlYXLmmK/lkKbmmL7npLrvvIzmlofmnKzmoYbkuLrnqbrml7bkuI3mmL7npLrvvIzmnInlhoXlrrnml7bmiY3mmL7npLpcclxuICAgIHByaXZhdGUgY29udHJvbENsZWFyU2hvdyh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc0NsZWFyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbGFzdElzU2hvd0NsZWFyOiBib29sZWFuID0gdGhpcy5pc1Nob3dDbGVhcjtcclxuICAgICAgICB0aGlzLmlzU2hvd0NsZWFyID0gKFV0aWwuaXNTdHJpbmcodmFsdWUpICYmIHZhbHVlICE9PSAnJyk7XHJcbiAgICAgICAgLy8g5LiO5LiK5qyh54q25oCB55u45ZCM77yM5YiZ6L+U5ZueXHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93Q2xlYXIgPT09IGxhc3RJc1Nob3dDbGVhcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlj4nlj7fnibnmrorlpITnkIbvvIwxKeWIneWni+WMluWSjOebkeWQrOaYr+WQpuaYvuekulxyXG4gICAgICAgIGlmICh0aGlzLmlzU2hvd0NsZWFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2xlYXJCYWNrZ3JvdWQoZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlU3R5bGUodGhpcy5uYXRpdmVFbGVtZW50LCAnYmFja2dyb3VuZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RJc0hvdmVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDmjqfliLZleWXmmK/lkKbmmL7npLrvvIxcclxuICAgIHByaXZhdGUgY29udHJvbEV5ZVNob3coKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldENsZWFyQmFja2dyb3VkKGZhbHNlKTtcclxuICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQudHlwZSA9IHRoaXMuaXNWaXNpYmxlID8gJ3RleHQnIDogJ3Bhc3N3b3JkJztcclxuICAgIH1cclxuXHJcbiAgICAvLyDliKTmlq3kuovku7bmmK/lkKblnKjmuIXpmaTmjInpkq7ljLrln59cclxuICAgIHByaXZhdGUgaXNJY29uRmllbGQoZXZlbnQ6IE1vdXNlRXZlbnQpOiBib29sZWFuIHtcclxuICAgICAgICBjb25zdCBpY29uV2lkdGg6IG51bWJlciA9IHRoaXMuaXNQYXNzd29yZCA/IFRpVGV4dENvbXBvbmVudC5QQVNTV09SRF9XSURUSCA6IFRpVGV4dENvbXBvbmVudC5DTEVBUl9XSURUSDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGV2ZW50LmNsaWVudFggLSB0aGlzLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCA+XHJcbiAgICAgICAgICAgIHRoaXMubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAtIGljb25XaWR0aDtcclxuICAgIH1cclxufVxyXG4iXX0=