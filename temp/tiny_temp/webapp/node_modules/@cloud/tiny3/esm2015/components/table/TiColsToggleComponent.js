import { Component, ElementRef, Input, Renderer2, ViewChild } from '@angular/core';
import { TiTableComponent } from './TiTableComponent';
import { TiColsToggleDropComponent } from './TiColsToggleDropComponent';
import { TiSelectComponent } from '../select/TiSelectModule';
import { TiLocale } from '../../locale/TiLocaleModule';
// 下面注释，可以避免编译lib时正则报错。原理未知，副作用未知。
// @dynamic
/**
 * TiColsToggle 控制列动态隐藏/显示的组件
 *
 * ti-cols-toggle 用来显示列操作按钮，点击该按钮可在打开的下拉中设置各列的隐藏/显示；
 * 在 ti-table 标签内，开发者可灵活设置其位置。
 *
 * TiTable 上的 columns 接口传入值各项(列)的 show 和 title 属性值影响着各列的隐藏/显示状
 * 态,具体可参考 TiTableComponen t组件的 columns 输入接口说明。
 *
 * 开发者必须给需要动态显示/隐藏的列(th，td)使用 ngIf, 利用 ngIf 和 tiTable 上的 columns
 * 接口值中每列的show的值来控制当前列的显示或隐藏。
 *
 * ### 接口说明
 * **Inputs：**
 *
 * |     名称    |  类型   | 默认值   | 功能描述  |
 * | --------   | :-----   | :---- | :---- |
 * |  disabled   | boolean  | false | 设置列操作按钮是否禁用 |
 * | searchable   | boolean  | false | 是否显示搜索框 |
 * | selectAll   | boolean  | false | 是否开启全选功能。3.1.2新增 |
 * | panelWidth   |  string  | 'justified' | 下拉面板的宽度，可选值为'justified'(默认), 'auto'或自定义宽度，但宽度不能小于select面板的宽度 |
 * | noDataText   |  string  | '...' | 无数据时的显示文本。10.0.3版本新增 |
 * | select   | EventEmitter<TiTableColumns>  | 无 | 选中/取消选中事件，向外通知当前项数据，需要自行判断当前项是否选中。Tiny3.1.2 版本新增 |
 * | focus   | HTML事件  | 无 | 聚焦事件 |
 * | blur   | HTML事件  | 无 | 失焦事件 |
 *
 * <p><span style="color: red">以下说明不可用，不做参考。</span>该组件只有以上disabled、searchable、panelWidth、selectAll 这四个Input接口
 * 和foucs、blur、select 这三个事件接口可用，其余方法、Input、输出等(继承于TiSelectComponent,是供select的内部使用的)都不可用</p>
 */
export class TiColsToggleComponent extends TiSelectComponent {
    constructor(table, elementRef, renderer2) {
        super(elementRef, renderer2);
        /**
         * 设置tip提示内容，默认文本'自定义列表项'（国际化）
         *
         * 10.0.3新增
         */
        this.tipContent = TiLocale.getLocaleWords().tiTable.colsToggleTip;
        /**
         * 设置tip提示方向
         *
         * 10.0.3新增
         */
        this.tipPosition = 'top';
        // 标记是否需要更新聚焦元素
        this.shouldUpdateFocusableElems = false;
        this.table = table;
    }
    ngOnInit() {
        // 兼容使用tiTip指令实现的tip提示
        this.tipContent = this.tiTip ? '' : this.tipContent;
        this.tipPosition = this.tiTip ? undefined : this.tipPosition;
        this.setDropPanelWidth();
        super.ngOnInit();
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.updateFocusableElems();
        // TODO：严格来说，不应该继承自Select，Select中有对dominator的处理。看有没有更好实现方式。
    }
    ngAfterViewChecked() {
        // 这里不能调用父类方法，因为Select父类对dominator处理，空指针报错。
        // TODO: 看是否能够不继承select
        if (this.shouldUpdateFocusableElems) {
            this.shouldUpdateFocusableElems = false;
            this.updateFocusableElems();
        }
    }
    ngOnChanges(changes) {
        if (changes['searchable'] && !changes['searchable'].firstChange) {
            // searchable 参数变更后，dropSearch 组件中会重新获取搜索输入框元素，this.dropsearchCom.getFocusableElems() 方法获取的搜索框元素失效。
            // 由于dropSearch在ngAfterViewChecked中变更聚焦元素，时机比ngOnChanges晚，但比组件的ngAfterViewChecked早，
            // 所以用shouldUpdateFocusableElems变量标记是否需要更新聚焦元素，之后在ngAfterViewChecked中处理
            this.shouldUpdateFocusableElems = true;
        }
    }
    /**
     * @ignore
     * 在失焦时，通知更新了表格的列数据，用于表格记忆上传列显示数据
     */
    onBlur() {
        super.onBlur();
        // 表格记忆通知列切换变化
        if (this.table.storageId) {
            this.table.updateColumnsSubject.next();
        }
    }
    // 更新可聚焦元素
    updateFocusableElems() {
        if (this.searchable) {
            // 推荐在onInit()时调用setFocusableElems(), 但是ngFor/ngIf中的元素在ngAfterViewInit()才能获取到
            this.setFocusableElems([this.toggleMenuEleRef.nativeElement].concat(this.dropsearchCom.getFocusableElems()));
        }
        else {
            this.setFocusableElems([this.toggleMenuEleRef.nativeElement]);
        }
    }
    setDropPanelWidth() {
        const panelWidthNum = parseInt(this.panelWidth, 10);
        //  if (!Util.isNumber()) {
        //      this.panelWidth = TiColsToggleComponent.DEFAULT_PANEL_WIDTH + 'px';
        //      return;
        //  }
        if (panelWidthNum > TiColsToggleComponent.MAX_PANEL_WIDTH) {
            this.panelWidth = `${TiColsToggleComponent.MAX_PANEL_WIDTH}px`;
            return;
        }
        if (panelWidthNum < TiColsToggleComponent.MIN_PANEL_WIDTH) {
            this.panelWidth = `${TiColsToggleComponent.MIN_PANEL_WIDTH}px`;
        }
    }
}
TiColsToggleComponent.DEFAULT_PANEL_WIDTH = 250;
TiColsToggleComponent.MAX_PANEL_WIDTH = 300;
TiColsToggleComponent.MIN_PANEL_WIDTH = 200;
TiColsToggleComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-cols-toggle',
                template: "<div #toggleMenu\r\n     tiOutline\r\n     class=\"ti3-cols-toggle-menu-container\"\r\n     tabindex=\"{{disabled ? -1 : 0}}\"\r\n     (click)=\"onClickDominator()\"\r\n     (keydown)=\"onKeydown($event)\"\r\n     [id]=\"appendId('cols-toggle-menu')\"\r\n     [ngClass]=\"{'ti3-cols-toggle-menu-disabled': disabled}\">\r\n    <div class=\"ti3-icon ti3-icon-config ti3-cols-toggle-menu\" [tiTip]=\"tipContent\" [tiTipPosition]=\"tipPosition\"></div>\r\n</div>\r\n<ti-cols-toggle-drop [dominatorElem]=\"toggleMenuEleRef.nativeElement\"\r\n                     [panelWidth]=\"panelWidth\"\r\n                     [searchable]=\"searchable\"\r\n                     [options]=\"table.columns\"\r\n                     [selectAll]=\"selectAll\"\r\n                     [noDataText]=\"noDataText\"\r\n                     (select)=\"onSelect($event)\"\r\n                     [id]=\"appendId('colstoggle_drop')\"></ti-cols-toggle-drop>\r\n\r\n",
                host: {
                    '[class.ti3-cols-toggle-container]': 'true',
                    '(blur)': 'onBlur()'
                }
            },] }
];
TiColsToggleComponent.ctorParameters = () => [
    { type: TiTableComponent },
    { type: ElementRef },
    { type: Renderer2 }
];
TiColsToggleComponent.propDecorators = {
    tiTip: [{ type: Input }],
    tipContent: [{ type: Input }],
    tipPosition: [{ type: Input }],
    toggleMenuEleRef: [{ type: ViewChild, args: ['toggleMenu', { static: true },] }],
    dropsearchCom: [{ type: ViewChild, args: [TiColsToggleDropComponent, { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlDb2xzVG9nZ2xlQ29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL2NvbXBvbmVudHMvdGFibGUvVGlDb2xzVG9nZ2xlQ29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxTQUFTLEVBRVQsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3RELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUV2RCxrQ0FBa0M7QUFDbEMsV0FBVztBQUNYOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBNEJHO0FBU0gsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGlCQUFpQjtJQXVDeEQsWUFBWSxLQUF1QixFQUFFLFVBQXNCLEVBQy9DLFNBQW9CO1FBQ3hCLEtBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7UUE1QnJDOzs7O1dBSUc7UUFDTSxlQUFVLEdBQVcsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUM7UUFDOUU7Ozs7V0FJRztRQUNNLGdCQUFXLEdBQW1CLEtBQUssQ0FBQztRQWE3QyxlQUFlO1FBQ1AsK0JBQTBCLEdBQVksS0FBSyxDQUFDO1FBSTVDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQzNCLENBQUM7SUFFRCxRQUFRO1FBQ0osc0JBQXNCO1FBQ3RCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENB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OzRCQUl4QyxTQUFTLFNBQUMseUJBQXlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBJbnB1dCxcclxuICBSZW5kZXJlcjIsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBWaWV3Q2hpbGRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4vVGlUYWJsZUNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRpQ29sc1RvZ2dsZURyb3BDb21wb25lbnQgfSBmcm9tICcuL1RpQ29sc1RvZ2dsZURyb3BDb21wb25lbnQnO1xyXG5pbXBvcnQgeyBUaVNlbGVjdENvbXBvbmVudCB9IGZyb20gJy4uL3NlbGVjdC9UaVNlbGVjdE1vZHVsZSc7XHJcbmltcG9ydCB7IFRpTG9jYWxlIH0gZnJvbSAnLi4vLi4vbG9jYWxlL1RpTG9jYWxlTW9kdWxlJztcclxuaW1wb3J0IHsgVGlQb3NpdGlvblR5cGUgfSBmcm9tICcuLi8uLi91dGlscy9Qb3NpdGlvbic7XHJcbi8vIOS4i+mdouazqOmHiu+8jOWPr+S7pemBv+WFjee8luivkWxpYuaXtuato+WImeaKpemUmeOAguWOn+eQhuacquefpe+8jOWJr+S9nOeUqOacquefpeOAglxyXG4vLyBAZHluYW1pY1xyXG4vKipcclxuICogVGlDb2xzVG9nZ2xlIOaOp+WItuWIl+WKqOaAgemakOiXjy/mmL7npLrnmoTnu4Tku7ZcclxuICpcclxuICogdGktY29scy10b2dnbGUg55So5p2l5pi+56S65YiX5pON5L2c5oyJ6ZKu77yM54K55Ye76K+l5oyJ6ZKu5Y+v5Zyo5omT5byA55qE5LiL5ouJ5Lit6K6+572u5ZCE5YiX55qE6ZqQ6JePL+aYvuekuu+8m1xyXG4gKiDlnKggdGktdGFibGUg5qCH562+5YaF77yM5byA5Y+R6ICF5Y+v54G15rS76K6+572u5YW25L2N572u44CCXHJcbiAqXHJcbiAqIFRpVGFibGUg5LiK55qEIGNvbHVtbnMg5o6l5Y+j5Lyg5YWl5YC85ZCE6aG5KOWIlynnmoQgc2hvdyDlkowgdGl0bGUg5bGe5oCn5YC85b2x5ZON552A5ZCE5YiX55qE6ZqQ6JePL+aYvuekuueKtlxyXG4gKiDmgIEs5YW35L2T5Y+v5Y+C6ICDIFRpVGFibGVDb21wb25lbiB057uE5Lu255qEIGNvbHVtbnMg6L6T5YWl5o6l5Y+j6K+05piO44CCXHJcbiAqXHJcbiAqIOW8gOWPkeiAheW/hemhu+e7memcgOimgeWKqOaAgeaYvuekui/pmpDol4/nmoTliJcodGjvvIx0ZCnkvb/nlKggbmdJZiwg5Yip55SoIG5nSWYg5ZKMIHRpVGFibGUg5LiK55qEIGNvbHVtbnNcclxuICog5o6l5Y+j5YC85Lit5q+P5YiX55qEc2hvd+eahOWAvOadpeaOp+WItuW9k+WJjeWIl+eahOaYvuekuuaIlumakOiXj+OAglxyXG4gKlxyXG4gKiAjIyMg5o6l5Y+j6K+05piOXHJcbiAqICoqSW5wdXRz77yaKipcclxuICpcclxuICogfCAgICAg5ZCN56ewICAgIHwgIOexu+WeiyAgIHwg6buY6K6k5YC8ICAgfCDlip/og73mj4/ov7AgIHxcclxuICogfCAtLS0tLS0tLSAgIHwgOi0tLS0tICAgfCA6LS0tLSB8IDotLS0tIHxcclxuICogfCAgZGlzYWJsZWQgICB8IGJvb2xlYW4gIHwgZmFsc2UgfCDorr7nva7liJfmk43kvZzmjInpkq7mmK/lkKbnpoHnlKggfFxyXG4gKiB8IHNlYXJjaGFibGUgICB8IGJvb2xlYW4gIHwgZmFsc2UgfCDmmK/lkKbmmL7npLrmkJzntKLmoYYgfFxyXG4gKiB8IHNlbGVjdEFsbCAgIHwgYm9vbGVhbiAgfCBmYWxzZSB8IOaYr+WQpuW8gOWQr+WFqOmAieWKn+iDveOAgjMuMS4y5paw5aKeIHxcclxuICogfCBwYW5lbFdpZHRoICAgfCAgc3RyaW5nICB8ICdqdXN0aWZpZWQnIHwg5LiL5ouJ6Z2i5p2/55qE5a695bqm77yM5Y+v6YCJ5YC85Li6J2p1c3RpZmllZCco6buY6K6kKSwgJ2F1dG8n5oiW6Ieq5a6a5LmJ5a695bqm77yM5L2G5a695bqm5LiN6IO95bCP5LqOc2VsZWN06Z2i5p2/55qE5a695bqmIHxcclxuICogfCBub0RhdGFUZXh0ICAgfCAgc3RyaW5nICB8ICcuLi4nIHwg5peg5pWw5o2u5pe255qE5pi+56S65paH5pys44CCMTAuMC4z54mI5pys5paw5aKeIHxcclxuICogfCBzZWxlY3QgICB8IEV2ZW50RW1pdHRlcjxUaVRhYmxlQ29sdW1ucz4gIHwg5pegIHwg6YCJ5LitL+WPlua2iOmAieS4reS6i+S7tu+8jOWQkeWklumAmuefpeW9k+WJjemhueaVsOaNru+8jOmcgOimgeiHquihjOWIpOaWreW9k+WJjemhueaYr+WQpumAieS4reOAglRpbnkzLjEuMiDniYjmnKzmlrDlop4gfFxyXG4gKiB8IGZvY3VzICAgfCBIVE1M5LqL5Lu2ICB8IOaXoCB8IOiBmueEpuS6i+S7tiB8XHJcbiAqIHwgYmx1ciAgIHwgSFRNTOS6i+S7tiAgfCDml6AgfCDlpLHnhKbkuovku7YgfFxyXG4gKlxyXG4gKiA8cD48c3BhbiBzdHlsZT1cImNvbG9yOiByZWRcIj7ku6XkuIvor7TmmI7kuI3lj6/nlKjvvIzkuI3lgZrlj4LogIPjgII8L3NwYW4+6K+l57uE5Lu25Y+q5pyJ5Lul5LiKZGlzYWJsZWTjgIFzZWFyY2hhYmxl44CBcGFuZWxXaWR0aOOAgXNlbGVjdEFsbCDov5nlm5vkuKpJbnB1dOaOpeWPo1xyXG4gKiDlkoxmb3Vjc+OAgWJsdXLjgIFzZWxlY3Qg6L+Z5LiJ5Liq5LqL5Lu25o6l5Y+j5Y+v55So77yM5YW25L2Z5pa55rOV44CBSW5wdXTjgIHovpPlh7rnrYko57un5om/5LqOVGlTZWxlY3RDb21wb25lbnQs5piv5L6bc2VsZWN055qE5YaF6YOo5L2/55So55qEKemDveS4jeWPr+eUqDwvcD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndGktY29scy10b2dnbGUnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jb2xzLXRvZ2dsZS5odG1sJyxcclxuICBob3N0OiB7XHJcbiAgICAgICdbY2xhc3MudGkzLWNvbHMtdG9nZ2xlLWNvbnRhaW5lcl0nOiAndHJ1ZScsXHJcbiAgICAgICcoYmx1ciknOiAnb25CbHVyKCknXHJcbiAgfVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlDb2xzVG9nZ2xlQ29tcG9uZW50IGV4dGVuZHMgVGlTZWxlY3RDb21wb25lbnQge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9QQU5FTF9XSURUSDogbnVtYmVyID0gMjUwO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX1BBTkVMX1dJRFRIOiBudW1iZXIgPSAzMDA7XHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNSU5fUEFORUxfV0lEVEg6IG51bWJlciA9IDIwMDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogMTAuMC4z54mI5pys5LmL5YmN5pyN5Yqh5L2/55SodGlUaXDmjIfku6Toh6rooYzlrp7njrDmj5DnpLpcclxuICAgICAqXHJcbiAgICAgKiDmraTlpITlgZrlhbzlrrnmgKflpITnkIbvvIzmt7vliqDor6XmjqXlj6PliKTmlq3mnI3liqHmmK/lkKbkvb/nlKjmjIfku6Tlrp7njrBcclxuICAgICAqXHJcbiAgICAgKiAxMC4wLjPmlrDlop5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdGlUaXA6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog6K6+572udGlw5o+Q56S65YaF5a6577yM6buY6K6k5paH5pysJ+iHquWumuS5ieWIl+ihqOmhuSfvvIjlm73pmYXljJbvvIlcclxuICAgICAqXHJcbiAgICAgKiAxMC4wLjPmlrDlop5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgdGlwQ29udGVudDogc3RyaW5nID0gVGlMb2NhbGUuZ2V0TG9jYWxlV29yZHMoKS50aVRhYmxlLmNvbHNUb2dnbGVUaXA7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rnRpcOaPkOekuuaWueWQkVxyXG4gICAgICpcclxuICAgICAqIDEwLjAuM+aWsOWinlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0aXBQb3NpdGlvbjogVGlQb3NpdGlvblR5cGUgPSAndG9wJztcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKCd0b2dnbGVNZW51JywgeyBzdGF0aWM6IHRydWUgfSkgdG9nZ2xlTWVudUVsZVJlZjogRWxlbWVudFJlZjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBAVmlld0NoaWxkKFRpQ29sc1RvZ2dsZURyb3BDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIGRyb3BzZWFyY2hDb206IFRpQ29sc1RvZ2dsZURyb3BDb21wb25lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHRhYmxlOiBUaVRhYmxlQ29tcG9uZW50O1xyXG4gICAgLy8g5qCH6K6w5piv5ZCm6ZyA6KaB5pu05paw6IGa54Sm5YWD57SgXHJcbiAgICBwcml2YXRlIHNob3VsZFVwZGF0ZUZvY3VzYWJsZUVsZW1zOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZTogVGlUYWJsZUNvbXBvbmVudCwgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIHJlbmRlcmVyMjogUmVuZGVyZXIyKSB7XHJcbiAgICAgICAgICAgIHN1cGVyKGVsZW1lbnRSZWYsIHJlbmRlcmVyMik7XHJcbiAgICAgICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyDlhbzlrrnkvb/nlKh0aVRpcOaMh+S7pOWunueOsOeahHRpcOaPkOekulxyXG4gICAgICAgIHRoaXMudGlwQ29udGVudCA9IHRoaXMudGlUaXAgPyAnJyA6IHRoaXMudGlwQ29udGVudDtcclxuICAgICAgICB0aGlzLnRpcFBvc2l0aW9uID0gdGhpcy50aVRpcCA/IHVuZGVmaW5lZCA6IHRoaXMudGlwUG9zaXRpb24gO1xyXG4gICAgICAgIHRoaXMuc2V0RHJvcFBhbmVsV2lkdGgoKTtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzYWJsZUVsZW1zKCk7XHJcbiAgICAgICAgLy8gVE9ET++8muS4peagvOadpeivtO+8jOS4jeW6lOivpee7p+aJv+iHqlNlbGVjdO+8jFNlbGVjdOS4reacieWvuWRvbWluYXRvcueahOWkhOeQhuOAgueci+acieayoeacieabtOWlveWunueOsOaWueW8j+OAglxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyDov5nph4zkuI3og73osIPnlKjniLbnsbvmlrnms5XvvIzlm6DkuLpTZWxlY3TniLbnsbvlr7lkb21pbmF0b3LlpITnkIbvvIznqbrmjIfpkojmiqXplJnjgIJcclxuICAgICAgICAvLyBUT0RPOiDnnIvmmK/lkKbog73lpJ/kuI3nu6fmib9zZWxlY3RcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkVXBkYXRlRm9jdXNhYmxlRWxlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG91bGRVcGRhdGVGb2N1c2FibGVFbGVtcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzYWJsZUVsZW1zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBpZiAoY2hhbmdlc1snc2VhcmNoYWJsZSddICYmICFjaGFuZ2VzWydzZWFyY2hhYmxlJ10uZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgLy8gc2VhcmNoYWJsZSDlj4LmlbDlj5jmm7TlkI7vvIxkcm9wU2VhcmNoIOe7hOS7tuS4reS8mumHjeaWsOiOt+WPluaQnOe0oui+k+WFpeahhuWFg+e0oO+8jHRoaXMuZHJvcHNlYXJjaENvbS5nZXRGb2N1c2FibGVFbGVtcygpIOaWueazleiOt+WPlueahOaQnOe0ouahhuWFg+e0oOWkseaViOOAglxyXG4gICAgICAgICAgICAvLyDnlLHkuo5kcm9wU2VhcmNo5ZyobmdBZnRlclZpZXdDaGVja2Vk5Lit5Y+Y5pu06IGa54Sm5YWD57Sg77yM5pe25py65q+UbmdPbkNoYW5nZXPmmZrvvIzkvYbmr5Tnu4Tku7bnmoRuZ0FmdGVyVmlld0NoZWNrZWTml6nvvIxcclxuICAgICAgICAgICAgLy8g5omA5Lul55Soc2hvdWxkVXBkYXRlRm9jdXNhYmxlRWxlbXPlj5jph4/moIforrDmmK/lkKbpnIDopoHmm7TmlrDogZrnhKblhYPntKDvvIzkuYvlkI7lnKhuZ0FmdGVyVmlld0NoZWNrZWTkuK3lpITnkIZcclxuICAgICAgICAgICAgdGhpcy5zaG91bGRVcGRhdGVGb2N1c2FibGVFbGVtcyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlnKjlpLHnhKbml7bvvIzpgJrnn6Xmm7TmlrDkuobooajmoLznmoTliJfmlbDmja7vvIznlKjkuo7ooajmoLzorrDlv4bkuIrkvKDliJfmmL7npLrmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQmx1cigpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5vbkJsdXIoKTtcclxuICAgICAgICAvLyDooajmoLzorrDlv4bpgJrnn6XliJfliIfmjaLlj5jljJZcclxuICAgICAgICBpZih0aGlzLnRhYmxlLnN0b3JhZ2VJZCl7XHJcbiAgICAgICAgICAgIHRoaXMudGFibGUudXBkYXRlQ29sdW1uc1N1YmplY3QubmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOabtOaWsOWPr+iBmueEpuWFg+e0oFxyXG4gICAgcHJpdmF0ZSB1cGRhdGVGb2N1c2FibGVFbGVtcygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5zZWFyY2hhYmxlKSB7XHJcbiAgICAgICAgICAgIC8vIOaOqOiNkOWcqG9uSW5pdCgp5pe26LCD55Soc2V0Rm9jdXNhYmxlRWxlbXMoKSwg5L2G5pivbmdGb3IvbmdJZuS4reeahOWFg+e0oOWcqG5nQWZ0ZXJWaWV3SW5pdCgp5omN6IO96I635Y+W5YiwXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW3RoaXMudG9nZ2xlTWVudUVsZVJlZi5uYXRpdmVFbGVtZW50XS5jb25jYXQodGhpcy5kcm9wc2VhcmNoQ29tLmdldEZvY3VzYWJsZUVsZW1zKCkpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKFt0aGlzLnRvZ2dsZU1lbnVFbGVSZWYubmF0aXZlRWxlbWVudF0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgcHJpdmF0ZSBzZXREcm9wUGFuZWxXaWR0aCgpOiB2b2lkIHsgIC8vIFRPRE86XHJcbiAgICAgICAgY29uc3QgcGFuZWxXaWR0aE51bTogbnVtYmVyID0gcGFyc2VJbnQodGhpcy5wYW5lbFdpZHRoLCAxMCk7XHJcbiAgICAgICAgLy8gIGlmICghVXRpbC5pc051bWJlcigpKSB7XHJcbiAgICAgICAgLy8gICAgICB0aGlzLnBhbmVsV2lkdGggPSBUaUNvbHNUb2dnbGVDb21wb25lbnQuREVGQVVMVF9QQU5FTF9XSURUSCArICdweCc7XHJcbiAgICAgICAgLy8gICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gIH1cclxuXHJcbiAgICAgICAgaWYgKHBhbmVsV2lkdGhOdW0gPiBUaUNvbHNUb2dnbGVDb21wb25lbnQuTUFYX1BBTkVMX1dJRFRIKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxXaWR0aCA9IGAke1RpQ29sc1RvZ2dsZUNvbXBvbmVudC5NQVhfUEFORUxfV0lEVEh9cHhgO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBhbmVsV2lkdGhOdW0gPCBUaUNvbHNUb2dnbGVDb21wb25lbnQuTUlOX1BBTkVMX1dJRFRIKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFuZWxXaWR0aCA9IGAke1RpQ29sc1RvZ2dsZUNvbXBvbmVudC5NSU5fUEFORUxfV0lEVEh9cHhgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=