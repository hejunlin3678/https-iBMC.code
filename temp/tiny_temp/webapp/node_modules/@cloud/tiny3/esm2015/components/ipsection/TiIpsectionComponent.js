import { Component, ElementRef, Input, Renderer2 } from '@angular/core';
import { TiFormComponent } from '../base/TiBaseModule';
import { FormBuilder, FormControl } from '@angular/forms';
/**
 * Ipsection组件，Ip各网段分开处理，各网段有下拉类和输入类两种类型；
 *
 * 9.0.4新增
 *
 * <example-url>../tiny3demo/#/ipsection/ipsection-all</example-url>
 */
export class TiIpsectionComponent extends TiFormComponent {
    constructor(hostRef, renderer2, fb) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        this.fb = fb;
        /**
         * @ignore
         * 存放 input 控件实例数组
         */
        this.controls = [];
        /**
         * @ignore
         * 格式化输入
         */
        this.maskInput = '000';
        /**
         * @ignore
         * 存放各网段 ip 值的数组
         */
        this.ipValues = [];
        this.formGroup = fb.group({});
    }
    /**
     * 将ip值分割为数组
     */
    static splitToIPArray(ipValue) {
        const ipArray = ipValue ? ipValue.replace(/\//, '.').split('.') : [];
        return ipArray;
    }
    /**
     * 将ip数组拼接为ip值
     */
    static joinToIPValue(ipArray) {
        let ipValue = ipArray.join('.');
        if (ipArray.length > 4) {
            ipValue = ipValue.replace(/(.*)\./, '$1/');
        }
        return ipValue;
    }
    ngOnInit() {
        super.ngOnInit();
        // 创建表单控件实例
        for (let i = 0; i < this.configs.length; i++) {
            if (!this.configs[i].options) {
                this.controls[i] = new FormControl();
                this.formGroup.addControl(`input_${i}`, this.controls[i]);
                // input类型网段值更改时触发事件
                this.controls[i].valueChanges.subscribe((value) => {
                    this.updateIpValue(i, value);
                });
            }
        }
    }
    ngAfterViewInit() {
        const itemElems = this.hostRef.nativeElement.getElementsByClassName('ti3-ipsection');
        const focusElements = [];
        // 设置可聚焦元素
        for (let i = 0; i < this.configs.length; i++) {
            if (itemElems[i].firstChild) {
                focusElements.push(itemElems[i].firstChild);
            }
            else {
                this.setAttr(itemElems[i], 'disabled', this.configs[i].disabled || this.disabled);
                focusElements.push(itemElems[i]);
            }
        }
        this.setFocusableElems(focusElements);
    }
    /**
     * @ignore
     * 获取model值，并进行初始化处理
     */
    writeValue(value) {
        super.writeValue(value);
        this.ipValues = TiIpsectionComponent.splitToIPArray(value);
        this.initIpValue();
    }
    /**
     * @ignore
     * 整体失焦触发事件
     */
    onBlur(event) {
        this.formatValue();
    }
    /**
     * @ignore
     * select类型网段值更改时触发事件
     */
    onChange(i, value) {
        this.updateIpValue(i, value);
    }
    /**
     * 初始化ip值
     */
    initIpValue() {
        for (let i = 0; i < this.configs.length; i++) {
            if (this.configs[i].options) {
                // 初始显示默认选中项，若value值在options存在，则显示该值，否则显示下拉配置项第一项
                this.configs[i].selected = this.configs[i].options.find(item => item === this.ipValues[i]) ? this.ipValues[i] : this.configs[i].options[0];
                this.updateIpValue(i, this.configs[i].selected);
            }
            else {
                // 初始设置value，disabled及校验规则
                this.ipValues[i] = this.ipValues[i] ? parseInt(this.ipValues[i], 10).toString() : '';
                this.controls[i].setValue(this.ipValues[i]);
                this.controls[i].setValidators(this.configs[i].validationRules);
                this.configs[i].disabled || this.disabled ? this.controls[i].disable() : this.controls[i].enable();
            }
        }
    }
    /**
     * 初始及失焦处理输入框值，清除Ip网段前面的0
     */
    formatValue() {
        for (let i = 0; i < this.configs.length; i++) {
            if (!this.configs[i].options) {
                this.controls[i].setValue(parseInt(this.controls[i].value, 10).toString());
            }
        }
    }
    /**
     * 更新model值
     */
    updateIpValue(index, value) {
        if (this.ipValues.length <= 0 || this.ipValues[index] === value) {
            return;
        }
        this.ipValues.splice(index, 1, value);
        const ipValue = TiIpsectionComponent.joinToIPValue(this.ipValues);
        this.model = (ipValue === '...' || ipValue === '.../') ? '' : ipValue;
        return ipValue;
    }
}
TiIpsectionComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-ipsection',
                template: "<ng-container *ngFor=\"let config of configs; index as i; let last=last\">\r\n    <ng-container *ngIf=\"!config.options; else selectTemplate\" >\r\n        <form [formGroup]='formGroup' style=\"display:inline-block\">\r\n            <input autocomplete=\"off\"\r\n                [id]=\"appendId('input_' + config.section)\"\r\n                [tiMask]=\"maskInput\"\r\n                class=\"ti3-ipsection ti3-ipsection-input\"\r\n                [ngClass]=\"{'ti3-ipsection-text-blod': config.bold}\"\r\n                formControlName=\"{{'input_' + i}}\"\r\n                tiText [tiValidation]=\"config.validation\"/>\r\n        </form>\r\n    </ng-container>\r\n    <ng-template #selectTemplate>\r\n        <ti-select class=\"ti3-ipsection ti3-ipsection-select\"\r\n                   [id]=\"appendId('select_' + config.section)\"\r\n                   [options]='config.options'\r\n                   [(ngModel)]=\"config.selected\"\r\n                   (ngModelChange)=\"onChange(i, $event)\"\r\n                   [disabled]=\"config.disabled || disabled\">\r\n                   <ng-template let-option>{{option}}</ng-template>\r\n        </ti-select>\r\n    </ng-template>\r\n    <section *ngIf=\"!last\"\r\n              class=\"ti3-ipsection-division\"\r\n              [ngClass]=\"{'ti3-ipsection-dot': i < 3,\r\n                          'ti3-ipsection-maskdivision': i===3,\r\n                          'ti3-ipsection-division-disabled': disabled}\"></section>\r\n</ng-container>\r\n",
                host: {
                    '[class.ti3-ipsection-container]': 'true',
                    '(blur)': 'onBlur($event)'
                },
                providers: [TiFormComponent.getValueAccessor(TiIpsectionComponent)],
                styles: ["::ng-deep :root{--ti-ipsection-dot-size:2px}:host.ti3-ipsection-container{display:inline-block}.ti3-ipsection-input{text-align:center;width:50px}.ti3-ipsection-select{width:70px}.ti3-ipsection-text-blod{font-weight:700}.ti3-ipsection-division{background:var(--ti-common-color-icon-normal);display:inline-block;vertical-align:middle}.ti3-ipsection-dot{-ms-box-sizing:border-box;border-radius:50%;box-sizing:border-box;height:var(--ti-ipsection-dot-size);margin:0 var(--ti-common-space-2x);width:var(--ti-ipsection-dot-size)}.ti3-ipsection-maskdivision{height:1px;transform:rotate(110deg);width:18px}.ti3-ipsection-division-disabled{background:var(--ti-common-color-icon-disabled)}"]
            },] }
];
TiIpsectionComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: FormBuilder }
];
TiIpsectionComponent.propDecorators = {
    configs: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlJcHNlY3Rpb25Db21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy9pcHNlY3Rpb24vVGlJcHNlY3Rpb25Db21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQTBCLE1BQU0sZ0JBQWdCLENBQUM7QUFnQ2xGOzs7Ozs7R0FNRztBQVlILE1BQU0sT0FBTyxvQkFBcUIsU0FBUSxlQUFlO0lBeUJyRCxZQUFzQixPQUFtQixFQUFZLFNBQW9CLEVBQVUsRUFBZTtRQUM5RixLQUFLLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRFIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFZLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFhO1FBcEJsRzs7O1dBR0c7UUFDSyxhQUFRLEdBQXVCLEVBQUUsQ0FBQztRQUMxQzs7O1dBR0c7UUFDSSxjQUFTLEdBQVcsS0FBSyxDQUFDO1FBQ2pDOzs7V0FHRztRQUNJLGFBQVEsR0FBa0IsRUFBRSxDQUFDO1FBUWhDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQ7O09BRUc7SUFDSyxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQWU7UUFDekMsTUFBTSxPQUFPLEdBQWtCLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxF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SyxHQUFHLENBQUMsT0FBTyxLQUFLLEtBQUssSUFBSSxPQUFPLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBRXZFLE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7OztZQW5LSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLDArQ0FBNkI7Z0JBRTdCLElBQUksRUFBRTtvQkFDRixpQ0FBaUMsRUFBRSxNQUFNO29CQUN6QyxRQUFRLEVBQUUsZ0JBQWdCO2lCQUM3QjtnQkFDRCxTQUFTLEVBQUUsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsQ0FBQzs7YUFDdEU7OztZQW5EbUIsVUFBVTtZQUFTLFNBQVM7WUFHdkMsV0FBVzs7O3NCQXNEZixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRpRm9ybUNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvVGlCYXNlTW9kdWxlJztcclxuaW1wb3J0IHsgVGlWYWxpZGF0aW9uQ29uZmlnIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy92YWxpZGF0aW9uL1RpVmFsaWRhdGlvbk1vZHVsZSc7XHJcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVGlJcHNlY3Rpb25Db25maWcge1xyXG4gICAgLyoqXHJcbiAgICAgKiDmoIflv5flkITnvZHmrrVcclxuICAgICAqL1xyXG4gICAgc2VjdGlvbjogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnvZHmrrXkuLpzZWxlY3Tnsbvlnovml7bvvIzkuIvmi4nphY3nva7lr7nosaFcclxuICAgICAqL1xyXG4gICAgb3B0aW9ucz86IEFycmF5PGFueT47XHJcbiAgICAvKipcclxuICAgICAqIOe9keauteS4umlucHV057G75Z6L5pe277yM6K6+572u5paH5pys5piv5ZCm5Yqg57KXXHJcbiAgICAgKi9cclxuICAgIGJvbGQ/OiBib29sZWFuO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnvZHmrrXkuLppbnB1dOexu+Wei+aXtu+8jOmFjee9ruagoemqjOaPkOekuuS/oeaBr++8jOWPr+WPguiAg+agoemqjOe7hOS7tuekuuS+i1xyXG4gICAgICovXHJcbiAgICB2YWxpZGF0aW9uPzogVGlWYWxpZGF0aW9uQ29uZmlnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnvZHmrrXkuLppbnB1dOexu+Wei+aXtu+8jOmFjee9ruagoemqjOinhOWIme+8jOWPr+WPguiAg+agoemqjOe7hOS7tuekuuS+i1xyXG4gICAgICovXHJcbiAgICB2YWxpZGF0aW9uUnVsZXM/OiBBcnJheTxWYWxpZGF0b3JGbj47XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruWQhOe9keauteaYr+WQpueBsOWMllxyXG4gICAgICovXHJcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIOWFgeiuuOacieWkmuS9meeahOWxnuaAp+Wtl+autVxyXG4gICAgICovXHJcbiAgICBbcHJvcE5hbWU6IHN0cmluZ106IGFueTtcclxufVxyXG4vKipcclxuICogSXBzZWN0aW9u57uE5Lu277yMSXDlkITnvZHmrrXliIblvIDlpITnkIbvvIzlkITnvZHmrrXmnInkuIvmi4nnsbvlkozovpPlhaXnsbvkuKTnp43nsbvlnovvvJtcclxuICpcclxuICogOS4wLjTmlrDlop5cclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL2lwc2VjdGlvbi9pcHNlY3Rpb24tYWxsPC9leGFtcGxlLXVybD5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd0aS1pcHNlY3Rpb24nLFxyXG4gICAgdGVtcGxhdGVVcmw6ICdpcHNlY3Rpb24uaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9pcHNlY3Rpb24ubGVzcyddLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICdbY2xhc3MudGkzLWlwc2VjdGlvbi1jb250YWluZXJdJzogJ3RydWUnLFxyXG4gICAgICAgICcoYmx1ciknOiAnb25CbHVyKCRldmVudCknXHJcbiAgICB9LFxyXG4gICAgcHJvdmlkZXJzOiBbVGlGb3JtQ29tcG9uZW50LmdldFZhbHVlQWNjZXNzb3IoVGlJcHNlY3Rpb25Db21wb25lbnQpXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFRpSXBzZWN0aW9uQ29tcG9uZW50IGV4dGVuZHMgVGlGb3JtQ29tcG9uZW50IHtcclxuICAgIC8qKlxyXG4gICAgICogSXDnvZHmrrXphY3nva7mlbDnu4Tlr7nosaHvvIznu4Tku7bmjInor6XphY3nva7mlbDnu4Tlr7nosaHpobrluo/muLLmn5PmlbDmja5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY29uZmlnczogQXJyYXk8VGlJcHNlY3Rpb25Db25maWc+O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlrZjmlL4gaW5wdXQg5o6n5Lu25a6e5L6L5pWw57uEXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY29udHJvbHM6IEFycmF5PEZvcm1Db250cm9sPiA9IFtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmoLzlvI/ljJbovpPlhaVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG1hc2tJbnB1dDogc3RyaW5nID0gJzAwMCc7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWtmOaUvuWQhOe9keautSBpcCDlgLznmoTmlbDnu4RcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlwVmFsdWVzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIGlucHV05o6n5Lu2IEZvcm1Hcm91cCDlrp7kvovvvIzmnI3liqHlj6/pgJrov4for6Xlrp7kvovliqjmgIHmm7TmlLnmn5DkuIBGb3JtQ29udHJvbOWunuS+i+ebuOWFs+WxnuaAp++8iHZhbHVl77yMZGlzYWJsZWTvvIzmoKHpqozop4TliJnnrYnvvIlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGZvcm1Hcm91cDogRm9ybUdyb3VwO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBob3N0UmVmOiBFbGVtZW50UmVmLCBwcm90ZWN0ZWQgcmVuZGVyZXIyOiBSZW5kZXJlcjIsIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyKSB7XHJcbiAgICAgICAgc3VwZXIoaG9zdFJlZiwgcmVuZGVyZXIyKTtcclxuICAgICAgICB0aGlzLmZvcm1Hcm91cCA9IGZiLmdyb3VwKHt9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhmlw5YC85YiG5Ymy5Li65pWw57uEXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIHNwbGl0VG9JUEFycmF5KGlwVmFsdWU6IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgICAgIGNvbnN0IGlwQXJyYXk6IEFycmF5PHN0cmluZz4gPSBpcFZhbHVlID8gaXBWYWx1ZS5yZXBsYWNlKC9cXC8vLCAnLicpLnNwbGl0KCcuJykgOiBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGlwQXJyYXk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlsIZpcOaVsOe7hOaLvOaOpeS4umlw5YC8XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGpvaW5Ub0lQVmFsdWUoaXBBcnJheTogQXJyYXk8c3RyaW5nPik6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IGlwVmFsdWU6IHN0cmluZyA9IGlwQXJyYXkuam9pbignLicpO1xyXG4gICAgICAgIGlmIChpcEFycmF5Lmxlbmd0aCA+IDQpIHtcclxuICAgICAgICAgICAgaXBWYWx1ZSA9IGlwVmFsdWUucmVwbGFjZSgvKC4qKVxcLi8sICckMS8nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpcFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5Yib5bu66KGo5Y2V5o6n5Lu25a6e5L6LXHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMuY29uZmlncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnc1tpXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xzW2ldID0gbmV3IEZvcm1Db250cm9sKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1Hcm91cC5hZGRDb250cm9sKGBpbnB1dF8ke2l9YCwgdGhpcy5jb250cm9sc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBpbnB1dOexu+Wei+e9keauteWAvOabtOaUueaXtuinpuWPkeS6i+S7tlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sc1tpXS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJcFZhbHVlKGksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpdGVtRWxlbXM6IEhUTUxDb2xsZWN0aW9uID0gdGhpcy5ob3N0UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGkzLWlwc2VjdGlvbicpO1xyXG4gICAgICAgIGNvbnN0IGZvY3VzRWxlbWVudHM6IEFycmF5PGFueT4gPSBbXTtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5Y+v6IGa54Sm5YWD57SgXHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMuY29uZmlncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoaXRlbUVsZW1zW2ldLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIGZvY3VzRWxlbWVudHMucHVzaChpdGVtRWxlbXNbaV0uZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHIoaXRlbUVsZW1zW2ldLCAnZGlzYWJsZWQnLCB0aGlzLmNvbmZpZ3NbaV0uZGlzYWJsZWQgfHwgdGhpcy5kaXNhYmxlZCk7XHJcbiAgICAgICAgICAgICAgICBmb2N1c0VsZW1lbnRzLnB1c2goaXRlbUVsZW1zW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKGZvY3VzRWxlbWVudHMpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiOt+WPlm1vZGVs5YC877yM5bm26L+b6KGM5Yid5aeL5YyW5aSE55CGXHJcbiAgICAgKi9cclxuICAgIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLndyaXRlVmFsdWUodmFsdWUpO1xyXG4gICAgICAgIHRoaXMuaXBWYWx1ZXMgPSBUaUlwc2VjdGlvbkNvbXBvbmVudC5zcGxpdFRvSVBBcnJheSh2YWx1ZSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdElwVmFsdWUoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5pW05L2T5aSx54Sm6Kem5Y+R5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIG9uQmx1cihldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5mb3JtYXRWYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogc2VsZWN057G75Z6L572R5q615YC85pu05pS55pe26Kem5Y+R5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIG9uQ2hhbmdlKGk6IG51bWJlciwgdmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMudXBkYXRlSXBWYWx1ZShpLCB2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJZpcOWAvFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGluaXRJcFZhbHVlKCk6IHZvaWQge1xyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCB0aGlzLmNvbmZpZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnc1tpXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDliJ3lp4vmmL7npLrpu5jorqTpgInkuK3pobnvvIzoi6V2YWx1ZeWAvOWcqG9wdGlvbnPlrZjlnKjvvIzliJnmmL7npLror6XlgLzvvIzlkKbliJnmmL7npLrkuIvmi4nphY3nva7pobnnrKzkuIDpoblcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnc1tpXS5zZWxlY3RlZCA9IHRoaXMuY29uZmlnc1tpXS5vcHRpb25zLmZpbmQoaXRlbSA9PiBpdGVtID09PSB0aGlzLmlwVmFsdWVzW2ldKSA/IHRoaXMuaXBWYWx1ZXNbaV0gOiB0aGlzLmNvbmZpZ3NbaV0ub3B0aW9uc1swXTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSXBWYWx1ZShpLCB0aGlzLmNvbmZpZ3NbaV0uc2VsZWN0ZWQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5Yid5aeL6K6+572udmFsdWXvvIxkaXNhYmxlZOWPiuagoemqjOinhOWImVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pcFZhbHVlc1tpXSA9IHRoaXMuaXBWYWx1ZXNbaV0gPyBwYXJzZUludCh0aGlzLmlwVmFsdWVzW2ldLCAxMCkudG9TdHJpbmcoKSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sc1tpXS5zZXRWYWx1ZSh0aGlzLmlwVmFsdWVzW2ldKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbHNbaV0uc2V0VmFsaWRhdG9ycyh0aGlzLmNvbmZpZ3NbaV0udmFsaWRhdGlvblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnc1tpXS5kaXNhYmxlZCB8fCB0aGlzLmRpc2FibGVkID8gdGhpcy5jb250cm9sc1tpXS5kaXNhYmxlKCkgOiB0aGlzLmNvbnRyb2xzW2ldLmVuYWJsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yid5aeL5Y+K5aSx54Sm5aSE55CG6L6T5YWl5qGG5YC877yM5riF6ZmkSXDnvZHmrrXliY3pnaLnmoQwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZm9ybWF0VmFsdWUoKTogdm9pZCB7XHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMuY29uZmlncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnc1tpXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xzW2ldLnNldFZhbHVlKHBhcnNlSW50KHRoaXMuY29udHJvbHNbaV0udmFsdWUsIDEwKS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsG1vZGVs5YC8XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgdXBkYXRlSXBWYWx1ZShpbmRleD86IG51bWJlciwgdmFsdWU/OiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICh0aGlzLmlwVmFsdWVzLmxlbmd0aCA8PSAwIHx8IHRoaXMuaXBWYWx1ZXNbaW5kZXhdID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlwVmFsdWVzLnNwbGljZShpbmRleCwgMSwgdmFsdWUpO1xyXG4gICAgICAgIGNvbnN0IGlwVmFsdWU6IHN0cmluZyA9IFRpSXBzZWN0aW9uQ29tcG9uZW50LmpvaW5Ub0lQVmFsdWUodGhpcy5pcFZhbHVlcyk7XHJcbiAgICAgICAgdGhpcy5tb2RlbCA9IChpcFZhbHVlID09PSAnLi4uJyB8fCBpcFZhbHVlID09PSAnLi4uLycpID8gICcnIDogaXBWYWx1ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGlwVmFsdWU7XHJcbiAgICB9XHJcbn1cclxuIl19