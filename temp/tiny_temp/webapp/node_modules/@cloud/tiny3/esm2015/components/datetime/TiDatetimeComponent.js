import { Component } from '@angular/core';
import { TiLocale, TiLocaleFormat } from '../../locale/TiLocaleModule';
import { TiDateUtil, TiKeymap, Util } from '../../utils/Util';
import { TiFormComponent } from '../base/TiBaseModule';
import { TiDateBaseComponent } from '../datebase/TiDateBaseModule';
/**
 * Datetime日期时间组件
 *
 * Datetime组件提供了一种方便的显示和设置日期时间的方式。
 *
 * <example-url>../tiny3demo/#/datetime/datetime-all</example-url>
 */
export class TiDatetimeComponent extends TiDateBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * @ignore
         * 配置time组件的接口
         */
        this.beginTime = {};
        /**
         * @ignore
         * 标记date/datetime的类型
         */
        this.isDatetime = true;
        /**
         * @ignore
         * 用于标记是不是range
         */
        this.isRange = false;
        /**
         * @ignore
         * placeholder提示文本
         */
        this.placeholder = `${TiLocale.getLocaleWords().tiDate.datetimePlaceholder}`;
        /**
         * @ignore
         * 旧时间值
         */
        this.oldValue = '';
    }
    ngOnInit() {
        super.ngOnInit();
        this.oldFormat = this.format;
    }
    ngOnChanges(changes) {
        // 验证最大值最小值，为了处理最大值和最小值从合法日期变为undefined 的情景
        if ((changes['max'] && !changes['max'].firstChange) || (changes['min'] && !changes['min'].firstChange)) {
            this.validateMinAndMax(this.config, this.isDatetime);
        }
    }
    ngDoCheck() {
        // 监听format的变化
        this.setFormat();
    }
    /**
     * @ignore
     * model值变化时的回调
     */
    ngOnModelChange() {
        if (!TiDateUtil.isDate(this.model)) {
            this.inputValue = '';
            return;
        }
        this.formatValue();
        this.setOkBtnState();
        this.setPickerDate();
    }
    /**
     * @ignore
     * 确认按钮的点击事件处理
     */
    onOkClick() {
        if (this.inValidValue) {
            return;
        }
        if (!TiDateUtil.isDate(this.datePanel['value']['begin'])) {
            this.dropCom.hide();
            return;
        }
        // 获取时间的字符串
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        // 空格误删
        const newValue = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        // 点击确认按钮对比新旧值：相等不做处理，不相等将新值赋给model
        if (!TiDateUtil.isDatetimeEqual(this.model, newValue)) {
            this.model = newValue;
        }
        this.hideDrop();
        this.okClick.emit(this.model);
    }
    /**
     * @ignore
     * 设置下拉面板中datePanel组件接口
     */
    setDatePanel() {
        this.datePanel = {
            picker: 'day',
            max: this.max,
            min: this.min,
            format: this.format,
            nowDateTime: this.nowDateTime,
            value: {
                begin: this.model,
                end: null
            },
            select: () => {
                // 点击日期面板值，校验时间的最大值最小值
                // 原因：当选择的日期是最小或者最大时，需要校验当前的时间是否合法
                // 设定时间范围
                if (TiDateUtil.isDateEqual(this.datePanel['value']['begin'], this.max)) {
                    this.beginTime['max'] = TiDateUtil.getTimeStr(this.max);
                    this.beginTime['min'] = '00:00:00';
                }
                else if (TiDateUtil.isDateEqual(this.datePanel['value']['begin'], this.min)) {
                    this.beginTime['max'] = '23:59:59';
                    this.beginTime['min'] = TiDateUtil.getTimeStr(this.min);
                }
                else {
                    this.beginTime['min'] = '00:00:00';
                    this.beginTime['max'] = '23:59:59';
                }
                this.setBeginTime();
                this.setOkBtnState();
            },
            selectTimeFn: (obj) => {
                this.setTimeFn(obj, this.beginTime);
                this.setOkBtnState();
            }
        };
    }
    setBeginTime() {
        if (this.timeEditDisabled) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(new Date());
        }
        // 1.获取时间的字符串
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        // 空格误删
        const datetimeStr = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        // 最大值校验
        if (TiDateUtil.isBigger(datetimeStr, this.max)) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(this.max);
        }
        // 最小值校验
        if (TiDateUtil.isSmaller(datetimeStr, this.min)) {
            this.beginTime['value'] = TiDateUtil.getTimeStr(this.min);
        }
        this.oldValue = this.beginTime['value'];
        this.timeEditDisabled = false;
    }
    /**
     * @ignore
     * @param event
     * @param val
     */
    onKeydownFn(event, val) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            if (!TiDateUtil.isDate(val)) {
                return;
            }
            this.setBeginTime();
            this.setOkBtnState();
        }
    }
    /**
     * @ignore
     */
    editBlur(val) {
        if (val !== null) {
            this.setBeginTime();
            this.setOkBtnState();
        }
    }
    // 设置下拉面板中time组件接口
    setTime() {
        // value接口设置
        this.setTimeValue();
        // maxValue接口设置
        this.setTimeMaxValue();
        // minValue接口设置
        this.setTimeMinValue();
    }
    setTimeValue() {
        this.beginTime['value'] = TiDateUtil.isDate(this.model) ? TiDateUtil.getTimeStr(this.model) : '';
    }
    setTimeMaxValue() {
        if (!TiDateUtil.isDate(this.model)) {
            return;
        }
        this.beginTime['max'] = (TiDateUtil.isDateEqual(this.model, this.max)) ?
            TiDateUtil.getTimeStr(this.max) : '23:59:59';
    }
    setTimeMinValue() {
        if (!TiDateUtil.isDate(this.model)) {
            return;
        }
        this.beginTime['min'] = (TiDateUtil.isDateEqual(this.model, this.min)) ?
            TiDateUtil.getTimeStr(this.min) : '00:00:00';
    }
    /**
     * @ignore
     */
    isValidValue(value) {
        if (TiDateUtil.isDate(value) && TiDateUtil.isBetweenMaxAndmin(value, this.min, this.max)) {
            return true;
        }
        return false;
    }
    /**
     * @ignore
     */
    setPickerDate() {
        // 设置下拉面板中datePanel组件接口
        this.setDatePanel();
        // 设置下拉面板中time组件接口
        this.setTime();
        this.setOkBtnState();
        this.timeEditDisabled = TiDateUtil.isDate(this.model) ? false : true;
        if (this.timeEditDisabled) {
            this.selectTime = false;
        }
    }
    /**
     * @ignore
     * 设置确认按钮的状态
     */
    setOkBtnState() {
        // 输入中文冒号之后，及时转换为英文冒号
        const inputvalue = this.beginTime.value;
        if (!Util.isUndefined(inputvalue)) {
            this.beginTime.value = inputvalue.replace('：', ':');
        }
        const date = this.datePanel.value.begin;
        if (!TiDateUtil.isDate(date)) {
            this.inValidValue = true;
        }
        else {
            const dateTime = new Date(`${TiDateUtil.getDateStr(date)} ${TiDateUtil.addColon(this.beginTime['value'])}`);
            this.inValidValue = !TiDateUtil.isBetweenMaxAndmin(dateTime, this.min, this.max);
        }
        if (this.buttonComs) {
            this.setAttr(this.buttonComs.last.nativeElement, 'disabled', this.inValidValue);
            this.setInputStyle(this.inValidValue);
        }
    }
    /**
     * @ignore
     * 将value转换为format接口格式的字符串
     */
    formatValue() {
        if (this.model === null) {
            this.inputValue = '';
        }
        else {
            // 空格误删
            const format = `${this.format.date} ${TiDateUtil.addAmPm(this.format.time)}`;
            this.inputValue = TiLocaleFormat.formatDateTime(this.model, format);
        }
        this.oldValue = TiDateUtil.getTimeStr(this.model);
    }
    /**
     * @ignore
     * 时间框失焦事件
     */
    timeBlur() {
        this.handleTimeValue();
    }
    /**
     * @ignore
     * 时间框enter事件
     */
    timeKeydown(event) {
        if (event.keyCode === TiKeymap.KEY_ENTER || event.keyCode === TiKeymap.KEY_NUMPAD_ENTER) {
            this.handleTimeValue();
        }
    }
    /**
     * @ignore
     * time时间框输入内容处理
     */
    handleTimeValue() {
        // 区分中英文冒号
        const reg = new RegExp('[\\:\\：]');
        const dateReg = new RegExp('[年\\月\\日\\-\\/\\.\\_]');
        // 输入区间是否存在小数点，非整数
        let isNotInteger = false;
        this.beginTime = JSON.parse(JSON.stringify(this.beginTime));
        const timeArr = this.beginTime.value.split(reg);
        timeArr.forEach((item, index) => {
            if (item.length === 1) {
                timeArr[index] = '0' + item;
            }
            if (parseInt(item, 10) !== Number(item)) {
                isNotInteger = true;
            }
        });
        const dateStr = TiDateUtil.getDateStr(this.datePanel['value']['begin']);
        const dateArr = dateStr.split(dateReg);
        this.beginTime.value = timeArr.join(':');
        const datetime = new Date(`${dateStr} ${TiDateUtil.addColon(this.beginTime['value'])}`);
        const dateVal = new Date(parseInt(dateArr[0], 10), parseInt(dateArr[1], 10), parseInt(dateArr[2], 10), parseInt(timeArr[0], 10), parseInt(timeArr[1], 10), parseInt(timeArr[2], 10));
        if (String(datetime) === 'Invalid Date' || String(dateVal) === 'Invalid Date' || timeArr.length > 3 || isNotInteger) {
            this.beginTime.value = this.oldValue;
            this.setOkBtnState();
            return;
        }
        this.oldValue = this.beginTime.value;
        this.setOkBtnState();
    }
    /**
     * @description 判读字符串是否是合法的时间
     * @param: time: 校验的时间
     */
    isValidTime(time) {
        if (!Util.isString(time) || time.trim() === '') {
            return false;
        }
        const date = new Date(`2018/5/15 ${time}`);
        return !(String(date) === 'Invalid Date');
    }
}
TiDatetimeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-datetime',
                template: "<ti-date-dominator #dominator\r\n                   [id]=\"appendId('dominator')\"\r\n                   [clearable]=\"clearIcon\"\r\n                   [(ngModel)]=\"inputValue\"\r\n                   [disabled]=\"disabled\"\r\n                   (clear)=\"onIconClearClick($event)\"\r\n                   (click)=\"onShowClick()\">{{ placeholder }}</ti-date-dominator>\r\n<ti-drop #drop\r\n        [id]=\"appendId('drop')\"\r\n        class=\"ti3-datetime-picker\"\r\n        [ngClass]=\"{'ti3-date-time-customize': hasCustomizeTime}\"\r\n        [dominatorElem]=\"dominatorCom.nativeElement\"\r\n        fixMaxHeight=\"true\"\r\n        [panelWidth]=\"datePanelWidth\"\r\n        [panelAlign]=\"panelAlign\"\r\n        [browserSpace]=\"browserSpace\"\r\n        [dominatorSpace]='dominatorSpace'\r\n        [determinPositionFn]=\"determinPositionFn\"\r\n        theme='noborder'>\r\n        <!-- <section *ngIf=\"dropCom.isShow\"> -->\r\n\r\n        <section class='ti3-date-clear'>\r\n                <section *ngIf='hasCustomizeTime' class='ti3-date-time-customize-contianer'>\r\n                        <ng-container *ngTemplateOutlet=\"customizeTemplate; context:  {$implicit: customizeOptions}\"></ng-container>\r\n                </section>\r\n\r\n                <section [ngClass]=\"{'ti3-datetime-panel-container': hasCustomizeTime}\">\r\n                        <ti-date-edit class='ti3-datetime-dateedit'\r\n                        [ngClass]=\"{'ti3-datetime-dateedit-input': this.focusedPosition === 'begin'}\"\r\n                        [(ngModel)] = \"datePanel.value.begin\"\r\n                        [min] = \"datePanel.min\"\r\n                        [max] = \"datePanel.max\"\r\n                        (keydown)=\"onKeydownFn($event, datePanel.value.begin)\"\r\n                        (click)=\"dateEditClick('begin')\"\r\n                        (focus)=\"dateEditFocus('begin')\"\r\n                        (blur)='editBlur(datePanel.value.begin)'\r\n                        [format]=\"datePanel.format\" [id]=\"appendId('edit')\"></ti-date-edit>\r\n                        <!-- \u786E\u8BA4\u6309\u94AE\u7981\u7528\u573A\u666F\u4E0B\uFF0C\u7ED3\u675F\u6846\u8F93\u5165\u4E4B\u540E\u65E0\u6CD5\u76F4\u63A5tab\u5207\u6362\u7126\u70B9\u81F3\u786E\u8BA4\u6309\u94AE\uFF0C\u6545\u6DFB\u52A0\u6B64\u8FC7\u5EA6input -->\r\n                        <input #input type=\"text\" class=\"ti3-tab-input\"/>\r\n                    <input  class='ti3-datetime-timeedit'\r\n                    [ngClass]=\"{'ti3-datetime-timeedit-input': this.focusedPosition === 'beginTime'}\"\r\n                    type=\"text\"\r\n                    (focus)=\"timeFocus('begin')\"\r\n                    (blur)='timeBlur()'\r\n                    maxlength='8'\r\n                    [disabled]=\"timeEditDisabled\"\r\n                    [placeholder]='timeplaceholder'\r\n                    [(ngModel)]=\"beginTime.value\"\r\n                    (keydown)='timeKeydown($event)'\r\n                    [id]=\"appendId('input')\"\r\n                    tiText/>\r\n                        <ti-date-panel\r\n                                [id]=\"appendId('panel')\"\r\n                                [(value)]=\"datePanel.value\"\r\n                                [(picker)]=\"datePanel.picker\"\r\n                                [isRange]='false'\r\n                                [beginTime]='beginTime'\r\n                                [selectTime]='selectTime'\r\n                                (selectTimeFn)='datePanel.selectTimeFn($event)'\r\n                                [min]=\"datePanel.min\"\r\n                                [max]=\"datePanel.max\"\r\n                                [nowDateTime]=\"datePanel.nowDateTime\"\r\n                                [format]=\"format.date\"\r\n                                (select)=\"datePanel.select()\"\r\n                                (valueChange)=\"setOkBtnState()\"></ti-date-panel>\r\n                </section>\r\n        </section>\r\n                <section class=\"ti3-datetime-btn-picker-footer\" [ngClass]=\"{'ti3-datetime-select-time': selectTime}\">\r\n                        <button class=\"ti3-datetime-picker-footer-btn\"\r\n                                [id]=\"appendId('okBtn')\"\r\n                                type=\"button\"\r\n                                size=\"small\"\r\n                                (click)=\"onOkClick()\"\r\n                                tiButton>{{ 'tiCommon.okBtn' | tiTranslate }}</button>\r\n                        <section (click)='selectTimeFn()' [id]=\"appendId('select_time')\" *ngIf='!selectTime' [ngClass]=\"{'ti3-datetime-select-btn-disabled': timeEditDisabled}\" class='ti3-datetime-select-btn'>{{'tiDate.selectTime' | tiTranslate}}</section>\r\n                        <section (click)='selectDateFn()' [id]=\"appendId('select_date')\" *ngIf='selectTime' class='ti3-datetime-select-btn'>{{'tiDate.selectDate' | tiTranslate}}</section>\r\n                </section>\r\n</ti-drop>\r\n\r\n<ng-template #customizeTemplate let-options>\r\n        <ul [id]=\"appendId('list')\">\r\n            <li *ngFor='let option of options; index as i;' class='ti3-customize-time-label' (click)='customizeTimeClickFn(option.value.begin)' [id]=\"appendId('label_' + i)\">{{option.label}}</li>\r\n        </ul>\r\n</ng-template>\r\n",
                host: {
                    '[class.ti3-datetime-input-container]': 'true',
                    '(blur)': 'hidePanel()'
                },
                providers: [TiFormComponent.getValueAccessor(TiDatetimeComponent)],
                styles: [".ti3-compnent-container-border,:host.ti3-datetime-input-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host.ti3-datetime-input-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host.ti3-datetime-input-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host.ti3-datetime-input-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host.ti3-datetime-input-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}.ti3-customize-time-label{color:var(--ti-common-color-text-primary);cursor:pointer;font-size:var(--ti-common-font-size-base);line-height:var(--ti-common-line-height-number);margin-bottom:10px}.ti3-customize-time-label:hover{color:var(--ti-common-color-line-active)}.ti3-date-clear{display:flex;*zoom:1}.ti3-date-clear:after{clear:both}.ti3-date-clear:after,.ti3-date-clear:before{content:\"\";display:table}.ti3-datetime-select-btn{color:var(--ti-common-color-text-highlight);cursor:pointer;float:right;line-height:24px;padding-right:var(--ti-common-space-2x)}.ti3-datetime-select-btn-disabled{color:var(--ti-common-color-text-disabled);cursor:not-allowed}.ti3-date-range-splitline{padding:0 6px}.ti3-tab-input{height:0;left:-9999px;position:absolute;top:-9999px;width:0}::ng-deep :root{--ti-date-picker-padding-bottom:12px;--ti-date-picker-padding-horizon:16px}:host.ti3-datetime-input-container{width:200px}.ti3-dropdown-container.ti3-datetime-picker{font-size:var(--ti-datetime-input-font-size);padding:var(--ti-date-picker-padding-bottom) var(--ti-date-picker-padding-horizon);width:calc(var(--ti-datetime-day-width)*7 + var(--ti-date-picker-padding-horizon)*2 + 2px);z-index:var(--ti-datetime-z-index)}.ti3-dropdown-container.ti3-datetime-picker:focus{outline:0}.ti3-datetime-picker-footer{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;clear:both;padding-bottom:var(--ti-common-space-10);user-select:none;width:100%;*zoom:1}.ti3-datetime-picker-footer:after{clear:both;content:\"\";display:table}.ti3-datetime-picker-footer:before{content:\"\";display:table}.ti3-date-picker-footer-right{float:right}.ti3-datetime-btn-picker-footer{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;border-top:1px solid var(--ti-common-color-line-dividing);box-sizing:border-box;clear:both;margin-top:var(--ti-common-space-3x);padding-top:var(--ti-common-space-3x);user-select:none;width:100%;*zoom:1}.ti3-datetime-btn-picker-footer:after{clear:both;content:\"\";display:table}.ti3-datetime-btn-picker-footer:before{content:\"\";display:table}.ti3-datetime-btn-picker-footer .ti3-datetime-picker-footer-btn{float:right}.ti3-datetime-btn-picker-footer .ti3-datetime-picker-footer-btn:last-child{margin-right:var(--ti-common-space-10)}.ti3-datetime-btn-picker-footer.ti3-datetime-select-time{border-top:none;margin-top:0}.ti3-date-time-customize{width:397px!important}.ti3-date-time-customize-contianer{border-right:1px solid var(--ti-common-color-line-dividing);float:left;height:292px;padding-right:var(--ti-common-space-4x);width:80px}.ti3-datetime-dateedit{margin-right:var(--ti-common-space-2x)}.ti3-datetime-dateedit,.ti3-datetime-timeedit{display:inline-block;width:122px}.ti3-datetime-panel-container{float:right;padding-left:var(--ti-common-space-4x)}::ng-deep .ti3-datetime-dateedit-input input[tiText],::ng-deep .ti3-datetime-timeedit-input{border-color:var(--ti-input-border-color-focus)!important}"]
            },] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlEYXRldGltZUNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL2RhdGV0aW1lL1RpRGF0ZXRpbWVDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILFNBQVMsRUFLWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzlELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsbUJBQW1CLEVBQWlDLE1BQU0sOEJBQThCLENBQUM7QUFFbEc7Ozs7OztHQU1HO0FBV0gsTUFBTSxPQUFPLG1CQUFvQixTQUFRLG1CQUFtQjtJQVY1RDs7UUFXSTs7O1dBR0c7UUFDSSxjQUFTLEdBQWdCLEVBQUUsQ0FBQztRQU1uQzs7O1dBR0c7UUFDSSxlQUFVLEdBQVksSUFBSSxDQUFDO1FBQ2xDOzs7V0FHRztRQUNJLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFDaEM7OztXQUdHO1FBQ0ksZ0JBQVcsR0FBVyxHQUFHLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxNQUFNLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUN2Rjs7O1dBR0c7UUFDSSxhQUFRLEdBQVEsRUFBRSxDQUFDO0lBc1Q5QixDQUFDO0lBcFRHLFFBQVE7UUFDSixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ2pDLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDOUIsMkNBQTJDO1FBQzNDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FB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LEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7UUFDckMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFDRDs7O09BR0c7SUFDSyxXQUFXLENBQUMsSUFBWTtRQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzVDLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsTUFBTSxJQUFJLEdBQVEsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRWhELE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxjQUFjLENBQUMsQ0FBQztJQUM5QyxDQUFDOzs7WUE3VkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxhQUFhO2dCQUN2QiwydktBQThCO2dCQUU5QixJQUFJLEVBQUU7b0JBQ0Ysc0NBQXNDLEVBQUUsTUFBTTtvQkFDOUMsUUFBUSxFQUFFLGFBQWE7aUJBQzFCO2dCQUNELFNBQVMsRUFBRSxDQUFFLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFFOzthQUN2RSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgTmdab25lLFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgU2ltcGxlQ2hhbmdlc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUxvY2FsZSwgVGlMb2NhbGVGb3JtYXQgfSBmcm9tICcuLi8uLi9sb2NhbGUvVGlMb2NhbGVNb2R1bGUnO1xyXG5pbXBvcnQgeyBUaURhdGVVdGlsLCBUaUtleW1hcCwgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaUZvcm1Db21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IFRpRGF0ZUJhc2VDb21wb25lbnQsIFRpRGF0ZXRpbWVGb3JtYXQsIFRpbWVPcHRpb25zIH0gZnJvbSAnLi4vZGF0ZWJhc2UvVGlEYXRlQmFzZU1vZHVsZSc7XHJcblxyXG4vKipcclxuICogRGF0ZXRpbWXml6XmnJ/ml7bpl7Tnu4Tku7ZcclxuICpcclxuICogRGF0ZXRpbWXnu4Tku7bmj5DkvpvkuobkuIDnp43mlrnkvr/nmoTmmL7npLrlkozorr7nva7ml6XmnJ/ml7bpl7TnmoTmlrnlvI/jgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL2RhdGV0aW1lL2RhdGV0aW1lLWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndGktZGF0ZXRpbWUnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2RhdGV0aW1lLmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vZGF0ZXRpbWUubGVzcyddLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICdbY2xhc3MudGkzLWRhdGV0aW1lLWlucHV0LWNvbnRhaW5lcl0nOiAndHJ1ZScsXHJcbiAgICAgICAgJyhibHVyKSc6ICdoaWRlUGFuZWwoKSdcclxuICAgIH0sXHJcbiAgICBwcm92aWRlcnM6IFsgVGlGb3JtQ29tcG9uZW50LmdldFZhbHVlQWNjZXNzb3IoVGlEYXRldGltZUNvbXBvbmVudCkgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlEYXRldGltZUNvbXBvbmVudCBleHRlbmRzIFRpRGF0ZUJhc2VDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDphY3nva50aW1l57uE5Lu255qE5o6l5Y+jXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBiZWdpblRpbWU6IFRpbWVPcHRpb25zID0ge307XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaXpeacn+aYvuekuuagvOW8jzogRGF0ZXRpbWXnu4Tku7bnmoRmb3JtYXTkuLpEYXRldGltZUZvcm1hdOexu+Wei1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZm9ybWF0OiBUaURhdGV0aW1lRm9ybWF0O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmoIforrBkYXRlL2RhdGV0aW1l55qE57G75Z6LXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0RhdGV0aW1lOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog55So5LqO5qCH6K6w5piv5LiN5pivcmFuZ2VcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzUmFuZ2U6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogcGxhY2Vob2xkZXLmj5DnpLrmlofmnKxcclxuICAgICAqL1xyXG4gICAgcHVibGljIHBsYWNlaG9sZGVyOiBzdHJpbmcgPSBgJHtUaUxvY2FsZS5nZXRMb2NhbGVXb3JkcygpLnRpRGF0ZS5kYXRldGltZVBsYWNlaG9sZGVyfWA7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOaXp+aXtumXtOWAvFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb2xkVmFsdWU6IGFueSA9ICcnO1xyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5vbGRGb3JtYXQgPSB0aGlzLmZvcm1hdDtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgLy8g6aqM6K+B5pyA5aSn5YC85pyA5bCP5YC877yM5Li65LqG5aSE55CG5pyA5aSn5YC85ZKM5pyA5bCP5YC85LuO5ZCI5rOV5pel5pyf5Y+Y5Li6dW5kZWZpbmVkIOeahOaDheaZr1xyXG4gICAgICAgIGlmICgoY2hhbmdlc1snbWF4J10gJiYgIWNoYW5nZXNbJ21heCddLmZpcnN0Q2hhbmdlKSB8fCAoY2hhbmdlc1snbWluJ10gJiYgIWNoYW5nZXNbJ21pbiddLmZpcnN0Q2hhbmdlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlTWluQW5kTWF4KHRoaXMuY29uZmlnLCB0aGlzLmlzRGF0ZXRpbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0RvQ2hlY2soKTogdm9pZCB7XHJcbiAgICAgICAgLy8g55uR5ZCsZm9ybWF055qE5Y+Y5YyWXHJcbiAgICAgICAgdGhpcy5zZXRGb3JtYXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIG1vZGVs5YC85Y+Y5YyW5pe255qE5Zue6LCDXHJcbiAgICAgKi9cclxuICAgIG5nT25Nb2RlbENoYW5nZSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIVRpRGF0ZVV0aWwuaXNEYXRlKHRoaXMubW9kZWwpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZvcm1hdFZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy5zZXRPa0J0blN0YXRlKCk7XHJcbiAgICAgICAgdGhpcy5zZXRQaWNrZXJEYXRlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOehruiupOaMiemSrueahOeCueWHu+S6i+S7tuWkhOeQhlxyXG4gICAgICovXHJcbiAgICBvbk9rQ2xpY2soKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5WYWxpZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghVGlEYXRlVXRpbC5pc0RhdGUodGhpcy5kYXRlUGFuZWxbJ3ZhbHVlJ11bJ2JlZ2luJ10pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJvcENvbS5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDojrflj5bml7bpl7TnmoTlrZfnrKbkuLJcclxuICAgICAgICBjb25zdCBkYXRlU3RyOiBzdHJpbmcgPSBUaURhdGVVdGlsLmdldERhdGVTdHIodGhpcy5kYXRlUGFuZWxbJ3ZhbHVlJ11bJ2JlZ2luJ10pO1xyXG4gICAgICAgIC8vIOepuuagvOivr+WIoFxyXG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlOiBEYXRlID0gbmV3IERhdGUoYCR7ZGF0ZVN0cn0gJHtUaURhdGVVdGlsLmFkZENvbG9uKHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddKX1gKTtcclxuICAgICAgICAvLyDngrnlh7vnoa7orqTmjInpkq7lr7nmr5TmlrDml6flgLzvvJrnm7jnrYnkuI3lgZrlpITnkIbvvIzkuI3nm7jnrYnlsIbmlrDlgLzotYvnu5ltb2RlbFxyXG4gICAgICAgIGlmICghVGlEYXRlVXRpbC5pc0RhdGV0aW1lRXF1YWwodGhpcy5tb2RlbCwgbmV3VmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSBuZXdWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaGlkZURyb3AoKTtcclxuXHJcbiAgICAgICAgdGhpcy5va0NsaWNrLmVtaXQodGhpcy5tb2RlbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDorr7nva7kuIvmi4npnaLmnb/kuK1kYXRlUGFuZWznu4Tku7bmjqXlj6NcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXREYXRlUGFuZWwoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRlUGFuZWwgPSB7XHJcbiAgICAgICAgICAgIHBpY2tlcjogJ2RheScsXHJcbiAgICAgICAgICAgIG1heDogdGhpcy5tYXgsXHJcbiAgICAgICAgICAgIG1pbjogdGhpcy5taW4sXHJcbiAgICAgICAgICAgIGZvcm1hdCA6IHRoaXMuZm9ybWF0LFxyXG4gICAgICAgICAgICBub3dEYXRlVGltZTogdGhpcy5ub3dEYXRlVGltZSxcclxuICAgICAgICAgICAgdmFsdWUgOiB7XHJcbiAgICAgICAgICAgICAgICBiZWdpbjogdGhpcy5tb2RlbCxcclxuICAgICAgICAgICAgICAgIGVuZDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2VsZWN0OiAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDngrnlh7vml6XmnJ/pnaLmnb/lgLzvvIzmoKHpqozml7bpl7TnmoTmnIDlpKflgLzmnIDlsI/lgLxcclxuICAgICAgICAgICAgICAgIC8vIOWOn+WboO+8muW9k+mAieaLqeeahOaXpeacn+aYr+acgOWwj+aIluiAheacgOWkp+aXtu+8jOmcgOimgeagoemqjOW9k+WJjeeahOaXtumXtOaYr+WQpuWQiOazlVxyXG4gICAgICAgICAgICAgICAgLy8g6K6+5a6a5pe26Ze06IyD5Zu0XHJcbiAgICAgICAgICAgICAgICBpZiAoVGlEYXRlVXRpbC5pc0RhdGVFcXVhbCh0aGlzLmRhdGVQYW5lbFsndmFsdWUnXVsnYmVnaW4nXSwgdGhpcy5tYXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpblRpbWVbJ21heCddID0gVGlEYXRlVXRpbC5nZXRUaW1lU3RyKHRoaXMubWF4KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luVGltZVsnbWluJ10gPSAnMDA6MDA6MDAnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChUaURhdGVVdGlsLmlzRGF0ZUVxdWFsKHRoaXMuZGF0ZVBhbmVsWyd2YWx1ZSddWydiZWdpbiddLCB0aGlzLm1pbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luVGltZVsnbWF4J10gPSAnMjM6NTk6NTknO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lWydtaW4nXSA9IFRpRGF0ZVV0aWwuZ2V0VGltZVN0cih0aGlzLm1pbik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lWydtaW4nXSA9ICcwMDowMDowMCc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpblRpbWVbJ21heCddID0gJzIzOjU5OjU5JztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QmVnaW5UaW1lKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldE9rQnRuU3RhdGUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2VsZWN0VGltZUZuOiAob2JqOiBhbnkpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGltZUZuKG9iaiwgdGhpcy5iZWdpblRpbWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRPa0J0blN0YXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZXRCZWdpblRpbWUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZUVkaXREaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmJlZ2luVGltZVsndmFsdWUnXSA9IFRpRGF0ZVV0aWwuZ2V0VGltZVN0cihuZXcgRGF0ZSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gMS7ojrflj5bml7bpl7TnmoTlrZfnrKbkuLJcclxuICAgICAgICBjb25zdCBkYXRlU3RyOiBzdHJpbmcgPSBUaURhdGVVdGlsLmdldERhdGVTdHIodGhpcy5kYXRlUGFuZWxbJ3ZhbHVlJ11bJ2JlZ2luJ10pO1xyXG4gICAgICAgIC8vIOepuuagvOivr+WIoFxyXG4gICAgICAgIGNvbnN0IGRhdGV0aW1lU3RyOiBEYXRlID0gbmV3IERhdGUoYCR7ZGF0ZVN0cn0gJHtUaURhdGVVdGlsLmFkZENvbG9uKHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddKX1gKTtcclxuICAgICAgICAvLyDmnIDlpKflgLzmoKHpqoxcclxuICAgICAgICBpZiAoVGlEYXRlVXRpbC5pc0JpZ2dlcihkYXRldGltZVN0ciwgdGhpcy5tYXgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddID0gVGlEYXRlVXRpbC5nZXRUaW1lU3RyKHRoaXMubWF4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5pyA5bCP5YC85qCh6aqMXHJcbiAgICAgICAgaWYgKFRpRGF0ZVV0aWwuaXNTbWFsbGVyKGRhdGV0aW1lU3RyLCB0aGlzLm1pbikpIHtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblRpbWVbJ3ZhbHVlJ10gPSBUaURhdGVVdGlsLmdldFRpbWVTdHIodGhpcy5taW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy5iZWdpblRpbWVbJ3ZhbHVlJ107XHJcblxyXG4gICAgICAgIHRoaXMudGltZUVkaXREaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRcclxuICAgICAqIEBwYXJhbSB2YWxcclxuICAgICAqL1xyXG4gICAgb25LZXlkb3duRm4oZXZlbnQ6IEtleWJvYXJkRXZlbnQsIHZhbDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IFRpS2V5bWFwLktFWV9FTlRFUiAgfHwgZXZlbnQua2V5Q29kZSA9PT0gVGlLZXltYXAuS0VZX05VTVBBRF9FTlRFUikge1xyXG4gICAgICAgICAgICBpZiAoIVRpRGF0ZVV0aWwuaXNEYXRlKHZhbCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldEJlZ2luVGltZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldE9rQnRuU3RhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBlZGl0Qmx1cih2YWw6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh2YWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRCZWdpblRpbWUoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRPa0J0blN0YXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgIH1cclxuICAgIC8vIOiuvue9ruS4i+aLiemdouadv+S4rXRpbWXnu4Tku7bmjqXlj6NcclxuICAgIHByaXZhdGUgc2V0VGltZSgpOiB2b2lkIHtcclxuICAgICAgICAvLyB2YWx1ZeaOpeWPo+iuvue9rlxyXG4gICAgICAgIHRoaXMuc2V0VGltZVZhbHVlKCk7XHJcblxyXG4gICAgICAgIC8vIG1heFZhbHVl5o6l5Y+j6K6+572uXHJcbiAgICAgICAgdGhpcy5zZXRUaW1lTWF4VmFsdWUoKTtcclxuXHJcbiAgICAgICAgLy8gbWluVmFsdWXmjqXlj6Porr7nva5cclxuICAgICAgICB0aGlzLnNldFRpbWVNaW5WYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0VGltZVZhbHVlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddID0gVGlEYXRlVXRpbC5pc0RhdGUodGhpcy5tb2RlbCkgPyAgVGlEYXRlVXRpbC5nZXRUaW1lU3RyKHRoaXMubW9kZWwpIDogJyc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUaW1lTWF4VmFsdWUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCFUaURhdGVVdGlsLmlzRGF0ZSh0aGlzLm1vZGVsKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmJlZ2luVGltZVsnbWF4J10gPSAoVGlEYXRlVXRpbC5pc0RhdGVFcXVhbCh0aGlzLm1vZGVsLCB0aGlzLm1heCkpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGlEYXRlVXRpbC5nZXRUaW1lU3RyKHRoaXMubWF4KSA6ICcyMzo1OTo1OSc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUaW1lTWluVmFsdWUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCFUaURhdGVVdGlsLmlzRGF0ZSh0aGlzLm1vZGVsKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmJlZ2luVGltZVsnbWluJ10gPSAoVGlEYXRlVXRpbC5pc0RhdGVFcXVhbCh0aGlzLm1vZGVsLCB0aGlzLm1pbikpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGlEYXRlVXRpbC5nZXRUaW1lU3RyKHRoaXMubWluKSA6ICcwMDowMDowMCc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc1ZhbGlkVmFsdWUodmFsdWU6IERhdGUpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoVGlEYXRlVXRpbC5pc0RhdGUodmFsdWUpICYmIFRpRGF0ZVV0aWwuaXNCZXR3ZWVuTWF4QW5kbWluKHZhbHVlLCB0aGlzLm1pbiwgdGhpcy5tYXgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0UGlja2VyRGF0ZSgpOiB2b2lkIHtcclxuICAgICAgICAvLyDorr7nva7kuIvmi4npnaLmnb/kuK1kYXRlUGFuZWznu4Tku7bmjqXlj6NcclxuICAgICAgICB0aGlzLnNldERhdGVQYW5lbCgpO1xyXG5cclxuICAgICAgICAvLyDorr7nva7kuIvmi4npnaLmnb/kuK10aW1l57uE5Lu25o6l5Y+jXHJcbiAgICAgICAgdGhpcy5zZXRUaW1lKCk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0T2tCdG5TdGF0ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLnRpbWVFZGl0RGlzYWJsZWQgPSBUaURhdGVVdGlsLmlzRGF0ZSh0aGlzLm1vZGVsKSA/IGZhbHNlIDogdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMudGltZUVkaXREaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFRpbWUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDorr7nva7noa7orqTmjInpkq7nmoTnirbmgIFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldE9rQnRuU3RhdGUoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g6L6T5YWl5Lit5paH5YaS5Y+35LmL5ZCO77yM5Y+K5pe26L2s5o2i5Li66Iux5paH5YaS5Y+3XHJcbiAgICAgICAgY29uc3QgaW5wdXR2YWx1ZTogc3RyaW5nID0gdGhpcy5iZWdpblRpbWUudmFsdWU7XHJcbiAgICAgICAgaWYgKCFVdGlsLmlzVW5kZWZpbmVkKGlucHV0dmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lLnZhbHVlID0gaW5wdXR2YWx1ZS5yZXBsYWNlKCfvvJonLCAnOicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBkYXRlOiBEYXRlID0gdGhpcy5kYXRlUGFuZWwudmFsdWUuYmVnaW47XHJcbiAgICAgICAgaWYgKCFUaURhdGVVdGlsLmlzRGF0ZShkYXRlKSkge1xyXG4gICAgICAgICAgICB0aGlzLmluVmFsaWRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZVRpbWU6IERhdGUgPSBuZXcgRGF0ZShcclxuICAgICAgICAgICAgICAgIGAke1RpRGF0ZVV0aWwuZ2V0RGF0ZVN0cihkYXRlKX0gJHtUaURhdGVVdGlsLmFkZENvbG9uKHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddKX1gKTtcclxuICAgICAgICAgICAgdGhpcy5pblZhbGlkVmFsdWUgPSAhVGlEYXRlVXRpbC5pc0JldHdlZW5NYXhBbmRtaW4oZGF0ZVRpbWUsIHRoaXMubWluLCB0aGlzLm1heCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmJ1dHRvbkNvbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyKHRoaXMuYnV0dG9uQ29tcy5sYXN0Lm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcsIHRoaXMuaW5WYWxpZFZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRJbnB1dFN0eWxlKHRoaXMuaW5WYWxpZFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlsIZ2YWx1Zei9rOaNouS4umZvcm1hdOaOpeWPo+agvOW8j+eahOWtl+espuS4slxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZm9ybWF0VmFsdWUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gJyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g56m65qC86K+v5YigXHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdDogc3RyaW5nID0gYCR7dGhpcy5mb3JtYXQuZGF0ZX0gJHtUaURhdGVVdGlsLmFkZEFtUG0odGhpcy5mb3JtYXQudGltZSl9YDtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gVGlMb2NhbGVGb3JtYXQuZm9ybWF0RGF0ZVRpbWUodGhpcy5tb2RlbCwgZm9ybWF0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IFRpRGF0ZVV0aWwuZ2V0VGltZVN0cih0aGlzLm1vZGVsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5pe26Ze05qGG5aSx54Sm5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0aW1lQmx1cigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVRpbWVWYWx1ZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDml7bpl7TmoYZlbnRlcuS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdGltZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gVGlLZXltYXAuS0VZX0VOVEVSICB8fCBldmVudC5rZXlDb2RlID09PSBUaUtleW1hcC5LRVlfTlVNUEFEX0VOVEVSKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlVGltZVZhbHVlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiB0aW1l5pe26Ze05qGG6L6T5YWl5YaF5a655aSE55CGXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoYW5kbGVUaW1lVmFsdWUoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5Yy65YiG5Lit6Iux5paH5YaS5Y+3XHJcbiAgICAgICAgY29uc3QgcmVnOiBSZWdFeHAgPSBuZXcgUmVnRXhwKCdbXFxcXDpcXFxc77yaXScpO1xyXG4gICAgICAgIGNvbnN0IGRhdGVSZWc6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1vlubRcXFxc5pyIXFxcXOaXpVxcXFwtXFxcXC9cXFxcLlxcXFxfXScpO1xyXG4gICAgICAgIC8vIOi+k+WFpeWMuumXtOaYr+WQpuWtmOWcqOWwj+aVsOeCue+8jOmdnuaVtOaVsFxyXG4gICAgICAgIGxldCBpc05vdEludGVnZXI6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmJlZ2luVGltZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5iZWdpblRpbWUpKTtcclxuXHJcbiAgICAgICAgY29uc3QgdGltZUFycjogQXJyYXk8c3RyaW5nPiA9IHRoaXMuYmVnaW5UaW1lLnZhbHVlLnNwbGl0KHJlZyk7XHJcbiAgICAgICAgdGltZUFyci5mb3JFYWNoKChpdGVtOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aW1lQXJyW2luZGV4XSA9ICcwJyArIGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KGl0ZW0sIDEwKSAhPT0gTnVtYmVyKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICBpc05vdEludGVnZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZGF0ZVN0cjogc3RyaW5nID0gVGlEYXRlVXRpbC5nZXREYXRlU3RyKHRoaXMuZGF0ZVBhbmVsWyd2YWx1ZSddWydiZWdpbiddKTtcclxuICAgICAgICBjb25zdCBkYXRlQXJyOiBBcnJheTxhbnk+ID0gZGF0ZVN0ci5zcGxpdChkYXRlUmVnKTtcclxuICAgICAgICB0aGlzLmJlZ2luVGltZS52YWx1ZSA9IHRpbWVBcnIuam9pbignOicpO1xyXG4gICAgICAgIGNvbnN0IGRhdGV0aW1lOiBEYXRlID0gbmV3IERhdGUoYCR7ZGF0ZVN0cn0gJHtUaURhdGVVdGlsLmFkZENvbG9uKHRoaXMuYmVnaW5UaW1lWyd2YWx1ZSddKX1gKTtcclxuICAgICAgICBjb25zdCBkYXRlVmFsOiBEYXRlID0gbmV3IERhdGUocGFyc2VJbnQoZGF0ZUFyclswXSwgMTApLCBwYXJzZUludChkYXRlQXJyWzFdLCAxMCksIHBhcnNlSW50KGRhdGVBcnJbMl0sIDEwKSxcclxuICAgICAgICBwYXJzZUludCh0aW1lQXJyWzBdLCAxMCksIHBhcnNlSW50KHRpbWVBcnJbMV0sIDEwKSwgcGFyc2VJbnQodGltZUFyclsyXSwgMTApKTtcclxuICAgICAgICBpZiAoU3RyaW5nKGRhdGV0aW1lKSA9PT0gJ0ludmFsaWQgRGF0ZScgfHwgU3RyaW5nKGRhdGVWYWwpID09PSAnSW52YWxpZCBEYXRlJyB8fCB0aW1lQXJyLmxlbmd0aCA+IDMgfHwgaXNOb3RJbnRlZ2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5zZXRPa0J0blN0YXRlKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLmJlZ2luVGltZS52YWx1ZTtcclxuICAgICAgICB0aGlzLnNldE9rQnRuU3RhdGUoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIOWIpOivu+Wtl+espuS4suaYr+WQpuaYr+WQiOazleeahOaXtumXtFxyXG4gICAgICogQHBhcmFtOiB0aW1lOiDmoKHpqoznmoTml7bpl7RcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpc1ZhbGlkVGltZSh0aW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIVV0aWwuaXNTdHJpbmcodGltZSkgfHwgdGltZS50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGF0ZTogYW55ID0gbmV3IERhdGUoYDIwMTgvNS8xNSAke3RpbWV9YCk7XHJcblxyXG4gICAgICAgIHJldHVybiAhKFN0cmluZyhkYXRlKSA9PT0gJ0ludmFsaWQgRGF0ZScpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==