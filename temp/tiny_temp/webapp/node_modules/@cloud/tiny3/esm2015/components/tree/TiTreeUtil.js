import { Util } from '../../utils/Util';
/**
 *
 * 用于封装给树组件 [TiTreeComponent]{@link ../components/TiTreeComponent.html}
 * 提供公共方法，包括增、删、改、查、选中、取消选中、遍历、筛选、获取选中项等操作
 */
export class TiTreeUtil {
    /**
     * 根据某node节点查找其父节点
     * @param  data 所有节点数据
     * @param node 已知node节点
     */
    static getParentNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        for (const item of data) {
            if (!TiTreeUtil.isLeaf(item)) {
                if (item.children.indexOf(node) !== -1) {
                    return item;
                }
                else {
                    const result = TiTreeUtil.getParentNode(item.children, node);
                    if (result) {
                        return result;
                    }
                }
            }
        }
    }
    /**
     * 遍历整个树
     * @param data 所有节点数据
     * @param traverseFn 对各个节点执行的操作
     */
    static traverse(data, traverseFn) {
        if (!Util.isFunction(traverseFn) || !Array.isArray(data)) {
            return;
        }
        for (const item of data) {
            traverseFn(item);
            if (!TiTreeUtil.isLeaf(item)) {
                TiTreeUtil.traverse(item.children, traverseFn);
            }
        }
    }
    /**
     * 多选树，更新各节点的选中状态。
     * 适用场景：手动添加或删除若干节点，当前节点的兄弟节点和父节点的选中状态不一致。
     * 10.0.1 新增
     * @param data  所有节点数据
     */
    static updateChecked(data) {
        TiTreeUtil.check(data);
    }
    /**
     * 检查但前数据的多选状态
     * @param data 当前节点集合
     * @param allData 全部数据集合
     */
    static check(data, allData) {
        let resultData;
        // 如果不传allData，data 是所有数据，此函数递归调用，data之后不是全部数据
        resultData = !allData ? data : allData;
        for (const item of data) {
            if (!TiTreeUtil.isLeaf(item)) {
                if (TiTreeUtil.isLeafsParentNode(item)) {
                    // 根据子叶子节点计算当前节点的复选状态
                    const computedChecked = TiTreeUtil.computeChecked(item);
                    if (computedChecked !== item.checked) {
                        item.checked = computedChecked;
                        if (computedChecked === true) {
                            TiTreeUtil.selectParents(item, resultData, true);
                        }
                        else {
                            TiTreeUtil.deSelectParents(item, resultData);
                        }
                    }
                }
                else {
                    TiTreeUtil.check(item.children, resultData);
                }
            }
        }
    }
    /**
     * 当前节点是否是叶子节点的父节点，
     * 因为更新节点的选中状态时，根据叶子节点的选中状态计算出父节点的选中状态，再更新父节点的选中状态。
     * @param node 当前节点
     */
    static isLeafsParentNode(node) {
        if (!Array.isArray(node.children)) {
            return false;
        }
        else {
            for (const child of node.children) {
                if (Array.isArray(child.children)) {
                    return false;
                }
            }
            return true;
        }
    }
    /**
     * 根据子节点的多选状态，计算出当前节点的多选状态
     * @param node 当前节点
     */
    static computeChecked(node) {
        const childrens = node.children;
        let selectedNum = 0;
        let unSelectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true) {
                selectedNum++;
            }
            else if (!child.checked) { // false和undefined 两种
                unSelectedNum++;
            }
        }
        if (selectedNum === childrens.length) {
            return true;
        }
        else if (unSelectedNum === childrens.length) {
            return false;
        }
        else {
            return 'indeterminate';
        }
    }
    /**
     * 添加节点
     * @param data 所有节点数据
     * @param node  需要添加的节点：一个或多个节点
     * @param index  添加的位置: -1表示从尾部追加
     * @param pNode 指定要添加的节点的父节点，如果没有指定的话默认添加到根节点
     */
    static addNode(data, node, index, pNode) {
        const k = parseInt(index, 10);
        if (isNaN(k) || !Array.isArray(data)) {
            return;
        }
        const nodes = Array.isArray(node) ? node : [node];
        // 当没有指定父节点时，默认将节点添加到根节点
        if (!pNode) {
            const resuleIndex = index === -1 ? data.length : index;
            for (let i = 0; i < nodes.length; i++) {
                data.splice(resuleIndex + i, 0, nodes[i]);
            }
            return;
        }
        // 如果父节点是叶子节点时，给叶子节点添加children数组
        if (TiTreeUtil.isLeaf(pNode)) {
            pNode.children = [];
        }
        // 根据Index值，将node插入指定位置
        if (index === -1) {
            pNode.children = pNode.children.concat(nodes); // 返回值为新数组
        }
        else {
            for (let j = 0; j < nodes.length; j++) {
                pNode.children.splice(index + j, 0, nodes[j]);
            }
        }
    }
    /**
     * 删除一个节点
     * @param  data 所有节点数据
     * @param  node  节点
     */
    static removeNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        // 找到不匹配搜索内容的叶子节点并删除。为了避免要删除的元素在数组中的索引改变，从后向前循环
        for (let i = data.length - 1; i >= 0; i--) {
            if (data[i] === node) {
                TiTreeUtil.deleteArr(data, i);
                return;
            }
            if (!TiTreeUtil.isLeaf(data[i])) {
                TiTreeUtil.removeNode(data[i].children, node);
            }
        }
    }
    // 3.0.3 selectNode/unSelectNode第三个参数：是否单选, 改为是否多选。已确认无人使用。
    // TODO：这两个函数的重复代码，可以合并
    /**
     * 选中某个节点
     * @param  data 所有节点数据
     * @param  node  节点
     * @param  multiple 是否多选模式
     */
    static selectNode(data, node, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        if (!multiple) { // 单选模式
            TiTreeUtil.traverse(data, (travNode) => {
                travNode.checked = false; // 清空所有的选中项
            });
            node.checked = true; // 将当前项置为选中
        }
        else { // 多选
            TiTreeUtil.selectAllChildren(node); // 先置当前节点选中，如果当前节点是非叶子节点 递归让其子节点全部选中
            TiTreeUtil.selectParents(node, data, true); // 设置父节点选中情况
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * 取消选中某个节点
     * @param data 所有节点数据
     * @param node  节点
     * @param multiple 是否多选模式
     */
    static deSelectNode(data, node, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        if (!multiple) {
            TiTreeUtil.traverse(data, (travNode) => {
                travNode.checked = false; // 清空所有的选中项
            });
        }
        else {
            TiTreeUtil.deSelectAllChildren(node);
            TiTreeUtil.deSelectParents(node, data);
        }
    }
    /**
     * 展开id所有父节点
     * @param  data 所有节点数据
     * @param  node  节点
     */
    static expandNode(data, node) {
        if (!Array.isArray(data)) {
            return;
        }
        let num = 0;
        let result = false;
        for (const item of data) {
            if (item === node) {
                num++;
            }
            else if (!TiTreeUtil.isLeaf(item)) {
                result = TiTreeUtil.expandNode(item.children, node);
                if (result) {
                    item.expanded = true;
                    num++;
                }
            }
        }
        return (num > 0);
    }
    /**
     * 根据用户传入的方法筛选节点的数据
     * @param data 所有节点数据
     * @param  matchFn 用户传入匹配节点的方法
     * @returns 是否找到
     */
    static search(data, matchFn) {
        if (!Util.isFunction(matchFn) || !Array.isArray(data)) {
            return false;
        }
        let findNum = 0;
        let isFind = false;
        // 找到不匹配搜索内容的叶子节点并删除。为了避免要删除的元素在数组中的索引改变，从后向前循环
        for (let i = data.length - 1; i >= 0; i--) {
            if (!matchFn(data[i]) && !TiTreeUtil.isLeaf(data[i])) { // 未匹配到且为父节点
                isFind = TiTreeUtil.search(data[i].children, matchFn);
                if (isFind) {
                    findNum++;
                }
                else {
                    TiTreeUtil.deleteArr(data, i);
                }
            }
            else if (matchFn(data[i])) { // 匹配到
                findNum++;
            }
            else { // 未匹配到且为叶子节点
                TiTreeUtil.deleteArr(data, i);
            }
        }
        return (findNum > 0);
    }
    /**
     * 获取选中项
     * @param data 所有节点数据
     * @param  onlySelectLeaf 选中项中是否只包含叶子节点
     * @param  multiple 是否多选模式
     */
    static getSelectedData(data, onlySelectLeaf, multiple) {
        // 每次遍历之前需要清空当前选中项列表
        TiTreeUtil.selectedData = [];
        TiTreeUtil.querySelectedNode(data, onlySelectLeaf, multiple);
        return TiTreeUtil.selectedData;
    }
    /**
     * @ignore
     * @description 根据整棵树的节点数据，查询所有选中项，并更新selectedData
     * @param data 全部节点数据
     * @param onlySelectLeaf 全部节点数据
     */
    static querySelectedNode(data, onlySelectLeaf, multiple) {
        let tempNode;
        for (let i = 0; i < data.length; i++) {
            tempNode = data[i];
            if (TiTreeUtil.checkedParentNode(tempNode)) { // 父节点半选或选中
                TiTreeUtil.pnode.push(tempNode);
                TiTreeUtil.querySelectedNode(tempNode.children, onlySelectLeaf, multiple);
                // 单选情况下仅查找到第一个选中的叶子节点即可
                if (!multiple) {
                    break;
                }
            }
            else if (TiTreeUtil.checkedLeafNode(tempNode)) { // 叶子节点选中
                TiTreeUtil.selectedData.push(tempNode);
                if (!onlySelectLeaf) {
                    tempNode.parent = TiTreeUtil.pnode.concat();
                    // 单选情况下仅查找到第一个选中的叶子节点即可
                    if (!multiple) {
                        TiTreeUtil.pnode.splice(0, TiTreeUtil.pnode.length);
                        break;
                    }
                }
            }
            // 遍历到最后一项时将父节点从pnode中移除
            if (i === data.length - 1) {
                TiTreeUtil.pnode.pop();
            }
        }
    }
    /**
     * @ignore
     * @description 判断节点node是否是一个处于选中或半选状态的父节点
     * @param node 节点数据
     */
    static checkedParentNode(node) {
        return (node.checked === true || node.checked === 'indeterminate') && !TiTreeUtil.isLeaf(node);
    }
    /**
     * @ignore
     * @description 判断节点node是否是一个处于选中状态的叶子节点
     * @param node 节点数据
     */
    static checkedLeafNode(node) {
        return (node.checked === true) && (TiTreeUtil.isLeaf(node));
    }
    /**
     * @ignore
     * 判断是否为叶子节点
     */
    static isLeaf(item) {
        return !(Util.isArray(item.children));
    }
    /**
     * @ignore
     * 从数组arr中删除下标为index的节点
     */
    static deleteArr(arr, index) {
        arr.splice(index, 1);
    }
    // TODO: checked传入false时，与deSelectParents有什么区别？可以合并么？
    /**
     * @ignore
     * 当子节点选中时，设置祖先元素的选中状态
     * @param item 子节点的数据
     * @param allData 全部节点数据
     * @param checked 取值为：true/false/'indeterminate'
     */
    static selectParents(item, allData, checked) {
        const pNode = TiTreeUtil.getParentNode(allData, item);
        if (Util.isUndefined(pNode)) {
            return;
        }
        // 当子元素为半选时，祖先元素一律设置为半选状态
        if (checked === 'indeterminate') {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
            return;
        }
        const childrens = pNode.children;
        let selectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true) {
                selectedNum++;
            }
        }
        if (selectedNum === childrens.length) {
            pNode.checked = true;
            TiTreeUtil.selectParents(pNode, allData, true);
        }
        else {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
        }
    }
    /**
     * @ignore
     * 根据父节点选择子节点
     */
    static selectAllChildren(item) {
        // 如果子节点是禁用状态不做处理；
        if (item.disabled !== true) {
            item.checked = true;
        }
        if (!TiTreeUtil.isLeaf(item)) {
            item.children.forEach((child) => {
                TiTreeUtil.selectAllChildren(child);
            });
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * @ignore
     * 多选状态下，父节点取消选中，置子节点都为取消选中状态
     * @param item 子节点的数据
     */
    static deSelectAllChildren(item) {
        if (item.disabled !== true) {
            item.checked = false;
        }
        if (Util.isArray(item.children) && item.children.length > 0) {
            item.children.forEach((child) => {
                TiTreeUtil.deSelectAllChildren(child);
            });
        }
    }
    // TODO:Tiny4 deselect改为unselect
    /**
     * @ignore
     * 当前节点取消选中时，设置祖先元素的选中状态
     * @param item 当前节点的数据
     * @param allData 全部的节点数据
     */
    static deSelectParents(item, allData) {
        const pNode = TiTreeUtil.getParentNode(allData, item);
        if (Util.isUndefined(pNode)) {
            return;
        }
        const childrens = pNode.children;
        let selectedNum = 0;
        for (const child of childrens) {
            if (child.checked === true || child.checked === 'indeterminate') {
                selectedNum++;
            }
        }
        if (selectedNum === 0) {
            pNode.checked = false;
            TiTreeUtil.deSelectParents(pNode, allData);
        }
        else {
            pNode.checked = 'indeterminate';
            TiTreeUtil.selectParents(pNode, allData, 'indeterminate');
        }
    }
    /**
     * @ignore
     * drop event
     * @param event 拖拽数据
     * @param data 所用节点数据
     * @param multiple 多选
     */
    static dropApply(event, data, multiple) {
        if (!Array.isArray(data)) {
            return;
        }
        const dragNode = event.dragNode; // 拖拽节点
        const dragParentNode = TiTreeUtil.getParentNode(data, dragNode); // 拖拽节点的父节点
        const dropNode = event.targetNode; // 拖放节点
        const dropParentNode = TiTreeUtil.getParentNode(data, dropNode); // 拖放节点的父节点
        const dropPosition = event.dropPosition; // 拖拽位置
        TiTreeUtil.removeNode(data, dragNode);
        // 拖拽父节点无子节点时，删除children属性，此处是为解决当children为空时，展开收起图标还会存在的问题
        if ((dragParentNode === null || dragParentNode === void 0 ? void 0 : dragParentNode.children.length) < 1) {
            delete dragParentNode.children;
        }
        if (dropPosition === 0) {
            TiTreeUtil.addNode(data, [dragNode], -1, dropNode);
        }
        else {
            let index;
            if (!dropParentNode) { // 拖放节点为顶级级节点时
                index = data.indexOf(dropNode);
                if (dropPosition === -1) {
                    data.splice(index, 0, dragNode);
                }
                else {
                    data.splice(index + 1, 0, dragNode);
                }
            }
            else {
                index = dropParentNode.children.indexOf(dropNode);
                if (dropPosition === -1) {
                    TiTreeUtil.addNode(data, [dragNode], index, dropParentNode);
                }
                else {
                    TiTreeUtil.addNode(data, [dragNode], index + 1, dropParentNode);
                }
            }
        }
        // 多选
        if (multiple) {
            TiTreeUtil.updateChecked(data);
        }
    }
}
TiTreeUtil.selectedData = [];
TiTreeUtil.pnode = [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlUcmVlVXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL3RyZWUvVGlUcmVlVXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFeEM7Ozs7R0FJRztBQUNILE1BQU0sT0FBTyxVQUFVO0lBR25COzs7O09BSUc7SUFDSSxNQUFNLENBQUMsYUFBYSxDQUFDLElBQXVCLEVBQUUsSUFBZ0I7UUFDakUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdEIsT0FBTztTQUNWO1FBRUQsS0FBSyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDckIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzFCLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0JBQ3BDLE9BQU8sSUFBSSxDQUFDO2lCQUNmO3FCQUFNO29CQUNILE1BQU0sTUFBTSxHQUFlLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDekUsSUFBSSxNQUFNLEVBQUU7d0JBQ1IsT0FBTyxNQUFNLENBQUM7cUJBQ2pCO2lCQUNKO2FBQ0o7U0FDSjtJQUNMLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUF1QixFQUFFLFVBQW9CO1FBQ2hFLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN0RCxPQUFPO1NBQ1Y7UUFFRCxLQUFLLE1BQU0sSUFBSSxJQUFJLElBQUksRUFBRTtZQUNyQixVQUFV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QUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRyxjQUFjLENBQUMsQ0FBQztpQkFDaEU7cUJBQU07b0JBQ0gsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFHLGNBQWMsQ0FBQyxDQUFDO2lCQUNwRTthQUNKO1NBQ0o7UUFDRCxLQUFLO1FBQ0wsSUFBSSxRQUFRLEVBQUU7WUFDVCxVQUFVLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQzs7QUEzZ0JjLHVCQUFZLEdBQXNCLEVBQUUsQ0FBQztBQUNyQyxnQkFBSyxHQUFzQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbHMvVXRpbCc7XHJcbmltcG9ydCB7IFRpVHJlZU5vZGUsIFRpVHJlZURyYWdOb2RlIH0gZnJvbSAnLi9UaVRyZWVDb21wb25lbnQnO1xyXG4vKipcclxuICpcclxuICog55So5LqO5bCB6KOF57uZ5qCR57uE5Lu2IFtUaVRyZWVDb21wb25lbnRde0BsaW5rIC4uL2NvbXBvbmVudHMvVGlUcmVlQ29tcG9uZW50Lmh0bWx9XHJcbiAqIOaPkOS+m+WFrOWFseaWueazle+8jOWMheaLrOWinuOAgeWIoOOAgeaUueOAgeafpeOAgemAieS4reOAgeWPlua2iOmAieS4reOAgemBjeWOhuOAgeetm+mAieOAgeiOt+WPlumAieS4remhueetieaTjeS9nFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFRpVHJlZVV0aWwge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2VsZWN0ZWREYXRhOiBBcnJheTxUaVRyZWVOb2RlPiA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcG5vZGU6IEFycmF5PFRpVHJlZU5vZGU+ID0gW107XHJcbiAgICAvKipcclxuICAgICAqIOagueaNruafkG5vZGXoioLngrnmn6Xmib7lhbbniLboioLngrlcclxuICAgICAqIEBwYXJhbSAgZGF0YSDmiYDmnInoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSBub2RlIOW3suefpW5vZGXoioLngrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRQYXJlbnROb2RlKGRhdGE6IEFycmF5PFRpVHJlZU5vZGU+LCBub2RlOiBUaVRyZWVOb2RlKTogVGlUcmVlTm9kZSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmICghVGlUcmVlVXRpbC5pc0xlYWYoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuLmluZGV4T2Yobm9kZSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogVGlUcmVlTm9kZSA9IFRpVHJlZVV0aWwuZ2V0UGFyZW50Tm9kZShpdGVtLmNoaWxkcmVuLCBub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YGN5Y6G5pW05Liq5qCRXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmiYDmnInoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSB0cmF2ZXJzZUZuIOWvueWQhOS4quiKgueCueaJp+ihjOeahOaTjeS9nFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHRyYXZlcnNlKGRhdGE6IEFycmF5PFRpVHJlZU5vZGU+LCB0cmF2ZXJzZUZuOiBGdW5jdGlvbik6IHZvaWQge1xyXG4gICAgICAgIGlmICghVXRpbC5pc0Z1bmN0aW9uKHRyYXZlcnNlRm4pIHx8ICFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhKSB7XHJcbiAgICAgICAgICAgIHRyYXZlcnNlRm4oaXRlbSk7XHJcbiAgICAgICAgICAgIGlmICghVGlUcmVlVXRpbC5pc0xlYWYoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UoaXRlbS5jaGlsZHJlbiwgdHJhdmVyc2VGbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlpJrpgInmoJHvvIzmm7TmlrDlkIToioLngrnnmoTpgInkuK3nirbmgIHjgIJcclxuICAgICAqIOmAgueUqOWcuuaZr++8muaJi+WKqOa3u+WKoOaIluWIoOmZpOiLpeW5suiKgueCue+8jOW9k+WJjeiKgueCueeahOWFhOW8n+iKgueCueWSjOeItuiKgueCueeahOmAieS4reeKtuaAgeS4jeS4gOiHtOOAglxyXG4gICAgICogMTAuMC4xIOaWsOWinlxyXG4gICAgICogQHBhcmFtIGRhdGEgIOaJgOacieiKgueCueaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHVwZGF0ZUNoZWNrZWQoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4pOiB2b2lkIHtcclxuICAgICAgICBUaVRyZWVVdGlsLmNoZWNrKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qOA5p+l5L2G5YmN5pWw5o2u55qE5aSa6YCJ54q25oCBXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlvZPliY3oioLngrnpm4blkIhcclxuICAgICAqIEBwYXJhbSBhbGxEYXRhIOWFqOmDqOaVsOaNrumbhuWQiFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBjaGVjayhkYXRhOiBBcnJheTxUaVRyZWVOb2RlPiwgYWxsRGF0YT86IEFycmF5PFRpVHJlZU5vZGU+KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHJlc3VsdERhdGE6IEFycmF5PFRpVHJlZU5vZGU+O1xyXG4gICAgICAgIC8vIOWmguaenOS4jeS8oGFsbERhdGHvvIxkYXRhIOaYr+aJgOacieaVsOaNru+8jOatpOWHveaVsOmAkuW9kuiwg+eUqO+8jGRhdGHkuYvlkI7kuI3mmK/lhajpg6jmlbDmja5cclxuICAgICAgICByZXN1bHREYXRhID0gIWFsbERhdGEgPyBkYXRhIDogYWxsRGF0YTtcclxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoIVRpVHJlZVV0aWwuaXNMZWFmKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGlUcmVlVXRpbC5pc0xlYWZzUGFyZW50Tm9kZShpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOagueaNruWtkOWPtuWtkOiKgueCueiuoeeul+W9k+WJjeiKgueCueeahOWkjemAieeKtuaAgVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXB1dGVkQ2hlY2tlZDogYm9vbGVhbiB8IHN0cmluZyA9IFRpVHJlZVV0aWwuY29tcHV0ZUNoZWNrZWQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXB1dGVkQ2hlY2tlZCAhPT0gaXRlbS5jaGVja2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGNvbXB1dGVkQ2hlY2tlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXB1dGVkQ2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5zZWxlY3RQYXJlbnRzKGl0ZW0sIHJlc3VsdERhdGEsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5kZVNlbGVjdFBhcmVudHMoaXRlbSwgcmVzdWx0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuY2hlY2soaXRlbS5jaGlsZHJlbiwgcmVzdWx0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY3oioLngrnmmK/lkKbmmK/lj7blrZDoioLngrnnmoTniLboioLngrnvvIxcclxuICAgICAqIOWboOS4uuabtOaWsOiKgueCueeahOmAieS4reeKtuaAgeaXtu+8jOagueaNruWPtuWtkOiKgueCueeahOmAieS4reeKtuaAgeiuoeeul+WHuueItuiKgueCueeahOmAieS4reeKtuaAge+8jOWGjeabtOaWsOeItuiKgueCueeahOmAieS4reeKtuaAgeOAglxyXG4gICAgICogQHBhcmFtIG5vZGUg5b2T5YmN6IqC54K5XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGlzTGVhZnNQYXJlbnROb2RlKG5vZGU6IFRpVHJlZU5vZGUpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZS5jaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGQuY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7lrZDoioLngrnnmoTlpJrpgInnirbmgIHvvIzorqHnrpflh7rlvZPliY3oioLngrnnmoTlpJrpgInnirbmgIFcclxuICAgICAqIEBwYXJhbSBub2RlIOW9k+WJjeiKgueCuVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBjb21wdXRlQ2hlY2tlZChub2RlOiBUaVRyZWVOb2RlKTogYm9vbGVhbiB8IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRyZW5zOiBBcnJheTxUaVRyZWVOb2RlPiA9IG5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkTnVtOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGxldCB1blNlbGVjdGVkTnVtOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW5zKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5jaGVja2VkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZE51bSsrO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFjaGlsZC5jaGVja2VkKSB7IC8vIGZhbHNl5ZKMdW5kZWZpbmVkIOS4pOenjVxyXG4gICAgICAgICAgICAgICAgdW5TZWxlY3RlZE51bSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZWxlY3RlZE51bSA9PT0gY2hpbGRyZW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHVuU2VsZWN0ZWROdW0gPT09IGNoaWxkcmVucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnaW5kZXRlcm1pbmF0ZSc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5re75Yqg6IqC54K5XHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmiYDmnInoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSBub2RlICDpnIDopoHmt7vliqDnmoToioLngrnvvJrkuIDkuKrmiJblpJrkuKroioLngrlcclxuICAgICAqIEBwYXJhbSBpbmRleCAg5re75Yqg55qE5L2N572uOiAtMeihqOekuuS7juWwvumDqOi/veWKoFxyXG4gICAgICogQHBhcmFtIHBOb2RlIOaMh+Wumuimgea3u+WKoOeahOiKgueCueeahOeItuiKgueCue+8jOWmguaenOayoeacieaMh+WumueahOivnem7mOiupOa3u+WKoOWIsOagueiKgueCuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFkZE5vZGUoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIG5vZGU6IEFycmF5PFRpVHJlZU5vZGU+LCBpbmRleDogYW55LCBwTm9kZT86IFRpVHJlZU5vZGUpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBrOiBudW1iZXIgPSBwYXJzZUludChpbmRleCwgMTApO1xyXG4gICAgICAgIGlmIChpc05hTihrKSB8fCAhQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBub2RlczogQXJyYXk8VGlUcmVlTm9kZT4gPSBBcnJheS5pc0FycmF5KG5vZGUpID8gbm9kZSA6IFtub2RlXTtcclxuICAgICAgICAvLyDlvZPmsqHmnInmjIflrprniLboioLngrnml7bvvIzpu5jorqTlsIboioLngrnmt7vliqDliLDmoLnoioLngrlcclxuICAgICAgICBpZiAoIXBOb2RlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsZUluZGV4OiBhbnkgPSBpbmRleCA9PT0gLTEgPyBkYXRhLmxlbmd0aCA6IGluZGV4O1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGRhdGEuc3BsaWNlKHJlc3VsZUluZGV4ICsgaSwgMCwgbm9kZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlpoLmnpzniLboioLngrnmmK/lj7blrZDoioLngrnml7bvvIznu5nlj7blrZDoioLngrnmt7vliqBjaGlsZHJlbuaVsOe7hFxyXG4gICAgICAgIGlmIChUaVRyZWVVdGlsLmlzTGVhZihwTm9kZSkpIHtcclxuICAgICAgICAgICAgcE5vZGUuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOagueaNrkluZGV45YC877yM5bCGbm9kZeaPkuWFpeaMh+WumuS9jee9rlxyXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcE5vZGUuY2hpbGRyZW4gPSBwTm9kZS5jaGlsZHJlbi5jb25jYXQobm9kZXMpOyAvLyDov5Tlm57lgLzkuLrmlrDmlbDnu4RcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqOiBudW1iZXIgPSAwOyBqIDwgbm9kZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIHBOb2RlLmNoaWxkcmVuLnNwbGljZShpbmRleCArIGosIDAsIG5vZGVzW2pdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOS4gOS4quiKgueCuVxyXG4gICAgICogQHBhcmFtICBkYXRhIOaJgOacieiKgueCueaVsOaNrlxyXG4gICAgICogQHBhcmFtICBub2RlICDoioLngrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyByZW1vdmVOb2RlKGRhdGE6IEFycmF5PFRpVHJlZU5vZGU+LCBub2RlOiBUaVRyZWVOb2RlKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOaJvuWIsOS4jeWMuemFjeaQnOe0ouWGheWuueeahOWPtuWtkOiKgueCueW5tuWIoOmZpOOAguS4uuS6humBv+WFjeimgeWIoOmZpOeahOWFg+e0oOWcqOaVsOe7hOS4reeahOe0ouW8leaUueWPmO+8jOS7juWQjuWQkeWJjeW+queOr1xyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IGRhdGEubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICAgICAgaWYgKGRhdGFbaV0gPT09IG5vZGUpIHtcclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuZGVsZXRlQXJyKGRhdGEsIGkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFUaVRyZWVVdGlsLmlzTGVhZihkYXRhW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5yZW1vdmVOb2RlKGRhdGFbaV0uY2hpbGRyZW4sIG5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gMy4wLjMgc2VsZWN0Tm9kZS91blNlbGVjdE5vZGXnrKzkuInkuKrlj4LmlbDvvJrmmK/lkKbljZXpgIksIOaUueS4uuaYr+WQpuWkmumAieOAguW3suehruiupOaXoOS6uuS9v+eUqOOAglxyXG4gICAgLy8gVE9ET++8mui/meS4pOS4quWHveaVsOeahOmHjeWkjeS7o+egge+8jOWPr+S7peWQiOW5tlxyXG4gICAgLyoqXHJcbiAgICAgKiDpgInkuK3mn5DkuKroioLngrlcclxuICAgICAqIEBwYXJhbSAgZGF0YSDmiYDmnInoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSAgbm9kZSAg6IqC54K5XHJcbiAgICAgKiBAcGFyYW0gIG11bHRpcGxlIOaYr+WQpuWkmumAieaooeW8j1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNlbGVjdE5vZGUoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIG5vZGU6IFRpVHJlZU5vZGUsIG11bHRpcGxlOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFtdWx0aXBsZSkgeyAvLyDljZXpgInmqKHlvI9cclxuICAgICAgICAgICAgVGlUcmVlVXRpbC50cmF2ZXJzZShkYXRhLCAodHJhdk5vZGU6IFRpVHJlZU5vZGUpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgICAgIHRyYXZOb2RlLmNoZWNrZWQgPSBmYWxzZTsgLy8g5riF56m65omA5pyJ55qE6YCJ5Lit6aG5XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBub2RlLmNoZWNrZWQgPSB0cnVlOyAvLyDlsIblvZPliY3pobnnva7kuLrpgInkuK1cclxuICAgICAgICB9IGVsc2UgeyAvLyDlpJrpgIlcclxuICAgICAgICAgICAgVGlUcmVlVXRpbC5zZWxlY3RBbGxDaGlsZHJlbihub2RlKTsgLy8g5YWI572u5b2T5YmN6IqC54K56YCJ5Lit77yM5aaC5p6c5b2T5YmN6IqC54K55piv6Z2e5Y+25a2Q6IqC54K5IOmAkuW9kuiuqeWFtuWtkOiKgueCueWFqOmDqOmAieS4rVxyXG4gICAgICAgICAgICBUaVRyZWVVdGlsLnNlbGVjdFBhcmVudHMobm9kZSwgZGF0YSwgdHJ1ZSk7IC8vIOiuvue9rueItuiKgueCuemAieS4reaDheWGtVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIFRPRE86VGlueTQgZGVzZWxlY3TmlLnkuLp1bnNlbGVjdFxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtojpgInkuK3mn5DkuKroioLngrlcclxuICAgICAqIEBwYXJhbSBkYXRhIOaJgOacieiKgueCueaVsOaNrlxyXG4gICAgICogQHBhcmFtIG5vZGUgIOiKgueCuVxyXG4gICAgICogQHBhcmFtIG11bHRpcGxlIOaYr+WQpuWkmumAieaooeW8j1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGRlU2VsZWN0Tm9kZShkYXRhOiBBcnJheTxUaVRyZWVOb2RlPiwgbm9kZTogVGlUcmVlTm9kZSwgbXVsdGlwbGU6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW11bHRpcGxlKSB7XHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UoZGF0YSwgKHRyYXZOb2RlOiBUaVRyZWVOb2RlKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cmF2Tm9kZS5jaGVja2VkID0gZmFsc2U7IC8vIOa4heepuuaJgOacieeahOmAieS4remhuVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBUaVRyZWVVdGlsLmRlU2VsZWN0QWxsQ2hpbGRyZW4obm9kZSk7XHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwuZGVTZWxlY3RQYXJlbnRzKG5vZGUsIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWxleW8gGlk5omA5pyJ54i26IqC54K5XHJcbiAgICAgKiBAcGFyYW0gIGRhdGEg5omA5pyJ6IqC54K55pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gIG5vZGUgIOiKgueCuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGV4cGFuZE5vZGUoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIG5vZGU6IFRpVHJlZU5vZGUpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG51bTogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgcmVzdWx0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0gPT09IG5vZGUpIHtcclxuICAgICAgICAgICAgICAgIG51bSsrO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFUaVRyZWVVdGlsLmlzTGVhZihpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gVGlUcmVlVXRpbC5leHBhbmROb2RlKGl0ZW0uY2hpbGRyZW4sIG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG51bSsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gKG51bSA+IDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u55So5oi35Lyg5YWl55qE5pa55rOV562b6YCJ6IqC54K555qE5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmiYDmnInoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSAgbWF0Y2hGbiDnlKjmiLfkvKDlhaXljLnphY3oioLngrnnmoTmlrnms5VcclxuICAgICAqIEByZXR1cm5zIOaYr+WQpuaJvuWIsFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNlYXJjaChkYXRhOiBBcnJheTxUaVRyZWVOb2RlPiwgbWF0Y2hGbjogKG5vZGU6IFRpVHJlZU5vZGUpID0+IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIVV0aWwuaXNGdW5jdGlvbihtYXRjaEZuKSB8fCAhQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZmluZE51bTogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgaXNGaW5kOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAgICAgLy8g5om+5Yiw5LiN5Yy56YWN5pCc57Si5YaF5a6555qE5Y+25a2Q6IqC54K55bm25Yig6Zmk44CC5Li65LqG6YG/5YWN6KaB5Yig6Zmk55qE5YWD57Sg5Zyo5pWw57uE5Lit55qE57Si5byV5pS55Y+Y77yM5LuO5ZCO5ZCR5YmN5b6q546vXHJcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gZGF0YS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBpZiAoIW1hdGNoRm4oZGF0YVtpXSkgJiYgIVRpVHJlZVV0aWwuaXNMZWFmKGRhdGFbaV0pKSB7IC8vIOacquWMuemFjeWIsOS4lOS4uueItuiKgueCuVxyXG4gICAgICAgICAgICAgICAgaXNGaW5kID0gVGlUcmVlVXRpbC5zZWFyY2goZGF0YVtpXS5jaGlsZHJlbiwgbWF0Y2hGbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNGaW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmluZE51bSsrO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLmRlbGV0ZUFycihkYXRhLCBpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtYXRjaEZuKGRhdGFbaV0pKSB7IC8vIOWMuemFjeWIsFxyXG4gICAgICAgICAgICAgICAgZmluZE51bSsrO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyAvLyDmnKrljLnphY3liLDkuJTkuLrlj7blrZDoioLngrlcclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuZGVsZXRlQXJyKGRhdGEsIGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gKGZpbmROdW0gPiAwKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlumAieS4remhuVxyXG4gICAgICogQHBhcmFtIGRhdGEg5omA5pyJ6IqC54K55pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gIG9ubHlTZWxlY3RMZWFmIOmAieS4remhueS4reaYr+WQpuWPquWMheWQq+WPtuWtkOiKgueCuVxyXG4gICAgICogQHBhcmFtICBtdWx0aXBsZSDmmK/lkKblpJrpgInmqKHlvI9cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRTZWxlY3RlZERhdGEoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIG9ubHlTZWxlY3RMZWFmOiBib29sZWFuLCBtdWx0aXBsZTogYm9vbGVhbik6IEFycmF5PFRpVHJlZU5vZGU+IHtcclxuICAgICAgICAvLyDmr4/mrKHpgY3ljobkuYvliY3pnIDopoHmuIXnqbrlvZPliY3pgInkuK3pobnliJfooahcclxuICAgICAgICBUaVRyZWVVdGlsLnNlbGVjdGVkRGF0YSA9IFtdO1xyXG4gICAgICAgIFRpVHJlZVV0aWwucXVlcnlTZWxlY3RlZE5vZGUoZGF0YSwgb25seVNlbGVjdExlYWYsIG11bHRpcGxlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFRpVHJlZVV0aWwuc2VsZWN0ZWREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogQGRlc2NyaXB0aW9uIOagueaNruaVtOajteagkeeahOiKgueCueaVsOaNru+8jOafpeivouaJgOaciemAieS4remhue+8jOW5tuabtOaWsHNlbGVjdGVkRGF0YVxyXG4gICAgICogQHBhcmFtIGRhdGEg5YWo6YOo6IqC54K55pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gb25seVNlbGVjdExlYWYg5YWo6YOo6IqC54K55pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgcXVlcnlTZWxlY3RlZE5vZGUoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIG9ubHlTZWxlY3RMZWFmOiBib29sZWFuLCBtdWx0aXBsZTogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIGxldCB0ZW1wTm9kZTogYW55O1xyXG4gICAgICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRlbXBOb2RlID0gZGF0YVtpXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChUaVRyZWVVdGlsLmNoZWNrZWRQYXJlbnROb2RlKHRlbXBOb2RlKSkgeyAvLyDniLboioLngrnljYrpgInmiJbpgInkuK1cclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwucG5vZGUucHVzaCh0ZW1wTm9kZSk7XHJcbiAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLnF1ZXJ5U2VsZWN0ZWROb2RlKHRlbXBOb2RlLmNoaWxkcmVuLCBvbmx5U2VsZWN0TGVhZiwgbXVsdGlwbGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOWNlemAieaDheWGteS4i+S7heafpeaJvuWIsOesrOS4gOS4qumAieS4reeahOWPtuWtkOiKgueCueWNs+WPr1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtdWx0aXBsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFRpVHJlZVV0aWwuY2hlY2tlZExlYWZOb2RlKHRlbXBOb2RlKSkgeyAvLyDlj7blrZDoioLngrnpgInkuK1cclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuc2VsZWN0ZWREYXRhLnB1c2godGVtcE5vZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghb25seVNlbGVjdExlYWYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wTm9kZS5wYXJlbnQgPSBUaVRyZWVVdGlsLnBub2RlLmNvbmNhdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWNlemAieaDheWGteS4i+S7heafpeaJvuWIsOesrOS4gOS4qumAieS4reeahOWPtuWtkOiKgueCueWNs+WPr1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghbXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5wbm9kZS5zcGxpY2UoMCwgVGlUcmVlVXRpbC5wbm9kZS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOmBjeWOhuWIsOacgOWQjuS4gOmhueaXtuWwhueItuiKgueCueS7jnBub2Rl5Lit56e76ZmkXHJcbiAgICAgICAgICAgIGlmIChpID09PSBkYXRhLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwucG5vZGUucG9wKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5Yik5pat6IqC54K5bm9kZeaYr+WQpuaYr+S4gOS4quWkhOS6jumAieS4reaIluWNiumAieeKtuaAgeeahOeItuiKgueCuVxyXG4gICAgICogQHBhcmFtIG5vZGUg6IqC54K55pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY2hlY2tlZFBhcmVudE5vZGUobm9kZTogVGlUcmVlTm9kZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAobm9kZS5jaGVja2VkID09PSB0cnVlIHx8IG5vZGUuY2hlY2tlZCA9PT0gJ2luZGV0ZXJtaW5hdGUnKSAmJiAhVGlUcmVlVXRpbC5pc0xlYWYobm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5Yik5pat6IqC54K5bm9kZeaYr+WQpuaYr+S4gOS4quWkhOS6jumAieS4reeKtuaAgeeahOWPtuWtkOiKgueCuVxyXG4gICAgICogQHBhcmFtIG5vZGUg6IqC54K55pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY2hlY2tlZExlYWZOb2RlKG5vZGU6IFRpVHJlZU5vZGUpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKG5vZGUuY2hlY2tlZCA9PT0gdHJ1ZSkgJiYgKFRpVHJlZVV0aWwuaXNMZWFmKG5vZGUpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWIpOaWreaYr+WQpuS4uuWPtuWtkOiKgueCuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGlzTGVhZihpdGVtOiBUaVRyZWVOb2RlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICEoVXRpbC5pc0FycmF5KGl0ZW0uY2hpbGRyZW4pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOS7juaVsOe7hGFycuS4reWIoOmZpOS4i+agh+S4umluZGV455qE6IqC54K5XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZGVsZXRlQXJyKGFycjogQXJyYXk8VGlUcmVlTm9kZT4sIGluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBhcnIuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxuICAgIC8vIFRPRE86IGNoZWNrZWTkvKDlhaVmYWxzZeaXtu+8jOS4jmRlU2VsZWN0UGFyZW50c+acieS7gOS5iOWMuuWIq++8n+WPr+S7peWQiOW5tuS5iO+8n1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlvZPlrZDoioLngrnpgInkuK3ml7bvvIzorr7nva7npZblhYjlhYPntKDnmoTpgInkuK3nirbmgIFcclxuICAgICAqIEBwYXJhbSBpdGVtIOWtkOiKgueCueeahOaVsOaNrlxyXG4gICAgICogQHBhcmFtIGFsbERhdGEg5YWo6YOo6IqC54K55pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gY2hlY2tlZCDlj5blgLzkuLrvvJp0cnVlL2ZhbHNlLydpbmRldGVybWluYXRlJ1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNlbGVjdFBhcmVudHMoaXRlbTogVGlUcmVlTm9kZSwgYWxsRGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIGNoZWNrZWQ6IGJvb2xlYW4gfCBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBwTm9kZTogVGlUcmVlTm9kZSA9IFRpVHJlZVV0aWwuZ2V0UGFyZW50Tm9kZShhbGxEYXRhLCBpdGVtKTtcclxuICAgICAgICBpZiAoVXRpbC5pc1VuZGVmaW5lZChwTm9kZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5b2T5a2Q5YWD57Sg5Li65Y2K6YCJ5pe277yM56WW5YWI5YWD57Sg5LiA5b6L6K6+572u5Li65Y2K6YCJ54q25oCBXHJcbiAgICAgICAgaWYgKGNoZWNrZWQgPT09ICdpbmRldGVybWluYXRlJykge1xyXG4gICAgICAgICAgICBwTm9kZS5jaGVja2VkID0gJ2luZGV0ZXJtaW5hdGUnO1xyXG4gICAgICAgICAgICBUaVRyZWVVdGlsLnNlbGVjdFBhcmVudHMocE5vZGUsIGFsbERhdGEsICdpbmRldGVybWluYXRlJyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjaGlsZHJlbnM6IEFycmF5PFRpVHJlZU5vZGU+ID0gcE5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkTnVtOiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW5zKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5jaGVja2VkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZE51bSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2VsZWN0ZWROdW0gPT09IGNoaWxkcmVucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcE5vZGUuY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwuc2VsZWN0UGFyZW50cyhwTm9kZSwgYWxsRGF0YSwgdHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcE5vZGUuY2hlY2tlZCA9ICdpbmRldGVybWluYXRlJztcclxuICAgICAgICAgICAgVGlUcmVlVXRpbC5zZWxlY3RQYXJlbnRzKHBOb2RlLCBhbGxEYXRhLCAnaW5kZXRlcm1pbmF0ZScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOagueaNrueItuiKgueCuemAieaLqeWtkOiKgueCuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNlbGVjdEFsbENoaWxkcmVuKGl0ZW06IFRpVHJlZU5vZGUpOiB2b2lkIHtcclxuICAgICAgICAvLyDlpoLmnpzlrZDoioLngrnmmK/npoHnlKjnirbmgIHkuI3lgZrlpITnkIbvvJtcclxuICAgICAgICBpZiAoaXRlbS5kaXNhYmxlZCAhPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBpdGVtLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFUaVRyZWVVdGlsLmlzTGVhZihpdGVtKSkge1xyXG4gICAgICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBUaVRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLnNlbGVjdEFsbENoaWxkcmVuKGNoaWxkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86VGlueTQgZGVzZWxlY3TmlLnkuLp1bnNlbGVjdFxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlpJrpgInnirbmgIHkuIvvvIzniLboioLngrnlj5bmtojpgInkuK3vvIznva7lrZDoioLngrnpg73kuLrlj5bmtojpgInkuK3nirbmgIFcclxuICAgICAqIEBwYXJhbSBpdGVtIOWtkOiKgueCueeahOaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGRlU2VsZWN0QWxsQ2hpbGRyZW4oaXRlbTogVGlUcmVlTm9kZSk6IHZvaWQge1xyXG4gICAgICAgIGlmIChpdGVtLmRpc2FibGVkICE9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoVXRpbC5pc0FycmF5KGl0ZW0uY2hpbGRyZW4pICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBUaVRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLmRlU2VsZWN0QWxsQ2hpbGRyZW4oY2hpbGQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzpUaW55NCBkZXNlbGVjdOaUueS4unVuc2VsZWN0XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOW9k+WJjeiKgueCueWPlua2iOmAieS4reaXtu+8jOiuvue9ruelluWFiOWFg+e0oOeahOmAieS4reeKtuaAgVxyXG4gICAgICogQHBhcmFtIGl0ZW0g5b2T5YmN6IqC54K555qE5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gYWxsRGF0YSDlhajpg6jnmoToioLngrnmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBkZVNlbGVjdFBhcmVudHMoaXRlbTogVGlUcmVlTm9kZSwgYWxsRGF0YTogQXJyYXk8VGlUcmVlTm9kZT4pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBwTm9kZTogVGlUcmVlTm9kZSA9IFRpVHJlZVV0aWwuZ2V0UGFyZW50Tm9kZShhbGxEYXRhLCBpdGVtKTtcclxuICAgICAgICBpZiAoVXRpbC5pc1VuZGVmaW5lZChwTm9kZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2hpbGRyZW5zOiBBcnJheTxUaVRyZWVOb2RlPiA9IHBOb2RlLmNoaWxkcmVuO1xyXG4gICAgICAgIGxldCBzZWxlY3RlZE51bTogbnVtYmVyID0gMDtcclxuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVucykge1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQuY2hlY2tlZCA9PT0gdHJ1ZSB8fCBjaGlsZC5jaGVja2VkID09PSAnaW5kZXRlcm1pbmF0ZScpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkTnVtKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzZWxlY3RlZE51bSA9PT0gMCkge1xyXG4gICAgICAgICAgICBwTm9kZS5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwuZGVTZWxlY3RQYXJlbnRzKHBOb2RlLCBhbGxEYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwTm9kZS5jaGVja2VkID0gJ2luZGV0ZXJtaW5hdGUnO1xyXG4gICAgICAgICAgICBUaVRyZWVVdGlsLnNlbGVjdFBhcmVudHMocE5vZGUsIGFsbERhdGEsICdpbmRldGVybWluYXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBkcm9wIGV2ZW50XHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5ouW5ou95pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmiYDnlKjoioLngrnmlbDmja5cclxuICAgICAqIEBwYXJhbSBtdWx0aXBsZSDlpJrpgIlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBkcm9wQXBwbHkoZXZlbnQ6IFRpVHJlZURyYWdOb2RlLCBkYXRhOiBBcnJheTxUaVRyZWVOb2RlPiwgbXVsdGlwbGU/OiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZHJhZ05vZGU6IFRpVHJlZU5vZGUgPSBldmVudC5kcmFnTm9kZTsgLy8g5ouW5ou96IqC54K5XHJcbiAgICAgICAgY29uc3QgZHJhZ1BhcmVudE5vZGU6IFRpVHJlZU5vZGUgPSBUaVRyZWVVdGlsLmdldFBhcmVudE5vZGUoZGF0YSwgZHJhZ05vZGUpOyAvLyDmi5bmi73oioLngrnnmoTniLboioLngrlcclxuICAgICAgICBjb25zdCBkcm9wTm9kZTogVGlUcmVlTm9kZSA9IGV2ZW50LnRhcmdldE5vZGU7IC8vIOaLluaUvuiKgueCuVxyXG4gICAgICAgIGNvbnN0IGRyb3BQYXJlbnROb2RlOiBUaVRyZWVOb2RlID0gVGlUcmVlVXRpbC5nZXRQYXJlbnROb2RlKGRhdGEsIGRyb3BOb2RlKTsgLy8g5ouW5pS+6IqC54K555qE54i26IqC54K5XHJcbiAgICAgICAgY29uc3QgZHJvcFBvc2l0aW9uOiBudW1iZXIgPSBldmVudC5kcm9wUG9zaXRpb247IC8vIOaLluaLveS9jee9rlxyXG4gICAgICAgIFRpVHJlZVV0aWwucmVtb3ZlTm9kZShkYXRhLCBkcmFnTm9kZSk7XHJcbiAgICAgICAgLy8g5ouW5ou954i26IqC54K55peg5a2Q6IqC54K55pe277yM5Yig6ZmkY2hpbGRyZW7lsZ7mgKfvvIzmraTlpITmmK/kuLrop6PlhrPlvZNjaGlsZHJlbuS4uuepuuaXtu+8jOWxleW8gOaUtui1t+Wbvuagh+i/mOS8muWtmOWcqOeahOmXrumimFxyXG4gICAgICAgIGlmIChkcmFnUGFyZW50Tm9kZT8uY2hpbGRyZW4ubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICBkZWxldGUgZHJhZ1BhcmVudE5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkcm9wUG9zaXRpb24gPT09IDApIHtcclxuICAgICAgICAgICAgVGlUcmVlVXRpbC5hZGROb2RlKGRhdGEsIFtkcmFnTm9kZV0sIC0xLCBkcm9wTm9kZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGluZGV4OiBudW1iZXI7XHJcbiAgICAgICAgICAgIGlmICghZHJvcFBhcmVudE5vZGUpIHsgLy8g5ouW5pS+6IqC54K55Li66aG257qn57qn6IqC54K55pe2XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IGRhdGEuaW5kZXhPZihkcm9wTm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZHJvcFBvc2l0aW9uID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4LCAwLCBkcmFnTm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4ICsgMSwgMCwgZHJhZ05vZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW5kZXggPSBkcm9wUGFyZW50Tm9kZS5jaGlsZHJlbi5pbmRleE9mKGRyb3BOb2RlKTtcclxuICAgICAgICAgICAgICAgIGlmIChkcm9wUG9zaXRpb24gPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5hZGROb2RlKGRhdGEsIFtkcmFnTm9kZV0sIGluZGV4ICwgZHJvcFBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLmFkZE5vZGUoZGF0YSwgW2RyYWdOb2RlXSwgaW5kZXggKyAxICwgZHJvcFBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWkmumAiVxyXG4gICAgICAgIGlmIChtdWx0aXBsZSkge1xyXG4gICAgICAgICAgICAgVGlUcmVlVXRpbC51cGRhdGVDaGVja2VkKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=