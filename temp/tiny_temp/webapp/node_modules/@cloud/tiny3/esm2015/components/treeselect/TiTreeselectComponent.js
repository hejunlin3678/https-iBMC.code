import { Component, ElementRef, Input, ViewChild } from '@angular/core';
import { TiFormComponent } from '../base/TiBaseModule';
import { TiTreeUtil } from '../tree/TiTreeModule';
import { TiDominatorComponent } from '../dominator/TiDominatorModule';
import { TiDropComponent } from '../drop/TiDropModule';
import { TiSearchboxNotsearchComponent } from '../searchbox/TiSearchboxModule';
import { TiLocale } from '../../locale/TiLocaleModule';
import { Util } from '../../utils/Util';
import { TiSelectComponent } from '../select/TiSelectModule';
/**
 * Treeselect树选择下拉组件
 *
 * 支持单选/多选，全选，搜索，懒加载。
 *
 * 单选主要功能为从Tree组件数据中选择某一条数据，单选与Tree功能相同，只是视觉呈现不同。
 *
 * 多选主要功能是从Tree组件数据中任意选择多条数据，多选与Tree功能相同，只是视觉呈现不同。
 *
 * 该组件继承自TiSelectComponent，其中
 *
 * 输入属性：clearable、labelKey、searchKeys、tipPosition、panelMaxHeight和valueKey暂不支持；
 *
 * 输出属性：clear不支持（单选和多选都采用标签方式展示，所以不支持单选情况下的clear事件）
 *
 * <example-url>../tiny3demo/#/treeselect/treeselect-all</example-url>
 */
export class TiTreeselectComponent extends TiSelectComponent {
    constructor() {
        super(...arguments);
        /**
         * 下拉面板的高度，默认展示8条
         */
        this.dropMaxHeight = (30 + 1) * 8;
        /**
         * @ignore 全选框的半选中状态
         */
        this.indeterminate = false;
        /**
         * @ignore 全选中
         */
        this.isAllSelected = false;
        /**
         * @ignore 搜索提示文本
         */
        this.searchPlaceholder = TiLocale.getLocaleWords().tiSelect.search;
        /**
         * @ignore 搜索内容
         */
        this.searchText = '';
        /**
         * @ignore 是否处于搜索状态
         */
        this.isInSearch = false;
    }
    // 主干深拷贝，叶子浅拷贝
    // 因为搜索结果里，叶子节点的勾选效果，需要保留在原始数据。
    static leafShallowClone(arr) {
        if (typeof (arr) !== 'object' || arr === null || (arr.label !== undefined && arr.children === undefined)) {
            return arr;
        }
        const clone = Array.isArray(arr) ? arr.slice() : Object.assign({}, arr);
        const keys = Object.keys(clone);
        for (const key of keys) {
            clone[key] = TiTreeselectComponent.leafShallowClone(clone[key]);
        }
        return clone;
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngOnInit() {
        super.ngOnInit();
        // 强制装换，方便调用super.xxx
        this.dropsearchCom = this.dropCom;
        // 记录传入的数据，浅拷贝
        this.oldOptions = this.options;
    }
    ngOnChanges(changes) {
        // 解决延迟或者动态设置options，树组件未渲染的问题
        if (changes['options'] && !changes['options'].firstChange) {
            // 重新记录传入的数据
            this.oldOptions = changes['options'].currentValue;
        }
    }
    // tslint:disable-next-line: use-life-cycle-interface
    ngAfterViewChecked() {
        if (this.searchable !== this.oldSearchable) {
            this.oldSearchable = this.searchable;
            if (this.searchable) {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.searchboxCom.getFocusableElems())
                    .concat(this.dropCom.nativeElement));
            }
            else {
                this.setFocusableElems(this.dominatorCom.getFocusableElems()
                    .concat(this.dropCom.nativeElement));
            }
        }
        // 调用父类逻辑afterViewChecked才去设置autofocs
        super.ngAfterViewChecked();
    }
    /**
     * @ignore drop高度被压缩时，重新设置下拉面板的高度
     */
    restyleDropMaxHeight() {
        let dropCurMaxHeight = parseInt(this.dropCom.nativeElement.style.maxHeight, 10);
        let dropMaxHeightAdapted = this.dropMaxHeight;
        if (!isNaN(dropCurMaxHeight)) {
            // 减去搜索框高度和间距的和
            if (this.searchable) {
                dropCurMaxHeight -= TiTreeselectComponent.SEARCHBOX_HEIGHT;
            }
            if (dropCurMaxHeight < this.dropMaxHeight) {
                dropMaxHeightAdapted = dropCurMaxHeight;
            }
        }
        this.renderer.setStyle(this.dataTemplate.nativeElement, 'max-height', dropMaxHeightAdapted + 'px');
    }
    ngOnModelChange() {
        if (this.multiple) {
            // 多选时，重新设置下拉面板定位
            this.setPosition();
            if (this.selectAll) {
                // 允许全选时，设置全选框状态
                this.setAllSelectCheckboxState();
            }
        }
    }
    /**
     * @ignore 设置下拉面板定位
     */
    setPosition(optionsChange) {
        setTimeout(() => {
            if (optionsChange) {
                this.dropCom.resetPosition();
            }
            else {
                this.dropCom.setPosition();
            }
            this.restyleDropMaxHeight();
        }, 0);
    }
    /**
     * @ignore 关闭下拉面板并转移焦点
     */
    close() {
        this.dropCom.hide();
        // 焦点转移至dominator
        if (this.searchable) {
            this.dominatorCom.focus();
        }
    }
    /**
     * @ignore 仅仅关闭下拉面板
     */
    closeWithoutFocus() {
        this.dropCom.hide();
    }
    /**
     * @ignore 打开下拉面板
     */
    open() {
        // 初始化最大高度
        this.renderer.setStyle(this.dataTemplate.nativeElement, 'max-height', this.dropMaxHeight + 'px');
        this.dropCom.show();
        this.restyleDropMaxHeight();
        // 焦点转移至搜索框
        if (this.searchable) {
            this.searchboxCom.focus();
        }
    }
    /**
     * 尝试打开下拉面板
     */
    wantOpen() {
        super.wantOpen();
    }
    /**
     * @ignore 点击ti-dominator触发的事件
     * 点击下拉面板，展开或者关闭面板
     */
    onClickDominator() {
        if (this.disabled) {
            return;
        }
        if (!this.dropCom.isShow) {
            // 清空搜索内容
            this.searchText = '';
            this.searchTextChange(this.searchText);
            this.wantOpen();
        }
        else {
            this.close();
        }
    }
    /**
     * @ignore 删除ti-dominator选中项时触发的事件
     * 需要取消树节点的选中
     */
    onDeleteDominatorTag(item) {
        const deletedItem = item.item;
        // 1.取消选中当前节点、设置子节点及祖先节点的选中情况。从model中删除时，item.item.checked还是为true，要设置为false
        this.setSelectState(deletedItem, !deletedItem.checked);
        // 2.设置为非全选
        this.isAllSelected = false;
        // 3.设置全选框状态
        if (this.multiple && this.selectAll) {
            item.model.length === 0 ? this.indeterminate = false : this.indeterminate = true;
        }
    }
    /**
     * @ignore ti-searchbox-notsearch搜索框内容变化时触发的事件
     */
    searchTextChange(searchText) {
        if (Util.isEmptyString(searchText)) {
            this.options = this.oldOptions;
            this.isInSearch = false;
        }
        else {
            // this.oldOptions 叶子浅拷贝
            const searchResult = TiTreeselectComponent.leafShallowClone(this.oldOptions);
            TiTreeUtil.search(searchResult, (cnode) => {
                return (cnode.label.indexOf(this.searchText) >= 0);
            });
            // 展开整个树
            TiTreeUtil.traverse(searchResult, (node) => {
                node.expanded = true;
            });
            this.options = searchResult;
            this.isInSearch = true;
        }
        if (this.multiple && this.selectAll) {
            this.setAllSelectCheckboxState();
        }
        // 重新设置面板定位
        this.setPosition(true);
    }
    /**
     * @ignore 从model中获取option所在的索引
     */
    getItemIndexFromModel(option) {
        let index = -1;
        index = this.model.findIndex((item) => {
            // 判断item和option的引用是否相同即可
            return (item === option);
        });
        return index;
    }
    /**
     * @ignore 获取需要放到model中的节点，根据规范，如果子节点全部选中了，需要在model中放入父节点或者祖先节点。找到第一个checked为true的节点即可
     * node: 树组件select事件中的参数
     */
    getRealSelectedNode(node) {
        // tslint:disable-next-line: no-null-keyword
        let selectedNode = null;
        const parentNode = TiTreeUtil.getParentNode(this.oldOptions, node);
        (parentNode && parentNode.checked === true) ? selectedNode = this.getRealSelectedNode(parentNode) : selectedNode = node;
        return selectedNode;
    }
    /**
     * @ignore 获取需要从model移除的节点，根据规范，如果某个子节点取消选中了，那么可能是它的父节点或祖先节点或所有子节点从model中被移除
     * node：树组件select事件的参数
     */
    getRealUnselectedNode(node) {
        // tslint:disable-next-line: no-null-keyword
        let unselectedNode = null;
        let parentNode = TiTreeUtil.getParentNode(this.oldOptions, node);
        if (this.getItemIndexFromModel(node) !== -1) {
            // 需要从model中移除的节点是node本身
            unselectedNode = node;
        }
        else {
            // 需要从model中移除的节点是node父节点或祖先节点
            // 当节点处于半选状态时,点击节点的复选框,节点状态为选中,否则为非选中,所以要先判断parentNode是否存在
            while (parentNode && this.getItemIndexFromModel(parentNode) === -1) {
                parentNode = TiTreeUtil.getParentNode(this.oldOptions, parentNode);
            }
            // parentNode可能为undefined
            unselectedNode = parentNode;
        }
        return unselectedNode;
    }
    /**
     * @ignore 取消选中时，获取被选中的子节点，根据规范，父节点或祖先节点被选中之后，如果取消了某个子节点的选中，那么需要把它的所有选中的子节点加入model中
     * unselectedNode：需要从model中移除的节点
     */
    // tslint:disable-next-line: prefer-function-over-method
    getSelectedChildren(unselectedNode) {
        let selectedChildren = [];
        if (unselectedNode.children) {
            unselectedNode.children.forEach((child) => {
                if (child.checked === true) {
                    selectedChildren.push(child);
                }
                else {
                    selectedChildren = selectedChildren.concat(this.getSelectedChildren(child));
                }
            });
        }
        return selectedChildren;
    }
    /**
     * @ignore 根据checked的值，设置option节点及其子节点和祖先节点的选中状态
     * option: 选中的节点；checked：option.checked属性，true/false
     */
    setSelectState(option, checked) {
        // 对oldOptions进行操作，将搜索时的结果映射回来
        TiTreeUtil.traverse(this.oldOptions, (node) => {
            if (node === option) {
                node.checked = checked;
                if (checked === true) {
                    TiTreeUtil.selectAllChildren(node);
                    TiTreeUtil.selectParents(node, this.oldOptions, true);
                }
                else {
                    TiTreeUtil.deSelectAllChildren(node);
                    TiTreeUtil.deSelectParents(node, this.oldOptions);
                }
            }
        });
    }
    /**
     * @ignore 选中某个节点后，更新this.model
     * option: 选中的节点
     */
    setModelWhenSelected(option) {
        // 1.获取option最后一个被选中的祖先节点
        const selectedNode = this.getRealSelectedNode(option);
        // 2.从model中删除selectNode的所有子节点，一直到叶子节点
        TiTreeUtil.traverse([selectedNode], (node) => {
            let deleteIndex = this.getItemIndexFromModel(node);
            while (deleteIndex !== -1) {
                this.model.splice(deleteIndex, 1);
                deleteIndex = this.getItemIndexFromModel(node);
            }
        });
        // 3.将selectedNode加入到this.model中
        if (this.getItemIndexFromModel(selectedNode) === -1) {
            this.model.push(selectedNode);
        }
    }
    /**
     * @ignore 取消选中某个节点后，更新this.model
     * option: 被取消选中的节点
     */
    setModelWhenUnselected(option) {
        // 1.获取需要从model中删除的节点
        const unselectedNode = this.getRealUnselectedNode(option);
        // 2.更新model
        if (unselectedNode) {
            // 2.1unselectedNode为option或option的祖先节点
            const deleteIndex = this.getItemIndexFromModel(unselectedNode);
            this.model.splice(deleteIndex, 1);
            // 将option所有选中的子节点存放到this.model中
            if (unselectedNode !== option) {
                const selectedChildren = this.getSelectedChildren(unselectedNode);
                this.model = this.model.concat(selectedChildren);
            }
        }
        else {
            // 2.2unselectedNode为undefined，这种情况下，只需从model中删除option所有选中的子节点
            TiTreeUtil.traverse([option], (node) => {
                const deleteIndex = this.getItemIndexFromModel(node);
                if (deleteIndex !== -1) {
                    this.model.splice(deleteIndex, 1);
                }
            });
        }
    }
    /**
     * @ignore 处于搜索状态下，更新model
     */
    setModelWhenSearch(data, checked) {
        // 或者所有处于checked状态的叶子节点
        let selectedLeafNodes = [];
        selectedLeafNodes = this.getLeafNodes(data, checked);
        // 根据每个叶子节点更新model
        for (const leafNode of selectedLeafNodes) {
            // 设置oldOptions各节点状态
            this.setSelectState(leafNode, checked);
            checked ? this.setModelWhenSelected(leafNode) : this.setModelWhenUnselected(leafNode);
        }
    }
    /**
     * @ignore 获取data里面选中或者未选中的全部叶子节点
     * data：搜索范围，checked：true/false
     */
    // tslint:disable-next-line: prefer-function-over-method
    getLeafNodes(data, checked) {
        const leafNodes = [];
        TiTreeUtil.traverse(data, (node) => {
            if (TiTreeUtil.isLeaf(node) && node.checked === checked) {
                leafNodes.push(node);
            }
        });
        return leafNodes;
    }
    /**
     * @ignore 设置全选checkbox的状态
     */
    setAllSelectCheckboxState() {
        // 1.假设节点都被选中或都没被选中
        let isAllSelected = true;
        let isAllUnSelected = true;
        // 2.判断是否所有节点都被选中或都没被选中，disabled状态下的节点不用统计
        TiTreeUtil.traverse(this.options, (node) => {
            // 2.1 有节点没被选中
            if (!node.disabled && node.checked !== true) {
                isAllSelected = false;
            }
            // 2.2 有节点被选中或半选中
            if (!node.disabled && (node.checked === true || node.checked === 'indeterminate')) {
                isAllUnSelected = false;
            }
        });
        // 3.设置checkbox状态
        this.isAllSelected = isAllSelected;
        this.indeterminate = !isAllSelected && !isAllUnSelected;
    }
    /**
     * @ignore ti-tree的select事件
     */
    onTreeSelect(option) {
        // 节点被禁用，不做操作，直接返回
        if (option.disabled === true) {
            return;
        }
        // 1.触发select事件
        this.select.emit(option);
        if (!this.multiple) {
            // 2.1单选，直接替换model
            TiTreeUtil.traverse(this.oldOptions, (node) => {
                if (node === option) {
                    node.checked = true;
                    this.model = [option];
                }
                else {
                    node.checked = false;
                }
            });
            // 关闭下拉面板
            this.close();
        }
        else {
            // 2.2多选
            if (!this.isInSearch) {
                // 2.2.1非搜索状态
                // 设置oldOptions各节点状态
                this.setSelectState(option, option.checked);
                if (option.checked === true) {
                    this.setModelWhenSelected(option);
                }
                else {
                    this.setModelWhenUnselected(option);
                }
            }
            else {
                // 2.2.2搜索状态
                this.setModelWhenSearch([option], option.checked);
            }
            // 2.3手动触发ngModelChange事件，splice和push无法触发
            this.model = this.model.concat();
            // 2.4设置全选状态
            if (this.selectAll) {
                this.setAllSelectCheckboxState();
            }
        }
        // 3.重新设置ti-dominator高度
        this.setPosition();
    }
    /**
     * @ignore 全选复选框的按钮事件
     */
    onSelectAllChange(isAllSelected) {
        // 1.将当前tree节点全部选中 或 不选中
        TiTreeUtil.traverse(this.options, (node) => {
            if (!node.disabled) {
                node.checked = isAllSelected;
            }
        });
        // 2.设置model
        if (!this.isInSearch) {
            // 2.1 未处于搜索状态下，使用concat进行单层深拷贝
            (!this.isAllSelected) ? this.model = this.options.concat() : this.model = [];
        }
        else {
            // 2.2  处于搜索状态下
            this.setModelWhenSearch(this.options, isAllSelected);
            // 手动触发ngModelChange事件
            this.model = this.model.concat();
        }
    }
    /**
     * @ignore 全选复选框的点击事件
     */
    onClickSelectAll(event) {
        // 点击时，this.isAllSelected为false，所以要取反
        this.onSelectAllChange(!this.isAllSelected);
        event.preventDefault();
    }
    /**
     * @ignore
     * 失焦情况下，仅关闭面板，不做聚焦等处理
     */
    onBlur() {
        this.closeWithoutFocus();
    }
    /**
     * @ignore
     * 鼠标点击到空白，原本会失焦，此处通过阻止默认事件的方式进行了处理
     */
    onMouseDownDropOuter(event) {
        event.preventDefault();
    }
    /**
     * @ignore
     * #datatemplate内部滚动条会引起外部滚动条事件触发，引起弹框内的树下拉组件无法使用鼠标拖动滚动条，因此此处阻止事件冒泡
     */
    onMouseWheel(event) {
        event.stopPropagation();
    }
}
// 搜索框的高度
TiTreeselectComponent.SEARCHBOX_HEIGHT = 30;
TiTreeselectComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-treeselect',
                template: "<ti-dominator\r\n        [dropshow]=\"dropCom.isShow\"\r\n        [multiple]='true'\r\n        [placeholder]='placeholder'\r\n        [disabled]=\"disabled\"\r\n        [labelKey]=\"labelKey\"\r\n        [maxLine]=\"maxLine\"\r\n        [selectedTipPosition]='selectedTipPosition'\r\n        [id]=\"appendId('dominator')\"\r\n        [(ngModel)]=\"model\"\r\n        (click)=\"onClickDominator()\"\r\n        (delete)=\"onDeleteDominatorTag($event)\">\r\n</ti-dominator>\r\n\r\n<ti-drop\r\n        [dominatorElem]='dominatorCom.nativeElement'\r\n        [dominatorSpace]=\"dominatorSpace\"\r\n        [panelWidth]=\"panelWidth\"\r\n        [id]=\"appendId('drop')\">\r\n        <!-- \u641C\u7D22 -->\r\n        <ti-searchbox-notsearch #searchboxCom *ngIf='searchable' noBorder\r\n                class=\"ti3-treeselect-searchbox\"\r\n                [placeholder]='searchPlaceholder'\r\n                [(ngModel)]='searchText'\r\n                [id]=\"appendId('searchbox')\"\r\n                (ngModelChange)=\"searchTextChange($event)\">\r\n        </ti-searchbox-notsearch>\r\n        <section #datatemplate class='ti3-treeselect-datacontainer'\r\n                (mousedown)=\"onMouseDownDropOuter($event)\"\r\n                (mousewheel)=\"onMouseWheel($event)\"\r\n                (DOMMouseScroll)=\"onMouseWheel($event)\">\r\n                <ng-container *ngIf='(options && options.length > 0) else nodatatemplate'>\r\n                        <!-- \u5168\u9009 -->\r\n                        <li *ngIf='multiple && selectAll'\r\n                                class=\"ti3-treeselect-selectall-option\"\r\n                                (click)=\"onClickSelectAll($event)\"\r\n                                [id]=\"appendId('selectAll')\">\r\n                                <input type=\"checkbox\" tiCheckbox [indeterminate]=\"indeterminate\" [(ngModel)]=\"isAllSelected\" (ngModelChange)=\"onSelectAllChange($event)\" label=\"\u5168\u9009\">\r\n                        </li>\r\n                        <ti-tree\r\n                                [id]=\"appendId('tree')\"\r\n                                [data]='options'\r\n                                [parentCheckable]='true'\r\n                                [multiple]='multiple'\r\n                                (select)='onTreeSelect($event)'\r\n                                [changedByCheckbox]=\"false\">\r\n                        </ti-tree>\r\n                </ng-container>\r\n        </section>\r\n</ti-drop>\r\n\r\n<!-- no data\u6A21\u677F -->\r\n<ng-template #nodatatemplate>\r\n        <div class=\"ti3-treeselect-dropdown-no-data\" [innerHtml]=\"noDataText\"></div>\r\n</ng-template>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiTreeselectComponent)],
                host: {
                    '(blur)': 'onBlur()'
                },
                styles: [".ti3-compnent-container-border,:host{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block}.ti3-compnent-container-border:not([disabled]),:host:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}.ti3-compnent-container-border:not([disabled]):hover,:host:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}.ti3-compnent-container-border:not([disabled])[tiFocused],:host:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}.ti3-compnent-container-border[disabled],:host[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed!important}::ng-deep :root{--ti-treeselect-selectall-width:100%}:host{width:280px}ti-drop{outline:none}.ti3-treeselect-selectall-option{background-color:var(--ti-common-color-bg-white-normal);color:inherit;cursor:pointer;line-height:var(--ti-common-line-height-number);list-style:none;padding:var(--ti-common-space-6) var(--ti-common-space-2x);text-align:left}.ti3-treeselect-selectall-option:hover{background-color:var(--ti-common-color-bg-white-emphasize);color:var(--ti-common-color-text-highlight)}.ti3-treeselect-searchbox{width:var(--ti-treeselect-selectall-width)!important}.ti3-treeselect-datacontainer{box-sizing:border-box;max-height:inherit;overflow-x:hidden;overflow-y:auto;padding:var(--ti-common-space-base) 0}.ti3-treeselect-dropdown-no-data{color:var(--ti-common-color-text-disabled);cursor:not-allowed;line-height:var(--ti-common-line-height-number);padding:var(--ti-common-space-6) var(--ti-input-padding-horizontal)}"]
            },] }
];
TiTreeselectComponent.propDecorators = {
    dropMaxHeight: [{ type: Input }],
    dropCom: [{ type: ViewChild, args: [TiDropComponent, { static: true },] }],
    dominatorCom: [{ type: ViewChild, args: [TiDominatorComponent, { static: true },] }],
    searchboxCom: [{ type: ViewChild, args: ['searchboxCom',] }],
    dataTemplate: [{ type: ViewChild, args: ['datatemplate',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlUcmVlc2VsZWN0Q29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL2NvbXBvbmVudHMvdHJlZXNlbGVjdC9UaVRyZWVzZWxlY3RDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN0RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkQsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU3RDs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQVdILE1BQU0sT0FBTyxxQkFBc0IsU0FBUSxpQkFBaUI7SUFWNUQ7O1FBZUk7O1dBRUc7UUFDTSxrQkFBYSxHQUFXLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQXdCOUM7O1dBRUc7UUFDSSxrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUV0Qzs7V0FFRztRQUNJLGtCQUFhLEdBQVksS0FBSyxDQUFDO1FBRXRDOztXQUVHO1FBQ0ksc0JBQWlCLEdBQVcsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFFN0U7O1dBRUc7UUFD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QUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ3BDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0JBQWdCLENBQUMsS0FBVTtRQUM5QixxQ0FBcUM7UUFDckMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzVDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTTtRQUNULElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7O09BR0c7SUFDSSxvQkFBb0IsQ0FBQyxLQUFVO1FBQ2xDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksWUFBWSxDQUFDLEtBQVU7UUFDMUIsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzVCLENBQUM7O0FBaGpCRCxTQUFTO0FBQ2Usc0NBQWdCLEdBQVcsRUFBRSxDQUFDOztZQWJ6RCxTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGVBQWU7Z0JBQ3pCLHNvRkFBOEI7Z0JBRTlCLFNBQVMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNwRSxJQUFJLEVBQUU7b0JBQ0YsUUFBUSxFQUFFLFVBQVU7aUJBQ3ZCOzthQUNKOzs7NEJBVUksS0FBSztzQkFVTCxTQUFTLFNBQUMsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTsyQkFJM0MsU0FBUyxTQUFDLG9CQUFvQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTsyQkFJaEQsU0FBUyxTQUFDLGNBQWM7MkJBSXhCLFNBQVMsU0FBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBUaUZvcm1Db21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IFRpVHJlZU5vZGUsIFRpVHJlZVV0aWwgfSBmcm9tICcuLi90cmVlL1RpVHJlZU1vZHVsZSc7XHJcbmltcG9ydCB7IFRpRG9taW5hdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vZG9taW5hdG9yL1RpRG9taW5hdG9yTW9kdWxlJztcclxuaW1wb3J0IHsgVGlEcm9wQ29tcG9uZW50IH0gZnJvbSAnLi4vZHJvcC9UaURyb3BNb2R1bGUnO1xyXG5pbXBvcnQgeyBUaVNlYXJjaGJveE5vdHNlYXJjaENvbXBvbmVudCB9IGZyb20gJy4uL3NlYXJjaGJveC9UaVNlYXJjaGJveE1vZHVsZSc7XHJcbmltcG9ydCB7IFRpTG9jYWxlIH0gZnJvbSAnLi4vLi4vbG9jYWxlL1RpTG9jYWxlTW9kdWxlJztcclxuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaVNlbGVjdENvbXBvbmVudCB9IGZyb20gJy4uL3NlbGVjdC9UaVNlbGVjdE1vZHVsZSc7XHJcbmltcG9ydCB7IFRpRHJvcHNlYXJjaENvbXBvbmVudCB9IGZyb20gJy4uL2Ryb3BzZWFyY2gvVGlEcm9wc2VhcmNoTW9kdWxlJztcclxuLyoqXHJcbiAqIFRyZWVzZWxlY3TmoJHpgInmi6nkuIvmi4nnu4Tku7ZcclxuICpcclxuICog5pSv5oyB5Y2V6YCJL+WkmumAie+8jOWFqOmAie+8jOaQnOe0ou+8jOaHkuWKoOi9veOAglxyXG4gKlxyXG4gKiDljZXpgInkuLvopoHlip/og73kuLrku45UcmVl57uE5Lu25pWw5o2u5Lit6YCJ5oup5p+Q5LiA5p2h5pWw5o2u77yM5Y2V6YCJ5LiOVHJlZeWKn+iDveebuOWQjO+8jOWPquaYr+inhuinieWRiOeOsOS4jeWQjOOAglxyXG4gKlxyXG4gKiDlpJrpgInkuLvopoHlip/og73mmK/ku45UcmVl57uE5Lu25pWw5o2u5Lit5Lu75oSP6YCJ5oup5aSa5p2h5pWw5o2u77yM5aSa6YCJ5LiOVHJlZeWKn+iDveebuOWQjO+8jOWPquaYr+inhuinieWRiOeOsOS4jeWQjOOAglxyXG4gKlxyXG4gKiDor6Xnu4Tku7bnu6fmib/oh6pUaVNlbGVjdENvbXBvbmVudO+8jOWFtuS4rVxyXG4gKlxyXG4gKiDovpPlhaXlsZ7mgKfvvJpjbGVhcmFibGXjgIFsYWJlbEtleeOAgXNlYXJjaEtleXPjgIF0aXBQb3NpdGlvbuOAgXBhbmVsTWF4SGVpZ2h05ZKMdmFsdWVLZXnmmoLkuI3mlK/mjIHvvJtcclxuICpcclxuICog6L6T5Ye65bGe5oCn77yaY2xlYXLkuI3mlK/mjIHvvIjljZXpgInlkozlpJrpgInpg73ph4fnlKjmoIfnrb7mlrnlvI/lsZXnpLrvvIzmiYDku6XkuI3mlK/mjIHljZXpgInmg4XlhrXkuIvnmoRjbGVhcuS6i+S7tu+8iVxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueTNkZW1vLyMvdHJlZXNlbGVjdC90cmVlc2VsZWN0LWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAndGktdHJlZXNlbGVjdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ3RyZWVzZWxlY3QuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi90cmVlc2VsZWN0Lmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRpVHJlZXNlbGVjdENvbXBvbmVudCldLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICcoYmx1ciknOiAnb25CbHVyKCknXHJcbiAgICB9XHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgVGlUcmVlc2VsZWN0Q29tcG9uZW50IGV4dGVuZHMgVGlTZWxlY3RDb21wb25lbnQge1xyXG5cclxuICAgIC8vIOaQnOe0ouahhueahOmrmOW6plxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgU0VBUkNIQk9YX0hFSUdIVDogbnVtYmVyID0gMzA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkuIvmi4npnaLmnb/nmoTpq5jluqbvvIzpu5jorqTlsZXnpLo45p2hXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGRyb3BNYXhIZWlnaHQ6IG51bWJlciA9ICgzMCArIDEpICogODtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5pCc57Si57uT5p6cXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbGRPcHRpb25zOiBBcnJheTxhbnk+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhoXpg6jmoIfnrb5cclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURyb3BDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIGRyb3BDb206IFRpRHJvcENvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhoXpg6jmoIfnrb5cclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZChUaURvbWluYXRvckNvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgZG9taW5hdG9yQ29tOiBUaURvbWluYXRvckNvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhoXpg6jmoIfnrb5cclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnc2VhcmNoYm94Q29tJykgc2VhcmNoYm94Q29tOiBUaVNlYXJjaGJveE5vdHNlYXJjaENvbXBvbmVudDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhoXpg6jmoIfnrb5cclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgnZGF0YXRlbXBsYXRlJykgZGF0YVRlbXBsYXRlOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhajpgInmoYbnmoTljYrpgInkuK3nirbmgIFcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluZGV0ZXJtaW5hdGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5YWo6YCJ5LitXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0FsbFNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOaQnOe0ouaPkOekuuaWh+acrFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VhcmNoUGxhY2Vob2xkZXI6IHN0cmluZyA9IFRpTG9jYWxlLmdldExvY2FsZVdvcmRzKCkudGlTZWxlY3Quc2VhcmNoO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDmkJzntKLlhoXlrrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlYXJjaFRleHQ6IHN0cmluZyA9ICcnO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDmmK/lkKblpITkuo7mkJzntKLnirbmgIFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpc0luU2VhcmNoOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgLy8g5Li75bmy5rex5ou36LSd77yM5Y+25a2Q5rWF5ou36LSdXHJcbiAgICAvLyDlm6DkuLrmkJzntKLnu5Pmnpzph4zvvIzlj7blrZDoioLngrnnmoTli77pgInmlYjmnpzvvIzpnIDopoHkv53nlZnlnKjljp/lp4vmlbDmja7jgIJcclxuICAgIHByaXZhdGUgc3RhdGljIGxlYWZTaGFsbG93Q2xvbmUoYXJyOiBhbnkpOiBBcnJheTxUaVRyZWVOb2RlPiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAoYXJyKSAhPT0gJ29iamVjdCcgfHwgYXJyID09PSBudWxsIHx8IChhcnIubGFiZWwgIT09IHVuZGVmaW5lZCAmJiBhcnIuY2hpbGRyZW4gPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNsb25lOiBhbnkgPSBBcnJheS5pc0FycmF5KGFycikgPyBhcnIuc2xpY2UoKSA6IHsgLi4uYXJyIH07XHJcbiAgICAgICAgY29uc3Qga2V5czogQXJyYXk8c3RyaW5nPiA9IE9iamVjdC5rZXlzKGNsb25lKTtcclxuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XHJcbiAgICAgICAgICAgIGNsb25lW2tleV0gPSBUaVRyZWVzZWxlY3RDb21wb25lbnQubGVhZlNoYWxsb3dDbG9uZShjbG9uZVtrZXldKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjbG9uZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHVzZS1saWZlLWN5Y2xlLWludGVyZmFjZVxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICAvLyDlvLrliLboo4XmjaLvvIzmlrnkvr/osIPnlKhzdXBlci54eHhcclxuICAgICAgICB0aGlzLmRyb3BzZWFyY2hDb20gPSB0aGlzLmRyb3BDb20gYXMgdW5rbm93biBhcyBUaURyb3BzZWFyY2hDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIC8vIOiusOW9leS8oOWFpeeahOaVsOaNru+8jOa1heaLt+i0nVxyXG4gICAgICAgIHRoaXMub2xkT3B0aW9ucyA9IHRoaXMub3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgLy8g6Kej5Yaz5bu26L+f5oiW6ICF5Yqo5oCB6K6+572ub3B0aW9uc++8jOagkee7hOS7tuacqua4suafk+eahOmXrumimFxyXG4gICAgICAgIGlmKGNoYW5nZXNbJ29wdGlvbnMnXSAmJiAhY2hhbmdlc1snb3B0aW9ucyddLmZpcnN0Q2hhbmdlKSB7XHJcbiAgICAgICAgICAgIC8vIOmHjeaWsOiusOW9leS8oOWFpeeahOaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLm9sZE9wdGlvbnMgPSBjaGFuZ2VzWydvcHRpb25zJ10uY3VycmVudFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHVzZS1saWZlLWN5Y2xlLWludGVyZmFjZVxyXG4gICAgbmdBZnRlclZpZXdDaGVja2VkKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaGFibGUgIT09IHRoaXMub2xkU2VhcmNoYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLm9sZFNlYXJjaGFibGUgPSB0aGlzLnNlYXJjaGFibGU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXModGhpcy5kb21pbmF0b3JDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jb25jYXQodGhpcy5zZWFyY2hib3hDb20uZ2V0Rm9jdXNhYmxlRWxlbXMoKSlcclxuICAgICAgICAgICAgICAgICAgICAuY29uY2F0KHRoaXMuZHJvcENvbS5uYXRpdmVFbGVtZW50KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZvY3VzYWJsZUVsZW1zKHRoaXMuZG9taW5hdG9yQ29tLmdldEZvY3VzYWJsZUVsZW1zKClcclxuICAgICAgICAgICAgICAgICAgICAuY29uY2F0KHRoaXMuZHJvcENvbS5uYXRpdmVFbGVtZW50KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6LCD55So54i257G76YC76L6RYWZ0ZXJWaWV3Q2hlY2tlZOaJjeWOu+iuvue9rmF1dG9mb2NzXHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdDaGVja2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIGRyb3Dpq5jluqbooqvljovnvKnml7bvvIzph43mlrDorr7nva7kuIvmi4npnaLmnb/nmoTpq5jluqZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZXN0eWxlRHJvcE1heEhlaWdodCgpOiB2b2lkIHtcclxuICAgICAgICBsZXQgZHJvcEN1ck1heEhlaWdodDogbnVtYmVyID0gcGFyc2VJbnQodGhpcy5kcm9wQ29tLm5hdGl2ZUVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0LCAxMCk7XHJcblxyXG4gICAgICAgIGxldCBkcm9wTWF4SGVpZ2h0QWRhcHRlZDogbnVtYmVyID0gdGhpcy5kcm9wTWF4SGVpZ2h0O1xyXG4gICAgICAgIGlmICghaXNOYU4oZHJvcEN1ck1heEhlaWdodCkpIHtcclxuICAgICAgICAgICAgLy8g5YeP5Y675pCc57Si5qGG6auY5bqm5ZKM6Ze06Led55qE5ZKMXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaGFibGUpIHtcclxuICAgICAgICAgICAgICAgIGRyb3BDdXJNYXhIZWlnaHQgLT0gVGlUcmVlc2VsZWN0Q29tcG9uZW50LlNFQVJDSEJPWF9IRUlHSFQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRyb3BDdXJNYXhIZWlnaHQgPCB0aGlzLmRyb3BNYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGRyb3BNYXhIZWlnaHRBZGFwdGVkID0gZHJvcEN1ck1heEhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmRhdGFUZW1wbGF0ZS5uYXRpdmVFbGVtZW50LCAnbWF4LWhlaWdodCcsIGRyb3BNYXhIZWlnaHRBZGFwdGVkICsgJ3B4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbk1vZGVsQ2hhbmdlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgICAgIC8vIOWkmumAieaXtu+8jOmHjeaWsOiuvue9ruS4i+aLiemdouadv+WumuS9jVxyXG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdEFsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5YWB6K645YWo6YCJ5pe277yM6K6+572u5YWo6YCJ5qGG54q25oCBXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFsbFNlbGVjdENoZWNrYm94U3RhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg6K6+572u5LiL5ouJ6Z2i5p2/5a6a5L2NXHJcbiAgICAgKi9cclxuICAgIHNldFBvc2l0aW9uKG9wdGlvbnNDaGFuZ2U/OiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3BDb20ucmVzZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wQ29tLnNldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZXN0eWxlRHJvcE1heEhlaWdodCgpO1xyXG4gICAgICAgIH0sIDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlhbPpl63kuIvmi4npnaLmnb/lubbovaznp7vnhKbngrlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGNsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHJvcENvbS5oaWRlKCk7XHJcbiAgICAgICAgLy8g54Sm54K56L2s56e76IezZG9taW5hdG9yXHJcbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRvbWluYXRvckNvbS5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5LuF5LuF5YWz6Zet5LiL5ouJ6Z2i5p2/XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY2xvc2VXaXRob3V0Rm9jdXMoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kcm9wQ29tLmhpZGUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5omT5byA5LiL5ouJ6Z2i5p2/XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOWIneWni+WMluacgOWkp+mrmOW6plxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5kYXRhVGVtcGxhdGUubmF0aXZlRWxlbWVudCwgJ21heC1oZWlnaHQnLCB0aGlzLmRyb3BNYXhIZWlnaHQgKyAncHgnKTtcclxuICAgICAgICB0aGlzLmRyb3BDb20uc2hvdygpO1xyXG4gICAgICAgIHRoaXMucmVzdHlsZURyb3BNYXhIZWlnaHQoKTtcclxuICAgICAgICAvLyDnhKbngrnovaznp7voh7PmkJzntKLmoYZcclxuICAgICAgICBpZiAodGhpcy5zZWFyY2hhYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoYm94Q29tLmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCd6K+V5omT5byA5LiL5ouJ6Z2i5p2/XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB3YW50T3BlbigpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci53YW50T3BlbigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDngrnlh7t0aS1kb21pbmF0b3Lop6blj5HnmoTkuovku7ZcclxuICAgICAqIOeCueWHu+S4i+aLiemdouadv++8jOWxleW8gOaIluiAheWFs+mXremdouadv1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja0RvbWluYXRvcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5kcm9wQ29tLmlzU2hvdykge1xyXG4gICAgICAgICAgICAvLyDmuIXnqbrmkJzntKLlhoXlrrlcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hUZXh0ID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoVGV4dENoYW5nZSh0aGlzLnNlYXJjaFRleHQpO1xyXG4gICAgICAgICAgICB0aGlzLndhbnRPcGVuKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5Yig6ZmkdGktZG9taW5hdG9y6YCJ5Lit6aG55pe26Kem5Y+R55qE5LqL5Lu2XHJcbiAgICAgKiDpnIDopoHlj5bmtojmoJHoioLngrnnmoTpgInkuK1cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uRGVsZXRlRG9taW5hdG9yVGFnKGl0ZW06IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRlbGV0ZWRJdGVtOiBUaVRyZWVOb2RlID0gaXRlbS5pdGVtO1xyXG4gICAgICAgIC8vIDEu5Y+W5raI6YCJ5Lit5b2T5YmN6IqC54K544CB6K6+572u5a2Q6IqC54K55Y+K56WW5YWI6IqC54K555qE6YCJ5Lit5oOF5Ya144CC5LuObW9kZWzkuK3liKDpmaTml7bvvIxpdGVtLml0ZW0uY2hlY2tlZOi/mOaYr+S4unRydWXvvIzopoHorr7nva7kuLpmYWxzZVxyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0U3RhdGUoZGVsZXRlZEl0ZW0sICFkZWxldGVkSXRlbS5jaGVja2VkKTtcclxuXHJcbiAgICAgICAgLy8gMi7orr7nva7kuLrpnZ7lhajpgIlcclxuICAgICAgICB0aGlzLmlzQWxsU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAvLyAzLuiuvue9ruWFqOmAieahhueKtuaAgVxyXG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlICYmIHRoaXMuc2VsZWN0QWxsKSB7XHJcbiAgICAgICAgICAgIGl0ZW0ubW9kZWwubGVuZ3RoID09PSAwID8gdGhpcy5pbmRldGVybWluYXRlID0gZmFsc2UgOiB0aGlzLmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUgdGktc2VhcmNoYm94LW5vdHNlYXJjaOaQnOe0ouahhuWGheWuueWPmOWMluaXtuinpuWPkeeahOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VhcmNoVGV4dENoYW5nZShzZWFyY2hUZXh0OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBpZiAoVXRpbC5pc0VtcHR5U3RyaW5nKHNlYXJjaFRleHQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMub2xkT3B0aW9ucztcclxuICAgICAgICAgICAgdGhpcy5pc0luU2VhcmNoID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5vbGRPcHRpb25zIOWPtuWtkOa1heaLt+i0nVxyXG4gICAgICAgICAgICBjb25zdCBzZWFyY2hSZXN1bHQ6IEFycmF5PFRpVHJlZU5vZGU+ID0gVGlUcmVlc2VsZWN0Q29tcG9uZW50LmxlYWZTaGFsbG93Q2xvbmUodGhpcy5vbGRPcHRpb25zKTtcclxuICAgICAgICAgICAgVGlUcmVlVXRpbC5zZWFyY2goc2VhcmNoUmVzdWx0LCAoY25vZGU6IFRpVHJlZU5vZGUpOiBib29sZWFuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoY25vZGUubGFiZWwuaW5kZXhPZih0aGlzLnNlYXJjaFRleHQpID49IDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5bGV5byA5pW05Liq5qCRXHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2Uoc2VhcmNoUmVzdWx0LCAobm9kZTogVGlUcmVlTm9kZSk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgbm9kZS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBzZWFyY2hSZXN1bHQ7XHJcbiAgICAgICAgICAgIHRoaXMuaXNJblNlYXJjaCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlICYmIHRoaXMuc2VsZWN0QWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWxsU2VsZWN0Q2hlY2tib3hTdGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6YeN5paw6K6+572u6Z2i5p2/5a6a5L2NXHJcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5LuObW9kZWzkuK3ojrflj5ZvcHRpb27miYDlnKjnmoTntKLlvJVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRJdGVtSW5kZXhGcm9tTW9kZWwob3B0aW9uOiBUaVRyZWVOb2RlKTogbnVtYmVyIHtcclxuICAgICAgICBsZXQgaW5kZXg6IG51bWJlciA9IC0xO1xyXG4gICAgICAgIGluZGV4ID0gdGhpcy5tb2RlbC5maW5kSW5kZXgoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDliKTmlq1pdGVt5ZKMb3B0aW9u55qE5byV55So5piv5ZCm55u45ZCM5Y2z5Y+vXHJcbiAgICAgICAgICAgIHJldHVybiAoaXRlbSAgPT09IG9wdGlvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg6I635Y+W6ZyA6KaB5pS+5YiwbW9kZWzkuK3nmoToioLngrnvvIzmoLnmja7op4TojIPvvIzlpoLmnpzlrZDoioLngrnlhajpg6jpgInkuK3kuobvvIzpnIDopoHlnKhtb2RlbOS4reaUvuWFpeeItuiKgueCueaIluiAheelluWFiOiKgueCueOAguaJvuWIsOesrOS4gOS4qmNoZWNrZWTkuLp0cnVl55qE6IqC54K55Y2z5Y+vXHJcbiAgICAgKiBub2RlOiDmoJHnu4Tku7ZzZWxlY3Tkuovku7bkuK3nmoTlj4LmlbBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRSZWFsU2VsZWN0ZWROb2RlKG5vZGU6IFRpVHJlZU5vZGUpOiBUaVRyZWVOb2RlIHtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLW51bGwta2V5d29yZFxyXG4gICAgICAgIGxldCBzZWxlY3RlZE5vZGU6IFRpVHJlZU5vZGUgPSBudWxsO1xyXG4gICAgICAgIGNvbnN0IHBhcmVudE5vZGU6IFRpVHJlZU5vZGUgPSBUaVRyZWVVdGlsLmdldFBhcmVudE5vZGUodGhpcy5vbGRPcHRpb25zLCBub2RlKTtcclxuICAgICAgICAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLmNoZWNrZWQgPT09IHRydWUpID8gc2VsZWN0ZWROb2RlID0gIHRoaXMuZ2V0UmVhbFNlbGVjdGVkTm9kZShwYXJlbnROb2RlKSA6IHNlbGVjdGVkTm9kZSA9ICBub2RlO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VsZWN0ZWROb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDojrflj5bpnIDopoHku45tb2RlbOenu+mZpOeahOiKgueCue+8jOagueaNruinhOiMg++8jOWmguaenOafkOS4quWtkOiKgueCueWPlua2iOmAieS4reS6hu+8jOmCo+S5iOWPr+iDveaYr+Wug+eahOeItuiKgueCueaIluelluWFiOiKgueCueaIluaJgOacieWtkOiKgueCueS7jm1vZGVs5Lit6KKr56e76ZmkXHJcbiAgICAgKiBub2Rl77ya5qCR57uE5Lu2c2VsZWN05LqL5Lu255qE5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0UmVhbFVuc2VsZWN0ZWROb2RlKG5vZGU6IFRpVHJlZU5vZGUpOiBUaVRyZWVOb2RlIHtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLW51bGwta2V5d29yZFxyXG4gICAgICAgIGxldCB1bnNlbGVjdGVkTm9kZTogVGlUcmVlTm9kZSA9IG51bGw7XHJcbiAgICAgICAgbGV0IHBhcmVudE5vZGU6IFRpVHJlZU5vZGUgPSBUaVRyZWVVdGlsLmdldFBhcmVudE5vZGUodGhpcy5vbGRPcHRpb25zLCBub2RlKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZ2V0SXRlbUluZGV4RnJvbU1vZGVsKG5vZGUpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAvLyDpnIDopoHku45tb2RlbOS4reenu+mZpOeahOiKgueCueaYr25vZGXmnKzouqtcclxuICAgICAgICAgICAgdW5zZWxlY3RlZE5vZGUgPSBub2RlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOmcgOimgeS7jm1vZGVs5Lit56e76Zmk55qE6IqC54K55pivbm9kZeeItuiKgueCueaIluelluWFiOiKgueCuVxyXG4gICAgICAgICAgICAvLyDlvZPoioLngrnlpITkuo7ljYrpgInnirbmgIHml7Ys54K55Ye76IqC54K555qE5aSN6YCJ5qGGLOiKgueCueeKtuaAgeS4uumAieS4rSzlkKbliJnkuLrpnZ7pgInkuK0s5omA5Lul6KaB5YWI5Yik5patcGFyZW50Tm9kZeaYr+WQpuWtmOWcqFxyXG4gICAgICAgICAgICB3aGlsZSAocGFyZW50Tm9kZSAmJiB0aGlzLmdldEl0ZW1JbmRleEZyb21Nb2RlbChwYXJlbnROb2RlKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBUaVRyZWVVdGlsLmdldFBhcmVudE5vZGUodGhpcy5vbGRPcHRpb25zLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBwYXJlbnROb2Rl5Y+v6IO95Li6dW5kZWZpbmVkXHJcbiAgICAgICAgICAgIHVuc2VsZWN0ZWROb2RlID0gcGFyZW50Tm9kZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB1bnNlbGVjdGVkTm9kZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5Y+W5raI6YCJ5Lit5pe277yM6I635Y+W6KKr6YCJ5Lit55qE5a2Q6IqC54K577yM5qC55o2u6KeE6IyD77yM54i26IqC54K55oiW56WW5YWI6IqC54K56KKr6YCJ5Lit5LmL5ZCO77yM5aaC5p6c5Y+W5raI5LqG5p+Q5Liq5a2Q6IqC54K555qE6YCJ5Lit77yM6YKj5LmI6ZyA6KaB5oqK5a6D55qE5omA5pyJ6YCJ5Lit55qE5a2Q6IqC54K55Yqg5YWlbW9kZWzkuK1cclxuICAgICAqIHVuc2VsZWN0ZWROb2Rl77ya6ZyA6KaB5LuObW9kZWzkuK3np7vpmaTnmoToioLngrlcclxuICAgICAqL1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZnVuY3Rpb24tb3Zlci1tZXRob2RcclxuICAgIHByaXZhdGUgZ2V0U2VsZWN0ZWRDaGlsZHJlbih1bnNlbGVjdGVkTm9kZTogVGlUcmVlTm9kZSk6IEFycmF5PFRpVHJlZU5vZGU+IHtcclxuICAgICAgICBsZXQgc2VsZWN0ZWRDaGlsZHJlbjogQXJyYXk8VGlUcmVlTm9kZT4gPSBbXTtcclxuICAgICAgICBpZiAodW5zZWxlY3RlZE5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgdW5zZWxlY3RlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQ6IFRpVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5jaGVja2VkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDaGlsZHJlbi5wdXNoKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDaGlsZHJlbiA9IHNlbGVjdGVkQ2hpbGRyZW4uY29uY2F0KHRoaXMuZ2V0U2VsZWN0ZWRDaGlsZHJlbihjaGlsZCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZENoaWxkcmVuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDmoLnmja5jaGVja2Vk55qE5YC877yM6K6+572ub3B0aW9u6IqC54K55Y+K5YW25a2Q6IqC54K55ZKM56WW5YWI6IqC54K555qE6YCJ5Lit54q25oCBXHJcbiAgICAgKiBvcHRpb246IOmAieS4reeahOiKgueCue+8m2NoZWNrZWTvvJpvcHRpb24uY2hlY2tlZOWxnuaAp++8jHRydWUvZmFsc2VcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRTZWxlY3RTdGF0ZShvcHRpb246IFRpVHJlZU5vZGUsIGNoZWNrZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICAvLyDlr7lvbGRPcHRpb25z6L+b6KGM5pON5L2c77yM5bCG5pCc57Si5pe255qE57uT5p6c5pig5bCE5Zue5p2lXHJcbiAgICAgICAgVGlUcmVlVXRpbC50cmF2ZXJzZSh0aGlzLm9sZE9wdGlvbnMsIChub2RlOiBUaVRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChub2RlID09PSBvcHRpb24pIHtcclxuICAgICAgICAgICAgICAgIG5vZGUuY2hlY2tlZCA9IGNoZWNrZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuc2VsZWN0QWxsQ2hpbGRyZW4obm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgVGlUcmVlVXRpbC5zZWxlY3RQYXJlbnRzKG5vZGUsIHRoaXMub2xkT3B0aW9ucywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFRpVHJlZVV0aWwuZGVTZWxlY3RBbGxDaGlsZHJlbihub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBUaVRyZWVVdGlsLmRlU2VsZWN0UGFyZW50cyhub2RlLCB0aGlzLm9sZE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDpgInkuK3mn5DkuKroioLngrnlkI7vvIzmm7TmlrB0aGlzLm1vZGVsXHJcbiAgICAgKiBvcHRpb246IOmAieS4reeahOiKgueCuVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldE1vZGVsV2hlblNlbGVjdGVkKG9wdGlvbjogVGlUcmVlTm9kZSk6IHZvaWQge1xyXG4gICAgICAgIC8vIDEu6I635Y+Wb3B0aW9u5pyA5ZCO5LiA5Liq6KKr6YCJ5Lit55qE56WW5YWI6IqC54K5XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWROb2RlOiBUaVRyZWVOb2RlID0gdGhpcy5nZXRSZWFsU2VsZWN0ZWROb2RlKG9wdGlvbik7XHJcbiAgICAgICAgLy8gMi7ku45tb2RlbOS4reWIoOmZpHNlbGVjdE5vZGXnmoTmiYDmnInlrZDoioLngrnvvIzkuIDnm7TliLDlj7blrZDoioLngrlcclxuICAgICAgICBUaVRyZWVVdGlsLnRyYXZlcnNlKFtzZWxlY3RlZE5vZGVdLCAobm9kZTogVGlUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZGVsZXRlSW5kZXg6IG51bWJlciA9IHRoaXMuZ2V0SXRlbUluZGV4RnJvbU1vZGVsKG5vZGUpO1xyXG4gICAgICAgICAgICB3aGlsZSAoZGVsZXRlSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNwbGljZShkZWxldGVJbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICBkZWxldGVJbmRleCA9IHRoaXMuZ2V0SXRlbUluZGV4RnJvbU1vZGVsKG5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gMy7lsIZzZWxlY3RlZE5vZGXliqDlhaXliLB0aGlzLm1vZGVs5LitXHJcbiAgICAgICAgaWYgKHRoaXMuZ2V0SXRlbUluZGV4RnJvbU1vZGVsKHNlbGVjdGVkTm9kZSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwucHVzaChzZWxlY3RlZE5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg5Y+W5raI6YCJ5Lit5p+Q5Liq6IqC54K55ZCO77yM5pu05pawdGhpcy5tb2RlbFxyXG4gICAgICogb3B0aW9uOiDooqvlj5bmtojpgInkuK3nmoToioLngrlcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRNb2RlbFdoZW5VbnNlbGVjdGVkKG9wdGlvbjogVGlUcmVlTm9kZSk6IHZvaWQge1xyXG4gICAgICAgIC8vIDEu6I635Y+W6ZyA6KaB5LuObW9kZWzkuK3liKDpmaTnmoToioLngrlcclxuICAgICAgICBjb25zdCB1bnNlbGVjdGVkTm9kZTogVGlUcmVlTm9kZSA9IHRoaXMuZ2V0UmVhbFVuc2VsZWN0ZWROb2RlKG9wdGlvbik7XHJcblxyXG4gICAgICAgIC8vIDIu5pu05pawbW9kZWxcclxuICAgICAgICBpZiAodW5zZWxlY3RlZE5vZGUpIHtcclxuICAgICAgICAgICAgLy8gMi4xdW5zZWxlY3RlZE5vZGXkuLpvcHRpb27miJZvcHRpb27nmoTnpZblhYjoioLngrlcclxuICAgICAgICAgICAgY29uc3QgZGVsZXRlSW5kZXg6IG51bWJlciA9IHRoaXMuZ2V0SXRlbUluZGV4RnJvbU1vZGVsKHVuc2VsZWN0ZWROb2RlKTtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zcGxpY2UoZGVsZXRlSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAvLyDlsIZvcHRpb27miYDmnInpgInkuK3nmoTlrZDoioLngrnlrZjmlL7liLB0aGlzLm1vZGVs5LitXHJcbiAgICAgICAgICAgIGlmICh1bnNlbGVjdGVkTm9kZSAhPT0gb3B0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZENoaWxkcmVuOiBBcnJheTxUaVRyZWVOb2RlPiA9IHRoaXMuZ2V0U2VsZWN0ZWRDaGlsZHJlbih1bnNlbGVjdGVkTm9kZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsID0gdGhpcy5tb2RlbC5jb25jYXQoc2VsZWN0ZWRDaGlsZHJlbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAyLjJ1bnNlbGVjdGVkTm9kZeS4unVuZGVmaW5lZO+8jOi/meenjeaDheWGteS4i++8jOWPqumcgOS7jm1vZGVs5Lit5Yig6Zmkb3B0aW9u5omA5pyJ6YCJ5Lit55qE5a2Q6IqC54K5XHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UoW29wdGlvbl0sIChub2RlOiBUaVRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkZWxldGVJbmRleDogbnVtYmVyID0gdGhpcy5nZXRJdGVtSW5kZXhGcm9tTW9kZWwobm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zcGxpY2UoZGVsZXRlSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZSDlpITkuo7mkJzntKLnirbmgIHkuIvvvIzmm7TmlrBtb2RlbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldE1vZGVsV2hlblNlYXJjaChkYXRhOiBBcnJheTxUaVRyZWVOb2RlPiwgY2hlY2tlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIC8vIOaIluiAheaJgOacieWkhOS6jmNoZWNrZWTnirbmgIHnmoTlj7blrZDoioLngrlcclxuICAgICAgICBsZXQgc2VsZWN0ZWRMZWFmTm9kZXM6IEFycmF5PFRpVHJlZU5vZGU+ID0gW107XHJcbiAgICAgICAgc2VsZWN0ZWRMZWFmTm9kZXMgPSB0aGlzLmdldExlYWZOb2RlcyhkYXRhLCBjaGVja2VkKTtcclxuICAgICAgICAvLyDmoLnmja7mr4/kuKrlj7blrZDoioLngrnmm7TmlrBtb2RlbFxyXG4gICAgICAgIGZvciAoY29uc3QgbGVhZk5vZGUgb2Ygc2VsZWN0ZWRMZWFmTm9kZXMpIHtcclxuICAgICAgICAgICAgLy8g6K6+572ub2xkT3B0aW9uc+WQhOiKgueCueeKtuaAgVxyXG4gICAgICAgICAgICB0aGlzLnNldFNlbGVjdFN0YXRlKGxlYWZOb2RlLCBjaGVja2VkKTtcclxuICAgICAgICAgICAgY2hlY2tlZCA/IHRoaXMuc2V0TW9kZWxXaGVuU2VsZWN0ZWQobGVhZk5vZGUpIDogdGhpcy5zZXRNb2RlbFdoZW5VbnNlbGVjdGVkKGxlYWZOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOiOt+WPlmRhdGHph4zpnaLpgInkuK3miJbogIXmnKrpgInkuK3nmoTlhajpg6jlj7blrZDoioLngrlcclxuICAgICAqIGRhdGHvvJrmkJzntKLojIPlm7TvvIxjaGVja2Vk77yadHJ1ZS9mYWxzZVxyXG4gICAgICovXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHByZWZlci1mdW5jdGlvbi1vdmVyLW1ldGhvZFxyXG4gICAgcHJpdmF0ZSBnZXRMZWFmTm9kZXMoZGF0YTogQXJyYXk8VGlUcmVlTm9kZT4sIGNoZWNrZWQ6IGJvb2xlYW4pOiBBcnJheTxUaVRyZWVOb2RlPiB7XHJcbiAgICAgICAgY29uc3QgbGVhZk5vZGVzOiBBcnJheTxUaVRyZWVOb2RlPiA9IFtdO1xyXG4gICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UoZGF0YSwgKG5vZGU6IFRpVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKFRpVHJlZVV0aWwuaXNMZWFmKG5vZGUpICYmIG5vZGUuY2hlY2tlZCA9PT0gY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgbGVhZk5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxlYWZOb2RlcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUg6K6+572u5YWo6YCJY2hlY2tib3jnmoTnirbmgIFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzZXRBbGxTZWxlY3RDaGVja2JveFN0YXRlKCk6IHZvaWQge1xyXG5cclxuICAgICAgICAvLyAxLuWBh+iuvuiKgueCuemDveiiq+mAieS4reaIlumDveayoeiiq+mAieS4rVxyXG4gICAgICAgIGxldCBpc0FsbFNlbGVjdGVkOiBib29sZWFuID0gdHJ1ZTtcclxuICAgICAgICBsZXQgaXNBbGxVblNlbGVjdGVkOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gMi7liKTmlq3mmK/lkKbmiYDmnInoioLngrnpg73ooqvpgInkuK3miJbpg73msqHooqvpgInkuK3vvIxkaXNhYmxlZOeKtuaAgeS4i+eahOiKgueCueS4jeeUqOe7n+iuoVxyXG4gICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UodGhpcy5vcHRpb25zLCAobm9kZTogVGlUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAvLyAyLjEg5pyJ6IqC54K55rKh6KKr6YCJ5LitXHJcbiAgICAgICAgICAgIGlmICghbm9kZS5kaXNhYmxlZCAmJiBub2RlLmNoZWNrZWQgIT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGlzQWxsU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyAyLjIg5pyJ6IqC54K56KKr6YCJ5Lit5oiW5Y2K6YCJ5LitXHJcbiAgICAgICAgICAgIGlmICghbm9kZS5kaXNhYmxlZCAmJiAobm9kZS5jaGVja2VkID09PSB0cnVlIHx8IG5vZGUuY2hlY2tlZCA9PT0gJ2luZGV0ZXJtaW5hdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgaXNBbGxVblNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gMy7orr7nva5jaGVja2JveOeKtuaAgVxyXG4gICAgICAgIHRoaXMuaXNBbGxTZWxlY3RlZCA9IGlzQWxsU2VsZWN0ZWQ7XHJcbiAgICAgICAgdGhpcy5pbmRldGVybWluYXRlID0gIWlzQWxsU2VsZWN0ZWQgJiYgIWlzQWxsVW5TZWxlY3RlZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmUgdGktdHJlZeeahHNlbGVjdOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25UcmVlU2VsZWN0KG9wdGlvbjogYW55KTogdm9pZCB7XHJcblxyXG4gICAgICAgIC8vIOiKgueCueiiq+emgeeUqO+8jOS4jeWBmuaTjeS9nO+8jOebtOaOpei/lOWbnlxyXG4gICAgICAgIGlmIChvcHRpb24uZGlzYWJsZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gMS7op6blj5FzZWxlY3Tkuovku7ZcclxuICAgICAgICB0aGlzLnNlbGVjdC5lbWl0KG9wdGlvbik7XHJcbiAgICAgICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgICAgIC8vIDIuMeWNlemAie+8jOebtOaOpeabv+aNom1vZGVsXHJcbiAgICAgICAgICAgIFRpVHJlZVV0aWwudHJhdmVyc2UodGhpcy5vbGRPcHRpb25zLCAobm9kZTogVGlUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgPT09IG9wdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IFtvcHRpb25dO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOWFs+mXreS4i+aLiemdouadv1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gMi4y5aSa6YCJXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0luU2VhcmNoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAyLjIuMemdnuaQnOe0oueKtuaAgVxyXG4gICAgICAgICAgICAgICAgLy8g6K6+572ub2xkT3B0aW9uc+WQhOiKgueCueeKtuaAgVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTZWxlY3RTdGF0ZShvcHRpb24sIG9wdGlvbi5jaGVja2VkKTtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb24uY2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TW9kZWxXaGVuU2VsZWN0ZWQob3B0aW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRNb2RlbFdoZW5VbnNlbGVjdGVkKG9wdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyAyLjIuMuaQnOe0oueKtuaAgVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRNb2RlbFdoZW5TZWFyY2goW29wdGlvbl0sIG9wdGlvbi5jaGVja2VkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gMi4z5omL5Yqo6Kem5Y+RbmdNb2RlbENoYW5nZeS6i+S7tu+8jHNwbGljZeWSjHB1c2jml6Dms5Xop6blj5FcclxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMubW9kZWwuY29uY2F0KCk7XHJcbiAgICAgICAgICAgIC8vIDIuNOiuvue9ruWFqOmAieeKtuaAgVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RBbGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWxsU2VsZWN0Q2hlY2tib3hTdGF0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAzLumHjeaWsOiuvue9rnRpLWRvbWluYXRvcumrmOW6plxyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOWFqOmAieWkjemAieahhueahOaMiemSruS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25TZWxlY3RBbGxDaGFuZ2UoaXNBbGxTZWxlY3RlZDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgLy8gMS7lsIblvZPliY10cmVl6IqC54K55YWo6YOo6YCJ5LitIOaIliDkuI3pgInkuK1cclxuICAgICAgICBUaVRyZWVVdGlsLnRyYXZlcnNlKHRoaXMub3B0aW9ucywgKG5vZGU6IFRpVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFub2RlLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLmNoZWNrZWQgPSBpc0FsbFNlbGVjdGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIDIu6K6+572ubW9kZWxcclxuICAgICAgICBpZiAoIXRoaXMuaXNJblNlYXJjaCkge1xyXG4gICAgICAgICAgICAvLyAyLjEg5pyq5aSE5LqO5pCc57Si54q25oCB5LiL77yM5L2/55SoY29uY2F06L+b6KGM5Y2V5bGC5rex5ou36LSdXHJcbiAgICAgICAgICAgICghdGhpcy5pc0FsbFNlbGVjdGVkKSA/IHRoaXMubW9kZWwgPSB0aGlzLm9wdGlvbnMuY29uY2F0KCkgOiB0aGlzLm1vZGVsID0gW107XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gMi4yICDlpITkuo7mkJzntKLnirbmgIHkuItcclxuICAgICAgICAgICAgdGhpcy5zZXRNb2RlbFdoZW5TZWFyY2godGhpcy5vcHRpb25zLCBpc0FsbFNlbGVjdGVkKTtcclxuICAgICAgICAgICAgLy8g5omL5Yqo6Kem5Y+RbmdNb2RlbENoYW5nZeS6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLm1vZGVsID0gdGhpcy5tb2RlbC5jb25jYXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlIOWFqOmAieWkjemAieahhueahOeCueWHu+S6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25DbGlja1NlbGVjdEFsbChldmVudDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgLy8g54K55Ye75pe277yMdGhpcy5pc0FsbFNlbGVjdGVk5Li6ZmFsc2XvvIzmiYDku6XopoHlj5blj41cclxuICAgICAgICB0aGlzLm9uU2VsZWN0QWxsQ2hhbmdlKCF0aGlzLmlzQWxsU2VsZWN0ZWQpO1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDlpLHnhKbmg4XlhrXkuIvvvIzku4XlhbPpl63pnaLmnb/vvIzkuI3lgZrogZrnhKbnrYnlpITnkIZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQmx1cigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNsb3NlV2l0aG91dEZvY3VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDpvKDmoIfngrnlh7vliLDnqbrnmb3vvIzljp/mnKzkvJrlpLHnhKbvvIzmraTlpITpgJrov4fpmLvmraLpu5jorqTkuovku7bnmoTmlrnlvI/ov5vooYzkuoblpITnkIZcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uTW91c2VEb3duRHJvcE91dGVyKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogI2RhdGF0ZW1wbGF0ZeWGhemDqOa7muWKqOadoeS8muW8lei1t+WklumDqOa7muWKqOadoeS6i+S7tuinpuWPke+8jOW8lei1t+W8ueahhuWGheeahOagkeS4i+aLiee7hOS7tuaXoOazleS9v+eUqOm8oOagh+aLluWKqOa7muWKqOadoe+8jOWboOatpOatpOWkhOmYu+atouS6i+S7tuWGkuazoVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25Nb3VzZVdoZWVsKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxufVxyXG4iXX0=