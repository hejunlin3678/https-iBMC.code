/*
 * @Author: walker
 * @Date: 2018-09-06 15:05:42
 * @Last Modified by: walker
 * @Last Modified time: 2018-09-12 11:03:35
 */
import { Component, ContentChild, EventEmitter, Input, Output, TemplateRef } from '@angular/core';
import { TiAutocompleteComponent } from '../autocomplete/TiAutocompleteModule';
import { TiFormComponent } from '../base/TiBaseModule';
/**
 * 搜索框组件
 *
 * <example-url>../tiny3demo/#/searchbox/searchbox-all</example-url>
 */
export class TiSearchboxComponent extends TiAutocompleteComponent {
    constructor() {
        super(...arguments);
        /**
         * 10.0.4版本新增
         *
         * 是否删除用户搜索内容的首尾空格，不配置时不删除空格
         */
        this.trimmed = false;
        /**
         * search事件，当选中下拉选项/按enter键/点击搜索图标时触发
         *
         * 参数：搜索框文本
         */
        this.search = new EventEmitter();
    }
    ngOnInit() {
        // 默认有清除图标且不可配置
        // 此处先赋值后继承，是由于父类中初始化需要读取clearable的值，设置清除图标
        this.clearable = true;
        super.ngOnInit();
    }
    /**
     * @ignore
     * 组件model更改时，更新input绑定值
     */
    writeValue(model) {
        super.writeValue(model);
        this.inputValue = model;
    }
    // 组件交互方法集合--start
    /**
     * @ignore
     * enter的触发有两种情况：
     * 1.在input框中输入值，然后按下enter，此时正常执行search
     * 2.在suggestion面板展开的情况下，通过hover选中一项，然后按下enter，
     *   此时的search应该在下拉面板的onDroplistChange回调中触发
     */
    onInputEnter() {
        if (!this.isSearchWithHoverOption()) { // 排除第2中情况
            this.onSearch();
        }
    }
    /**
     * @ignore
     * 搜索事件触发
     */
    onSearch() {
        if (this.disabled) {
            return;
        }
        this.search.emit(this.model);
    }
    /**
     * @ignore
     * 两种情况下触发
     * 1.在suggestion面板展开的情况下，通过hover选中一项，然后按下enter
     * 2.在suggestion面板展开的情况下，通过鼠标点击选中一项
     */
    onDroplistChange(value) {
        if (value) {
            this.model = this.inputValue = value[this.labelKey] || value.label;
            this.onSearch();
        }
    }
    // 组件交互方法集合--end
    isSearchWithHoverOption() {
        // suggestion面板展开且存在hover选中项的情况
        return this.dropListComp.isShow && this.dropListComp.listCom.hoverOption;
    }
    /**
     * @ignore
     * 输入框中内容改变事件
     */
    onInputChange(value) {
        if (this.disabled || !this.isFocused) {
            return;
        }
        const searchValue = this.trimValue(value);
        this.model = searchValue;
        this.inputChangeObserve.next(searchValue);
    }
    /**
     * 控制是否删除搜索内容的首尾空格
     */
    trimValue(value) {
        let searchValue = value;
        if (this.trimmed && searchValue) {
            searchValue = searchValue.trim();
        }
        return searchValue;
    }
}
TiSearchboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-searchbox',
                template: "<input #input tiText\r\n        class=\"ti3-searchbox-input\"\r\n        [disabled]=\"disabled\"\r\n        spellcheck=false\r\n        (keyup.enter)=\"onInputEnter()\"\r\n        [(ngModel)] = \"inputValue\"\r\n        [placeholder]=\"placeholder\"\r\n        (clear)=\"onClear($event)\"\r\n        (ngModelChange)=\"onInputChange($event)\"\r\n        [maxlength]=\"maxlength\"\r\n        [id]=\"appendId('input')\"\r\n        (mousedown)=\"onInputMousedown()\">\r\n<div class=\"ti3-searchbox-divider\"\r\n     (mousedown)=\"onSearch()\"\r\n     [hidden]=\"model === '' || model === undefined || model === null\"></div>\r\n<div class=\"ti3-searchbox-search ti3-icon ti3-icon-search\" tiOutline [tabindex]=\"disabled ? -1 : 0\" style=\"outline-offset: -2px;\"\r\n     (mousedown)=\"onSearch()\" (keydown.enter)=\"onSearch()\"\r\n     [id]=\"appendId('search')\"></div>\r\n<ti-droplist #droplist\r\n              [dominatorElem]=\"nativeElement\"\r\n              [options]=\"suggestions\"\r\n              [(ngModel)]=\"selected\"\r\n              [labelKey]=\"labelKey\"\r\n              [panelMaxHeight]=\"panelMaxHeight\"\r\n              [panelWidth]=\"panelWidth\"\r\n              (ngModelChange)=\"onDroplistChange($event)\"\r\n              [id]=\"appendId('droplist')\">\r\n        <ng-template let-item let-i=index>\r\n                <ng-container *ngIf=\"itemTemplate else listLabelTemplate\">\r\n                        <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item,index: i}\">\r\n                        </ng-container>\r\n                </ng-container>\r\n                <ng-template #listLabelTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n        </ng-template>\r\n</ti-droplist>",
                providers: [TiFormComponent.getValueAccessor(TiSearchboxComponent)],
                host: {
                    '[class.ti3-searchbox-container]': 'true',
                    '(blur)': 'onBlur()',
                    '(focus)': 'onFocus()'
                },
                styles: ["::ng-deep :root{--ti-searchbox-container-width:200px;--ti-searchbox-divider-height:calc(var(--ti-input-height)/2);--ti-searchbox-divider-width:1px;--ti-searchbox-icon-area-width:34px;--ti-searchbox-icon-size:14px}:host.ti3-searchbox-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-input-border-radius);box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-input-height);line-height:normal;position:relative;text-align:left;vertical-align:middle;width:var(--ti-searchbox-container-width)}:host.ti3-searchbox-container:after{content:\"\";display:inline-block;height:100%;line-height:100%;vertical-align:middle}:host.ti3-searchbox-container .ti3-searchbox-input{background-color:transparent;border:none!important;border-radius:3px;box-shadow:none;box-sizing:border-box;float:left;height:100%;outline:none;overflow:hidden;padding:0 0 0 var(--ti-input-padding-horizontal);text-decoration:none;text-overflow:ellipsis;white-space:nowrap;width:calc(100% - var(--ti-searchbox-icon-area-width) - var(--ti-searchbox-divider-width))}:host.ti3-searchbox-container .ti3-searchbox-divider{height:var(--ti-searchbox-divider-height);position:absolute;right:var(--ti-searchbox-icon-area-width);top:calc(50% - var(--ti-searchbox-divider-height)/2);vertical-align:middle;width:var(--ti-searchbox-divider-width)}:host.ti3-searchbox-container .ti3-searchbox-search{border-radius:0 3px 3px 0;float:right;font-size:var(--ti-searchbox-icon-size);height:100%;text-align:center;width:var(--ti-searchbox-icon-area-width)}:host.ti3-searchbox-container .ti3-searchbox-search:before{position:relative;top:calc(50% - var(--ti-searchbox-icon-size)/2)}:host.ti3-searchbox-container:not([disabled]){background-color:var(--ti-input-bg-color);border-color:var(--ti-input-border-color)}:host.ti3-searchbox-container:not([disabled]):hover{border-color:var(--ti-input-border-color-hover)}:host.ti3-searchbox-container:not([disabled])[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-divider{background-color:var(--ti-common-color-line-dividing)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search{color:var(--ti-common-color-icon-normal)}:host.ti3-searchbox-container:not([disabled]) .ti3-searchbox-search:hover{color:var(--ti-common-color-icon-hover)}:host.ti3-searchbox-container[disabled]{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);cursor:not-allowed}:host.ti3-searchbox-container[disabled] .ti3-searchbox-divider{background-color:var(--ti-input-border-color-disabled)}:host.ti3-searchbox-container[disabled] .ti3-searchbox-search{color:var(--ti-common-color-icon-disabled)}"]
            },] }
];
TiSearchboxComponent.propDecorators = {
    trimmed: [{ type: Input }],
    search: [{ type: Output }],
    itemTemplate: [{ type: ContentChild, args: ['item', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlTZWFyY2hib3hDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy9zZWFyY2hib3gvVGlTZWFyY2hib3hDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFDSCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXZEOzs7O0dBSUc7QUFZSCxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsdUJBQXVCO0lBWGpFOztRQVlJOzs7O1dBSUc7UUFDTSxZQUFPLEdBQVksS0FBSyxDQUFDO1FBQ2xDOzs7O1dBSUc7UUFDZ0IsV0FBTSxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO0lBOEZqRixDQUFDO0lBcEZHLFFBQVE7UUFDSixlQUFlO1FBQ2YsMkNBQTJDO1FBQzNDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsVUFBVSxDQUFDLEtBQWE7UUFDcEIsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUM1QixDQUFDO0lBRUQsa0JBQWtCO0lBRWxCOzs7Ozs7T0FNRztJQUNJLFlBQVk7UUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsRUFBRSxVQUFVO1lBQzdDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNuQjtJQUNMLENBQUM7SUFDRDs7O09BR0c7SUFDSSxRQUFRO1FBQ1gsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsT0FBTztTQUNWO1FBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFDRDs7Ozs7T0FLRztJQUNILGdCQUFnQixDQUFDLEtBQXdCO1FBQ3JDLElBQUksS0FBSyxFQUFFO1lBQ1AsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztZQUNuRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDbkI7SUFDTCxDQUFDO0lBQ0QsZ0JBQWdCO0lBRVIsdUJBQXVCO1FBQzNCLCtCQUErQjtRQUMvQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQztJQUM3RSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksYUFBYSxDQUFDLEtBQWE7UUFDOUIsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQyxPQUFPO1NBQ1Y7UUFFRCxNQUFNLFdBQVcsR0FBVyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssU0FBUyxDQUFDLEtBQWE7UUFDM0IsSUFBSSxXQUFXLEdBQVcsS0FBSyxDQUFDO1FBQ2hDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxXQUFXLEVBQUU7WUFDN0IsV0FBVyxHQUFHLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNwQztRQUVELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7OztZQXBISixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLGl2REFBK0I7Z0JBRS9CLFNBQVMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO2dCQUNuRSxJQUFJLEVBQUU7b0JBQ0YsaUNBQWlDLEVBQUUsTUFBTTtvQkFDekMsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLFNBQVMsRUFBRSxXQUFXO2lCQUN6Qjs7YUFDSjs7O3NCQU9JLEtBQUs7cUJBTUwsTUFBTTsyQkFFTixZQUFZLFNBQUMsTUFBTSxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IHdhbGtlclxyXG4gKiBARGF0ZTogMjAxOC0wOS0wNiAxNTowNTo0MlxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogd2Fsa2VyXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTgtMDktMTIgMTE6MDM6MzVcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRpQXV0b2NvbXBsZXRlQ29tcG9uZW50IH0gZnJvbSAnLi4vYXV0b2NvbXBsZXRlL1RpQXV0b2NvbXBsZXRlTW9kdWxlJztcclxuaW1wb3J0IHsgVGlGb3JtQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9UaUJhc2VNb2R1bGUnO1xyXG5cclxuLyoqXHJcbiAqIOaQnOe0ouahhue7hOS7tlxyXG4gKlxyXG4gKiA8ZXhhbXBsZS11cmw+Li4vdGlueTNkZW1vLyMvc2VhcmNoYm94L3NlYXJjaGJveC1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RpLXNlYXJjaGJveCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2VhcmNoYm94Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vc2VhcmNoYm94Lmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRpU2VhcmNoYm94Q29tcG9uZW50KV0sXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJ1tjbGFzcy50aTMtc2VhcmNoYm94LWNvbnRhaW5lcl0nOiAndHJ1ZScsXHJcbiAgICAgICAgJyhibHVyKSc6ICdvbkJsdXIoKScsXHJcbiAgICAgICAgJyhmb2N1cyknOiAnb25Gb2N1cygpJ1xyXG4gICAgfVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGlTZWFyY2hib3hDb21wb25lbnQgZXh0ZW5kcyBUaUF1dG9jb21wbGV0ZUNvbXBvbmVudCB7XHJcbiAgICAvKipcclxuICAgICAqIDEwLjAuNOeJiOacrOaWsOWinlxyXG4gICAgICpcclxuICAgICAqIOaYr+WQpuWIoOmZpOeUqOaIt+aQnOe0ouWGheWuueeahOmmluWwvuepuuagvO+8jOS4jemFjee9ruaXtuS4jeWIoOmZpOepuuagvFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0cmltbWVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIHNlYXJjaOS6i+S7tu+8jOW9k+mAieS4reS4i+aLiemAiemhuS/mjIllbnRlcumUri/ngrnlh7vmkJzntKLlm77moIfml7bop6blj5FcclxuICAgICAqXHJcbiAgICAgKiDlj4LmlbDvvJrmkJzntKLmoYbmlofmnKxcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IHNlYXJjaDogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgICBAQ29udGVudENoaWxkKCdpdGVtJywge3N0YXRpYzogdHJ1ZX0pIGl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIGlucHV0IG5nTW9kZWznu5HlrprlgLxcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlucHV0VmFsdWU6IHN0cmluZztcclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyDpu5jorqTmnInmuIXpmaTlm77moIfkuJTkuI3lj6/phY3nva5cclxuICAgICAgICAvLyDmraTlpITlhYjotYvlgLzlkI7nu6fmib/vvIzmmK/nlLHkuo7niLbnsbvkuK3liJ3lp4vljJbpnIDopoHor7vlj5ZjbGVhcmFibGXnmoTlgLzvvIzorr7nva7muIXpmaTlm77moIdcclxuICAgICAgICB0aGlzLmNsZWFyYWJsZSA9IHRydWU7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOe7hOS7tm1vZGVs5pu05pS55pe277yM5pu05pawaW5wdXTnu5HlrprlgLxcclxuICAgICAqL1xyXG4gICAgd3JpdGVWYWx1ZShtb2RlbDogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIud3JpdGVWYWx1ZShtb2RlbCk7XHJcbiAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gbW9kZWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g57uE5Lu25Lqk5LqS5pa55rOV6ZuG5ZCILS1zdGFydFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogZW50ZXLnmoTop6blj5HmnInkuKTnp43mg4XlhrXvvJpcclxuICAgICAqIDEu5ZyoaW5wdXTmoYbkuK3ovpPlhaXlgLzvvIznhLblkI7mjInkuItlbnRlcu+8jOatpOaXtuato+W4uOaJp+ihjHNlYXJjaFxyXG4gICAgICogMi7lnKhzdWdnZXN0aW9u6Z2i5p2/5bGV5byA55qE5oOF5Ya15LiL77yM6YCa6L+HaG92ZXLpgInkuK3kuIDpobnvvIznhLblkI7mjInkuItlbnRlcu+8jFxyXG4gICAgICogICDmraTml7bnmoRzZWFyY2jlupTor6XlnKjkuIvmi4npnaLmnb/nmoRvbkRyb3BsaXN0Q2hhbmdl5Zue6LCD5Lit6Kem5Y+RXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbklucHV0RW50ZXIoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzU2VhcmNoV2l0aEhvdmVyT3B0aW9uKCkpIHsgLy8g5o6S6Zmk56ysMuS4reaDheWGtVxyXG4gICAgICAgICAgICB0aGlzLm9uU2VhcmNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmkJzntKLkuovku7bop6blj5FcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uU2VhcmNoKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2guZW1pdCh0aGlzLm1vZGVsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5Lik56eN5oOF5Ya15LiL6Kem5Y+RXHJcbiAgICAgKiAxLuWcqHN1Z2dlc3Rpb27pnaLmnb/lsZXlvIDnmoTmg4XlhrXkuIvvvIzpgJrov4dob3ZlcumAieS4reS4gOmhue+8jOeEtuWQjuaMieS4i2VudGVyXHJcbiAgICAgKiAyLuWcqHN1Z2dlc3Rpb27pnaLmnb/lsZXlvIDnmoTmg4XlhrXkuIvvvIzpgJrov4fpvKDmoIfngrnlh7vpgInkuK3kuIDpoblcclxuICAgICAqL1xyXG4gICAgb25Ecm9wbGlzdENoYW5nZSh2YWx1ZTogeyBsYWJlbDogc3RyaW5nIH0pOiB2b2lkIHtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMuaW5wdXRWYWx1ZSA9IHZhbHVlW3RoaXMubGFiZWxLZXldIHx8IHZhbHVlLmxhYmVsO1xyXG4gICAgICAgICAgICB0aGlzLm9uU2VhcmNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g57uE5Lu25Lqk5LqS5pa55rOV6ZuG5ZCILS1lbmRcclxuXHJcbiAgICBwcml2YXRlIGlzU2VhcmNoV2l0aEhvdmVyT3B0aW9uKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIC8vIHN1Z2dlc3Rpb27pnaLmnb/lsZXlvIDkuJTlrZjlnKhob3ZlcumAieS4remhueeahOaDheWGtVxyXG4gICAgICAgIHJldHVybiB0aGlzLmRyb3BMaXN0Q29tcC5pc1Nob3cgJiYgdGhpcy5kcm9wTGlzdENvbXAubGlzdENvbS5ob3Zlck9wdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOi+k+WFpeahhuS4reWGheWuueaUueWPmOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25JbnB1dENoYW5nZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQgfHwgIXRoaXMuaXNGb2N1c2VkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNlYXJjaFZhbHVlOiBzdHJpbmcgPSB0aGlzLnRyaW1WYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5tb2RlbCA9IHNlYXJjaFZhbHVlO1xyXG4gICAgICAgIHRoaXMuaW5wdXRDaGFuZ2VPYnNlcnZlLm5leHQoc2VhcmNoVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5o6n5Yi25piv5ZCm5Yig6Zmk5pCc57Si5YaF5a6555qE6aaW5bC+56m65qC8XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgdHJpbVZhbHVlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBzZWFyY2hWYWx1ZTogc3RyaW5nID0gdmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMudHJpbW1lZCAmJiBzZWFyY2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBzZWFyY2hWYWx1ZSA9IHNlYXJjaFZhbHVlLnRyaW0oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZWFyY2hWYWx1ZTtcclxuICAgIH1cclxufVxyXG4iXX0=