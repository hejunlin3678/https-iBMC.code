import { Component, ContentChild, ElementRef, EventEmitter, Input, NgZone, Output, Renderer2, TemplateRef } from '@angular/core';
import { TiFormComponent } from '../base/TiBaseModule';
import { Util } from '../../utils/Util';
/**
 * @ignore
 */
export class TiDominatorComponent extends TiFormComponent {
    constructor(render, hostRef, zone) {
        super(hostRef, render);
        this.zone = zone;
        this.buttonStyle = 'dropdown'; // 按钮样式 三角or加号 'dropdown' 'plus'
        this.multiple = false; // 单选多选
        this.selectedTipPosition = 'auto'; // 选中项文本超出时tip展开方向
        this.dropshow = false; // 在select组件中使用，记录下拉面板展开状态
        /**
         * 设置dominator最多显示几行，默认2行, multiple为true时生效
         */
        this.maxLine = 2;
        /**
         * 设置是否显示已选项的个数，默认不显示，multiple为true时生效
         *
         * 10.1.0新增
         */
        this.showSelectedNumber = false;
        /**
         * 单选下拉选择框是否开启清除已选项功能
         *
         * 3.0.8新增
         */
        this.clearable = false;
        this.delete = new EventEmitter();
        /**
         * 当单选下拉选择框开启清除已选项功能时，点击清除按钮时触发
         *
         * 3.0.8新增
         */
        this.clear = new EventEmitter();
        this.isMouseIn = false;
    }
    ngOnInit() {
        super.ngOnInit();
        // 每行tag的高度24px, +2 是因为 .ti3-select-dominator-text 元素上下padding
        // tslint:disable-next-line: binary-expression-operand-order
        this.maxHeight = !this.multiple ? '' : this.maxHeight ? this.maxHeight : (this.maxLine * 24 + 2) + 'px';
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.setFocusableElems([this.nativeElement]);
        this.zone.runOutsideAngular(() => {
            // 内部mousedown事件冒泡至根节点
            this.renderer.listen(this.nativeElement, 'mousedown', (event) => {
                if (this.disabled) {
                    event.preventDefault(); // 不能聚焦，不能click
                }
            });
            if (this.clearable && !this.multiple) {
                this.renderer.listen(this.nativeElement, 'mouseenter', () => {
                    if (this.disabled || Util.isEmptyString(this.model)) {
                        return;
                    }
                    this.zone.run(() => {
                        this.isMouseIn = true;
                    });
                });
                this.renderer.listen(this.nativeElement, 'mouseleave', () => {
                    if (this.isMouseIn) {
                        this.zone.run(() => {
                            this.isMouseIn = false;
                        });
                    }
                });
            }
        });
    }
    /**
     * 兼容旧版：
     * 3.1.2版select只能内嵌一个模板，无命名。
     * 新版可以内嵌2个模板，示例书写要求都命名。
     * 但需要兼容旧版无命名测试用例。
     */
    ngAfterContentInit() {
        super.ngAfterContentInit();
        // 如果item模板为空，那么把第一个出现的无标签（无footer等标签）模板作为item
        if (!this.itemTemplate && this.firstTemplate !== this.placeholderTemplate) {
            this.itemTemplate = this.firstTemplate;
        }
    }
    /**
     * 用户点击叉号，删除一个项目
     * @param item
     * @returns
     */
    onDelete(item) {
        if (item.disabled === true) {
            return;
        }
        // 删除选中
        const index = this.model.indexOf(item);
        if (index !== -1) {
            this.model.splice(index, 1);
        }
        this.delete.emit({
            item: item,
            model: this.model
        });
        // 强行向外通知model改变。
        this.model = this.model.concat();
    }
    /**
     * @ignore
     */
    onClickClear(event) {
        event.stopPropagation();
        this.model = null;
        this.clear.emit();
    }
    showClear() {
        return this.clearable && !this.multiple && !this.disabled && (this.isMouseIn || this.focused) && this.model;
    }
}
TiDominatorComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-dominator',
                template: "<!--\u6A21\u677F\u4F18\u5148\uFF0Clabel\u5176\u6B21-->\r\n<section class=\"ti3-select-dominator-text\"\r\n    [ngStyle]=\"{'max-height': maxHeight}\"\r\n    [ngClass]=\"{\r\n        'ti3-multiselect-container': multiple,\r\n        'ti3-tags-input-container': type === 'tagsinput'\r\n        }\"\r\n    [id]=\"appendId('input')\">\r\n    <!-- \u5355\u9009 -->\r\n    <ng-container *ngIf=\"!multiple else multipleTemplate\">\r\n        <section class=\"ti3-overflow-padding\"\r\n            [tiTip]=\" model?model.tip : ''\"\r\n            [tiTipContext]=\"model\"\r\n            [tiTipPosition]='selectedTipPosition'\r\n            [tiTipHostEleX]=\"nativeElement\"\r\n            ><ng-container  *ngIf=\"model else placeholderTemplate?placeholderTemplate:defaultPlaceholderTemplate\">\r\n                <ng-container *ngIf=\"itemTemplate else defaultItemTemplate\">\r\n                  <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: model}\">\r\n                  </ng-container>\r\n                </ng-container>\r\n                <ng-template #defaultItemTemplate><span [title]=\"model[labelKey]\">{{model[labelKey]}}</span></ng-template>\r\n            </ng-container>\r\n            <ng-template #defaultPlaceholderTemplate><span class=\"ti3-placeholder\" [title]=\"placeholder\">{{placeholder}}</span></ng-template>\r\n        </section>\r\n    </ng-container>\r\n    <!-- \u591A\u9009 -->\r\n    <ng-template #multipleTemplate>\r\n        <ng-container *ngIf=\"model && model.length else placeholderTemplate?placeholderTemplate:defaultPlaceholderMultiTemplate\">\r\n            <ti-tag *ngFor=\"let item of model; let i = index\" [maxWidth]=\"tagMaxWidth\" [id]=\"appendId('tag'+i)\"\r\n                [disabled]=\"disabled||item.disabled\"\r\n                [tiTip]=\"item.tip\"\r\n                [tiTipPosition]='selectedTipPosition'\r\n                [tiTipContext]=\"item\"\r\n                (delete)=\"onDelete(item)\"\r\n                ><ng-container *ngIf=\"itemTemplate else defaultItemTemplate\">\r\n                    <ng-container *ngTemplateOutlet=\"itemTemplate; context: {$implicit: item, index: i}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n                <ng-template #defaultItemTemplate><span [title]=\"item[labelKey]\">{{item[labelKey]}}</span></ng-template>\r\n            </ti-tag>\r\n        </ng-container>\r\n\r\n        <!-- tagsinput\u7EC4\u4EF6\u4E2Ddominator\u7684\u6700\u540E\u4E00\u4E2A\u5143\u7D20\u4E3Ainput\u8F93\u5165\u6846 -->\r\n        <ng-container *ngIf=\"type === 'tagsinput'\">\r\n            <ng-content select=\"input\"></ng-content>\r\n        </ng-container>\r\n        <!-- tag\u8F93\u5165\u533A\u57DF\uFF0C\u7EFC\u5408\u641C\u7D22\u4F7F\u7528-->\r\n        <ng-container>\r\n            <ng-content select=\"[tag-editor]\"></ng-content>\r\n        </ng-container>\r\n        <ng-template #defaultPlaceholderMultiTemplate>\r\n            <section *ngIf=\"type !== 'tagsinput'\" class=\"ti3-overflow-padding ti3-placeholder\" [title]=\"placeholder\">{{placeholder}}</section>\r\n        </ng-template>\r\n    </ng-template>\r\n</section>\r\n\r\n<!-- tagsinput\u7EC4\u4EF6\u6CA1\u6709\u4E0B\u62C9\u6309\u94AE -->\r\n<section *ngIf=\"type !== 'tagsinput' && !showClear()\"\r\n         [ngClass]=\"{'ti3-select-dominator-dropdown-btn':(buttonStyle==='dropdown'),\r\n                     'ti3-icon ti3-icon-add ti3-select-dominator-plus-btn':(buttonStyle==='plus'),\r\n                    'ti3-select-dominator-dropdown-btn-transform-up': dropshow}\"\r\n         [id]=\"appendId('btn')\">\r\n</section>\r\n\r\n<!-- \u591A\u9009\u65F6\uFF1A\u663E\u793A\u5F53\u524D\u9009\u4E2D\u4E86\u51E0\u9879 -->\r\n<section *ngIf=\"showSelectedNumber && multiple && model && model.length > 0\" class=\"ti3-multiselect-selected\">{{ 'tiSelect.selected' | tiTranslate }}<span\r\n    style=\"padding-left: 4px\">{{model.length}}</span>\r\n</section>\r\n\r\n<!-- \u5355\u9009\u6709\u53EF\u6E05\u9664\u7684\u573A\u666F -->\r\n<section *ngIf=\"showClear()\"\r\n         class=\"ti3-icon ti3-icon-close ti3-select-dominator-clear-btn\"\r\n        [id]=\"appendId('clear')\"\r\n        (click)=\"onClickClear($event)\">\r\n</section>\r\n<!-- dominator\u53F3\u4FA7\u56FE\u6807\u6309\u94AE\u7EC4, \u7EFC\u5408\u641C\u7D22\u7EC4\u4EF6\u4F7F\u7528 -->\r\n<ng-content select=\"[actions]\"></ng-content>\r\n<!--IE\u6D4F\u89C8\u5668\u517C\u5BB9\u6027\u95EE\u9898\uFF1A\u5728IE\u4E0B\uFF0C\u6240\u6709div\uFF0C\u90E8\u5206span\uFF08\u8BBE\u7F6E\u4E3Ainline-block\u3001block\u7684span\uFF09\u662F\u4EA4\u4E92\u5143\u7D20\uFF0C\u53EF\u4EE5\u843D\u7126\u70B9\u3002\r\n\u800C\u5176\u4ED6\u6D4F\u89C8\u5668\uFF0Cdiv\u548Cspan\u9ED8\u8BA4\u662F\u4E0D\u53EF\u4EA4\u4E92\u5143\u7D20\uFF0C\u4E0D\u80FD\u843D\u7126\u70B9\u3002\r\n\u89E3\u51B3\u65B9\u6848\uFF1Asection\u6807\u7B7E\uFF0C\u53EF\u4EE5\u7B49\u540C\u4E8Ediv\u4F7F\u7528\uFF0CIE\u548C\u5176\u4ED6\u6D4F\u89C8\u5668\u884C\u4E3A\u4E00\u81F4\u3002\r\n-->",
                host: {
                    '[class.ti3-select-dominator-container]': 'true',
                    '[class.ti3-multiselect-container]': 'multiple'
                },
                providers: [TiFormComponent.getValueAccessor(TiDominatorComponent)],
                styles: ["::ng-deep :root{--ti-dominator-button-type-dropdown-width:35px;--ti-dominator-select-box-width:calc(var(--ti-input-height) - 2px)}:host{display:inline-block}:host.ti3-select-dominator-container{-ms-box-sizing:border-box;border:1px solid transparent;box-sizing:border-box;cursor:pointer;display:inline-block;height:var(--ti-input-height);line-height:calc(var(--ti-input-height) - 2px);margin:-1px;position:relative;text-align:left;vertical-align:middle;white-space:normal;width:calc(100% + 2px)}:host.ti3-select-dominator-container:focus{outline:none}:host[disabled].ti3-select-dominator-container{cursor:not-allowed!important}:host[disabled] .ti3-select-dominator-dropdown-btn:after{border-top-color:var(--ti-dominator-select-arrow-color-disabled)!important}:host[disabled] .ti3-select-dominator-text{color:var(--ti-common-color-text-disabled)}:host[disabled] .ti3-multiselect-box-cell{border:1px solid var(--ti-dominator-multiselect-box-cell-border-color-disabled)}.ti3-overflow-padding{height:100%;overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.ti3-select-dominator-text{-ms-box-sizing:border-box;border:none;border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);display:inline-block;height:100%;text-decoration:none;width:calc(100% - var(--ti-dominator-select-box-width))}.ti3-placeholder{color:var(--ti-input-placeholder-color)}.ti3-select-dominator-clear-btn,.ti3-select-dominator-dropdown-btn{-ms-box-sizing:border-box;border-radius:0 var(--ti-input-border-radius) var(--ti-input-border-radius) 0;box-sizing:border-box;float:right;height:calc(var(--ti-input-height) - 2px);width:var(--ti-dominator-select-box-width)}.ti3-select-dominator-dropdown-btn:after{border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--ti-dominator-select-arrow-color);content:\"\";height:0;position:absolute;right:calc(var(--ti-dominator-select-box-width)/2 - 4px);top:calc((var(--ti-input-height) - 7px)/2);width:0}.ti3-select-dominator-dropdown-btn-transform-up:after{transform:rotate(180deg)}.ti3-select-dominator-clear-btn{color:var(--ti-dominator-select-clear-color);font-size:12px;text-align:center}.ti3-select-dominator-clear-btn:hover{color:var(--ti-common-color-icon-hover)}:host.ti3-multiselect-container{height:auto;line-height:1;min-height:var(--ti-input-height);overflow:hidden}:host.ti3-multiselect-container>.ti3-select-dominator-text{line-height:calc(var(--ti-input-height) - 4px);max-height:calc(2*var(--ti-input-height) - 4px);overflow-y:auto;padding:1px;vertical-align:middle}:host.ti3-multiselect-container>.ti3-select-dominator-text::-webkit-scrollbar-track{margin:0}:host.ti3-multiselect-container>.ti3-select-dominator-text:after{content:\"\";display:block;overflow:hidden}:host.ti3-multiselect-container>.ti3-select-dominator-text.ti3-tags-input-container{width:100%}:host.ti3-multiselect-container .ti3-multiselect-selected{display:inline-block;padding:var(--ti-common-space-base) var(--ti-common-space-3x)}"]
            },] }
];
TiDominatorComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: NgZone }
];
TiDominatorComponent.propDecorators = {
    labelKey: [{ type: Input }],
    placeholder: [{ type: Input }],
    buttonStyle: [{ type: Input }],
    multiple: [{ type: Input }],
    selectedTipPosition: [{ type: Input }],
    dropshow: [{ type: Input }],
    tagMaxWidth: [{ type: Input }],
    maxLine: [{ type: Input }],
    showSelectedNumber: [{ type: Input }],
    maxHeight: [{ type: Input }],
    type: [{ type: Input }],
    clearable: [{ type: Input }],
    delete: [{ type: Output }],
    clear: [{ type: Output }],
    firstTemplate: [{ type: ContentChild, args: [TemplateRef, /* TODO: add static flag */ { static: true },] }],
    itemTemplate: [{ type: ContentChild, args: ['item', /* TODO: add static flag */ { static: true },] }],
    placeholderTemplate: [{ type: ContentChild, args: ['placeholder',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlEb21pbmF0b3JDb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9AY2xvdWQvdGlueTMvY29tcG9uZW50cy9kb21pbmF0b3IvVGlEb21pbmF0b3JDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQ3hGLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBR3hDOztHQUVHO0FBV0gsTUFBTSxPQUFPLG9CQUFxQixTQUFRLGVBQWU7SUErQ3JELFlBQVksTUFBaUIsRUFBRSxPQUFtQixFQUFVLElBQVk7UUFDcEUsS0FBSyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQURpQyxTQUFJLEdBQUosSUFBSSxDQUFRO1FBM0MvRCxnQkFBVyxHQUF1QixVQUFVLENBQUMsQ0FBQyxnQ0FBZ0M7UUFDOUUsYUFBUSxHQUFZLEtBQUssQ0FBQyxDQUFDLE9BQU87UUFDbEMsd0JBQW1CLEdBQW1CLE1BQU0sQ0FBQyxDQUFDLGtCQUFrQjtRQUNoRSxhQUFRLEdBQVksS0FBSyxDQUFDLENBQUMsMEJBQTBCO1FBTTlEOztXQUVHO1FBQ00sWUFBTyxHQUFXLENBQUMsQ0FBRTtRQUM5Qjs7OztXQUlHO1FBQ00sdUJBQWtCLEdBQVksS0FBSyxDQUFFO1FBTTlDOzs7O1dBSUc7UUFDTSxjQUFTLEdBQVksS0FBSyxDQUFDO1FBQ2pCLFdBQU0sR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2RTs7OztXQUlHO1FBQ2dCLFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQU05RCxj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TUFBTSxFQUFFLElBQUksRUFBRTsyQkFDdEUsWUFBWSxTQUFDLE1BQU0sRUFBRSwyQkFBMkIsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7a0NBQ2pFLFlBQVksU0FBQyxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE5nWm9uZSwgT3V0cHV0LCBSZW5kZXJlcjIsXHJcbiAgICBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaUZvcm1Db21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi91dGlscy9VdGlsJztcclxuaW1wb3J0IHsgVGlQb3NpdGlvblR5cGUgfSBmcm9tICcuLi8uLi91dGlscy9Qb3NpdGlvbic7XHJcblxyXG4vKipcclxuICogQGlnbm9yZVxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RpLWRvbWluYXRvcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZG9taW5hdG9yLmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vZG9taW5hdG9yLmxlc3MnXSxcclxuICAgIGhvc3Q6IHtcclxuICAgICAgICAnW2NsYXNzLnRpMy1zZWxlY3QtZG9taW5hdG9yLWNvbnRhaW5lcl0nOiAndHJ1ZScsXHJcbiAgICAgICAgJ1tjbGFzcy50aTMtbXVsdGlzZWxlY3QtY29udGFpbmVyXSc6ICdtdWx0aXBsZSdcclxuICAgIH0sXHJcbiAgICBwcm92aWRlcnM6IFtUaUZvcm1Db21wb25lbnQuZ2V0VmFsdWVBY2Nlc3NvcihUaURvbWluYXRvckNvbXBvbmVudCldXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaURvbWluYXRvckNvbXBvbmVudCBleHRlbmRzIFRpRm9ybUNvbXBvbmVudCB7XHJcblxyXG4gICAgQElucHV0KCkgbGFiZWxLZXk6IHN0cmluZzsgLy8g5ZGI546w55qE5YaF5a6577yI5peg5Yig6Zmk5oyJ6ZKu77yJIFRPRE86IOWQq+WIoOmZpOaMiemSrueahOWcuuaZr++8jOaJqeWxleS4ukFycmF5XHJcbiAgICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nOyAvLyDnu4Tku7bnmoTpooTnlZnmlofmnKxcclxuICAgIEBJbnB1dCgpIGJ1dHRvblN0eWxlOiAnZHJvcGRvd24nIHwncGx1cycgPSAnZHJvcGRvd24nOyAvLyDmjInpkq7moLflvI8g5LiJ6KeSb3LliqDlj7cgJ2Ryb3Bkb3duJyAncGx1cydcclxuICAgIEBJbnB1dCgpIG11bHRpcGxlOiBib29sZWFuID0gZmFsc2U7IC8vIOWNlemAieWkmumAiVxyXG4gICAgQElucHV0KCkgc2VsZWN0ZWRUaXBQb3NpdGlvbjogVGlQb3NpdGlvblR5cGUgPSAnYXV0byc7IC8vIOmAieS4remhueaWh+acrOi2heWHuuaXtnRpcOWxleW8gOaWueWQkVxyXG4gICAgQElucHV0KCkgZHJvcHNob3c6IGJvb2xlYW4gPSBmYWxzZTsgLy8g5Zyoc2VsZWN057uE5Lu25Lit5L2/55So77yM6K6w5b2V5LiL5ouJ6Z2i5p2/5bGV5byA54q25oCBXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIHRhZ+eahOacgOWkp+Wuve+8jFRwU2VhcmNoYm945L2/55SoXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHRhZ01heFdpZHRoOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rmRvbWluYXRvcuacgOWkmuaYvuekuuWHoOihjO+8jOm7mOiupDLooYwsIG11bHRpcGxl5Li6dHJ1ZeaXtueUn+aViFxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBtYXhMaW5lOiBudW1iZXIgPSAyIDtcclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5piv5ZCm5pi+56S65bey6YCJ6aG555qE5Liq5pWw77yM6buY6K6k5LiN5pi+56S677yMbXVsdGlwbGXkuLp0cnVl5pe255Sf5pWIXHJcbiAgICAgKlxyXG4gICAgICogMTAuMS4w5paw5aKeXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHNob3dTZWxlY3RlZE51bWJlcjogYm9vbGVhbiA9IGZhbHNlIDtcclxuICAgIC8qKlxyXG4gICAgICog6K6+572uZG9taW5hdG9yIOWGheWuueeahOacgOWkp+mrmOW6pu+8jOm7mOiupOaYr+S4pOihjOeahOmrmOW6pu+8jG11bHRpcGxl5Li6dHJ1ZeaXtueUn+aViO+8jOatpOWPguaVsOiuvue9ruWQjm1heExpbmXmjqXlj6PlpLHmlYhcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbWF4SGVpZ2h0OiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSB0eXBlOiAndGFnc2lucHV0JyB8IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5Y2V6YCJ5LiL5ouJ6YCJ5oup5qGG5piv5ZCm5byA5ZCv5riF6Zmk5bey6YCJ6aG55Yqf6IO9XHJcbiAgICAgKlxyXG4gICAgICogMy4wLjjmlrDlop5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY2xlYXJhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgZGVsZXRlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPljZXpgInkuIvmi4npgInmi6nmoYblvIDlkK/muIXpmaTlt7LpgInpobnlip/og73ml7bvvIzngrnlh7vmuIXpmaTmjInpkq7ml7bop6blj5FcclxuICAgICAqXHJcbiAgICAgKiAzLjAuOOaWsOWinlxyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KCkgcmVhZG9ubHkgY2xlYXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZChUZW1wbGF0ZVJlZiwgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIGZpcnN0VGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBAQ29udGVudENoaWxkKCdpdGVtJywgLyogVE9ETzogYWRkIHN0YXRpYyBmbGFnICovIHsgc3RhdGljOiB0cnVlIH0pIGl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBDb250ZW50Q2hpbGQoJ3BsYWNlaG9sZGVyJykgcGxhY2Vob2xkZXJUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgICBwcml2YXRlIGlzTW91c2VJbjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgY29uc3RydWN0b3IocmVuZGVyOiBSZW5kZXJlcjIsIGhvc3RSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgem9uZTogTmdab25lKSB7XHJcbiAgICAgICAgc3VwZXIoaG9zdFJlZiwgcmVuZGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIC8vIOavj+ihjHRhZ+eahOmrmOW6pjI0cHgsICsyIOaYr+WboOS4uiAudGkzLXNlbGVjdC1kb21pbmF0b3ItdGV4dCDlhYPntKDkuIrkuItwYWRkaW5nXHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBiaW5hcnktZXhwcmVzc2lvbi1vcGVyYW5kLW9yZGVyXHJcbiAgICAgICAgdGhpcy5tYXhIZWlnaHQgPSAhdGhpcy5tdWx0aXBsZSA/ICcnIDogdGhpcy5tYXhIZWlnaHQgPyB0aGlzLm1heEhlaWdodCA6ICh0aGlzLm1heExpbmUgKiAyNCArIDIpICsgJ3B4JztcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRGb2N1c2FibGVFbGVtcyhbdGhpcy5uYXRpdmVFbGVtZW50XSk7XHJcbiAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgLy8g5YaF6YOobW91c2Vkb3du5LqL5Lu25YaS5rOh6Iez5qC56IqC54K5XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicsIChldmVudDogTW91c2VFdmVudCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyDkuI3og73ogZrnhKbvvIzkuI3og71jbGlja1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2xlYXJhYmxlICYmICF0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkIHx8IFV0aWwuaXNFbXB0eVN0cmluZyh0aGlzLm1vZGVsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTW91c2VJbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNNb3VzZUluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc01vdXNlSW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5YW85a655pen54mI77yaXHJcbiAgICAgKiAzLjEuMueJiHNlbGVjdOWPquiDveWGheW1jOS4gOS4quaooeadv++8jOaXoOWRveWQjeOAglxyXG4gICAgICog5paw54mI5Y+v5Lul5YaF5bWMMuS4quaooeadv++8jOekuuS+i+S5puWGmeimgeaxgumDveWRveWQjeOAglxyXG4gICAgICog5L2G6ZyA6KaB5YW85a655pen54mI5peg5ZG95ZCN5rWL6K+V55So5L6L44CCXHJcbiAgICAgKi9cclxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ0FmdGVyQ29udGVudEluaXQoKTtcclxuICAgICAgICAvLyDlpoLmnpxpdGVt5qih5p2/5Li656m677yM6YKj5LmI5oqK56ys5LiA5Liq5Ye6546w55qE5peg5qCH562+77yI5pegZm9vdGVy562J5qCH562+77yJ5qih5p2/5L2c5Li6aXRlbVxyXG4gICAgICAgIGlmICghdGhpcy5pdGVtVGVtcGxhdGUgJiYgdGhpcy5maXJzdFRlbXBsYXRlICE9PSB0aGlzLnBsYWNlaG9sZGVyVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtVGVtcGxhdGUgPSB0aGlzLmZpcnN0VGVtcGxhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDnlKjmiLfngrnlh7vlj4nlj7fvvIzliKDpmaTkuIDkuKrpobnnm65cclxuICAgICAqIEBwYXJhbSBpdGVtXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25EZWxldGUoaXRlbTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGl0ZW0uZGlzYWJsZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDliKDpmaTpgInkuK1cclxuICAgICAgICBjb25zdCBpbmRleDogbnVtYmVyID0gdGhpcy5tb2RlbC5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRlbGV0ZS5lbWl0KHtcclxuICAgICAgICAgICAgaXRlbTogaXRlbSxcclxuICAgICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyDlvLrooYzlkJHlpJbpgJrnn6Vtb2RlbOaUueWPmOOAglxyXG4gICAgICAgIHRoaXMubW9kZWwgPSB0aGlzLm1vZGVsLmNvbmNhdCgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbkNsaWNrQ2xlYXIoZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLm1vZGVsID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNsZWFyLmVtaXQoKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzaG93Q2xlYXIoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xlYXJhYmxlICYmICF0aGlzLm11bHRpcGxlICYmICF0aGlzLmRpc2FibGVkICYmICh0aGlzLmlzTW91c2VJbiB8fCB0aGlzLmZvY3VzZWQpICYmIHRoaXMubW9kZWw7XHJcbiAgICB9XHJcbn1cclxuIl19