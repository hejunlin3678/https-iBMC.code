import { Component, ElementRef, Input, NgZone, Optional, Renderer2, ViewChild, ViewEncapsulation, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { TiBrowser, Util } from '../../utils/Util';
import { TiAutofocusComponent } from '../base/TiBaseModule';
import { NgControl } from '@angular/forms';
/**
 * Textarea文本框组件
 *
 * 文本框组件基于原生textarea标签进行扩展，原生textarea加tiTextarea属性指令即为textarea组件。
 *
 * <example-url>../tiny3demo/#/textarea/textarea-all</example-url>
 */
export class TiTextareaComponent extends TiAutofocusComponent {
    constructor(elementRef, renderer, zone, formControl, document) {
        super(elementRef, renderer);
        this.zone = zone;
        this.formControl = formControl;
        this.document = document;
        /**
         * 用来调整文本框大小，该属性提供了四个属性值:
         *
         * none(不可调整组件大小):
         *
         * vertical(仅可调整垂直方向的大小，即调整组件的高度)
         *
         * horizontal(仅可调节水平方向的大小，即调整组件的宽度)
         *
         * both(水平和垂直方向均可调节，宽高都可调节)
         */
        this.resize = 'both';
        // 用作拖动文本框大小
        this.options = {
            $target: undefined,
            storeWidth: 0,
            storeHeight: 0,
            mouseXPosition: 0,
            mouseYPosition: 0
        };
        // 默认最大最小宽高
        this.defaultStyle = {
            minWidth: 60,
            minHeight: 64,
            maxWidth: 1280,
            maxHeight: 9999
        };
        this.isFirstFocus = true; // 是否为第一次聚焦
        /**
         * @ignore
         * 绑定在document上的mouseMove事件
         */
        this.mouseMoveHandlerFn = ($event) => {
            if (this.element.disabled) {
                return;
            }
            // 拖动的动作应该是先mousedown，然后mousemove，因此先判断是否已经触发了mousedown
            if (this.options.mouseXPosition === 0 && this.options.mouseYPosition === 0 || !this.options.$target) {
                return;
            }
            this.mouseMove($event);
        };
        /**
         * @ignore
         * 绑定在document上的mouseUp事件
         */
        this.mouseUpHandlerFn = () => {
            if (this.element.disabled) {
                return;
            }
            // 解决问题：当拖动鼠标时，鼠标不在小三角上时，鼠标放开不会移除样式
            // 为确保鼠标弹起时, textarea的边框样式恢复默认:
            if (this.isResizing()) {
                this.renderer.removeClass(this.element, 'ti3-textarea-resize-border');
            }
            try {
                this.stopResize();
                this.toggleTextSelection(false);
            }
            catch (e) { }
        };
        this.element = elementRef.nativeElement; // 获取宿主元素
        this.attrs = this.element.attributes; // 可以根据属性名获取各个属性
        this.container = this.renderer.createElement('div'); // 创建div标签
        this.renderer.addClass(this.container, 'ti3-textarea-container');
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始化maxlength属性
        this.hasMaxlength = Util.isUndefined(this.attrs['maxlength']) ? false : true;
        // 原生不设置maxlength属性时该值为-1;
        this.maxLength = this.hasMaxlength ? this.element.maxLength : -1;
        // 文本框的值发生变化时触发
        // 使用ngModel初始赋值时，触发valueChanges。
        // 使用formControl初始赋值时，不会触发valueChanges。
        if (this.formControl) {
            this.formControl.valueChanges.subscribe((value) => {
                this.setCountLength();
            });
        }
        // 使用formControl初始赋值时，初始化不会触发valueChanges，所以此处额外执行一次。
        // 使用ngModel初始赋值时，此处通过this.element.value拿到的值为空字符串，无法正确显示当前输入内容的长度
        this.setCountLength();
    }
    ngAfterViewInit() {
        // 如果祖先元素中display为none，获取到的组件的宽度为0,元素不可见
        this.isVisibleInit = this.element.offsetWidth !== 0;
        if (this.isVisibleInit) {
            // 设置container的样式
            this.setContainerSize();
            // 初始化创建dom
            this.initFn();
        }
        // 将宿主元素的样式类移到container上
        this.setContainerClass();
        // maxLength接口添加样式
        this.setMaxLengthFn();
        // 处理resize功能
        this.resizeFn();
        // 上面执行完初始化dom后，调用父类的ngAfterViewInit去设置autofocus
        super.ngAfterViewInit();
    }
    ngAfterViewChecked() {
        // 初始祖先元素中display为none，之后第一次由none变成可见时，需要重置silder
        if (!this.isVisibleInit && this.element.offsetWidth !== 0) {
            this.setContainerSize();
            // 初始化创建dom
            this.initFn();
            this.isVisibleInit = true;
        }
        // 处理灰化功能
        if (this.element.disabled) {
            this.renderer.addClass(this.container, 'ti3-textarea-container-disable');
        }
        else {
            this.renderer.removeClass(this.container, 'ti3-textarea-container-disable');
        }
        // 修复SSR报错：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return;
        }
        // 处理通过设置display的方式隐藏组件：内部生成的dom也需要隐藏
        if (getComputedStyle(this.element).display === 'none') {
            this.renderer.setStyle(this.container, 'display', 'none');
        }
        else {
            this.renderer.setStyle(this.container, 'display', 'block');
        }
    }
    // maxlength通过接口传值需触发重新判断，因为init函数中执行较早且只执行一次。
    ngDoCheck() {
        this.hasMaxlength = Util.isUndefined(this.attrs['maxlength']) ? false : true;
        this.maxLength = this.hasMaxlength ? this.element.maxLength : -1;
    }
    // 销毁组件时需要将内部生成dom也移除
    ngOnDestroy() {
        this.renderer.removeChild(this.renderer.parentNode(this.container), this.container);
        if (this.documentMouseMoveListener) {
            this.documentMouseMoveListener();
        }
        if (this.documentMouseUpListener) {
            this.documentMouseUpListener();
        }
    }
    /**
     * @ignore
     */
    onFocus() {
        // IE和火狐浏览器在首次autofoucus聚焦时会将光标移到文字起始位置，用户体验不好
        // 需要手动设置光标位置到行尾
        if (this.isFirstFocus && this.element.autofocus &&
            (TiBrowser.isFirefox() || TiBrowser.isIE())) {
            this.element.setSelectionRange(this.element.value.length, this.element.value.length);
        }
        this.isFirstFocus = false;
    }
    setContainerSize() {
        // 修正SSR错误：ERROR ReferenceError: getComputedStyle is not defined
        if (typeof getComputedStyle === 'undefined') {
            return;
        }
        const containerHeight = getComputedStyle(this.element).height;
        const containerWidth = getComputedStyle(this.element).width;
        // 若服务在textarea上面设置margin外边距,会导致textarea所占的页面空间大于外框的宽高,所以要将textarea上设置的margin转移到外边框
        const containerMargin = this.element.style.margin;
        // 取掉宿主元素的margin属性:
        this.element.style.margin = '';
        // 设置this.container的width、height、margin
        this.renderer.setStyle(this.container, 'height', containerHeight);
        this.renderer.setStyle(this.container, 'width', containerWidth);
        this.renderer.setStyle(this.container, 'margin', containerMargin);
    }
    setContainerClass() {
        // 获取未经过angular解析后的属性需要在onint中处理：若服务在textarea添加class，则把其加到父容器上
        const cNames = this.element.className;
        if (cNames) {
            const cNameArr = this.element.className.split(' '); // 存在多个class
            for (const cName of cNameArr) {
                // 跟校验有关的样式是以"ng-"开头，如果转移到外部容器上会影响校验样式
                if (!/^ng-/.test(cName)) {
                    this.renderer.removeClass(this.element, cName);
                    this.renderer.addClass(this.container, cName);
                }
            }
        }
    }
    // 初始化创建dom
    initFn() {
        const pNode = this.renderer.parentNode(this.element); // 找到宿主元素父元素
        const nextNode = this.renderer.nextSibling(this.element); // 找到宿主元素的兄弟元素
        // 将宿主元素包裹在this.container里边：
        this.renderer.removeChild(pNode, this.element); // 从父元素中移除宿主元素
        this.renderer.appendChild(this.container, this.element); // 将宿主元素放入创建的div标签中
        this.renderer.insertBefore(pNode, this.container, nextNode);
        if (this.resize !== 'none') {
            this.moveNode(this.resizeIconRef.nativeElement);
        }
        if (this.hasMaxlength) {
            this.moveNode(this.eleCharacterRef.nativeElement);
        }
    }
    moveNode(node) {
        this.renderer.removeChild(this.element, node);
        this.renderer.appendChild(this.container, node);
    }
    // maxLength接口
    setMaxLengthFn() {
        // 添加字数限制与当前输入字数显示功能
        if (this.attrs['maxlength'] && !isNaN(this.maxLength)) {
            // 有maxlength限制时给外框div加上标志类 ti3-textarea-container-counter
            this.renderer.addClass(this.container, 'ti3-textarea-container-counter');
        }
        else {
            this.renderer.removeClass(this.container, 'ti3-textarea-container-counter');
        }
    }
    // resize接口
    resizeFn() {
        if (this.resize === 'none') {
            return;
        }
        this.textAreaMinWidth = this.getSizeNumber('minWidth');
        this.textAreaMinHeight = this.getSizeNumber('minHeight');
        this.textAreaMaxWidth = this.getSizeNumber('maxWidth');
        this.textAreaMaxHeight = this.getSizeNumber('maxHeight');
        // 清除textarea上的样式
        this.renderer.setStyle(this.element, 'minWidth', '');
        this.renderer.setStyle(this.element, 'minHeight', '');
        this.renderer.setStyle(this.element, 'maxWidth', '');
        this.renderer.setStyle(this.element, 'maxHeight', '');
        this.zone.runOutsideAngular(() => {
            // resizeIconRef模板的mousedown事件
            this.renderer.listen(this.resizeIconRef.nativeElement, 'mousedown', ($event) => {
                this.renderer.addClass(this.element, 'ti3-textarea-resize-border'); // 拖拽时边框颜色为聚焦时
                this.options.$target = $event.target;
                this.options.mouseXPosition = $event.pageX;
                this.options.mouseYPosition = $event.pageY;
                // 在拖动前获取当前文本框最新的高度、宽度
                this.updateTextAreaSize();
                // 给页面设置不可选样式，避免拖动时页面出现被选中的蓝色区域
                this.toggleTextSelection(true);
            });
            // resizeIconRef模板的mouseup事件
            this.renderer.listen(this.resizeIconRef.nativeElement, 'mouseup', ($event) => {
                this.renderer.removeClass(this.element, 'ti3-textarea-resize-border');
            });
            this.documentMouseMoveListener = this.renderer.listen(this.document, 'mousemove', this.mouseMoveHandlerFn);
            this.documentMouseUpListener = this.renderer.listen(this.document, 'mouseup', this.mouseUpHandlerFn);
        });
    }
    setCountLength() {
        if (this.hasMaxlength) {
            this.countLength = this.element.value.length;
            // safari浏览器回车键是按两个字计算
            if (TiBrowser.isSafari()) {
                this.countLength = this.countLength + this.element.value.split('\n').length - 1;
            }
        }
    }
    // 拖动函数
    mouseMove(event) {
        // 阻止调整文本框大小时文本框聚焦
        event.preventDefault();
        const width = this.options.storeWidth;
        const height = this.options.storeHeight;
        const horizonWidth = event.pageX - this.options.mouseXPosition;
        const verticalHeight = event.pageY - this.options.mouseYPosition;
        if (this.resize !== 'vertical' && (width + horizonWidth) >= this.textAreaMinWidth
            && (width + horizonWidth) < this.textAreaMaxWidth) {
            // 更新textarea宽度
            this.options.storeWidth += horizonWidth;
            // 调整width
            this.renderer.setStyle(this.container, 'width', `${this.options.storeWidth}px`);
        }
        if (this.resize !== 'horizontal' && (height + verticalHeight) >= this.textAreaMinHeight
            && (height + verticalHeight) < this.textAreaMaxHeight) {
            // 更新textarea高度
            this.options.storeHeight += verticalHeight;
            this.renderer.setStyle(this.container, 'height', `${this.options.storeHeight}px`);
        }
        // 更新光标位置
        this.options.mouseXPosition = event.pageX;
        this.options.mouseYPosition = event.pageY;
    }
    stopResize() {
        this.options.mouseXPosition = 0;
        this.options.mouseYPosition = 0;
        this.updateTextAreaSize();
        this.options.$target = null;
    }
    // 获取min-width、min-height等的样式值
    getSizeNumber(value) {
        const val = this.element.style[value]; // 可实现获取样式
        if (val !== 'none' && val !== '') {
            return parseFloat(val.replace(/px/, ''));
        }
        return this.defaultStyle[value];
    }
    // 在拖动前获取当前文本框最新的高度、宽度
    updateTextAreaSize() {
        this.options.storeWidth = this.container.clientWidth;
        this.options.storeHeight = this.container.clientHeight;
    }
    // 给页面设置不可选样式，避免拖动时页面出现被选中的蓝色区域
    toggleTextSelection(toggle) {
        const body = this.document.getElementsByTagName('body');
        if (toggle) {
            this.renderer.addClass(body[0], 'ti3-unselectable');
            this.renderer.setAttribute(body[0], 'unselectable', 'on');
        }
        else {
            this.renderer.removeClass(body[0], 'ti3-unselectable');
            this.renderer.removeAttribute(body[0], 'unselectable');
        }
    }
    isResizing() {
        return this.element.className.indexOf('ti3-textarea-resize-border') > -1;
    }
}
TiTextareaComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiTextarea]',
                template: "<span #resize *ngIf=\"resize !== 'none'\" class=\"ti3-textarea-resize-icon\" ></span>\r\n<span #maxlength *ngIf=\"hasMaxlength\" class=\"ti3-textarea-counter\" [id]=\"appendId('max_length')\">\r\n    <span #charactersCount [ngClass]=\"{'ti3-textarea-counter-count': countLength > 0}\">{{countLength | tiFormatNum}}</span>/{{maxLength | tiFormatNum}}</span>",
                host: {
                    '(focus)': 'onFocus()'
                },
                encapsulation: ViewEncapsulation.None,
                styles: [":root{--ti-textarea-counter-height:16px;--ti-textarea-counter-margin-top:2px}textarea.ng-invalid.ng-dirty:not([tiBlurCheck])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-dirty:not([tiBlurCheck])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-touched:not([tiBlurCheck])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-touched:not([tiBlurCheck])~.ti3-textarea-resize-icon:before,textarea.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:after,textarea.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused])~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-error)!important}.ti3-textarea-container{display:inline-block;line-height:normal;min-height:64px;overflow:hidden;position:relative;vertical-align:middle}.ti3-textarea-container>textarea[tiTextarea]{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;color:var(--ti-input-text-color);height:100%!important;outline:none;overflow-x:hidden;padding:var(--ti-textarea-padding-vertical) var(--ti-input-padding-horizontal);resize:none!important;transition:border-color .15s;vertical-align:middle;width:100%!important}.ti3-textarea-container>textarea[tiTextarea]:disabled{background-color:var(--ti-input-bg-color-disabled);border-color:var(--ti-input-border-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed!important}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):hover~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-hover)}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus{border-color:var(--ti-input-border-color-focus);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled):focus~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-focus)}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border{border-color:var(--ti-input-border-color-focus);transition:border-color .2s}.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border~.ti3-textarea-resize-icon:after,.ti3-textarea-container>textarea[tiTextarea]:not(:disabled).ti3-textarea-resize-border~.ti3-textarea-resize-icon:before{border-bottom-color:var(--ti-input-border-color-focus)}.ti3-textarea-container>.ti3-textarea-resize-icon{bottom:1px;cursor:nw-resize;height:10px;position:absolute;right:1px;width:10px}.ti3-textarea-container>.ti3-textarea-resize-icon:before{bottom:-2px;height:8.4px;right:-2px;width:8.4px}.ti3-textarea-container>.ti3-textarea-resize-icon:after,.ti3-textarea-container>.ti3-textarea-resize-icon:before{border-bottom:1px solid var(--ti-input-border-color);content:\"\";display:block;position:absolute;transform:rotate(135deg)}.ti3-textarea-container>.ti3-textarea-resize-icon:after{bottom:0;height:4.2px;right:0;width:4.2px}.ti3-textarea-container>.ti3-textarea-counter{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);box-sizing:border-box;color:var(--ti-textarea-counter-text-color);display:block;height:var(--ti-textarea-counter-height);line-height:var(--ti-textarea-counter-height);margin-top:var(--ti-textarea-counter-margin-top);position:absolute;right:0;text-align:right}.ti3-textarea-container>.ti3-textarea-counter>.ti3-textarea-counter-count{color:var(--ti-textarea-counter-inputed-text-color)}.ti3-textarea-container.ti3-textarea-container-counter>textarea[tiTextarea]{height:calc(100% - var(--ti-textarea-counter-height) - var(--ti-textarea-counter-margin-top))!important}.ti3-textarea-container.ti3-textarea-container-counter>.ti3-textarea-resize-icon{bottom:calc(var(--ti-textarea-counter-height) + var(--ti-textarea-counter-margin-top))}.ti3-unselectable{-ms-user-select:none;-webkit-user-select:none;user-select:none}.ti3-textarea-container-disable>span.ti3-textarea-resize-icon{cursor:not-allowed}"]
            },] }
];
TiTextareaComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone },
    { type: NgControl, decorators: [{ type: Optional }] },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiTextareaComponent.propDecorators = {
    resize: [{ type: Input }],
    resizeIconRef: [{ type: ViewChild, args: ['resize',] }],
    eleCharacterRef: [{ type: ViewChild, args: ['maxlength',] }],
    charactersCountRef: [{ type: ViewChild, args: ['charactersCount',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlUZXh0YXJlYUNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL3RleHRhcmVhL1RpVGV4dGFyZWFDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdILFNBQVMsRUFFVCxVQUFVLEVBQ1YsS0FBSyxFQUNMLE1BQU0sRUFHTixRQUFRLEVBQ1IsU0FBUyxFQUNULFNBQVMsRUFDVCxpQkFBaUIsRUFDakIsTUFBTSxFQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7Ozs7O0dBTUc7QUFZSCxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsb0JBQW9CO0lBbUV6RCxZQUFZLFVBQXNCLEVBQ3RCLFFBQW1CLEVBQ1gsSUFBWSxFQUNBLFdBQXNCLEVBQ2hCLFFBQVE7UUFDMUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUhaLFNBQUksR0FBSixJQUFJLENBQVE7UUFDQSxnQkFBVyxHQUFYLFdBQVcsQ0FBVztRQUNoQixhQUFRLEdBQVIsUUFBUSxDQUFBO1FBdEU5Qzs7Ozs7Ozs7OztXQVVHO1FBQ00sV0FBTSxHQUFnRCxNQUFNLENBQUM7UUE0QnRFLFlBQVk7UUFDSixZQUFPLEdBQVE7WUFDbkIsT0FBTyxFQUFFLFNBQVM7WUFDbEIsVUFBVSxFQUFFLENBQUM7WUFDYixXQUFXLEVBQUUsQ0FBQztZQUNkLGNBQWMsRUFBRSxDQUFDO1lBQ2pCLGNBQWMsRUFBRSxDQUFDO1NBQ3BCLENBQUM7UUFD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QztZQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzdEO2FBQU07WUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7U0FDMUQ7SUFDTCxDQUFDO0lBcUNPLFVBQVU7UUFDZCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7OztZQTNaSixTQUFTLFNBQUM7Z0JBQ1AsOENBQThDO2dCQUM5QyxRQUFRLEVBQUUsY0FBYztnQkFDeEIsZ1hBQThCO2dCQUU5QixJQUFJLEVBQUU7b0JBQ0YsU0FBUyxFQUFFLFdBQVc7aUJBQ3pCO2dCQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN4Qzs7O1lBaENHLFVBQVU7WUFNVixTQUFTO1lBSlQsTUFBTTtZQVlELFNBQVMsdUJBMEZELFFBQVE7NENBQ1IsTUFBTSxTQUFDLFFBQVE7OztxQkEzRDNCLEtBQUs7NEJBSUwsU0FBUyxTQUFDLFFBQVE7OEJBSWxCLFNBQVMsU0FBQyxXQUFXO2lDQUlyQixTQUFTLFNBQUMsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEFmdGVyVmlld0NoZWNrZWQsXHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRG9DaGVjayxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBJbnB1dCxcclxuICAgIE5nWm9uZSxcclxuICAgIE9uRGVzdHJveSxcclxuICAgIE9uSW5pdCxcclxuICAgIE9wdGlvbmFsLFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbiAgICBJbmplY3RcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBUaUJyb3dzZXIsIFV0aWwgfSBmcm9tICcuLi8uLi91dGlscy9VdGlsJztcclxuaW1wb3J0IHsgVGlBdXRvZm9jdXNDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbi8qKlxyXG4gKiBUZXh0YXJlYeaWh+acrOahhue7hOS7tlxyXG4gKlxyXG4gKiDmlofmnKzmoYbnu4Tku7bln7rkuo7ljp/nlJ90ZXh0YXJlYeagh+etvui/m+ihjOaJqeWxle+8jOWOn+eUn3RleHRhcmVh5YqgdGlUZXh0YXJlYeWxnuaAp+aMh+S7pOWNs+S4unRleHRhcmVh57uE5Lu244CCXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD4uLi90aW55M2RlbW8vIy90ZXh0YXJlYS90ZXh0YXJlYS1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXHJcbiAgICBzZWxlY3RvcjogJ1t0aVRleHRhcmVhXScsIC8vIOaMh+Wumue7hOS7tuWQjeensFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RleHRhcmVhLmh0bWwnLCAvLyDmjIflrprnu4Tku7bmqKHmnb9cclxuICAgIHN0eWxlVXJsczogWycuL3RleHRhcmVhLmxlc3MnXSwgLy8g5qC35byP6Lev5b6EXHJcbiAgICBob3N0OiB7XHJcbiAgICAgICAgJyhmb2N1cyknOiAnb25Gb2N1cygpJ1xyXG4gICAgfSxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBUaVRleHRhcmVhQ29tcG9uZW50IGV4dGVuZHMgVGlBdXRvZm9jdXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQsIEFmdGVyVmlld0luaXQsIERvQ2hlY2ssIE9uRGVzdHJveSB7XHJcbiAgICAvKipcclxuICAgICAqIOeUqOadpeiwg+aVtOaWh+acrOahhuWkp+Wwj++8jOivpeWxnuaAp+aPkOS+m+S6huWbm+S4quWxnuaAp+WAvDpcclxuICAgICAqXHJcbiAgICAgKiBub25lKOS4jeWPr+iwg+aVtOe7hOS7tuWkp+Wwjyk6XHJcbiAgICAgKlxyXG4gICAgICogdmVydGljYWwo5LuF5Y+v6LCD5pW05Z6C55u05pa55ZCR55qE5aSn5bCP77yM5Y2z6LCD5pW057uE5Lu255qE6auY5bqmKVxyXG4gICAgICpcclxuICAgICAqIGhvcml6b250YWwo5LuF5Y+v6LCD6IqC5rC05bmz5pa55ZCR55qE5aSn5bCP77yM5Y2z6LCD5pW057uE5Lu255qE5a695bqmKVxyXG4gICAgICpcclxuICAgICAqIGJvdGgo5rC05bmz5ZKM5Z6C55u05pa55ZCR5Z2H5Y+v6LCD6IqC77yM5a696auY6YO95Y+v6LCD6IqCKVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSByZXNpemU6ICdub25lJyB8ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCcgfCAnYm90aCcgPSAnYm90aCc7XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgQFZpZXdDaGlsZCgncmVzaXplJykgcHJpdmF0ZSByZXNpemVJY29uUmVmOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ21heGxlbmd0aCcpIHByaXZhdGUgZWxlQ2hhcmFjdGVyUmVmOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ2NoYXJhY3RlcnNDb3VudCcpIHByaXZhdGUgY2hhcmFjdGVyc0NvdW50UmVmOiBFbGVtZW50UmVmO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmmK/lkKborr7nva5tYXhsZW5ndGjlsZ7mgKdcclxuICAgICAqL1xyXG4gICAgcHVibGljIGhhc01heGxlbmd0aDogYm9vbGVhbjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog55So5oi36K6+572u55qE5pyA5aSn5YC8XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBtYXhMZW5ndGg6IG51bWJlcjtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5b2T5YmN6L6T5YWl5YaF5a6555qE6ZW/5bqmXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb3VudExlbmd0aDogbnVtYmVyO1xyXG4gICAgLy8g55So5L2c5ouW5Yqo5paH5pys5qGG5aSn5bCPXHJcbiAgICBwcml2YXRlIG9wdGlvbnM6IGFueSA9IHtcclxuICAgICAgICAkdGFyZ2V0OiB1bmRlZmluZWQsXHJcbiAgICAgICAgc3RvcmVXaWR0aDogMCxcclxuICAgICAgICBzdG9yZUhlaWdodDogMCxcclxuICAgICAgICBtb3VzZVhQb3NpdGlvbjogMCxcclxuICAgICAgICBtb3VzZVlQb3NpdGlvbjogMFxyXG4gICAgfTtcclxuICAgIC8vIOm7mOiupOacgOWkp+acgOWwj+WuvemrmFxyXG4gICAgcHJpdmF0ZSBkZWZhdWx0U3R5bGU6IGFueSA9IHtcclxuICAgICAgICBtaW5XaWR0aDogNjAsXHJcbiAgICAgICAgbWluSGVpZ2h0OiA2NCxcclxuICAgICAgICBtYXhXaWR0aDogMTI4MCxcclxuICAgICAgICBtYXhIZWlnaHQ6IDk5OTlcclxuICAgIH07XHJcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7IC8vIOWuv+S4u+WFg+e0oFxyXG4gICAgcHJpdmF0ZSBhdHRyczogTmFtZWROb2RlTWFwOyAvLyDlrr/kuLvlhYPntKDnmoTlsZ7mgKdcclxuICAgIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudDsgLy8g5Yib5bu6ZGl25qCH562+XHJcbiAgICBwcml2YXRlIHRleHRBcmVhTWluV2lkdGg6IG51bWJlcjsgLy8g5pyA5bCP5a695bqmXHJcbiAgICBwcml2YXRlIHRleHRBcmVhTWluSGVpZ2h0OiBudW1iZXI7IC8vIOacgOWwj+mrmOW6plxyXG4gICAgcHJpdmF0ZSB0ZXh0QXJlYU1heFdpZHRoOiBudW1iZXI7IC8vIOacgOWkp+WuveW6plxyXG4gICAgcHJpdmF0ZSB0ZXh0QXJlYU1heEhlaWdodDogbnVtYmVyOyAvLyDmnIDlpKfpq5jluqZcclxuICAgIHByaXZhdGUgaXNWaXNpYmxlSW5pdDogYm9vbGVhbjsgLy8g5qCH5b+X5Yid5aeL5pe25piv5ZCm5Y+v6KeBXHJcbiAgICBwcml2YXRlIGlzRmlyc3RGb2N1czogYm9vbGVhbiA9IHRydWU7IC8vIOaYr+WQpuS4uuesrOS4gOasoeiBmueEplxyXG4gICAgcHJpdmF0ZSBkb2N1bWVudE1vdXNlTW92ZUxpc3RlbmVyOiAoKSA9PiB2b2lkO1xyXG4gICAgcHJpdmF0ZSBkb2N1bWVudE1vdXNlVXBMaXN0ZW5lcjogKCkgPT4gdm9pZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgICAgICAgICAgICAgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgem9uZTogTmdab25lLFxyXG4gICAgICAgICAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBmb3JtQ29udHJvbDogTmdDb250cm9sLFxyXG4gICAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudCkge1xyXG4gICAgICAgIHN1cGVyKGVsZW1lbnRSZWYsIHJlbmRlcmVyKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7IC8vIOiOt+WPluWuv+S4u+WFg+e0oFxyXG4gICAgICAgIHRoaXMuYXR0cnMgPSB0aGlzLmVsZW1lbnQuYXR0cmlidXRlczsgLy8g5Y+v5Lul5qC55o2u5bGe5oCn5ZCN6I635Y+W5ZCE5Liq5bGe5oCnXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyAvLyDliJvlu7pkaXbmoIfnrb5cclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuY29udGFpbmVyLCAndGkzLXRleHRhcmVhLWNvbnRhaW5lcicpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5Yid5aeL5YyWbWF4bGVuZ3Ro5bGe5oCnXHJcbiAgICAgICAgdGhpcy5oYXNNYXhsZW5ndGggPSBVdGlsLmlzVW5kZWZpbmVkKHRoaXMuYXR0cnNbJ21heGxlbmd0aCddKSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICAvLyDljp/nlJ/kuI3orr7nva5tYXhsZW5ndGjlsZ7mgKfml7bor6XlgLzkuLotMTtcclxuICAgICAgICB0aGlzLm1heExlbmd0aCA9IHRoaXMuaGFzTWF4bGVuZ3RoID8gdGhpcy5lbGVtZW50Lm1heExlbmd0aCA6IC0xO1xyXG4gICAgICAgIC8vIOaWh+acrOahhueahOWAvOWPkeeUn+WPmOWMluaXtuinpuWPkVxyXG4gICAgICAgIC8vIOS9v+eUqG5nTW9kZWzliJ3lp4votYvlgLzml7bvvIzop6blj5F2YWx1ZUNoYW5nZXPjgIJcclxuICAgICAgICAvLyDkvb/nlKhmb3JtQ29udHJvbOWIneWni+i1i+WAvOaXtu+8jOS4jeS8muinpuWPkXZhbHVlQ2hhbmdlc+OAglxyXG4gICAgICAgIGlmICh0aGlzLmZvcm1Db250cm9sKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb3VudExlbmd0aCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOS9v+eUqGZvcm1Db250cm9s5Yid5aeL6LWL5YC85pe277yM5Yid5aeL5YyW5LiN5Lya6Kem5Y+RdmFsdWVDaGFuZ2Vz77yM5omA5Lul5q2k5aSE6aKd5aSW5omn6KGM5LiA5qyh44CCXHJcbiAgICAgICAgLy8g5L2/55SobmdNb2RlbOWIneWni+i1i+WAvOaXtu+8jOatpOWkhOmAmui/h3RoaXMuZWxlbWVudC52YWx1ZeaLv+WIsOeahOWAvOS4uuepuuWtl+espuS4su+8jOaXoOazleato+ehruaYvuekuuW9k+WJjei+k+WFpeWGheWuueeahOmVv+W6plxyXG4gICAgICAgIHRoaXMuc2V0Q291bnRMZW5ndGgoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5aaC5p6c56WW5YWI5YWD57Sg5LitZGlzcGxheeS4um5vbmXvvIzojrflj5bliLDnmoTnu4Tku7bnmoTlrr3luqbkuLowLOWFg+e0oOS4jeWPr+ingVxyXG4gICAgICAgIHRoaXMuaXNWaXNpYmxlSW5pdCA9IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aCAhPT0gMDtcclxuICAgICAgICBpZiAodGhpcy5pc1Zpc2libGVJbml0KSB7XHJcbiAgICAgICAgICAgIC8vIOiuvue9rmNvbnRhaW5lcueahOagt+W8j1xyXG4gICAgICAgICAgICB0aGlzLnNldENvbnRhaW5lclNpemUoKTtcclxuICAgICAgICAgICAgLy8g5Yid5aeL5YyW5Yib5bu6ZG9tXHJcbiAgICAgICAgICAgIHRoaXMuaW5pdEZuKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlsIblrr/kuLvlhYPntKDnmoTmoLflvI/nsbvnp7vliLBjb250YWluZXLkuIpcclxuICAgICAgICB0aGlzLnNldENvbnRhaW5lckNsYXNzKCk7XHJcblxyXG4gICAgICAgIC8vIG1heExlbmd0aOaOpeWPo+a3u+WKoOagt+W8j1xyXG4gICAgICAgIHRoaXMuc2V0TWF4TGVuZ3RoRm4oKTtcclxuXHJcbiAgICAgICAgLy8g5aSE55CGcmVzaXpl5Yqf6IO9XHJcbiAgICAgICAgdGhpcy5yZXNpemVGbigpO1xyXG4gICAgICAgIC8vIOS4iumdouaJp+ihjOWujOWIneWni+WMlmRvbeWQju+8jOiwg+eUqOeItuexu+eahG5nQWZ0ZXJWaWV3SW5pdOWOu+iuvue9rmF1dG9mb2N1c1xyXG4gICAgICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyDliJ3lp4vnpZblhYjlhYPntKDkuK1kaXNwbGF55Li6bm9uZe+8jOS5i+WQjuesrOS4gOasoeeUsW5vbmXlj5jmiJDlj6/op4Hml7bvvIzpnIDopoHph43nva5zaWxkZXJcclxuICAgICAgICBpZiAoIXRoaXMuaXNWaXNpYmxlSW5pdCAmJiB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGggIT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDb250YWluZXJTaXplKCk7XHJcbiAgICAgICAgICAgIC8vIOWIneWni+WMluWIm+W7umRvbVxyXG4gICAgICAgICAgICB0aGlzLmluaXRGbigpO1xyXG4gICAgICAgICAgICB0aGlzLmlzVmlzaWJsZUluaXQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5aSE55CG54Gw5YyW5Yqf6IO9XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuY29udGFpbmVyLCAndGkzLXRleHRhcmVhLWNvbnRhaW5lci1kaXNhYmxlJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmNvbnRhaW5lciwgJ3RpMy10ZXh0YXJlYS1jb250YWluZXItZGlzYWJsZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDkv67lpI1TU1LmiqXplJnvvJpFUlJPUiBSZWZlcmVuY2VFcnJvcjogZ2V0Q29tcHV0ZWRTdHlsZSBpcyBub3QgZGVmaW5lZFxyXG4gICAgICAgIGlmKHR5cGVvZiBnZXRDb21wdXRlZFN0eWxlID09PSAndW5kZWZpbmVkJyl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5aSE55CG6YCa6L+H6K6+572uZGlzcGxheeeahOaWueW8j+makOiXj+e7hOS7tu+8muWGhemDqOeUn+aIkOeahGRvbeS5n+mcgOimgemakOiXj1xyXG4gICAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudCkuZGlzcGxheSA9PT0gJ25vbmUnKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jb250YWluZXIsICdkaXNwbGF5JywgJ25vbmUnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuY29udGFpbmVyLCAnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIG1heGxlbmd0aOmAmui/h+aOpeWPo+S8oOWAvOmcgOinpuWPkemHjeaWsOWIpOaWre+8jOWboOS4umluaXTlh73mlbDkuK3miafooYzovoPml6nkuJTlj6rmiafooYzkuIDmrKHjgIJcclxuICAgIG5nRG9DaGVjaygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmhhc01heGxlbmd0aCA9IFV0aWwuaXNVbmRlZmluZWQodGhpcy5hdHRyc1snbWF4bGVuZ3RoJ10pID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIHRoaXMubWF4TGVuZ3RoID0gdGhpcy5oYXNNYXhsZW5ndGggPyB0aGlzLmVsZW1lbnQubWF4TGVuZ3RoIDogLTE7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6ZSA5q+B57uE5Lu25pe26ZyA6KaB5bCG5YaF6YOo55Sf5oiQZG9t5Lmf56e76ZmkXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMucmVuZGVyZXIucGFyZW50Tm9kZSh0aGlzLmNvbnRhaW5lciksIHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICBpZiAodGhpcy5kb2N1bWVudE1vdXNlTW92ZUxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRNb3VzZU1vdmVMaXN0ZW5lcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kb2N1bWVudE1vdXNlVXBMaXN0ZW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50TW91c2VVcExpc3RlbmVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25Gb2N1cygpOiB2b2lkIHtcclxuICAgICAgICAvLyBJReWSjOeBq+eLkOa1j+iniOWZqOWcqOmmluasoWF1dG9mb3VjdXPogZrnhKbml7bkvJrlsIblhYnmoIfnp7vliLDmloflrZfotbflp4vkvY3nva7vvIznlKjmiLfkvZPpqozkuI3lpb1cclxuICAgICAgICAvLyDpnIDopoHmiYvliqjorr7nva7lhYnmoIfkvY3nva7liLDooYzlsL5cclxuICAgICAgICBpZiAodGhpcy5pc0ZpcnN0Rm9jdXMgJiYgdGhpcy5lbGVtZW50LmF1dG9mb2N1cyAmJlxyXG4gICAgICAgICAgICAoVGlCcm93c2VyLmlzRmlyZWZveCgpIHx8IFRpQnJvd3Nlci5pc0lFKCkpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLmVsZW1lbnQudmFsdWUubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnZhbHVlLmxlbmd0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNGaXJzdEZvY3VzID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRDb250YWluZXJTaXplKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOS/ruato1NTUumUmeivr++8mkVSUk9SIFJlZmVyZW5jZUVycm9yOiBnZXRDb21wdXRlZFN0eWxlIGlzIG5vdCBkZWZpbmVkXHJcbiAgICAgICAgaWYgKHR5cGVvZiBnZXRDb21wdXRlZFN0eWxlID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodDogc3RyaW5nID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnQpLmhlaWdodDtcclxuICAgICAgICBjb25zdCBjb250YWluZXJXaWR0aDogc3RyaW5nID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnQpLndpZHRoO1xyXG4gICAgICAgICAvLyDoi6XmnI3liqHlnKh0ZXh0YXJlYeS4iumdouiuvue9rm1hcmdpbuWklui+uei3nSzkvJrlr7zoh7R0ZXh0YXJlYeaJgOWNoOeahOmhtemdouepuumXtOWkp+S6juWkluahhueahOWuvemrmCzmiYDku6XopoHlsIZ0ZXh0YXJlYeS4iuiuvue9rueahG1hcmdpbui9rOenu+WIsOWklui+ueahhlxyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lck1hcmdpbjogc3RyaW5nID0gdGhpcy5lbGVtZW50LnN0eWxlLm1hcmdpbjtcclxuXHJcbiAgICAgICAgLy8g5Y+W5o6J5a6/5Li75YWD57Sg55qEbWFyZ2lu5bGe5oCnOlxyXG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5tYXJnaW4gPSAnJztcclxuXHJcbiAgICAgICAgLy8g6K6+572udGhpcy5jb250YWluZXLnmoR3aWR0aOOAgWhlaWdodOOAgW1hcmdpblxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jb250YWluZXIsICdoZWlnaHQnLCBjb250YWluZXJIZWlnaHQpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jb250YWluZXIsICd3aWR0aCcsIGNvbnRhaW5lcldpZHRoKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuY29udGFpbmVyLCAnbWFyZ2luJywgY29udGFpbmVyTWFyZ2luKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENvbnRhaW5lckNsYXNzKCk6IHZvaWQge1xyXG4gICAgICAvLyDojrflj5bmnKrnu4/ov4dhbmd1bGFy6Kej5p6Q5ZCO55qE5bGe5oCn6ZyA6KaB5Zyob25pbnTkuK3lpITnkIbvvJroi6XmnI3liqHlnKh0ZXh0YXJlYea3u+WKoGNsYXNz77yM5YiZ5oqK5YW25Yqg5Yiw54i25a655Zmo5LiKXHJcbiAgICAgIGNvbnN0IGNOYW1lczogc3RyaW5nID0gdGhpcy5lbGVtZW50LmNsYXNzTmFtZTtcclxuICAgICAgaWYgKGNOYW1lcykge1xyXG4gICAgICAgIGNvbnN0IGNOYW1lQXJyOiBBcnJheTxzdHJpbmc+ID0gdGhpcy5lbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgnICcpOyAvLyDlrZjlnKjlpJrkuKpjbGFzc1xyXG4gICAgICAgIGZvciAoY29uc3QgY05hbWUgb2YgY05hbWVBcnIpIHtcclxuICAgICAgICAgICAgLy8g6Lef5qCh6aqM5pyJ5YWz55qE5qC35byP5piv5LulXCJuZy1cIuW8gOWktO+8jOWmguaenOi9rOenu+WIsOWklumDqOWuueWZqOS4iuS8muW9seWTjeagoemqjOagt+W8j1xyXG4gICAgICAgICAgICBpZiAoIS9ebmctLy50ZXN0KGNOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsIGNOYW1lKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5jb250YWluZXIsIGNOYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIneWni+WMluWIm+W7umRvbVxyXG4gICAgcHJpdmF0ZSBpbml0Rm4oKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgcE5vZGU6IGFueSA9IHRoaXMucmVuZGVyZXIucGFyZW50Tm9kZSh0aGlzLmVsZW1lbnQpOyAvLyDmib7liLDlrr/kuLvlhYPntKDniLblhYPntKBcclxuICAgICAgICBjb25zdCBuZXh0Tm9kZTogYW55ID0gdGhpcy5yZW5kZXJlci5uZXh0U2libGluZyh0aGlzLmVsZW1lbnQpOyAvLyDmib7liLDlrr/kuLvlhYPntKDnmoTlhYTlvJ/lhYPntKBcclxuXHJcbiAgICAgICAgLy8g5bCG5a6/5Li75YWD57Sg5YyF6KO55ZyodGhpcy5jb250YWluZXLph4zovrnvvJpcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHBOb2RlLCB0aGlzLmVsZW1lbnQpOyAvLyDku47niLblhYPntKDkuK3np7vpmaTlrr/kuLvlhYPntKBcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyLCB0aGlzLmVsZW1lbnQpOyAvLyDlsIblrr/kuLvlhYPntKDmlL7lhaXliJvlu7rnmoRkaXbmoIfnrb7kuK1cclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmluc2VydEJlZm9yZShwTm9kZSwgdGhpcy5jb250YWluZXIsIG5leHROb2RlKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucmVzaXplICE9PSAnbm9uZScpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlTm9kZSh0aGlzLnJlc2l6ZUljb25SZWYubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNNYXhsZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlTm9kZSh0aGlzLmVsZUNoYXJhY3RlclJlZi5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZU5vZGUobm9kZTogRWxlbWVudCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LCBub2RlKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyLCBub2RlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBtYXhMZW5ndGjmjqXlj6NcclxuICAgIHByaXZhdGUgc2V0TWF4TGVuZ3RoRm4oKTogdm9pZCB7XHJcbiAgICAgICAgICAgIC8vIOa3u+WKoOWtl+aVsOmZkOWItuS4juW9k+WJjei+k+WFpeWtl+aVsOaYvuekuuWKn+iDvVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hdHRyc1snbWF4bGVuZ3RoJ10gJiYgIWlzTmFOKHRoaXMubWF4TGVuZ3RoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5pyJbWF4bGVuZ3Ro6ZmQ5Yi25pe257uZ5aSW5qGGZGl25Yqg5LiK5qCH5b+X57G7IHRpMy10ZXh0YXJlYS1jb250YWluZXItY291bnRlclxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmNvbnRhaW5lciwgJ3RpMy10ZXh0YXJlYS1jb250YWluZXItY291bnRlcicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmNvbnRhaW5lciwgJ3RpMy10ZXh0YXJlYS1jb250YWluZXItY291bnRlcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmVzaXpl5o6l5Y+jXHJcbiAgICBwcml2YXRlIHJlc2l6ZUZuKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLnJlc2l6ZSA9PT0gJ25vbmUnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudGV4dEFyZWFNaW5XaWR0aCA9IHRoaXMuZ2V0U2l6ZU51bWJlcignbWluV2lkdGgnKTtcclxuICAgICAgICB0aGlzLnRleHRBcmVhTWluSGVpZ2h0ID0gdGhpcy5nZXRTaXplTnVtYmVyKCdtaW5IZWlnaHQnKTtcclxuICAgICAgICB0aGlzLnRleHRBcmVhTWF4V2lkdGggPSB0aGlzLmdldFNpemVOdW1iZXIoJ21heFdpZHRoJyk7XHJcbiAgICAgICAgdGhpcy50ZXh0QXJlYU1heEhlaWdodCA9IHRoaXMuZ2V0U2l6ZU51bWJlcignbWF4SGVpZ2h0Jyk7XHJcblxyXG4gICAgICAgIC8vIOa4hemZpHRleHRhcmVh5LiK55qE5qC35byPXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICdtaW5XaWR0aCcsICcnKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ21pbkhlaWdodCcsICcnKTtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ21heFdpZHRoJywgJycpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnbWF4SGVpZ2h0JywgJycpO1xyXG5cclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4geyAvLyDpgb/lhY3kuI3lgZzop6blj5Hlj5jljJbmo4DmtYtcclxuICAgICAgICAgICAgLy8gcmVzaXplSWNvblJlZuaooeadv+eahG1vdXNlZG93buS6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnJlc2l6ZUljb25SZWYubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicsICgkZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50LCAndGkzLXRleHRhcmVhLXJlc2l6ZS1ib3JkZXInKTsgLy8g5ouW5ou95pe26L655qGG6aKc6Imy5Li66IGa54Sm5pe2XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuJHRhcmdldCA9ICRldmVudC50YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubW91c2VYUG9zaXRpb24gPSAkZXZlbnQucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubW91c2VZUG9zaXRpb24gPSAkZXZlbnQucGFnZVk7XHJcbiAgICAgICAgICAgICAgICAvLyDlnKjmi5bliqjliY3ojrflj5blvZPliY3mlofmnKzmoYbmnIDmlrDnmoTpq5jluqbjgIHlrr3luqZcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVGV4dEFyZWFTaXplKCk7XHJcbiAgICAgICAgICAgICAgICAvLyDnu5npobXpnaLorr7nva7kuI3lj6/pgInmoLflvI/vvIzpgb/lhY3mi5bliqjml7bpobXpnaLlh7rnjrDooqvpgInkuK3nmoTok53oibLljLrln59cclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVGV4dFNlbGVjdGlvbih0cnVlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyByZXNpemVJY29uUmVm5qih5p2/55qEbW91c2V1cOS6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnJlc2l6ZUljb25SZWYubmF0aXZlRWxlbWVudCwgJ21vdXNldXAnLCAoJGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWxlbWVudCwgJ3RpMy10ZXh0YXJlYS1yZXNpemUtYm9yZGVyJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudE1vdXNlTW92ZUxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5kb2N1bWVudCwgJ21vdXNlbW92ZScsIHRoaXMubW91c2VNb3ZlSGFuZGxlckZuKTtcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudE1vdXNlVXBMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5tb3VzZVVwSGFuZGxlckZuKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENvdW50TGVuZ3RoKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmhhc01heGxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvdW50TGVuZ3RoID0gdGhpcy5lbGVtZW50LnZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgLy8gc2FmYXJp5rWP6KeI5Zmo5Zue6L2m6ZSu5piv5oyJ5Lik5Liq5a2X6K6h566XXHJcbiAgICAgICAgICAgIGlmIChUaUJyb3dzZXIuaXNTYWZhcmkoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudExlbmd0aCA9IHRoaXMuY291bnRMZW5ndGggKyB0aGlzLmVsZW1lbnQudmFsdWUuc3BsaXQoJ1xcbicpLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5ouW5Yqo5Ye95pWwXHJcbiAgICBwcml2YXRlIG1vdXNlTW92ZShldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xyXG4gICAgICAgLy8g6Zi75q2i6LCD5pW05paH5pys5qGG5aSn5bCP5pe25paH5pys5qGG6IGa54SmXHJcbiAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgY29uc3Qgd2lkdGg6IG51bWJlciA9IHRoaXMub3B0aW9ucy5zdG9yZVdpZHRoO1xyXG4gICAgICAgY29uc3QgaGVpZ2h0OiBudW1iZXIgPSB0aGlzLm9wdGlvbnMuc3RvcmVIZWlnaHQ7XHJcbiAgICAgICBjb25zdCBob3Jpem9uV2lkdGg6IG51bWJlciA9IGV2ZW50LnBhZ2VYIC0gdGhpcy5vcHRpb25zLm1vdXNlWFBvc2l0aW9uO1xyXG4gICAgICAgY29uc3QgdmVydGljYWxIZWlnaHQ6IG51bWJlciA9IGV2ZW50LnBhZ2VZIC0gdGhpcy5vcHRpb25zLm1vdXNlWVBvc2l0aW9uO1xyXG5cclxuICAgICAgIGlmICh0aGlzLnJlc2l6ZSAhPT0gJ3ZlcnRpY2FsJyAmJiAod2lkdGggKyBob3Jpem9uV2lkdGgpID49IHRoaXMudGV4dEFyZWFNaW5XaWR0aFxyXG4gICAgICAgICAgICYmICh3aWR0aCArIGhvcml6b25XaWR0aCkgPCB0aGlzLnRleHRBcmVhTWF4V2lkdGgpIHtcclxuICAgICAgICAgICAvLyDmm7TmlrB0ZXh0YXJlYeWuveW6plxyXG4gICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9yZVdpZHRoICs9IGhvcml6b25XaWR0aDtcclxuICAgICAgICAgICAvLyDosIPmlbR3aWR0aFxyXG4gICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5jb250YWluZXIsICd3aWR0aCcsIGAke3RoaXMub3B0aW9ucy5zdG9yZVdpZHRofXB4YCk7XHJcbiAgICAgICB9XHJcblxyXG4gICAgICAgaWYgKHRoaXMucmVzaXplICE9PSAnaG9yaXpvbnRhbCcgJiYgKGhlaWdodCArIHZlcnRpY2FsSGVpZ2h0KSA+PSB0aGlzLnRleHRBcmVhTWluSGVpZ2h0XHJcbiAgICAgICAgICAgJiYgKGhlaWdodCArIHZlcnRpY2FsSGVpZ2h0KSA8IHRoaXMudGV4dEFyZWFNYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAvLyDmm7TmlrB0ZXh0YXJlYemrmOW6plxyXG4gICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9yZUhlaWdodCArPSB2ZXJ0aWNhbEhlaWdodDtcclxuICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuY29udGFpbmVyLCAnaGVpZ2h0JywgYCR7dGhpcy5vcHRpb25zLnN0b3JlSGVpZ2h0fXB4YCk7XHJcbiAgICAgICB9XHJcblxyXG4gICAgICAgLy8g5pu05paw5YWJ5qCH5L2N572uXHJcbiAgICAgICB0aGlzLm9wdGlvbnMubW91c2VYUG9zaXRpb24gPSBldmVudC5wYWdlWDtcclxuICAgICAgIHRoaXMub3B0aW9ucy5tb3VzZVlQb3NpdGlvbiA9IGV2ZW50LnBhZ2VZO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RvcFJlc2l6ZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMubW91c2VYUG9zaXRpb24gPSAwO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucy5tb3VzZVlQb3NpdGlvbiA9IDA7XHJcbiAgICAgICAgdGhpcy51cGRhdGVUZXh0QXJlYVNpemUoKTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMuJHRhcmdldCA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6I635Y+WbWluLXdpZHRo44CBbWluLWhlaWdodOetieeahOagt+W8j+WAvFxyXG4gICAgcHJpdmF0ZSAgZ2V0U2l6ZU51bWJlcih2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCB2YWw6IHN0cmluZyA9IHRoaXMuZWxlbWVudC5zdHlsZVt2YWx1ZV07IC8vIOWPr+WunueOsOiOt+WPluagt+W8j1xyXG5cclxuICAgICAgICBpZiAodmFsICE9PSAnbm9uZScgJiYgdmFsICE9PSAnJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh2YWwucmVwbGFjZSgvcHgvLCAnJykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICB0aGlzLmRlZmF1bHRTdHlsZVt2YWx1ZV07XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Zyo5ouW5Yqo5YmN6I635Y+W5b2T5YmN5paH5pys5qGG5pyA5paw55qE6auY5bqm44CB5a695bqmXHJcbiAgICBwcml2YXRlIHVwZGF0ZVRleHRBcmVhU2l6ZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMuc3RvcmVXaWR0aCA9IHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucy5zdG9yZUhlaWdodCA9IHRoaXMuY29udGFpbmVyLmNsaWVudEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDnu5npobXpnaLorr7nva7kuI3lj6/pgInmoLflvI/vvIzpgb/lhY3mi5bliqjml7bpobXpnaLlh7rnjrDooqvpgInkuK3nmoTok53oibLljLrln59cclxuICAgIHByaXZhdGUgdG9nZ2xlVGV4dFNlbGVjdGlvbih0b2dnbGU6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBib2R5OiBhbnkgPSB0aGlzLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5Jyk7XHJcbiAgICAgICAgaWYgKHRvZ2dsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGJvZHlbMF0sICd0aTMtdW5zZWxlY3RhYmxlJyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKGJvZHlbMF0sICd1bnNlbGVjdGFibGUnLCAnb24nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKGJvZHlbMF0sICd0aTMtdW5zZWxlY3RhYmxlJyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGJvZHlbMF0sICd1bnNlbGVjdGFibGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDnu5HlrprlnKhkb2N1bWVudOS4iueahG1vdXNlTW92ZeS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbW91c2VNb3ZlSGFuZGxlckZuID0gKCRldmVudDogTW91c2VFdmVudCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5ouW5Yqo55qE5Yqo5L2c5bqU6K+l5piv5YWIbW91c2Vkb3du77yM54S25ZCObW91c2Vtb3Zl77yM5Zug5q2k5YWI5Yik5pat5piv5ZCm5bey57uP6Kem5Y+R5LqGbW91c2Vkb3duXHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb3VzZVhQb3NpdGlvbiA9PT0gMCAmJiB0aGlzLm9wdGlvbnMubW91c2VZUG9zaXRpb24gPT09IDAgfHwgIXRoaXMub3B0aW9ucy4kdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tb3VzZU1vdmUoJGV2ZW50KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog57uR5a6a5ZyoZG9jdW1lbnTkuIrnmoRtb3VzZVVw5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBtb3VzZVVwSGFuZGxlckZuID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6Kej5Yaz6Zeu6aKY77ya5b2T5ouW5Yqo6byg5qCH5pe277yM6byg5qCH5LiN5Zyo5bCP5LiJ6KeS5LiK5pe277yM6byg5qCH5pS+5byA5LiN5Lya56e76Zmk5qC35byPXHJcbiAgICAgICAgLy8g5Li656Gu5L+d6byg5qCH5by56LW35pe2LCB0ZXh0YXJlYeeahOi+ueahhuagt+W8j+aBouWkjem7mOiupDpcclxuICAgICAgICBpZiAodGhpcy5pc1Jlc2l6aW5nKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsICd0aTMtdGV4dGFyZWEtcmVzaXplLWJvcmRlcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3BSZXNpemUoKTtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVUZXh0U2VsZWN0aW9uKGZhbHNlKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7fVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNSZXNpemluZygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCd0aTMtdGV4dGFyZWEtcmVzaXplLWJvcmRlcicpID4gLTE7XHJcbiAgICB9XHJcbn1cclxuIl19