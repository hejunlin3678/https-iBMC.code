import { Component, HostListener } from '@angular/core';
import { TiRadioBaseComponent } from '../base/TiBaseModule';
import { TiBrowser, TiLog, Util } from '../../utils/Util';
/**
 * Checkbox组件，尽管这是一个组件，但使用方法有点像属性指令。主要功能为设置某一条件是否被选中。
 *
 * Checkbox组件完全基于原生input checkbox实现，
 *
 * 可以使用Angular针对原生Checkbox提供的所有指令，包括：disabled, model, click等，
 *
 * 但是要记得在input中添加TinyUI提供的tiCheckbox属性。
 *
 * <example-url>../tiny3demo/#/checkbox/checkbox-all</example-url>
 */
export class TiCheckboxComponent extends TiRadioBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * 问题一：浏览器兼容性问题：用angular提供的indeterminate属性设置半选，在谷歌下全部正常显示。
         * 在火狐和IE下，checked=true 和indeterminate=true同时存在时，半选样式存在问题，不知道是否和tiny组件的css样式写法有关。
         * 为了统一逻辑和预测，checkgroup和tree组件内部本应该这样使用：置indeterminate=true时，同时会置checked = false
         * 但是，暂时tree组件没有这样做，由TiCheckboxComponent来纠错。
         * TiCheckboxComponent补充效果：tree组件/业务用户，置indeterminate=true时，组件自身会置checked = false
         * 问题二：浏览器兼容性问题：Chrome/Firefox半选点击后变为全选，checked状态改变。IE半选点击后变为不选，checked状态未改变，所以没有通知change事件。
         * 但checkgroup需要change事件去维护子选项
         * TiCheckboxComponent IE补充效果：监听IE的click，当indeterminate从true变为false时，组件会置checked = false，并通知change事件。
         */
        this.lastIndeterminate = undefined;
    }
    ngAfterViewChecked() {
        super.ngAfterViewChecked();
        // 补充效果：tree组件/业务用户，置indeterminate=true时，组件自身会置checked = false
        if (this.nativeElement.indeterminate) {
            this.nativeElement.checked = false;
        }
        this.lastIndeterminate = this.nativeElement.indeterminate;
    }
    /**
     * @ignore
     * IE补充效果：监听IE的click，当indeterminate从true变为false时，组件会置checked = false，并通知change事件。
     */
    onHostClick(event) {
        if (TiBrowser.isIE() && this.lastIndeterminate && !this.nativeElement.indeterminate) {
            this.checked(true);
        }
    }
    /**
     * @ignore
     * 设置checked属性，indeterminate，同时可能触发change事件。
     * 以后可以考虑开放这个接口，给用户调用
     * @protected
     * @param checked true/false/半选   半选用'indeterminate'或null
     */
    checked(checked) {
        const lastChecked = this.nativeElement.checked;
        const lastIndeterminate = (this.nativeElement.indeterminate === true) ? true : false; // 将undefined也转为false。
        switch (checked) {
            case true: // 全选
                this.nativeElement.checked = true;
                this.nativeElement.indeterminate = false;
                break;
            case false: // 全不选
                this.nativeElement.checked = false;
                this.nativeElement.indeterminate = false;
                break;
            case null: // 半选
            case 'indeterminate': // 半选
                this.nativeElement.checked = false; // TODO: 为了保证IE下点击半选后，变为全选，这里设false。未验证。
                this.nativeElement.indeterminate = true;
                break;
            default: // 不会走到这里。
                TiLog.error('setChecked(),switch default, can not reach code');
                break;
        }
        // indeterminate初始时为undefined。
        if (this.nativeElement.checked !== lastChecked || this.nativeElement.indeterminate !== lastIndeterminate) {
            Util.trigger(this.nativeElement, 'change'); // 必须主动触发change事件，否则ngModel不更新。也走不到change回调。
        }
    }
}
TiCheckboxComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: '[tiCheckbox]',
                template: "<!--Tiny3\u4F18\u5316\uFF1A\u51CF\u5C11label\u5D4C\u5957\uFF0C\u53BB\u9664\u5185\u5C42label-->\r\n<label #labelRef class='ti3-checkbox' [for]='id'  [id]=\"appendId('checkbox')\">\r\n    <!-- \u517C\u5BB9IE11\u6DFB\u52A0spacebar\u4E8B\u4EF6 -->\r\n    <span #proxyRef class='ti3-checkbox-skin ti3-icon ti3-icon-checkmark' tiOutline\r\n        (keydown.spacebar)=\"onSpaceKeydown($event)\"  (keyup.spacebar)=\"onSpaceKeyup($event)\"\r\n        (keydown.space)=\"onSpaceKeydown($event)\"  (keyup.space)=\"onSpaceKeyup($event)\"></span>\r\n    <span class='ti3-checkbox-label' [id]=\"appendId('label')\">{{label}}</span>\r\n</label>",
                styles: [":hostinput[type=checkbox][tiCheckbox]{display:none!important}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox{-ms-box-sizing:border-box;-ms-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;display:inline-block;font-weight:400;line-height:1em;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-skin{-ms-box-sizing:border-box;background-color:var(--ti-checkbox-bg-color);border:1px solid var(--ti-checkbox-border-color);border-collapse:separate;border-radius:2px;box-sizing:border-box;color:transparent;display:inline-block;height:var(--ti-checkbox-size);line-height:var(--ti-checkbox-mark-size);margin-bottom:0;margin-right:var(--ti-checkbox-label-right-space);position:relative;text-align:center;transition:background-color .15s,border-color .15s;vertical-align:middle;width:var(--ti-checkbox-size)}:hostinput[type=checkbox][tiCheckbox]+.ti3-checkbox .ti3-checkbox-label{-ms-user-select:none;-webkit-user-select:none;color:var(--ti-checkbox-label-color);display:inline;margin-bottom:0;user-select:none;vertical-align:middle}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-checked);border-color:var(--ti-checkbox-border-color-checked);color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-bg-color-checked-hover);border-color:var(--ti-checkbox-bg-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):checked+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-checked-active);border-color:var(--ti-checkbox-bg-color-checked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:focus,:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:hover{border-color:var(--ti-checkbox-border-color-hover)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):not(:checked)+.ti3-checkbox .ti3-checkbox-skin:active{background-color:var(--ti-checkbox-bg-color-unchecked-active);border-color:var(--ti-checkbox-border-color-unchecked-active)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-partial-color-checked);border-color:var(--ti-checkbox-partial-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-label-color-checked)}:hostinput[type=checkbox][tiCheckbox]:not([disabled]):indeterminate+.ti3-checkbox .ti3-checkbox-skin:hover{background-color:var(--ti-checkbox-partial-color-checked-hover);border-color:var(--ti-checkbox-partial-color-checked-hover)}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox{cursor:not-allowed}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-label-color-checked);outline:none}:hostinput[type=checkbox][tiCheckbox][disabled]+.ti3-checkbox .ti3-checkbox-label{color:var(--ti-checkbox-label-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:checked+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-checked-disabled);color:var(--ti-checkbox-mark-color-disabled)}:hostinput[type=checkbox][tiCheckbox][disabled]:not(:checked)+.ti3-checkbox .ti3-checkbox-skin{background-color:var(--ti-checkbox-bg-color-disable);border-color:var(--ti-checkbox-border-color-unchecked-disabled);color:transparent}:hostinput[type=checkbox][tiCheckbox][disabled]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{background-color:var(--ti-checkbox-partial-color-checked-disabled)}:hostinput[type=checkbox][tiCheckbox]:checked+.ti3-checkbox .ti3-checkbox-skin:before{-ms-box-sizing:border-box;border-style:solid;border-width:0 2px 2px 0;box-sizing:border-box;content:\" \";display:table;height:9px;left:21%;position:absolute;top:50%;transform:rotate(45deg) translate(-55%,-55%) scale(1);width:7px}:hostinput[type=checkbox][tiCheckbox]:indeterminate+.ti3-checkbox .ti3-checkbox-skin:before{border-radius:1px;content:\"\";height:var(--ti-checkbox-partial-center-size);left:4px;position:absolute;top:4px;width:var(--ti-checkbox-partial-center-size)}@keyframes rect-selectedAnimate{0%{transform:scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:scale(1);transform-origin:center}}@keyframes tick-selectedAnimate{0%{transform:rotate(45deg) translate(-55%,-55%) scale(0);transform-origin:center}to{color:var(--ti-checkbox-label-color-checked);transform:rotate(45deg) translate(-55%,-55%) scale(1);transform-origin:center}}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-icon-checkmark:before{animation:tick-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):indeterminate+.ti3-checkbox .ti3-icon-checkmark:before{animation:rect-selectedAnimate .2s var(--ti-timing-function-default) forwards}input[type=checkbox][tiCheckbox]:not(:disabled):checked+.ti3-checkbox .ti3-checkbox-skin:hover{transition:border-color .2s var(--ti-timing-function-default),background-color .2s var(--ti-timing-function-default)}"]
            },] }
];
TiCheckboxComponent.propDecorators = {
    onHostClick: [{ type: HostListener, args: ['click', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlDaGVja2JveENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL2NoZWNrYm94L1RpQ2hlY2tib3hDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQzNFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVELE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTFEOzs7Ozs7Ozs7O0dBVUc7QUFPSCxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsb0JBQW9CO0lBTjdEOztRQU9JOzs7Ozs7Ozs7V0FTRztRQUNLLHNCQUFpQixHQUFZLFNBQVMsQ0FBQztJQXFEbkQsQ0FBQztJQXBERyxrQkFBa0I7UUFDZCxLQUFLLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUMzQiw4REFBOEQ7UUFDOUQsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRTtZQUNsQyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7U0FDdEM7UUFDRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7SUFDOUQsQ0FBQztJQUNEOzs7T0FHRztJQUN1QyxXQUFXLENBQUMsS0FBaUI7UUFDbkUsSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLGlCQUFpQixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLEVBQUU7WUFDakYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QjtJQUNMLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDTyxPQUFPLENBQUMsT0FBZ0M7UUFFOUMsTUFBTSxXQUFXLEdBQVksSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUM7UUFDeEQsTUFBTSxpQkFBaUIsR0FBWSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLHNCQUFzQjtRQUNySCxRQUFRLE9BQU8sRUFBRTtZQUNiLEtBQUssSUFBSSxFQUFFLEtBQUs7Z0JBQ1osSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2dCQUNsQyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7Z0JBQ3pDLE1BQU07WUFDVixLQUFLLEtBQUssRUFBRSxNQUFNO2dCQUNkLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztnQkFDbkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO2dCQUN6QyxNQUFNO1lBQ1YsS0FBSyxJQUFJLENBQUMsQ0FBQyxLQUFLO1lBQ2hCLEtBQUssZUFBZSxFQUFFLEtBQUs7Z0JBQ3ZCLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLHdDQUF3QztnQkFDNUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO2dCQUN4QyxNQUFNO1lBQ1YsU0FBUyxVQUFVO2dCQUNmLEtBQUssQ0FBQyxLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQztnQkFDL0QsTUFBTTtTQUNiO1FBQ0QsOEJBQThCO1FBQzlCLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEtBQUssV0FBVyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxLQUFLLGlCQUFpQixFQUFFO1lBQ3RHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLDRDQUE0QztTQUMzRjtJQUNMLENBQUM7OztZQXJFSixTQUFTLFNBQUM7Z0JBQ0wsOENBQThDO2dCQUM5QyxRQUFRLEVBQUUsY0FBYztnQkFDeEIsZ29CQUE4Qjs7YUFFbkM7OzswQkF5QkksWUFBWSxTQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSG9zdExpc3RlbmVyLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUaVJhZGlvQmFzZUNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvVGlCYXNlTW9kdWxlJztcclxuaW1wb3J0IHsgVGlCcm93c2VyLCBUaUxvZywgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5cclxuLyoqXHJcbiAqIENoZWNrYm9457uE5Lu277yM5bC9566h6L+Z5piv5LiA5Liq57uE5Lu277yM5L2G5L2/55So5pa55rOV5pyJ54K55YOP5bGe5oCn5oyH5Luk44CC5Li76KaB5Yqf6IO95Li66K6+572u5p+Q5LiA5p2h5Lu25piv5ZCm6KKr6YCJ5Lit44CCXHJcbiAqXHJcbiAqIENoZWNrYm9457uE5Lu25a6M5YWo5Z+65LqO5Y6f55SfaW5wdXQgY2hlY2tib3jlrp7njrDvvIxcclxuICpcclxuICog5Y+v5Lul5L2/55SoQW5ndWxhcumSiOWvueWOn+eUn0NoZWNrYm945o+Q5L6b55qE5omA5pyJ5oyH5Luk77yM5YyF5ous77yaZGlzYWJsZWQsIG1vZGVsLCBjbGlja+etie+8jFxyXG4gKlxyXG4gKiDkvYbmmK/opoHorrDlvpflnKhpbnB1dOS4rea3u+WKoFRpbnlVSeaPkOS+m+eahHRpQ2hlY2tib3jlsZ7mgKfjgIJcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL2NoZWNrYm94L2NoZWNrYm94LWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gICAgICBzZWxlY3RvcjogJ1t0aUNoZWNrYm94XScsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnLi9jaGVja2JveC5odG1sJyxcclxuICAgICAgc3R5bGVVcmxzOiBbJy4vY2hlY2tib3gubGVzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaUNoZWNrYm94Q29tcG9uZW50IGV4dGVuZHMgVGlSYWRpb0Jhc2VDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiDpl67popjkuIDvvJrmtY/op4jlmajlhbzlrrnmgKfpl67popjvvJrnlKhhbmd1bGFy5o+Q5L6b55qEaW5kZXRlcm1pbmF0ZeWxnuaAp+iuvue9ruWNiumAie+8jOWcqOiwt+atjOS4i+WFqOmDqOato+W4uOaYvuekuuOAglxyXG4gICAgICog5Zyo54Gr54uQ5ZKMSUXkuIvvvIxjaGVja2VkPXRydWUg5ZKMaW5kZXRlcm1pbmF0ZT10cnVl5ZCM5pe25a2Y5Zyo5pe277yM5Y2K6YCJ5qC35byP5a2Y5Zyo6Zeu6aKY77yM5LiN55+l6YGT5piv5ZCm5ZKMdGlueee7hOS7tueahGNzc+agt+W8j+WGmeazleacieWFs+OAglxyXG4gICAgICog5Li65LqG57uf5LiA6YC76L6R5ZKM6aKE5rWL77yMY2hlY2tncm91cOWSjHRyZWXnu4Tku7blhoXpg6jmnKzlupTor6Xov5nmoLfkvb/nlKjvvJrnva5pbmRldGVybWluYXRlPXRydWXml7bvvIzlkIzml7bkvJrnva5jaGVja2VkID0gZmFsc2VcclxuICAgICAqIOS9huaYr++8jOaaguaXtnRyZWXnu4Tku7bmsqHmnInov5nmoLflgZrvvIznlLFUaUNoZWNrYm94Q29tcG9uZW505p2l57qg6ZSZ44CCXHJcbiAgICAgKiBUaUNoZWNrYm94Q29tcG9uZW506KGl5YWF5pWI5p6c77yadHJlZee7hOS7ti/kuJrliqHnlKjmiLfvvIznva5pbmRldGVybWluYXRlPXRydWXml7bvvIznu4Tku7boh6rouqvkvJrnva5jaGVja2VkID0gZmFsc2VcclxuICAgICAqIOmXrumimOS6jO+8mua1j+iniOWZqOWFvOWuueaAp+mXrumimO+8mkNocm9tZS9GaXJlZm945Y2K6YCJ54K55Ye75ZCO5Y+Y5Li65YWo6YCJ77yMY2hlY2tlZOeKtuaAgeaUueWPmOOAgklF5Y2K6YCJ54K55Ye75ZCO5Y+Y5Li65LiN6YCJ77yMY2hlY2tlZOeKtuaAgeacquaUueWPmO+8jOaJgOS7peayoeaciemAmuefpWNoYW5nZeS6i+S7tuOAglxyXG4gICAgICog5L2GY2hlY2tncm91cOmcgOimgWNoYW5nZeS6i+S7tuWOu+e7tOaKpOWtkOmAiemhuVxyXG4gICAgICogVGlDaGVja2JveENvbXBvbmVudCBJReihpeWFheaViOaenO+8muebkeWQrElF55qEY2xpY2vvvIzlvZNpbmRldGVybWluYXRl5LuOdHJ1ZeWPmOS4umZhbHNl5pe277yM57uE5Lu25Lya572uY2hlY2tlZCA9IGZhbHNl77yM5bm26YCa55+lY2hhbmdl5LqL5Lu244CCXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgbGFzdEluZGV0ZXJtaW5hdGU6IGJvb2xlYW4gPSB1bmRlZmluZWQ7XHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdDaGVja2VkKCk7XHJcbiAgICAgICAgLy8g6KGl5YWF5pWI5p6c77yadHJlZee7hOS7ti/kuJrliqHnlKjmiLfvvIznva5pbmRldGVybWluYXRlPXRydWXml7bvvIznu4Tku7boh6rouqvkvJrnva5jaGVja2VkID0gZmFsc2VcclxuICAgICAgICBpZiAodGhpcy5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sYXN0SW5kZXRlcm1pbmF0ZSA9IHRoaXMubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBJReihpeWFheaViOaenO+8muebkeWQrElF55qEY2xpY2vvvIzlvZNpbmRldGVybWluYXRl5LuOdHJ1ZeWPmOS4umZhbHNl5pe277yM57uE5Lu25Lya572uY2hlY2tlZCA9IGZhbHNl77yM5bm26YCa55+lY2hhbmdl5LqL5Lu244CCXHJcbiAgICAgKi9cclxuICAgIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSkgcHVibGljIG9uSG9zdENsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKFRpQnJvd3Nlci5pc0lFKCkgJiYgdGhpcy5sYXN0SW5kZXRlcm1pbmF0ZSAmJiAhdGhpcy5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2VkKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOiuvue9rmNoZWNrZWTlsZ7mgKfvvIxpbmRldGVybWluYXRl77yM5ZCM5pe25Y+v6IO96Kem5Y+RY2hhbmdl5LqL5Lu244CCXHJcbiAgICAgKiDku6XlkI7lj6/ku6XogIPomZHlvIDmlL7ov5nkuKrmjqXlj6PvvIznu5nnlKjmiLfosIPnlKhcclxuICAgICAqIEBwcm90ZWN0ZWRcclxuICAgICAqIEBwYXJhbSBjaGVja2VkIHRydWUvZmFsc2Uv5Y2K6YCJICAg5Y2K6YCJ55SoJ2luZGV0ZXJtaW5hdGUn5oiWbnVsbFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgY2hlY2tlZChjaGVja2VkOiBib29sZWFufCdpbmRldGVybWluYXRlJyk6IHZvaWQge1xyXG5cclxuICAgICAgICBjb25zdCBsYXN0Q2hlY2tlZDogYm9vbGVhbiA9IHRoaXMubmF0aXZlRWxlbWVudC5jaGVja2VkO1xyXG4gICAgICAgIGNvbnN0IGxhc3RJbmRldGVybWluYXRlOiBib29sZWFuID0gKHRoaXMubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID09PSB0cnVlKSA/IHRydWUgOiBmYWxzZTsgLy8g5bCGdW5kZWZpbmVk5Lmf6L2s5Li6ZmFsc2XjgIJcclxuICAgICAgICBzd2l0Y2ggKGNoZWNrZWQpIHtcclxuICAgICAgICAgICAgY2FzZSB0cnVlOiAvLyDlhajpgIlcclxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlRWxlbWVudC5jaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBmYWxzZTogLy8g5YWo5LiN6YCJXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIG51bGw6IC8vIOWNiumAiVxyXG4gICAgICAgICAgICBjYXNlICdpbmRldGVybWluYXRlJzogLy8g5Y2K6YCJXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlOyAvLyBUT0RPOiDkuLrkuobkv53or4FJReS4i+eCueWHu+WNiumAieWQju+8jOWPmOS4uuWFqOmAie+8jOi/memHjOiuvmZhbHNl44CC5pyq6aqM6K+B44CCXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuaW5kZXRlcm1pbmF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDogLy8g5LiN5Lya6LWw5Yiw6L+Z6YeM44CCXHJcbiAgICAgICAgICAgICAgICBUaUxvZy5lcnJvcignc2V0Q2hlY2tlZCgpLHN3aXRjaCBkZWZhdWx0LCBjYW4gbm90IHJlYWNoIGNvZGUnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpbmRldGVybWluYXRl5Yid5aeL5pe25Li6dW5kZWZpbmVk44CCXHJcbiAgICAgICAgaWYgKHRoaXMubmF0aXZlRWxlbWVudC5jaGVja2VkICE9PSBsYXN0Q2hlY2tlZCB8fCB0aGlzLm5hdGl2ZUVsZW1lbnQuaW5kZXRlcm1pbmF0ZSAhPT0gbGFzdEluZGV0ZXJtaW5hdGUpIHtcclxuICAgICAgICAgICAgVXRpbC50cmlnZ2VyKHRoaXMubmF0aXZlRWxlbWVudCwgJ2NoYW5nZScpOyAvLyDlv4XpobvkuLvliqjop6blj5FjaGFuZ2Xkuovku7bvvIzlkKbliJluZ01vZGVs5LiN5pu05paw44CC5Lmf6LWw5LiN5YiwY2hhbmdl5Zue6LCD44CCXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19