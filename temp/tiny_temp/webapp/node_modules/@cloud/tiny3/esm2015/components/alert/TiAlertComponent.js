import { Component, EventEmitter, Input, Output, ElementRef, Renderer2, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { TiBaseComponent } from '../base/TiBaseModule';
import { Util } from '../../utils/Util';
/**
 * Alert组件用于消息提示，提供了四种类型
 *
 * <example-url>../tiny3demo/#/alert/alert-all</example-url>
 */
export class TiAlertComponent extends TiBaseComponent {
    constructor(hostRef, renderer, document) {
        super(hostRef, renderer);
        this.hostRef = hostRef;
        this.renderer = renderer;
        this.document = document;
        /**
         * 是否显示左侧提示类型图标
         */
        this.typeIcon = true;
        /**
         * 是否显示关闭按钮
         */
        this.closeIcon = true;
        /**
         * 是否触发下拉类组件消失的事件，适用于alert的呈现状态影响页面下拉类组件位置的场景
         */
        this.triggerScroll = false;
        /**
         * 弹框类型
         */
        this.type = 'success';
        /**
         * 样式大小
         */
        this.size = 'normal';
        this.isOpen = true;
        /**
         * 是否为深色背景提示框
         */
        this.darkTheme = false;
        /**
         * @ignore
         * 是否设置阴影，组件规范定义无阴影（页面级及卡片内）
         */
        this.boxShadow = false;
        /**
         * open状态变化事件，点击关闭按钮或延时消失时都会触发
         */
        this.openChange = new EventEmitter();
    }
    /* tslint:disable:no-redundant-jsdoc */
    /**
     * 用于设置弹框是否弹出，可动态修改，默认值为true
     *
     * **请注意：动态修改情况下，需要设置为双向绑定，以确保组件延迟消失时open状态的正确感知**
     *
     * @type：boolean
     *
     */
    get open() {
        return this.isOpen;
    }
    /**
     * @ignore
     */
    set open(value) {
        if (value === this.open) {
            return;
        }
        if (value) { // 值为true时，才会延迟关闭
            this.dismissOnTime();
        }
        else { // 值为false时，关闭时清除定时器
            this.clearTimeout();
        }
        // open动态修改均涉及tiScroll事件
        this.triggerScrollEvent();
        this.isOpen = value;
    }
    ngOnInit() {
        super.ngOnInit();
        // 初始open值为true时，设置延时关闭
        if (this.open) {
            this.dismissOnTime();
        }
    }
    ngOnDestroy() {
        if (this.timeoutId !== undefined) {
            clearTimeout(this.timeoutId);
            if (this.open) {
                this.close();
            }
        }
    }
    /**
     * @ignore
     * alert呈现后，处理多长时间后消失
     */
    dismissOnTime() {
        // 未配置消失时间或当前已处于隐藏状态，则不做处理
        if (isNaN(this.dismissOnTimeout)) {
            return;
        }
        this.timeoutId = setTimeout(() => {
            this.close();
        }, this.dismissOnTimeout);
    }
    /**
     * @ignore
     * 关闭alert方法，供内部关闭调用
     */
    close() {
        this.open = false;
        this.openChange.emit(this.open); // 及时通知open状态，确保open状态双向绑定功能正常
    }
    /**
     * @ignore
     * alert出现或者消失时，可能会触发页面滚动，此时需要触发tiScroll事件通知相关组件
     */
    triggerScrollEvent() {
        if (!this.triggerScroll) {
            return;
        }
        setTimeout(() => {
            Util.trigger(this.document, 'tiScroll');
        }, 0);
    }
    clearTimeout() {
        if (this.timeoutId !== undefined) {
            clearTimeout(this.timeoutId);
        }
    }
}
TiAlertComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-alert',
                template: "<div class=\"ti3-alert-container\"\r\n     *ngIf=\"open\"\r\n     [ngClass]=\"{'ti3-alert-prompt-container': type === 'prompt',\r\n             'ti3-alert-error-container': type === 'error',\r\n             'ti3-alert-warn-container': type === 'warn',\r\n             'ti3-alert-success-container': type === 'success',\r\n             'ti3-alert-simple-container': type === 'simple',\r\n             'ti3-alert-box-shadow': boxShadow,\r\n             'ti3-alert-dark-theme': darkTheme,\r\n             'ti3-alert-size-small': size === 'small'}\">\r\n    <span class=\"ti3-alert-circle\" *ngIf=\"(type === 'prompt' || type === 'error' || type === 'success') && typeIcon\"><!--\r\n --><span class=\"ti3-icon\"\r\n          [ngClass]=\"{'ti3-icon-alert-prompt': type === 'prompt',\r\n                     'ti3-icon-alert-warn': type === 'error',\r\n                     'ti3-icon-alert-success': type === 'success'}\"></span><!--\r\n --></span><!--\r\n --><span class=\"ti3-icon ti3-icon-alert-warn-bg ti3-alert-warn-bg\" *ngIf=\"type === 'warn' && typeIcon\"><!--\r\n        --><span class=\"ti3-icon ti3-icon-alert-warn ti3-alert-warn-icon\" ></span>\r\n     </span><!--\r\n --><div class=\"ti3-alert-label\"\r\n        [ngClass]=\"{'ti3-alert-label-with-closeIcon': closeIcon && (!typeIcon || type === 'simple'),\r\n                    'ti3-alert-label-with-typeIcon': !closeIcon && typeIcon && type !== 'simple',\r\n                    'ti3-alert-only-label': !closeIcon && (!typeIcon || type === 'simple')}\"\r\n                    [id]=\"appendId('label')\">\r\n        <ng-content></ng-content>\r\n    </div><!--\r\n --><span class=\"ti3-alert-close-icon ti3-icon ti3-icon-close\"\r\n         *ngIf=\"closeIcon\"\r\n         (click)=\"close()\"\r\n         [tabindex]=\"0\"\r\n         tiOutline\r\n         (keydown.enter)=\"close()\"\r\n          [id]=\"appendId('alert_close_icon')\"></span>\r\n</div>",
                styles: ["::ng-deep :root{--ti-alert-label-line-height-value:calc(var(--ti-common-line-height-number)*var(--ti-common-font-size-base));--ti-alert-padding-horizon:15px;--ti-alert-padding-vertical:11px;--ti-alert-small-padding-vertical:7px;--ti-alert-type-icon-vertical-align:top}:host{display:block;width:var(--ti-alert-default-width)}.ti3-alert-container{-ms-box-sizing:border-box;border:1px solid;border-radius:var(--ti-alert-box-radius);box-sizing:border-box;font-weight:400;padding:var(--ti-alert-padding-vertical) var(--ti-alert-padding-horizon);width:100%}.ti3-alert-container.ti3-alert-dark-theme{background:var(--ti-alert-dark-bg-color);border:none}.ti3-alert-container.ti3-alert-dark-theme .ti3-alert-label{color:var(--ti-common-color-text-gray)}.ti3-alert-container.ti3-alert-dark-theme .ti3-alert-close-icon{color:var(--ti-common-color-icon-darkbg-normal)}.ti3-alert-container.ti3-alert-size-small{padding:var(--ti-alert-small-padding-vertical) var(--ti-alert-padding-horizon)}.ti3-alert-error-container{background:var(--ti-alert-error-bg-color);border-color:var(--ti-alert-error-border-color)}.ti3-alert-error-container .ti3-alert-circle{background:var(--ti-alert-error-icon-color)}.ti3-alert-prompt-container{background:var(--ti-alert-prompt-bg-color);border-color:var(--ti-alert-prompt-border-color)}.ti3-alert-prompt-container .ti3-alert-circle{background:var(--ti-alert-prompt-icon-color)}.ti3-alert-warn-container{background:var(--ti-alert-warn-bg-color);border-color:var(--ti-alert-warn-border-color)}.ti3-alert-success-container{background:var(--ti-alert-success-bg-color);border-color:var(--ti-alert-success-border-color)}.ti3-alert-success-container .ti3-alert-circle{background:var(--ti-alert-success-close-color)}.ti3-alert-simple-container{border-color:var(--ti-alert-simple-border-color)}.ti3-alert-success-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-success-box-shadow)}.ti3-alert-error-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-error-box-shadow)}.ti3-alert-prompt-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-prompt-box-shadow)}.ti3-alert-warn-container.ti3-alert-box-shadow{box-shadow:var(--ti-alert-warn-box-shadow)}.ti3-alert-dark-theme.ti3-alert-box-shadow{box-shadow:var(--ti-alert-dark-box-shadow)}.ti3-alert-circle{border-radius:50%;color:var(--ti-common-color-icon-white);height:var(--ti-alert-type-icon-width);line-height:var(--ti-alert-type-icon-width);text-align:center;width:var(--ti-alert-type-icon-width)}.ti3-alert-circle,.ti3-alert-warn-bg{display:inline-block;margin:calc((var(--ti-alert-label-line-height-value) - var(--ti-alert-type-icon-width))/2) var(--ti-alert-type-icon-margin-right) 0 0;vertical-align:var(--ti-alert-type-icon-vertical-align)}.ti3-alert-warn-bg{color:var(--ti-alert-warn-icon-color);font-size:var(--ti-alert-type-icon-width);position:relative}.ti3-alert-warn-icon{bottom:1px;color:var(--ti-common-color-icon-white);font-size:var(--ti-common-font-size-base);left:calc((var(--ti-alert-type-icon-width) - var(--ti-common-font-size-base))/2);position:absolute}.ti3-alert-label{color:var(--ti-alert-label-color);display:inline-block;line-height:var(--ti-common-line-height-number);overflow-wrap:break-word;width:calc(100% - var(--ti-alert-type-icon-width) - var(--ti-alert-close-icon-width) - var(--ti-alert-type-icon-margin-right) - var(--ti-alert-close-icon-margin-left));word-wrap:break-word}.ti3-alert-label.ti3-alert-label-with-closeIcon{width:calc(100% - var(--ti-alert-close-icon-width) - var(--ti-alert-close-icon-margin-left))}.ti3-alert-label.ti3-alert-label-with-typeIcon{width:calc(100% - var(--ti-alert-type-icon-width) - var(--ti-alert-type-icon-margin-right))}.ti3-alert-label.ti3-alert-only-label{width:100%}.ti3-alert-close-icon{cursor:pointer;display:inline-block;line-height:var(--ti-common-line-height-number);margin-left:var(--ti-alert-close-icon-margin-left);vertical-align:top;width:var(--ti-alert-close-icon-width)}.ti3-alert-error-container .ti3-alert-close-icon{color:var(--ti-alert-error-close-color)}.ti3-alert-prompt-container .ti3-alert-close-icon{color:var(--ti-alert-prompt-close-color)}.ti3-alert-success-container .ti3-alert-close-icon{color:var(--ti-alert-success-close-color)}.ti3-alert-warn-container .ti3-alert-close-icon{color:var(--ti-alert-warn-close-color)}.ti3-alert-simple-container .ti3-alert-close-icon{color:var(--ti-alert-simple-close-color)}"]
            },] }
];
TiAlertComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
TiAlertComponent.propDecorators = {
    typeIcon: [{ type: Input }],
    closeIcon: [{ type: Input }],
    dismissOnTimeout: [{ type: Input }],
    triggerScroll: [{ type: Input }],
    type: [{ type: Input }],
    size: [{ type: Input }],
    darkTheme: [{ type: Input }],
    boxShadow: [{ type: Input }],
    open: [{ type: Input }],
    openChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlBbGVydENvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My9jb21wb25lbnRzL2FsZXJ0L1RpQWxlcnRDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUd4Qzs7OztHQUlHO0FBT0gsTUFBTSxPQUFPLGdCQUFpQixTQUFRLGVBQWU7SUEwRWpELFlBQXNCLE9BQW1CLEVBQVksUUFBbUIsRUFBNEIsUUFBUTtRQUN4RyxLQUFLLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRFAsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFZLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBNEIsYUFBUSxHQUFSLFFBQVEsQ0FBQTtRQXpFNUc7O1dBRUc7UUFDTSxhQUFRLEdBQVksSUFBSSxDQUFDO1FBQ2xDOztXQUVHO1FBQ00sY0FBUyxHQUFZLElBQUksQ0FBQztRQUtuQzs7V0FFRztRQUNNLGtCQUFhLEdBQVksS0FBSyxDQUFDO1FBQ3hDOztXQUVHO1FBQ00sU0FBSSxHQUErQyxTQUFTLENBQUM7UUFDdEU7O1dBRUc7UUFDTSxTQUFJLEdBQXVCLFFBQVEsQ0FBQztRQUNyQyxXQUFNLEdBQVksSUFBSSxDQUFDO1FBQy9COztXQUVHO1FBQ00sY0FBUyxHQUFZLEtBQUssQ0FBQztRQUNwQzs7O1dBR0c7UUFDTSxjQUFTLEdBQVcsS0FBSyxDQUFDO1FBa0NuQzs7V0FFRztRQUNnQixlQUFVLEdBQTBCLElBQUksWUFBWSxFQUFFLENBQUM7SUFLMUUsQ0FBQztJQXpDRCx1Q0FBdUM7SUFDdkM7Ozs7Ozs7T0FPRztJQUNILElBS0ksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBQ0Q7O09BRUc7SUFDSCxJQUFJLElBQUksQ0FBQyxLQUFjO1FBQ25CLElBQUksS0FBSyxLQUFLLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDckIsT0FBTztTQUNWO1FBQ0QsSUFBSSxLQUFLLEVBQUUsRUFBQyxpQkFBaUI7WUFDekIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ3hCO2FBQU0sRUFBQyxvQkFBb0I7WUFDeEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3ZCO1FBQ0Qsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7SUFXRCxRQUFRO1FBQ0osS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLHVCQUF1QjtRQUN2QixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDWCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDeEI7SUFDTCxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7WUFDOUIsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM3QixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQ1gsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ2hCO1NBQ0o7SUFDTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsYUFBYTtRQUNULDBCQUEwQjtRQUMxQixJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtZQUM5QixPQUFPO1NBQ1Y7UUFDRCxJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDN0IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2pCLENBQUMsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0gsS0FBSztRQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLDhCQUE4QjtJQUNuRSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDckIsT0FBTztTQUNWO1FBQ0QsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUM1QyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDVixDQUFDO0lBRU8sWUFBWTtRQUNoQixJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFO1lBQzlCLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDaEM7SUFDTCxDQUFDOzs7WUE1SUosU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxVQUFVO2dCQUNwQixnNERBQTJCOzthQUU1Qjs7O1lBZmdELFVBQVU7WUFBRSxTQUFTOzRDQTJGUyxNQUFNLFNBQUMsUUFBUTs7O3VCQXRFekYsS0FBSzt3QkFJTCxLQUFLOytCQUlMLEtBQUs7NEJBSUwsS0FBSzttQkFJTCxLQUFLO21CQUlMLEtBQUs7d0JBS0wsS0FBSzt3QkFLTCxLQUFLO21CQVVMLEtBQUs7eUJBMkJMLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBUaUJhc2VDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi91dGlscy9VdGlsJztcclxuXHJcblxyXG4vKipcclxuICogQWxlcnTnu4Tku7bnlKjkuo7mtojmga/mj5DnpLrvvIzmj5Dkvpvkuoblm5vnp43nsbvlnotcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL2FsZXJ0L2FsZXJ0LWFsbDwvZXhhbXBsZS11cmw+XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3RpLWFsZXJ0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYWxlcnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYWxlcnQubGVzcyddXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgVGlBbGVydENvbXBvbmVudCBleHRlbmRzIFRpQmFzZUNvbXBvbmVudCB7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYvuekuuW3puS+p+aPkOekuuexu+Wei+Wbvuagh1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0eXBlSWNvbjogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYvuekuuWFs+mXreaMiemSrlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBjbG9zZUljb246IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmL7npLrlpJrplb/ml7bpl7TlkI7mtojlpLHvvIzpu5jorqTkuI3lu7bov5/mtojlpLHvvIzlj6rlnKjngrnlh7vlhbPpl63mjInpkq7ml7bmtojlpLFcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgZGlzbWlzc09uVGltZW91dDogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbop6blj5HkuIvmi4nnsbvnu4Tku7bmtojlpLHnmoTkuovku7bvvIzpgILnlKjkuo5hbGVydOeahOWRiOeOsOeKtuaAgeW9seWTjemhtemdouS4i+aLieexu+e7hOS7tuS9jee9rueahOWcuuaZr1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0cmlnZ2VyU2Nyb2xsOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIOW8ueahhuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSB0eXBlOiAnc3VjY2Vzcyd8J2Vycm9yJ3wnd2Fybid8J3Byb21wdCd8J3NpbXBsZScgPSAnc3VjY2Vzcyc7XHJcbiAgICAvKipcclxuICAgICAqIOagt+W8j+Wkp+Wwj1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzaXplOiAnbm9ybWFsJyB8ICdzbWFsbCcgPSAnbm9ybWFsJztcclxuICAgIHByaXZhdGUgaXNPcGVuOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5Li65rex6Imy6IOM5pmv5o+Q56S65qGGXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGRhcmtUaGVtZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiDmmK/lkKborr7nva7pmLTlvbHvvIznu4Tku7bop4TojIPlrprkuYnml6DpmLTlvbHvvIjpobXpnaLnuqflj4rljaHniYflhoXvvIlcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgYm94U2hhZG93OmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8qIHRzbGludDpkaXNhYmxlOm5vLXJlZHVuZGFudC1qc2RvYyAqL1xyXG4gICAgLyoqXHJcbiAgICAgKiDnlKjkuo7orr7nva7lvLnmoYbmmK/lkKblvLnlh7rvvIzlj6/liqjmgIHkv67mlLnvvIzpu5jorqTlgLzkuLp0cnVlXHJcbiAgICAgKlxyXG4gICAgICogKiror7fms6jmhI/vvJrliqjmgIHkv67mlLnmg4XlhrXkuIvvvIzpnIDopoHorr7nva7kuLrlj4zlkJHnu5HlrprvvIzku6Xnoa7kv53nu4Tku7blu7bov5/mtojlpLHml7ZvcGVu54q25oCB55qE5q2j56Gu5oSf55+lKipcclxuICAgICAqXHJcbiAgICAgKiBAdHlwZe+8mmJvb2xlYW5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICAvLyDnlLHkuo7lhoXpg6gv5aSW6YOo6K6+572ub3BlbumDveS8muaJp+ihjOWQjOagt+eahOmAu+i+ke+8jOWboOatpOS9v+eUqHNldC9nZXRcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBnZXQgb3BlbigpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pc09wZW47XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgc2V0IG9wZW4odmFsdWU6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodmFsdWUgPT09IHRoaXMub3Blbikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2YWx1ZSkgey8vIOWAvOS4unRydWXml7bvvIzmiY3kvJrlu7bov5/lhbPpl61cclxuICAgICAgICAgICAgdGhpcy5kaXNtaXNzT25UaW1lKCk7XHJcbiAgICAgICAgfSBlbHNlIHsvLyDlgLzkuLpmYWxzZeaXtu+8jOWFs+mXreaXtua4hemZpOWumuaXtuWZqFxyXG4gICAgICAgICAgICB0aGlzLmNsZWFyVGltZW91dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBvcGVu5Yqo5oCB5L+u5pS55Z2H5raJ5Y+KdGlTY3JvbGzkuovku7ZcclxuICAgICAgICB0aGlzLnRyaWdnZXJTY3JvbGxFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuaXNPcGVuID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIG9wZW7nirbmgIHlj5jljJbkuovku7bvvIzngrnlh7vlhbPpl63mjInpkq7miJblu7bml7bmtojlpLHml7bpg73kvJrop6blj5FcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpIHJlYWRvbmx5IG9wZW5DaGFuZ2U6IEV2ZW50RW1pdHRlcjxCb29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHByaXZhdGUgdGltZW91dElkOiBhbnk7IC8vIOWGhemDqOWPmOmHj++8jOWtmOWCqOWumuaXtuWZqElEXHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGhvc3RSZWY6IEVsZW1lbnRSZWYsIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyLCBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50KSB7XHJcbiAgICAgICAgc3VwZXIoaG9zdFJlZiwgcmVuZGVyZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgLy8g5Yid5aeLb3BlbuWAvOS4unRydWXml7bvvIzorr7nva7lu7bml7blhbPpl61cclxuICAgICAgICBpZiAodGhpcy5vcGVuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzbWlzc09uVGltZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy50aW1lb3V0SWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SWQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vcGVuKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBhbGVydOWRiOeOsOWQju+8jOWkhOeQhuWkmumVv+aXtumXtOWQjua2iOWksVxyXG4gICAgICovXHJcbiAgICBkaXNtaXNzT25UaW1lKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIOacqumFjee9rua2iOWkseaXtumXtOaIluW9k+WJjeW3suWkhOS6jumakOiXj+eKtuaAge+8jOWImeS4jeWBmuWkhOeQhlxyXG4gICAgICAgIGlmIChpc05hTih0aGlzLmRpc21pc3NPblRpbWVvdXQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH0sIHRoaXMuZGlzbWlzc09uVGltZW91dCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIOWFs+mXrWFsZXJ05pa55rOV77yM5L6b5YaF6YOo5YWz6Zet6LCD55SoXHJcbiAgICAgKi9cclxuICAgIGNsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMub3BlbkNoYW5nZS5lbWl0KHRoaXMub3Blbik7IC8vIOWPiuaXtumAmuefpW9wZW7nirbmgIHvvIznoa7kv51vcGVu54q25oCB5Y+M5ZCR57uR5a6a5Yqf6IO95q2j5bi4XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBhbGVydOWHuueOsOaIluiAhea2iOWkseaXtu+8jOWPr+iDveS8muinpuWPkemhtemdoua7muWKqO+8jOatpOaXtumcgOimgeinpuWPkXRpU2Nyb2xs5LqL5Lu26YCa55+l55u45YWz57uE5Lu2XHJcbiAgICAgKi9cclxuICAgIHRyaWdnZXJTY3JvbGxFdmVudCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJpZ2dlclNjcm9sbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBVdGlsLnRyaWdnZXIodGhpcy5kb2N1bWVudCwgJ3RpU2Nyb2xsJyk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhclRpbWVvdXQoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZW91dElkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19