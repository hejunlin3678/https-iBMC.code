import { Component, ElementRef, EventEmitter, Input, Output, Renderer2, ViewChild } from '@angular/core';
import { TiLocaleFormat } from '../../locale/TiLocaleModule';
import { TiKeymap, Util } from '../../utils/Util';
import { TiFormComponent } from '../base/TiBaseModule';
/**
 * 数字微调组件
 *
 * <example-url>../tiny3demo/#/spinner/spinner-all</example-url>
 */
export class TiSpinnerComponent extends TiFormComponent {
    constructor(hostRef, renderer2) {
        super(hostRef, renderer2);
        this.hostRef = hostRef;
        this.renderer2 = renderer2;
        /**
         * @ignore
         */
        this.method = {
            METHOD_ADD: 'add',
            METHOD_SUB: 'sub'
        };
        /**
         * 最大值，JS中能表示的整数范围是53位的，如果超过了这个范围的整数，进行一些运算时会出现错误，因此最大值为2^53
         */
        this.max = Math.pow(2, 53);
        /**
         * 最小值，JS中能表示的整数范围是53位的，如果超过了这个范围的整数，进行一些运算时会出现错误，因此最小值为-2^53
         */
        this.min = -Math.pow(2, 53);
        /**
         * 微调器的步长
         */
        this.step = 1;
        /**
         * 占位提示信息
         */
        this.placeholder = '';
        /**
         * @ignore
         *
         * 从10.0.1版本开始该接口不再开放。如果不想要组件根据最大最小值进行强制转换，那么不要设置最大最小值即可。
         *
         * 失去焦点是否支持根据最大最小值进行强制转换（默认值为true, 支持强转; 当用户配置为false时，不支持强制转换）
         */
        this.correctable = true;
        /**
         * 是否开启国际化。默认值为true,开启国际化功能; 当用户配置为false时，不支持国际化)
         */
        this.localeable = true;
        /**
         * 输入文本的最大长度， 默认值为20.
         */
        this.maxlength = 20;
        /**
         * @ignore
         * 当数据发生改变时，触发change事件
         */
        // tslint:disable-next-line:no-output-named-after-standard-event
        this.stepChange = new EventEmitter();
        this.numberFormat = '1.0-3'; // 整数位保留最小位数.小数位保留最小位数-小数位最大保留位置
    }
    // 组件声明周期钩子--start ↓
    ngOnInit() {
        super.ngOnInit();
        this.setFocusableElems([this.inputEle.nativeElement]);
        this.init();
    }
    init() {
        if (!TiLocaleFormat.isInvalidFormat(this.format)) {
            const precision = parseInt(this.format.slice(1), 10);
            // tslint:disable-next-line:prefer-template
            this.numberFormat = '1.' + precision + '-' + precision;
        }
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        this.setChanges(changes, 'max');
        this.setChanges(changes, 'min');
    }
    // 输入属性发生改变
    setChanges(changes, key) {
        if (changes[key] && !changes[key].isFirstChange()) {
            this[key] = parseFloat(changes[key].currentValue);
            if (Number.isNaN(this[key]) || this.min > this.max) {
                this[key] = parseFloat(changes[key].previousValue);
            }
            if (this.correctable && this.model !== undefined) {
                const model = this.getModelByMinMax(this.inputValue);
                if (model !== this.model) {
                    // error: Expression has changed after it was checked.
                    setTimeout(() => {
                        this.inputValue = model;
                        this.model = model;
                    }, 0);
                }
            }
        }
    }
    // 组件声明周期钩子--end
    // 实现ControlValueAccessor接口
    /**
     * @ignore
     * model --> view
     */
    writeValue(value) {
        if (value === null) {
            return;
        }
        super.writeValue(value);
        if (!Util.isUndefined(value)) {
            if (Number.isNaN(parseFloat(value))) {
                this.model = this.inputValue;
                return;
            }
            if (this.correctable) {
                const val = this.getModelByMinMax(value);
                this.model = val;
                this.inputValue = val;
                return;
            }
        }
        this.inputValue = value;
    }
    // 实现ControlValueAccessor接口--end
    /**
     * @ignore
     */
    blurFn() {
        let correctValue = this.inputValue;
        if (this.correctable && this.inputValue !== undefined) {
            correctValue = this.getModelByMinMax(this.inputValue);
        }
        const parseFormatValue = correctValue === undefined ? correctValue : parseFloat(this.formatValue(correctValue));
        if (parseFormatValue !== this.model) {
            this.model = parseFormatValue;
        }
        this.inputValue = this.model;
        this.onModelTouched(); // 校验 初次聚焦 后续聚焦失焦
    }
    /**
     * @ignore
     * description: Event emitter for producting the `ngModelChange` event after the view model updates.
     * ngModelChange 是ngModel指令的@Output.
     * 它在viewToModelUpdate函数中触发
     *
     */
    inputChange(value) {
        if (value !== undefined && (value < this.min || value > this.max)) {
            return;
        }
        const parseFormatValue = value === undefined ? value : parseFloat(this.formatValue(value));
        if (parseFormatValue !== this.model) {
            this.model = parseFormatValue;
        }
    }
    /**
     * 键盘上下键操作
     * @ignore
     */
    keydownFn(event) {
        if (this.disabled) {
            return;
        }
        if (event.keyCode === TiKeymap.KEY_ARROW_UP) {
            this.stepNumber(this.method.METHOD_ADD);
        }
        else if (event.keyCode === TiKeymap.KEY_ARROW_DOWN) {
            this.stepNumber(this.method.METHOD_SUB);
        }
    }
    /**
     * @ignore
     */
    stepNumberMousedown(e, method) {
        if (e.button === TiKeymap.MOUSE_MIDDLE_BUTTON || e.button === TiKeymap.MOUSE_RIGHT_BUTTON || this.disabled) {
            return;
        }
        // 如果是鼠标按下向下btn，输入框需要做获得光标的处理
        this.inputEle.nativeElement.focus();
        e.preventDefault(); // 目的是防止input失去焦点
        this.stepNumber(method);
    }
    stepNumber(method) {
        if ((this.inputValue >= this.max && method === this.method.METHOD_ADD) ||
            (this.inputValue <= this.min && method === this.method.METHOD_SUB)) {
            return;
        }
        this.stepChange.emit(method);
        // 当输入框中的值为空时，点击+,-，显示最小值。
        if (this.inputValue === undefined) {
            this.model = this.min;
            this.inputValue = this.model;
            return;
        }
        if (method === this.method.METHOD_ADD) {
            if (this.inputValue > this.max - this.step) {
                this.model = this.max;
                this.inputValue = this.model;
                return;
            }
            if (this.inputValue < this.min) {
                this.model = this.min;
                this.inputValue = this.model;
                return;
            }
        }
        else if (method === this.method.METHOD_SUB) {
            if (this.inputValue < this.min + this.step) {
                this.model = this.min;
                this.inputValue = this.model;
                return;
            }
            if (this.inputValue > this.max) {
                this.model = this.max;
                this.inputValue = this.model;
                return;
            }
        }
        this.model = this.accOperate(this.inputValue, this.step, method);
        this.inputValue = this.model;
    }
    // 组件交互方法集合--end
    // 根据最大最小值得到model值
    getModelByMinMax(curValue) {
        if (curValue < this.min) {
            return this.min;
        }
        if (curValue > this.max) {
            return this.max;
        }
        return curValue;
    }
    formatValue(value) {
        if (value === undefined) {
            return;
        }
        // https://angular.cn/api/common/DecimalPipe
        // digitsInfo: {minIntegerDigits}.{minFractionDigits}-{maxFractionDigits}
        // minIntegerDigits: 小数点前最小位数 默认为1
        // minFractionDigits: 小数点后最小位数 默认0
        // maxFractionDigits: 小数点后最大位数 默认3
        // tslint:disable-next-line:prefer-template
        const localeValue = TiLocaleFormat.formatNumber(value, this.numberFormat);
        return TiLocaleFormat.parseNumber(localeValue).toString();
    }
    // 根据步长、+/-进行数值计算
    accOperate(value, step, method) {
        let r1;
        let r2;
        let c;
        let m;
        let _value;
        let _step;
        // 计算 val 小数点后数字的位数
        const getLength = (val) => {
            return (String(val)).split('.')[1] ? (String(val)).split('.')[1].length : 0;
        };
        // 去除 val 中的 ‘.’
        const replacePeriod = (val) => {
            return Number((String(val)).replace('.', ''));
        };
        r1 = getLength(value);
        r2 = getLength(step);
        c = Math.abs(r1 - r2);
        m = Math.pow(10, Math.max(r1, r2));
        if (c > 0) {
            const cm = Math.pow(10, c);
            if (r1 > r2) {
                _value = replacePeriod(value);
                _step = replacePeriod(step) * cm;
            }
            else {
                _value = replacePeriod(value) * cm;
                _step = replacePeriod(step);
            }
        }
        else {
            _value = replacePeriod(value);
            _step = replacePeriod(step);
        }
        if (method === this.method.METHOD_ADD) {
            return (_value + _step) / m;
        }
        if (method === this.method.METHOD_SUB) {
            return (_value - _step) / m;
        }
        return undefined;
    }
}
TiSpinnerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ti-spinner',
                template: "<div [id]=\"appendId('sub')\" class=\"ti3-icon ti3-spinner-downicon ti3-icon-reduce\" \r\n(mousedown)=\"stepNumberMousedown($event, method.METHOD_SUB)\"\r\n[ngClass]=\"{'ti3-spinner-icon-disabled': inputValue <= min}\"></div>\r\n<div #inputBox class=\"ti3-spinner-input-box\">\r\n    <input #input [placeholder]=\"placeholder\" [id]=\"appendId('input')\" type=\"text\" [disabled]=\"disabled\"\r\n       (blur)=\"blurFn()\"\r\n       [(ngModel)]=\"inputValue\" (ngModelChange)=\"inputChange($event)\" (keydown) = \"keydownFn($event)\"\r\n       [format]=\"format\" [localeable] = \"localeable\"\r\n       class=\"ti3-spinner-input\" [maxlength]=\"maxlength\" noborder tiText tiNumber/> \r\n</div>\r\n<div [id]=\"appendId('add')\" class=\"ti3-icon ti3-spinner-upicon ti3-icon-add\" \r\n(mousedown)=\"stepNumberMousedown($event, method.METHOD_ADD)\"\r\n[ngClass]=\"{'ti3-spinner-icon-disabled': inputValue >= max}\"></div>\r\n",
                providers: [TiFormComponent.getValueAccessor(TiSpinnerComponent)],
                styles: ["::ng-deep :root{--ti-spinner-inner-height:calc(var(--ti-input-height) - 2px)}:host{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);border:1px solid var(--ti-input-border-color);border-radius:var(--ti-input-border-radius);box-sizing:border-box;display:inline-block;height:var(--ti-input-height)!important;line-height:normal;position:relative;transition:border-color .15s;vertical-align:middle;white-space:normal;width:120px}:host:active{border-color:var(--ti-input-border-color-focus);cursor:pointer}:host:hover{border-color:var(--ti-input-border-color-hover);transition:border-color .2s}:host[tiFocused]{border-color:var(--ti-input-border-color-focus)}:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-downicon,:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-input,:host.ng-invalid.ng-dirty:not([tiBlurCheck]) .ti3-spinner-upicon,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-downicon,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-input,:host.ng-invalid.ng-dirty[tiBlurCheck]:not([tiFocused]) .ti3-spinner-upicon,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-downicon,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-input,:host.ng-invalid.ng-touched:not([tiBlurCheck]) .ti3-spinner-upicon,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-downicon,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-input,:host.ng-invalid.ng-touched[tiBlurCheck]:not([tiFocused]) .ti3-spinner-upicon{background-color:var(--ti-input-bg-color-error)}.ti3-spinner-input-box{-ms-box-sizing:border-box;background-color:var(--ti-input-bg-color);box-sizing:border-box;color:var(--ti-input-text-color);ime-mode:disabled;left:var(--ti-spinner-inner-height);position:absolute;text-align:center;top:0;width:calc(100% - var(--ti-spinner-inner-height)*2)}.ti3-spinner-input-box .ti3-spinner-input{height:var(--ti-spinner-inner-height);line-height:var(--ti-spinner-inner-height);text-align:center;width:100%}.ti3-spinner-downicon,.ti3-spinner-upicon{-ms-box-sizing:border-box;box-sizing:border-box;color:var(--ti-common-color-icon-normal);line-height:var(--ti-spinner-inner-height);position:absolute;text-align:center;top:0;width:var(--ti-spinner-inner-height)}.ti3-spinner-downicon:not(.ti3-spinner-icon-disabled):hover,.ti3-spinner-upicon:not(.ti3-spinner-icon-disabled):hover{background-color:var(--ti-input-bg-color);color:var(--ti-common-color-icon-hover);cursor:pointer}.ti3-spinner-downicon.ti3-spinner-icon-disabled,.ti3-spinner-upicon.ti3-spinner-icon-disabled{background-color:var(--ti-input-bg-color-disabled);color:var(--ti-common-color-icon-disabled);cursor:not-allowed}.ti3-spinner-upicon{border-left:1px solid var(--ti-input-border-color);right:0}.ti3-spinner-downicon{border-right:1px solid var(--ti-input-border-color);left:0}:host[disabled]{background-color:var(--ti-input-bg-color-disabled);cursor:not-allowed}:host[disabled],:host[disabled]:hover{border-color:var(--ti-input-border-color-disabled)!important}:host[disabled] .ti3-spinner-input{background-color:var(--ti-input-bg-color-disabled);color:var(--ti-input-text-color-disabled);cursor:not-allowed}:host[disabled] .ti3-spinner-downicon,:host[disabled] .ti3-spinner-upicon{border-color:var(--ti-input-border-color-disabled)}:host[disabled] .ti3-spinner-downicon:not(.ti3-spinner-icon-disabled),:host[disabled] .ti3-spinner-upicon:not(.ti3-spinner-icon-disabled){background-color:var(--ti-input-bg-color-disabled);color:var(--ti-common-color-icon-disabled);cursor:not-allowed}"]
            },] }
];
TiSpinnerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
TiSpinnerComponent.propDecorators = {
    format: [{ type: Input }],
    max: [{ type: Input }],
    min: [{ type: Input }],
    step: [{ type: Input }],
    placeholder: [{ type: Input }],
    correctable: [{ type: Input }],
    localeable: [{ type: Input }],
    maxlength: [{ type: Input }],
    stepChange: [{ type: Output }],
    inputEle: [{ type: ViewChild, args: ['input', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGlTcGlubmVyQ29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vQGNsb3VkL3RpbnkzL2NvbXBvbmVudHMvc3Bpbm5lci9UaVNwaW5uZXJDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUN2QyxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBaUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RDs7OztHQUlHO0FBT0gsTUFBTSxPQUFPLGtCQUFtQixTQUFRLGVBQWU7SUEyRG5ELFlBQXNCLE9BQW1CLEVBQVksU0FBb0I7UUFDckUsS0FBSyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztRQURSLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBWSxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBMUR6RTs7V0FFRztRQUNJLFdBQU0sR0FBUTtZQUNqQixVQUFVLEVBQUcsS0FBSztZQUNsQixVQUFVLEVBQUcsS0FBSztTQUNyQixDQUFDO1FBT0Y7O1dBRUc7UUFDTSxRQUFHLEdBQVcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdkM7O1dBRUc7UUFDTSxRQUFHLEdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN4Qzs7V0FFRztRQUNNLFNBQUksR0FBVyxDQUFDLENBQUM7UUFDMUI7O1dBRUc7UUFDTSxnQkFBVyxHQUFXLEVBQUUsQ0FBQztRQUNsQzs7Ozs7O1dBTUc7UUFD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bUIsVUFBVTtZQUNWLFNBQVM7OztxQkE0QnhCLEtBQUs7a0JBSUwsS0FBSztrQkFJTCxLQUFLO21CQUlMLEtBQUs7MEJBSUwsS0FBSzswQkFRTCxLQUFLO3lCQUlMLEtBQUs7d0JBSUwsS0FBSzt5QkFNTCxNQUFNO3VCQUNOLFNBQVMsU0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsXHJcbiAgICAgSW5wdXQsIE91dHB1dCwgUmVuZGVyZXIyLCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGlMb2NhbGVGb3JtYXQgfSBmcm9tICcuLi8uLi9sb2NhbGUvVGlMb2NhbGVNb2R1bGUnO1xyXG5pbXBvcnQgeyBUaUtleW1hcCwgVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxzL1V0aWwnO1xyXG5pbXBvcnQgeyBUaUZvcm1Db21wb25lbnQgfSBmcm9tICcuLi9iYXNlL1RpQmFzZU1vZHVsZSc7XHJcbi8qKlxyXG4gKiDmlbDlrZflvq7osIPnu4Tku7ZcclxuICpcclxuICogPGV4YW1wbGUtdXJsPi4uL3RpbnkzZGVtby8jL3NwaW5uZXIvc3Bpbm5lci1hbGw8L2V4YW1wbGUtdXJsPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3RpLXNwaW5uZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NwaW5uZXIuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zcGlubmVyLmxlc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1RpRm9ybUNvbXBvbmVudC5nZXRWYWx1ZUFjY2Vzc29yKFRpU3Bpbm5lckNvbXBvbmVudCldXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUaVNwaW5uZXJDb21wb25lbnQgZXh0ZW5kcyBUaUZvcm1Db21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBtZXRob2Q6IGFueSA9IHtcclxuICAgICAgICBNRVRIT0RfQUREIDogJ2FkZCcsXHJcbiAgICAgICAgTUVUSE9EX1NVQiA6ICdzdWInXHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDmlbDlrZflsI/mlbDkvY3mlbDmoLzlvI/vvIzkvb/nlKhuKyflsI/mlbDkv53nlZnkvY3mlbAn5b2i5byP6KGo56S677yM5L6L5aaC77yaJ240J+aIlidONCcs5Luj6KGo5L+d55WZNOS9jeWwj+aVsOOAglxyXG4gICAgICpcclxuICAgICAqIOiHqjEwLjAuMeeJiOacrOi1t+S4jeiuvue9ruaXtu+8jOWwj+aVsOeCueWQjum7mOiupOacgOWwkeS/neeVmTDkvY3vvIzmnIDlpJrkv53nlZkz5L2N77ybMTAuMC4w5Y+K5LmL5YmN54mI5pys6buY6K6k5L+d55WZM+S9jeOAglxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBmb3JtYXQ6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5pyA5aSn5YC877yMSlPkuK3og73ooajnpLrnmoTmlbTmlbDojIPlm7TmmK81M+S9jeeahO+8jOWmguaenOi2hei/h+S6hui/meS4quiMg+WbtOeahOaVtOaVsO+8jOi/m+ihjOS4gOS6m+i/kOeul+aXtuS8muWHuueOsOmUmeivr++8jOWboOatpOacgOWkp+WAvOS4ujJeNTNcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbWF4OiBudW1iZXIgPSBNYXRoLnBvdygyLCA1Myk7XHJcbiAgICAvKipcclxuICAgICAqIOacgOWwj+WAvO+8jEpT5Lit6IO96KGo56S655qE5pW05pWw6IyD5Zu05pivNTPkvY3nmoTvvIzlpoLmnpzotoXov4fkuobov5nkuKrojIPlm7TnmoTmlbTmlbDvvIzov5vooYzkuIDkupvov5Dnrpfml7bkvJrlh7rnjrDplJnor6/vvIzlm6DmraTmnIDlsI/lgLzkuLotMl41M1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBtaW46IG51bWJlciA9IC1NYXRoLnBvdygyLCA1Myk7XHJcbiAgICAvKipcclxuICAgICAqIOW+ruiwg+WZqOeahOatpemVv1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzdGVwOiBudW1iZXIgPSAxO1xyXG4gICAgLyoqXHJcbiAgICAgKiDljaDkvY3mj5DnpLrkv6Hmga9cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgcGxhY2Vob2xkZXI6IHN0cmluZyA9ICcnO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICog5LuOMTAuMC4x54mI5pys5byA5aeL6K+l5o6l5Y+j5LiN5YaN5byA5pS+44CC5aaC5p6c5LiN5oOz6KaB57uE5Lu25qC55o2u5pyA5aSn5pyA5bCP5YC86L+b6KGM5by65Yi26L2s5o2i77yM6YKj5LmI5LiN6KaB6K6+572u5pyA5aSn5pyA5bCP5YC85Y2z5Y+v44CCXHJcbiAgICAgKlxyXG4gICAgICog5aSx5Y6754Sm54K55piv5ZCm5pSv5oyB5qC55o2u5pyA5aSn5pyA5bCP5YC86L+b6KGM5by65Yi26L2s5o2i77yI6buY6K6k5YC85Li6dHJ1ZSwg5pSv5oyB5by66L2sOyDlvZPnlKjmiLfphY3nva7kuLpmYWxzZeaXtu+8jOS4jeaUr+aMgeW8uuWItui9rOaNou+8iVxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBjb3JyZWN0YWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuW8gOWQr+WbvemZheWMluOAgum7mOiupOWAvOS4unRydWUs5byA5ZCv5Zu96ZmF5YyW5Yqf6IO9OyDlvZPnlKjmiLfphY3nva7kuLpmYWxzZeaXtu+8jOS4jeaUr+aMgeWbvemZheWMlilcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbG9jYWxlYWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOi+k+WFpeaWh+acrOeahOacgOWkp+mVv+W6pu+8jCDpu5jorqTlgLzkuLoyMC5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgbWF4bGVuZ3RoOiBudW1iZXIgPSAyMDtcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICog5b2T5pWw5o2u5Y+R55Sf5pS55Y+Y5pe277yM6Kem5Y+RY2hhbmdl5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtbmFtZWQtYWZ0ZXItc3RhbmRhcmQtZXZlbnRcclxuICAgIEBPdXRwdXQoKSByZWFkb25seSBzdGVwQ2hhbmdlOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG4gICAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGlucHV0RWxlOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIHByaXZhdGUgbnVtYmVyRm9ybWF0OiBzdHJpbmcgPSAnMS4wLTMnOyAvLyDmlbTmlbDkvY3kv53nlZnmnIDlsI/kvY3mlbAu5bCP5pWw5L2N5L+d55WZ5pyA5bCP5L2N5pWwLeWwj+aVsOS9jeacgOWkp+S/neeVmeS9jee9rlxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnB1dFZhbHVlOiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaG9zdFJlZjogRWxlbWVudFJlZiwgcHJvdGVjdGVkIHJlbmRlcmVyMjogUmVuZGVyZXIyKSB7XHJcbiAgICAgICAgc3VwZXIoaG9zdFJlZiwgcmVuZGVyZXIyKTtcclxuICAgIH1cclxuICAgIC8vIOe7hOS7tuWjsOaYjuWRqOacn+mSqeWtkC0tc3RhcnQg4oaTXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Rm9jdXNhYmxlRWxlbXMoW3RoaXMuaW5wdXRFbGUubmF0aXZlRWxlbWVudF0pO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdCgpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIVRpTG9jYWxlRm9ybWF0LmlzSW52YWxpZEZvcm1hdCh0aGlzLmZvcm1hdCkpIHtcclxuICAgICAgICAgICAgY29uc3QgcHJlY2lzaW9uOiBudW1iZXIgPSBwYXJzZUludCh0aGlzLmZvcm1hdC5zbGljZSgxKSwgMTApO1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLXRlbXBsYXRlXHJcbiAgICAgICAgICAgIHRoaXMubnVtYmVyRm9ybWF0ID0gJzEuJyArIHByZWNpc2lvbiArICctJyArIHByZWNpc2lvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2VzLCAnbWF4Jyk7XHJcbiAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKGNoYW5nZXMsICdtaW4nKTtcclxuICAgIH1cclxuICAgIC8vIOi+k+WFpeWxnuaAp+WPkeeUn+aUueWPmFxyXG4gICAgcHJpdmF0ZSBzZXRDaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMsIGtleTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXNba2V5XSAmJiAhY2hhbmdlc1trZXldLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzW2tleV0gPSBwYXJzZUZsb2F0KGNoYW5nZXNba2V5XS5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHRoaXNba2V5XSkgfHwgdGhpcy5taW4gPiB0aGlzLm1heCkge1xyXG4gICAgICAgICAgICAgICAgdGhpc1trZXldID0gcGFyc2VGbG9hdChjaGFuZ2VzW2tleV0ucHJldmlvdXNWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29ycmVjdGFibGUgJiYgdGhpcy5tb2RlbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbDogbnVtYmVyID0gdGhpcy5nZXRNb2RlbEJ5TWluTWF4KHRoaXMuaW5wdXRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZWwgIT09IHRoaXMubW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlcnJvcjogRXhwcmVzc2lvbiBoYXMgY2hhbmdlZCBhZnRlciBpdCB3YXMgY2hlY2tlZC5cclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gbW9kZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDnu4Tku7blo7DmmI7lkajmnJ/pkqnlrZAtLWVuZFxyXG4gICAgLy8g5a6e546wQ29udHJvbFZhbHVlQWNjZXNzb3LmjqXlj6NcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICogbW9kZWwgLS0+IHZpZXdcclxuICAgICAqL1xyXG4gICAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN1cGVyLndyaXRlVmFsdWUodmFsdWUpO1xyXG5cclxuICAgICAgICBpZiAoIVV0aWwuaXNVbmRlZmluZWQodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFyc2VGbG9hdCh2YWx1ZSkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsID0gdGhpcy5pbnB1dFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jb3JyZWN0YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsOiBhbnkgPSB0aGlzLmdldE1vZGVsQnlNaW5NYXgodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHZhbDtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIC8vIOWunueOsENvbnRyb2xWYWx1ZUFjY2Vzc29y5o6l5Y+jLS1lbmRcclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYmx1ckZuKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBjb3JyZWN0VmFsdWU6IG51bWJlciA9IHRoaXMuaW5wdXRWYWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5jb3JyZWN0YWJsZSAmJiB0aGlzLmlucHV0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjb3JyZWN0VmFsdWUgPSB0aGlzLmdldE1vZGVsQnlNaW5NYXgodGhpcy5pbnB1dFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyc2VGb3JtYXRWYWx1ZTogbnVtYmVyID0gY29ycmVjdFZhbHVlID09PSB1bmRlZmluZWQgPyBjb3JyZWN0VmFsdWUgOiBwYXJzZUZsb2F0KHRoaXMuZm9ybWF0VmFsdWUoY29ycmVjdFZhbHVlKSk7XHJcbiAgICAgICAgaWYgKHBhcnNlRm9ybWF0VmFsdWUgIT09IHRoaXMubW9kZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHBhcnNlRm9ybWF0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMubW9kZWw7XHJcbiAgICAgICAgdGhpcy5vbk1vZGVsVG91Y2hlZCgpOyAvLyDmoKHpqowg5Yid5qyh6IGa54SmIOWQjue7reiBmueEpuWkseeEplxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBkZXNjcmlwdGlvbjogRXZlbnQgZW1pdHRlciBmb3IgcHJvZHVjdGluZyB0aGUgYG5nTW9kZWxDaGFuZ2VgIGV2ZW50IGFmdGVyIHRoZSB2aWV3IG1vZGVsIHVwZGF0ZXMuXHJcbiAgICAgKiBuZ01vZGVsQ2hhbmdlIOaYr25nTW9kZWzmjIfku6TnmoRAT3V0cHV0LlxyXG4gICAgICog5a6D5Zyodmlld1RvTW9kZWxVcGRhdGXlh73mlbDkuK3op6blj5FcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnB1dENoYW5nZSh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgKHZhbHVlIDwgdGhpcy5taW4gfHwgdmFsdWUgPiB0aGlzLm1heCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJzZUZvcm1hdFZhbHVlOiBudW1iZXIgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gdmFsdWUgOiBwYXJzZUZsb2F0KHRoaXMuZm9ybWF0VmFsdWUodmFsdWUpKTtcclxuICAgICAgICBpZiAocGFyc2VGb3JtYXRWYWx1ZSAhPT0gdGhpcy5tb2RlbCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGVsID0gcGFyc2VGb3JtYXRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmUruebmOS4iuS4i+mUruaTjeS9nFxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMga2V5ZG93bkZuKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBUaUtleW1hcC5LRVlfQVJST1dfVVApIHtcclxuICAgICAgICAgICAgdGhpcy5zdGVwTnVtYmVyKHRoaXMubWV0aG9kLk1FVEhPRF9BREQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gVGlLZXltYXAuS0VZX0FSUk9XX0RPV04pIHtcclxuICAgICAgICAgICAgdGhpcy5zdGVwTnVtYmVyKHRoaXMubWV0aG9kLk1FVEhPRF9TVUIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RlcE51bWJlck1vdXNlZG93bihlOiBhbnksIG1ldGhvZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGUuYnV0dG9uID09PSBUaUtleW1hcC5NT1VTRV9NSURETEVfQlVUVE9OIHx8IGUuYnV0dG9uID09PSBUaUtleW1hcC5NT1VTRV9SSUdIVF9CVVRUT04gfHwgdGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWmguaenOaYr+m8oOagh+aMieS4i+WQkeS4i2J0bu+8jOi+k+WFpeahhumcgOimgeWBmuiOt+W+l+WFieagh+eahOWkhOeQhlxyXG4gICAgICAgIHRoaXMuaW5wdXRFbGUubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8g55uu55qE5piv6Ziy5q2iaW5wdXTlpLHljrvnhKbngrlcclxuICAgICAgICB0aGlzLnN0ZXBOdW1iZXIobWV0aG9kKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0ZXBOdW1iZXIobWV0aG9kOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBpZiAoKHRoaXMuaW5wdXRWYWx1ZSA+PSB0aGlzLm1heCAmJiBtZXRob2QgPT09IHRoaXMubWV0aG9kLk1FVEhPRF9BREQpIHx8XHJcbiAgICAgICAgICAgICh0aGlzLmlucHV0VmFsdWUgPD0gdGhpcy5taW4gJiYgbWV0aG9kID09PSB0aGlzLm1ldGhvZC5NRVRIT0RfU1VCKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc3RlcENoYW5nZS5lbWl0KG1ldGhvZCk7XHJcbiAgICAgICAgLy8g5b2T6L6T5YWl5qGG5Lit55qE5YC85Li656m65pe277yM54K55Ye7Kywt77yM5pi+56S65pyA5bCP5YC844CCXHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSB0aGlzLm1pbjtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5tb2RlbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gdGhpcy5tZXRob2QuTUVUSE9EX0FERCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZhbHVlID4gdGhpcy5tYXggLSB0aGlzLnN0ZXApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwgPSB0aGlzLm1heDtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMubW9kZWw7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VmFsdWUgPCB0aGlzLm1pbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMubWluO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5tb2RlbDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCA9PT0gdGhpcy5tZXRob2QuTUVUSE9EX1NVQikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZhbHVlIDwgdGhpcy5taW4gKyB0aGlzLnN0ZXApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwgPSB0aGlzLm1pbjtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMubW9kZWw7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VmFsdWUgPiB0aGlzLm1heCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMubWF4O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5tb2RlbDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMuYWNjT3BlcmF0ZSh0aGlzLmlucHV0VmFsdWUsIHRoaXMuc3RlcCwgbWV0aG9kKTtcclxuICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSB0aGlzLm1vZGVsO1xyXG4gICAgfVxyXG4gICAgLy8g57uE5Lu25Lqk5LqS5pa55rOV6ZuG5ZCILS1lbmRcclxuXHJcbiAgICAgLy8g5qC55o2u5pyA5aSn5pyA5bCP5YC85b6X5YiwbW9kZWzlgLxcclxuICAgICBwcml2YXRlIGdldE1vZGVsQnlNaW5NYXgoY3VyVmFsdWU6IG51bWJlcik6IG51bWJlciAge1xyXG4gICAgICAgIGlmIChjdXJWYWx1ZSA8IHRoaXMubWluKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1pbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjdXJWYWx1ZSA+IHRoaXMubWF4KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1heDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjdXJWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZvcm1hdFZhbHVlKHZhbHVlOiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9hbmd1bGFyLmNuL2FwaS9jb21tb24vRGVjaW1hbFBpcGVcclxuICAgICAgICAvLyBkaWdpdHNJbmZvOiB7bWluSW50ZWdlckRpZ2l0c30ue21pbkZyYWN0aW9uRGlnaXRzfS17bWF4RnJhY3Rpb25EaWdpdHN9XHJcbiAgICAgICAgLy8gbWluSW50ZWdlckRpZ2l0czog5bCP5pWw54K55YmN5pyA5bCP5L2N5pWwIOm7mOiupOS4ujFcclxuICAgICAgICAvLyBtaW5GcmFjdGlvbkRpZ2l0czog5bCP5pWw54K55ZCO5pyA5bCP5L2N5pWwIOm7mOiupDBcclxuICAgICAgICAvLyBtYXhGcmFjdGlvbkRpZ2l0czog5bCP5pWw54K55ZCO5pyA5aSn5L2N5pWwIOm7mOiupDNcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLXRlbXBsYXRlXHJcbiAgICAgICAgY29uc3QgbG9jYWxlVmFsdWU6IHN0cmluZyA9IFRpTG9jYWxlRm9ybWF0LmZvcm1hdE51bWJlcih2YWx1ZSwgdGhpcy5udW1iZXJGb3JtYXQpO1xyXG5cclxuICAgICAgICByZXR1cm4gVGlMb2NhbGVGb3JtYXQucGFyc2VOdW1iZXIobG9jYWxlVmFsdWUpLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5qC55o2u5q2l6ZW/44CBKy8t6L+b6KGM5pWw5YC86K6h566XXHJcbiAgICBwcml2YXRlIGFjY09wZXJhdGUodmFsdWU6IG51bWJlciwgc3RlcDogbnVtYmVyLCBtZXRob2Q6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICAgICAgbGV0IHIxOiBudW1iZXI7XHJcbiAgICAgICAgbGV0IHIyOiBudW1iZXI7XHJcbiAgICAgICAgbGV0IGM6IG51bWJlcjtcclxuICAgICAgICBsZXQgbTogbnVtYmVyO1xyXG4gICAgICAgIGxldCBfdmFsdWU6IG51bWJlcjtcclxuICAgICAgICBsZXQgX3N0ZXA6IG51bWJlcjtcclxuICAgICAgICAvLyDorqHnrpcgdmFsIOWwj+aVsOeCueWQjuaVsOWtl+eahOS9jeaVsFxyXG4gICAgICAgIGNvbnN0IGdldExlbmd0aDogKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpID0+IG51bWJlciA9ICh2YWw6IHN0cmluZyk6IG51bWJlciA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKHZhbCkpLnNwbGl0KCcuJylbMV0gPyAoU3RyaW5nKHZhbCkpLnNwbGl0KCcuJylbMV0ubGVuZ3RoIDogMDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIOWOu+mZpCB2YWwg5Lit55qEIOKAmC7igJlcclxuICAgICAgICBjb25zdCByZXBsYWNlUGVyaW9kOiAodmFsdWU6IHN0cmluZyB8IG51bWJlcikgPT4gbnVtYmVyID0gKHZhbDogc3RyaW5nKTogbnVtYmVyID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIE51bWJlcigoU3RyaW5nKHZhbCkpLnJlcGxhY2UoJy4nLCAnJykpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcjEgPSBnZXRMZW5ndGgodmFsdWUpO1xyXG4gICAgICAgIHIyID0gZ2V0TGVuZ3RoKHN0ZXApO1xyXG4gICAgICAgIGMgPSBNYXRoLmFicyhyMSAtIHIyKTtcclxuICAgICAgICBtID0gTWF0aC5wb3coMTAsIE1hdGgubWF4KHIxLCByMikpO1xyXG5cclxuICAgICAgICBpZiAoYyA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgY206IG51bWJlciA9IE1hdGgucG93KDEwLCBjKTtcclxuICAgICAgICAgICAgaWYgKHIxID4gcjIpIHtcclxuICAgICAgICAgICAgICAgIF92YWx1ZSA9IHJlcGxhY2VQZXJpb2QodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgX3N0ZXAgPSByZXBsYWNlUGVyaW9kKHN0ZXApICogY207XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfdmFsdWUgPSByZXBsYWNlUGVyaW9kKHZhbHVlKSAqIGNtO1xyXG4gICAgICAgICAgICAgICAgX3N0ZXAgPSByZXBsYWNlUGVyaW9kKHN0ZXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgX3ZhbHVlID0gcmVwbGFjZVBlcmlvZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIF9zdGVwID0gcmVwbGFjZVBlcmlvZChzdGVwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChtZXRob2QgPT09IHRoaXMubWV0aG9kLk1FVEhPRF9BREQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChfdmFsdWUgKyBfc3RlcCkgLyBtO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gdGhpcy5tZXRob2QuTUVUSE9EX1NVQikge1xyXG4gICAgICAgICAgICByZXR1cm4gKF92YWx1ZSAtIF9zdGVwKSAvIG07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgLy8g5YaF6YOo5YWs5YWx5pa55rOV6ZuG5ZCILS1lbmRcclxufVxyXG4iXX0=