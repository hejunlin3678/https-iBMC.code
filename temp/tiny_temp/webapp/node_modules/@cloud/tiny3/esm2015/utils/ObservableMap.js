// TODO:未来看typescript如何继承Map
/**
 * @ignore
 */
export class ObservableMap {
    constructor() {
        // 代理模式
        this.map = new Map();
        // 观察者模式
        this.handlerSet = new Set();
        this.map = new Map();
    }
    get size() {
        return this.map.size;
    }
    addObserver(handlerFn) {
        this.handlerSet.add(handlerFn);
    }
    removeObserver(handlerFn) {
        this.handlerSet.delete(handlerFn);
    }
    // 通知函数，不会通知到发起源
    notify(key, value, add, from) {
        this.handlerSet.forEach((handlerFn) => {
            handlerFn(key, value, add, from);
        });
    }
    //  设置，可以添加发起源，那么消息不会通知到发起源。
    set(key, value, from) {
        if (!this.map.has(key) || (this.map.has(key) && this.map.get(key) !== value)) {
            this.map.set(key, value);
            this.notify(key, value, true, from);
        }
        return this;
    }
    //  删除，可以添加发起源，那么消息不会通知到发起源。
    delete(key, from) {
        if (this.map.has(key)) {
            this.map.delete(key);
            this.notify(key, undefined, false, from);
            return true;
        }
        return false;
    }
    has(key) {
        return this.map.has(key);
    }
    get(key) {
        return this.map.get(key);
    }
    getMap() {
        return this.map;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JzZXJ2YWJsZU1hcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL0BjbG91ZC90aW55My91dGlscy9PYnNlcnZhYmxlTWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLDRCQUE0QjtBQUM1Qjs7R0FFRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBT3RCO1FBTEEsT0FBTztRQUNDLFFBQUcsR0FBa0IsSUFBSSxHQUFHLEVBQVksQ0FBQztRQU9qRCxRQUFRO1FBQ0EsZUFBVSxHQUF1QixJQUFJLEdBQUcsRUFBaUIsQ0FBQztRQUg5RCxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUxELElBQUksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDekIsQ0FBQztJQU1NLFdBQVcsQ0FBQyxTQUF3QjtRQUN2QyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ00sY0FBYyxDQUFDLFNBQXdCO1FBQzFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFDRCxnQkFBZ0I7SUFDUixNQUFNLENBQUMsR0FBUSxFQUFFLEtBQVUsRUFBRSxHQUFZLEVBQUUsSUFBUztRQUN4RCxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQXdCLEVBQUUsRUFBRTtZQUNqRCxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsNEJBQTRCO0lBQ3JCLEdBQUcsQ0FBQyxHQUFRLEVBQUUsS0FBVSxFQUFFLElBQVU7UUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDMUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDdkM7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0QsNEJBQTRCO0lBQ3JCLE1BQU0sQ0FBQyxHQUFRLEVBQUUsSUFBVTtRQUM5QixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ25CLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFekMsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFDTSxHQUFHLENBQUMsR0FBUTtRQUNmLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNNLEdBQUcsQ0FBQyxHQUFRO1FBQ2YsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBQ00sTUFBTTtRQUNULE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGlnbm9yZVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgSGFuZGxlckZuVHlwZSA9IChrZXk6IGFueSwgdmFsdWU6IGFueSwgYWRkOiBib29sZWFuLCBmcm9tPzogYW55KSA9PiB2b2lkO1xyXG4vLyBUT0RPOuacquadpeeci3R5cGVzY3JpcHTlpoLkvZXnu6fmib9NYXBcclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBPYnNlcnZhYmxlTWFwIHtcclxuXHJcbiAgICAvLyDku6PnkIbmqKHlvI9cclxuICAgIHByaXZhdGUgbWFwOiBNYXA8YW55LCBhbnk+ID0gbmV3IE1hcDxhbnksIGFueT4oKTtcclxuICAgIGdldCBzaXplKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwLnNpemU7XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLm1hcCA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuICAgIC8vIOinguWvn+iAheaooeW8j1xyXG4gICAgcHJpdmF0ZSBoYW5kbGVyU2V0OiBTZXQ8SGFuZGxlckZuVHlwZT4gPSBuZXcgU2V0PEhhbmRsZXJGblR5cGU+KCk7XHJcbiAgICBwdWJsaWMgYWRkT2JzZXJ2ZXIoaGFuZGxlckZuOiBIYW5kbGVyRm5UeXBlKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVyU2V0LmFkZChoYW5kbGVyRm4pO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHJlbW92ZU9ic2VydmVyKGhhbmRsZXJGbjogSGFuZGxlckZuVHlwZSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlclNldC5kZWxldGUoaGFuZGxlckZuKTtcclxuICAgIH1cclxuICAgIC8vIOmAmuefpeWHveaVsO+8jOS4jeS8mumAmuefpeWIsOWPkei1t+a6kFxyXG4gICAgcHJpdmF0ZSBub3RpZnkoa2V5OiBhbnksIHZhbHVlOiBhbnksIGFkZDogYm9vbGVhbiwgZnJvbTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVyU2V0LmZvckVhY2goKGhhbmRsZXJGbjogSGFuZGxlckZuVHlwZSkgPT4ge1xyXG4gICAgICAgICAgICBoYW5kbGVyRm4oa2V5LCB2YWx1ZSwgYWRkLCBmcm9tKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vICDorr7nva7vvIzlj6/ku6Xmt7vliqDlj5HotbfmupDvvIzpgqPkuYjmtojmga/kuI3kvJrpgJrnn6XliLDlj5HotbfmupDjgIJcclxuICAgIHB1YmxpYyBzZXQoa2V5OiBhbnksIHZhbHVlOiBhbnksIGZyb20/OiBhbnkpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIXRoaXMubWFwLmhhcyhrZXkpIHx8ICh0aGlzLm1hcC5oYXMoa2V5KSAmJiB0aGlzLm1hcC5nZXQoa2V5KSAhPT0gdmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFwLnNldChrZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnkoa2V5LCB2YWx1ZSwgdHJ1ZSwgZnJvbSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8vICDliKDpmaTvvIzlj6/ku6Xmt7vliqDlj5HotbfmupDvvIzpgqPkuYjmtojmga/kuI3kvJrpgJrnn6XliLDlj5HotbfmupDjgIJcclxuICAgIHB1YmxpYyBkZWxldGUoa2V5OiBhbnksIGZyb20/OiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5tYXAuaGFzKGtleSkpIHtcclxuICAgICAgICAgICAgdGhpcy5tYXAuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5KGtleSwgdW5kZWZpbmVkLCBmYWxzZSwgZnJvbSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBoYXMoa2V5OiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tYXAuaGFzKGtleSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZ2V0KGtleTogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwLmdldChrZXkpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldE1hcCgpOiBNYXA8YW55LCBhbnk+IHsgLy8g5pa55L6/6YGN5Y6GTWFw77yM5omA5pyJ5pyJ5LqG6L+Z5Liq5pa55rOV44CCXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==