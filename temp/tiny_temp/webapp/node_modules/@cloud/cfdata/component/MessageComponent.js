"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessageComponent = void 0;
var StorageService_1 = require("../service/StorageService");
var MAX_MSG_NUMBER = 3; // 限制最多3条
var msgID = 1;
var ERROR_DURATION = 10000;
var INFO_DURATION = 5000;
var MessageComponent = /** @class */ (function () {
    function MessageComponent() {
    }
    MessageComponent.showError = function (message, duration, wrapperClass) {
        this.alertMsg('error', message, duration, wrapperClass);
    };
    MessageComponent.showSuccess = function (message, duration, wrapperClass) {
        this.alertMsg('success', message, duration, wrapperClass);
    };
    MessageComponent.showPrompt = function (message, duration, wrapperClass) {
        this.alertMsg('prompt', message, duration, wrapperClass);
    };
    MessageComponent.showWarn = function (message, duration, wrapperClass) {
        this.alertMsg('warn', message, duration, wrapperClass);
    };
    /*
    添加消息缓存， ctc、dt等局点适用
    */
    MessageComponent.storageMsg = function (type, msg) {
        var msgData = {};
        msgData['content'] = '[' + type + ']' + msg;
        msgData['time'] = new Date();
        var agencyID = StorageService_1.StorageService.getCookie('agencyID');
        var tipsMessages = StorageService_1.StorageService.getSessionStorage('framework_tips_msg' + agencyID);
        tipsMessages = tipsMessages ? tipsMessages : [];
        if (tipsMessages.unshift(msgData) > 50) {
            tipsMessages.pop();
        }
        StorageService_1.StorageService.setSessionStorage('framework_tips_msg' + agencyID, tipsMessages);
        StorageService_1.StorageService.setSessionStorage('framework_tips_new_msg' + agencyID, true);
        // 广播事件‘cfStorageMsg’
        window.dispatchEvent(new CustomEvent('cfStorageMsg'));
    };
    /*
    绘制消息弹窗方法
    */
    MessageComponent.alertMsg = function (type, message, duration, wrapperClass, noTypeIcon, noCloseIcon) {
        if (!duration) {
            if (type === 'error') {
                duration = ERROR_DURATION;
            }
            else {
                duration = INFO_DURATION;
            }
        }
        // 若服务未传入wrapperClass，设置默认值'body'
        if (!wrapperClass) {
            wrapperClass = 'body';
        }
        var MsgItemObj = {
            type: type,
            message: message,
            id: 'msg_' + msgID++,
            typeIcon: !noTypeIcon,
            closeIcon: !noCloseIcon,
            duration: duration,
        };
        var timerMsg;
        if (!document.querySelector(wrapperClass + '> .cf-message-wrapper')) {
            var messageWrapper_1 = document.createElement('div');
            messageWrapper_1.setAttribute('class', 'cf-message-wrapper');
            var bodyNode = document.querySelector(wrapperClass);
            bodyNode.appendChild(messageWrapper_1);
            // 头部高度变化带来的message位置调整不适用于弹窗组件内部的提示
            if (wrapperClass === 'body') {
                // 当头部高度变化改变message的位置
                var consoleContext = window.getConsoleContext && window.getConsoleContext();
                var consoleDataService = (consoleContext === null || consoleContext === void 0 ? void 0 : consoleContext.get) && consoleContext.get({ name: 'safearea' });
                if (consoleDataService === null || consoleDataService === void 0 ? void 0 : consoleDataService.getSafeArea) {
                    var safeArea = consoleDataService.getSafeArea();
                    messageWrapper_1.style.top = safeArea.top + 10 + "px";
                }
                if (consoleDataService === null || consoleDataService === void 0 ? void 0 : consoleDataService.onChange) {
                    consoleDataService.onChange(function (e) {
                        messageWrapper_1.style.top = e.detail.top + 10 + "px";
                    });
                }
            }
        }
        var messageWraper = document.querySelector(wrapperClass + ' > .cf-message-wrapper');
        var messageItem = document.createElement('div');
        var messageItemCon = "<span class='cf-message-icon cf-icon-status-" + MsgItemObj.type + "'></span><p class='cf-message-p'>" + MsgItemObj.message + "</p><span class='cf-message-close hwsicon-frame-image-close'></span>";
        messageItem.innerHTML = messageItemCon;
        messageItem.setAttribute('class', String('cf-message-' + MsgItemObj.type));
        if (messageWraper.hasChildNodes()) {
            // 当前容器含有消息子节点，新增弹窗添加在现有首个子节点之前
            var firstNode = messageWraper.firstChild;
            messageWraper.insertBefore(messageItem, firstNode);
            // 新增消息如果与现有消息一致，同样的消息仅显示一条，duration时间同步最新的一条
            if (firstNode.isEqualNode(messageItem)) {
                messageWraper.removeChild(firstNode); // remove()方法在IE下存在兼容性问题
            }
            if (messageWraper.childNodes.length > MAX_MSG_NUMBER) {
                messageWraper.removeChild(messageWraper.lastChild);
            }
        }
        else {
            // 不包含消息子节点，则直接插入到容器中
            messageWraper.appendChild(messageItem);
        }
        timerMsg = setTimeout(function () {
            // 清空消息Dom节点时，需先判断parentNode是否存在
            if (messageItem.parentNode) {
                messageItem.outerHTML = '';
            }
        }, duration);
        messageItem.addEventListener('click', function (event) {
            // 点击关闭按钮，消息弹窗隐藏
            if (event.target.classList.contains('hwsicon-frame-image-close')) {
                messageItem.outerHTML = '';
                clearTimeout(timerMsg);
            }
        });
        if (message) {
            this.storageMsg(type, message);
        }
    };
    return MessageComponent;
}());
exports.MessageComponent = MessageComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVzc2FnZUNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnQvTWVzc2FnZUNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw0REFBMkQ7QUFFM0QsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUztBQUNqQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDZCxJQUFJLGNBQWMsR0FBRyxLQUFLLENBQUM7QUFDM0IsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDO0FBRXpCO0lBQ0k7SUFBZ0IsQ0FBQztJQUVILDBCQUFTLEdBQXZCLFVBQXdCLE9BQWUsRUFBRSxRQUFpQixFQUFFLFlBQXFCO1FBQzdFLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVhLDRCQUFXLEdBQXpCLFVBQTBCLE9BQWUsRUFBRSxRQUFpQixFQUFFLFlBQXFCO1FBQy9FLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVhLDJCQUFVLEdBQXhCLFVBQXlCLE9BQWUsRUFBRSxRQUFpQixFQUFFLFlBQXFCO1FBQzlFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVhLHlCQUFRLEdBQXRCLFVBQXVCLE9BQWUsRUFBRSxRQUFpQixFQUFFLFlBQXFCO1FBQzVFLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUVEOztNQUVFO0lBQ1ksMkJBQVUsR0FBeEIsVUFBeUIsSUFBWSxFQUFFLEdBQVc7UUFDOUMsSUFBSSxPQUFPLEdB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