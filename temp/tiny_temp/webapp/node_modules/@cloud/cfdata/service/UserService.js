"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserSerivce = void 0;
var ApiService_1 = require("./ApiService");
var HttpService_1 = require("./HttpService");
var ConfigData_1 = require("../ConfigData");
var FrameData_1 = require("../FrameData");
/**
 *
 *
 * @export
 * @class UserSerivce
 * @extends {ApiService}
 */
var UserSerivce = /** @class */ (function (_super) {
    __extends(UserSerivce, _super);
    function UserSerivce() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    UserSerivce.getLoginUser = function (isRefreshToken) {
        var requestConfig = {
            url: FrameData_1.FrameData.getAppWebPath() + '/rest/me',
            timeout: 60000,
            headers: {
                'x-request-from': 'Framework',
            },
        };
        if (isRefreshToken) {
            requestConfig.headers = __assign(__assign({}, requestConfig.headers), { 'Token-Refresh': String(isRefreshToken) });
        }
        var promise = new Promise(function (resolve, reject) {
            HttpService_1.HttpService.get(requestConfig)
                .then(function (data) {
                UserSerivce.meDataBak = data;
                resolve(data);
            })
                .catch(function (error) {
                if (UserSerivce.meDataBak) {
                    resolve(UserSerivce.meDataBak);
                }
                else {
                    reject(error);
                }
            });
        });
        return promise;
    };
    /**
     * @internal
     * 貌似内外都没有用到
     * Gets user choices
     * @param options
     * @returns user choices
     */
    UserSerivce.getUserChoices = function (options) {
        options = options || {};
        var promise = HttpService_1.HttpService.get({
            url: FrameData_1.FrameData.getAppWebPath() + '/rest/silvan/rest/v1.0/user_choices',
            params: {
                userId: options.userId || '',
                preferName: options.type || '',
            },
            timeout: 60000,
            targetUrl: 'silvan=/silvan/rest/v1.0/user_choices',
        });
        return promise;
    };
    /**
     * @internal
     * 貌似内外都没有用到
     * Updates user choices
     * @param options
     * @returns user choices
     */
    UserSerivce.updateUserChoices = function (options) {
        options = options || {};
        var promise = HttpService_1.HttpService.post({
            url: FrameData_1.FrameData.getAppWebPath() + '/rest/silvan/rest/v1.0/user_choices',
            params: {
                userId: options.userId || '',
                preferName: options.type || '',
                preferDisplayName: options.value || '',
                preferDesc: options.preferDesc || '',
            },
            timeout: 60000,
            targetUrl: 'silvan=/silvan/rest/v1.0/user_choices',
        });
        return promise;
    };
    /**
     * 查询AssumeRoles
     *
     * @param  options
     * @returns
     * @memberof UserSerivce
     */
    UserSerivce.getAssumeRoles = function (options) {
        options = options || {};
        var promise = HttpService_1.HttpService.get({
            url: {
                s: FrameData_1.FrameData.getAppWebPath() + '/rest/iam/assumeRoles/{user_id}',
                o: {
                    user_id: options.userId,
                },
            },
            params: {
                limit: 5,
            },
            timeout: 60000,
            targetUrl: 'iam=/v3-huawei/xrole/history/' + options.userId,
        });
        return promise;
    };
    /**
     * @internal
     * 貌似内外都没有用到
     * Assumes role
     * @param options
     * @returns role
     */
    UserSerivce.assumeRole = function (options) {
        options = options || {};
        var promise = HttpService_1.HttpService.get({
            url: FrameData_1.FrameData.getAppWebPath() + '/rest/changeRole',
            timeout: 60000,
            mask: true,
            params: {
                agencyId: options.agencyId,
            },
        });
        return promise;
    };
    UserSerivce.getUserProjects = function (options) {
        options = options || {};
        var promise;
        if (ConfigData_1.ConfigData.getUiSwitchConfig().x_cloud_type === 'private') {
            promise = HttpService_1.HttpService.get({
                url: {
                    s: FrameData_1.FrameData.getAppWebPath() + '/rest/iam/v3/users/{user_id}/projects',
                    o: {
                        user_id: options.userId,
                    },
                },
                timeout: 60000,
                targetUrl: 'iam=/v3/users/' + options.userId + '/projects',
                cacheKey: {
                    locale: FrameData_1.FrameData.getLanguage(),
                    userId: options.userId,
                    cfApiName: 'projects',
                },
                cacheTimeout: 604800,
                cacheResult: true,
            });
        }
        else {
            promise = HttpService_1.HttpService.get({
                url: FrameData_1.FrameData.getAppWebPath() + '/rest/iam/v3/projects',
                timeout: 60000,
                targetUrl: 'iam=/v3/auth/projects',
                cacheKey: {
                    locale: FrameData_1.FrameData.getLanguage(),
                    userId: options.userId,
                    cfApiName: 'projects',
                },
                cacheTimeout: 604800,
                cacheResult: true,
            });
        }
        return promise;
    };
    UserSerivce.queryIamUser = function (userId) {
        return HttpService_1.HttpService.get({
            url: {
                s: FrameData_1.FrameData.getAppWebPath() + '/rest/iam/service/user/{userId}',
                o: {
                    userId: userId,
                },
            },
            timeout: 10000,
            params: {
                scope: 'imgpaths',
            },
            targetUrl: 'iam=/v3-huawei/service/user/' + userId + '?scope=imgpaths',
        });
    };
    /**
     * @internal
     * 貌似内外都没有用到
     * Querys mc user role
     * @param userId
     * @returns mc user role
     */
    UserSerivce.queryMcUserRole = function (userId) {
        return HttpService_1.HttpService.get({
            url: {
                s: FrameData_1.FrameData.getAppWebPath() + '/rest/mc/v1/{user_id}/role',
                o: {
                    user_id: userId,
                },
            },
            timeout: 10000,
            targetUrl: 'mc=/mc/v1/' + userId + '/role',
        });
    };
    return UserSerivce;
}(ApiService_1.ApiService));
exports.UserSerivce = UserSerivce;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlclNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VydmljZS9Vc2VyU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBMEM7QUFDMUMsNkNBQTRDO0FBQzVDLDRDQUEyQztBQUUzQywwQ0FBeUM7QUFHekM7Ozs7OztHQU1HO0FBQ0g7SUFBaUMsK0JBQVU7SUFBM0M7O0lBME1BLENBQUM7SUFqTWlCLHdCQUFZLEdBQTFCLFVBQTJCLGNBQXdCO1FBQy9DLElBQU0sYUFBYSxHQUFlO1lBQzlCLEdBQUcsRUFBRSxxQkFBUyxDQUFDLGFBQWEsRUFBRSxHQUFHLFVBQVU7WUFDM0MsT0FBTyxFQUFFLEtBQUs7WUFDZCxPQUFPLEVBQUU7Z0JBQ0wsZ0JBQWdCLEVBQUUsV0FBVzthQUNoQztTQUNKLENBQUM7UUFDRixJQUFJLGNBQWMsRUFBRTtZQUNoQixhQUFhLENBQUMsT0FBTyx5QkFBUSxhQUFhLENBQUMsT0FBTyxLQUFFLGVBQWUsRUFBRSxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUUsQ0FBQztTQUNqRztRQUVELElBQUksT0FBTyxHQUFrQixJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNO1lBQ3JELHlCQUFXLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQztpQkFDekIsSUFBSSxDQUFDLFVBQUEsSUFBSTtnQkFDTixXQUFXLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDN0IsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xCLENBQUMsQ0FBQztpQkFDRCxLQUFLLENBQUMsVUFBQSxLQUFLO2dCQUNSLElBQUksV0FBVyxDQUFDLFNBQVMsRUFBRTtvQkFDdkIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDbEM7cUJBQU07b0JBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNqQjtZQUNMLENB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