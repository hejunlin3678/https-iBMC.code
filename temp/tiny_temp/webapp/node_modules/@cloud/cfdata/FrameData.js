"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FrameData = void 0;
var ConfigData_1 = require("./ConfigData");
var CfFrame_1 = require("./interface/CfFrame");
var StorageService_1 = require("./service/StorageService");
var UtilService_1 = require("./service/UtilService");
var FrameData = /** @class */ (function () {
    function FrameData() {
    }
    /**
     * 获取和修改数据，都用这个接口.
     * 因为获取的数据跟局点配置相关，所以是同步接口。
     * Gets cf frame
     * @returns cf frame
     */
    FrameData.getCfFrame = function () {
        if (!FrameData.cfFrame) {
            FrameData.cfFrame = new CfFrame_1.CfFrame();
            if (StorageService_1.StorageService.getCookie('x-framework-ob') === 'SBC') {
                ConfigData_1.ConfigData.getLangConfig().supportLan = ['en-us'];
            }
            FrameData.cfFrame.cloudCookieDomain = document.domain.replace(/.+?\./, '');
            FrameData.cfFrame.importantMessageArr = [];
            FrameData.cfFrame.bussinessVersion = StorageService_1.StorageService.getCookie('ttl');
            FrameData.cfFrame.frameworkVersion = StorageService_1.StorageService.getCookie('ttf');
            FrameData.cfFrame.tinyVersion = StorageService_1.StorageService.getCookie('ttt');
            FrameData.getLanguage();
            FrameData.cfFrame.thirdPartner = StorageService_1.StorageService.getCookie('third-party-access');
            /* eslint-disable no-undef */
            // 构建数据。
        }
        return FrameData.cfFrame;
    };
    // 返回公共接口请求url的前缀（绝对路径）（末尾无/）
    FrameData.getAppWebPath = function () {
        // 兼容appWebPath、AppWebPath, 未配置appwebpath时,返回当前的pathname
        var appWebPath = window.AppWebPath || window.appWebPath || location.pathname;
        // 去掉首尾的/符号
        appWebPath = appWebPath.replace(/^\//, '').replace(/\/$/, '');
        // 返回url前缀绝对地址
        return window.location.origin + "/" + appWebPath;
    };
    // url > cookie > browser > supportLangs[0]
    FrameData.getLanguage = function (key) {
        if (key === void 0) { key = 'locale'; }
        var result = UtilService_1.UtilService.getUrlParameter(key);
        var cookieLang = StorageService_1.StorageService.getCookie(key);
        if (!result)
            result = cookieLang;
        var supportLanguage = ConfigData_1.ConfigData.getLangConfig().supportLan;
        if (supportLanguage.indexOf(result) >= 0) {
            FrameData.cfFrame.lang = result;
        }
        else {
            result = (navigator.browserLanguage || navigator.language).toLowerCase();
            result = FrameData.languageTranslate(result);
            if (supportLanguage.indexOf(result) >= 0) {
                FrameData.cfFrame.lang = result;
            }
            else {
                result = supportLanguage[0];
                FrameData.cfFrame.lang = result;
            }
        }
        var domain = document.domain
            .split('.')
            .slice(-2)
            .join('.');
        if (result && result !== cookieLang)
            StorageService_1.StorageService.setCookie(key, result, undefined, domain);
        return result;
    };
    FrameData.languageTranslate = function (browserCode) {
        if (browserCode) {
            return FrameData.cfFrame.browserCodeMap[browserCode.substr(0, 2)];
        }
        return null;
    };
    FrameData.cfFrame = new CfFrame_1.CfFrame();
    return FrameData;
}());
exports.FrameData = FrameData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRnJhbWVEYXRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0ZyYW1lRGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQ0FBMEM7QUFDMUMsK0NBQThDO0FBRzlDLDJEQUEwRDtBQUMxRCxxREFBb0Q7QUFFcEQ7SUFBQTtJQTJFQSxDQUFDO0lBeEVHOzs7OztPQUtHO0lBQ1csb0JBQVUsR0FBeEI7UUFDSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRTtZQUNwQixTQUFTLENBQUMsT0FBTyxHQUFHLElBQUksaUJBQU8sRUFBRSxDQUFDO1lBRWxDLElBQUksK0JBQWMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxLQUFLLEVBQUU7Z0JBQ3RELHVCQUFVLENBQUMsYUFBYSxFQUFFLENBQUMsVUFBVSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDckQ7WUFDRCxTQUFTLENBQUMsT0FBTyxDQUFDLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMzRSxTQUFTLENBQUMsT0FBTyxDQUFDLG1CQUFtQixHQUFHLEVBQUUsQ0FBQztZQUMzQyxTQUFTLENBQUMsT0FBTyxDQUFDLGdCQUFnQixHQUFHLCtCQUFjLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JFLFNBQVMsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEdBQUcsK0JBQWMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDckUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsK0JBQWMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEUsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXhCLFNBQVMsQ0FBQyxPQUFPLENBQUMsWUFBWSxHQUFHLCtCQUFjLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDaEYsNkJB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